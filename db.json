{"meta":{"version":1,"warehouse":"2.2.0"},"models":{"Asset":[{"_id":"themes/spfk/source/apple-touch-icon.png","path":"apple-touch-icon.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/css/loading-style.css","path":"css/loading-style.css","modified":0,"renderable":1},{"_id":"themes/spfk/source/css/showshare.css","path":"css/showshare.css","modified":0,"renderable":1},{"_id":"themes/spfk/source/css/style.styl","path":"css/style.styl","modified":0,"renderable":1},{"_id":"themes/spfk/source/fancybox/blank.gif","path":"fancybox/blank.gif","modified":0,"renderable":1},{"_id":"themes/spfk/source/fancybox/fancybox_loading.gif","path":"fancybox/fancybox_loading.gif","modified":0,"renderable":1},{"_id":"themes/spfk/source/fancybox/fancybox_sprite.png","path":"fancybox/fancybox_sprite.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/fancybox/fancybox_loading@2x.gif","path":"fancybox/fancybox_loading@2x.gif","modified":0,"renderable":1},{"_id":"themes/spfk/source/fancybox/fancybox_overlay.png","path":"fancybox/fancybox_overlay.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/fancybox/fancybox_sprite@2x.png","path":"fancybox/fancybox_sprite@2x.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/fancybox/jquery.fancybox.css","path":"fancybox/jquery.fancybox.css","modified":0,"renderable":1},{"_id":"themes/spfk/source/fancybox/jquery.fancybox.js","path":"fancybox/jquery.fancybox.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/fancybox/jquery.fancybox.pack.js","path":"fancybox/jquery.fancybox.pack.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/img/coderwall.png","path":"img/coderwall.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/img/delicious.png","path":"img/delicious.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/img/douban.png","path":"img/douban.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/img/facebook.png","path":"img/facebook.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/img/favicon.ico","path":"img/favicon.ico","modified":0,"renderable":1},{"_id":"themes/spfk/source/img/favicon.pngg","path":"img/favicon.pngg","modified":0,"renderable":1},{"_id":"themes/spfk/source/img/github.png","path":"img/github.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/img/favicon.png","path":"img/favicon.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/img/google.png","path":"img/google.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/img/img-err.png","path":"img/img-err.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/img/img-loading.png","path":"img/img-loading.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/img/instagram.png","path":"img/instagram.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/img/linkedin.png","path":"img/linkedin.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/img/mail.png","path":"img/mail.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/img/pinboard.png","path":"img/pinboard.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/img/pinterest.png","path":"img/pinterest.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/img/qq.png","path":"img/qq.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/img/rss.png","path":"img/rss.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/img/scrollbar_arrow.png","path":"img/scrollbar_arrow.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/img/segmentfault.png","path":"img/segmentfault.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/img/twitter.png","path":"img/twitter.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/img/wechat.png","path":"img/wechat.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/img/stackoverflow.png","path":"img/stackoverflow.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/img/weibo.png","path":"img/weibo.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/img/zhihu.png","path":"img/zhihu.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/js/TweenMax.js","path":"js/TweenMax.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/js/clipboard.min.js","path":"js/clipboard.min.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/js/instagram.js","path":"js/instagram.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/js/jquery.lazyload.js","path":"js/jquery.lazyload.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/js/main.js","path":"js/main.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/js/mobile.js","path":"js/mobile.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/js/pace.js","path":"js/pace.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/js/pc.js","path":"js/pc.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/js/plugins.js","path":"js/plugins.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/background/bg-4.jpg","path":"background/bg-4.jpg","modified":0,"renderable":1},{"_id":"themes/spfk/source/js/TweenMax.min.js","path":"js/TweenMax.min.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/js/embed.js","path":"js/embed.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/background/bg-1.jpg","path":"background/bg-1.jpg","modified":0,"renderable":1},{"_id":"themes/spfk/source/background/bg-109.jpg","path":"background/bg-109.jpg","modified":0,"renderable":1},{"_id":"themes/spfk/source/background/bg-11.jpg","path":"background/bg-11.jpg","modified":0,"renderable":1},{"_id":"themes/spfk/source/background/bg-17.jpg","path":"background/bg-17.jpg","modified":0,"renderable":1},{"_id":"themes/spfk/source/background/bg-20.jpg","path":"background/bg-20.jpg","modified":0,"renderable":1},{"_id":"themes/spfk/source/background/bg-3.jpg","path":"background/bg-3.jpg","modified":0,"renderable":1},{"_id":"themes/spfk/source/background/bg.jpg","path":"background/bg.jpg","modified":0,"renderable":1},{"_id":"themes/spfk/source/css/pace/pace-theme-flash.css","path":"css/pace/pace-theme-flash.css","modified":0,"renderable":1},{"_id":"themes/spfk/source/fancybox/helpers/fancybox_buttons.png","path":"fancybox/helpers/fancybox_buttons.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/fancybox/helpers/jquery.fancybox-buttons.css","path":"fancybox/helpers/jquery.fancybox-buttons.css","modified":0,"renderable":1},{"_id":"themes/spfk/source/fancybox/helpers/jquery.fancybox-buttons.js","path":"fancybox/helpers/jquery.fancybox-buttons.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/fancybox/helpers/jquery.fancybox-media.js","path":"fancybox/helpers/jquery.fancybox-media.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/fancybox/helpers/jquery.fancybox-thumbs.css","path":"fancybox/helpers/jquery.fancybox-thumbs.css","modified":0,"renderable":1},{"_id":"themes/spfk/source/fancybox/helpers/jquery.fancybox-thumbs.js","path":"fancybox/helpers/jquery.fancybox-thumbs.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/font-awesome/css/font-awesome.min.css","path":"font-awesome/css/font-awesome.min.css","modified":0,"renderable":1},{"_id":"themes/spfk/source/font-awesome/css/font-awesome.css","path":"font-awesome/css/font-awesome.css","modified":0,"renderable":1},{"_id":"themes/spfk/source/img/head.jpg","path":"img/head.jpg","modified":0,"renderable":1},{"_id":"themes/spfk/source/js/404/jquery.parallaxify-0.0.2.min.js","path":"js/404/jquery.parallaxify-0.0.2.min.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/background/bg-15.jpg","path":"background/bg-15.jpg","modified":0,"renderable":1},{"_id":"themes/spfk/source/background/bg-23.jpg","path":"background/bg-23.jpg","modified":0,"renderable":1},{"_id":"themes/spfk/source/background/bg-7.jpg","path":"background/bg-7.jpg","modified":0,"renderable":1},{"_id":"themes/spfk/source/font-awesome/fonts/FontAwesome.otf","path":"font-awesome/fonts/FontAwesome.otf","modified":0,"renderable":1},{"_id":"themes/spfk/source/font-awesome/fonts/fontawesome-webfont.eot","path":"font-awesome/fonts/fontawesome-webfont.eot","modified":0,"renderable":1},{"_id":"themes/spfk/source/font-awesome/fonts/fontawesome-webfont.woff2","path":"font-awesome/fonts/fontawesome-webfont.woff2","modified":0,"renderable":1},{"_id":"themes/spfk/source/font-awesome/fonts/fontawesome-webfont.woff","path":"font-awesome/fonts/fontawesome-webfont.woff","modified":0,"renderable":1},{"_id":"themes/spfk/source/js/404/jquery-2.0.3.min.js","path":"js/404/jquery-2.0.3.min.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/background/bg-14.jpg","path":"background/bg-14.jpg","modified":0,"renderable":1},{"_id":"themes/spfk/source/background/bg-9.jpg","path":"background/bg-9.jpg","modified":0,"renderable":1},{"_id":"themes/spfk/source/font-awesome/fonts/fontawesome-webfont.ttf","path":"font-awesome/fonts/fontawesome-webfont.ttf","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/css/imgshare.css","path":"static/api/css/imgshare.css","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/css/select_share.css","path":"static/api/css/select_share.css","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/css/like.css","path":"static/api/css/like.css","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/css/share_style0_16.css","path":"static/api/css/share_style0_16.css","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/css/share_popup.css","path":"static/api/css/share_popup.css","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/css/share_style0_24.css","path":"static/api/css/share_style0_24.css","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/css/share_style0_32.css","path":"static/api/css/share_style0_32.css","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/css/share_style1_16.css","path":"static/api/css/share_style1_16.css","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/css/share_style1_24.css","path":"static/api/css/share_style1_24.css","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/css/share_style2.css","path":"static/api/css/share_style2.css","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/css/share_style1_32.css","path":"static/api/css/share_style1_32.css","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/css/share_style2_16.css","path":"static/api/css/share_style2_16.css","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/css/share_style2_24.css","path":"static/api/css/share_style2_24.css","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/css/share_style2_32.css","path":"static/api/css/share_style2_32.css","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/css/share_style4.css","path":"static/api/css/share_style4.css","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/css/slide_share.css","path":"static/api/css/slide_share.css","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/css/weixin_popup.css","path":"static/api/css/weixin_popup.css","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/js/share.js","path":"static/api/js/share.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/background/bg-19.jpg","path":"background/bg-19.jpg","modified":0,"renderable":1},{"_id":"themes/spfk/source/background/bg-21.jpg","path":"background/bg-21.jpg","modified":0,"renderable":1},{"_id":"themes/spfk/source/background/bg-22.jpg","path":"background/bg-22.jpg","modified":0,"renderable":1},{"_id":"themes/spfk/source/background/bg-24.jpg","path":"background/bg-24.jpg","modified":0,"renderable":1},{"_id":"themes/spfk/source/background/bg-6.jpg","path":"background/bg-6.jpg","modified":0,"renderable":1},{"_id":"themes/spfk/source/background/bg-8.jpg","path":"background/bg-8.jpg","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/js/trans/data.js","path":"static/api/js/trans/data.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/js/trans/logger.js","path":"static/api/js/trans/logger.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/img/share/l8.gif","path":"static/api/img/share/l8.gif","modified":0,"renderable":1},{"_id":"themes/spfk/source/background/bg-10.jpg","path":"background/bg-10.jpg","modified":0,"renderable":1},{"_id":"themes/spfk/source/background/bg-12.jpg","path":"background/bg-12.jpg","modified":0,"renderable":1},{"_id":"themes/spfk/source/background/bg-18.jpg","path":"background/bg-18.jpg","modified":0,"renderable":1},{"_id":"themes/spfk/source/img/bg.jpg","path":"img/bg.jpg","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/js/component/anticheat.js","path":"static/api/js/component/anticheat.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/js/component/animate.js","path":"static/api/js/component/animate.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/js/base/class.js","path":"static/api/js/base/class.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/js/component/pop_base.js","path":"static/api/js/component/pop_base.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/js/component/comm_tools.js","path":"static/api/js/component/comm_tools.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/js/component/partners.js","path":"static/api/js/component/partners.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/js/component/pop_dialog.js","path":"static/api/js/component/pop_dialog.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/js/component/pop_popup.js","path":"static/api/js/component/pop_popup.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/js/share/combine_api.js","path":"static/api/js/share/combine_api.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/js/component/qrcode.js","path":"static/api/js/component/qrcode.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/js/share/api_base.js","path":"static/api/js/share/api_base.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/js/component/pop_popup_slide.js","path":"static/api/js/component/pop_popup_slide.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/js/share/image_api.js","path":"static/api/js/share/image_api.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/js/share/like_api.js","path":"static/api/js/share/like_api.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/js/share/likeshare.js","path":"static/api/js/share/likeshare.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/js/share/share_api.js","path":"static/api/js/share/share_api.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/js/share/select_api.js","path":"static/api/js/share/select_api.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/js/share/slide_api.js","path":"static/api/js/share/slide_api.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/js/conf/const.js","path":"static/api/js/conf/const.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/js/conf/define.js","path":"static/api/js/conf/define.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/js/trans/trans.js","path":"static/api/js/trans/trans.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/js/trans/trans_bdxc.js","path":"static/api/js/trans/trans_bdxc.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/js/trans/trans_bdysc.js","path":"static/api/js/trans/trans_bdysc.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/js/trans/trans_weixin.js","path":"static/api/js/trans/trans_weixin.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/js/start/router.js","path":"static/api/js/start/router.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/js/view/image_view.js","path":"static/api/js/view/image_view.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/js/view/like_view.js","path":"static/api/js/view/like_view.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/js/view/select_view.js","path":"static/api/js/view/select_view.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/js/view/share_view.js","path":"static/api/js/view/share_view.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/js/view/view_base.js","path":"static/api/js/view/view_base.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/js/view/slide_view.js","path":"static/api/js/view/slide_view.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/img/share/icons_0_16.png","path":"static/api/img/share/icons_0_16.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/img/share/icons_0_24.png","path":"static/api/img/share/icons_0_24.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/img/share/icons_0_32.png","path":"static/api/img/share/icons_0_32.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/img/share/icons_1_16.png","path":"static/api/img/share/icons_1_16.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/img/share/icons_1_24.png","path":"static/api/img/share/icons_1_24.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/img/share/icons_2_24.png","path":"static/api/img/share/icons_2_24.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/img/share/icons_1_32.png","path":"static/api/img/share/icons_1_32.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/img/share/icons_2_16.png","path":"static/api/img/share/icons_2_16.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/img/share/icons_2_32.png","path":"static/api/img/share/icons_2_32.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/img/share/l0.gif","path":"static/api/img/share/l0.gif","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/img/share/l1.gif","path":"static/api/img/share/l1.gif","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/img/share/l3.gif","path":"static/api/img/share/l3.gif","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/img/share/l2.gif","path":"static/api/img/share/l2.gif","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/img/share/l4.gif","path":"static/api/img/share/l4.gif","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/img/share/l5.gif","path":"static/api/img/share/l5.gif","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/img/share/l6.gif","path":"static/api/img/share/l6.gif","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/img/share/l7.gif","path":"static/api/img/share/l7.gif","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/img/share/pop_c.gif","path":"static/api/img/share/pop_c.gif","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/img/share/r1.gif","path":"static/api/img/share/r1.gif","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/img/share/r0.gif","path":"static/api/img/share/r0.gif","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/img/share/r3.gif","path":"static/api/img/share/r3.gif","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/img/share/r2.gif","path":"static/api/img/share/r2.gif","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/img/share/r4.gif","path":"static/api/img/share/r4.gif","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/img/share/r5.gif","path":"static/api/img/share/r5.gif","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/img/share/r6.gif","path":"static/api/img/share/r6.gif","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/img/share/r7.gif","path":"static/api/img/share/r7.gif","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/img/share/r8.gif","path":"static/api/img/share/r8.gif","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/img/share/sc.png","path":"static/api/img/share/sc.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/img/share/selectshare_close.png","path":"static/api/img/share/selectshare_close.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/img/share/share-search-icon.png","path":"static/api/img/share/share-search-icon.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/background/bg-13.jpg","path":"background/bg-13.jpg","modified":0,"renderable":1},{"_id":"themes/spfk/source/background/bg-111.jpg","path":"background/bg-111.jpg","modified":0,"renderable":1},{"_id":"themes/spfk/source/background/bg-16.jpg","path":"background/bg-16.jpg","modified":0,"renderable":1},{"_id":"themes/spfk/source/font-awesome/fonts/fontawesome-webfont.svg","path":"font-awesome/fonts/fontawesome-webfont.svg","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/js/base/tangram.js","path":"static/api/js/base/tangram.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/background/bg-2.jpg","path":"background/bg-2.jpg","modified":0,"renderable":1},{"_id":"themes/spfk/source/background/bg-5.jpg","path":"background/bg-5.jpg","modified":0,"renderable":1}],"Cache":[{"_id":"themes/spfk/.gitignore","hash":"79b4a9ac435bc5833a0bc461ebacb10908b34ed3","modified":1512372448766},{"_id":"themes/spfk/README.md","hash":"a573ef126efe0747c3a648f07a94b109b3d62984","modified":1512372448766},{"_id":"themes/spfk/_config.yml","hash":"fd53fd711c053fc73760d6299ac8640eef2c39f5","modified":1512372448767},{"_id":"themes/spfk/package.json","hash":"0199dfb3d44cf520b67464817d13c44a7766b8d6","modified":1512372448780},{"_id":"source/_drafts/HCTF2016-Writeup.md","hash":"ffd60061b274b690d6d6578924c942b7ef2fcfeb","modified":1512372448741},{"_id":"source/_drafts/test.md","hash":"676e63cfc27bd10816be73d80ad5381621a86fc4","modified":1512372448741},{"_id":"source/_drafts/初识OD.md","hash":"403ec03c2799e2d6b6c38ca058cb2bf1846ee696","modified":1512372448741},{"_id":"source/_posts/BubbleSort.md","hash":"73e2238b8b681af61de4153d705c737ca82bbc90","modified":1512372448741},{"_id":"source/_posts/C-Helloworld.md","hash":"fb0c8b027b3d6c0587a9a91284279cf00b424f45","modified":1512372448742},{"_id":"source/_posts/Centos7-lnmp.md","hash":"6a9e4792938245668b7c57fe4ea992e7119238ef","modified":1512372448742},{"_id":"source/_posts/ChangeUbuntuPassWd.md","hash":"608829e98f114a3d5a72fee12bb3cdeb682b71b8","modified":1512372448743},{"_id":"source/_posts/CompileNgrok.md","hash":"2bfe4a568a8790a66204cd1ff49581f3bdbcf36f","modified":1512372448743},{"_id":"source/_posts/Decorator-Notes.md","hash":"3d5e6d0883728287a3353b4d8e53ea4f11f2e850","modified":1512372448744},{"_id":"source/_posts/CompileOpenJDK.md","hash":"3557d10e8bf9df68df0e254c530f6e51adafc1b0","modified":1512372448744},{"_id":"source/_posts/DictInListSorted.md","hash":"0fd8407685fe77ad35b48e531f719bd57882e2d3","modified":1512372448744},{"_id":"source/_posts/Django-Signal.md","hash":"b9f598bf31b5894274b8bce1eb1cfc5b4533e1b5","modified":1512372448744},{"_id":"source/_posts/Django-helloworld.md","hash":"01640090e50652d87f9bf5107f78baea3bc07309","modified":1512372448745},{"_id":"source/_posts/DjangoQuery.md","hash":"7d85c702a7df5ebae6780083037122991adb00fb","modified":1512372448745},{"_id":"source/_posts/Django-install.md","hash":"7e9f68f61c283e23e899fcabc5cef576e81bd572","modified":1512372448745},{"_id":"source/_posts/DjangoRESTframework-AuthenticationPermissions.md","hash":"c0c4c3a187d281201df9d543d61462493386c2a3","modified":1512372448753},{"_id":"source/_posts/DjangoRESTframework-RelationshipsHyperlinkedAPI.md","hash":"11a31dee10f41c5141c4705d22eecaf27238c82d","modified":1512372448753},{"_id":"source/_posts/DjangoRESTframework-SchemaClientLib.md","hash":"76d33fff586c8b511a1aad06f98451a11a69971d","modified":1512372448754},{"_id":"source/_posts/DjangoRESTframework-ReqAndRes.md","hash":"6dd1eb807c50049c9a8b219859d9cf0006d4a5cb","modified":1512372448754},{"_id":"source/_posts/DjangoRESTframework-ViewsetsRouters.md","hash":"938184eb5cd8c9179d70a4e9326d7faf2029cf4e","modified":1512372448754},{"_id":"source/_posts/DjangoRESTframework-class-based-view.md","hash":"034df059d1efabfe7c08c4e44276c781e3251143","modified":1512372448754},{"_id":"source/_posts/DjangoRESTframework-serializetion.md","hash":"dfd8b12cde27247da44dd66ef624ef278eea230e","modified":1512372448755},{"_id":"source/_posts/DjangoRESTframework-quickstart.md","hash":"7b2f53f0e9dbae9c1f95ee92e32008b475ccb022","modified":1512372448755},{"_id":"source/_posts/DjangowithPostgres.md","hash":"f44e259dcd2778d3e21d6e409f93af6388d3ab78","modified":1512372448755},{"_id":"source/_posts/DokerStudy-install.md","hash":"385bc2043636c675b1a5179a01839cd0e5804c11","modified":1512372448756},{"_id":"source/_posts/Factory-Notes.md","hash":"7c2b38981c72936ba30c65b77a5eea915eb03b3a","modified":1512372448756},{"_id":"source/_posts/GDB-peda.md","hash":"9c4cf7a2451ca4ea14576774025be581c85cef77","modified":1512372448756},{"_id":"source/_posts/Github-Webhook.md","hash":"196f2e9a8851882d44e9609d21856c80446c368b","modified":1512372448757},{"_id":"source/_posts/Github-Add-SSHKEY.md","hash":"70f1633cbe380319448704ba9a44c060d6f27599","modified":1512372448756},{"_id":"source/_posts/Learn-Markdown.md","hash":"4a6390a7fc1340baccd2765706d60473fe72106f","modified":1512372448757},{"_id":"source/_posts/InsertSort.md","hash":"0588a28328787b97bd67b09a732671f2d6e28aeb","modified":1512372448757},{"_id":"source/_posts/Learn_VIM.md","hash":"7e76f6a9228a407e4d9ca1d512f1e0d38a376ed0","modified":1512372448758},{"_id":"source/_posts/Let-s-Encrypt.md","hash":"cfcbe8e339a3d8205f0502c10f74560ab0b930fe","modified":1512372448758},{"_id":"source/_posts/Linux-Add-Swap.md","hash":"3abb25b69f674f989bfa2053404ad3a148961538","modified":1512372448758},{"_id":"source/_posts/Linux-File-Priveleges.md","hash":"f4c352781d1d0ac5e1bd12a9a2c1f5fb32987a8e","modified":1512372448759},{"_id":"source/_posts/LoginNewTP.md","hash":"408e07d216e6a9b9a1db73b85762f78fb0e08adb","modified":1512372448759},{"_id":"source/_posts/MariaDB-Create-Remote.md","hash":"269edd0c2e9cf4ba0ef8bf00e976efb058d383dc","modified":1512372448759},{"_id":"source/_posts/Observer-Notes.md","hash":"26048603a4f9d48392c997e910118be6dabc8cc6","modified":1512372448759},{"_id":"source/_posts/OpenWRT-BuildEnvironMent.md","hash":"57f1e8ab4f45a66eb23e380f68ed71681749f867","modified":1512372448760},{"_id":"source/_posts/OpenWrt-HelloWorl.md","hash":"16bd89f2c61b0fd9c25ccaf445857e517598ac47","modified":1512372448760},{"_id":"source/_posts/PDF-watermask.md","hash":"8b2a4b537a6ff175a0e3c5bb4b28e3730024394c","modified":1512372448760},{"_id":"source/_posts/PIL-Grab.md","hash":"6cae0587585a7bed5fd786ddc55dc4ef8a604cd5","modified":1512372448761},{"_id":"source/_posts/Pwnable-collision.md","hash":"7a75e2d0a1a6df82a2eba92b6a5425dc03d6797a","modified":1512372448761},{"_id":"source/_posts/Pwnable-fd.md","hash":"a4f09db8a4fba0b515cbfdbd94620ea7ac174ae6","modified":1512372448761},{"_id":"source/_posts/PythonEpoll.md","hash":"6b91954a9fb58eee386a43791395214931cbf6bf","modified":1512372448761},{"_id":"source/_posts/PythonSingleton.md","hash":"44b846c00678d8d3dd8c62db1378766ec64c658d","modified":1512372448762},{"_id":"source/_posts/SSH-LOG-USER.md","hash":"e3c13a33a20cf19ef005e5bd26834aab31bda18e","modified":1512372448762},{"_id":"source/_posts/Python-Closure.md","hash":"daa72f3d27fa1e5ad13a1ee4a8ea53e609b37dcd","modified":1512372448761},{"_id":"source/_posts/TCP-Echo-Demo.md","hash":"c08014212bf4ba2b0d29d3b357d2211264a35acc","modified":1512372448762},{"_id":"source/_posts/Ubuntu-install-Postgres.md","hash":"93ef4c36e73d88b199b78217a7f8c1accdbd71f2","modified":1512372448763},{"_id":"source/_posts/Ubuntu-17-10-Systemd-Networkd.md","hash":"0a07d45f6eb94bbf740ec624270f24c94a58da4c","modified":1513224046497},{"_id":"source/_posts/WindowsTasklistFilter.md","hash":"669fae3d8a083b065d4cc0ce7317c1ff20aea2a5","modified":1512372448763},{"_id":"source/_posts/UnixSocket-echodemo.md","hash":"f2e231de12c3932646249e0bf163583157a7d566","modified":1512372448763},{"_id":"source/_posts/cookie-property.md","hash":"7e01f416fac109e6cd3c0dc34a9c9dc547bf6dad","modified":1520566001463},{"_id":"source/_posts/hello-world.md","hash":"cc55890d4caa8353f85c0f2a014f0f3343b4c134","modified":1512372448763},{"_id":"source/_posts/iPXE-WinPE.md","hash":"e74cdd8b7760f51e8eafcabd100f42a26be84ccf","modified":1520998131711},{"_id":"source/_posts/kvm-win7-install.md","hash":"ffaef0fac292ebad14d30736272d531739d8faf5","modified":1520566001463},{"_id":"source/_posts/install-pcapy.md","hash":"f6db6fe2a96635453c09bbaf308a414c9b2e180c","modified":1512372956627},{"_id":"source/_posts/nginx-diable-domain.md","hash":"6385f3d1196f90881b485d24c285c53287a5d701","modified":1512372448764},{"_id":"source/_posts/nginx-location-rule.md","hash":"db7016f40ac9958170766a670861d6cb29b6aac0","modified":1513155795079},{"_id":"source/_posts/python-metaclass.md","hash":"2bee09d6398105aef3dc66a9e5611150d6e51826","modified":1512439905311},{"_id":"source/_posts/python-kwargs.md","hash":"bc59649ecc5fdc84a1882e642ee442c6602b720f","modified":1512372448764},{"_id":"source/_posts/python-module-atexit.md","hash":"abb2e02814d86c0deb82a963e210b2fd88f37be2","modified":1512372448764},{"_id":"source/_posts/python-note-repr.md","hash":"d6f0b6699afeddab69fbac3739397ee5e7b229db","modified":1512372448764},{"_id":"source/_posts/python-utc-local.md","hash":"d507f25e7ec7504eda6b0963dd82f6745388d802","modified":1512372448765},{"_id":"source/_posts/tornado-hello-world.md","hash":"86ac545d6d8c89604cdf052f85ecab43f381f42a","modified":1512372448765},{"_id":"source/_posts/tornado-requesthandler.md","hash":"4cf7091b41d00c8510847aadd575d007482bd495","modified":1512372448765},{"_id":"source/_posts/ubuntu-kvm.md","hash":"f3d4bd01a3c948e4bd55f4067147eb4e122844af","modified":1520566001463},{"_id":"source/_posts/web-vnc.md","hash":"baa0e27b8ea6643f88546ca13ba414eaeaf8bd91","modified":1520566001463},{"_id":"source/about/index.md","hash":"ac2e62f0037a8d57985e35bbf3fbadb8f31cf031","modified":1512372448766},{"_id":"themes/spfk/languages/de.yml","hash":"bc80f78f61c3d7af9652e6aa6fc3e4ff39b0c8d3","modified":1512372448767},{"_id":"themes/spfk/languages/default.yml","hash":"f0a7a032b31555c9ec05a711e1ac19bb07724708","modified":1512372448767},{"_id":"themes/spfk/languages/en.yml","hash":"a093e794aef63ec9e9e9ef490cf7e4474e45e59f","modified":1512372448767},{"_id":"themes/spfk/languages/fr-FR.yml","hash":"04b9a0d80d88d01e039e8077afe88f741e9620ba","modified":1512372448767},{"_id":"themes/spfk/languages/pt-BR","hash":"9e8a1942a32af8720c9fbca8db14eb89d76c21bd","modified":1512372448768},{"_id":"themes/spfk/languages/ru.yml","hash":"62f84ea82a696060c481fc22d4742e6201bb9bdc","modified":1512372448768},{"_id":"themes/spfk/languages/zh-Hans.yml","hash":"d2336578e14bb880d152266981c2b17523fc8742","modified":1512372448768},{"_id":"themes/spfk/languages/zh-hk.yml","hash":"e702fc43556e54c396917bdf7c869d528742e28b","modified":1512372448768},{"_id":"source/_posts/iPXE-NetworkBoot.md","hash":"08704b16302e8c8d2a9ad5327feb6df1aaa4add0","modified":1520993759759},{"_id":"themes/spfk/languages/zh-tw.yml","hash":"005559baa96b7bb34e1efe6b031829a95d58d5e0","modified":1512372448769},{"_id":"themes/spfk/languages/zh.yml","hash":"d2336578e14bb880d152266981c2b17523fc8742","modified":1512372448769},{"_id":"themes/spfk/layout/archive.ejs","hash":"2703b07cc8ac64ae46d1d263f4653013c7e1666b","modified":1512372448778},{"_id":"themes/spfk/layout/category.ejs","hash":"765426a9c8236828dc34759e604cc2c52292835a","modified":1512372448778},{"_id":"themes/spfk/layout/index.ejs","hash":"aa1b4456907bdb43e629be3931547e2d29ac58c8","modified":1512372448779},{"_id":"themes/spfk/layout/layout.ejs","hash":"3a4350f23a1286345f76c949466c97a7200dae8e","modified":1512372448779},{"_id":"themes/spfk/layout/page.ejs","hash":"7d80e4e36b14d30a7cd2ac1f61376d9ebf264e8b","modified":1512372448779},{"_id":"themes/spfk/layout/plugins.swig","hash":"4c978bfbde006b6e3b82f4931541fada9381806d","modified":1512372448779},{"_id":"themes/spfk/layout/tag.ejs","hash":"eaa7b4ccb2ca7befb90142e4e68995fb1ea68b2e","modified":1512372448780},{"_id":"themes/spfk/source/apple-touch-icon.png","hash":"c36a373c7830d61d1ce092bd5a88d0e9b54212fd","modified":1512372448780},{"_id":"themes/spfk/layout/post.ejs","hash":"7d80e4e36b14d30a7cd2ac1f61376d9ebf264e8b","modified":1512372448779},{"_id":"themes/spfk/layout/_partial/archive-post.ejs","hash":"0ecc2ad07b4abad80f564ac1858c50bcbdff34f8","modified":1512372448770},{"_id":"themes/spfk/layout/_partial/after-footer.ejs","hash":"d4860c067284d5c24980da8e1a5f9f279a48477f","modified":1514960601779},{"_id":"themes/spfk/layout/_partial/archive.ejs","hash":"a4eacc2bc1278095a0ef99f904b0634c78f980eb","modified":1512372448771},{"_id":"themes/spfk/layout/_partial/article.ejs","hash":"33a9e21698fe3038a7dfcf0f34d73901482c49db","modified":1512372448771},{"_id":"themes/spfk/layout/_partial/bodybackground.ejs","hash":"ad24b949bbe4fadf7549be3d1df76fc7444d1adc","modified":1512372448771},{"_id":"themes/spfk/layout/_partial/background.ejs","hash":"4031d2ae2bd23cea8c1059122e7358d6b4943664","modified":1512372448771},{"_id":"themes/spfk/layout/_partial/case.swig","hash":"ff7174ff79bfe82a70b03a07d78583b1e8d1827f","modified":1512372448771},{"_id":"themes/spfk/layout/_partial/footer.ejs","hash":"db08f6276c2b501ad16a335f5d0d06c1b4e24d35","modified":1512372448772},{"_id":"themes/spfk/layout/_partial/head.ejs","hash":"1f2809590152382520abbba13fab2571322db123","modified":1512372448772},{"_id":"themes/spfk/layout/_partial/header.ejs","hash":"b69855e07b65117769adc515cb64b803932068c9","modified":1512372448773},{"_id":"themes/spfk/layout/_partial/hide-labels.ejs","hash":"21ffa5e590b1588b61b7de66c81a992ff87e9b36","modified":1512372448773},{"_id":"themes/spfk/layout/_partial/left-col.ejs","hash":"99b8143b6bfd6a6f3de4bbb34c3b9a50162fa4d4","modified":1512372448773},{"_id":"themes/spfk/layout/_partial/mathjax.ejs","hash":"34b2d7050db88fed9f70b8233f16f451bad501f4","modified":1512372448773},{"_id":"themes/spfk/layout/_partial/page.ejs","hash":"112353124225cada3e44644151f069655db9494b","modified":1512372448774},{"_id":"themes/spfk/layout/_partial/mobile-nav.ejs","hash":"fe5f6a248269db2003d4bde653f56c3adc7a613a","modified":1512372448774},{"_id":"themes/spfk/layout/_partial/plugin.swig","hash":"b8539477a33580d9e493365f16e7b7d40afc5e5c","modified":1512372448774},{"_id":"themes/spfk/layout/_partial/post-nav-button.ejs","hash":"dcd7e89788f050d466d0502e7535397619009360","modified":1512372448774},{"_id":"themes/spfk/layout/_partial/scrolling-button.ejs","hash":"40573748d4a14530e6052836ef8a7063e6486d45","modified":1512372448776},{"_id":"themes/spfk/layout/_partial/theme.swig","hash":"96ae0d2429f712faf2964ed74fbeffc395accac2","modified":1512372448777},{"_id":"themes/spfk/layout/_partial/toc.ejs","hash":"c46a2b624281b09d4aeacf2921cd712837469a1d","modified":1512372448778},{"_id":"themes/spfk/layout/_partial/work.swig","hash":"f0191892b19a19d7bb59f97c659611208b53c81d","modified":1512372448778},{"_id":"themes/spfk/source/css/_extend.styl","hash":"8ab1ad313bd6707d248c5ca1ee9a5eab8d815e42","modified":1512372448831},{"_id":"themes/spfk/source/css/loading-style.css","hash":"ef12c256b59ed836994afed35bf02556248133ce","modified":1512372448837},{"_id":"themes/spfk/source/css/_variables.styl","hash":"06d579447488fb23e40603970dc08ffe6ad31897","modified":1512372448837},{"_id":"themes/spfk/source/css/showshare.css","hash":"176f81997ae8108d07a82fc6ea7cc34f7305bfde","modified":1512372448838},{"_id":"themes/spfk/source/css/style.styl","hash":"6f93632f70b25aafc1e0d31c30c1d3e3120688cc","modified":1512372448838},{"_id":"themes/spfk/source/fancybox/blank.gif","hash":"2daeaa8b5f19f0bc209d976c02bd6acb51b00b0a","modified":1512372448838},{"_id":"themes/spfk/source/fancybox/fancybox_loading.gif","hash":"1a755fb2599f3a313cc6cfdb14df043f8c14a99c","modified":1512372448838},{"_id":"themes/spfk/source/fancybox/fancybox_sprite.png","hash":"17df19f97628e77be09c352bf27425faea248251","modified":1512372448839},{"_id":"themes/spfk/source/fancybox/fancybox_loading@2x.gif","hash":"273b123496a42ba45c3416adb027cd99745058b0","modified":1512372448839},{"_id":"themes/spfk/source/fancybox/fancybox_overlay.png","hash":"b3a4ee645ba494f52840ef8412015ba0f465dbe0","modified":1512372448839},{"_id":"themes/spfk/source/fancybox/fancybox_sprite@2x.png","hash":"30c58913f327e28f466a00f4c1ac8001b560aed8","modified":1512372448839},{"_id":"themes/spfk/source/fancybox/jquery.fancybox.css","hash":"96138eaddfbd305160ddcb98a5f08555ca6cb4ee","modified":1512372448842},{"_id":"themes/spfk/source/fancybox/jquery.fancybox.js","hash":"004bb0812414554ab48067792f09e978603253b6","modified":1512372448842},{"_id":"themes/spfk/source/fancybox/jquery.fancybox.pack.js","hash":"2da892a02778236b64076e5e8802ef0566e1d9e8","modified":1512372448842},{"_id":"themes/spfk/source/img/coderwall.png","hash":"fa84676c4d654e040e51fd34bfcd9f9348cd5331","modified":1512372448851},{"_id":"themes/spfk/source/img/delicious.png","hash":"9553a5f5189e4a953e04a58a49dbfa74b86b73dd","modified":1512372448851},{"_id":"themes/spfk/source/img/douban.png","hash":"e2ade003ffadd5826ee66ec23901c2d6e8607e4e","modified":1512372448851},{"_id":"themes/spfk/source/img/facebook.png","hash":"d19ad7a0903daf26817afd8753cd97e0cc714f54","modified":1512372448851},{"_id":"themes/spfk/source/img/favicon.ico","hash":"48d9661f11688d84618da35409f6cbf3a0ac0507","modified":1512372448852},{"_id":"themes/spfk/source/img/favicon.pngg","hash":"5b4e9c94ff3396db5b074b69c1aa5bb909aba825","modified":1512372448852},{"_id":"themes/spfk/source/img/github.png","hash":"b84d03b32fa388dcbf149296ebd16dce6223d48d","modified":1512372448852},{"_id":"themes/spfk/source/img/favicon.png","hash":"33da7602134e0ec3c9eb08eb1478e2893f48a6ed","modified":1512372448852},{"_id":"themes/spfk/source/img/google.png","hash":"61a21fec7346fa3400b747ac9a201cf3d5bc013d","modified":1512372448853},{"_id":"themes/spfk/source/img/img-err.png","hash":"23a63ea26eb3c1d5e677d9883cf36cc1a1a1228b","modified":1512372448854},{"_id":"themes/spfk/source/img/img-loading.png","hash":"a9cd5cd11866824f31e3d1c5e23badfeb3f73031","modified":1512372448854},{"_id":"themes/spfk/source/img/instagram.png","hash":"3c148a3882a8d141d7d405be8c4815d0dcb03561","modified":1512372448855},{"_id":"themes/spfk/source/img/linkedin.png","hash":"e203138fb53c257cb214e97f4e30091b9c568d2c","modified":1512372448855},{"_id":"themes/spfk/source/img/mail.png","hash":"fca8199cc77fdbd700a45bf56d091c82f4a67fe7","modified":1512372448855},{"_id":"themes/spfk/source/img/pinboard.png","hash":"0891fbb6d092fa012bf936019923383d84c6aeb0","modified":1512372448855},{"_id":"themes/spfk/source/img/pinterest.png","hash":"9c72917f8779c083157c6ce7a5d62ed4874f0630","modified":1512372448855},{"_id":"themes/spfk/source/img/qq.png","hash":"fd741764c5528fe371f053beac99839a97900eef","modified":1512372448856},{"_id":"themes/spfk/source/img/rss.png","hash":"430fd47340e75214c081abd05cd7410cf7c71b86","modified":1512372448856},{"_id":"themes/spfk/source/img/scrollbar_arrow.png","hash":"d64a33c4ddfbdb89deeb6f4e3d36eb84dc4777c0","modified":1512372448856},{"_id":"themes/spfk/source/img/segmentfault.png","hash":"4483ab273423deb65021111fc8ad9512b69e45b2","modified":1512372448856},{"_id":"themes/spfk/source/img/twitter.png","hash":"14dbb8e62d056525253bc0de13acd1723da7a934","modified":1512372448857},{"_id":"themes/spfk/source/img/wechat.png","hash":"7ca41b6e32ca4dac419225261ab4fee5a88f73a9","modified":1512372448857},{"_id":"themes/spfk/source/img/stackoverflow.png","hash":"da5dfe9043055c95e479d49c78cd3b020de608f2","modified":1512372448856},{"_id":"themes/spfk/source/img/weibo.png","hash":"280dae3fd38086158b4a1b57edb94c06b1a5014b","modified":1512372448857},{"_id":"themes/spfk/source/img/zhihu.png","hash":"a6d6ef65e9ac82e613a311810391ebb90d9b1c1d","modified":1512372448857},{"_id":"themes/spfk/source/js/TweenMax.js","hash":"1f60b6ccd135d181b78254468ffda1c7b9d51556","modified":1512372448859},{"_id":"themes/spfk/source/js/clipboard.min.js","hash":"fe53ec94d317bae8f12d1a5eee23040bf02680bb","modified":1512372448860},{"_id":"themes/spfk/source/js/instagram.js","hash":"81e13cacf4947118ed1920e59b04ccf6beef6b86","modified":1512372448861},{"_id":"themes/spfk/source/js/jquery.lazyload.js","hash":"91d5acc31d0bcbdf4782166a66344e58fff28d89","modified":1512372448861},{"_id":"themes/spfk/source/js/main.js","hash":"28d30d6dd4ffef17d236f31b5cba7714d770f5c1","modified":1512372448862},{"_id":"themes/spfk/source/js/mobile.js","hash":"baed8d560883c842c2b8c3e0fadcf359f97140d0","modified":1512372448862},{"_id":"themes/spfk/source/js/pace.js","hash":"d9cfcb7e1fc4b827a64491726c9a78b9886b3793","modified":1512372448862},{"_id":"themes/spfk/source/js/pc.js","hash":"482dc45356756150f0bee80c8d9a0987965b89ea","modified":1512372448862},{"_id":"themes/spfk/source/js/plugins.js","hash":"63e93eee75d6a83717af73dcc9829983123e01c1","modified":1512372448863},{"_id":"themes/spfk/source/background/bg-4.jpg","hash":"7ef559423622f8959cce79274bdf782d92a6e867","modified":1512372448818},{"_id":"themes/spfk/source/js/TweenMax.min.js","hash":"2207f42520d5c548702511180e500c3e077605f8","modified":1512372448860},{"_id":"themes/spfk/source/js/embed.js","hash":"0c4047c10bffdc5289f4e61700cc7dfbb56ccb0d","modified":1512372448861},{"_id":"themes/spfk/layout/_partial/analytics/baidu-analytics.ejs","hash":"e72a08ad3f7b43e7e9f09b005523cdc2f38356ac","modified":1512372448770},{"_id":"themes/spfk/layout/_partial/analytics/google-analytics.ejs","hash":"1ccc627d7697e68fddc367c73ac09920457e5b35","modified":1512372448770},{"_id":"themes/spfk/layout/_partial/comments/disqus.ejs","hash":"2e5cad68bc59190b4158f4ab1879a222ca49a0d2","modified":1512372448772},{"_id":"themes/spfk/layout/_partial/comments/duoshuo.ejs","hash":"da37a6c1631e82533b4cec7d1f5bb246b5b1acfe","modified":1512372448772},{"_id":"themes/spfk/layout/_partial/comments/youyan.ejs","hash":"142e1bb357d738663655ddab25f75e85e20345e4","modified":1512372448772},{"_id":"themes/spfk/layout/_partial/post/TipTitle.ejs","hash":"a1b64506cd6aba3cd8ab48cf3ee0d6477123d6b1","modified":1512372448774},{"_id":"themes/spfk/layout/_partial/post/category.ejs","hash":"08c8d98bc6a73d3f72a3b0b30521ff28e1b657a7","modified":1512372448775},{"_id":"themes/spfk/layout/_partial/post/date.ejs","hash":"a9fc6bac9e1b90c1c17c0d0ffd97f9b108072fbe","modified":1512372448775},{"_id":"themes/spfk/layout/_partial/post/loading.ejs","hash":"ba96f9dd60069b3ac2a332c45b1df82c0bf68f21","modified":1512372448775},{"_id":"themes/spfk/layout/_partial/post/nav.ejs","hash":"9590b381b3b787ca9b1d93d97a8d58e9fd9a4f2a","modified":1512372448775},{"_id":"themes/spfk/layout/_partial/post/tag.ejs","hash":"7d2693a1162bf26e4b1ae9b789e0b2a2637ddbd5","modified":1512372448776},{"_id":"themes/spfk/layout/_partial/post/swiftype.ejs","hash":"90f03e7f0ca811f3caeeaaeb2aaf5283e3ab4bb5","modified":1512372448775},{"_id":"themes/spfk/layout/_partial/post/title.ejs","hash":"d4a460a35e2112d0c7414fd5e19b3a16093f1caf","modified":1512372448776},{"_id":"themes/spfk/layout/_partial/share/baidu-share.ejs","hash":"499c1f92b613caff6d3828e5bfc4f40ed7af7b85","modified":1512372448776},{"_id":"themes/spfk/layout/_partial/share/showshare.ejs","hash":"d38ea660d51c8c58aa8ad20f225949863152326a","modified":1512372448777},{"_id":"themes/spfk/layout/_partial/share/share.ejs","hash":"bfac451ed8d632dbba84673691cc5ea3315c1469","modified":1512372448777},{"_id":"themes/spfk/source/background/bg-1.jpg","hash":"f0617756387d74f99afe0087c7b93a32f3c7096b","modified":1512372448782},{"_id":"themes/spfk/source/background/bg-109.jpg","hash":"6171c1e921c8cc9bdcd7276cf7f0bee5295f4672","modified":1512372448785},{"_id":"themes/spfk/source/background/bg-11.jpg","hash":"d69a0447e91f62977b144737f08620d77037c76a","modified":1512372448787},{"_id":"themes/spfk/source/background/bg-17.jpg","hash":"6ab5e470059e8ccb0c8bc6786abfb5db7e9a1826","modified":1512372448800},{"_id":"themes/spfk/source/background/bg-20.jpg","hash":"9d428ac435198b2a0107102a2e9ae71e53afe364","modified":1512372448809},{"_id":"themes/spfk/source/background/bg-3.jpg","hash":"f1347eddd07bdae93ab6bebad8627eddc5baeb44","modified":1512372448818},{"_id":"themes/spfk/source/background/bg.jpg","hash":"f0617756387d74f99afe0087c7b93a32f3c7096b","modified":1512372448830},{"_id":"themes/spfk/source/css/_partial/archive.styl","hash":"dc3c5531589dc2858e20d01a0db5d116d6b7f507","modified":1512372448831},{"_id":"themes/spfk/source/css/_partial/article.styl","hash":"ac1648577fb7cec4674dda53a0c02490b43d4d7b","modified":1512372448831},{"_id":"themes/spfk/source/css/_partial/baidushare.styl","hash":"4df95b4bb2d092fb4edacaace6da75b68b76ffc9","modified":1512372448832},{"_id":"themes/spfk/source/css/_partial/footer.styl","hash":"a38dd264db83942da95713b78311e4cca0d99325","modified":1512372448833},{"_id":"themes/spfk/source/css/_partial/header.styl","hash":"67e59feb18eee6026717cb440d86ab9551782628","modified":1512372448833},{"_id":"themes/spfk/source/css/_partial/main.styl","hash":"606c4b47dce561443f2d5151382aea4cfef4989a","modified":1512372448834},{"_id":"themes/spfk/source/css/_partial/highlight.styl","hash":"525dd26d258c566353417fa1b74b9eb57807f898","modified":1512372448833},{"_id":"themes/spfk/source/css/_partial/instagram.styl","hash":"a093443add2f529396d6b6bdef1675bc3acf3958","modified":1512372448834},{"_id":"themes/spfk/source/css/_partial/mobile.styl","hash":"05bec94ed9f9fafa284926a8711aa52de7c56279","modified":1512372448834},{"_id":"themes/spfk/source/css/_partial/mobile-slider.styl","hash":"211a4286f60751c372090fa96f384521e2ce352c","modified":1512372448834},{"_id":"themes/spfk/source/css/_partial/page.styl","hash":"fd30cf933e39ee348e69cc8458455cc4f622b7e9","modified":1512372448835},{"_id":"themes/spfk/source/css/_partial/scroll.styl","hash":"f32deb9192568a2ea789d77a23a08d07f4e57d59","modified":1512372448835},{"_id":"themes/spfk/source/css/_partial/plugins.styl","hash":"98b6db59fbedee6f2a35b76624cce7b5f8ffce94","modified":1512372448835},{"_id":"themes/spfk/source/css/_partial/wheelmenu.styl","hash":"9e57421eab562ea13d0ed2b2e1415eee79fa23d0","modified":1512372448836},{"_id":"themes/spfk/source/css/_partial/tagcloud.styl","hash":"ddcfef2526e6d98f84ae88a87c1ec911649ef791","modified":1512372448836},{"_id":"themes/spfk/source/css/_partial/share.styl","hash":"3cfc59278c21b504f8f633e08767a449e03af8d0","modified":1512372448836},{"_id":"themes/spfk/source/css/_util/grid.styl","hash":"1aa883ab432d9e4139c89dcbd40ae2bd1528d029","modified":1512372448836},{"_id":"themes/spfk/source/css/_util/mixin.styl","hash":"429bad87fc156eacf226c5e35b0eafc277f2504b","modified":1512372448836},{"_id":"themes/spfk/source/css/pace/pace-theme-flash.css","hash":"65ce5d4aac09e570914a075a4fd17941c9a51c47","modified":1512372448837},{"_id":"themes/spfk/source/fancybox/helpers/fancybox_buttons.png","hash":"e385b139516c6813dcd64b8fc431c364ceafe5f3","modified":1512372448840},{"_id":"themes/spfk/source/fancybox/helpers/jquery.fancybox-buttons.css","hash":"6394c48092085788a8c0ef72670b0652006231a1","modified":1512372448840},{"_id":"themes/spfk/source/fancybox/helpers/jquery.fancybox-buttons.js","hash":"4c9c395d705d22af7da06870d18f434e2a2eeaf9","modified":1512372448841},{"_id":"themes/spfk/source/fancybox/helpers/jquery.fancybox-media.js","hash":"e14c32cc6823b81b2f758512f13ed8eb9ef2b454","modified":1512372448841},{"_id":"themes/spfk/source/fancybox/helpers/jquery.fancybox-thumbs.css","hash":"b88b589f5f1aa1b3d87cc7eef34c281ff749b1ae","modified":1512372448841},{"_id":"themes/spfk/source/fancybox/helpers/jquery.fancybox-thumbs.js","hash":"83cdfea43632b613771691a11f56f99d85fb6dbd","modified":1512372448841},{"_id":"themes/spfk/source/font-awesome/css/font-awesome.min.css","hash":"624e4a106f0cf385ff4bd6a65c52cecd84f42ef9","modified":1512372448843},{"_id":"themes/spfk/source/font-awesome/css/font-awesome.css","hash":"6d39a08bc85169eca450978f895f85d5d3451c0a","modified":1512372448843},{"_id":"themes/spfk/source/img/head.jpg","hash":"07047af83673946967a0f46e5586c5470c2df952","modified":1512372448854},{"_id":"themes/spfk/source/js/404/jquery.parallaxify-0.0.2.min.js","hash":"4bbd22670cd359d05e78c186a98288fb21fbf092","modified":1512372448858},{"_id":"themes/spfk/source/background/bg-15.jpg","hash":"ce5760578eb814fe951c56200e81c6f47b6468d4","modified":1512372448797},{"_id":"themes/spfk/source/background/bg-23.jpg","hash":"050937d649be2c02ef8a66a0ffe7d320b236d1b0","modified":1512372448814},{"_id":"themes/spfk/source/background/bg-7.jpg","hash":"acbe0946a47ba16b79f062dbee14c4c9ff9a48da","modified":1512372448826},{"_id":"themes/spfk/source/font-awesome/fonts/FontAwesome.otf","hash":"42c179eef588854b5ec151bcf6a3f58aa8b79b11","modified":1512372448845},{"_id":"themes/spfk/source/font-awesome/fonts/fontawesome-webfont.eot","hash":"986eed8dca049714e43eeebcb3932741a4bec76d","modified":1512372448845},{"_id":"themes/spfk/source/font-awesome/fonts/fontawesome-webfont.woff2","hash":"638c652d623280a58144f93e7b552c66d1667a11","modified":1512372448848},{"_id":"themes/spfk/source/font-awesome/fonts/fontawesome-webfont.woff","hash":"4a313eb93b959cc4154c684b915b0a31ddb68d84","modified":1512372448848},{"_id":"themes/spfk/source/js/404/jquery-2.0.3.min.js","hash":"bbc61d6a6dd66b913c6f237f29475a889fbe3015","modified":1512372448858},{"_id":"themes/spfk/source/background/bg-14.jpg","hash":"2fd6ede2bc9de2d26d910ea4e45d28b2350881eb","modified":1512372448795},{"_id":"themes/spfk/source/background/bg-9.jpg","hash":"df731da0fe0de9a05d99d017e747252c990f972d","modified":1512372448829},{"_id":"themes/spfk/source/css/_partial/customise/blockquote.styl","hash":"edfed5def2ad4f7fdad0eb50b26a51c3b010c2b1","modified":1512372448832},{"_id":"themes/spfk/source/css/_partial/customise/inline-code.styl","hash":"e3d6368de04e83d2baaebf80f7d746272bb22264","modified":1512372448833},{"_id":"themes/spfk/source/css/_partial/customise/code-block.styl","hash":"3571eedc41a7a099fab8cdac5c2143bf10397011","modified":1512372448832},{"_id":"themes/spfk/source/css/_partial/post/youyan.styl","hash":"9076b0d3c231e16b8a1d7f834e62a98d843edd32","modified":1512372448835},{"_id":"themes/spfk/source/font-awesome/fonts/fontawesome-webfont.ttf","hash":"6484f1af6b485d5096b71b344e67f4164c33dd1f","modified":1512372448847},{"_id":"themes/spfk/source/static/api/css/imgshare.css","hash":"7465b359751d368f4a45f7823dc4a1918bba7f5f","modified":1512372448863},{"_id":"themes/spfk/source/static/api/css/select_share.css","hash":"d0259abdb410193cf761e42bffaa51e70327a0cd","modified":1512372448864},{"_id":"themes/spfk/source/static/api/css/like.css","hash":"2024d58206df01b858c38f07957f928b44e14cb3","modified":1512372448863},{"_id":"themes/spfk/source/static/api/css/share_style0_16.css","hash":"090e77e9e6e9b8ee0d73a233cbe46499de935bdd","modified":1512372448865},{"_id":"themes/spfk/source/static/api/css/share_popup.css","hash":"338ba2b30ef8ce0c84cd36b37d7f8482996291dc","modified":1512372448864},{"_id":"themes/spfk/source/static/api/css/share_style0_24.css","hash":"7d1f9f32b80f91001f4f951aa045180cde22d82e","modified":1512372448865},{"_id":"themes/spfk/source/static/api/css/share_style0_32.css","hash":"7c2d12ea532c8a55c102b649bb23ef5bf53b3ed3","modified":1512372448865},{"_id":"themes/spfk/source/static/api/css/share_style1_16.css","hash":"aeb4e9fa96cfa0167481e1f4007079dc3f3c6c27","modified":1512372448865},{"_id":"themes/spfk/source/static/api/css/share_style1_24.css","hash":"3ee5f745c863b4f68299fe5dc125f913ca619c07","modified":1512372448866},{"_id":"themes/spfk/source/static/api/css/share_style2.css","hash":"1ad451187cde8a74843fd398b924ca0ac911e9be","modified":1512372448866},{"_id":"themes/spfk/source/static/api/css/share_style1_32.css","hash":"626d67a4c0bb72a152e90d25dbf281c0c35a2140","modified":1512372448866},{"_id":"themes/spfk/source/static/api/css/share_style2_16.css","hash":"572c8e856988e463eb865f38d33ba003cc20d083","modified":1512372448866},{"_id":"themes/spfk/source/static/api/css/share_style2_24.css","hash":"917d963d3be111064cbb1d122963da91ee3724a0","modified":1512372448866},{"_id":"themes/spfk/source/static/api/css/share_style2_32.css","hash":"3657bbc4b5bbc66ebca4906ee0a1cbf9f98be883","modified":1512372448867},{"_id":"themes/spfk/source/static/api/css/share_style4.css","hash":"0a9e2ed712a5ef5c4699c038cd001a0d688a0fdf","modified":1512372448867},{"_id":"themes/spfk/source/static/api/css/slide_share.css","hash":"3898feaf45559b039f885bee8f9e831f48adb20c","modified":1512372448867},{"_id":"themes/spfk/source/static/api/css/weixin_popup.css","hash":"5e6c5084bfd16051de5776c2e136a5462b08a32c","modified":1512372448868},{"_id":"themes/spfk/source/static/api/js/share.js","hash":"5e71147fe4a93bc99387a5cc1c6894d8b6ab2d5e","modified":1512372448879},{"_id":"themes/spfk/source/background/bg-19.jpg","hash":"d77504412d28432643fc61ed9fd9f7c57096bdd9","modified":1512372448804},{"_id":"themes/spfk/source/background/bg-21.jpg","hash":"7c4c6cd5d75115093fa29bba7372fa198f04b0f1","modified":1512372448811},{"_id":"themes/spfk/source/background/bg-22.jpg","hash":"7a055391fa4188d9c22fdc1d34a10b26e2f0826d","modified":1512372448812},{"_id":"themes/spfk/source/background/bg-24.jpg","hash":"796fa5262d7714e8ce9496a2d03864429cfc5b45","modified":1512372448816},{"_id":"themes/spfk/source/background/bg-6.jpg","hash":"1a4f4c8875b2c56e7992000979a7fca7856eec35","modified":1512372448824},{"_id":"themes/spfk/source/background/bg-8.jpg","hash":"dbecc189e28d00fa23e397eb512e039c2ff03c87","modified":1512372448827},{"_id":"themes/spfk/source/static/api/js/trans/data.js","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1512372448882},{"_id":"themes/spfk/source/static/api/js/trans/logger.js","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1512372448882},{"_id":"themes/spfk/source/static/api/img/share/l8.gif","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1512372448873},{"_id":"themes/spfk/source/background/bg-10.jpg","hash":"dfb23c1c3cf8a3dcb8dc0ea10cf06501c151a2a2","modified":1512372448785},{"_id":"themes/spfk/source/background/bg-12.jpg","hash":"2e0815591309863d8130881681cde32ec4bfebf1","modified":1512372448791},{"_id":"themes/spfk/source/background/bg-18.jpg","hash":"4d61dc41a781a9c1d37c9e5e413ac0d8a9538f6a","modified":1512372448802},{"_id":"themes/spfk/source/img/bg.jpg","hash":"1bcba3c6348e2190a42bff762800bf846cf9239c","modified":1512372448850},{"_id":"themes/spfk/source/static/api/js/component/anticheat.js","hash":"ee6b11a7ed39ae67c1c2aeeef96b4a0f40f8083c","modified":1512372448877},{"_id":"themes/spfk/source/static/api/js/component/animate.js","hash":"0adfc191385eb76dc38452af8307d4e2f28436f9","modified":1512372448877},{"_id":"themes/spfk/source/static/api/js/base/class.js","hash":"9b2e8af7870bd36a7e271c54b726cb79a375d93a","modified":1512372448876},{"_id":"themes/spfk/source/static/api/js/component/pop_base.js","hash":"eae6e120c149a21caa2883c533ccc40bc07fda51","modified":1512372448878},{"_id":"themes/spfk/source/static/api/js/component/comm_tools.js","hash":"3bf6c59fbcf5d77c595e461dac13478d078b2d48","modified":1512372448877},{"_id":"themes/spfk/source/static/api/js/component/partners.js","hash":"a4c275ffb4d3557280211e6bf0573485b397ffd8","modified":1512372448878},{"_id":"themes/spfk/source/static/api/js/component/pop_dialog.js","hash":"4417d2fa9ad8ff6c79a2352ef07e9d10a1313ee0","modified":1512372448878},{"_id":"themes/spfk/source/static/api/js/component/pop_popup.js","hash":"aface5a8c3f71e9e024bf0df5b361ed8f5452f50","modified":1512372448878},{"_id":"themes/spfk/source/static/api/js/share/combine_api.js","hash":"91dc0f3a19bc4f18c44e953e4a22313d9eb4d673","modified":1512372448880},{"_id":"themes/spfk/source/static/api/js/component/qrcode.js","hash":"2e3cc4cc5545556dd97ab899ff32d3ab7ccee808","modified":1512372448879},{"_id":"themes/spfk/source/static/api/js/share/api_base.js","hash":"cbacd664451f80955c2ff4caccd4b9110062c714","modified":1512372448880},{"_id":"themes/spfk/source/static/api/js/component/pop_popup_slide.js","hash":"e2a413a6ae6fa73cd080f5852a06f6c7e3280fd0","modified":1512372448878},{"_id":"themes/spfk/source/static/api/js/share/image_api.js","hash":"43a93415f2a5dd34760042c2bcd9f4692feecb5d","modified":1512372448880},{"_id":"themes/spfk/source/static/api/js/share/like_api.js","hash":"e1a4b51bf73037876517afae9c873c311a70a3ae","modified":1512372448880},{"_id":"themes/spfk/source/static/api/js/share/likeshare.js","hash":"f6815b354bc7120e372bf0af0869996132d9c3db","modified":1512372448881},{"_id":"themes/spfk/source/static/api/js/share/share_api.js","hash":"f7b86d0cc063f692a73a174d04e77cbe3c5facc7","modified":1512372448881},{"_id":"themes/spfk/source/static/api/js/share/select_api.js","hash":"bf259a7912ee6124d741dbb5e45cab40bfa45e90","modified":1512372448881},{"_id":"themes/spfk/source/static/api/js/share/slide_api.js","hash":"c317e3f7fec13d89178e475f26a689bb94e5aa76","modified":1512372448881},{"_id":"themes/spfk/source/static/api/js/conf/const.js","hash":"44fb8861c5723e508ebaebfeaeafbaebbc2733ea","modified":1512372448879},{"_id":"themes/spfk/source/static/api/js/conf/define.js","hash":"734084a8d672deb373b9ad2ebf82621b9f76cfea","modified":1512372448879},{"_id":"themes/spfk/source/static/api/js/trans/trans.js","hash":"bbcbd24ac4a6613a2c633766de78b2f9dd988808","modified":1512372448882},{"_id":"themes/spfk/source/static/api/js/trans/trans_bdxc.js","hash":"db1ca49efafb70eca0e830a513367c0275368ff1","modified":1512372448883},{"_id":"themes/spfk/source/static/api/js/trans/trans_bdysc.js","hash":"7403d0215bb28190bd0cfd5480469f13dd27f88b","modified":1512372448883},{"_id":"themes/spfk/source/static/api/js/trans/trans_weixin.js","hash":"e68e9bc91ee6fbcd64ac788463870f01602a8562","modified":1512372448883},{"_id":"themes/spfk/source/static/api/js/start/router.js","hash":"8566cdaed64760ea765d0542a337ba7acc5a447b","modified":1512372448882},{"_id":"themes/spfk/source/static/api/js/view/image_view.js","hash":"bb66297a5bd2c7dd931b9145f5d4a616876f3373","modified":1512372448883},{"_id":"themes/spfk/source/static/api/js/view/like_view.js","hash":"b2a9e51f2c35ea58d5d2cc036c88895e34fb653e","modified":1512372448884},{"_id":"themes/spfk/source/static/api/js/view/select_view.js","hash":"2611efec1d31d85609feea0c57e14d3f817a6220","modified":1512372448884},{"_id":"themes/spfk/source/static/api/js/view/share_view.js","hash":"f445ce9cbbcf887da5e248b1cfadc03ab7df76d0","modified":1512372448885},{"_id":"themes/spfk/source/static/api/js/view/view_base.js","hash":"b3fd7dafde05d63af3dfe9e0a59f9367f81402c5","modified":1512372448885},{"_id":"themes/spfk/source/static/api/js/view/slide_view.js","hash":"973ded5cd15eb119e79ffd9326af3a44167b26bd","modified":1512372448885},{"_id":"themes/spfk/source/static/api/img/share/icons_0_16.png","hash":"0eec1e81a04664b2032bd389513349e9bd5d5b0f","modified":1512372448868},{"_id":"themes/spfk/source/static/api/img/share/icons_0_24.png","hash":"a89223f9714c8c4fa169430a327963ca6a1c9a6e","modified":1512372448868},{"_id":"themes/spfk/source/static/api/img/share/icons_0_32.png","hash":"c20521634fdacef39631031671528713e6ba6081","modified":1512372448869},{"_id":"themes/spfk/source/static/api/img/share/icons_1_16.png","hash":"3793c3265429ab7b830bfaf18322259cd0b4c4ef","modified":1512372448869},{"_id":"themes/spfk/source/static/api/img/share/icons_1_24.png","hash":"9f1d472095dbe138ef7aff069b1d18cae6ffa942","modified":1512372448870},{"_id":"themes/spfk/source/static/api/img/share/icons_2_24.png","hash":"e47fb87c533f2be89f22901f0864d9b5ef83412d","modified":1512372448871},{"_id":"themes/spfk/source/static/api/img/share/icons_1_32.png","hash":"09825de5f238c97e4374d545961d6e0d5bbfb3e2","modified":1512372448870},{"_id":"themes/spfk/source/static/api/img/share/icons_2_16.png","hash":"07340442cb61aabb419dd226f4bfb206a7577f52","modified":1512372448870},{"_id":"themes/spfk/source/static/api/img/share/icons_2_32.png","hash":"deba62865245a6b5aafa446787d72165c703b943","modified":1512372448871},{"_id":"themes/spfk/source/static/api/img/share/l0.gif","hash":"738b92632b0a9789a9eb568b8d101eb64f55f6e0","modified":1512372448871},{"_id":"themes/spfk/source/static/api/img/share/l1.gif","hash":"70e1932ca7a622ed3322b683eceb7a590860a55e","modified":1512372448871},{"_id":"themes/spfk/source/static/api/img/share/l3.gif","hash":"26c0dd37d98df63abb9d3d83e01bb47c34ee3f0f","modified":1512372448872},{"_id":"themes/spfk/source/static/api/img/share/l2.gif","hash":"e6a5d6104c226a686d48759e0268e09d762e242e","modified":1512372448872},{"_id":"themes/spfk/source/static/api/img/share/l4.gif","hash":"8a9c3cf99766d3f07a9c480cfdffdc3197b9a6b9","modified":1512372448872},{"_id":"themes/spfk/source/static/api/img/share/l5.gif","hash":"148706f56b8ef4fd9d8483d0ac3a6730e72fc0ad","modified":1512372448872},{"_id":"themes/spfk/source/static/api/img/share/l6.gif","hash":"f4b8e3188f744f13aca46b27b451d55d9e209c48","modified":1512372448872},{"_id":"themes/spfk/source/static/api/img/share/l7.gif","hash":"e4f7e5e56c8f4eb026b5cb0affe3bd69c31af261","modified":1512372448873},{"_id":"themes/spfk/source/static/api/img/share/pop_c.gif","hash":"e8b9ece6ddaa47ccb2c15f2396d1cd3020740603","modified":1512372448873},{"_id":"themes/spfk/source/static/api/img/share/r1.gif","hash":"96064d132ee2477c0e444c2e18162f9d1dc9e9c2","modified":1512372448873},{"_id":"themes/spfk/source/static/api/img/share/r0.gif","hash":"882f255fbafc0136a3917c1dd40db88879c1b1c1","modified":1512372448873},{"_id":"themes/spfk/source/static/api/img/share/r3.gif","hash":"ecdd21f1457be54afc96e2d005524eef93d7bf85","modified":1512372448874},{"_id":"themes/spfk/source/static/api/img/share/r2.gif","hash":"67c84a67be3b039892e9cb8c7c29ed29813bf60f","modified":1512372448873},{"_id":"themes/spfk/source/static/api/img/share/r4.gif","hash":"517435e69a2215a0f003e75a4861154ca963c30e","modified":1512372448874},{"_id":"themes/spfk/source/static/api/img/share/r5.gif","hash":"e61b32d1830390303927bdab21823959f8dc7023","modified":1512372448874},{"_id":"themes/spfk/source/static/api/img/share/r6.gif","hash":"4bc01e08ef0015fddf5b8c7257c094ec584ca3ee","modified":1512372448874},{"_id":"themes/spfk/source/static/api/img/share/r7.gif","hash":"3c596c924910c93cf3e37cc1b2870dbf271151e2","modified":1512372448874},{"_id":"themes/spfk/source/static/api/img/share/r8.gif","hash":"c068ece54a72a3f2428d4f1b5ca7c176f027dd4e","modified":1512372448875},{"_id":"themes/spfk/source/static/api/img/share/sc.png","hash":"e5a2ca56973a3d6608e7e3a48ebd9fa5ebda9991","modified":1512372448875},{"_id":"themes/spfk/source/static/api/img/share/selectshare_close.png","hash":"6f3666278268890a153c85fb9f04ac848c442561","modified":1512372448875},{"_id":"themes/spfk/source/static/api/img/share/share-search-icon.png","hash":"0629677a7eb5aa3e8bab3faa310c6d8c467a3287","modified":1512372448875},{"_id":"themes/spfk/source/background/bg-13.jpg","hash":"d7237c6014e28c90f53287f48f718d0759af104b","modified":1512372448793},{"_id":"themes/spfk/source/background/bg-111.jpg","hash":"e1631b47fede8da6c03582ceed648668547c4f09","modified":1512372448789},{"_id":"themes/spfk/source/background/bg-16.jpg","hash":"d1a34d0c4b69262169b543922e4aeb4dae997ad8","modified":1512372448799},{"_id":"themes/spfk/source/font-awesome/fonts/fontawesome-webfont.svg","hash":"550ef5c1253c8376f2ead32b654eb58d3c106ca3","modified":1512372448847},{"_id":"themes/spfk/source/static/api/js/base/tangram.js","hash":"f3ecbed4c05dba6a28df137e9a4e66c9ccfbd220","modified":1512372448877},{"_id":"themes/spfk/source/background/bg-2.jpg","hash":"40a6db13e9c461f80e2c4efee7fb63bbd594e751","modified":1512372448808},{"_id":"themes/spfk/source/background/bg-5.jpg","hash":"2d5da2a209732cce0abf2ca234c0bef0516b65ff","modified":1512372448822},{"_id":"public/about/index.html","hash":"fa37909bfcbe2d11fb59ca65223aa5d0f7c4efac","modified":1520997176189},{"_id":"public/2018/03/14/iPXE-WinPE/index.html","hash":"ecc31df9a3cbfd82c1f750fcecfe2db991997871","modified":1520998157755},{"_id":"public/2018/03/13/iPXE-NetworkBoot/index.html","hash":"1fad32756017e41dfb2a4de47657d6388e4cc1f7","modified":1520997177180},{"_id":"public/2018/03/05/ubuntu-kvm/index.html","hash":"2a0eab4ef89c2681a053db53a58132d686674308","modified":1520997177180},{"_id":"public/2018/03/08/kvm-win7-install/index.html","hash":"ff2c1fb55477120f49658897e40ba8d9ad189b41","modified":1520997177181},{"_id":"public/2018/03/08/web-vnc/index.html","hash":"609ca5b0e4727a5f69430b02e3637d2d5eb4cb93","modified":1520997177181},{"_id":"public/2018/03/08/cookie-property/index.html","hash":"3c642effe80900b95f28b6fd09e8b70b985c7ef6","modified":1520997177181},{"_id":"public/2017/12/13/nginx-location-rule/index.html","hash":"05bb78f5a5e2562f2b3d5a3d3c5709165e420445","modified":1520997177181},{"_id":"public/2017/11/28/python-utc-local/index.html","hash":"766434e8efbc7434ccc2484a7f44ac00ab7a1356","modified":1520997177181},{"_id":"public/2017/11/30/python-module-atexit/index.html","hash":"a56691c94a4c02d82d54684ffc63b0e142a3205b","modified":1520997177181},{"_id":"public/2017/12/04/install-pcapy/index.html","hash":"2497a688909603016d0325a1f155ee7e129fa186","modified":1520997177181},{"_id":"public/2017/12/04/python-metaclass/index.html","hash":"63e5510928b3eb7d3b78f4aea1c5ae04fcea5b64","modified":1520997177181},{"_id":"public/2017/11/23/Python-Closure/index.html","hash":"bb5a5a67d9b39280b3c5e7dc46a4411d7793bb94","modified":1520997177181},{"_id":"public/2017/11/22/Ubuntu-17-10-Systemd-Networkd/index.html","hash":"6bd54c6ca2156b9884e43b3189cd4aa6ef3863a0","modified":1520997177181},{"_id":"public/2017/11/17/DictInListSorted/index.html","hash":"99a6221601544f22f8f44ebc6b8a3ba8d6c7566b","modified":1520997177181},{"_id":"public/2017/10/19/UnixSocket-echodemo/index.html","hash":"36d9c32ac8e915b636676e0c7147ff61744801e2","modified":1520997177181},{"_id":"public/2017/10/18/WindowsTasklistFilter/index.html","hash":"d72e5a04a12b3479cf1b2836cb701a2ead311425","modified":1520997177181},{"_id":"public/2017/10/19/PythonSingleton/index.html","hash":"ff16ead95cabf84f20feccdbb10ce54fc9fd9388","modified":1520997177181},{"_id":"public/2017/10/19/PythonEpoll/index.html","hash":"733c089ad91a483b12a3898a217afcbf345a3dc9","modified":1520997177181},{"_id":"public/2017/10/12/DjangoQuery/index.html","hash":"5beb27412b23341ae9b12104177901bb7528ef29","modified":1520997177181},{"_id":"public/2017/10/12/DjangowithPostgres/index.html","hash":"8d952b434d7b3bd7c3a4a0429f9f55751f0d078d","modified":1520997177181},{"_id":"public/2017/10/12/python-kwargs/index.html","hash":"abcec3a26958008933fd24b6925a70cf115a4e7b","modified":1520997177181},{"_id":"public/2017/10/12/Ubuntu-install-Postgres/index.html","hash":"ffcc9bf967f47483ba2c94d07434e2f13032e1c9","modified":1520997177181},{"_id":"public/2017/10/12/Django-Signal/index.html","hash":"ee45093be447fa55af25eff2ed77351ad4a2283b","modified":1520997177181},{"_id":"public/2017/10/11/DjangoRESTframework-SchemaClientLib/index.html","hash":"b13e2ecfe982794db5bf1c883575b43382ed2eb8","modified":1520997177181},{"_id":"public/2017/10/11/DjangoRESTframework-ViewsetsRouters/index.html","hash":"f31b0fa5821532966ba4adddccfc75e70dbdb029","modified":1520997177182},{"_id":"public/2017/10/11/DjangoRESTframework-RelationshipsHyperlinkedAPI/index.html","hash":"e902d7bd2ce9f3a3c9ddb8eef32df54b8ce630e4","modified":1520997177182},{"_id":"public/2017/10/11/DjangoRESTframework-AuthenticationPermissions/index.html","hash":"d7f9287510372541a3b41b18ed720c05322211b3","modified":1520997177182},{"_id":"public/2017/10/10/DjangoRESTframework-class-based-view/index.html","hash":"17059ee36e783f27f47c137ac4fdfbcb86b6c8f6","modified":1520997177182},{"_id":"public/2017/10/10/DjangoRESTframework-ReqAndRes/index.html","hash":"3b00e044b2669943e4d088eccbb4590e191bdbd5","modified":1520997177182},{"_id":"public/2017/10/10/DjangoRESTframework-quickstart/index.html","hash":"4d75bea466252616c3bb57d6cc21f1e9cfa9f6e7","modified":1520997177182},{"_id":"public/2017/10/10/DjangoRESTframework-serializetion/index.html","hash":"00667cfa1fb11cf7471c0c725575e63ca0cdeb91","modified":1520997177182},{"_id":"public/2017/10/02/Django-helloworld/index.html","hash":"d173278ef0d276de7b336854f90ec61d25cd797b","modified":1520997177182},{"_id":"public/2017/10/02/Django-install/index.html","hash":"1ea8901bb55311540e9fc0b7f3966a1b6f8c7a30","modified":1520997177182},{"_id":"public/2017/09/28/python-note-repr/index.html","hash":"19ab95eab4c32cb8bb30caf3187fb9ea51a0b4f9","modified":1520997177182},{"_id":"public/2017/09/19/TCP-Echo-Demo/index.html","hash":"42bf3d5d3319038f3f895e3c6e2b5fb07c54b379","modified":1520997177182},{"_id":"public/2017/09/10/PDF-watermask/index.html","hash":"9854d48a6e769b80955f2a6a6777786c24b5ef36","modified":1520997177182},{"_id":"public/2017/09/09/OpenWrt-HelloWorl/index.html","hash":"17a2b6f8727bed9d54ee79a6d9e33d5c61f2b6f2","modified":1520997177182},{"_id":"public/2017/06/19/ChangeUbuntuPassWd/index.html","hash":"364aeaf20685245f0a38ec8cd528cd9291eaf65e","modified":1520997177182},{"_id":"public/2017/06/02/LoginNewTP/index.html","hash":"1c8cb09577a67cedf7260acadce8cc222048445e","modified":1520997177183},{"_id":"public/2017/06/02/DokerStudy-install/index.html","hash":"2b435c7bd7a4bf62a26fee807d9cb8a934c664e1","modified":1520997177183},{"_id":"public/2017/06/02/CompileNgrok/index.html","hash":"1f6482aae3295fe84d93976877ce4fc814708685","modified":1520997177183},{"_id":"public/2017/05/31/CompileOpenJDK/index.html","hash":"781afe86fbf976f292841cbe77b1ce591be7f3c3","modified":1520997177183},{"_id":"public/2017/05/23/Linux-File-Priveleges/index.html","hash":"27a39967e4b93d3023fad560cc21d97cfbc0ae96","modified":1520997177183},{"_id":"public/2017/05/23/Linux-Add-Swap/index.html","hash":"9d6eecefc8f246b83af044ea5b32c2d299030b6c","modified":1520997177183},{"_id":"public/2017/05/17/BubbleSort/index.html","hash":"7ab7f387bd4eb616a9eddfd2b2200facc5cefa19","modified":1520997177183},{"_id":"public/2017/05/22/SSH-LOG-USER/index.html","hash":"eafe832a055e691855dfe1ca6f887305eaa0ce28","modified":1520997177183},{"_id":"public/2017/05/17/InsertSort/index.html","hash":"69163b04659f808544621bdf5b32f9ce8b137a86","modified":1520997177183},{"_id":"public/2017/03/11/MariaDB-Create-Remote/index.html","hash":"46c3b3777c437576d4d7136bf7d2aad64ae1c3fd","modified":1520997177183},{"_id":"public/2017/03/11/Centos7-lnmp/index.html","hash":"58a84fa04d12890ab0b9369a872b7418662f13b8","modified":1520997177183},{"_id":"public/2017/05/12/Factory-Notes/index.html","hash":"9fb88629780af403e44e3fcd04093f80fca01ed4","modified":1520997177183},{"_id":"public/2017/05/12/Decorator-Notes/index.html","hash":"6fa0326bcee47ad783de45de18206917964726cb","modified":1520997177183},{"_id":"public/2016/12/16/Observer-Notes/index.html","hash":"3135f2e5baf90be0cb93d2b26f41f118b4fbf79a","modified":1520997177183},{"_id":"public/2016/12/15/tornado-requesthandler/index.html","hash":"dbba6cab3ad8bedb85727f377a9c42d27a8d1d59","modified":1520997177183},{"_id":"public/2016/12/15/nginx-diable-domain/index.html","hash":"2aa8d6170bd45f54806eb05df249375603cd314a","modified":1520997177183},{"_id":"public/2016/12/15/tornado-hello-world/index.html","hash":"a69595b08d353bf4e56936aefafa99d1dccf5ab2","modified":1520997177183},{"_id":"public/2016/12/15/Let-s-Encrypt/index.html","hash":"f71c781ada56c74d87fd96726e0bd2590b0b3954","modified":1520997177183},{"_id":"public/2016/12/04/Github-Webhook/index.html","hash":"32a2fbc7df9ca803ab87828582089496af0bf74e","modified":1520997177183},{"_id":"public/2016/12/04/PIL-Grab/index.html","hash":"76aeef3339c0fe423dee0c228762a804eb81cab2","modified":1520997177183},{"_id":"public/2016/11/30/Github-Add-SSHKEY/index.html","hash":"c889dd091a1bced3ed8ab5f7b40ba22a21a5c09c","modified":1520997177183},{"_id":"public/2016/11/29/Learn_VIM/index.html","hash":"30a2c0153eabe933d7159b042da8b2a98713303e","modified":1520997177183},{"_id":"public/2016/11/29/C-Helloworld/index.html","hash":"270fe107b95a6f0b853e52927d7dd89b9bd9c6f9","modified":1520997177183},{"_id":"public/2016/11/28/OpenWRT-BuildEnvironMent/index.html","hash":"951d460949f74964b125f48a473b20f37ce1d3e6","modified":1520997177183},{"_id":"public/2016/11/28/Pwnable-collision/index.html","hash":"0116d49193383abd06bfd2e1bd4d64d8610262f9","modified":1520997177183},{"_id":"public/2016/11/20/GDB-peda/index.html","hash":"c405bc95a5a213eba0ab22f0846528a32892b1c0","modified":1520997177183},{"_id":"public/2016/11/27/Pwnable-fd/index.html","hash":"bba70bbf363b8bdfc9d050443016c5deaeed00bd","modified":1520997177184},{"_id":"public/2016/07/22/Learn-Markdown/index.html","hash":"c0615a864c08a54b12c49bf94421ea56ea36eb41","modified":1520997177184},{"_id":"public/2016/07/21/hello-world/index.html","hash":"192d8b26fad2dd0c5dbd8d971586f7a54cf87f02","modified":1520997177184},{"_id":"public/categories/CTF/index.html","hash":"74a56ac8f987c28c07cd9225eb8fe37ad3405c05","modified":1520997177184},{"_id":"public/categories/Program/index.html","hash":"837f8f0501b962f01a83fd93457db41321d92777","modified":1520997177184},{"_id":"public/categories/Program/page/2/index.html","hash":"5a06371c206e3b93908537ba15075aa2fba644e5","modified":1520997177184},{"_id":"public/categories/Linux/index.html","hash":"d25d28352c32f615447e3f8404e45bd500f39d4a","modified":1520997177184},{"_id":"public/categories/Program/page/4/index.html","hash":"e4b10d4bc89646a235fadc2bd1711ad1041711e3","modified":1520997177184},{"_id":"public/categories/Linux/page/2/index.html","hash":"0e037d60cac7ae878ca1ab3c810a6c19e596ae3e","modified":1520997177184},{"_id":"public/categories/Program/page/3/index.html","hash":"e539f470470d65b3a0e628b95173720d978cdcfd","modified":1520997177184},{"_id":"public/categories/Linux/page/3/index.html","hash":"f2857749e61a0efc696a74be643d5528cd075431","modified":1520997177184},{"_id":"public/index.html","hash":"4c4fc8a34fc21ccb7eef10ace25290731a74aee0","modified":1520997177184},{"_id":"public/categories/Windows/index.html","hash":"7c4947ef9072c6f8202997c25739637ca88ab7ec","modified":1520997177184},{"_id":"public/page/2/index.html","hash":"e80412755121e54e5f8353d93c6a60dabd03ba9a","modified":1520997177184},{"_id":"public/page/5/index.html","hash":"58c82d0a3d0d06fbceb63497345a9a5b2f02755f","modified":1520997177184},{"_id":"public/page/3/index.html","hash":"4b22e782f4fc5f9e90c21a0d3a7c735790768f18","modified":1520997177185},{"_id":"public/page/4/index.html","hash":"a933a16e995ad24702baa252aa71d453c5a668f0","modified":1520997177185},{"_id":"public/page/6/index.html","hash":"40556641380b8504138aa930865ec822457c98cf","modified":1520997177185},{"_id":"public/page/7/index.html","hash":"79a10a4332ecca82c457a2f0d24da7050f6ce42c","modified":1520997177185},{"_id":"public/archives/index.html","hash":"1bef04ed42afbb8192081e4c669cd7e9e2f68549","modified":1520997177185},{"_id":"public/archives/page/2/index.html","hash":"82dcdca36d16c489fc1f8bce731e431af7e6eac5","modified":1520997177186},{"_id":"public/archives/page/3/index.html","hash":"ff7900f8b3b20fc17517f14feacc60fd8d6c4831","modified":1520997177186},{"_id":"public/archives/page/4/index.html","hash":"eb316c98c98d76d36ea2d77b70b3ff255a60612b","modified":1520997177186},{"_id":"public/archives/page/5/index.html","hash":"cc3203c12bf55e8d748bf7bab6483e7b8af2a58c","modified":1520997177186},{"_id":"public/archives/page/6/index.html","hash":"592ab93d2ff87a61573134c57d8ca7f2af82a55f","modified":1520997177186},{"_id":"public/archives/page/7/index.html","hash":"dce15168940890a922009c87745d221665613a4a","modified":1520997177186},{"_id":"public/archives/2016/page/2/index.html","hash":"1ec7f93049c7cdff1ebcd81a3a135b6a16c83de5","modified":1520997177187},{"_id":"public/archives/2016/11/index.html","hash":"d7670e62f2c74cacef1116e9c3c826816cbfa679","modified":1520997177187},{"_id":"public/archives/2016/index.html","hash":"e930141c15426ccb689e0fa254b8a9a5f04d4174","modified":1520997177187},{"_id":"public/archives/2016/07/index.html","hash":"becd7587a64574b9a5b3b653bf43632248047bb1","modified":1520997177187},{"_id":"public/archives/2016/12/index.html","hash":"02e5fa76b8f4a4bcc7fb1b33bf1c0ae324b782d1","modified":1520997177187},{"_id":"public/archives/2017/page/4/index.html","hash":"04270c71b724b360ec11429a5f9421f53385c186","modified":1520997177187},{"_id":"public/archives/2017/page/2/index.html","hash":"edaa6ef42d4b087d4423f23213984a445d4e5d23","modified":1520997177187},{"_id":"public/archives/2017/index.html","hash":"12f43ec712e6a84f672f49c883760fd84f5e6b00","modified":1520997177187},{"_id":"public/archives/2017/page/3/index.html","hash":"8cb16dae2373c4f7a87f550ebe3f4fa9c9ba4abb","modified":1520997177187},{"_id":"public/archives/2017/03/index.html","hash":"0668a99f61703f0a21fbd8838b299d75f1e05b82","modified":1520997177188},{"_id":"public/archives/2017/page/5/index.html","hash":"a540c2137f44e4893c1be3c1a5ef8d675b557585","modified":1520997177188},{"_id":"public/archives/2017/05/index.html","hash":"33a42fb2afc465655c01150e8956f67686028fc9","modified":1520997177188},{"_id":"public/archives/2017/06/index.html","hash":"9450ab52e9f6ff0408bb035932cba87c7e5f9706","modified":1520997177188},{"_id":"public/archives/2017/09/index.html","hash":"8a688c57e6d7bc5ded197617f47920f09ff280dd","modified":1520997177188},{"_id":"public/archives/2017/10/index.html","hash":"14aabfa15c16480c2621f358048257f944579927","modified":1520997177188},{"_id":"public/archives/2018/index.html","hash":"9ffe5f99e3a46b7583a261cd28e8eba735ec110c","modified":1520997177188},{"_id":"public/archives/2018/03/index.html","hash":"1194425f3e7eb6fff35cf21bf70d51a5da7798c4","modified":1520997177188},{"_id":"public/archives/2017/10/page/2/index.html","hash":"643a0474a130bb659f0d0c143c48f08b9bd9713a","modified":1520997177188},{"_id":"public/archives/2017/12/index.html","hash":"e149175f0e36908ed730b05a712f3371a2d891af","modified":1520997177189},{"_id":"public/archives/2017/11/index.html","hash":"1c9f5c1de1b8c4fcce8fdbce71e3533bf25eb718","modified":1520997177189},{"_id":"public/tags/冒泡排序/index.html","hash":"40bf99e5ede7c148d1ee6f6f67bcc618ece1c44c","modified":1520997177189},{"_id":"public/tags/排序/index.html","hash":"af5597ef4108b955d03645483d522dcb550dc4f2","modified":1520997177189},{"_id":"public/tags/C/index.html","hash":"14b455ac992b3327a3c597708664fac447d8bbfd","modified":1520997177189},{"_id":"public/tags/算法/index.html","hash":"2728225efcfef4aafa0a004068ce716501472eda","modified":1520997177189},{"_id":"public/tags/CentOS/index.html","hash":"aecbf294d32375c2597c0b7e1d1d8c78c17b5c8c","modified":1520997177189},{"_id":"public/tags/Helloworld/index.html","hash":"bdaaa74fd020f9f27242eb45ca874ded1cacfb83","modified":1520997177189},{"_id":"public/tags/PHP/index.html","hash":"4267cbb8badf101364a8f8f7340da623dc5955ea","modified":1520997177189},{"_id":"public/tags/Nignx/index.html","hash":"aa77a6ada1af358d9d9130601538b539b72079eb","modified":1520997177189},{"_id":"public/tags/MariaDB/index.html","hash":"025df3c9d45f4bdc327f671f8f37b1db30ce495f","modified":1520997177189},{"_id":"public/tags/LNMP/index.html","hash":"51367f66664fc33d6782c02ce10d626abbfdef10","modified":1520997177190},{"_id":"public/tags/liux/index.html","hash":"9fab80644398b0b48f952426ec6bbe4ec6a163a1","modified":1520997177190},{"_id":"public/tags/转发/index.html","hash":"edd3769a9c61b263cbb4ec1b6f09bcb9f4265707","modified":1520997177190},{"_id":"public/tags/java/index.html","hash":"83d8c1d1cda28eaf2a28ea345781abf7972344c0","modified":1520997177190},{"_id":"public/tags/设计模式/index.html","hash":"e3ea83bf8c5055f554e39cbc13db0fb365dfdba3","modified":1520997177190},{"_id":"public/tags/装饰者模式/index.html","hash":"5840da4f42b9d1ffa59ae4949e5bfdfe0b20ac78","modified":1520997177190},{"_id":"public/tags/python/index.html","hash":"dd5147f2fb3374e3ed87dea7cae32aa86f22d725","modified":1520997177190},{"_id":"public/tags/python-web-Django/index.html","hash":"344f71e364bcb7a3166e7796fd7b28e9e76a3bce","modified":1520997177190},{"_id":"public/tags/python/page/2/index.html","hash":"ca49ed2b791a4f5785d45d3fb3b297c226aec768","modified":1520997177190},{"_id":"public/tags/djangorestframework/index.html","hash":"8e6819893fffdb291c6fe63c786c46721e55ae47","modified":1520997177190},{"_id":"public/tags/django/index.html","hash":"c64aeea71c3fe93139e515027f8f738ad5ab864e","modified":1520997177190},{"_id":"public/tags/Django/index.html","hash":"21ca22bf758483f2d1f6ebfc4ea1463d60aba1e5","modified":1520997177190},{"_id":"public/tags/Django-djangorestframework/index.html","hash":"bb2ec2898ab29045157b102e4fb16fc00e5dc0b2","modified":1520997177190},{"_id":"public/tags/docker/index.html","hash":"b5b2b32455f560dfb962474062b519786535993c","modified":1520997177191},{"_id":"public/tags/python-djangorestframework/index.html","hash":"e0c62070e70142bd54bab2bb2359e96fd641fc6a","modified":1520997177191},{"_id":"public/tags/工厂模式/index.html","hash":"89604cef90c7e8a6f49a0ef993e72e2c28b6bcb5","modified":1520997177191},{"_id":"public/tags/GDB/index.html","hash":"b3e11d802807771ba5e4f91506b84e9d8d4e1a24","modified":1520997177191},{"_id":"public/tags/Debugger/index.html","hash":"c40627da8b2fb1de3324b11175179907a75a12cf","modified":1520997177191},{"_id":"public/tags/Linux/index.html","hash":"6c3a865aecfac1d15dac69478f620a6c23f02e19","modified":1520997177191},{"_id":"public/tags/Github/index.html","hash":"d956505f2645ec05a1dcedbed14c133ddf46e0ff","modified":1520997177191},{"_id":"public/tags/Webhook/index.html","hash":"836d5994cbc0240f353f77a200795774ff1bf7af","modified":1520997177191},{"_id":"public/tags/peda/index.html","hash":"9a274793e7f7a294669071a10712cc3506559222","modified":1520997177191},{"_id":"public/tags/github/index.html","hash":"58b68c781080d94462acaf2b5ae84d02efaad486","modified":1520997177191},{"_id":"public/tags/自动部署/index.html","hash":"c936dabb8f2d66b98e053e3bb1b6828f9fc49014","modified":1520997177191},{"_id":"public/tags/code-deploy/index.html","hash":"797965e69cd1599373c71ded622eaddd5f4a3d84","modified":1520997177191},{"_id":"public/tags/VIM/index.html","hash":"4846e759f8491aebdabd59dcf90962271515ad19","modified":1520997177191},{"_id":"public/tags/Edtor/index.html","hash":"90c8237a9312f01e395f5bc5a0e42f59e2914ccb","modified":1520997177191},{"_id":"public/tags/ssh-key/index.html","hash":"e234ab030fe460c19b64ac16328ca9849ced8106","modified":1520997177191},{"_id":"public/tags/markdown/index.html","hash":"87b2cc63ecd47935580290d5c05786b5659f392f","modified":1520997177192},{"_id":"public/tags/插入排序/index.html","hash":"67626721b89d35752d623789cfa8ae68fdddc302","modified":1520997177192},{"_id":"public/tags/入坑/index.html","hash":"3b79f7f7ab9322db7eb2f5bf41b3400d0fd67f55","modified":1520997177192},{"_id":"public/tags/https/index.html","hash":"c33bb3f3d8f0827eccbe0e566b8366260faf774d","modified":1520997177192},{"_id":"public/tags/nginx/index.html","hash":"5ccd01dc959728d1b930fd12d58102e01fedfcf8","modified":1520997177192},{"_id":"public/tags/router/index.html","hash":"a400c947f17cc6b1b8a939f89f63c16a8073867f","modified":1520997177192},{"_id":"public/tags/文件权限/index.html","hash":"d1a230899a308cce993fb3fd0af567fac12c317d","modified":1520997177192},{"_id":"public/tags/SWAP/index.html","hash":"4f9f2af719e28fbd0677cb2d6870aee20150957e","modified":1520997177192},{"_id":"public/tags/学习笔记/index.html","hash":"03ba6d19f818294766a6b2917eca4b1606fdc510","modified":1520997177192},{"_id":"public/tags/Remote/index.html","hash":"a025634f2573d87f520f6acee7981c6f2c6422e4","modified":1520997177192},{"_id":"public/tags/New-DB/index.html","hash":"0e161a41a6c9117f9ad432579dc0c21d2d2ae898","modified":1520997177192},{"_id":"public/tags/openwrt/index.html","hash":"8630210564fea023510969ddf330ecff6ab6f040","modified":1520997177192},{"_id":"public/tags/观察者模式/index.html","hash":"823c9d397af6f9d84b79ccb000c3ca17d0086085","modified":1520997177192},{"_id":"public/tags/OpenWrt/index.html","hash":"0da5c0e26c21a5ec1acc4892cbe76e9346699a56","modified":1520997177192},{"_id":"public/tags/enviroment/index.html","hash":"7572c4e67c741609564106ea4903652dedf99962","modified":1520997177192},{"_id":"public/tags/C-pdf/index.html","hash":"701b78ca7185db1723515e63bed1b4d9f12aa6d3","modified":1520997177192},{"_id":"public/tags/PIL/index.html","hash":"24ef2e3f21c7e46f3b7ec1d3f79302ec4b055b3a","modified":1520997177192},{"_id":"public/tags/CTF/index.html","hash":"bf1dbd646af63a437508b7da9f210a28f9a21b76","modified":1520997177192},{"_id":"public/tags/pwnable/index.html","hash":"59a4e3b053ce7e218daec0dac127e8420ba94a3c","modified":1520997177192},{"_id":"public/tags/PWN/index.html","hash":"db09997f5607cc8355856201dbfa69ae91e02af7","modified":1520997177192},{"_id":"public/tags/暴力破解/index.html","hash":"fc705afc8feb81ce76e48fc84330e174406b1967","modified":1520997177192},{"_id":"public/tags/ssh/index.html","hash":"fbc869d860c1a3177e48fc97d4c843869dfad748","modified":1520997177192},{"_id":"public/tags/linux/index.html","hash":"c5218f4f739edb0e56051ec5fd2e9053992d8f1d","modified":1520997177192},{"_id":"public/tags/记录/index.html","hash":"e5a259f5f6f9089d3813f9fb0b1ff603bf07c1af","modified":1520997177192},{"_id":"public/tags/postgres/index.html","hash":"a70d0780e3a796ead3c4ad553b61ef33b351602f","modified":1520997177192},{"_id":"public/tags/tcp-program/index.html","hash":"aa9b79ea18a5452becaa463234302531c5c280fd","modified":1520997177192},{"_id":"public/tags/cmd/index.html","hash":"d01bbe48aafde5b5ec68508e798796f6e697f456","modified":1520997177192},{"_id":"public/tags/web-cookie/index.html","hash":"128455b097b374eb2426b4a0f42b0692ebcf53d7","modified":1520997177193},{"_id":"public/tags/python-socket/index.html","hash":"2409404788e8a1fbf4ecd7505c82238b4ae53797","modified":1520997177193},{"_id":"public/tags/hello-hexo/index.html","hash":"6b553cacd6861f66f08514affabcd5f2448ca1ae","modified":1520997177193},{"_id":"public/tags/kvm/index.html","hash":"503985642c5512e64f0e8f01f05fb66a62393d09","modified":1520997177193},{"_id":"public/tags/domain/index.html","hash":"0893559fe5b46efae8e6a73ef326a4db557ad1a7","modified":1520997177193},{"_id":"public/tags/python-note/index.html","hash":"390e680d6b6d56b7e7caafee6259d42466dc9aab","modified":1520997177193},{"_id":"public/tags/web/index.html","hash":"2b64469250e9ad0a6d86be7a393e114d8b869d9b","modified":1520997177193},{"_id":"public/tags/tornado/index.html","hash":"91d6df0bb121b026f0824525d71cfa886b78ccb7","modified":1520997177193},{"_id":"public/tags/kvm-noVNC/index.html","hash":"384e91304c2d760eb642effccb0f2a41d3e9ba9a","modified":1520997177193},{"_id":"public/tags/iPXE-netboot/index.html","hash":"14a143c94bf0549162d452d2d4f3c2b09f41788c","modified":1520997177193},{"_id":"public/static/api/img/share/l8.gif","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1520997177193},{"_id":"public/tags/iPXE-winpe/index.html","hash":"4dee2e3651ed980bd4bfb8ca50de17a8830a2cbc","modified":1520997177203},{"_id":"public/apple-touch-icon.png","hash":"c36a373c7830d61d1ce092bd5a88d0e9b54212fd","modified":1520997177203},{"_id":"public/fancybox/fancybox_sprite.png","hash":"17df19f97628e77be09c352bf27425faea248251","modified":1520997177203},{"_id":"public/fancybox/blank.gif","hash":"2daeaa8b5f19f0bc209d976c02bd6acb51b00b0a","modified":1520997177203},{"_id":"public/fancybox/fancybox_overlay.png","hash":"b3a4ee645ba494f52840ef8412015ba0f465dbe0","modified":1520997177203},{"_id":"public/fancybox/fancybox_loading.gif","hash":"1a755fb2599f3a313cc6cfdb14df043f8c14a99c","modified":1520997177203},{"_id":"public/fancybox/fancybox_sprite@2x.png","hash":"30c58913f327e28f466a00f4c1ac8001b560aed8","modified":1520997177203},{"_id":"public/fancybox/fancybox_loading@2x.gif","hash":"273b123496a42ba45c3416adb027cd99745058b0","modified":1520997177203},{"_id":"public/img/douban.png","hash":"e2ade003ffadd5826ee66ec23901c2d6e8607e4e","modified":1520997177203},{"_id":"public/img/facebook.png","hash":"d19ad7a0903daf26817afd8753cd97e0cc714f54","modified":1520997177203},{"_id":"public/img/coderwall.png","hash":"fa84676c4d654e040e51fd34bfcd9f9348cd5331","modified":1520997177203},{"_id":"public/img/favicon.ico","hash":"48d9661f11688d84618da35409f6cbf3a0ac0507","modified":1520997177203},{"_id":"public/img/delicious.png","hash":"9553a5f5189e4a953e04a58a49dbfa74b86b73dd","modified":1520997177203},{"_id":"public/img/github.png","hash":"b84d03b32fa388dcbf149296ebd16dce6223d48d","modified":1520997177203},{"_id":"public/img/favicon.pngg","hash":"5b4e9c94ff3396db5b074b69c1aa5bb909aba825","modified":1520997177203},{"_id":"public/img/img-err.png","hash":"23a63ea26eb3c1d5e677d9883cf36cc1a1a1228b","modified":1520997177203},{"_id":"public/img/favicon.png","hash":"33da7602134e0ec3c9eb08eb1478e2893f48a6ed","modified":1520997177203},{"_id":"public/img/google.png","hash":"61a21fec7346fa3400b747ac9a201cf3d5bc013d","modified":1520997177203},{"_id":"public/img/instagram.png","hash":"3c148a3882a8d141d7d405be8c4815d0dcb03561","modified":1520997177203},{"_id":"public/img/img-loading.png","hash":"a9cd5cd11866824f31e3d1c5e23badfeb3f73031","modified":1520997177203},{"_id":"public/img/qq.png","hash":"fd741764c5528fe371f053beac99839a97900eef","modified":1520997177203},{"_id":"public/img/mail.png","hash":"fca8199cc77fdbd700a45bf56d091c82f4a67fe7","modified":1520997177203},{"_id":"public/img/pinboard.png","hash":"0891fbb6d092fa012bf936019923383d84c6aeb0","modified":1520997177203},{"_id":"public/img/linkedin.png","hash":"e203138fb53c257cb214e97f4e30091b9c568d2c","modified":1520997177203},{"_id":"public/img/rss.png","hash":"430fd47340e75214c081abd05cd7410cf7c71b86","modified":1520997177203},{"_id":"public/img/pinterest.png","hash":"9c72917f8779c083157c6ce7a5d62ed4874f0630","modified":1520997177203},{"_id":"public/img/scrollbar_arrow.png","hash":"d64a33c4ddfbdb89deeb6f4e3d36eb84dc4777c0","modified":1520997177203},{"_id":"public/img/segmentfault.png","hash":"4483ab273423deb65021111fc8ad9512b69e45b2","modified":1520997177203},{"_id":"public/img/wechat.png","hash":"7ca41b6e32ca4dac419225261ab4fee5a88f73a9","modified":1520997177203},{"_id":"public/img/twitter.png","hash":"14dbb8e62d056525253bc0de13acd1723da7a934","modified":1520997177203},{"_id":"public/img/weibo.png","hash":"280dae3fd38086158b4a1b57edb94c06b1a5014b","modified":1520997177203},{"_id":"public/img/stackoverflow.png","hash":"da5dfe9043055c95e479d49c78cd3b020de608f2","modified":1520997177203},{"_id":"public/img/zhihu.png","hash":"a6d6ef65e9ac82e613a311810391ebb90d9b1c1d","modified":1520997177203},{"_id":"public/fancybox/helpers/fancybox_buttons.png","hash":"e385b139516c6813dcd64b8fc431c364ceafe5f3","modified":1520997177203},{"_id":"public/static/api/img/share/icons_0_16.png","hash":"0eec1e81a04664b2032bd389513349e9bd5d5b0f","modified":1520997177203},{"_id":"public/static/api/img/share/icons_1_16.png","hash":"3793c3265429ab7b830bfaf18322259cd0b4c4ef","modified":1520997177203},{"_id":"public/static/api/img/share/icons_0_32.png","hash":"c20521634fdacef39631031671528713e6ba6081","modified":1520997177203},{"_id":"public/static/api/img/share/icons_0_24.png","hash":"a89223f9714c8c4fa169430a327963ca6a1c9a6e","modified":1520997177203},{"_id":"public/static/api/img/share/icons_1_24.png","hash":"9f1d472095dbe138ef7aff069b1d18cae6ffa942","modified":1520997177203},{"_id":"public/static/api/img/share/icons_2_16.png","hash":"07340442cb61aabb419dd226f4bfb206a7577f52","modified":1520997177203},{"_id":"public/static/api/img/share/icons_1_32.png","hash":"09825de5f238c97e4374d545961d6e0d5bbfb3e2","modified":1520997177203},{"_id":"public/static/api/img/share/icons_2_24.png","hash":"e47fb87c533f2be89f22901f0864d9b5ef83412d","modified":1520997177203},{"_id":"public/static/api/img/share/icons_2_32.png","hash":"deba62865245a6b5aafa446787d72165c703b943","modified":1520997177203},{"_id":"public/static/api/img/share/l1.gif","hash":"70e1932ca7a622ed3322b683eceb7a590860a55e","modified":1520997177203},{"_id":"public/static/api/img/share/l0.gif","hash":"738b92632b0a9789a9eb568b8d101eb64f55f6e0","modified":1520997177203},{"_id":"public/static/api/img/share/l6.gif","hash":"f4b8e3188f744f13aca46b27b451d55d9e209c48","modified":1520997177203},{"_id":"public/static/api/img/share/l5.gif","hash":"148706f56b8ef4fd9d8483d0ac3a6730e72fc0ad","modified":1520997177203},{"_id":"public/static/api/img/share/l2.gif","hash":"e6a5d6104c226a686d48759e0268e09d762e242e","modified":1520997177203},{"_id":"public/static/api/img/share/l4.gif","hash":"8a9c3cf99766d3f07a9c480cfdffdc3197b9a6b9","modified":1520997177203},{"_id":"public/static/api/img/share/l7.gif","hash":"e4f7e5e56c8f4eb026b5cb0affe3bd69c31af261","modified":1520997177203},{"_id":"public/static/api/img/share/l3.gif","hash":"26c0dd37d98df63abb9d3d83e01bb47c34ee3f0f","modified":1520997177203},{"_id":"public/static/api/img/share/r3.gif","hash":"ecdd21f1457be54afc96e2d005524eef93d7bf85","modified":1520997177203},{"_id":"public/static/api/img/share/r0.gif","hash":"882f255fbafc0136a3917c1dd40db88879c1b1c1","modified":1520997177203},{"_id":"public/static/api/img/share/r2.gif","hash":"67c84a67be3b039892e9cb8c7c29ed29813bf60f","modified":1520997177203},{"_id":"public/static/api/img/share/r1.gif","hash":"96064d132ee2477c0e444c2e18162f9d1dc9e9c2","modified":1520997177203},{"_id":"public/static/api/img/share/pop_c.gif","hash":"e8b9ece6ddaa47ccb2c15f2396d1cd3020740603","modified":1520997177203},{"_id":"public/static/api/img/share/r4.gif","hash":"517435e69a2215a0f003e75a4861154ca963c30e","modified":1520997177203},{"_id":"public/static/api/img/share/r5.gif","hash":"e61b32d1830390303927bdab21823959f8dc7023","modified":1520997177203},{"_id":"public/static/api/img/share/r8.gif","hash":"c068ece54a72a3f2428d4f1b5ca7c176f027dd4e","modified":1520997177203},{"_id":"public/static/api/img/share/sc.png","hash":"e5a2ca56973a3d6608e7e3a48ebd9fa5ebda9991","modified":1520997177203},{"_id":"public/static/api/img/share/r6.gif","hash":"4bc01e08ef0015fddf5b8c7257c094ec584ca3ee","modified":1520997177203},{"_id":"public/static/api/img/share/selectshare_close.png","hash":"6f3666278268890a153c85fb9f04ac848c442561","modified":1520997177203},{"_id":"public/static/api/img/share/share-search-icon.png","hash":"0629677a7eb5aa3e8bab3faa310c6d8c467a3287","modified":1520997177203},{"_id":"public/static/api/img/share/r7.gif","hash":"3c596c924910c93cf3e37cc1b2870dbf271151e2","modified":1520997177203},{"_id":"public/background/bg-4.jpg","hash":"7ef559423622f8959cce79274bdf782d92a6e867","modified":1520997178850},{"_id":"public/font-awesome/fonts/FontAwesome.otf","hash":"42c179eef588854b5ec151bcf6a3f58aa8b79b11","modified":1520997178895},{"_id":"public/font-awesome/fonts/fontawesome-webfont.woff","hash":"4a313eb93b959cc4154c684b915b0a31ddb68d84","modified":1520997178940},{"_id":"public/font-awesome/fonts/fontawesome-webfont.eot","hash":"986eed8dca049714e43eeebcb3932741a4bec76d","modified":1520997178940},{"_id":"public/font-awesome/fonts/fontawesome-webfont.woff2","hash":"638c652d623280a58144f93e7b552c66d1667a11","modified":1520997178940},{"_id":"public/css/loading-style.css","hash":"1f67362d809e85edc9f122db7bc3711af1ed1d8b","modified":1520997178940},{"_id":"public/css/showshare.css","hash":"3efc4afd0d136fb5dec993e9cd9ce85b9d1cf589","modified":1520997178940},{"_id":"public/fancybox/jquery.fancybox.css","hash":"b6aa6692c2e5f8bd74d96827b78570f0c5683c20","modified":1520997178940},{"_id":"public/js/instagram.js","hash":"f19adbcc0dac33536bc6660598059048ec901882","modified":1520997178940},{"_id":"public/js/TweenMax.js","hash":"0ba64564a4fde4085fa3971dd53b7d64a41751e1","modified":1520997178940},{"_id":"public/js/jquery.lazyload.js","hash":"8e4ad3e17f8e82be311b6b6e87811762e2b2d764","modified":1520997178940},{"_id":"public/js/clipboard.min.js","hash":"c13b4bb8fee46447284590d2afc0efca0ea3cb7b","modified":1520997178940},{"_id":"public/js/mobile.js","hash":"d3847e5bcaf39108931724ecb02770c62b10889f","modified":1520997178940},{"_id":"public/js/main.js","hash":"921b2fb56e48cce3d16ceb4a3fadf8e666c73a0a","modified":1520997178940},{"_id":"public/js/plugins.js","hash":"c1cf96b2d852b5803228a34d99014b005623bc06","modified":1520997178940},{"_id":"public/js/pc.js","hash":"ab375af6e3bcd054b1e87e1a8dcd3d7d25c2db40","modified":1520997178940},{"_id":"public/css/pace/pace-theme-flash.css","hash":"508bce8b59a1fbc1f1443a7c4ab3b026e5517dab","modified":1520997178940},{"_id":"public/fancybox/helpers/jquery.fancybox-buttons.js","hash":"dc3645529a4bf72983a39fa34c1eb9146e082019","modified":1520997178940},{"_id":"public/fancybox/helpers/jquery.fancybox-buttons.css","hash":"1a9d8e5c22b371fcc69d4dbbb823d9c39f04c0c8","modified":1520997178940},{"_id":"public/fancybox/helpers/jquery.fancybox-media.js","hash":"294420f9ff20f4e3584d212b0c262a00a96ecdb3","modified":1520997178940},{"_id":"public/fancybox/helpers/jquery.fancybox-thumbs.js","hash":"47da1ae5401c24b5c17cc18e2730780f5c1a7a0c","modified":1520997178940},{"_id":"public/fancybox/helpers/jquery.fancybox-thumbs.css","hash":"4ac329c16a5277592fc12a37cca3d72ca4ec292f","modified":1520997178940},{"_id":"public/js/404/jquery.parallaxify-0.0.2.min.js","hash":"b97e2dfcb210b76f7bdd6e1800b26128bf4fad99","modified":1520997178940},{"_id":"public/static/api/css/select_share.css","hash":"d0259abdb410193cf761e42bffaa51e70327a0cd","modified":1520997178940},{"_id":"public/static/api/css/imgshare.css","hash":"c3624a2dde649ed28b2e5d1f050fd971fbaf71a0","modified":1520997178940},{"_id":"public/static/api/css/share_style0_16.css","hash":"090e77e9e6e9b8ee0d73a233cbe46499de935bdd","modified":1520997178940},{"_id":"public/static/api/css/like.css","hash":"2024d58206df01b858c38f07957f928b44e14cb3","modified":1520997178940},{"_id":"public/static/api/css/share_style0_24.css","hash":"7d1f9f32b80f91001f4f951aa045180cde22d82e","modified":1520997178940},{"_id":"public/static/api/css/share_style1_16.css","hash":"aeb4e9fa96cfa0167481e1f4007079dc3f3c6c27","modified":1520997178940},{"_id":"public/static/api/css/share_style0_32.css","hash":"7c2d12ea532c8a55c102b649bb23ef5bf53b3ed3","modified":1520997178940},{"_id":"public/static/api/css/share_popup.css","hash":"338ba2b30ef8ce0c84cd36b37d7f8482996291dc","modified":1520997178940},{"_id":"public/static/api/css/share_style2_24.css","hash":"917d963d3be111064cbb1d122963da91ee3724a0","modified":1520997178940},{"_id":"public/static/api/css/share_style2.css","hash":"1ad451187cde8a74843fd398b924ca0ac911e9be","modified":1520997178940},{"_id":"public/static/api/css/share_style2_16.css","hash":"572c8e856988e463eb865f38d33ba003cc20d083","modified":1520997178940},{"_id":"public/static/api/css/share_style1_32.css","hash":"626d67a4c0bb72a152e90d25dbf281c0c35a2140","modified":1520997178940},{"_id":"public/static/api/css/share_style2_32.css","hash":"3657bbc4b5bbc66ebca4906ee0a1cbf9f98be883","modified":1520997178940},{"_id":"public/static/api/css/share_style1_24.css","hash":"3ee5f745c863b4f68299fe5dc125f913ca619c07","modified":1520997178940},{"_id":"public/static/api/css/share_style4.css","hash":"0a9e2ed712a5ef5c4699c038cd001a0d688a0fdf","modified":1520997178940},{"_id":"public/static/api/css/weixin_popup.css","hash":"5e6c5084bfd16051de5776c2e136a5462b08a32c","modified":1520997178940},{"_id":"public/static/api/css/slide_share.css","hash":"3898feaf45559b039f885bee8f9e831f48adb20c","modified":1520997178940},{"_id":"public/static/api/js/base/class.js","hash":"ad1e5a3011e30b83ac8aaeabffc3311dcb151bf5","modified":1520997178940},{"_id":"public/static/api/js/trans/data.js","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1520997178940},{"_id":"public/static/api/js/component/anticheat.js","hash":"ee6b11a7ed39ae67c1c2aeeef96b4a0f40f8083c","modified":1520997178940},{"_id":"public/static/api/js/component/pop_base.js","hash":"eae6e120c149a21caa2883c533ccc40bc07fda51","modified":1520997178940},{"_id":"public/static/api/js/trans/logger.js","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1520997178940},{"_id":"public/static/api/js/component/animate.js","hash":"00b6f74ed82e5a21a9295dd2dc963e892734b7f6","modified":1520997178940},{"_id":"public/static/api/js/component/comm_tools.js","hash":"e651fbb1a85ab9c615ee833f4d042c203ef430bc","modified":1520997178940},{"_id":"public/static/api/js/component/pop_popup.js","hash":"aface5a8c3f71e9e024bf0df5b361ed8f5452f50","modified":1520997178940},{"_id":"public/static/api/js/component/partners.js","hash":"a4c275ffb4d3557280211e6bf0573485b397ffd8","modified":1520997178940},{"_id":"public/static/api/js/component/pop_dialog.js","hash":"4417d2fa9ad8ff6c79a2352ef07e9d10a1313ee0","modified":1520997178940},{"_id":"public/static/api/js/share/api_base.js","hash":"cbacd664451f80955c2ff4caccd4b9110062c714","modified":1520997178940},{"_id":"public/static/api/js/component/qrcode.js","hash":"2e3cc4cc5545556dd97ab899ff32d3ab7ccee808","modified":1520997178940},{"_id":"public/static/api/js/share/combine_api.js","hash":"c45d76df1707b4fd739dae7022dc4a015632a81a","modified":1520997178940},{"_id":"public/static/api/js/component/pop_popup_slide.js","hash":"1119fc14abd34ffb8e1f653cd30ca26adaafa3bf","modified":1520997178940},{"_id":"public/static/api/js/share/image_api.js","hash":"43a93415f2a5dd34760042c2bcd9f4692feecb5d","modified":1520997178940},{"_id":"public/static/api/js/share/like_api.js","hash":"3526047b7f9f7446b883e2fa5ebcf143526449be","modified":1520997178940},{"_id":"public/static/api/js/share/share_api.js","hash":"f7b86d0cc063f692a73a174d04e77cbe3c5facc7","modified":1520997178940},{"_id":"public/static/api/js/share/likeshare.js","hash":"d088ffe7b6451cedf202280d16e85f75a8c3bfd3","modified":1520997178940},{"_id":"public/static/api/js/share/select_api.js","hash":"bf259a7912ee6124d741dbb5e45cab40bfa45e90","modified":1520997178940},{"_id":"public/static/api/js/share/slide_api.js","hash":"c317e3f7fec13d89178e475f26a689bb94e5aa76","modified":1520997178940},{"_id":"public/static/api/js/conf/const.js","hash":"e2269411b129b847eca265fbc73f0d573f2474bb","modified":1520997178940},{"_id":"public/static/api/js/conf/define.js","hash":"1393906ec26b7cf711c18e569a64f7d0c1951fc7","modified":1520997178940},{"_id":"public/static/api/js/trans/trans.js","hash":"2bf87aff540cba3bee6cc05a7a8e9a2bc8b5d907","modified":1520997178940},{"_id":"public/static/api/js/trans/trans_weixin.js","hash":"e68e9bc91ee6fbcd64ac788463870f01602a8562","modified":1520997178940},{"_id":"public/static/api/js/trans/trans_bdysc.js","hash":"1be632b99fdd67ba5279aa6c56db7d528fd094c3","modified":1520997178940},{"_id":"public/static/api/js/view/image_view.js","hash":"bb66297a5bd2c7dd931b9145f5d4a616876f3373","modified":1520997178940},{"_id":"public/static/api/js/start/router.js","hash":"97c195ae0d30dd8c7aac55a0555f082eeed4eee0","modified":1520997178940},{"_id":"public/static/api/js/trans/trans_bdxc.js","hash":"da78025de5717315252d2d33b4252c89b891c71c","modified":1520997178940},{"_id":"public/static/api/js/view/share_view.js","hash":"f445ce9cbbcf887da5e248b1cfadc03ab7df76d0","modified":1520997178940},{"_id":"public/static/api/js/view/select_view.js","hash":"2611efec1d31d85609feea0c57e14d3f817a6220","modified":1520997178940},{"_id":"public/static/api/js/view/like_view.js","hash":"42b51bd3ee4815b9ca8df6dacb9c81a8a34d762a","modified":1520997178940},{"_id":"public/static/api/js/view/slide_view.js","hash":"973ded5cd15eb119e79ffd9326af3a44167b26bd","modified":1520997178940},{"_id":"public/static/api/js/view/view_base.js","hash":"b3fd7dafde05d63af3dfe9e0a59f9367f81402c5","modified":1520997178940},{"_id":"public/css/style.css","hash":"073525e68a984a438a15d60efbeba4a76f57176a","modified":1520997178940},{"_id":"public/fancybox/jquery.fancybox.js","hash":"a82597493d75ea989ca586e09173cff332efe41e","modified":1520997178940},{"_id":"public/fancybox/jquery.fancybox.pack.js","hash":"9e0d51ca1dbe66f6c0c7aefd552dc8122e694a6e","modified":1520997178940},{"_id":"public/js/pace.js","hash":"b49c10cd65d9488f7338e3c778e55ac6628650f3","modified":1520997178940},{"_id":"public/js/TweenMax.min.js","hash":"eaa4e4a08400da3f22dedda706ba56cdce5b0b7a","modified":1520997178940},{"_id":"public/js/embed.js","hash":"8d2d4a812ab639bc02fdd8749d3a39f6b9406c54","modified":1520997178940},{"_id":"public/font-awesome/css/font-awesome.min.css","hash":"12d6861075de8e293265ff6ff03b1f3adcb44c76","modified":1520997178940},{"_id":"public/font-awesome/css/font-awesome.css","hash":"b488600451227b445414796e9b8550e7c1bd6d29","modified":1520997178940},{"_id":"public/js/404/jquery-2.0.3.min.js","hash":"fbf9c77d0c4e3c34a485980c1e5316b6212160c8","modified":1520997178940},{"_id":"public/static/api/js/share.js","hash":"5e71147fe4a93bc99387a5cc1c6894d8b6ab2d5e","modified":1520997178940},{"_id":"public/static/api/js/base/tangram.js","hash":"e1952e27f6dc3d6339128cec157acef8cc0a775f","modified":1520997178940},{"_id":"public/background/bg-11.jpg","hash":"d69a0447e91f62977b144737f08620d77037c76a","modified":1520997178950},{"_id":"public/background/bg-109.jpg","hash":"6171c1e921c8cc9bdcd7276cf7f0bee5295f4672","modified":1520997178950},{"_id":"public/background/bg-20.jpg","hash":"9d428ac435198b2a0107102a2e9ae71e53afe364","modified":1520997178950},{"_id":"public/background/bg.jpg","hash":"f0617756387d74f99afe0087c7b93a32f3c7096b","modified":1520997178950},{"_id":"public/img/head.jpg","hash":"07047af83673946967a0f46e5586c5470c2df952","modified":1520997178950},{"_id":"public/background/bg-17.jpg","hash":"6ab5e470059e8ccb0c8bc6786abfb5db7e9a1826","modified":1520997178950},{"_id":"public/background/bg-1.jpg","hash":"f0617756387d74f99afe0087c7b93a32f3c7096b","modified":1520997178950},{"_id":"public/background/bg-3.jpg","hash":"f1347eddd07bdae93ab6bebad8627eddc5baeb44","modified":1520997178950},{"_id":"public/font-awesome/fonts/fontawesome-webfont.ttf","hash":"6484f1af6b485d5096b71b344e67f4164c33dd1f","modified":1520997178950},{"_id":"public/background/bg-23.jpg","hash":"050937d649be2c02ef8a66a0ffe7d320b236d1b0","modified":1520997178972},{"_id":"public/background/bg-7.jpg","hash":"acbe0946a47ba16b79f062dbee14c4c9ff9a48da","modified":1520997178973},{"_id":"public/background/bg-15.jpg","hash":"ce5760578eb814fe951c56200e81c6f47b6468d4","modified":1520997178973},{"_id":"public/background/bg-9.jpg","hash":"df731da0fe0de9a05d99d017e747252c990f972d","modified":1520997178987},{"_id":"public/background/bg-14.jpg","hash":"2fd6ede2bc9de2d26d910ea4e45d28b2350881eb","modified":1520997178987},{"_id":"public/background/bg-19.jpg","hash":"d77504412d28432643fc61ed9fd9f7c57096bdd9","modified":1520997179016},{"_id":"public/background/bg-6.jpg","hash":"1a4f4c8875b2c56e7992000979a7fca7856eec35","modified":1520997179016},{"_id":"public/background/bg-24.jpg","hash":"796fa5262d7714e8ce9496a2d03864429cfc5b45","modified":1520997179016},{"_id":"public/background/bg-22.jpg","hash":"7a055391fa4188d9c22fdc1d34a10b26e2f0826d","modified":1520997179017},{"_id":"public/background/bg-8.jpg","hash":"dbecc189e28d00fa23e397eb512e039c2ff03c87","modified":1520997179017},{"_id":"public/background/bg-21.jpg","hash":"7c4c6cd5d75115093fa29bba7372fa198f04b0f1","modified":1520997179017},{"_id":"public/font-awesome/fonts/fontawesome-webfont.svg","hash":"550ef5c1253c8376f2ead32b654eb58d3c106ca3","modified":1520997179017},{"_id":"public/background/bg-12.jpg","hash":"2e0815591309863d8130881681cde32ec4bfebf1","modified":1520997179017},{"_id":"public/img/bg.jpg","hash":"1bcba3c6348e2190a42bff762800bf846cf9239c","modified":1520997179017},{"_id":"public/background/bg-18.jpg","hash":"4d61dc41a781a9c1d37c9e5e413ac0d8a9538f6a","modified":1520997179017},{"_id":"public/background/bg-10.jpg","hash":"dfb23c1c3cf8a3dcb8dc0ea10cf06501c151a2a2","modified":1520997179017},{"_id":"public/background/bg-111.jpg","hash":"e1631b47fede8da6c03582ceed648668547c4f09","modified":1520997179017},{"_id":"public/background/bg-13.jpg","hash":"d7237c6014e28c90f53287f48f718d0759af104b","modified":1520997179017},{"_id":"public/background/bg-16.jpg","hash":"d1a34d0c4b69262169b543922e4aeb4dae997ad8","modified":1520997179017},{"_id":"public/background/bg-2.jpg","hash":"40a6db13e9c461f80e2c4efee7fb63bbd594e751","modified":1520997179027},{"_id":"public/background/bg-5.jpg","hash":"2d5da2a209732cce0abf2ca234c0bef0516b65ff","modified":1520997179027}],"Category":[{"name":"CTF","_id":"cjeqig1ix0004lgqafmxnp9hr"},{"name":"Program","_id":"cjeqig1ja0009lgqa4uppvsvn"},{"name":"Linux","_id":"cjeqig1k0000klgqaj3k6fi60"},{"name":"Windows","_id":"cjeqig1ow0044lgqabki9lz2b"}],"Data":[],"Page":[{"title":"About","date":"2016-07-30T11:10:59.000Z","tags":["我是谁","从哪来","到哪去"],"_content":"About me:  \n``` python\n>>>print name=star-chen  \n>>>print sex=???  \n>>>print hobbies=逆向，CTF，编程，宅\n\n```\n平时感觉也学了很多东西，一直没有把学习过的内容记录下来，所以弄了这个博客，把平时的学习过程写下来，写东西也是再次思考的过程，希望能更有所提高吧。  \nBe Quiet，Learn More！  \nThe Quieter You Become，The More You Are Be Hear！  \n\n\n","source":"about/index.md","raw":"---\ntitle: About\ndate: 2016-07-30 19:10:59\ntags:\n- 我是谁\n- 从哪来\n- 到哪去\n---\nAbout me:  \n``` python\n>>>print name=star-chen  \n>>>print sex=???  \n>>>print hobbies=逆向，CTF，编程，宅\n\n```\n平时感觉也学了很多东西，一直没有把学习过的内容记录下来，所以弄了这个博客，把平时的学习过程写下来，写东西也是再次思考的过程，希望能更有所提高吧。  \nBe Quiet，Learn More！  \nThe Quieter You Become，The More You Are Be Hear！  \n\n\n","updated":"2017-12-04T07:27:28.766Z","path":"about/index.html","comments":1,"layout":"page","_id":"cjeqig1i90001lgqaykk9lyya","content":"<p>About me:<br><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt;<span class=\"keyword\">print</span> name=star-chen  </span><br><span class=\"line\">&gt;&gt;&gt;print sex=???  </span><br><span class=\"line\">&gt;&gt;&gt;<span class=\"keyword\">print</span> hobbies=逆向，CTF，编程，宅</span><br></pre></td></tr></table></figure></p>\n<p>平时感觉也学了很多东西，一直没有把学习过的内容记录下来，所以弄了这个博客，把平时的学习过程写下来，写东西也是再次思考的过程，希望能更有所提高吧。<br>Be Quiet，Learn More！<br>The Quieter You Become，The More You Are Be Hear！  </p>\n","site":{"data":{}},"excerpt":"","more":"<p>About me:<br><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt;<span class=\"keyword\">print</span> name=star-chen  </span><br><span class=\"line\">&gt;&gt;&gt;print sex=???  </span><br><span class=\"line\">&gt;&gt;&gt;<span class=\"keyword\">print</span> hobbies=逆向，CTF，编程，宅</span><br></pre></td></tr></table></figure></p>\n<p>平时感觉也学了很多东西，一直没有把学习过的内容记录下来，所以弄了这个博客，把平时的学习过程写下来，写东西也是再次思考的过程，希望能更有所提高吧。<br>Be Quiet，Learn More！<br>The Quieter You Become，The More You Are Be Hear！  </p>\n"}],"Post":[{"title":"test","_content":"","source":"_drafts/test.md","raw":"---\ntitle: test\ntags:\n---\n","slug":"test","published":0,"date":"2017-12-04T07:27:28.741Z","updated":"2017-12-04T07:27:28.741Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjeqig1hz0000lgqa3k1j6gxn","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"HCTF2016 writeup","date":"2016-11-29T12:12:27.000Z","_content":"","source":"_drafts/HCTF2016-Writeup.md","raw":"---\ntitle: HCTF2016 writeup\ndate: 2016-11-29 20:12:27\ncategories: CTF\ntags:\n- HCTF\n- 萌新第一次\n---\n","slug":"HCTF2016-Writeup","published":0,"updated":"2017-12-04T07:27:28.741Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjeqig1iq0002lgqadwf5dd23","content":"","site":{"data":{}},"excerpt":"","more":""},{"layout":"ctf","title":"初识OD","date":"2016-07-30T11:24:01.000Z","_content":"\n## 程序界面简介\n\n​\tollydbg是一款功能强大的win32调试工具，[官方网站](http://www.ollydbg.de)\n\n\n\n","source":"_drafts/初识OD.md","raw":"layout: ctf\ntitle: 初识OD\ndate: 2016-07-30 19:24:01\ntags: tools reverse\n---\n\n## 程序界面简介\n\n​\tollydbg是一款功能强大的win32调试工具，[官方网站](http://www.ollydbg.de)\n\n\n\n","slug":"初识OD","published":0,"updated":"2017-12-04T07:27:28.741Z","comments":1,"photos":[],"link":"","_id":"cjeqig1iu0003lgqahnz3rutn","content":"<h2 id=\"程序界面简介\"><a href=\"#程序界面简介\" class=\"headerlink\" title=\"程序界面简介\"></a>程序界面简介</h2><p>​    ollydbg是一款功能强大的win32调试工具，<a href=\"http://www.ollydbg.de\" target=\"_blank\" rel=\"noopener\">官方网站</a></p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"程序界面简介\"><a href=\"#程序界面简介\" class=\"headerlink\" title=\"程序界面简介\"></a>程序界面简介</h2><p>​    ollydbg是一款功能强大的win32调试工具，<a href=\"http://www.ollydbg.de\" target=\"_blank\" rel=\"noopener\">官方网站</a></p>\n"},{"title":"常见排序算法之冒泡排序","date":"2017-05-17T15:54:44.000Z","_content":"\n冒泡排序，这个就不多说了吧。show me the code!\n\n```python\n# -*- coding:utf-8 -*-\n\nA = [3,7,5,2,9,0,1]\n\ndef bubble_sort(Array_A):\n    for i in range(0,len(Array_A)-1):\n        for j in range(len(Array_A)-i-1):\n            if Array_A[j] > Array_A[j+1]:\n                Array_A[j],Array_A[j+1] = Array_A[j+1],Array_A[j]\nbubble_sort(A)\nprint A\n```\n\n<!-- more -->\n\n### 冒泡排序的原理\n\n每一趟只能将一个数归位, 如果有n个数进行排序,只需将n-1个数归位, 也就是说要进行n-1趟操作(已经归位的数不用再比较)\n\n### 冒泡排序的缺点\n\n效率特别低，时间复杂度O(n2)\n\n### 冒泡排序的算法稳定性\n\n冒泡排序就是把小的元素往前调或者把大的元素往后调。比较是相邻的两个元素比较，交换也发生在这两个元素之间。所以，如果两个元素相等，我想你是不会再无聊地把他们俩交换一下的；如果两个相等的元素没有相邻，那么即使通过前面的两两交换把两个相邻起来，这时候也不会交换，所以相同元素的前后顺序并没有改变，所以冒泡排序是一种稳定排序算法。\n\n","source":"_posts/BubbleSort.md","raw":"---\ntitle: 常见排序算法之冒泡排序\ncategories:\n-  Program\ntags:\n- 排序\n- 冒泡排序\n- 算法\ndate: 2017-05-17 23:54:44\n---\n\n冒泡排序，这个就不多说了吧。show me the code!\n\n```python\n# -*- coding:utf-8 -*-\n\nA = [3,7,5,2,9,0,1]\n\ndef bubble_sort(Array_A):\n    for i in range(0,len(Array_A)-1):\n        for j in range(len(Array_A)-i-1):\n            if Array_A[j] > Array_A[j+1]:\n                Array_A[j],Array_A[j+1] = Array_A[j+1],Array_A[j]\nbubble_sort(A)\nprint A\n```\n\n<!-- more -->\n\n### 冒泡排序的原理\n\n每一趟只能将一个数归位, 如果有n个数进行排序,只需将n-1个数归位, 也就是说要进行n-1趟操作(已经归位的数不用再比较)\n\n### 冒泡排序的缺点\n\n效率特别低，时间复杂度O(n2)\n\n### 冒泡排序的算法稳定性\n\n冒泡排序就是把小的元素往前调或者把大的元素往后调。比较是相邻的两个元素比较，交换也发生在这两个元素之间。所以，如果两个元素相等，我想你是不会再无聊地把他们俩交换一下的；如果两个相等的元素没有相邻，那么即使通过前面的两两交换把两个相邻起来，这时候也不会交换，所以相同元素的前后顺序并没有改变，所以冒泡排序是一种稳定排序算法。\n\n","slug":"BubbleSort","published":1,"updated":"2017-12-04T07:27:28.741Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjeqig1iz0006lgqal0rjjmzz","content":"<p>冒泡排序，这个就不多说了吧。show me the code!</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># -*- coding:utf-8 -*-</span></span><br><span class=\"line\"></span><br><span class=\"line\">A = [<span class=\"number\">3</span>,<span class=\"number\">7</span>,<span class=\"number\">5</span>,<span class=\"number\">2</span>,<span class=\"number\">9</span>,<span class=\"number\">0</span>,<span class=\"number\">1</span>]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">bubble_sort</span><span class=\"params\">(Array_A)</span>:</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> range(<span class=\"number\">0</span>,len(Array_A)<span class=\"number\">-1</span>):</span><br><span class=\"line\">        <span class=\"keyword\">for</span> j <span class=\"keyword\">in</span> range(len(Array_A)-i<span class=\"number\">-1</span>):</span><br><span class=\"line\">            <span class=\"keyword\">if</span> Array_A[j] &gt; Array_A[j+<span class=\"number\">1</span>]:</span><br><span class=\"line\">                Array_A[j],Array_A[j+<span class=\"number\">1</span>] = Array_A[j+<span class=\"number\">1</span>],Array_A[j]</span><br><span class=\"line\">bubble_sort(A)</span><br><span class=\"line\"><span class=\"keyword\">print</span> A</span><br></pre></td></tr></table></figure>\n<a id=\"more\"></a>\n<h3 id=\"冒泡排序的原理\"><a href=\"#冒泡排序的原理\" class=\"headerlink\" title=\"冒泡排序的原理\"></a>冒泡排序的原理</h3><p>每一趟只能将一个数归位, 如果有n个数进行排序,只需将n-1个数归位, 也就是说要进行n-1趟操作(已经归位的数不用再比较)</p>\n<h3 id=\"冒泡排序的缺点\"><a href=\"#冒泡排序的缺点\" class=\"headerlink\" title=\"冒泡排序的缺点\"></a>冒泡排序的缺点</h3><p>效率特别低，时间复杂度O(n2)</p>\n<h3 id=\"冒泡排序的算法稳定性\"><a href=\"#冒泡排序的算法稳定性\" class=\"headerlink\" title=\"冒泡排序的算法稳定性\"></a>冒泡排序的算法稳定性</h3><p>冒泡排序就是把小的元素往前调或者把大的元素往后调。比较是相邻的两个元素比较，交换也发生在这两个元素之间。所以，如果两个元素相等，我想你是不会再无聊地把他们俩交换一下的；如果两个相等的元素没有相邻，那么即使通过前面的两两交换把两个相邻起来，这时候也不会交换，所以相同元素的前后顺序并没有改变，所以冒泡排序是一种稳定排序算法。</p>\n","site":{"data":{}},"excerpt":"<p>冒泡排序，这个就不多说了吧。show me the code!</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># -*- coding:utf-8 -*-</span></span><br><span class=\"line\"></span><br><span class=\"line\">A = [<span class=\"number\">3</span>,<span class=\"number\">7</span>,<span class=\"number\">5</span>,<span class=\"number\">2</span>,<span class=\"number\">9</span>,<span class=\"number\">0</span>,<span class=\"number\">1</span>]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">bubble_sort</span><span class=\"params\">(Array_A)</span>:</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> range(<span class=\"number\">0</span>,len(Array_A)<span class=\"number\">-1</span>):</span><br><span class=\"line\">        <span class=\"keyword\">for</span> j <span class=\"keyword\">in</span> range(len(Array_A)-i<span class=\"number\">-1</span>):</span><br><span class=\"line\">            <span class=\"keyword\">if</span> Array_A[j] &gt; Array_A[j+<span class=\"number\">1</span>]:</span><br><span class=\"line\">                Array_A[j],Array_A[j+<span class=\"number\">1</span>] = Array_A[j+<span class=\"number\">1</span>],Array_A[j]</span><br><span class=\"line\">bubble_sort(A)</span><br><span class=\"line\"><span class=\"keyword\">print</span> A</span><br></pre></td></tr></table></figure>","more":"<h3 id=\"冒泡排序的原理\"><a href=\"#冒泡排序的原理\" class=\"headerlink\" title=\"冒泡排序的原理\"></a>冒泡排序的原理</h3><p>每一趟只能将一个数归位, 如果有n个数进行排序,只需将n-1个数归位, 也就是说要进行n-1趟操作(已经归位的数不用再比较)</p>\n<h3 id=\"冒泡排序的缺点\"><a href=\"#冒泡排序的缺点\" class=\"headerlink\" title=\"冒泡排序的缺点\"></a>冒泡排序的缺点</h3><p>效率特别低，时间复杂度O(n2)</p>\n<h3 id=\"冒泡排序的算法稳定性\"><a href=\"#冒泡排序的算法稳定性\" class=\"headerlink\" title=\"冒泡排序的算法稳定性\"></a>冒泡排序的算法稳定性</h3><p>冒泡排序就是把小的元素往前调或者把大的元素往后调。比较是相邻的两个元素比较，交换也发生在这两个元素之间。所以，如果两个元素相等，我想你是不会再无聊地把他们俩交换一下的；如果两个相等的元素没有相邻，那么即使通过前面的两两交换把两个相邻起来，这时候也不会交换，所以相同元素的前后顺序并没有改变，所以冒泡排序是一种稳定排序算法。</p>"},{"title":"Program HelloWorld","date":"2016-11-29T11:12:27.000Z","_content":"\n```c\n#include <stdio.h>\nint main(){\n  \n  printf(\"Hello World!\\n\");\n  return 0;\n}\n```\n<!-- more -->\n```bash\n#gcc hello.c -o hello\n#./hello\n#Hello World!\n```\n\n你好世界！Coding  and Hava Fun！","source":"_posts/C-Helloworld.md","raw":"---\ntitle: Program HelloWorld\ndate: 2016-11-29 19:12:27\ncategories: Program\ntags:\n- C\n- Helloworld\n---\n\n```c\n#include <stdio.h>\nint main(){\n  \n  printf(\"Hello World!\\n\");\n  return 0;\n}\n```\n<!-- more -->\n```bash\n#gcc hello.c -o hello\n#./hello\n#Hello World!\n```\n\n你好世界！Coding  and Hava Fun！","slug":"C-Helloworld","published":1,"updated":"2017-12-04T07:27:28.742Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjeqig1j70007lgqa3sx70y5f","content":"<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;stdio.h&gt;</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"built_in\">printf</span>(<span class=\"string\">\"Hello World!\\n\"</span>);</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<a id=\"more\"></a>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#gcc hello.c -o hello</span></span><br><span class=\"line\"><span class=\"comment\">#./hello</span></span><br><span class=\"line\"><span class=\"comment\">#Hello World!</span></span><br></pre></td></tr></table></figure>\n<p>你好世界！Coding  and Hava Fun！</p>\n","site":{"data":{}},"excerpt":"<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;stdio.h&gt;</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"built_in\">printf</span>(<span class=\"string\">\"Hello World!\\n\"</span>);</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>","more":"<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#gcc hello.c -o hello</span></span><br><span class=\"line\"><span class=\"comment\">#./hello</span></span><br><span class=\"line\"><span class=\"comment\">#Hello World!</span></span><br></pre></td></tr></table></figure>\n<p>你好世界！Coding  and Hava Fun！</p>"},{"title":"CentOS 7.2 搭建lnmp环境","date":"2017-03-11T03:08:20.000Z","_content":"\n### Centos7 安装php7\n由于centos自己的软件仓库中的php版本为5.4，而yii2框架需要的php版本必须是5.4及以上。索性直接一步到位到7.0。为图方便就不使用编译安装的方式，而是采用yum安装方式.\n#### 首先rpm安装php7.0的yum源\n```bash\n[root@vultr ~]# rpm -Uvh https://mirror.webtatic.com/yum/el7/webtatic-release.rpm\n```\n<!-- more -->\n#### yum安装php7\n```bash\n[root@vultr ~]# yum install php70w\n```\n### yum安装php-fpm\n```bash\n[root@vultr ~]# yum install php70w-fpm\n```\n####  查看php版本\n```bash\n[root@vultr ~]# php -v\nPHP 7.0.16 (cli) (built: Feb 18 2017 10:25:02) ( NTS )\nCopyright (c) 1997-2017 The PHP Group\nZend Engine v3.0.0, Copyright (c) 1998-2017 Zend Technologies\n```\n\n### 安装MariaDB\n\n```bash\n[root@vultr ~]# yum install mariadb-server mariadb\n```\n启动MariaDB\n\n```bash\n[root@vultr ~]# systemctl start mariadb\n```\n刚刚安装好数据库，是没有设置root用户密码的，这样子显然是不安全的。在初次安装时，可以使用MariaDB自带的安全安装命令设置root用户密码。\n\n```bash\n[root@vultr ~]# mysql_secure_installation \n\nNOTE: RUNNING ALL PARTS OF THIS SCRIPT IS RECOMMENDED FOR ALL MariaDB\n      SERVERS IN PRODUCTION USE!  PLEASE READ EACH STEP CAREFULLY!\n\nIn order to log into MariaDB to secure it, we'll need the current\npassword for the root user.  If you've just installed MariaDB, and\nyou haven't set the root password yet, the password will be blank,\nso you should just press enter here.\n\nEnter current password for root (enter for none): \nERROR 1045 (28000): Access denied for user 'root'@'localhost' (using password: YES)\nEnter current password for root (enter for none): \nOK, successfully used password, moving on...\n\nSetting the root password ensures that nobody can log into the MariaDB\nroot user without the proper authorisation.\n\nSet root password? [Y/n] Y\nNew password: \nRe-enter new password: \nPassword updated successfully!\nReloading privilege tables..\n ... Success!\n\n\nBy default, a MariaDB installation has an anonymous user, allowing anyone\nto log into MariaDB without having to have a user account created for\nthem.  This is intended only for testing, and to make the installation\ngo a bit smoother.  You should remove them before moving into a\nproduction environment.\n\nRemove anonymous users? [Y/n] Y\n ... Success!\n\nNormally, root should only be allowed to connect from 'localhost'.  This\nensures that someone cannot guess at the root password from the network.\n\nDisallow root login remotely? [Y/n] Y\n ... Success!\n\nBy default, MariaDB comes with a database named 'test' that anyone can\naccess.  This is also intended only for testing, and should be removed\nbefore moving into a production environment.\n\nRemove test database and access to it? [Y/n] Y\n - Dropping test database...\n ... Success!\n - Removing privileges on test database...\n ... Success!\n\nReloading the privilege tables will ensure that all changes made so far\nwill take effect immediately.\n\nReload privilege tables now? [Y/n] Y\n ... Success!\n\nCleaning up...\n\nAll done!  If you've completed all of the above steps, your MariaDB\ninstallation should now be secure.\n\nThanks for using MariaDB!\n\n```\n根据提示设置好root帐号的密码，移除测试数据库等等，MariaDB就安装完成了。\n\n### Nginx+php-fpm，让Nginx能够解析php请求\n\n在安装好Nginx和php-fpm之后，需要配置一下Nginx。\n```\nserver {\n\n\t\tlisten 80;\n\t\tserver_name www.xxx.com;\n\t\t\n\t\troot /var/www/html;\n\t\tindex index.html index.htm index.php;\n\t\t\n\t\tlocation ~ \\.php$ {\n\t\t\t\n\t\t\tinclude fastcgi_params;\n\t\t\tfastcgi_pass 127.0.0.1:9000;\n\t\t\tfastcgi_index index.php;\n\t\t\tfastcgi_param SCRIPT_FILENAME /var/www/html$fastcgi_script_name;\n\t\t\n\t\t}\n\n\t}\n```\n\n开启php-fpm\n```bash\n[root@vultr lgsmb]# systemctl start php-fpm\n```\n在web根目录写个phpinfo\n```php\n<?php\n\tphpinfo();\n?>\n```\n访问一下，如果看到了phpinfo的页面，证明Nginx已经能够正常解析php文件了。\n","source":"_posts/Centos7-lnmp.md","raw":"---\ntitle: CentOS 7.2 搭建lnmp环境\ndate: 2017.3.11 11:08:20\ncategories: Linux\ntags:\n- CentOS\n- PHP\n- Nignx\n- MariaDB\n- LNMP\n---\n\n### Centos7 安装php7\n由于centos自己的软件仓库中的php版本为5.4，而yii2框架需要的php版本必须是5.4及以上。索性直接一步到位到7.0。为图方便就不使用编译安装的方式，而是采用yum安装方式.\n#### 首先rpm安装php7.0的yum源\n```bash\n[root@vultr ~]# rpm -Uvh https://mirror.webtatic.com/yum/el7/webtatic-release.rpm\n```\n<!-- more -->\n#### yum安装php7\n```bash\n[root@vultr ~]# yum install php70w\n```\n### yum安装php-fpm\n```bash\n[root@vultr ~]# yum install php70w-fpm\n```\n####  查看php版本\n```bash\n[root@vultr ~]# php -v\nPHP 7.0.16 (cli) (built: Feb 18 2017 10:25:02) ( NTS )\nCopyright (c) 1997-2017 The PHP Group\nZend Engine v3.0.0, Copyright (c) 1998-2017 Zend Technologies\n```\n\n### 安装MariaDB\n\n```bash\n[root@vultr ~]# yum install mariadb-server mariadb\n```\n启动MariaDB\n\n```bash\n[root@vultr ~]# systemctl start mariadb\n```\n刚刚安装好数据库，是没有设置root用户密码的，这样子显然是不安全的。在初次安装时，可以使用MariaDB自带的安全安装命令设置root用户密码。\n\n```bash\n[root@vultr ~]# mysql_secure_installation \n\nNOTE: RUNNING ALL PARTS OF THIS SCRIPT IS RECOMMENDED FOR ALL MariaDB\n      SERVERS IN PRODUCTION USE!  PLEASE READ EACH STEP CAREFULLY!\n\nIn order to log into MariaDB to secure it, we'll need the current\npassword for the root user.  If you've just installed MariaDB, and\nyou haven't set the root password yet, the password will be blank,\nso you should just press enter here.\n\nEnter current password for root (enter for none): \nERROR 1045 (28000): Access denied for user 'root'@'localhost' (using password: YES)\nEnter current password for root (enter for none): \nOK, successfully used password, moving on...\n\nSetting the root password ensures that nobody can log into the MariaDB\nroot user without the proper authorisation.\n\nSet root password? [Y/n] Y\nNew password: \nRe-enter new password: \nPassword updated successfully!\nReloading privilege tables..\n ... Success!\n\n\nBy default, a MariaDB installation has an anonymous user, allowing anyone\nto log into MariaDB without having to have a user account created for\nthem.  This is intended only for testing, and to make the installation\ngo a bit smoother.  You should remove them before moving into a\nproduction environment.\n\nRemove anonymous users? [Y/n] Y\n ... Success!\n\nNormally, root should only be allowed to connect from 'localhost'.  This\nensures that someone cannot guess at the root password from the network.\n\nDisallow root login remotely? [Y/n] Y\n ... Success!\n\nBy default, MariaDB comes with a database named 'test' that anyone can\naccess.  This is also intended only for testing, and should be removed\nbefore moving into a production environment.\n\nRemove test database and access to it? [Y/n] Y\n - Dropping test database...\n ... Success!\n - Removing privileges on test database...\n ... Success!\n\nReloading the privilege tables will ensure that all changes made so far\nwill take effect immediately.\n\nReload privilege tables now? [Y/n] Y\n ... Success!\n\nCleaning up...\n\nAll done!  If you've completed all of the above steps, your MariaDB\ninstallation should now be secure.\n\nThanks for using MariaDB!\n\n```\n根据提示设置好root帐号的密码，移除测试数据库等等，MariaDB就安装完成了。\n\n### Nginx+php-fpm，让Nginx能够解析php请求\n\n在安装好Nginx和php-fpm之后，需要配置一下Nginx。\n```\nserver {\n\n\t\tlisten 80;\n\t\tserver_name www.xxx.com;\n\t\t\n\t\troot /var/www/html;\n\t\tindex index.html index.htm index.php;\n\t\t\n\t\tlocation ~ \\.php$ {\n\t\t\t\n\t\t\tinclude fastcgi_params;\n\t\t\tfastcgi_pass 127.0.0.1:9000;\n\t\t\tfastcgi_index index.php;\n\t\t\tfastcgi_param SCRIPT_FILENAME /var/www/html$fastcgi_script_name;\n\t\t\n\t\t}\n\n\t}\n```\n\n开启php-fpm\n```bash\n[root@vultr lgsmb]# systemctl start php-fpm\n```\n在web根目录写个phpinfo\n```php\n<?php\n\tphpinfo();\n?>\n```\n访问一下，如果看到了phpinfo的页面，证明Nginx已经能够正常解析php文件了。\n","slug":"Centos7-lnmp","published":1,"updated":"2017-12-04T07:27:28.742Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjeqig1j80008lgqajk6hm6yb","content":"<h3 id=\"Centos7-安装php7\"><a href=\"#Centos7-安装php7\" class=\"headerlink\" title=\"Centos7 安装php7\"></a>Centos7 安装php7</h3><p>由于centos自己的软件仓库中的php版本为5.4，而yii2框架需要的php版本必须是5.4及以上。索性直接一步到位到7.0。为图方便就不使用编译安装的方式，而是采用yum安装方式.</p>\n<h4 id=\"首先rpm安装php7-0的yum源\"><a href=\"#首先rpm安装php7-0的yum源\" class=\"headerlink\" title=\"首先rpm安装php7.0的yum源\"></a>首先rpm安装php7.0的yum源</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@vultr ~]<span class=\"comment\"># rpm -Uvh https://mirror.webtatic.com/yum/el7/webtatic-release.rpm</span></span><br></pre></td></tr></table></figure>\n<a id=\"more\"></a>\n<h4 id=\"yum安装php7\"><a href=\"#yum安装php7\" class=\"headerlink\" title=\"yum安装php7\"></a>yum安装php7</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@vultr ~]<span class=\"comment\"># yum install php70w</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"yum安装php-fpm\"><a href=\"#yum安装php-fpm\" class=\"headerlink\" title=\"yum安装php-fpm\"></a>yum安装php-fpm</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@vultr ~]<span class=\"comment\"># yum install php70w-fpm</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"查看php版本\"><a href=\"#查看php版本\" class=\"headerlink\" title=\"查看php版本\"></a>查看php版本</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@vultr ~]<span class=\"comment\"># php -v</span></span><br><span class=\"line\">PHP 7.0.16 (cli) (built: Feb 18 2017 10:25:02) ( NTS )</span><br><span class=\"line\">Copyright (c) 1997-2017 The PHP Group</span><br><span class=\"line\">Zend Engine v3.0.0, Copyright (c) 1998-2017 Zend Technologies</span><br></pre></td></tr></table></figure>\n<h3 id=\"安装MariaDB\"><a href=\"#安装MariaDB\" class=\"headerlink\" title=\"安装MariaDB\"></a>安装MariaDB</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@vultr ~]<span class=\"comment\"># yum install mariadb-server mariadb</span></span><br></pre></td></tr></table></figure>\n<p>启动MariaDB</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@vultr ~]<span class=\"comment\"># systemctl start mariadb</span></span><br></pre></td></tr></table></figure>\n<p>刚刚安装好数据库，是没有设置root用户密码的，这样子显然是不安全的。在初次安装时，可以使用MariaDB自带的安全安装命令设置root用户密码。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@vultr ~]<span class=\"comment\"># mysql_secure_installation </span></span><br><span class=\"line\"></span><br><span class=\"line\">NOTE: RUNNING ALL PARTS OF THIS SCRIPT IS RECOMMENDED FOR ALL MariaDB</span><br><span class=\"line\">      SERVERS IN PRODUCTION USE!  PLEASE READ EACH STEP CAREFULLY!</span><br><span class=\"line\"></span><br><span class=\"line\">In order to <span class=\"built_in\">log</span> into MariaDB to secure it, we<span class=\"string\">'ll need the current</span></span><br><span class=\"line\"><span class=\"string\">password for the root user.  If you'</span>ve just installed MariaDB, and</span><br><span class=\"line\">you haven<span class=\"string\">'t set the root password yet, the password will be blank,</span></span><br><span class=\"line\"><span class=\"string\">so you should just press enter here.</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">Enter current password for root (enter for none): </span></span><br><span class=\"line\"><span class=\"string\">ERROR 1045 (28000): Access denied for user '</span>root<span class=\"string\">'@'</span>localhost<span class=\"string\">' (using password: YES)</span></span><br><span class=\"line\"><span class=\"string\">Enter current password for root (enter for none): </span></span><br><span class=\"line\"><span class=\"string\">OK, successfully used password, moving on...</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">Setting the root password ensures that nobody can log into the MariaDB</span></span><br><span class=\"line\"><span class=\"string\">root user without the proper authorisation.</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">Set root password? [Y/n] Y</span></span><br><span class=\"line\"><span class=\"string\">New password: </span></span><br><span class=\"line\"><span class=\"string\">Re-enter new password: </span></span><br><span class=\"line\"><span class=\"string\">Password updated successfully!</span></span><br><span class=\"line\"><span class=\"string\">Reloading privilege tables..</span></span><br><span class=\"line\"><span class=\"string\"> ... Success!</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">By default, a MariaDB installation has an anonymous user, allowing anyone</span></span><br><span class=\"line\"><span class=\"string\">to log into MariaDB without having to have a user account created for</span></span><br><span class=\"line\"><span class=\"string\">them.  This is intended only for testing, and to make the installation</span></span><br><span class=\"line\"><span class=\"string\">go a bit smoother.  You should remove them before moving into a</span></span><br><span class=\"line\"><span class=\"string\">production environment.</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">Remove anonymous users? [Y/n] Y</span></span><br><span class=\"line\"><span class=\"string\"> ... Success!</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">Normally, root should only be allowed to connect from '</span>localhost<span class=\"string\">'.  This</span></span><br><span class=\"line\"><span class=\"string\">ensures that someone cannot guess at the root password from the network.</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">Disallow root login remotely? [Y/n] Y</span></span><br><span class=\"line\"><span class=\"string\"> ... Success!</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">By default, MariaDB comes with a database named '</span><span class=\"built_in\">test</span><span class=\"string\">' that anyone can</span></span><br><span class=\"line\"><span class=\"string\">access.  This is also intended only for testing, and should be removed</span></span><br><span class=\"line\"><span class=\"string\">before moving into a production environment.</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">Remove test database and access to it? [Y/n] Y</span></span><br><span class=\"line\"><span class=\"string\"> - Dropping test database...</span></span><br><span class=\"line\"><span class=\"string\"> ... Success!</span></span><br><span class=\"line\"><span class=\"string\"> - Removing privileges on test database...</span></span><br><span class=\"line\"><span class=\"string\"> ... Success!</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">Reloading the privilege tables will ensure that all changes made so far</span></span><br><span class=\"line\"><span class=\"string\">will take effect immediately.</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">Reload privilege tables now? [Y/n] Y</span></span><br><span class=\"line\"><span class=\"string\"> ... Success!</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">Cleaning up...</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">All done!  If you'</span>ve completed all of the above steps, your MariaDB</span><br><span class=\"line\">installation should now be secure.</span><br><span class=\"line\"></span><br><span class=\"line\">Thanks <span class=\"keyword\">for</span> using MariaDB!</span><br></pre></td></tr></table></figure>\n<p>根据提示设置好root帐号的密码，移除测试数据库等等，MariaDB就安装完成了。</p>\n<h3 id=\"Nginx-php-fpm，让Nginx能够解析php请求\"><a href=\"#Nginx-php-fpm，让Nginx能够解析php请求\" class=\"headerlink\" title=\"Nginx+php-fpm，让Nginx能够解析php请求\"></a>Nginx+php-fpm，让Nginx能够解析php请求</h3><p>在安装好Nginx和php-fpm之后，需要配置一下Nginx。<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\tlisten 80;</span><br><span class=\"line\">\t\tserver_name www.xxx.com;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\troot /var/www/html;</span><br><span class=\"line\">\t\tindex index.html index.htm index.php;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\tlocation ~ \\.php$ &#123;</span><br><span class=\"line\">\t\t\t</span><br><span class=\"line\">\t\t\tinclude fastcgi_params;</span><br><span class=\"line\">\t\t\tfastcgi_pass 127.0.0.1:9000;</span><br><span class=\"line\">\t\t\tfastcgi_index index.php;</span><br><span class=\"line\">\t\t\tfastcgi_param SCRIPT_FILENAME /var/www/html$fastcgi_script_name;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#125;</span><br></pre></td></tr></table></figure></p>\n<p>开启php-fpm<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@vultr lgsmb]<span class=\"comment\"># systemctl start php-fpm</span></span><br></pre></td></tr></table></figure></p>\n<p>在web根目录写个phpinfo<br><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\">\tphpinfo();</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure></p>\n<p>访问一下，如果看到了phpinfo的页面，证明Nginx已经能够正常解析php文件了。</p>\n","site":{"data":{}},"excerpt":"<h3 id=\"Centos7-安装php7\"><a href=\"#Centos7-安装php7\" class=\"headerlink\" title=\"Centos7 安装php7\"></a>Centos7 安装php7</h3><p>由于centos自己的软件仓库中的php版本为5.4，而yii2框架需要的php版本必须是5.4及以上。索性直接一步到位到7.0。为图方便就不使用编译安装的方式，而是采用yum安装方式.</p>\n<h4 id=\"首先rpm安装php7-0的yum源\"><a href=\"#首先rpm安装php7-0的yum源\" class=\"headerlink\" title=\"首先rpm安装php7.0的yum源\"></a>首先rpm安装php7.0的yum源</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@vultr ~]<span class=\"comment\"># rpm -Uvh https://mirror.webtatic.com/yum/el7/webtatic-release.rpm</span></span><br></pre></td></tr></table></figure>","more":"<h4 id=\"yum安装php7\"><a href=\"#yum安装php7\" class=\"headerlink\" title=\"yum安装php7\"></a>yum安装php7</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@vultr ~]<span class=\"comment\"># yum install php70w</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"yum安装php-fpm\"><a href=\"#yum安装php-fpm\" class=\"headerlink\" title=\"yum安装php-fpm\"></a>yum安装php-fpm</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@vultr ~]<span class=\"comment\"># yum install php70w-fpm</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"查看php版本\"><a href=\"#查看php版本\" class=\"headerlink\" title=\"查看php版本\"></a>查看php版本</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@vultr ~]<span class=\"comment\"># php -v</span></span><br><span class=\"line\">PHP 7.0.16 (cli) (built: Feb 18 2017 10:25:02) ( NTS )</span><br><span class=\"line\">Copyright (c) 1997-2017 The PHP Group</span><br><span class=\"line\">Zend Engine v3.0.0, Copyright (c) 1998-2017 Zend Technologies</span><br></pre></td></tr></table></figure>\n<h3 id=\"安装MariaDB\"><a href=\"#安装MariaDB\" class=\"headerlink\" title=\"安装MariaDB\"></a>安装MariaDB</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@vultr ~]<span class=\"comment\"># yum install mariadb-server mariadb</span></span><br></pre></td></tr></table></figure>\n<p>启动MariaDB</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@vultr ~]<span class=\"comment\"># systemctl start mariadb</span></span><br></pre></td></tr></table></figure>\n<p>刚刚安装好数据库，是没有设置root用户密码的，这样子显然是不安全的。在初次安装时，可以使用MariaDB自带的安全安装命令设置root用户密码。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@vultr ~]<span class=\"comment\"># mysql_secure_installation </span></span><br><span class=\"line\"></span><br><span class=\"line\">NOTE: RUNNING ALL PARTS OF THIS SCRIPT IS RECOMMENDED FOR ALL MariaDB</span><br><span class=\"line\">      SERVERS IN PRODUCTION USE!  PLEASE READ EACH STEP CAREFULLY!</span><br><span class=\"line\"></span><br><span class=\"line\">In order to <span class=\"built_in\">log</span> into MariaDB to secure it, we<span class=\"string\">'ll need the current</span></span><br><span class=\"line\"><span class=\"string\">password for the root user.  If you'</span>ve just installed MariaDB, and</span><br><span class=\"line\">you haven<span class=\"string\">'t set the root password yet, the password will be blank,</span></span><br><span class=\"line\"><span class=\"string\">so you should just press enter here.</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">Enter current password for root (enter for none): </span></span><br><span class=\"line\"><span class=\"string\">ERROR 1045 (28000): Access denied for user '</span>root<span class=\"string\">'@'</span>localhost<span class=\"string\">' (using password: YES)</span></span><br><span class=\"line\"><span class=\"string\">Enter current password for root (enter for none): </span></span><br><span class=\"line\"><span class=\"string\">OK, successfully used password, moving on...</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">Setting the root password ensures that nobody can log into the MariaDB</span></span><br><span class=\"line\"><span class=\"string\">root user without the proper authorisation.</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">Set root password? [Y/n] Y</span></span><br><span class=\"line\"><span class=\"string\">New password: </span></span><br><span class=\"line\"><span class=\"string\">Re-enter new password: </span></span><br><span class=\"line\"><span class=\"string\">Password updated successfully!</span></span><br><span class=\"line\"><span class=\"string\">Reloading privilege tables..</span></span><br><span class=\"line\"><span class=\"string\"> ... Success!</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">By default, a MariaDB installation has an anonymous user, allowing anyone</span></span><br><span class=\"line\"><span class=\"string\">to log into MariaDB without having to have a user account created for</span></span><br><span class=\"line\"><span class=\"string\">them.  This is intended only for testing, and to make the installation</span></span><br><span class=\"line\"><span class=\"string\">go a bit smoother.  You should remove them before moving into a</span></span><br><span class=\"line\"><span class=\"string\">production environment.</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">Remove anonymous users? [Y/n] Y</span></span><br><span class=\"line\"><span class=\"string\"> ... Success!</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">Normally, root should only be allowed to connect from '</span>localhost<span class=\"string\">'.  This</span></span><br><span class=\"line\"><span class=\"string\">ensures that someone cannot guess at the root password from the network.</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">Disallow root login remotely? [Y/n] Y</span></span><br><span class=\"line\"><span class=\"string\"> ... Success!</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">By default, MariaDB comes with a database named '</span><span class=\"built_in\">test</span><span class=\"string\">' that anyone can</span></span><br><span class=\"line\"><span class=\"string\">access.  This is also intended only for testing, and should be removed</span></span><br><span class=\"line\"><span class=\"string\">before moving into a production environment.</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">Remove test database and access to it? [Y/n] Y</span></span><br><span class=\"line\"><span class=\"string\"> - Dropping test database...</span></span><br><span class=\"line\"><span class=\"string\"> ... Success!</span></span><br><span class=\"line\"><span class=\"string\"> - Removing privileges on test database...</span></span><br><span class=\"line\"><span class=\"string\"> ... Success!</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">Reloading the privilege tables will ensure that all changes made so far</span></span><br><span class=\"line\"><span class=\"string\">will take effect immediately.</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">Reload privilege tables now? [Y/n] Y</span></span><br><span class=\"line\"><span class=\"string\"> ... Success!</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">Cleaning up...</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">All done!  If you'</span>ve completed all of the above steps, your MariaDB</span><br><span class=\"line\">installation should now be secure.</span><br><span class=\"line\"></span><br><span class=\"line\">Thanks <span class=\"keyword\">for</span> using MariaDB!</span><br></pre></td></tr></table></figure>\n<p>根据提示设置好root帐号的密码，移除测试数据库等等，MariaDB就安装完成了。</p>\n<h3 id=\"Nginx-php-fpm，让Nginx能够解析php请求\"><a href=\"#Nginx-php-fpm，让Nginx能够解析php请求\" class=\"headerlink\" title=\"Nginx+php-fpm，让Nginx能够解析php请求\"></a>Nginx+php-fpm，让Nginx能够解析php请求</h3><p>在安装好Nginx和php-fpm之后，需要配置一下Nginx。<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\tlisten 80;</span><br><span class=\"line\">\t\tserver_name www.xxx.com;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\troot /var/www/html;</span><br><span class=\"line\">\t\tindex index.html index.htm index.php;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\tlocation ~ \\.php$ &#123;</span><br><span class=\"line\">\t\t\t</span><br><span class=\"line\">\t\t\tinclude fastcgi_params;</span><br><span class=\"line\">\t\t\tfastcgi_pass 127.0.0.1:9000;</span><br><span class=\"line\">\t\t\tfastcgi_index index.php;</span><br><span class=\"line\">\t\t\tfastcgi_param SCRIPT_FILENAME /var/www/html$fastcgi_script_name;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#125;</span><br></pre></td></tr></table></figure></p>\n<p>开启php-fpm<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@vultr lgsmb]<span class=\"comment\"># systemctl start php-fpm</span></span><br></pre></td></tr></table></figure></p>\n<p>在web根目录写个phpinfo<br><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\">\tphpinfo();</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure></p>\n<p>访问一下，如果看到了phpinfo的页面，证明Nginx已经能够正常解析php文件了。</p>"},{"title":"在自己的VPS上编译部署Ngrok","date":"2017-06-02T03:12:12.000Z","_content":"\n由于我有一些测试服务需要从内网映射到公网，但是又不想使用其他第三方的转发服务，索性就自己编译一把Ngrok放到自己的服务器上用吧。\n\n<!-- more -->\n\n### Ngrok是个啥？\n\n> ngrok is a reverse proxy that creates a secure tunnel from a public endpoint to a locally running web service. ngrok captures and analyzes all traffic over the tunnel for later inspection and replay.\n>\n> -------github上作者对ngrok的说明\n\n简单的来说，ngrok就是一个反向代理，可以通过公网服务器来和本地内网机器之间建立一个隧道，使得可以从外网访问内网的服务。\n\n### 准备工作\n\n1.在服务器上搭建go环境\n\n我选择直接下载go的源码\n\n>  [http://www.golangtc.com/download](http://www.golangtc.com/download) \n\n选取适合服务器系统的go环境压缩包，由于我的VPS是Centos 7 64位，所以我下载的是1.8 amd64\n\n```bash\n[root@vultr ngrok_compile]# wget http://www.golangtc.com/static/go/1.8/go1.8.linux-amd64.tar.gz\n```\n\n然后需要解压一下，需要注意的是要把go解压到/usr/local，免得后面出现一些不可描述的问题。\n\n```bash\n[root@vultr ngrok_compile]# tar -C /usr/local  -xzf go1.8.linux-amd64.tar.gz\n```\n\n为go创建个软连接到/usr/bin，方便直接使用go命令\n\n```bash\n[root@vultr ngrok_compile]# ln -s /usr/local/go/bin/* /usr/bin\n```\n\n到此，go环境就搭建好了。\n\n2.克隆ngrok的git仓库到本地\n\n```bash\n[root@vultr ngrok_compile]# git clone https://github.com/inconshreveable/ngrok.git\n```\n\n3.设置一些编译所需的环境变量\n\n```bash\n[root@vultr ngrok]# export GOPATH=/opt/ngrok_compile/ngrok/\n[root@vultr ngrok]# export NGROK_DOMAIN=\"ngrok.star-chen.com\"\n```\n\n4.为域名生成证书\n\n```bash\n[root@vultr ngrok_compile]# cd ngrok\n[root@vultr ngrok]# openssl genrsa -out rootCA.key 2048\n[root@vultr ngrok]# openssl req -x509 -new -nodes -key rootCA.key -subj \"/CN=$NGROK_DOMAIN\" days 5000 -out rootCA.pem\n[root@vultr ngrok]# openssl req -x509 -new -nodes -key rootCA.key -subj \"/CN=$NGROK_DOMAIN\" -days 5000 -out rootCA.pem\n[root@vultr ngrok]# openssl -genrsa -out sever.key 2048\n[root@vultr ngrok]# openssl genrsa -out sever.key 2048\n[root@vultr ngrok]# openssl req -new -key server.key -subj \"/CN=$NGROK_DOMAIN\" -out server.csr\n[root@vultr ngrok]# openssl genrsa -out server.key 2048\n[root@vultr ngrok]# openssl req -new -key server.key -subj \"/CN=$NGROK_DOMAIN\" -out server.csr\n[root@vultr ngrok]# openssl x509 -req -in server.csr -CA rootCA.pem -CAkey rootCA.key -CAcreateserial -out server.crt -days 5000\n```\n5.把生成的证书拷贝到指定的目录下\n\n```bash\n[root@vultr ngrok]# cp rootCA.pem assets/client/tls/ngrokroot.crt \n[root@vultr ngrok]# cp server.crt assets/server/tls/snakeoil.crt \n[root@vultr ngrok]# cp server.key assets/server/tls/snakeoil.key \n```\n\n6.为域名设置A记录泛解析\n\n![img](/blogimg/fan.png)\n\n### 开始编译\n\n```bash\n#先编译个Linux 64位的服务端和客户端程序\n[root@vultr ngrok]#  GOOS=linux GOARCH=amd64 make release-server\n[root@vultr ngrok]#  GOOS=linux GOARCH=amd64 make release-client\n#再编译个windows64位的客户端\n[root@vultr ngrok]#  GOOS=windows GOARCH=amd64 make release-client\n```\n\n看一下编译好的程序\n\n```bash\n[root@vultr ngrok]# ls -la bin\ntotal 21544\ndrwxr-xr-x 3 root root     4096 Jun  2 03:06 .\ndrwxr-xr-x 9 root root     4096 Jun  2 02:31 ..\n-rwxr-xr-x 1 root root  2527810 Jun  2 02:31 go-bindata\n-rwxr-xr-x 1 root root 10672322 Jun  2 02:31 ngrok\n-rwxr-xr-x 1 root root  8841733 Jun  2 03:06 ngrokd\ndrwxr-xr-x 2 root root     4096 Jun  2 02:35 windows_amd64\n\n```\n\n### 运行测试\n\n服务端：\n\n```bash\n #因为我的服务上的80和443端口上运行着这个博客，所以我把http和https的端口进行了更改\n [root@vultr ngrok]# bin/ngrokd -domain=ngrok.star-chen.com -httpAddr=\":8080\" -httpsAddr=\":8081\"\n[04:00:34 UTC 2017/06/02] [INFO] (ngrok/log.(*PrefixLogger).Info:83) [registry] [tun] No affinity cache specified\n[04:00:34 UTC 2017/06/02] [INFO] (ngrok/log.Info:112) Listening for public http connections on [::]:8080\n[04:00:34 UTC 2017/06/02] [INFO] (ngrok/log.Info:112) Listening for public https connections on [::]:8081\n[04:00:34 UTC 2017/06/02] [INFO] (ngrok/log.Info:112) Listening for control and proxy connections on [::]:4443\n[04:00:34 UTC 2017/06/02] [INFO] (ngrok/log.(*PrefixLogger).Info:83) [metrics] Reporting every 30 seconds\n\n\n```\n\nwindows客户端:\n\n在ngrok.exe的所在目录新建一个简单的配置文件，内容如下：\n\n```\nserver_addr: \"ngrok.star-chen.com:4443\"   #尤其注意，这里的域名需要和你生成证书所使用的域名一致\ntrust_host_root_certs: false  \n```\n\n运行客户端程序：\n\n```cmd\nPS G:\\> .\\ngrok.exe -config .\\ngrok.cfg  -subdomain local 80 #subdomain为指定的子域名\n```\n\n运行的显示，status为online则表明已经建立了转发连接。\n\n```cmd\nngrok\n\nTunnel Status                 online\nVersion                       1.7/1.7\nForwarding                    http://local.ngrok.star-chen.com:8080 -> 127.0.0.1:80\nForwarding                    https://local.ngrok.star-chen.com:8080 -> 127.0.0.1:80\nWeb Interface                 127.0.0.1:4040\n# Conn                        0\nAvg Conn Time                 0.00ms\n\n\n```\n\n然后访问 http://local.ngrok.star-chen.com:8080  就可以访问到我本机的xampp测试环境了。当然客户端还可以转发tcp连接，例如我的虚拟机里边的ssh：\n\n```cmd\nPS G:\\> .\\ngrok.exe -config .\\ngrok.cfg  -proto tcp 192.168.10.176:22\n```\n\n这样子，在外边也可以方便的ssh到内网中的虚拟机了。","source":"_posts/CompileNgrok.md","raw":"---\ntitle: 在自己的VPS上编译部署Ngrok\ncategories:\n  - Linux\ntags:\n  - 转发\ndate: 2017-06-02 11:12:12\n---\n\n由于我有一些测试服务需要从内网映射到公网，但是又不想使用其他第三方的转发服务，索性就自己编译一把Ngrok放到自己的服务器上用吧。\n\n<!-- more -->\n\n### Ngrok是个啥？\n\n> ngrok is a reverse proxy that creates a secure tunnel from a public endpoint to a locally running web service. ngrok captures and analyzes all traffic over the tunnel for later inspection and replay.\n>\n> -------github上作者对ngrok的说明\n\n简单的来说，ngrok就是一个反向代理，可以通过公网服务器来和本地内网机器之间建立一个隧道，使得可以从外网访问内网的服务。\n\n### 准备工作\n\n1.在服务器上搭建go环境\n\n我选择直接下载go的源码\n\n>  [http://www.golangtc.com/download](http://www.golangtc.com/download) \n\n选取适合服务器系统的go环境压缩包，由于我的VPS是Centos 7 64位，所以我下载的是1.8 amd64\n\n```bash\n[root@vultr ngrok_compile]# wget http://www.golangtc.com/static/go/1.8/go1.8.linux-amd64.tar.gz\n```\n\n然后需要解压一下，需要注意的是要把go解压到/usr/local，免得后面出现一些不可描述的问题。\n\n```bash\n[root@vultr ngrok_compile]# tar -C /usr/local  -xzf go1.8.linux-amd64.tar.gz\n```\n\n为go创建个软连接到/usr/bin，方便直接使用go命令\n\n```bash\n[root@vultr ngrok_compile]# ln -s /usr/local/go/bin/* /usr/bin\n```\n\n到此，go环境就搭建好了。\n\n2.克隆ngrok的git仓库到本地\n\n```bash\n[root@vultr ngrok_compile]# git clone https://github.com/inconshreveable/ngrok.git\n```\n\n3.设置一些编译所需的环境变量\n\n```bash\n[root@vultr ngrok]# export GOPATH=/opt/ngrok_compile/ngrok/\n[root@vultr ngrok]# export NGROK_DOMAIN=\"ngrok.star-chen.com\"\n```\n\n4.为域名生成证书\n\n```bash\n[root@vultr ngrok_compile]# cd ngrok\n[root@vultr ngrok]# openssl genrsa -out rootCA.key 2048\n[root@vultr ngrok]# openssl req -x509 -new -nodes -key rootCA.key -subj \"/CN=$NGROK_DOMAIN\" days 5000 -out rootCA.pem\n[root@vultr ngrok]# openssl req -x509 -new -nodes -key rootCA.key -subj \"/CN=$NGROK_DOMAIN\" -days 5000 -out rootCA.pem\n[root@vultr ngrok]# openssl -genrsa -out sever.key 2048\n[root@vultr ngrok]# openssl genrsa -out sever.key 2048\n[root@vultr ngrok]# openssl req -new -key server.key -subj \"/CN=$NGROK_DOMAIN\" -out server.csr\n[root@vultr ngrok]# openssl genrsa -out server.key 2048\n[root@vultr ngrok]# openssl req -new -key server.key -subj \"/CN=$NGROK_DOMAIN\" -out server.csr\n[root@vultr ngrok]# openssl x509 -req -in server.csr -CA rootCA.pem -CAkey rootCA.key -CAcreateserial -out server.crt -days 5000\n```\n5.把生成的证书拷贝到指定的目录下\n\n```bash\n[root@vultr ngrok]# cp rootCA.pem assets/client/tls/ngrokroot.crt \n[root@vultr ngrok]# cp server.crt assets/server/tls/snakeoil.crt \n[root@vultr ngrok]# cp server.key assets/server/tls/snakeoil.key \n```\n\n6.为域名设置A记录泛解析\n\n![img](/blogimg/fan.png)\n\n### 开始编译\n\n```bash\n#先编译个Linux 64位的服务端和客户端程序\n[root@vultr ngrok]#  GOOS=linux GOARCH=amd64 make release-server\n[root@vultr ngrok]#  GOOS=linux GOARCH=amd64 make release-client\n#再编译个windows64位的客户端\n[root@vultr ngrok]#  GOOS=windows GOARCH=amd64 make release-client\n```\n\n看一下编译好的程序\n\n```bash\n[root@vultr ngrok]# ls -la bin\ntotal 21544\ndrwxr-xr-x 3 root root     4096 Jun  2 03:06 .\ndrwxr-xr-x 9 root root     4096 Jun  2 02:31 ..\n-rwxr-xr-x 1 root root  2527810 Jun  2 02:31 go-bindata\n-rwxr-xr-x 1 root root 10672322 Jun  2 02:31 ngrok\n-rwxr-xr-x 1 root root  8841733 Jun  2 03:06 ngrokd\ndrwxr-xr-x 2 root root     4096 Jun  2 02:35 windows_amd64\n\n```\n\n### 运行测试\n\n服务端：\n\n```bash\n #因为我的服务上的80和443端口上运行着这个博客，所以我把http和https的端口进行了更改\n [root@vultr ngrok]# bin/ngrokd -domain=ngrok.star-chen.com -httpAddr=\":8080\" -httpsAddr=\":8081\"\n[04:00:34 UTC 2017/06/02] [INFO] (ngrok/log.(*PrefixLogger).Info:83) [registry] [tun] No affinity cache specified\n[04:00:34 UTC 2017/06/02] [INFO] (ngrok/log.Info:112) Listening for public http connections on [::]:8080\n[04:00:34 UTC 2017/06/02] [INFO] (ngrok/log.Info:112) Listening for public https connections on [::]:8081\n[04:00:34 UTC 2017/06/02] [INFO] (ngrok/log.Info:112) Listening for control and proxy connections on [::]:4443\n[04:00:34 UTC 2017/06/02] [INFO] (ngrok/log.(*PrefixLogger).Info:83) [metrics] Reporting every 30 seconds\n\n\n```\n\nwindows客户端:\n\n在ngrok.exe的所在目录新建一个简单的配置文件，内容如下：\n\n```\nserver_addr: \"ngrok.star-chen.com:4443\"   #尤其注意，这里的域名需要和你生成证书所使用的域名一致\ntrust_host_root_certs: false  \n```\n\n运行客户端程序：\n\n```cmd\nPS G:\\> .\\ngrok.exe -config .\\ngrok.cfg  -subdomain local 80 #subdomain为指定的子域名\n```\n\n运行的显示，status为online则表明已经建立了转发连接。\n\n```cmd\nngrok\n\nTunnel Status                 online\nVersion                       1.7/1.7\nForwarding                    http://local.ngrok.star-chen.com:8080 -> 127.0.0.1:80\nForwarding                    https://local.ngrok.star-chen.com:8080 -> 127.0.0.1:80\nWeb Interface                 127.0.0.1:4040\n# Conn                        0\nAvg Conn Time                 0.00ms\n\n\n```\n\n然后访问 http://local.ngrok.star-chen.com:8080  就可以访问到我本机的xampp测试环境了。当然客户端还可以转发tcp连接，例如我的虚拟机里边的ssh：\n\n```cmd\nPS G:\\> .\\ngrok.exe -config .\\ngrok.cfg  -proto tcp 192.168.10.176:22\n```\n\n这样子，在外边也可以方便的ssh到内网中的虚拟机了。","slug":"CompileNgrok","published":1,"updated":"2017-12-04T07:27:28.743Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjeqig1jc000blgqa04ubzg8j","content":"<p>由于我有一些测试服务需要从内网映射到公网，但是又不想使用其他第三方的转发服务，索性就自己编译一把Ngrok放到自己的服务器上用吧。</p>\n<a id=\"more\"></a>\n<h3 id=\"Ngrok是个啥？\"><a href=\"#Ngrok是个啥？\" class=\"headerlink\" title=\"Ngrok是个啥？\"></a>Ngrok是个啥？</h3><blockquote>\n<p>ngrok is a reverse proxy that creates a secure tunnel from a public endpoint to a locally running web service. ngrok captures and analyzes all traffic over the tunnel for later inspection and replay.</p>\n<p>——-github上作者对ngrok的说明</p>\n</blockquote>\n<p>简单的来说，ngrok就是一个反向代理，可以通过公网服务器来和本地内网机器之间建立一个隧道，使得可以从外网访问内网的服务。</p>\n<h3 id=\"准备工作\"><a href=\"#准备工作\" class=\"headerlink\" title=\"准备工作\"></a>准备工作</h3><p>1.在服务器上搭建go环境</p>\n<p>我选择直接下载go的源码</p>\n<blockquote>\n<p> <a href=\"http://www.golangtc.com/download\" target=\"_blank\" rel=\"noopener\">http://www.golangtc.com/download</a> </p>\n</blockquote>\n<p>选取适合服务器系统的go环境压缩包，由于我的VPS是Centos 7 64位，所以我下载的是1.8 amd64</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@vultr ngrok_compile]<span class=\"comment\"># wget http://www.golangtc.com/static/go/1.8/go1.8.linux-amd64.tar.gz</span></span><br></pre></td></tr></table></figure>\n<p>然后需要解压一下，需要注意的是要把go解压到/usr/local，免得后面出现一些不可描述的问题。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@vultr ngrok_compile]<span class=\"comment\"># tar -C /usr/local  -xzf go1.8.linux-amd64.tar.gz</span></span><br></pre></td></tr></table></figure>\n<p>为go创建个软连接到/usr/bin，方便直接使用go命令</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@vultr ngrok_compile]<span class=\"comment\"># ln -s /usr/local/go/bin/* /usr/bin</span></span><br></pre></td></tr></table></figure>\n<p>到此，go环境就搭建好了。</p>\n<p>2.克隆ngrok的git仓库到本地</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@vultr ngrok_compile]<span class=\"comment\"># git clone https://github.com/inconshreveable/ngrok.git</span></span><br></pre></td></tr></table></figure>\n<p>3.设置一些编译所需的环境变量</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@vultr ngrok]<span class=\"comment\"># export GOPATH=/opt/ngrok_compile/ngrok/</span></span><br><span class=\"line\">[root@vultr ngrok]<span class=\"comment\"># export NGROK_DOMAIN=\"ngrok.star-chen.com\"</span></span><br></pre></td></tr></table></figure>\n<p>4.为域名生成证书</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@vultr ngrok_compile]<span class=\"comment\"># cd ngrok</span></span><br><span class=\"line\">[root@vultr ngrok]<span class=\"comment\"># openssl genrsa -out rootCA.key 2048</span></span><br><span class=\"line\">[root@vultr ngrok]<span class=\"comment\"># openssl req -x509 -new -nodes -key rootCA.key -subj \"/CN=$NGROK_DOMAIN\" days 5000 -out rootCA.pem</span></span><br><span class=\"line\">[root@vultr ngrok]<span class=\"comment\"># openssl req -x509 -new -nodes -key rootCA.key -subj \"/CN=$NGROK_DOMAIN\" -days 5000 -out rootCA.pem</span></span><br><span class=\"line\">[root@vultr ngrok]<span class=\"comment\"># openssl -genrsa -out sever.key 2048</span></span><br><span class=\"line\">[root@vultr ngrok]<span class=\"comment\"># openssl genrsa -out sever.key 2048</span></span><br><span class=\"line\">[root@vultr ngrok]<span class=\"comment\"># openssl req -new -key server.key -subj \"/CN=$NGROK_DOMAIN\" -out server.csr</span></span><br><span class=\"line\">[root@vultr ngrok]<span class=\"comment\"># openssl genrsa -out server.key 2048</span></span><br><span class=\"line\">[root@vultr ngrok]<span class=\"comment\"># openssl req -new -key server.key -subj \"/CN=$NGROK_DOMAIN\" -out server.csr</span></span><br><span class=\"line\">[root@vultr ngrok]<span class=\"comment\"># openssl x509 -req -in server.csr -CA rootCA.pem -CAkey rootCA.key -CAcreateserial -out server.crt -days 5000</span></span><br></pre></td></tr></table></figure>\n<p>5.把生成的证书拷贝到指定的目录下</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@vultr ngrok]<span class=\"comment\"># cp rootCA.pem assets/client/tls/ngrokroot.crt </span></span><br><span class=\"line\">[root@vultr ngrok]<span class=\"comment\"># cp server.crt assets/server/tls/snakeoil.crt </span></span><br><span class=\"line\">[root@vultr ngrok]<span class=\"comment\"># cp server.key assets/server/tls/snakeoil.key</span></span><br></pre></td></tr></table></figure>\n<p>6.为域名设置A记录泛解析</p>\n<p><img src=\"/blogimg/fan.png\" alt=\"img\"></p>\n<h3 id=\"开始编译\"><a href=\"#开始编译\" class=\"headerlink\" title=\"开始编译\"></a>开始编译</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#先编译个Linux 64位的服务端和客户端程序</span></span><br><span class=\"line\">[root@vultr ngrok]<span class=\"comment\">#  GOOS=linux GOARCH=amd64 make release-server</span></span><br><span class=\"line\">[root@vultr ngrok]<span class=\"comment\">#  GOOS=linux GOARCH=amd64 make release-client</span></span><br><span class=\"line\"><span class=\"comment\">#再编译个windows64位的客户端</span></span><br><span class=\"line\">[root@vultr ngrok]<span class=\"comment\">#  GOOS=windows GOARCH=amd64 make release-client</span></span><br></pre></td></tr></table></figure>\n<p>看一下编译好的程序</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@vultr ngrok]<span class=\"comment\"># ls -la bin</span></span><br><span class=\"line\">total 21544</span><br><span class=\"line\">drwxr-xr-x 3 root root     4096 Jun  2 03:06 .</span><br><span class=\"line\">drwxr-xr-x 9 root root     4096 Jun  2 02:31 ..</span><br><span class=\"line\">-rwxr-xr-x 1 root root  2527810 Jun  2 02:31 go-bindata</span><br><span class=\"line\">-rwxr-xr-x 1 root root 10672322 Jun  2 02:31 ngrok</span><br><span class=\"line\">-rwxr-xr-x 1 root root  8841733 Jun  2 03:06 ngrokd</span><br><span class=\"line\">drwxr-xr-x 2 root root     4096 Jun  2 02:35 windows_amd64</span><br></pre></td></tr></table></figure>\n<h3 id=\"运行测试\"><a href=\"#运行测试\" class=\"headerlink\" title=\"运行测试\"></a>运行测试</h3><p>服务端：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> <span class=\"comment\">#因为我的服务上的80和443端口上运行着这个博客，所以我把http和https的端口进行了更改</span></span><br><span class=\"line\"> [root@vultr ngrok]<span class=\"comment\"># bin/ngrokd -domain=ngrok.star-chen.com -httpAddr=\":8080\" -httpsAddr=\":8081\"</span></span><br><span class=\"line\">[04:00:34 UTC 2017/06/02] [INFO] (ngrok/<span class=\"built_in\">log</span>.(*PrefixLogger).Info:83) [registry] [tun] No affinity cache specified</span><br><span class=\"line\">[04:00:34 UTC 2017/06/02] [INFO] (ngrok/log.Info:112) Listening <span class=\"keyword\">for</span> public http connections on [::]:8080</span><br><span class=\"line\">[04:00:34 UTC 2017/06/02] [INFO] (ngrok/log.Info:112) Listening <span class=\"keyword\">for</span> public https connections on [::]:8081</span><br><span class=\"line\">[04:00:34 UTC 2017/06/02] [INFO] (ngrok/log.Info:112) Listening <span class=\"keyword\">for</span> control and proxy connections on [::]:4443</span><br><span class=\"line\">[04:00:34 UTC 2017/06/02] [INFO] (ngrok/<span class=\"built_in\">log</span>.(*PrefixLogger).Info:83) [metrics] Reporting every 30 seconds</span><br></pre></td></tr></table></figure>\n<p>windows客户端:</p>\n<p>在ngrok.exe的所在目录新建一个简单的配置文件，内容如下：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server_addr: &quot;ngrok.star-chen.com:4443&quot;   #尤其注意，这里的域名需要和你生成证书所使用的域名一致</span><br><span class=\"line\">trust_host_root_certs: false</span><br></pre></td></tr></table></figure>\n<p>运行客户端程序：</p>\n<figure class=\"highlight cmd\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PS G:\\&gt; .\\ngrok.exe -config .\\ngrok.cfg  -subdomain local <span class=\"number\">80</span> #subdomain为指定的子域名</span><br></pre></td></tr></table></figure>\n<p>运行的显示，status为online则表明已经建立了转发连接。</p>\n<figure class=\"highlight cmd\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ngrok</span><br><span class=\"line\"></span><br><span class=\"line\">Tunnel Status                 online</span><br><span class=\"line\">Version                       <span class=\"number\">1</span>.<span class=\"number\">7</span>/<span class=\"number\">1</span>.<span class=\"number\">7</span></span><br><span class=\"line\">Forwarding                    http://local.ngrok.star-chen.com:<span class=\"number\">8080</span> -&gt; <span class=\"number\">127</span>.<span class=\"number\">0</span>.<span class=\"number\">0</span>.<span class=\"number\">1</span>:<span class=\"number\">80</span></span><br><span class=\"line\">Forwarding                    https://local.ngrok.star-chen.com:<span class=\"number\">8080</span> -&gt; <span class=\"number\">127</span>.<span class=\"number\">0</span>.<span class=\"number\">0</span>.<span class=\"number\">1</span>:<span class=\"number\">80</span></span><br><span class=\"line\">Web Interface                 <span class=\"number\">127</span>.<span class=\"number\">0</span>.<span class=\"number\">0</span>.<span class=\"number\">1</span>:<span class=\"number\">4040</span></span><br><span class=\"line\"># Conn                        <span class=\"number\">0</span></span><br><span class=\"line\">Avg Conn <span class=\"built_in\">Time</span>                 <span class=\"number\">0</span>.<span class=\"number\">00</span>ms</span><br></pre></td></tr></table></figure>\n<p>然后访问 <a href=\"http://local.ngrok.star-chen.com:8080\" target=\"_blank\" rel=\"noopener\">http://local.ngrok.star-chen.com:8080</a>  就可以访问到我本机的xampp测试环境了。当然客户端还可以转发tcp连接，例如我的虚拟机里边的ssh：</p>\n<figure class=\"highlight cmd\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PS G:\\&gt; .\\ngrok.exe -config .\\ngrok.cfg  -proto tcp <span class=\"number\">192</span>.<span class=\"number\">168</span>.<span class=\"number\">10</span>.<span class=\"number\">176</span>:<span class=\"number\">22</span></span><br></pre></td></tr></table></figure>\n<p>这样子，在外边也可以方便的ssh到内网中的虚拟机了。</p>\n","site":{"data":{}},"excerpt":"<p>由于我有一些测试服务需要从内网映射到公网，但是又不想使用其他第三方的转发服务，索性就自己编译一把Ngrok放到自己的服务器上用吧。</p>","more":"<h3 id=\"Ngrok是个啥？\"><a href=\"#Ngrok是个啥？\" class=\"headerlink\" title=\"Ngrok是个啥？\"></a>Ngrok是个啥？</h3><blockquote>\n<p>ngrok is a reverse proxy that creates a secure tunnel from a public endpoint to a locally running web service. ngrok captures and analyzes all traffic over the tunnel for later inspection and replay.</p>\n<p>——-github上作者对ngrok的说明</p>\n</blockquote>\n<p>简单的来说，ngrok就是一个反向代理，可以通过公网服务器来和本地内网机器之间建立一个隧道，使得可以从外网访问内网的服务。</p>\n<h3 id=\"准备工作\"><a href=\"#准备工作\" class=\"headerlink\" title=\"准备工作\"></a>准备工作</h3><p>1.在服务器上搭建go环境</p>\n<p>我选择直接下载go的源码</p>\n<blockquote>\n<p> <a href=\"http://www.golangtc.com/download\" target=\"_blank\" rel=\"noopener\">http://www.golangtc.com/download</a> </p>\n</blockquote>\n<p>选取适合服务器系统的go环境压缩包，由于我的VPS是Centos 7 64位，所以我下载的是1.8 amd64</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@vultr ngrok_compile]<span class=\"comment\"># wget http://www.golangtc.com/static/go/1.8/go1.8.linux-amd64.tar.gz</span></span><br></pre></td></tr></table></figure>\n<p>然后需要解压一下，需要注意的是要把go解压到/usr/local，免得后面出现一些不可描述的问题。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@vultr ngrok_compile]<span class=\"comment\"># tar -C /usr/local  -xzf go1.8.linux-amd64.tar.gz</span></span><br></pre></td></tr></table></figure>\n<p>为go创建个软连接到/usr/bin，方便直接使用go命令</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@vultr ngrok_compile]<span class=\"comment\"># ln -s /usr/local/go/bin/* /usr/bin</span></span><br></pre></td></tr></table></figure>\n<p>到此，go环境就搭建好了。</p>\n<p>2.克隆ngrok的git仓库到本地</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@vultr ngrok_compile]<span class=\"comment\"># git clone https://github.com/inconshreveable/ngrok.git</span></span><br></pre></td></tr></table></figure>\n<p>3.设置一些编译所需的环境变量</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@vultr ngrok]<span class=\"comment\"># export GOPATH=/opt/ngrok_compile/ngrok/</span></span><br><span class=\"line\">[root@vultr ngrok]<span class=\"comment\"># export NGROK_DOMAIN=\"ngrok.star-chen.com\"</span></span><br></pre></td></tr></table></figure>\n<p>4.为域名生成证书</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@vultr ngrok_compile]<span class=\"comment\"># cd ngrok</span></span><br><span class=\"line\">[root@vultr ngrok]<span class=\"comment\"># openssl genrsa -out rootCA.key 2048</span></span><br><span class=\"line\">[root@vultr ngrok]<span class=\"comment\"># openssl req -x509 -new -nodes -key rootCA.key -subj \"/CN=$NGROK_DOMAIN\" days 5000 -out rootCA.pem</span></span><br><span class=\"line\">[root@vultr ngrok]<span class=\"comment\"># openssl req -x509 -new -nodes -key rootCA.key -subj \"/CN=$NGROK_DOMAIN\" -days 5000 -out rootCA.pem</span></span><br><span class=\"line\">[root@vultr ngrok]<span class=\"comment\"># openssl -genrsa -out sever.key 2048</span></span><br><span class=\"line\">[root@vultr ngrok]<span class=\"comment\"># openssl genrsa -out sever.key 2048</span></span><br><span class=\"line\">[root@vultr ngrok]<span class=\"comment\"># openssl req -new -key server.key -subj \"/CN=$NGROK_DOMAIN\" -out server.csr</span></span><br><span class=\"line\">[root@vultr ngrok]<span class=\"comment\"># openssl genrsa -out server.key 2048</span></span><br><span class=\"line\">[root@vultr ngrok]<span class=\"comment\"># openssl req -new -key server.key -subj \"/CN=$NGROK_DOMAIN\" -out server.csr</span></span><br><span class=\"line\">[root@vultr ngrok]<span class=\"comment\"># openssl x509 -req -in server.csr -CA rootCA.pem -CAkey rootCA.key -CAcreateserial -out server.crt -days 5000</span></span><br></pre></td></tr></table></figure>\n<p>5.把生成的证书拷贝到指定的目录下</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@vultr ngrok]<span class=\"comment\"># cp rootCA.pem assets/client/tls/ngrokroot.crt </span></span><br><span class=\"line\">[root@vultr ngrok]<span class=\"comment\"># cp server.crt assets/server/tls/snakeoil.crt </span></span><br><span class=\"line\">[root@vultr ngrok]<span class=\"comment\"># cp server.key assets/server/tls/snakeoil.key</span></span><br></pre></td></tr></table></figure>\n<p>6.为域名设置A记录泛解析</p>\n<p><img src=\"/blogimg/fan.png\" alt=\"img\"></p>\n<h3 id=\"开始编译\"><a href=\"#开始编译\" class=\"headerlink\" title=\"开始编译\"></a>开始编译</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#先编译个Linux 64位的服务端和客户端程序</span></span><br><span class=\"line\">[root@vultr ngrok]<span class=\"comment\">#  GOOS=linux GOARCH=amd64 make release-server</span></span><br><span class=\"line\">[root@vultr ngrok]<span class=\"comment\">#  GOOS=linux GOARCH=amd64 make release-client</span></span><br><span class=\"line\"><span class=\"comment\">#再编译个windows64位的客户端</span></span><br><span class=\"line\">[root@vultr ngrok]<span class=\"comment\">#  GOOS=windows GOARCH=amd64 make release-client</span></span><br></pre></td></tr></table></figure>\n<p>看一下编译好的程序</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@vultr ngrok]<span class=\"comment\"># ls -la bin</span></span><br><span class=\"line\">total 21544</span><br><span class=\"line\">drwxr-xr-x 3 root root     4096 Jun  2 03:06 .</span><br><span class=\"line\">drwxr-xr-x 9 root root     4096 Jun  2 02:31 ..</span><br><span class=\"line\">-rwxr-xr-x 1 root root  2527810 Jun  2 02:31 go-bindata</span><br><span class=\"line\">-rwxr-xr-x 1 root root 10672322 Jun  2 02:31 ngrok</span><br><span class=\"line\">-rwxr-xr-x 1 root root  8841733 Jun  2 03:06 ngrokd</span><br><span class=\"line\">drwxr-xr-x 2 root root     4096 Jun  2 02:35 windows_amd64</span><br></pre></td></tr></table></figure>\n<h3 id=\"运行测试\"><a href=\"#运行测试\" class=\"headerlink\" title=\"运行测试\"></a>运行测试</h3><p>服务端：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> <span class=\"comment\">#因为我的服务上的80和443端口上运行着这个博客，所以我把http和https的端口进行了更改</span></span><br><span class=\"line\"> [root@vultr ngrok]<span class=\"comment\"># bin/ngrokd -domain=ngrok.star-chen.com -httpAddr=\":8080\" -httpsAddr=\":8081\"</span></span><br><span class=\"line\">[04:00:34 UTC 2017/06/02] [INFO] (ngrok/<span class=\"built_in\">log</span>.(*PrefixLogger).Info:83) [registry] [tun] No affinity cache specified</span><br><span class=\"line\">[04:00:34 UTC 2017/06/02] [INFO] (ngrok/log.Info:112) Listening <span class=\"keyword\">for</span> public http connections on [::]:8080</span><br><span class=\"line\">[04:00:34 UTC 2017/06/02] [INFO] (ngrok/log.Info:112) Listening <span class=\"keyword\">for</span> public https connections on [::]:8081</span><br><span class=\"line\">[04:00:34 UTC 2017/06/02] [INFO] (ngrok/log.Info:112) Listening <span class=\"keyword\">for</span> control and proxy connections on [::]:4443</span><br><span class=\"line\">[04:00:34 UTC 2017/06/02] [INFO] (ngrok/<span class=\"built_in\">log</span>.(*PrefixLogger).Info:83) [metrics] Reporting every 30 seconds</span><br></pre></td></tr></table></figure>\n<p>windows客户端:</p>\n<p>在ngrok.exe的所在目录新建一个简单的配置文件，内容如下：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server_addr: &quot;ngrok.star-chen.com:4443&quot;   #尤其注意，这里的域名需要和你生成证书所使用的域名一致</span><br><span class=\"line\">trust_host_root_certs: false</span><br></pre></td></tr></table></figure>\n<p>运行客户端程序：</p>\n<figure class=\"highlight cmd\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PS G:\\&gt; .\\ngrok.exe -config .\\ngrok.cfg  -subdomain local <span class=\"number\">80</span> #subdomain为指定的子域名</span><br></pre></td></tr></table></figure>\n<p>运行的显示，status为online则表明已经建立了转发连接。</p>\n<figure class=\"highlight cmd\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ngrok</span><br><span class=\"line\"></span><br><span class=\"line\">Tunnel Status                 online</span><br><span class=\"line\">Version                       <span class=\"number\">1</span>.<span class=\"number\">7</span>/<span class=\"number\">1</span>.<span class=\"number\">7</span></span><br><span class=\"line\">Forwarding                    http://local.ngrok.star-chen.com:<span class=\"number\">8080</span> -&gt; <span class=\"number\">127</span>.<span class=\"number\">0</span>.<span class=\"number\">0</span>.<span class=\"number\">1</span>:<span class=\"number\">80</span></span><br><span class=\"line\">Forwarding                    https://local.ngrok.star-chen.com:<span class=\"number\">8080</span> -&gt; <span class=\"number\">127</span>.<span class=\"number\">0</span>.<span class=\"number\">0</span>.<span class=\"number\">1</span>:<span class=\"number\">80</span></span><br><span class=\"line\">Web Interface                 <span class=\"number\">127</span>.<span class=\"number\">0</span>.<span class=\"number\">0</span>.<span class=\"number\">1</span>:<span class=\"number\">4040</span></span><br><span class=\"line\"># Conn                        <span class=\"number\">0</span></span><br><span class=\"line\">Avg Conn <span class=\"built_in\">Time</span>                 <span class=\"number\">0</span>.<span class=\"number\">00</span>ms</span><br></pre></td></tr></table></figure>\n<p>然后访问 <a href=\"http://local.ngrok.star-chen.com:8080\" target=\"_blank\" rel=\"noopener\">http://local.ngrok.star-chen.com:8080</a>  就可以访问到我本机的xampp测试环境了。当然客户端还可以转发tcp连接，例如我的虚拟机里边的ssh：</p>\n<figure class=\"highlight cmd\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PS G:\\&gt; .\\ngrok.exe -config .\\ngrok.cfg  -proto tcp <span class=\"number\">192</span>.<span class=\"number\">168</span>.<span class=\"number\">10</span>.<span class=\"number\">176</span>:<span class=\"number\">22</span></span><br></pre></td></tr></table></figure>\n<p>这样子，在外边也可以方便的ssh到内网中的虚拟机了。</p>"},{"title":"忘记Ubuntu用户密码，怎么办?","date":"2017-06-19T12:13:50.000Z","_content":"\n在使用Linux系统的时候，有时候难免会忘掉登录的用户名和密码，这个时候该怎么办呢？<!--more-->\n\n#### 开机，在grub启动菜单选择\"ubuntu 高级选项\"\n\n![image](/blogimg/grub_advance.png)\n\n#### 选择恢复模式，按e，进入编辑模式\n\n![image](/blogimg/grub_recovery.png)\n\n找到第一个内核参数配置的地方，把“ro recovery nomodeset”替换为“quiet splash rw init=/bin/bash”，如下图所示：\n\n![image](/blogimg/grub_kernel_param.png)\n\n改好参数后，F10保存，系统会重新启动。\n\n#### 重启后，命令行更改用户密码\n\n![image](/blogimg/grub_reboot.png)\n\n重启后，已经得到一个root权限的shell，可以查看当前的用户。现在就可以用\n\n```bash\nroot@(none)/# passwd root\n```\n\n更改root用户的密码了。\n\n","source":"_posts/ChangeUbuntuPassWd.md","raw":"---\ntitle: 忘记Ubuntu用户密码，怎么办?\ncategories:\n  - Linux\ntags:\n  - liux\ndate: 2017-06-19 20:13:50\n---\n\n在使用Linux系统的时候，有时候难免会忘掉登录的用户名和密码，这个时候该怎么办呢？<!--more-->\n\n#### 开机，在grub启动菜单选择\"ubuntu 高级选项\"\n\n![image](/blogimg/grub_advance.png)\n\n#### 选择恢复模式，按e，进入编辑模式\n\n![image](/blogimg/grub_recovery.png)\n\n找到第一个内核参数配置的地方，把“ro recovery nomodeset”替换为“quiet splash rw init=/bin/bash”，如下图所示：\n\n![image](/blogimg/grub_kernel_param.png)\n\n改好参数后，F10保存，系统会重新启动。\n\n#### 重启后，命令行更改用户密码\n\n![image](/blogimg/grub_reboot.png)\n\n重启后，已经得到一个root权限的shell，可以查看当前的用户。现在就可以用\n\n```bash\nroot@(none)/# passwd root\n```\n\n更改root用户的密码了。\n\n","slug":"ChangeUbuntuPassWd","published":1,"updated":"2017-12-04T07:27:28.743Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjeqig1jg000clgqajbgr6pzu","content":"<p>在使用Linux系统的时候，有时候难免会忘掉登录的用户名和密码，这个时候该怎么办呢？<a id=\"more\"></a></p>\n<h4 id=\"开机，在grub启动菜单选择”ubuntu-高级选项”\"><a href=\"#开机，在grub启动菜单选择”ubuntu-高级选项”\" class=\"headerlink\" title=\"开机，在grub启动菜单选择”ubuntu 高级选项”\"></a>开机，在grub启动菜单选择”ubuntu 高级选项”</h4><p><img src=\"/blogimg/grub_advance.png\" alt=\"image\"></p>\n<h4 id=\"选择恢复模式，按e，进入编辑模式\"><a href=\"#选择恢复模式，按e，进入编辑模式\" class=\"headerlink\" title=\"选择恢复模式，按e，进入编辑模式\"></a>选择恢复模式，按e，进入编辑模式</h4><p><img src=\"/blogimg/grub_recovery.png\" alt=\"image\"></p>\n<p>找到第一个内核参数配置的地方，把“ro recovery nomodeset”替换为“quiet splash rw init=/bin/bash”，如下图所示：</p>\n<p><img src=\"/blogimg/grub_kernel_param.png\" alt=\"image\"></p>\n<p>改好参数后，F10保存，系统会重新启动。</p>\n<h4 id=\"重启后，命令行更改用户密码\"><a href=\"#重启后，命令行更改用户密码\" class=\"headerlink\" title=\"重启后，命令行更改用户密码\"></a>重启后，命令行更改用户密码</h4><p><img src=\"/blogimg/grub_reboot.png\" alt=\"image\"></p>\n<p>重启后，已经得到一个root权限的shell，可以查看当前的用户。现在就可以用</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">root@(none)/<span class=\"comment\"># passwd root</span></span><br></pre></td></tr></table></figure>\n<p>更改root用户的密码了。</p>\n","site":{"data":{}},"excerpt":"<p>在使用Linux系统的时候，有时候难免会忘掉登录的用户名和密码，这个时候该怎么办呢？","more":"</p>\n<h4 id=\"开机，在grub启动菜单选择”ubuntu-高级选项”\"><a href=\"#开机，在grub启动菜单选择”ubuntu-高级选项”\" class=\"headerlink\" title=\"开机，在grub启动菜单选择”ubuntu 高级选项”\"></a>开机，在grub启动菜单选择”ubuntu 高级选项”</h4><p><img src=\"/blogimg/grub_advance.png\" alt=\"image\"></p>\n<h4 id=\"选择恢复模式，按e，进入编辑模式\"><a href=\"#选择恢复模式，按e，进入编辑模式\" class=\"headerlink\" title=\"选择恢复模式，按e，进入编辑模式\"></a>选择恢复模式，按e，进入编辑模式</h4><p><img src=\"/blogimg/grub_recovery.png\" alt=\"image\"></p>\n<p>找到第一个内核参数配置的地方，把“ro recovery nomodeset”替换为“quiet splash rw init=/bin/bash”，如下图所示：</p>\n<p><img src=\"/blogimg/grub_kernel_param.png\" alt=\"image\"></p>\n<p>改好参数后，F10保存，系统会重新启动。</p>\n<h4 id=\"重启后，命令行更改用户密码\"><a href=\"#重启后，命令行更改用户密码\" class=\"headerlink\" title=\"重启后，命令行更改用户密码\"></a>重启后，命令行更改用户密码</h4><p><img src=\"/blogimg/grub_reboot.png\" alt=\"image\"></p>\n<p>重启后，已经得到一个root权限的shell，可以查看当前的用户。现在就可以用</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">root@(none)/<span class=\"comment\"># passwd root</span></span><br></pre></td></tr></table></figure>\n<p>更改root用户的密码了。</p>"},{"title":"设计模式学习之装饰者模式","date":"2017-05-11T18:16:06.000Z","_content":"\n这学期前几个月为了写Mango Cloud的网站和微信公众号程序，耽搁了不少时间，已经很长时间没有学习新的知识了。现在终于可以拿出点时间学点新东西了，在之前的网站开发过程中也深刻感受到了面向对象程序编写中存在很多问题，许多业务代码只是简单的调用方法来完成业务逻辑，其中有不少代码存在重复使用，总之代码看起来不是那么的漂亮，对于强迫症的我是不可容忍的。  \n这次继续设计模式的学习--------装饰者模式  \n<!-- more --> \n\n其实装饰者模式在学习JAVA IO部分的时候就接触到了，例如以下代码：\n\n```java\nBufferedReader br = new BufferedReader(new InputStreamReader(new FileInputStream(\"test.txt\")));\n```\n\n其中stream就经过了stream->streamreader->bufferedreader的包装过程。下面对装饰者模式进行拆分理解，搞清楚它是怎么实现的。\n\n### 装饰者模式要解决的问题\n\n通常一个类的功能拓展是通过继承来实现的，而往往一个子类相较于父类只增添了一点属性或更改了一个方法的具体实现内容，随着功能需求的增多，会生成很多子类，增大了程序的维护难度。使用继承也意味着这些功能在编译的时候就已经确定了，是静态的。\n\n### 装饰者模式的定义\n\n装饰者模式动态地将责任附加到对象上。装饰者模式允许向一个现有的对象添加新的功能，同时又不改变其原有的结构。装饰者模式创建了一个装饰类，将原来的类进行包装，并在保持原来的类方法签名完整性的前提下，提供了额外的功能。OO原则之开放-关闭原则------对外扩展开放，对修改关闭，即不修改现有代码的情况下，扩充原有类的行为。\n\n### 代码实例（摘自HeadFirst设计模式上的例子）\n\n```java\n//定义一个抽象类，为之后的被装饰对象提供一致的数据类型，这里也可以定义一个接口\npublic abstract class Beverage{\n  String description = \"Unknown Beverage\";\n  \n  public String getDescription(){\n    return description;\n  }\n  \n  public abstract double cost();\n  \n}\n```\n\n\n\n```java\n//装饰者抽象类，需要通过继承获得与被装饰者一致的属性和方法，也就是保持原有类的完整性\npublic abstract class CondimentDecorator extends Beverage{\n  \n  public abstract String getDescription();\n}\n```\n\n```java\n//定义一个被装饰对象，这里的description是从父类继承得到的\npublic class Espresso extends Beverage{\n  \n  public Espresso(){\n    \n    description = \"Espresso\";\n  }\n  \n  public double cost(){\n    \n    return 1.99;\n  }\n}\n```\n\n```java\n//定义一个装饰者类，通过这个装饰者类可以为被装饰对象提供新的功能，比如这里的为咖啡加上摩卡，并计算新的价格\npublic class Mocha extends CondimentDecorator{\n  \n  Beverage beverage;\n  \n  public Mocha(Beverage beverage){\n    this.beverage = beverage;\n  }\n  \n  public String getDescription(){\n    return beverage.getDescription() + \", Mocha\";\n  }\n  \n  public double cost(){\n    \n    return .20 + beverage.cost();\n  }\n  \n}\n```\n\n```java\n//代码测试\npublic class DecoratorTest{\n  \n  public static void main(String[] args){\n    \n    \tBdverage beverage = new Espresso();\n    \tbeverage = new Mocha(beverage);\n    \tSystem.out.println(\"The coffee is\"+mocha.getDescription()+\" ,The price is \"+mocha.cost());\n  }\n}\n```\n\n我这里举的代码例子只使用了一个装饰类，当然还可以继续定义新的装饰类来继续对mocha咖啡进行扩充，例如是否加牛奶，设定容量大小等等。\n\n利用装饰者模式可以更灵活的对某个类的功能进行扩充，用不着派生出无数的子类，对于代码维护挺有好处的。但是装饰者模式会导致在使用过程中出现许多小对象，如果过度使用，会让程序变得很复杂。","source":"_posts/Decorator-Notes.md","raw":"---\ntitle: 设计模式学习之装饰者模式\ndate: 2017-5-12 2:16:06\ncategories:\n- Program\ntags:\n- java\n- 设计模式\n- 装饰者模式\n---\n\n这学期前几个月为了写Mango Cloud的网站和微信公众号程序，耽搁了不少时间，已经很长时间没有学习新的知识了。现在终于可以拿出点时间学点新东西了，在之前的网站开发过程中也深刻感受到了面向对象程序编写中存在很多问题，许多业务代码只是简单的调用方法来完成业务逻辑，其中有不少代码存在重复使用，总之代码看起来不是那么的漂亮，对于强迫症的我是不可容忍的。  \n这次继续设计模式的学习--------装饰者模式  \n<!-- more --> \n\n其实装饰者模式在学习JAVA IO部分的时候就接触到了，例如以下代码：\n\n```java\nBufferedReader br = new BufferedReader(new InputStreamReader(new FileInputStream(\"test.txt\")));\n```\n\n其中stream就经过了stream->streamreader->bufferedreader的包装过程。下面对装饰者模式进行拆分理解，搞清楚它是怎么实现的。\n\n### 装饰者模式要解决的问题\n\n通常一个类的功能拓展是通过继承来实现的，而往往一个子类相较于父类只增添了一点属性或更改了一个方法的具体实现内容，随着功能需求的增多，会生成很多子类，增大了程序的维护难度。使用继承也意味着这些功能在编译的时候就已经确定了，是静态的。\n\n### 装饰者模式的定义\n\n装饰者模式动态地将责任附加到对象上。装饰者模式允许向一个现有的对象添加新的功能，同时又不改变其原有的结构。装饰者模式创建了一个装饰类，将原来的类进行包装，并在保持原来的类方法签名完整性的前提下，提供了额外的功能。OO原则之开放-关闭原则------对外扩展开放，对修改关闭，即不修改现有代码的情况下，扩充原有类的行为。\n\n### 代码实例（摘自HeadFirst设计模式上的例子）\n\n```java\n//定义一个抽象类，为之后的被装饰对象提供一致的数据类型，这里也可以定义一个接口\npublic abstract class Beverage{\n  String description = \"Unknown Beverage\";\n  \n  public String getDescription(){\n    return description;\n  }\n  \n  public abstract double cost();\n  \n}\n```\n\n\n\n```java\n//装饰者抽象类，需要通过继承获得与被装饰者一致的属性和方法，也就是保持原有类的完整性\npublic abstract class CondimentDecorator extends Beverage{\n  \n  public abstract String getDescription();\n}\n```\n\n```java\n//定义一个被装饰对象，这里的description是从父类继承得到的\npublic class Espresso extends Beverage{\n  \n  public Espresso(){\n    \n    description = \"Espresso\";\n  }\n  \n  public double cost(){\n    \n    return 1.99;\n  }\n}\n```\n\n```java\n//定义一个装饰者类，通过这个装饰者类可以为被装饰对象提供新的功能，比如这里的为咖啡加上摩卡，并计算新的价格\npublic class Mocha extends CondimentDecorator{\n  \n  Beverage beverage;\n  \n  public Mocha(Beverage beverage){\n    this.beverage = beverage;\n  }\n  \n  public String getDescription(){\n    return beverage.getDescription() + \", Mocha\";\n  }\n  \n  public double cost(){\n    \n    return .20 + beverage.cost();\n  }\n  \n}\n```\n\n```java\n//代码测试\npublic class DecoratorTest{\n  \n  public static void main(String[] args){\n    \n    \tBdverage beverage = new Espresso();\n    \tbeverage = new Mocha(beverage);\n    \tSystem.out.println(\"The coffee is\"+mocha.getDescription()+\" ,The price is \"+mocha.cost());\n  }\n}\n```\n\n我这里举的代码例子只使用了一个装饰类，当然还可以继续定义新的装饰类来继续对mocha咖啡进行扩充，例如是否加牛奶，设定容量大小等等。\n\n利用装饰者模式可以更灵活的对某个类的功能进行扩充，用不着派生出无数的子类，对于代码维护挺有好处的。但是装饰者模式会导致在使用过程中出现许多小对象，如果过度使用，会让程序变得很复杂。","slug":"Decorator-Notes","published":1,"updated":"2017-12-04T07:27:28.744Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjeqig1jp000glgqagdjxdyjl","content":"<p>这学期前几个月为了写Mango Cloud的网站和微信公众号程序，耽搁了不少时间，已经很长时间没有学习新的知识了。现在终于可以拿出点时间学点新东西了，在之前的网站开发过程中也深刻感受到了面向对象程序编写中存在很多问题，许多业务代码只是简单的调用方法来完成业务逻辑，其中有不少代码存在重复使用，总之代码看起来不是那么的漂亮，对于强迫症的我是不可容忍的。<br>这次继续设计模式的学习——–装饰者模式<br><a id=\"more\"></a> </p>\n<p>其实装饰者模式在学习JAVA IO部分的时候就接触到了，例如以下代码：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">BufferedReader br = <span class=\"keyword\">new</span> BufferedReader(<span class=\"keyword\">new</span> InputStreamReader(<span class=\"keyword\">new</span> FileInputStream(<span class=\"string\">\"test.txt\"</span>)));</span><br></pre></td></tr></table></figure>\n<p>其中stream就经过了stream-&gt;streamreader-&gt;bufferedreader的包装过程。下面对装饰者模式进行拆分理解，搞清楚它是怎么实现的。</p>\n<h3 id=\"装饰者模式要解决的问题\"><a href=\"#装饰者模式要解决的问题\" class=\"headerlink\" title=\"装饰者模式要解决的问题\"></a>装饰者模式要解决的问题</h3><p>通常一个类的功能拓展是通过继承来实现的，而往往一个子类相较于父类只增添了一点属性或更改了一个方法的具体实现内容，随着功能需求的增多，会生成很多子类，增大了程序的维护难度。使用继承也意味着这些功能在编译的时候就已经确定了，是静态的。</p>\n<h3 id=\"装饰者模式的定义\"><a href=\"#装饰者模式的定义\" class=\"headerlink\" title=\"装饰者模式的定义\"></a>装饰者模式的定义</h3><p>装饰者模式动态地将责任附加到对象上。装饰者模式允许向一个现有的对象添加新的功能，同时又不改变其原有的结构。装饰者模式创建了一个装饰类，将原来的类进行包装，并在保持原来的类方法签名完整性的前提下，提供了额外的功能。OO原则之开放-关闭原则——对外扩展开放，对修改关闭，即不修改现有代码的情况下，扩充原有类的行为。</p>\n<h3 id=\"代码实例（摘自HeadFirst设计模式上的例子）\"><a href=\"#代码实例（摘自HeadFirst设计模式上的例子）\" class=\"headerlink\" title=\"代码实例（摘自HeadFirst设计模式上的例子）\"></a>代码实例（摘自HeadFirst设计模式上的例子）</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//定义一个抽象类，为之后的被装饰对象提供一致的数据类型，这里也可以定义一个接口</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">abstract</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Beverage</span></span>&#123;</span><br><span class=\"line\">  String description = <span class=\"string\">\"Unknown Beverage\"</span>;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getDescription</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> description;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">abstract</span> <span class=\"keyword\">double</span> <span class=\"title\">cost</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//装饰者抽象类，需要通过继承获得与被装饰者一致的属性和方法，也就是保持原有类的完整性</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">abstract</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CondimentDecorator</span> <span class=\"keyword\">extends</span> <span class=\"title\">Beverage</span></span>&#123;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">abstract</span> String <span class=\"title\">getDescription</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//定义一个被装饰对象，这里的description是从父类继承得到的</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Espresso</span> <span class=\"keyword\">extends</span> <span class=\"title\">Beverage</span></span>&#123;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">Espresso</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">    </span><br><span class=\"line\">    description = <span class=\"string\">\"Espresso\"</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">double</span> <span class=\"title\">cost</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">1.99</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//定义一个装饰者类，通过这个装饰者类可以为被装饰对象提供新的功能，比如这里的为咖啡加上摩卡，并计算新的价格</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Mocha</span> <span class=\"keyword\">extends</span> <span class=\"title\">CondimentDecorator</span></span>&#123;</span><br><span class=\"line\">  </span><br><span class=\"line\">  Beverage beverage;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">Mocha</span><span class=\"params\">(Beverage beverage)</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.beverage = beverage;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getDescription</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> beverage.getDescription() + <span class=\"string\">\", Mocha\"</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">double</span> <span class=\"title\">cost</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">return</span> .<span class=\"number\">20</span> + beverage.cost();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//代码测试</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">DecoratorTest</span></span>&#123;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span></span>&#123;</span><br><span class=\"line\">    </span><br><span class=\"line\">    \tBdverage beverage = <span class=\"keyword\">new</span> Espresso();</span><br><span class=\"line\">    \tbeverage = <span class=\"keyword\">new</span> Mocha(beverage);</span><br><span class=\"line\">    \tSystem.out.println(<span class=\"string\">\"The coffee is\"</span>+mocha.getDescription()+<span class=\"string\">\" ,The price is \"</span>+mocha.cost());</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>我这里举的代码例子只使用了一个装饰类，当然还可以继续定义新的装饰类来继续对mocha咖啡进行扩充，例如是否加牛奶，设定容量大小等等。</p>\n<p>利用装饰者模式可以更灵活的对某个类的功能进行扩充，用不着派生出无数的子类，对于代码维护挺有好处的。但是装饰者模式会导致在使用过程中出现许多小对象，如果过度使用，会让程序变得很复杂。</p>\n","site":{"data":{}},"excerpt":"<p>这学期前几个月为了写Mango Cloud的网站和微信公众号程序，耽搁了不少时间，已经很长时间没有学习新的知识了。现在终于可以拿出点时间学点新东西了，在之前的网站开发过程中也深刻感受到了面向对象程序编写中存在很多问题，许多业务代码只是简单的调用方法来完成业务逻辑，其中有不少代码存在重复使用，总之代码看起来不是那么的漂亮，对于强迫症的我是不可容忍的。<br>这次继续设计模式的学习——–装饰者模式<br>","more":"</p>\n<p>其实装饰者模式在学习JAVA IO部分的时候就接触到了，例如以下代码：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">BufferedReader br = <span class=\"keyword\">new</span> BufferedReader(<span class=\"keyword\">new</span> InputStreamReader(<span class=\"keyword\">new</span> FileInputStream(<span class=\"string\">\"test.txt\"</span>)));</span><br></pre></td></tr></table></figure>\n<p>其中stream就经过了stream-&gt;streamreader-&gt;bufferedreader的包装过程。下面对装饰者模式进行拆分理解，搞清楚它是怎么实现的。</p>\n<h3 id=\"装饰者模式要解决的问题\"><a href=\"#装饰者模式要解决的问题\" class=\"headerlink\" title=\"装饰者模式要解决的问题\"></a>装饰者模式要解决的问题</h3><p>通常一个类的功能拓展是通过继承来实现的，而往往一个子类相较于父类只增添了一点属性或更改了一个方法的具体实现内容，随着功能需求的增多，会生成很多子类，增大了程序的维护难度。使用继承也意味着这些功能在编译的时候就已经确定了，是静态的。</p>\n<h3 id=\"装饰者模式的定义\"><a href=\"#装饰者模式的定义\" class=\"headerlink\" title=\"装饰者模式的定义\"></a>装饰者模式的定义</h3><p>装饰者模式动态地将责任附加到对象上。装饰者模式允许向一个现有的对象添加新的功能，同时又不改变其原有的结构。装饰者模式创建了一个装饰类，将原来的类进行包装，并在保持原来的类方法签名完整性的前提下，提供了额外的功能。OO原则之开放-关闭原则——对外扩展开放，对修改关闭，即不修改现有代码的情况下，扩充原有类的行为。</p>\n<h3 id=\"代码实例（摘自HeadFirst设计模式上的例子）\"><a href=\"#代码实例（摘自HeadFirst设计模式上的例子）\" class=\"headerlink\" title=\"代码实例（摘自HeadFirst设计模式上的例子）\"></a>代码实例（摘自HeadFirst设计模式上的例子）</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//定义一个抽象类，为之后的被装饰对象提供一致的数据类型，这里也可以定义一个接口</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">abstract</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Beverage</span></span>&#123;</span><br><span class=\"line\">  String description = <span class=\"string\">\"Unknown Beverage\"</span>;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getDescription</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> description;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">abstract</span> <span class=\"keyword\">double</span> <span class=\"title\">cost</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//装饰者抽象类，需要通过继承获得与被装饰者一致的属性和方法，也就是保持原有类的完整性</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">abstract</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CondimentDecorator</span> <span class=\"keyword\">extends</span> <span class=\"title\">Beverage</span></span>&#123;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">abstract</span> String <span class=\"title\">getDescription</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//定义一个被装饰对象，这里的description是从父类继承得到的</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Espresso</span> <span class=\"keyword\">extends</span> <span class=\"title\">Beverage</span></span>&#123;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">Espresso</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">    </span><br><span class=\"line\">    description = <span class=\"string\">\"Espresso\"</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">double</span> <span class=\"title\">cost</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">1.99</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//定义一个装饰者类，通过这个装饰者类可以为被装饰对象提供新的功能，比如这里的为咖啡加上摩卡，并计算新的价格</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Mocha</span> <span class=\"keyword\">extends</span> <span class=\"title\">CondimentDecorator</span></span>&#123;</span><br><span class=\"line\">  </span><br><span class=\"line\">  Beverage beverage;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">Mocha</span><span class=\"params\">(Beverage beverage)</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.beverage = beverage;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getDescription</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> beverage.getDescription() + <span class=\"string\">\", Mocha\"</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">double</span> <span class=\"title\">cost</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">return</span> .<span class=\"number\">20</span> + beverage.cost();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//代码测试</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">DecoratorTest</span></span>&#123;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span></span>&#123;</span><br><span class=\"line\">    </span><br><span class=\"line\">    \tBdverage beverage = <span class=\"keyword\">new</span> Espresso();</span><br><span class=\"line\">    \tbeverage = <span class=\"keyword\">new</span> Mocha(beverage);</span><br><span class=\"line\">    \tSystem.out.println(<span class=\"string\">\"The coffee is\"</span>+mocha.getDescription()+<span class=\"string\">\" ,The price is \"</span>+mocha.cost());</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>我这里举的代码例子只使用了一个装饰类，当然还可以继续定义新的装饰类来继续对mocha咖啡进行扩充，例如是否加牛奶，设定容量大小等等。</p>\n<p>利用装饰者模式可以更灵活的对某个类的功能进行扩充，用不着派生出无数的子类，对于代码维护挺有好处的。但是装饰者模式会导致在使用过程中出现许多小对象，如果过度使用，会让程序变得很复杂。</p>"},{"title":"深入理解java虚拟机之动手编译OpenJDK 7","date":"2017-05-31T11:31:28.000Z","_content":"\n### 编译环境构建\n\n1. 操作系统\n\n   我选择的是Ubuntu Server 14.04 LTS,系统已经自带了openjdk 7，可以作为编译openjdk 7的bootstrap jdk,这里我就省略了安装bootstrap jdk的步骤了。\n\n2. 安装依赖的软件包\n   ```bash\n   $sudo apt-get install build-essential gawk m4 libasound2-dev libcups2-dev libxrender-dev xorg-dev xutils-dev binutils libmotif-dev ant\n   ```\n\n3. 下载openjdk 7源码并解压\n\n   ```bash\n   $wget http://download.java.net/openjdk/jdk7u75/ri/openjdk-7u75-src-b13-18_dec_2014.zip\n   ```\n   <!-- more -->\n4. 设置一些编译所需的环境变量\n\n   ```bash\n   export LANG=C\n   #bootstrap jdk的路径，我放在了~/jdk1.6\n   export ALT_BOOTDIR=~/jdk1.6\n   #允许编译过程中自动下载\n   export ALLOW_DOWNLOADS=true\n   #设置并行编译的线程数，我这虚拟机给了一个核，写个1\n   export HOTSPOT_BUILD_JOBS=1\n   export ALT_PARALLEL_COMPILE_JOBS=1\n   export SKIP_COMPARE_IMAGES=true\n   #使用预编译头文件\n   export USE_PRECOMPILED_HEADER=true\n   #需要编译的内容\n   export BUILD_LANGTOOLS=true\n   export BUILD_HOTSPOT=true\n   export BUILD_JDK=true\n   export BUILD_DEPLOY=false\n   #编译结果的存放路径\n   export ALT_OUTPUTDIR=~/compiled_jdk\n   unset JAVA_HOEM\n   unset CLASSPATH\n   ```\n\n### 准备就绪，开搞\n\n```bash\nxing@ubuntu-compile:~/openjdk$ make sanity \n.\n.\n.\nExternal File/Binary Locations:\n  USRJDKINSTANCES_PATH = /opt/java\n  BUILD_JDK_IMPORT_PATH = /NOT-SET/re/jdk/1.7.0/promoted/latest/binaries\n    ALT_BUILD_JDK_IMPORT_PATH = \n  JDK_IMPORT_PATH = /NOT-SET/re/jdk/1.7.0/promoted/latest/binaries/linux-amd64\n    ALT_JDK_IMPORT_PATH = \n  LANGTOOLS_DIST = \n    ALT_LANGTOOLS_DIST = /home/xing/compiled_jdk/langtools/dist\n  CORBA_DIST = \n    ALT_CORBA_DIST = /home/xing/compiled_jdk/corba/dist\n  JAXP_DIST = \n    ALT_JAXP_DIST = /home/xing/compiled_jdk/jaxp/dist\n  JAXWS_DIST = \n    ALT_JAXWS_DIST = /home/xing/compiled_jdk/jaxws/dist\n  HOTSPOT_DOCS_IMPORT_PATH = /NO_DOCS_DIR\n    ALT_HOTSPOT_DOCS_IMPORT_PATH = \n  HOTSPOT_IMPORT_PATH = /home/xing/compiled_jdk/hotspot/import\n    ALT_HOTSPOT_IMPORT_PATH = /home/xing/compiled_jdk/hotspot/import\n  HOTSPOT_SERVER_PATH = /home/xing/compiled_jdk/hotspot/import/jre/lib/amd64/server\n    ALT_HOTSPOT_SERVER_PATH = \n  CACERTS_FILE = ./../src/share/lib/security/cacerts\n    ALT_CACERTS_FILE = \n  CUPS_HEADERS_PATH = /usr/include\n    ALT_CUPS_HEADERS_PATH = \n \nOpenJDK-specific settings:\n  FREETYPE_HEADERS_PATH = /usr/include\n    ALT_FREETYPE_HEADERS_PATH = \n  FREETYPE_LIB_PATH = /usr/lib\n    ALT_FREETYPE_LIB_PATH = \n \nPrevious JDK Settings:\n  PREVIOUS_RELEASE_PATH = USING-PREVIOUS_RELEASE_IMAGE\n    ALT_PREVIOUS_RELEASE_PATH = \n  PREVIOUS_JDK_VERSION = 1.6.0\n    ALT_PREVIOUS_JDK_VERSION = \n  PREVIOUS_JDK_FILE = \n    ALT_PREVIOUS_JDK_FILE = \n  PREVIOUS_JRE_FILE = \n    ALT_PREVIOUS_JRE_FILE = \n  PREVIOUS_RELEASE_IMAGE = /usr/lib/jvm/java-7-openjdk-amd64/\n    ALT_PREVIOUS_RELEASE_IMAGE = \n\n\nSanity check passed.\n\nxing@ubuntu-compile:~/openjdk$ make\n.\n.\n.\n```\n\n### 遇到的问题​\n\n``` \ncd linux_amd64_compiler2/product &amp;amp;amp;amp;amp;amp;amp;&amp;amp;amp;amp;amp;amp;amp; ./test_gamma\n   Using java runtime at: /usr/lib/jvm/java-7-openjdk-amd64/jre\n   Error occurred during initialization of VM\n   java.lang.NullPointerException\n\n   \tat java.util.Hashtable.put(Hashtable.java:514)\n   \tat java.lang.System.initProperties(Native Method)\n   \tat java.lang.System.initializeSystemClass(System.java:1119)\n\n   make[4]: *** [product] Error 1\n   make[4]: Leaving directory `/home/xing/compiled_jdk/hotspot/outputdir'\n   make[3]: *** [generic_build2] Error 2\n   make[3]: Leaving directory `/home/xing/openjdk/hotspot/make'\n   make[2]: *** [product] Error 2\n   make[2]: Leaving directory `/home/xing/openjdk/hotspot/make'\n   make[1]: *** [hotspot-build] Error 2\n   make[1]: Leaving directory `/home/xing/openjdk'\n   make: *** [build_product_image] Error 2\n```\n\n从网上找到的解决办法是删除makefile中的 ./test_gamma,或者安装oracle jdk1.6来作为bootstrap jdk应该也可以。\n``` \n/usr/lib/jvm/java-7-openjdk-amd64//bin/java -XX:-PrintVMOptions -XX:+UnlockDiagnosticVMOptions -XX:-LogVMOutput -Xmx512m -Xms512m -XX:PermSize=32m -XX:MaxPermSize=160m -jar /home/xing/compiled_jdk/btjars/generatecurrencydata.jar -o /home/xing/compiled_jdk/lib/currency.data.temp \\&amp;amp;amp;amp;amp;amp;amp;lt; ../../../src/share/classes/java/util/CurrencyData.properties\n      Error: time is more than 10 years from present: 1136059200000\n      java.lang.RuntimeException: time is more than 10 years from present: 1136059200000\n      \tat build.tools.generatecurrencydata.GenerateCurrencyData.makeSpecialCaseEntry(GenerateCurrencyData.java:285)\n      \tat build.tools.generatecurrencydata.GenerateCurrencyData.buildMainAndSpecialCaseTables(GenerateCurrencyData.java:225)\n      \tat build.tools.generatecurrencydata.GenerateCurrencyData.main(GenerateCurrencyData.java:154)\n      make[4]: *** [/home/xing/compiled_jdk/lib/currency.data] Error 1\n      make[4]: Leaving directory `/home/xing/openjdk/jdk/make/java/java'\n      make[3]: *** [all] Error 1\n      make[3]: Leaving directory `/home/xing/openjdk/jdk/make/java'\n      make[2]: *** [all] Error 1\n      make[2]: Leaving directory `/home/xing/openjdk/jdk/make'\n      make[1]: *** [jdk-build] Error 2\n      make[1]: Leaving directory `/home/xing/openjdk'\n      make: *** [build_product_image] Error 2\n```\n\n错误提示是说时间超过了10年，解决办法是更改源文件，将10年前的时间改到十年之内。\n\n### 编译结果\n\n```\n>>>Finished making images @ Fri Jun  2 01:43:41 CST 2017 ...\nmake[2]: Leaving directory `/home/xing/openjdk/jdk/make'\n########################################################################\n##### Leaving jdk for target(s) sanity all docs images             #####\n########################################################################\n##### Build time 00:06:34 jdk for target(s) sanity all docs images #####\n########################################################################\n\n#-- Build times ----------\nTarget all_product_build\nStart 2017-06-02 01:36:50\nEnd   2017-06-02 01:43:41\n00:00:07 corba\n00:00:04 hotspot\n00:00:02 jaxp\n00:00:02 jaxws\n00:06:34 jdk\n00:00:01 langtools\n00:06:51 TOTAL\n-------------------------\nmake[1]: Leaving directory `/home/xing/openjdk'\n\n```\n\n整个编译过程还是比较顺利的，遇到的也是些小问题~\n\n### 运行一下\n\n```bash\nxing@ubuntu-compile:~/compiled_jdk$ ~/compiled_jdk/bin/java -version\nopenjdk version \"1.7.0-internal\"\nOpenJDK Runtime Environment (build 1.7.0-internal-xing_2017_06_02_01_12-b00)\nOpenJDK 64-Bit Server VM (build 24.75-b04, mixed mode)\n\n```\n\n可以看到已经能够成功运行，并且带上了编译的时间和用户。\n\n\n\n参考书籍：《深入理解Java虚拟机 JVM高级特性与最佳实践》","source":"_posts/CompileOpenJDK.md","raw":"---\ntitle: 深入理解java虚拟机之动手编译OpenJDK 7\ncategories:\n  - Program\ntags:\n  - java\ndate: 2017-05-31 19:31:28\n---\n\n### 编译环境构建\n\n1. 操作系统\n\n   我选择的是Ubuntu Server 14.04 LTS,系统已经自带了openjdk 7，可以作为编译openjdk 7的bootstrap jdk,这里我就省略了安装bootstrap jdk的步骤了。\n\n2. 安装依赖的软件包\n   ```bash\n   $sudo apt-get install build-essential gawk m4 libasound2-dev libcups2-dev libxrender-dev xorg-dev xutils-dev binutils libmotif-dev ant\n   ```\n\n3. 下载openjdk 7源码并解压\n\n   ```bash\n   $wget http://download.java.net/openjdk/jdk7u75/ri/openjdk-7u75-src-b13-18_dec_2014.zip\n   ```\n   <!-- more -->\n4. 设置一些编译所需的环境变量\n\n   ```bash\n   export LANG=C\n   #bootstrap jdk的路径，我放在了~/jdk1.6\n   export ALT_BOOTDIR=~/jdk1.6\n   #允许编译过程中自动下载\n   export ALLOW_DOWNLOADS=true\n   #设置并行编译的线程数，我这虚拟机给了一个核，写个1\n   export HOTSPOT_BUILD_JOBS=1\n   export ALT_PARALLEL_COMPILE_JOBS=1\n   export SKIP_COMPARE_IMAGES=true\n   #使用预编译头文件\n   export USE_PRECOMPILED_HEADER=true\n   #需要编译的内容\n   export BUILD_LANGTOOLS=true\n   export BUILD_HOTSPOT=true\n   export BUILD_JDK=true\n   export BUILD_DEPLOY=false\n   #编译结果的存放路径\n   export ALT_OUTPUTDIR=~/compiled_jdk\n   unset JAVA_HOEM\n   unset CLASSPATH\n   ```\n\n### 准备就绪，开搞\n\n```bash\nxing@ubuntu-compile:~/openjdk$ make sanity \n.\n.\n.\nExternal File/Binary Locations:\n  USRJDKINSTANCES_PATH = /opt/java\n  BUILD_JDK_IMPORT_PATH = /NOT-SET/re/jdk/1.7.0/promoted/latest/binaries\n    ALT_BUILD_JDK_IMPORT_PATH = \n  JDK_IMPORT_PATH = /NOT-SET/re/jdk/1.7.0/promoted/latest/binaries/linux-amd64\n    ALT_JDK_IMPORT_PATH = \n  LANGTOOLS_DIST = \n    ALT_LANGTOOLS_DIST = /home/xing/compiled_jdk/langtools/dist\n  CORBA_DIST = \n    ALT_CORBA_DIST = /home/xing/compiled_jdk/corba/dist\n  JAXP_DIST = \n    ALT_JAXP_DIST = /home/xing/compiled_jdk/jaxp/dist\n  JAXWS_DIST = \n    ALT_JAXWS_DIST = /home/xing/compiled_jdk/jaxws/dist\n  HOTSPOT_DOCS_IMPORT_PATH = /NO_DOCS_DIR\n    ALT_HOTSPOT_DOCS_IMPORT_PATH = \n  HOTSPOT_IMPORT_PATH = /home/xing/compiled_jdk/hotspot/import\n    ALT_HOTSPOT_IMPORT_PATH = /home/xing/compiled_jdk/hotspot/import\n  HOTSPOT_SERVER_PATH = /home/xing/compiled_jdk/hotspot/import/jre/lib/amd64/server\n    ALT_HOTSPOT_SERVER_PATH = \n  CACERTS_FILE = ./../src/share/lib/security/cacerts\n    ALT_CACERTS_FILE = \n  CUPS_HEADERS_PATH = /usr/include\n    ALT_CUPS_HEADERS_PATH = \n \nOpenJDK-specific settings:\n  FREETYPE_HEADERS_PATH = /usr/include\n    ALT_FREETYPE_HEADERS_PATH = \n  FREETYPE_LIB_PATH = /usr/lib\n    ALT_FREETYPE_LIB_PATH = \n \nPrevious JDK Settings:\n  PREVIOUS_RELEASE_PATH = USING-PREVIOUS_RELEASE_IMAGE\n    ALT_PREVIOUS_RELEASE_PATH = \n  PREVIOUS_JDK_VERSION = 1.6.0\n    ALT_PREVIOUS_JDK_VERSION = \n  PREVIOUS_JDK_FILE = \n    ALT_PREVIOUS_JDK_FILE = \n  PREVIOUS_JRE_FILE = \n    ALT_PREVIOUS_JRE_FILE = \n  PREVIOUS_RELEASE_IMAGE = /usr/lib/jvm/java-7-openjdk-amd64/\n    ALT_PREVIOUS_RELEASE_IMAGE = \n\n\nSanity check passed.\n\nxing@ubuntu-compile:~/openjdk$ make\n.\n.\n.\n```\n\n### 遇到的问题​\n\n``` \ncd linux_amd64_compiler2/product &amp;amp;amp;amp;amp;amp;amp;&amp;amp;amp;amp;amp;amp;amp; ./test_gamma\n   Using java runtime at: /usr/lib/jvm/java-7-openjdk-amd64/jre\n   Error occurred during initialization of VM\n   java.lang.NullPointerException\n\n   \tat java.util.Hashtable.put(Hashtable.java:514)\n   \tat java.lang.System.initProperties(Native Method)\n   \tat java.lang.System.initializeSystemClass(System.java:1119)\n\n   make[4]: *** [product] Error 1\n   make[4]: Leaving directory `/home/xing/compiled_jdk/hotspot/outputdir'\n   make[3]: *** [generic_build2] Error 2\n   make[3]: Leaving directory `/home/xing/openjdk/hotspot/make'\n   make[2]: *** [product] Error 2\n   make[2]: Leaving directory `/home/xing/openjdk/hotspot/make'\n   make[1]: *** [hotspot-build] Error 2\n   make[1]: Leaving directory `/home/xing/openjdk'\n   make: *** [build_product_image] Error 2\n```\n\n从网上找到的解决办法是删除makefile中的 ./test_gamma,或者安装oracle jdk1.6来作为bootstrap jdk应该也可以。\n``` \n/usr/lib/jvm/java-7-openjdk-amd64//bin/java -XX:-PrintVMOptions -XX:+UnlockDiagnosticVMOptions -XX:-LogVMOutput -Xmx512m -Xms512m -XX:PermSize=32m -XX:MaxPermSize=160m -jar /home/xing/compiled_jdk/btjars/generatecurrencydata.jar -o /home/xing/compiled_jdk/lib/currency.data.temp \\&amp;amp;amp;amp;amp;amp;amp;lt; ../../../src/share/classes/java/util/CurrencyData.properties\n      Error: time is more than 10 years from present: 1136059200000\n      java.lang.RuntimeException: time is more than 10 years from present: 1136059200000\n      \tat build.tools.generatecurrencydata.GenerateCurrencyData.makeSpecialCaseEntry(GenerateCurrencyData.java:285)\n      \tat build.tools.generatecurrencydata.GenerateCurrencyData.buildMainAndSpecialCaseTables(GenerateCurrencyData.java:225)\n      \tat build.tools.generatecurrencydata.GenerateCurrencyData.main(GenerateCurrencyData.java:154)\n      make[4]: *** [/home/xing/compiled_jdk/lib/currency.data] Error 1\n      make[4]: Leaving directory `/home/xing/openjdk/jdk/make/java/java'\n      make[3]: *** [all] Error 1\n      make[3]: Leaving directory `/home/xing/openjdk/jdk/make/java'\n      make[2]: *** [all] Error 1\n      make[2]: Leaving directory `/home/xing/openjdk/jdk/make'\n      make[1]: *** [jdk-build] Error 2\n      make[1]: Leaving directory `/home/xing/openjdk'\n      make: *** [build_product_image] Error 2\n```\n\n错误提示是说时间超过了10年，解决办法是更改源文件，将10年前的时间改到十年之内。\n\n### 编译结果\n\n```\n>>>Finished making images @ Fri Jun  2 01:43:41 CST 2017 ...\nmake[2]: Leaving directory `/home/xing/openjdk/jdk/make'\n########################################################################\n##### Leaving jdk for target(s) sanity all docs images             #####\n########################################################################\n##### Build time 00:06:34 jdk for target(s) sanity all docs images #####\n########################################################################\n\n#-- Build times ----------\nTarget all_product_build\nStart 2017-06-02 01:36:50\nEnd   2017-06-02 01:43:41\n00:00:07 corba\n00:00:04 hotspot\n00:00:02 jaxp\n00:00:02 jaxws\n00:06:34 jdk\n00:00:01 langtools\n00:06:51 TOTAL\n-------------------------\nmake[1]: Leaving directory `/home/xing/openjdk'\n\n```\n\n整个编译过程还是比较顺利的，遇到的也是些小问题~\n\n### 运行一下\n\n```bash\nxing@ubuntu-compile:~/compiled_jdk$ ~/compiled_jdk/bin/java -version\nopenjdk version \"1.7.0-internal\"\nOpenJDK Runtime Environment (build 1.7.0-internal-xing_2017_06_02_01_12-b00)\nOpenJDK 64-Bit Server VM (build 24.75-b04, mixed mode)\n\n```\n\n可以看到已经能够成功运行，并且带上了编译的时间和用户。\n\n\n\n参考书籍：《深入理解Java虚拟机 JVM高级特性与最佳实践》","slug":"CompileOpenJDK","published":1,"updated":"2017-12-04T07:27:28.744Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjeqig1jt000ilgqafn6i5tsn","content":"<h3 id=\"编译环境构建\"><a href=\"#编译环境构建\" class=\"headerlink\" title=\"编译环境构建\"></a>编译环境构建</h3><ol>\n<li><p>操作系统</p>\n<p>我选择的是Ubuntu Server 14.04 LTS,系统已经自带了openjdk 7，可以作为编译openjdk 7的bootstrap jdk,这里我就省略了安装bootstrap jdk的步骤了。</p>\n</li>\n<li><p>安装依赖的软件包</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$sudo</span> apt-get install build-essential gawk m4 libasound2-dev libcups2-dev libxrender-dev xorg-dev xutils-dev binutils libmotif-dev ant</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>下载openjdk 7源码并解压</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$wget</span> http://download.java.net/openjdk/jdk7u75/ri/openjdk-7u75-src-b13-18_dec_2014.zip</span><br></pre></td></tr></table></figure>\n<a id=\"more\"></a></li>\n<li><p>设置一些编译所需的环境变量</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">export</span> LANG=C</span><br><span class=\"line\"><span class=\"comment\">#bootstrap jdk的路径，我放在了~/jdk1.6</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> ALT_BOOTDIR=~/jdk1.6</span><br><span class=\"line\"><span class=\"comment\">#允许编译过程中自动下载</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> ALLOW_DOWNLOADS=<span class=\"literal\">true</span></span><br><span class=\"line\"><span class=\"comment\">#设置并行编译的线程数，我这虚拟机给了一个核，写个1</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> HOTSPOT_BUILD_JOBS=1</span><br><span class=\"line\"><span class=\"built_in\">export</span> ALT_PARALLEL_COMPILE_JOBS=1</span><br><span class=\"line\"><span class=\"built_in\">export</span> SKIP_COMPARE_IMAGES=<span class=\"literal\">true</span></span><br><span class=\"line\"><span class=\"comment\">#使用预编译头文件</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> USE_PRECOMPILED_HEADER=<span class=\"literal\">true</span></span><br><span class=\"line\"><span class=\"comment\">#需要编译的内容</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> BUILD_LANGTOOLS=<span class=\"literal\">true</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> BUILD_HOTSPOT=<span class=\"literal\">true</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> BUILD_JDK=<span class=\"literal\">true</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> BUILD_DEPLOY=<span class=\"literal\">false</span></span><br><span class=\"line\"><span class=\"comment\">#编译结果的存放路径</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> ALT_OUTPUTDIR=~/compiled_jdk</span><br><span class=\"line\"><span class=\"built_in\">unset</span> JAVA_HOEM</span><br><span class=\"line\"><span class=\"built_in\">unset</span> CLASSPATH</span><br></pre></td></tr></table></figure>\n</li>\n</ol>\n<h3 id=\"准备就绪，开搞\"><a href=\"#准备就绪，开搞\" class=\"headerlink\" title=\"准备就绪，开搞\"></a>准备就绪，开搞</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">xing@ubuntu-compile:~/openjdk$ make sanity </span><br><span class=\"line\">.</span><br><span class=\"line\">.</span><br><span class=\"line\">.</span><br><span class=\"line\">External File/Binary Locations:</span><br><span class=\"line\">  USRJDKINSTANCES_PATH = /opt/java</span><br><span class=\"line\">  BUILD_JDK_IMPORT_PATH = /NOT-SET/re/jdk/1.7.0/promoted/latest/binaries</span><br><span class=\"line\">    ALT_BUILD_JDK_IMPORT_PATH = </span><br><span class=\"line\">  JDK_IMPORT_PATH = /NOT-SET/re/jdk/1.7.0/promoted/latest/binaries/linux-amd64</span><br><span class=\"line\">    ALT_JDK_IMPORT_PATH = </span><br><span class=\"line\">  LANGTOOLS_DIST = </span><br><span class=\"line\">    ALT_LANGTOOLS_DIST = /home/xing/compiled_jdk/langtools/dist</span><br><span class=\"line\">  CORBA_DIST = </span><br><span class=\"line\">    ALT_CORBA_DIST = /home/xing/compiled_jdk/corba/dist</span><br><span class=\"line\">  JAXP_DIST = </span><br><span class=\"line\">    ALT_JAXP_DIST = /home/xing/compiled_jdk/jaxp/dist</span><br><span class=\"line\">  JAXWS_DIST = </span><br><span class=\"line\">    ALT_JAXWS_DIST = /home/xing/compiled_jdk/jaxws/dist</span><br><span class=\"line\">  HOTSPOT_DOCS_IMPORT_PATH = /NO_DOCS_DIR</span><br><span class=\"line\">    ALT_HOTSPOT_DOCS_IMPORT_PATH = </span><br><span class=\"line\">  HOTSPOT_IMPORT_PATH = /home/xing/compiled_jdk/hotspot/import</span><br><span class=\"line\">    ALT_HOTSPOT_IMPORT_PATH = /home/xing/compiled_jdk/hotspot/import</span><br><span class=\"line\">  HOTSPOT_SERVER_PATH = /home/xing/compiled_jdk/hotspot/import/jre/lib/amd64/server</span><br><span class=\"line\">    ALT_HOTSPOT_SERVER_PATH = </span><br><span class=\"line\">  CACERTS_FILE = ./../src/share/lib/security/cacerts</span><br><span class=\"line\">    ALT_CACERTS_FILE = </span><br><span class=\"line\">  CUPS_HEADERS_PATH = /usr/include</span><br><span class=\"line\">    ALT_CUPS_HEADERS_PATH = </span><br><span class=\"line\"> </span><br><span class=\"line\">OpenJDK-specific settings:</span><br><span class=\"line\">  FREETYPE_HEADERS_PATH = /usr/include</span><br><span class=\"line\">    ALT_FREETYPE_HEADERS_PATH = </span><br><span class=\"line\">  FREETYPE_LIB_PATH = /usr/lib</span><br><span class=\"line\">    ALT_FREETYPE_LIB_PATH = </span><br><span class=\"line\"> </span><br><span class=\"line\">Previous JDK Settings:</span><br><span class=\"line\">  PREVIOUS_RELEASE_PATH = USING-PREVIOUS_RELEASE_IMAGE</span><br><span class=\"line\">    ALT_PREVIOUS_RELEASE_PATH = </span><br><span class=\"line\">  PREVIOUS_JDK_VERSION = 1.6.0</span><br><span class=\"line\">    ALT_PREVIOUS_JDK_VERSION = </span><br><span class=\"line\">  PREVIOUS_JDK_FILE = </span><br><span class=\"line\">    ALT_PREVIOUS_JDK_FILE = </span><br><span class=\"line\">  PREVIOUS_JRE_FILE = </span><br><span class=\"line\">    ALT_PREVIOUS_JRE_FILE = </span><br><span class=\"line\">  PREVIOUS_RELEASE_IMAGE = /usr/lib/jvm/java-7-openjdk-amd64/</span><br><span class=\"line\">    ALT_PREVIOUS_RELEASE_IMAGE = </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">Sanity check passed.</span><br><span class=\"line\"></span><br><span class=\"line\">xing@ubuntu-compile:~/openjdk$ make</span><br><span class=\"line\">.</span><br><span class=\"line\">.</span><br><span class=\"line\">.</span><br></pre></td></tr></table></figure>\n<h3 id=\"遇到的问题​\"><a href=\"#遇到的问题​\" class=\"headerlink\" title=\"遇到的问题​\"></a>遇到的问题​</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd linux_amd64_compiler2/product &amp;amp;amp;amp;amp;amp;amp;amp;&amp;amp;amp;amp;amp;amp;amp;amp; ./test_gamma</span><br><span class=\"line\">   Using java runtime at: /usr/lib/jvm/java-7-openjdk-amd64/jre</span><br><span class=\"line\">   Error occurred during initialization of VM</span><br><span class=\"line\">   java.lang.NullPointerException</span><br><span class=\"line\"></span><br><span class=\"line\">   \tat java.util.Hashtable.put(Hashtable.java:514)</span><br><span class=\"line\">   \tat java.lang.System.initProperties(Native Method)</span><br><span class=\"line\">   \tat java.lang.System.initializeSystemClass(System.java:1119)</span><br><span class=\"line\"></span><br><span class=\"line\">   make[4]: *** [product] Error 1</span><br><span class=\"line\">   make[4]: Leaving directory `/home/xing/compiled_jdk/hotspot/outputdir&apos;</span><br><span class=\"line\">   make[3]: *** [generic_build2] Error 2</span><br><span class=\"line\">   make[3]: Leaving directory `/home/xing/openjdk/hotspot/make&apos;</span><br><span class=\"line\">   make[2]: *** [product] Error 2</span><br><span class=\"line\">   make[2]: Leaving directory `/home/xing/openjdk/hotspot/make&apos;</span><br><span class=\"line\">   make[1]: *** [hotspot-build] Error 2</span><br><span class=\"line\">   make[1]: Leaving directory `/home/xing/openjdk&apos;</span><br><span class=\"line\">   make: *** [build_product_image] Error 2</span><br></pre></td></tr></table></figure>\n<p>从网上找到的解决办法是删除makefile中的 ./test_gamma,或者安装oracle jdk1.6来作为bootstrap jdk应该也可以。<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/usr/lib/jvm/java-7-openjdk-amd64//bin/java -XX:-PrintVMOptions -XX:+UnlockDiagnosticVMOptions -XX:-LogVMOutput -Xmx512m -Xms512m -XX:PermSize=32m -XX:MaxPermSize=160m -jar /home/xing/compiled_jdk/btjars/generatecurrencydata.jar -o /home/xing/compiled_jdk/lib/currency.data.temp \\&amp;amp;amp;amp;amp;amp;amp;amp;lt; ../../../src/share/classes/java/util/CurrencyData.properties</span><br><span class=\"line\">      Error: time is more than 10 years from present: 1136059200000</span><br><span class=\"line\">      java.lang.RuntimeException: time is more than 10 years from present: 1136059200000</span><br><span class=\"line\">      \tat build.tools.generatecurrencydata.GenerateCurrencyData.makeSpecialCaseEntry(GenerateCurrencyData.java:285)</span><br><span class=\"line\">      \tat build.tools.generatecurrencydata.GenerateCurrencyData.buildMainAndSpecialCaseTables(GenerateCurrencyData.java:225)</span><br><span class=\"line\">      \tat build.tools.generatecurrencydata.GenerateCurrencyData.main(GenerateCurrencyData.java:154)</span><br><span class=\"line\">      make[4]: *** [/home/xing/compiled_jdk/lib/currency.data] Error 1</span><br><span class=\"line\">      make[4]: Leaving directory `/home/xing/openjdk/jdk/make/java/java&apos;</span><br><span class=\"line\">      make[3]: *** [all] Error 1</span><br><span class=\"line\">      make[3]: Leaving directory `/home/xing/openjdk/jdk/make/java&apos;</span><br><span class=\"line\">      make[2]: *** [all] Error 1</span><br><span class=\"line\">      make[2]: Leaving directory `/home/xing/openjdk/jdk/make&apos;</span><br><span class=\"line\">      make[1]: *** [jdk-build] Error 2</span><br><span class=\"line\">      make[1]: Leaving directory `/home/xing/openjdk&apos;</span><br><span class=\"line\">      make: *** [build_product_image] Error 2</span><br></pre></td></tr></table></figure></p>\n<p>错误提示是说时间超过了10年，解决办法是更改源文件，将10年前的时间改到十年之内。</p>\n<h3 id=\"编译结果\"><a href=\"#编译结果\" class=\"headerlink\" title=\"编译结果\"></a>编译结果</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt;Finished making images @ Fri Jun  2 01:43:41 CST 2017 ...</span><br><span class=\"line\">make[2]: Leaving directory `/home/xing/openjdk/jdk/make&apos;</span><br><span class=\"line\">########################################################################</span><br><span class=\"line\">##### Leaving jdk for target(s) sanity all docs images             #####</span><br><span class=\"line\">########################################################################</span><br><span class=\"line\">##### Build time 00:06:34 jdk for target(s) sanity all docs images #####</span><br><span class=\"line\">########################################################################</span><br><span class=\"line\"></span><br><span class=\"line\">#-- Build times ----------</span><br><span class=\"line\">Target all_product_build</span><br><span class=\"line\">Start 2017-06-02 01:36:50</span><br><span class=\"line\">End   2017-06-02 01:43:41</span><br><span class=\"line\">00:00:07 corba</span><br><span class=\"line\">00:00:04 hotspot</span><br><span class=\"line\">00:00:02 jaxp</span><br><span class=\"line\">00:00:02 jaxws</span><br><span class=\"line\">00:06:34 jdk</span><br><span class=\"line\">00:00:01 langtools</span><br><span class=\"line\">00:06:51 TOTAL</span><br><span class=\"line\">-------------------------</span><br><span class=\"line\">make[1]: Leaving directory `/home/xing/openjdk&apos;</span><br></pre></td></tr></table></figure>\n<p>整个编译过程还是比较顺利的，遇到的也是些小问题~</p>\n<h3 id=\"运行一下\"><a href=\"#运行一下\" class=\"headerlink\" title=\"运行一下\"></a>运行一下</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">xing@ubuntu-compile:~/compiled_jdk$ ~/compiled_jdk/bin/java -version</span><br><span class=\"line\">openjdk version <span class=\"string\">\"1.7.0-internal\"</span></span><br><span class=\"line\">OpenJDK Runtime Environment (build 1.7.0-internal-xing_2017_06_02_01_12-b00)</span><br><span class=\"line\">OpenJDK 64-Bit Server VM (build 24.75-b04, mixed mode)</span><br></pre></td></tr></table></figure>\n<p>可以看到已经能够成功运行，并且带上了编译的时间和用户。</p>\n<p>参考书籍：《深入理解Java虚拟机 JVM高级特性与最佳实践》</p>\n","site":{"data":{}},"excerpt":"<h3 id=\"编译环境构建\"><a href=\"#编译环境构建\" class=\"headerlink\" title=\"编译环境构建\"></a>编译环境构建</h3><ol>\n<li><p>操作系统</p>\n<p>我选择的是Ubuntu Server 14.04 LTS,系统已经自带了openjdk 7，可以作为编译openjdk 7的bootstrap jdk,这里我就省略了安装bootstrap jdk的步骤了。</p>\n</li>\n<li><p>安装依赖的软件包</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$sudo</span> apt-get install build-essential gawk m4 libasound2-dev libcups2-dev libxrender-dev xorg-dev xutils-dev binutils libmotif-dev ant</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>下载openjdk 7源码并解压</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$wget</span> http://download.java.net/openjdk/jdk7u75/ri/openjdk-7u75-src-b13-18_dec_2014.zip</span><br></pre></td></tr></table></figure>","more":"</li>\n<li><p>设置一些编译所需的环境变量</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">export</span> LANG=C</span><br><span class=\"line\"><span class=\"comment\">#bootstrap jdk的路径，我放在了~/jdk1.6</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> ALT_BOOTDIR=~/jdk1.6</span><br><span class=\"line\"><span class=\"comment\">#允许编译过程中自动下载</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> ALLOW_DOWNLOADS=<span class=\"literal\">true</span></span><br><span class=\"line\"><span class=\"comment\">#设置并行编译的线程数，我这虚拟机给了一个核，写个1</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> HOTSPOT_BUILD_JOBS=1</span><br><span class=\"line\"><span class=\"built_in\">export</span> ALT_PARALLEL_COMPILE_JOBS=1</span><br><span class=\"line\"><span class=\"built_in\">export</span> SKIP_COMPARE_IMAGES=<span class=\"literal\">true</span></span><br><span class=\"line\"><span class=\"comment\">#使用预编译头文件</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> USE_PRECOMPILED_HEADER=<span class=\"literal\">true</span></span><br><span class=\"line\"><span class=\"comment\">#需要编译的内容</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> BUILD_LANGTOOLS=<span class=\"literal\">true</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> BUILD_HOTSPOT=<span class=\"literal\">true</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> BUILD_JDK=<span class=\"literal\">true</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> BUILD_DEPLOY=<span class=\"literal\">false</span></span><br><span class=\"line\"><span class=\"comment\">#编译结果的存放路径</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> ALT_OUTPUTDIR=~/compiled_jdk</span><br><span class=\"line\"><span class=\"built_in\">unset</span> JAVA_HOEM</span><br><span class=\"line\"><span class=\"built_in\">unset</span> CLASSPATH</span><br></pre></td></tr></table></figure>\n</li>\n</ol>\n<h3 id=\"准备就绪，开搞\"><a href=\"#准备就绪，开搞\" class=\"headerlink\" title=\"准备就绪，开搞\"></a>准备就绪，开搞</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">xing@ubuntu-compile:~/openjdk$ make sanity </span><br><span class=\"line\">.</span><br><span class=\"line\">.</span><br><span class=\"line\">.</span><br><span class=\"line\">External File/Binary Locations:</span><br><span class=\"line\">  USRJDKINSTANCES_PATH = /opt/java</span><br><span class=\"line\">  BUILD_JDK_IMPORT_PATH = /NOT-SET/re/jdk/1.7.0/promoted/latest/binaries</span><br><span class=\"line\">    ALT_BUILD_JDK_IMPORT_PATH = </span><br><span class=\"line\">  JDK_IMPORT_PATH = /NOT-SET/re/jdk/1.7.0/promoted/latest/binaries/linux-amd64</span><br><span class=\"line\">    ALT_JDK_IMPORT_PATH = </span><br><span class=\"line\">  LANGTOOLS_DIST = </span><br><span class=\"line\">    ALT_LANGTOOLS_DIST = /home/xing/compiled_jdk/langtools/dist</span><br><span class=\"line\">  CORBA_DIST = </span><br><span class=\"line\">    ALT_CORBA_DIST = /home/xing/compiled_jdk/corba/dist</span><br><span class=\"line\">  JAXP_DIST = </span><br><span class=\"line\">    ALT_JAXP_DIST = /home/xing/compiled_jdk/jaxp/dist</span><br><span class=\"line\">  JAXWS_DIST = </span><br><span class=\"line\">    ALT_JAXWS_DIST = /home/xing/compiled_jdk/jaxws/dist</span><br><span class=\"line\">  HOTSPOT_DOCS_IMPORT_PATH = /NO_DOCS_DIR</span><br><span class=\"line\">    ALT_HOTSPOT_DOCS_IMPORT_PATH = </span><br><span class=\"line\">  HOTSPOT_IMPORT_PATH = /home/xing/compiled_jdk/hotspot/import</span><br><span class=\"line\">    ALT_HOTSPOT_IMPORT_PATH = /home/xing/compiled_jdk/hotspot/import</span><br><span class=\"line\">  HOTSPOT_SERVER_PATH = /home/xing/compiled_jdk/hotspot/import/jre/lib/amd64/server</span><br><span class=\"line\">    ALT_HOTSPOT_SERVER_PATH = </span><br><span class=\"line\">  CACERTS_FILE = ./../src/share/lib/security/cacerts</span><br><span class=\"line\">    ALT_CACERTS_FILE = </span><br><span class=\"line\">  CUPS_HEADERS_PATH = /usr/include</span><br><span class=\"line\">    ALT_CUPS_HEADERS_PATH = </span><br><span class=\"line\"> </span><br><span class=\"line\">OpenJDK-specific settings:</span><br><span class=\"line\">  FREETYPE_HEADERS_PATH = /usr/include</span><br><span class=\"line\">    ALT_FREETYPE_HEADERS_PATH = </span><br><span class=\"line\">  FREETYPE_LIB_PATH = /usr/lib</span><br><span class=\"line\">    ALT_FREETYPE_LIB_PATH = </span><br><span class=\"line\"> </span><br><span class=\"line\">Previous JDK Settings:</span><br><span class=\"line\">  PREVIOUS_RELEASE_PATH = USING-PREVIOUS_RELEASE_IMAGE</span><br><span class=\"line\">    ALT_PREVIOUS_RELEASE_PATH = </span><br><span class=\"line\">  PREVIOUS_JDK_VERSION = 1.6.0</span><br><span class=\"line\">    ALT_PREVIOUS_JDK_VERSION = </span><br><span class=\"line\">  PREVIOUS_JDK_FILE = </span><br><span class=\"line\">    ALT_PREVIOUS_JDK_FILE = </span><br><span class=\"line\">  PREVIOUS_JRE_FILE = </span><br><span class=\"line\">    ALT_PREVIOUS_JRE_FILE = </span><br><span class=\"line\">  PREVIOUS_RELEASE_IMAGE = /usr/lib/jvm/java-7-openjdk-amd64/</span><br><span class=\"line\">    ALT_PREVIOUS_RELEASE_IMAGE = </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">Sanity check passed.</span><br><span class=\"line\"></span><br><span class=\"line\">xing@ubuntu-compile:~/openjdk$ make</span><br><span class=\"line\">.</span><br><span class=\"line\">.</span><br><span class=\"line\">.</span><br></pre></td></tr></table></figure>\n<h3 id=\"遇到的问题​\"><a href=\"#遇到的问题​\" class=\"headerlink\" title=\"遇到的问题​\"></a>遇到的问题​</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd linux_amd64_compiler2/product &amp;amp;amp;amp;amp;amp;amp;amp;&amp;amp;amp;amp;amp;amp;amp;amp; ./test_gamma</span><br><span class=\"line\">   Using java runtime at: /usr/lib/jvm/java-7-openjdk-amd64/jre</span><br><span class=\"line\">   Error occurred during initialization of VM</span><br><span class=\"line\">   java.lang.NullPointerException</span><br><span class=\"line\"></span><br><span class=\"line\">   \tat java.util.Hashtable.put(Hashtable.java:514)</span><br><span class=\"line\">   \tat java.lang.System.initProperties(Native Method)</span><br><span class=\"line\">   \tat java.lang.System.initializeSystemClass(System.java:1119)</span><br><span class=\"line\"></span><br><span class=\"line\">   make[4]: *** [product] Error 1</span><br><span class=\"line\">   make[4]: Leaving directory `/home/xing/compiled_jdk/hotspot/outputdir&apos;</span><br><span class=\"line\">   make[3]: *** [generic_build2] Error 2</span><br><span class=\"line\">   make[3]: Leaving directory `/home/xing/openjdk/hotspot/make&apos;</span><br><span class=\"line\">   make[2]: *** [product] Error 2</span><br><span class=\"line\">   make[2]: Leaving directory `/home/xing/openjdk/hotspot/make&apos;</span><br><span class=\"line\">   make[1]: *** [hotspot-build] Error 2</span><br><span class=\"line\">   make[1]: Leaving directory `/home/xing/openjdk&apos;</span><br><span class=\"line\">   make: *** [build_product_image] Error 2</span><br></pre></td></tr></table></figure>\n<p>从网上找到的解决办法是删除makefile中的 ./test_gamma,或者安装oracle jdk1.6来作为bootstrap jdk应该也可以。<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/usr/lib/jvm/java-7-openjdk-amd64//bin/java -XX:-PrintVMOptions -XX:+UnlockDiagnosticVMOptions -XX:-LogVMOutput -Xmx512m -Xms512m -XX:PermSize=32m -XX:MaxPermSize=160m -jar /home/xing/compiled_jdk/btjars/generatecurrencydata.jar -o /home/xing/compiled_jdk/lib/currency.data.temp \\&amp;amp;amp;amp;amp;amp;amp;amp;lt; ../../../src/share/classes/java/util/CurrencyData.properties</span><br><span class=\"line\">      Error: time is more than 10 years from present: 1136059200000</span><br><span class=\"line\">      java.lang.RuntimeException: time is more than 10 years from present: 1136059200000</span><br><span class=\"line\">      \tat build.tools.generatecurrencydata.GenerateCurrencyData.makeSpecialCaseEntry(GenerateCurrencyData.java:285)</span><br><span class=\"line\">      \tat build.tools.generatecurrencydata.GenerateCurrencyData.buildMainAndSpecialCaseTables(GenerateCurrencyData.java:225)</span><br><span class=\"line\">      \tat build.tools.generatecurrencydata.GenerateCurrencyData.main(GenerateCurrencyData.java:154)</span><br><span class=\"line\">      make[4]: *** [/home/xing/compiled_jdk/lib/currency.data] Error 1</span><br><span class=\"line\">      make[4]: Leaving directory `/home/xing/openjdk/jdk/make/java/java&apos;</span><br><span class=\"line\">      make[3]: *** [all] Error 1</span><br><span class=\"line\">      make[3]: Leaving directory `/home/xing/openjdk/jdk/make/java&apos;</span><br><span class=\"line\">      make[2]: *** [all] Error 1</span><br><span class=\"line\">      make[2]: Leaving directory `/home/xing/openjdk/jdk/make&apos;</span><br><span class=\"line\">      make[1]: *** [jdk-build] Error 2</span><br><span class=\"line\">      make[1]: Leaving directory `/home/xing/openjdk&apos;</span><br><span class=\"line\">      make: *** [build_product_image] Error 2</span><br></pre></td></tr></table></figure></p>\n<p>错误提示是说时间超过了10年，解决办法是更改源文件，将10年前的时间改到十年之内。</p>\n<h3 id=\"编译结果\"><a href=\"#编译结果\" class=\"headerlink\" title=\"编译结果\"></a>编译结果</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt;Finished making images @ Fri Jun  2 01:43:41 CST 2017 ...</span><br><span class=\"line\">make[2]: Leaving directory `/home/xing/openjdk/jdk/make&apos;</span><br><span class=\"line\">########################################################################</span><br><span class=\"line\">##### Leaving jdk for target(s) sanity all docs images             #####</span><br><span class=\"line\">########################################################################</span><br><span class=\"line\">##### Build time 00:06:34 jdk for target(s) sanity all docs images #####</span><br><span class=\"line\">########################################################################</span><br><span class=\"line\"></span><br><span class=\"line\">#-- Build times ----------</span><br><span class=\"line\">Target all_product_build</span><br><span class=\"line\">Start 2017-06-02 01:36:50</span><br><span class=\"line\">End   2017-06-02 01:43:41</span><br><span class=\"line\">00:00:07 corba</span><br><span class=\"line\">00:00:04 hotspot</span><br><span class=\"line\">00:00:02 jaxp</span><br><span class=\"line\">00:00:02 jaxws</span><br><span class=\"line\">00:06:34 jdk</span><br><span class=\"line\">00:00:01 langtools</span><br><span class=\"line\">00:06:51 TOTAL</span><br><span class=\"line\">-------------------------</span><br><span class=\"line\">make[1]: Leaving directory `/home/xing/openjdk&apos;</span><br></pre></td></tr></table></figure>\n<p>整个编译过程还是比较顺利的，遇到的也是些小问题~</p>\n<h3 id=\"运行一下\"><a href=\"#运行一下\" class=\"headerlink\" title=\"运行一下\"></a>运行一下</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">xing@ubuntu-compile:~/compiled_jdk$ ~/compiled_jdk/bin/java -version</span><br><span class=\"line\">openjdk version <span class=\"string\">\"1.7.0-internal\"</span></span><br><span class=\"line\">OpenJDK Runtime Environment (build 1.7.0-internal-xing_2017_06_02_01_12-b00)</span><br><span class=\"line\">OpenJDK 64-Bit Server VM (build 24.75-b04, mixed mode)</span><br></pre></td></tr></table></figure>\n<p>可以看到已经能够成功运行，并且带上了编译的时间和用户。</p>\n<p>参考书籍：《深入理解Java虚拟机 JVM高级特性与最佳实践》</p>"},{"title":"Django快速上手笔记之HelloWorld","date":"2017-10-02T05:09:39.000Z","_content":"\n在上篇博文中，成功的安装好了Django框架，在这篇博文中，先建个helloworl工程试试水。再根据helloworld工程进一步介绍Django框架中的各个模块怎么配置和使用。废话不多讲，上图。\n\n<!--more-->\n\n在Linux环境下用命令行也可以很好的进行Django项目的开发，为了学习的方便我在windowns环境下使用Pycharm集成开发环境作示范。\n\n### 创建项目\n\n1.点击file->new project,选择Django项目，输入你想创建的项目名称和所在路径，选择python解释器版本，点击create即可生成一个Django项目。\n\n![image](/blogimg/django-step-1.png)\n\n生成的项目的目录结构如下：\n\n![image](/blogimg/django-step-2.png)\n\n### 创建Django APP\n\n在一个Django项目中，可以包含多个APP，一个APP可以作为分系统、子模块、功能部件等待。创建方法为在pycharm的terminal中输入命令\n\n```cmd\npython manage.py startapp hello\n```\n\n![imange](/blogimg/django-step-3.png)\n\n创建成功的APP目录结构如下：\n\n![imange](/blogimg/django-step-4.png)\n\n### 编写路由\n\n在project目录下的urls.py文件中添加需要的路由\n\n```python\nfrom django.conf.urls import url\nfrom django.contrib import admin\n\nfrom Hello import views  #导入对应的app的views文件\n\nurlpatterns = [\n    url(r'^admin/', admin.site.urls),\n    url(r'index/',views.index)  #自己需要的路由，第一个参数是url匹配的正则表达式，第二个参数是对应的views的业务逻辑方法\n]\n```\n\n### 编写对应的业务逻辑\n\n业务逻辑代码需要在APP中views.py文件中编写：\n\n```python\n# -*- coding: utf-8 -*-\nfrom __future__ import unicode_literals\n\nfrom django.shortcuts import render\nfrom django.shortcuts import HttpResponse #导入HttpResponse模块\n\n# Create your views here.\ndef index(request):\n    return  HttpResponse(\"Hello Django!\")  #直接返回一个字符串\n```\n\n完成了以上两步，我们就将index这个url路径指向了views中的index()方法，它完成的动作便是给访问/index/这个url的浏览器返回“Hello Django!”字符串。\n\n### 让服务跑起来\n\n1. 在pycharm的terminal中执行：\n\n```cmd\npython manange.py runserver 127.0.0.1:8000\n```\n\n2. 直接点击pycharm工具栏中的绿色run图标即可。\n\n### 看看效果\n\n![image](/blogimg/django-step-5.png)\n\n服务开启正常，用浏览器访问一下。\n\n![imange](/blogimg/django-step-6.png)\n\nOK,服务运行正常，说明这个工程创建是成功的。","source":"_posts/Django-helloworld.md","raw":"---\ntitle: Django快速上手笔记之HelloWorld\ncategories:\n  - Program\ntags:\n  - python web Django\ndate: 2017-10-02 13:09:39\n---\n\n在上篇博文中，成功的安装好了Django框架，在这篇博文中，先建个helloworl工程试试水。再根据helloworld工程进一步介绍Django框架中的各个模块怎么配置和使用。废话不多讲，上图。\n\n<!--more-->\n\n在Linux环境下用命令行也可以很好的进行Django项目的开发，为了学习的方便我在windowns环境下使用Pycharm集成开发环境作示范。\n\n### 创建项目\n\n1.点击file->new project,选择Django项目，输入你想创建的项目名称和所在路径，选择python解释器版本，点击create即可生成一个Django项目。\n\n![image](/blogimg/django-step-1.png)\n\n生成的项目的目录结构如下：\n\n![image](/blogimg/django-step-2.png)\n\n### 创建Django APP\n\n在一个Django项目中，可以包含多个APP，一个APP可以作为分系统、子模块、功能部件等待。创建方法为在pycharm的terminal中输入命令\n\n```cmd\npython manage.py startapp hello\n```\n\n![imange](/blogimg/django-step-3.png)\n\n创建成功的APP目录结构如下：\n\n![imange](/blogimg/django-step-4.png)\n\n### 编写路由\n\n在project目录下的urls.py文件中添加需要的路由\n\n```python\nfrom django.conf.urls import url\nfrom django.contrib import admin\n\nfrom Hello import views  #导入对应的app的views文件\n\nurlpatterns = [\n    url(r'^admin/', admin.site.urls),\n    url(r'index/',views.index)  #自己需要的路由，第一个参数是url匹配的正则表达式，第二个参数是对应的views的业务逻辑方法\n]\n```\n\n### 编写对应的业务逻辑\n\n业务逻辑代码需要在APP中views.py文件中编写：\n\n```python\n# -*- coding: utf-8 -*-\nfrom __future__ import unicode_literals\n\nfrom django.shortcuts import render\nfrom django.shortcuts import HttpResponse #导入HttpResponse模块\n\n# Create your views here.\ndef index(request):\n    return  HttpResponse(\"Hello Django!\")  #直接返回一个字符串\n```\n\n完成了以上两步，我们就将index这个url路径指向了views中的index()方法，它完成的动作便是给访问/index/这个url的浏览器返回“Hello Django!”字符串。\n\n### 让服务跑起来\n\n1. 在pycharm的terminal中执行：\n\n```cmd\npython manange.py runserver 127.0.0.1:8000\n```\n\n2. 直接点击pycharm工具栏中的绿色run图标即可。\n\n### 看看效果\n\n![image](/blogimg/django-step-5.png)\n\n服务开启正常，用浏览器访问一下。\n\n![imange](/blogimg/django-step-6.png)\n\nOK,服务运行正常，说明这个工程创建是成功的。","slug":"Django-helloworld","published":1,"updated":"2017-12-04T07:27:28.745Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjeqig1k2000nlgqaq680xclg","content":"<p>在上篇博文中，成功的安装好了Django框架，在这篇博文中，先建个helloworl工程试试水。再根据helloworld工程进一步介绍Django框架中的各个模块怎么配置和使用。废话不多讲，上图。</p>\n<a id=\"more\"></a>\n<p>在Linux环境下用命令行也可以很好的进行Django项目的开发，为了学习的方便我在windowns环境下使用Pycharm集成开发环境作示范。</p>\n<h3 id=\"创建项目\"><a href=\"#创建项目\" class=\"headerlink\" title=\"创建项目\"></a>创建项目</h3><p>1.点击file-&gt;new project,选择Django项目，输入你想创建的项目名称和所在路径，选择python解释器版本，点击create即可生成一个Django项目。</p>\n<p><img src=\"/blogimg/django-step-1.png\" alt=\"image\"></p>\n<p>生成的项目的目录结构如下：</p>\n<p><img src=\"/blogimg/django-step-2.png\" alt=\"image\"></p>\n<h3 id=\"创建Django-APP\"><a href=\"#创建Django-APP\" class=\"headerlink\" title=\"创建Django APP\"></a>创建Django APP</h3><p>在一个Django项目中，可以包含多个APP，一个APP可以作为分系统、子模块、功能部件等待。创建方法为在pycharm的terminal中输入命令</p>\n<figure class=\"highlight cmd\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">python manage.py startapp hello</span><br></pre></td></tr></table></figure>\n<p><img src=\"/blogimg/django-step-3.png\" alt=\"imange\"></p>\n<p>创建成功的APP目录结构如下：</p>\n<p><img src=\"/blogimg/django-step-4.png\" alt=\"imange\"></p>\n<h3 id=\"编写路由\"><a href=\"#编写路由\" class=\"headerlink\" title=\"编写路由\"></a>编写路由</h3><p>在project目录下的urls.py文件中添加需要的路由</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> django.conf.urls <span class=\"keyword\">import</span> url</span><br><span class=\"line\"><span class=\"keyword\">from</span> django.contrib <span class=\"keyword\">import</span> admin</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> Hello <span class=\"keyword\">import</span> views  <span class=\"comment\">#导入对应的app的views文件</span></span><br><span class=\"line\"></span><br><span class=\"line\">urlpatterns = [</span><br><span class=\"line\">    url(<span class=\"string\">r'^admin/'</span>, admin.site.urls),</span><br><span class=\"line\">    url(<span class=\"string\">r'index/'</span>,views.index)  <span class=\"comment\">#自己需要的路由，第一个参数是url匹配的正则表达式，第二个参数是对应的views的业务逻辑方法</span></span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n<h3 id=\"编写对应的业务逻辑\"><a href=\"#编写对应的业务逻辑\" class=\"headerlink\" title=\"编写对应的业务逻辑\"></a>编写对应的业务逻辑</h3><p>业务逻辑代码需要在APP中views.py文件中编写：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># -*- coding: utf-8 -*-</span></span><br><span class=\"line\"><span class=\"keyword\">from</span> __future__ <span class=\"keyword\">import</span> unicode_literals</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> django.shortcuts <span class=\"keyword\">import</span> render</span><br><span class=\"line\"><span class=\"keyword\">from</span> django.shortcuts <span class=\"keyword\">import</span> HttpResponse <span class=\"comment\">#导入HttpResponse模块</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Create your views here.</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">index</span><span class=\"params\">(request)</span>:</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span>  HttpResponse(<span class=\"string\">\"Hello Django!\"</span>)  <span class=\"comment\">#直接返回一个字符串</span></span><br></pre></td></tr></table></figure>\n<p>完成了以上两步，我们就将index这个url路径指向了views中的index()方法，它完成的动作便是给访问/index/这个url的浏览器返回“Hello Django!”字符串。</p>\n<h3 id=\"让服务跑起来\"><a href=\"#让服务跑起来\" class=\"headerlink\" title=\"让服务跑起来\"></a>让服务跑起来</h3><ol>\n<li>在pycharm的terminal中执行：</li>\n</ol>\n<figure class=\"highlight cmd\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">python manange.py runserver <span class=\"number\">127</span>.<span class=\"number\">0</span>.<span class=\"number\">0</span>.<span class=\"number\">1</span>:<span class=\"number\">8000</span></span><br></pre></td></tr></table></figure>\n<ol>\n<li>直接点击pycharm工具栏中的绿色run图标即可。</li>\n</ol>\n<h3 id=\"看看效果\"><a href=\"#看看效果\" class=\"headerlink\" title=\"看看效果\"></a>看看效果</h3><p><img src=\"/blogimg/django-step-5.png\" alt=\"image\"></p>\n<p>服务开启正常，用浏览器访问一下。</p>\n<p><img src=\"/blogimg/django-step-6.png\" alt=\"imange\"></p>\n<p>OK,服务运行正常，说明这个工程创建是成功的。</p>\n","site":{"data":{}},"excerpt":"<p>在上篇博文中，成功的安装好了Django框架，在这篇博文中，先建个helloworl工程试试水。再根据helloworld工程进一步介绍Django框架中的各个模块怎么配置和使用。废话不多讲，上图。</p>","more":"<p>在Linux环境下用命令行也可以很好的进行Django项目的开发，为了学习的方便我在windowns环境下使用Pycharm集成开发环境作示范。</p>\n<h3 id=\"创建项目\"><a href=\"#创建项目\" class=\"headerlink\" title=\"创建项目\"></a>创建项目</h3><p>1.点击file-&gt;new project,选择Django项目，输入你想创建的项目名称和所在路径，选择python解释器版本，点击create即可生成一个Django项目。</p>\n<p><img src=\"/blogimg/django-step-1.png\" alt=\"image\"></p>\n<p>生成的项目的目录结构如下：</p>\n<p><img src=\"/blogimg/django-step-2.png\" alt=\"image\"></p>\n<h3 id=\"创建Django-APP\"><a href=\"#创建Django-APP\" class=\"headerlink\" title=\"创建Django APP\"></a>创建Django APP</h3><p>在一个Django项目中，可以包含多个APP，一个APP可以作为分系统、子模块、功能部件等待。创建方法为在pycharm的terminal中输入命令</p>\n<figure class=\"highlight cmd\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">python manage.py startapp hello</span><br></pre></td></tr></table></figure>\n<p><img src=\"/blogimg/django-step-3.png\" alt=\"imange\"></p>\n<p>创建成功的APP目录结构如下：</p>\n<p><img src=\"/blogimg/django-step-4.png\" alt=\"imange\"></p>\n<h3 id=\"编写路由\"><a href=\"#编写路由\" class=\"headerlink\" title=\"编写路由\"></a>编写路由</h3><p>在project目录下的urls.py文件中添加需要的路由</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> django.conf.urls <span class=\"keyword\">import</span> url</span><br><span class=\"line\"><span class=\"keyword\">from</span> django.contrib <span class=\"keyword\">import</span> admin</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> Hello <span class=\"keyword\">import</span> views  <span class=\"comment\">#导入对应的app的views文件</span></span><br><span class=\"line\"></span><br><span class=\"line\">urlpatterns = [</span><br><span class=\"line\">    url(<span class=\"string\">r'^admin/'</span>, admin.site.urls),</span><br><span class=\"line\">    url(<span class=\"string\">r'index/'</span>,views.index)  <span class=\"comment\">#自己需要的路由，第一个参数是url匹配的正则表达式，第二个参数是对应的views的业务逻辑方法</span></span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n<h3 id=\"编写对应的业务逻辑\"><a href=\"#编写对应的业务逻辑\" class=\"headerlink\" title=\"编写对应的业务逻辑\"></a>编写对应的业务逻辑</h3><p>业务逻辑代码需要在APP中views.py文件中编写：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># -*- coding: utf-8 -*-</span></span><br><span class=\"line\"><span class=\"keyword\">from</span> __future__ <span class=\"keyword\">import</span> unicode_literals</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> django.shortcuts <span class=\"keyword\">import</span> render</span><br><span class=\"line\"><span class=\"keyword\">from</span> django.shortcuts <span class=\"keyword\">import</span> HttpResponse <span class=\"comment\">#导入HttpResponse模块</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Create your views here.</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">index</span><span class=\"params\">(request)</span>:</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span>  HttpResponse(<span class=\"string\">\"Hello Django!\"</span>)  <span class=\"comment\">#直接返回一个字符串</span></span><br></pre></td></tr></table></figure>\n<p>完成了以上两步，我们就将index这个url路径指向了views中的index()方法，它完成的动作便是给访问/index/这个url的浏览器返回“Hello Django!”字符串。</p>\n<h3 id=\"让服务跑起来\"><a href=\"#让服务跑起来\" class=\"headerlink\" title=\"让服务跑起来\"></a>让服务跑起来</h3><ol>\n<li>在pycharm的terminal中执行：</li>\n</ol>\n<figure class=\"highlight cmd\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">python manange.py runserver <span class=\"number\">127</span>.<span class=\"number\">0</span>.<span class=\"number\">0</span>.<span class=\"number\">1</span>:<span class=\"number\">8000</span></span><br></pre></td></tr></table></figure>\n<ol>\n<li>直接点击pycharm工具栏中的绿色run图标即可。</li>\n</ol>\n<h3 id=\"看看效果\"><a href=\"#看看效果\" class=\"headerlink\" title=\"看看效果\"></a>看看效果</h3><p><img src=\"/blogimg/django-step-5.png\" alt=\"image\"></p>\n<p>服务开启正常，用浏览器访问一下。</p>\n<p><img src=\"/blogimg/django-step-6.png\" alt=\"imange\"></p>\n<p>OK,服务运行正常，说明这个工程创建是成功的。</p>"},{"title":"Python编程实践-----List中嵌套Dict，根据Dict的value进行排序","date":"2017-11-17T03:03:54.000Z","_content":"\n​\t今天遇到一个问题，我有一个list，其中放了多个dict，我想根据dict中的value对这个list进行排序。经过搜索，发现可以利用python中的sorted方法来完成。特记录一下，以免忘记。\n\n<!--more-->\n\n这是原本的list内容：\n\n```json\n[\n    {\n      \"date\": \"2017年11月17日 10:20\",\n      \"link\": \"http://toutiao.secjia.com/cisco-uav-cve-2017-12337\",\n      \"title\": \"12款思科产品出现未授权访问漏洞CVE-2017-12337 可拿设备Root权限\"\n    },\n    {\n      \"date\": \"2017年11月17日 09:55\",\n      \"link\": \"http://toutiao.secjia.com/office-mcv-cve-2017-11882\",\n      \"title\": \"Office内存破坏漏洞CVE-2017-11882 可执行任意代码失败了还可DoS\"\n    },\n    {\n      \"date\": \"2017年11月17日 09:42\",\n      \"link\": \"http://toutiao.secjia.com/ios-xe-xss-cve-2017-12304\",\n      \"title\": \"思科IOS及IOS XE软件再次爆出跨站脚本漏洞CVE-2017-12304 可以执行任意代码\"\n    },\n    {\n      \"date\": \"2017年11月16日 13:30\",\n      \"link\": \"http://toutiao.secjia.com/vep-charter\",\n      \"title\": \"下载 | 美政府发布《未分类漏洞权益VEP宪章》 增加0Day漏洞审查及披露的透明度\"\n    },\n    {\n      \"date\": \"2017年11月16日 15:34\",\n      \"link\": \"http://toutiao.secjia.com/mac-security-guideline\",\n      \"title\": \"mac电脑安全指南11招 普通用户很容易上手\"\n    },\n    {\n      \"date\": \"2017年11月16日 10:25\",\n      \"link\": \"http://toutiao.secjia.com/2017q3-apt-report\",\n      \"title\": \"卡巴发布2017Q3APT威胁报告 指出攻击者有针对供应链攻击的转移倾向\"\n    },\n    {\n      \"date\": \"2017年11月16日 14:20\",\n      \"link\": \"http://toutiao.secjia.com/libxls-rce\",\n      \"title\": \"开源Excel读取库libxls爆出7个远程代码执行漏洞CVE-2017-12108 可破坏内存\"\n    },\n    {\n      \"date\": \"2017年11月16日 09:46\",\n      \"link\": \"http://toutiao.secjia.com/oracle-tuxedo-cve-2017-10269\",\n      \"title\": \"Oracle Tuxedo远程安全漏洞CVE-2017-10269 Core组件及Fusion中间件受到影响\"\n    }\n  ]\n```\n\n我的需求是根据把list根据dict中的date进行排序，解决办法是这样的：\n\n```python\nnews_arr = sorted(news_arr, key=lambda e: e.__getitem__('date'), reverse=True)\n```\n\n参考链接：\n\nhttp://m.blog.csdn.net/Tangzongyu123/article/details/75200619","source":"_posts/DictInListSorted.md","raw":"---\ntitle: Python编程实践-----List中嵌套Dict，根据Dict的value进行排序\ncategories:\n  - Program\ntags:\n  - python\ndate: 2017-11-17 11:03:54\n---\n\n​\t今天遇到一个问题，我有一个list，其中放了多个dict，我想根据dict中的value对这个list进行排序。经过搜索，发现可以利用python中的sorted方法来完成。特记录一下，以免忘记。\n\n<!--more-->\n\n这是原本的list内容：\n\n```json\n[\n    {\n      \"date\": \"2017年11月17日 10:20\",\n      \"link\": \"http://toutiao.secjia.com/cisco-uav-cve-2017-12337\",\n      \"title\": \"12款思科产品出现未授权访问漏洞CVE-2017-12337 可拿设备Root权限\"\n    },\n    {\n      \"date\": \"2017年11月17日 09:55\",\n      \"link\": \"http://toutiao.secjia.com/office-mcv-cve-2017-11882\",\n      \"title\": \"Office内存破坏漏洞CVE-2017-11882 可执行任意代码失败了还可DoS\"\n    },\n    {\n      \"date\": \"2017年11月17日 09:42\",\n      \"link\": \"http://toutiao.secjia.com/ios-xe-xss-cve-2017-12304\",\n      \"title\": \"思科IOS及IOS XE软件再次爆出跨站脚本漏洞CVE-2017-12304 可以执行任意代码\"\n    },\n    {\n      \"date\": \"2017年11月16日 13:30\",\n      \"link\": \"http://toutiao.secjia.com/vep-charter\",\n      \"title\": \"下载 | 美政府发布《未分类漏洞权益VEP宪章》 增加0Day漏洞审查及披露的透明度\"\n    },\n    {\n      \"date\": \"2017年11月16日 15:34\",\n      \"link\": \"http://toutiao.secjia.com/mac-security-guideline\",\n      \"title\": \"mac电脑安全指南11招 普通用户很容易上手\"\n    },\n    {\n      \"date\": \"2017年11月16日 10:25\",\n      \"link\": \"http://toutiao.secjia.com/2017q3-apt-report\",\n      \"title\": \"卡巴发布2017Q3APT威胁报告 指出攻击者有针对供应链攻击的转移倾向\"\n    },\n    {\n      \"date\": \"2017年11月16日 14:20\",\n      \"link\": \"http://toutiao.secjia.com/libxls-rce\",\n      \"title\": \"开源Excel读取库libxls爆出7个远程代码执行漏洞CVE-2017-12108 可破坏内存\"\n    },\n    {\n      \"date\": \"2017年11月16日 09:46\",\n      \"link\": \"http://toutiao.secjia.com/oracle-tuxedo-cve-2017-10269\",\n      \"title\": \"Oracle Tuxedo远程安全漏洞CVE-2017-10269 Core组件及Fusion中间件受到影响\"\n    }\n  ]\n```\n\n我的需求是根据把list根据dict中的date进行排序，解决办法是这样的：\n\n```python\nnews_arr = sorted(news_arr, key=lambda e: e.__getitem__('date'), reverse=True)\n```\n\n参考链接：\n\nhttp://m.blog.csdn.net/Tangzongyu123/article/details/75200619","slug":"DictInListSorted","published":1,"updated":"2017-12-04T07:27:28.744Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjeqig1k6000plgqa3gwggslv","content":"<p>​    今天遇到一个问题，我有一个list，其中放了多个dict，我想根据dict中的value对这个list进行排序。经过搜索，发现可以利用python中的sorted方法来完成。特记录一下，以免忘记。</p>\n<a id=\"more\"></a>\n<p>这是原本的list内容：</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"date\"</span>: <span class=\"string\">\"2017年11月17日 10:20\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"link\"</span>: <span class=\"string\">\"http://toutiao.secjia.com/cisco-uav-cve-2017-12337\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"title\"</span>: <span class=\"string\">\"12款思科产品出现未授权访问漏洞CVE-2017-12337 可拿设备Root权限\"</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"date\"</span>: <span class=\"string\">\"2017年11月17日 09:55\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"link\"</span>: <span class=\"string\">\"http://toutiao.secjia.com/office-mcv-cve-2017-11882\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"title\"</span>: <span class=\"string\">\"Office内存破坏漏洞CVE-2017-11882 可执行任意代码失败了还可DoS\"</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"date\"</span>: <span class=\"string\">\"2017年11月17日 09:42\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"link\"</span>: <span class=\"string\">\"http://toutiao.secjia.com/ios-xe-xss-cve-2017-12304\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"title\"</span>: <span class=\"string\">\"思科IOS及IOS XE软件再次爆出跨站脚本漏洞CVE-2017-12304 可以执行任意代码\"</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"date\"</span>: <span class=\"string\">\"2017年11月16日 13:30\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"link\"</span>: <span class=\"string\">\"http://toutiao.secjia.com/vep-charter\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"title\"</span>: <span class=\"string\">\"下载 | 美政府发布《未分类漏洞权益VEP宪章》 增加0Day漏洞审查及披露的透明度\"</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"date\"</span>: <span class=\"string\">\"2017年11月16日 15:34\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"link\"</span>: <span class=\"string\">\"http://toutiao.secjia.com/mac-security-guideline\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"title\"</span>: <span class=\"string\">\"mac电脑安全指南11招 普通用户很容易上手\"</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"date\"</span>: <span class=\"string\">\"2017年11月16日 10:25\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"link\"</span>: <span class=\"string\">\"http://toutiao.secjia.com/2017q3-apt-report\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"title\"</span>: <span class=\"string\">\"卡巴发布2017Q3APT威胁报告 指出攻击者有针对供应链攻击的转移倾向\"</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"date\"</span>: <span class=\"string\">\"2017年11月16日 14:20\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"link\"</span>: <span class=\"string\">\"http://toutiao.secjia.com/libxls-rce\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"title\"</span>: <span class=\"string\">\"开源Excel读取库libxls爆出7个远程代码执行漏洞CVE-2017-12108 可破坏内存\"</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"date\"</span>: <span class=\"string\">\"2017年11月16日 09:46\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"link\"</span>: <span class=\"string\">\"http://toutiao.secjia.com/oracle-tuxedo-cve-2017-10269\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"title\"</span>: <span class=\"string\">\"Oracle Tuxedo远程安全漏洞CVE-2017-10269 Core组件及Fusion中间件受到影响\"</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ]</span><br></pre></td></tr></table></figure>\n<p>我的需求是根据把list根据dict中的date进行排序，解决办法是这样的：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">news_arr = sorted(news_arr, key=<span class=\"keyword\">lambda</span> e: e.__getitem__(<span class=\"string\">'date'</span>), reverse=<span class=\"keyword\">True</span>)</span><br></pre></td></tr></table></figure>\n<p>参考链接：</p>\n<p><a href=\"http://m.blog.csdn.net/Tangzongyu123/article/details/75200619\" target=\"_blank\" rel=\"noopener\">http://m.blog.csdn.net/Tangzongyu123/article/details/75200619</a></p>\n","site":{"data":{}},"excerpt":"<p>​    今天遇到一个问题，我有一个list，其中放了多个dict，我想根据dict中的value对这个list进行排序。经过搜索，发现可以利用python中的sorted方法来完成。特记录一下，以免忘记。</p>","more":"<p>这是原本的list内容：</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"date\"</span>: <span class=\"string\">\"2017年11月17日 10:20\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"link\"</span>: <span class=\"string\">\"http://toutiao.secjia.com/cisco-uav-cve-2017-12337\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"title\"</span>: <span class=\"string\">\"12款思科产品出现未授权访问漏洞CVE-2017-12337 可拿设备Root权限\"</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"date\"</span>: <span class=\"string\">\"2017年11月17日 09:55\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"link\"</span>: <span class=\"string\">\"http://toutiao.secjia.com/office-mcv-cve-2017-11882\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"title\"</span>: <span class=\"string\">\"Office内存破坏漏洞CVE-2017-11882 可执行任意代码失败了还可DoS\"</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"date\"</span>: <span class=\"string\">\"2017年11月17日 09:42\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"link\"</span>: <span class=\"string\">\"http://toutiao.secjia.com/ios-xe-xss-cve-2017-12304\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"title\"</span>: <span class=\"string\">\"思科IOS及IOS XE软件再次爆出跨站脚本漏洞CVE-2017-12304 可以执行任意代码\"</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"date\"</span>: <span class=\"string\">\"2017年11月16日 13:30\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"link\"</span>: <span class=\"string\">\"http://toutiao.secjia.com/vep-charter\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"title\"</span>: <span class=\"string\">\"下载 | 美政府发布《未分类漏洞权益VEP宪章》 增加0Day漏洞审查及披露的透明度\"</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"date\"</span>: <span class=\"string\">\"2017年11月16日 15:34\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"link\"</span>: <span class=\"string\">\"http://toutiao.secjia.com/mac-security-guideline\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"title\"</span>: <span class=\"string\">\"mac电脑安全指南11招 普通用户很容易上手\"</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"date\"</span>: <span class=\"string\">\"2017年11月16日 10:25\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"link\"</span>: <span class=\"string\">\"http://toutiao.secjia.com/2017q3-apt-report\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"title\"</span>: <span class=\"string\">\"卡巴发布2017Q3APT威胁报告 指出攻击者有针对供应链攻击的转移倾向\"</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"date\"</span>: <span class=\"string\">\"2017年11月16日 14:20\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"link\"</span>: <span class=\"string\">\"http://toutiao.secjia.com/libxls-rce\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"title\"</span>: <span class=\"string\">\"开源Excel读取库libxls爆出7个远程代码执行漏洞CVE-2017-12108 可破坏内存\"</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"date\"</span>: <span class=\"string\">\"2017年11月16日 09:46\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"link\"</span>: <span class=\"string\">\"http://toutiao.secjia.com/oracle-tuxedo-cve-2017-10269\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"title\"</span>: <span class=\"string\">\"Oracle Tuxedo远程安全漏洞CVE-2017-10269 Core组件及Fusion中间件受到影响\"</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ]</span><br></pre></td></tr></table></figure>\n<p>我的需求是根据把list根据dict中的date进行排序，解决办法是这样的：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">news_arr = sorted(news_arr, key=<span class=\"keyword\">lambda</span> e: e.__getitem__(<span class=\"string\">'date'</span>), reverse=<span class=\"keyword\">True</span>)</span><br></pre></td></tr></table></figure>\n<p>参考链接：</p>\n<p><a href=\"http://m.blog.csdn.net/Tangzongyu123/article/details/75200619\" target=\"_blank\" rel=\"noopener\">http://m.blog.csdn.net/Tangzongyu123/article/details/75200619</a></p>"},{"title":"Django-信号","date":"2017-10-12T03:47:16.000Z","_content":"\n### Django的信号机制（Signals）\n\nDjango自带一个信号调度程序允许*receiver*函数在某个动作出现的时候去获取通知。信号非常有用，当你需要你的代码去执行某些事件的时候同时正在发生其他事件。你还能够创建你自己的信号这样一来其他人可以在某个事件发生的时候获得通知。\n\n<!--more-->\n\n其中Django提供了一组内建信号，比如下面这些：\n\n1. django.db.models.signals.pre_save\n\n   在模型 save()方法调用之前或之后发送。\n\n2. django.db.models.signals.pre_delete\n\n   在模型delete() 方法调用之前或之后发送。\n\n3. django.db.models.signals.m2m_changed\n\n   模型上的 ManyToManyField 修改时发送。\n\n4. django.core.signals.request_started\n\n   Django建立或关闭HTTP 请求时发送。\n\n​\n\n上面的每个信号的完整使用方法可以参考Django官方的详细文档。\n\n#### 如何使用Django中的信号呢？\n\n首先了解一下Django Signal的处理流程：\n\n![image](/blogimg/signal_process.png)\n\n那么我就用个小例子来演示一下如何使用signal\n\n##### 应用目的\n\n之前根据DjangoRESTframework官方教程做了一个简单的管理代码片段的api，我想当有用户创建代码片段的时候打印点日志，这可以通过signal来完成。\n\n#### 使用receiver装饰器处理signal\n\n在应用下新建一个signals.py文件，内容如下：\n\n```python\n# -*- coding:utf-8 -*-\nfrom django.db.models.signals import post_save\nfrom django.dispatch import receiver\nfrom snippets.models import Snippet\nimport logging\n\n#使用了receiver装饰器来将on_snippet_create注册成监听函数，用以监听Snippet这个model的post_save事件\n@receiver(post_save, sender=Snippet)\n#这个就是post_save事件对应的回调函数\ndef on_snippet_create(sender,instance, **kwargs):\n    logging.debug(\"New Snippet\")\n    print \"New snippet created!\"\n    print \"The code = %s\" % instance.code\n```\n\n然后需要在app引入一下signals.py这个文件，不然它是不会被执行的。一个可以的位置是在apps.py中，在ready()方法中注册。apps.py文件内容如下：\n\n```python\n# -*- coding: utf-8 -*-\nfrom __future__ import unicode_literals\n\nfrom django.apps import AppConfig\n```\n\n```python\n class SnippetsConfig(AppConfig):\n    name = 'snippets'\n\n    def ready(self):\n        # import signal handlers\n        import snippets.signals\n```\n\n\n  接下来可以开启测试服务器，看一下是否能够监听到model的post_save事件。\n\n  ![image](/blogimg/receiver_result.png)\n\n  可以看到控制台已经打印出了log信息，说明监听成功。\n\n  #### 使用connect,send来处理自定义信号\n\n除了使用Django内建信号，我们还可以自定义所需的信号，那么具体的步骤如下：\n\n##### 定义信号\n\n信号的定义是这样的：\n\nclass Signal([providing_args=list])\n\n所有信号都是 django.dispatch.Signal 的实例。`providing_args`是一个列表，由信号将提供给监听者的参数名称组成。理论上是这样，但是实际上并没有任何检查来保证向监听者提供了这些参数。\n\n那么我们可以这样来定义一个信号：\n\n```python\nimport django.dispatch\n\nsnippet_saved = django.dispatch.Signal(providing_args=['obj'])\n```\n\n这段代码中我们声明了一个叫做snippet_saved的信号，它可以接收一个叫做obj的参数。\n\n##### 发送信号\n\nDjango中可以有两种方法去发送信号\n\n- Signal.send(sender, **kwargs)\n\n\n- Signal.send_robust(sender, **kwargs)\n\n调用 Signal.send()来发送信号。你必须提供`sender` 参数（大多数情况下它是一个类），并且可以提供尽可能多的关键字参数。\n\n我们可以这样子来发送信号：\n\n```python\n    def save(self, *args, **kwargs):\n        \"\"\"\n        把snippet使用pygments来生成高亮的html代码\n        :param args:\n        :param kwargs:\n        :return:\n        \"\"\"\n        lexer = get_lexer_by_name(self.language)\n        linenos = self.linenos and 'table' or False\n        options = self.title and {'title': self.title} or {}\n        formatter = HtmlFormatter(style=self.style, linenos=linenos,\n                                  full=True, **options)\n        self.highlighted = highlight(self.code, lexer, formatter)\n        super(Snippet, self).save(*args, **kwargs)\n\t\t#在保存model的时候发送该signal\n        signals.snippet_saved.send(sender=self.__class__, obj=self, instance=self)\n```\n\n##### 把signal和receiver连接起来\n\n最后别忘了在最后加上一句:\n\n```python\n# -*- coding: utf-8 -*-\nfrom __future__ import unicode_literals\n\nfrom django.db import models\nfrom pygments.lexers import get_all_lexers\nfrom pygments.lexers import get_lexer_by_name\nfrom pygments.formatters.html import HtmlFormatter\nfrom pygments import highlight\nfrom pygments.styles import get_all_styles\n\nimport signals\n\n\nLEXERS = [item for item in get_all_lexers() if item[1]]\nLANGUAGE_CHOICES = sorted([item[1][0], item[0]] for item in LEXERS)\nSTYLE_CHOICES = sorted((item, item) for item in get_all_styles())\n\n\nclass Snippet(models.Model):\n\n    created = models.DateTimeField(auto_now_add=True)\n    title = models.CharField(max_length=100, blank=True, default='')\n    code = models.TextField()\n    linenos = models.BooleanField(default=False)\n    language = models.CharField(choices=LANGUAGE_CHOICES, default='python', max_length=100)\n    style = models.CharField(choices=STYLE_CHOICES, default='friendly', max_length=100)\n\n    owner = models.ForeignKey('auth.user', related_name='snippet', on_delete=models.CASCADE)\n    highlighted = models.TextField()\n\n    class Meta:\n        ordering = ('created', )\n\n    def save(self, *args, **kwargs):\n        \"\"\"\n        把snippet使用pygments来生成高亮的html代码\n        :param args:\n        :param kwargs:\n        :return:\n        \"\"\"\n        lexer = get_lexer_by_name(self.language)\n        linenos = self.linenos and 'table' or False\n        options = self.title and {'title': self.title} or {}\n        formatter = HtmlFormatter(style=self.style, linenos=linenos,\n                                  full=True, **options)\n        self.highlighted = highlight(self.code, lexer, formatter)\n        super(Snippet, self).save(*args, **kwargs)\n\n        signals.snippet_saved.send(sender=self.__class__, obj=self, instance=self)\n\n\nsignals.snippet_saved.connect(receiver=signals.on_snippet_create, sender=Snippet)\n```\n\n当然除了使用connect函数，使用之前用到的receiver装饰器也是可以的。\n\n完成之后，开启测试服务器，put一段新的snippet，同样的能在控制台查看到打印的log。\n\n\n\n参考资料：\n\nhttp://www.jianshu.com/p/7ad5db9a1b69\n\nhttp://www.cnblogs.com/mindsbook/archive/2009/10/27/django_signal.html\n\nhttp://python.usyiyi.cn/translate/django_182/topics/signals.html","source":"_posts/Django-Signal.md","raw":"---\ntitle: Django-信号\ncategories:\n  - Program\ntags:\n  - Django\ndate: 2017-10-12 11:47:16\n---\n\n### Django的信号机制（Signals）\n\nDjango自带一个信号调度程序允许*receiver*函数在某个动作出现的时候去获取通知。信号非常有用，当你需要你的代码去执行某些事件的时候同时正在发生其他事件。你还能够创建你自己的信号这样一来其他人可以在某个事件发生的时候获得通知。\n\n<!--more-->\n\n其中Django提供了一组内建信号，比如下面这些：\n\n1. django.db.models.signals.pre_save\n\n   在模型 save()方法调用之前或之后发送。\n\n2. django.db.models.signals.pre_delete\n\n   在模型delete() 方法调用之前或之后发送。\n\n3. django.db.models.signals.m2m_changed\n\n   模型上的 ManyToManyField 修改时发送。\n\n4. django.core.signals.request_started\n\n   Django建立或关闭HTTP 请求时发送。\n\n​\n\n上面的每个信号的完整使用方法可以参考Django官方的详细文档。\n\n#### 如何使用Django中的信号呢？\n\n首先了解一下Django Signal的处理流程：\n\n![image](/blogimg/signal_process.png)\n\n那么我就用个小例子来演示一下如何使用signal\n\n##### 应用目的\n\n之前根据DjangoRESTframework官方教程做了一个简单的管理代码片段的api，我想当有用户创建代码片段的时候打印点日志，这可以通过signal来完成。\n\n#### 使用receiver装饰器处理signal\n\n在应用下新建一个signals.py文件，内容如下：\n\n```python\n# -*- coding:utf-8 -*-\nfrom django.db.models.signals import post_save\nfrom django.dispatch import receiver\nfrom snippets.models import Snippet\nimport logging\n\n#使用了receiver装饰器来将on_snippet_create注册成监听函数，用以监听Snippet这个model的post_save事件\n@receiver(post_save, sender=Snippet)\n#这个就是post_save事件对应的回调函数\ndef on_snippet_create(sender,instance, **kwargs):\n    logging.debug(\"New Snippet\")\n    print \"New snippet created!\"\n    print \"The code = %s\" % instance.code\n```\n\n然后需要在app引入一下signals.py这个文件，不然它是不会被执行的。一个可以的位置是在apps.py中，在ready()方法中注册。apps.py文件内容如下：\n\n```python\n# -*- coding: utf-8 -*-\nfrom __future__ import unicode_literals\n\nfrom django.apps import AppConfig\n```\n\n```python\n class SnippetsConfig(AppConfig):\n    name = 'snippets'\n\n    def ready(self):\n        # import signal handlers\n        import snippets.signals\n```\n\n\n  接下来可以开启测试服务器，看一下是否能够监听到model的post_save事件。\n\n  ![image](/blogimg/receiver_result.png)\n\n  可以看到控制台已经打印出了log信息，说明监听成功。\n\n  #### 使用connect,send来处理自定义信号\n\n除了使用Django内建信号，我们还可以自定义所需的信号，那么具体的步骤如下：\n\n##### 定义信号\n\n信号的定义是这样的：\n\nclass Signal([providing_args=list])\n\n所有信号都是 django.dispatch.Signal 的实例。`providing_args`是一个列表，由信号将提供给监听者的参数名称组成。理论上是这样，但是实际上并没有任何检查来保证向监听者提供了这些参数。\n\n那么我们可以这样来定义一个信号：\n\n```python\nimport django.dispatch\n\nsnippet_saved = django.dispatch.Signal(providing_args=['obj'])\n```\n\n这段代码中我们声明了一个叫做snippet_saved的信号，它可以接收一个叫做obj的参数。\n\n##### 发送信号\n\nDjango中可以有两种方法去发送信号\n\n- Signal.send(sender, **kwargs)\n\n\n- Signal.send_robust(sender, **kwargs)\n\n调用 Signal.send()来发送信号。你必须提供`sender` 参数（大多数情况下它是一个类），并且可以提供尽可能多的关键字参数。\n\n我们可以这样子来发送信号：\n\n```python\n    def save(self, *args, **kwargs):\n        \"\"\"\n        把snippet使用pygments来生成高亮的html代码\n        :param args:\n        :param kwargs:\n        :return:\n        \"\"\"\n        lexer = get_lexer_by_name(self.language)\n        linenos = self.linenos and 'table' or False\n        options = self.title and {'title': self.title} or {}\n        formatter = HtmlFormatter(style=self.style, linenos=linenos,\n                                  full=True, **options)\n        self.highlighted = highlight(self.code, lexer, formatter)\n        super(Snippet, self).save(*args, **kwargs)\n\t\t#在保存model的时候发送该signal\n        signals.snippet_saved.send(sender=self.__class__, obj=self, instance=self)\n```\n\n##### 把signal和receiver连接起来\n\n最后别忘了在最后加上一句:\n\n```python\n# -*- coding: utf-8 -*-\nfrom __future__ import unicode_literals\n\nfrom django.db import models\nfrom pygments.lexers import get_all_lexers\nfrom pygments.lexers import get_lexer_by_name\nfrom pygments.formatters.html import HtmlFormatter\nfrom pygments import highlight\nfrom pygments.styles import get_all_styles\n\nimport signals\n\n\nLEXERS = [item for item in get_all_lexers() if item[1]]\nLANGUAGE_CHOICES = sorted([item[1][0], item[0]] for item in LEXERS)\nSTYLE_CHOICES = sorted((item, item) for item in get_all_styles())\n\n\nclass Snippet(models.Model):\n\n    created = models.DateTimeField(auto_now_add=True)\n    title = models.CharField(max_length=100, blank=True, default='')\n    code = models.TextField()\n    linenos = models.BooleanField(default=False)\n    language = models.CharField(choices=LANGUAGE_CHOICES, default='python', max_length=100)\n    style = models.CharField(choices=STYLE_CHOICES, default='friendly', max_length=100)\n\n    owner = models.ForeignKey('auth.user', related_name='snippet', on_delete=models.CASCADE)\n    highlighted = models.TextField()\n\n    class Meta:\n        ordering = ('created', )\n\n    def save(self, *args, **kwargs):\n        \"\"\"\n        把snippet使用pygments来生成高亮的html代码\n        :param args:\n        :param kwargs:\n        :return:\n        \"\"\"\n        lexer = get_lexer_by_name(self.language)\n        linenos = self.linenos and 'table' or False\n        options = self.title and {'title': self.title} or {}\n        formatter = HtmlFormatter(style=self.style, linenos=linenos,\n                                  full=True, **options)\n        self.highlighted = highlight(self.code, lexer, formatter)\n        super(Snippet, self).save(*args, **kwargs)\n\n        signals.snippet_saved.send(sender=self.__class__, obj=self, instance=self)\n\n\nsignals.snippet_saved.connect(receiver=signals.on_snippet_create, sender=Snippet)\n```\n\n当然除了使用connect函数，使用之前用到的receiver装饰器也是可以的。\n\n完成之后，开启测试服务器，put一段新的snippet，同样的能在控制台查看到打印的log。\n\n\n\n参考资料：\n\nhttp://www.jianshu.com/p/7ad5db9a1b69\n\nhttp://www.cnblogs.com/mindsbook/archive/2009/10/27/django_signal.html\n\nhttp://python.usyiyi.cn/translate/django_182/topics/signals.html","slug":"Django-Signal","published":1,"updated":"2017-12-04T07:27:28.744Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjeqig1kd000tlgqa6il2la4i","content":"<h3 id=\"Django的信号机制（Signals）\"><a href=\"#Django的信号机制（Signals）\" class=\"headerlink\" title=\"Django的信号机制（Signals）\"></a>Django的信号机制（Signals）</h3><p>Django自带一个信号调度程序允许<em>receiver</em>函数在某个动作出现的时候去获取通知。信号非常有用，当你需要你的代码去执行某些事件的时候同时正在发生其他事件。你还能够创建你自己的信号这样一来其他人可以在某个事件发生的时候获得通知。</p>\n<a id=\"more\"></a>\n<p>其中Django提供了一组内建信号，比如下面这些：</p>\n<ol>\n<li><p>django.db.models.signals.pre_save</p>\n<p>在模型 save()方法调用之前或之后发送。</p>\n</li>\n<li><p>django.db.models.signals.pre_delete</p>\n<p>在模型delete() 方法调用之前或之后发送。</p>\n</li>\n<li><p>django.db.models.signals.m2m_changed</p>\n<p>模型上的 ManyToManyField 修改时发送。</p>\n</li>\n<li><p>django.core.signals.request_started</p>\n<p>Django建立或关闭HTTP 请求时发送。</p>\n</li>\n</ol>\n<p>​</p>\n<p>上面的每个信号的完整使用方法可以参考Django官方的详细文档。</p>\n<h4 id=\"如何使用Django中的信号呢？\"><a href=\"#如何使用Django中的信号呢？\" class=\"headerlink\" title=\"如何使用Django中的信号呢？\"></a>如何使用Django中的信号呢？</h4><p>首先了解一下Django Signal的处理流程：</p>\n<p><img src=\"/blogimg/signal_process.png\" alt=\"image\"></p>\n<p>那么我就用个小例子来演示一下如何使用signal</p>\n<h5 id=\"应用目的\"><a href=\"#应用目的\" class=\"headerlink\" title=\"应用目的\"></a>应用目的</h5><p>之前根据DjangoRESTframework官方教程做了一个简单的管理代码片段的api，我想当有用户创建代码片段的时候打印点日志，这可以通过signal来完成。</p>\n<h4 id=\"使用receiver装饰器处理signal\"><a href=\"#使用receiver装饰器处理signal\" class=\"headerlink\" title=\"使用receiver装饰器处理signal\"></a>使用receiver装饰器处理signal</h4><p>在应用下新建一个signals.py文件，内容如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># -*- coding:utf-8 -*-</span></span><br><span class=\"line\"><span class=\"keyword\">from</span> django.db.models.signals <span class=\"keyword\">import</span> post_save</span><br><span class=\"line\"><span class=\"keyword\">from</span> django.dispatch <span class=\"keyword\">import</span> receiver</span><br><span class=\"line\"><span class=\"keyword\">from</span> snippets.models <span class=\"keyword\">import</span> Snippet</span><br><span class=\"line\"><span class=\"keyword\">import</span> logging</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#使用了receiver装饰器来将on_snippet_create注册成监听函数，用以监听Snippet这个model的post_save事件</span></span><br><span class=\"line\"><span class=\"meta\">@receiver(post_save, sender=Snippet)</span></span><br><span class=\"line\"><span class=\"comment\">#这个就是post_save事件对应的回调函数</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">on_snippet_create</span><span class=\"params\">(sender,instance, **kwargs)</span>:</span></span><br><span class=\"line\">    logging.debug(<span class=\"string\">\"New Snippet\"</span>)</span><br><span class=\"line\">    <span class=\"keyword\">print</span> <span class=\"string\">\"New snippet created!\"</span></span><br><span class=\"line\">    <span class=\"keyword\">print</span> <span class=\"string\">\"The code = %s\"</span> % instance.code</span><br></pre></td></tr></table></figure>\n<p>然后需要在app引入一下signals.py这个文件，不然它是不会被执行的。一个可以的位置是在apps.py中，在ready()方法中注册。apps.py文件内容如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># -*- coding: utf-8 -*-</span></span><br><span class=\"line\"><span class=\"keyword\">from</span> __future__ <span class=\"keyword\">import</span> unicode_literals</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> django.apps <span class=\"keyword\">import</span> AppConfig</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SnippetsConfig</span><span class=\"params\">(AppConfig)</span>:</span></span><br><span class=\"line\">   name = <span class=\"string\">'snippets'</span></span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">ready</span><span class=\"params\">(self)</span>:</span></span><br><span class=\"line\">       <span class=\"comment\"># import signal handlers</span></span><br><span class=\"line\">       <span class=\"keyword\">import</span> snippets.signals</span><br></pre></td></tr></table></figure>\n<p>  接下来可以开启测试服务器，看一下是否能够监听到model的post_save事件。</p>\n<p>  <img src=\"/blogimg/receiver_result.png\" alt=\"image\"></p>\n<p>  可以看到控制台已经打印出了log信息，说明监听成功。</p>\n<h4 id=\"使用connect-send来处理自定义信号\"><a href=\"#使用connect-send来处理自定义信号\" class=\"headerlink\" title=\"使用connect,send来处理自定义信号\"></a>使用connect,send来处理自定义信号</h4><p>除了使用Django内建信号，我们还可以自定义所需的信号，那么具体的步骤如下：</p>\n<h5 id=\"定义信号\"><a href=\"#定义信号\" class=\"headerlink\" title=\"定义信号\"></a>定义信号</h5><p>信号的定义是这样的：</p>\n<p>class Signal([providing_args=list])</p>\n<p>所有信号都是 django.dispatch.Signal 的实例。<code>providing_args</code>是一个列表，由信号将提供给监听者的参数名称组成。理论上是这样，但是实际上并没有任何检查来保证向监听者提供了这些参数。</p>\n<p>那么我们可以这样来定义一个信号：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> django.dispatch</span><br><span class=\"line\"></span><br><span class=\"line\">snippet_saved = django.dispatch.Signal(providing_args=[<span class=\"string\">'obj'</span>])</span><br></pre></td></tr></table></figure>\n<p>这段代码中我们声明了一个叫做snippet_saved的信号，它可以接收一个叫做obj的参数。</p>\n<h5 id=\"发送信号\"><a href=\"#发送信号\" class=\"headerlink\" title=\"发送信号\"></a>发送信号</h5><p>Django中可以有两种方法去发送信号</p>\n<ul>\n<li>Signal.send(sender, **kwargs)</li>\n</ul>\n<ul>\n<li>Signal.send_robust(sender, **kwargs)</li>\n</ul>\n<p>调用 Signal.send()来发送信号。你必须提供<code>sender</code> 参数（大多数情况下它是一个类），并且可以提供尽可能多的关键字参数。</p>\n<p>我们可以这样子来发送信号：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">save</span><span class=\"params\">(self, *args, **kwargs)</span>:</span></span><br><span class=\"line\">      <span class=\"string\">\"\"\"</span></span><br><span class=\"line\"><span class=\"string\">      把snippet使用pygments来生成高亮的html代码</span></span><br><span class=\"line\"><span class=\"string\">      :param args:</span></span><br><span class=\"line\"><span class=\"string\">      :param kwargs:</span></span><br><span class=\"line\"><span class=\"string\">      :return:</span></span><br><span class=\"line\"><span class=\"string\">      \"\"\"</span></span><br><span class=\"line\">      lexer = get_lexer_by_name(self.language)</span><br><span class=\"line\">      linenos = self.linenos <span class=\"keyword\">and</span> <span class=\"string\">'table'</span> <span class=\"keyword\">or</span> <span class=\"keyword\">False</span></span><br><span class=\"line\">      options = self.title <span class=\"keyword\">and</span> &#123;<span class=\"string\">'title'</span>: self.title&#125; <span class=\"keyword\">or</span> &#123;&#125;</span><br><span class=\"line\">      formatter = HtmlFormatter(style=self.style, linenos=linenos,</span><br><span class=\"line\">                                full=<span class=\"keyword\">True</span>, **options)</span><br><span class=\"line\">      self.highlighted = highlight(self.code, lexer, formatter)</span><br><span class=\"line\">      super(Snippet, self).save(*args, **kwargs)</span><br><span class=\"line\"><span class=\"comment\">#在保存model的时候发送该signal</span></span><br><span class=\"line\">      signals.snippet_saved.send(sender=self.__class__, obj=self, instance=self)</span><br></pre></td></tr></table></figure>\n<h5 id=\"把signal和receiver连接起来\"><a href=\"#把signal和receiver连接起来\" class=\"headerlink\" title=\"把signal和receiver连接起来\"></a>把signal和receiver连接起来</h5><p>最后别忘了在最后加上一句:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># -*- coding: utf-8 -*-</span></span><br><span class=\"line\"><span class=\"keyword\">from</span> __future__ <span class=\"keyword\">import</span> unicode_literals</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> django.db <span class=\"keyword\">import</span> models</span><br><span class=\"line\"><span class=\"keyword\">from</span> pygments.lexers <span class=\"keyword\">import</span> get_all_lexers</span><br><span class=\"line\"><span class=\"keyword\">from</span> pygments.lexers <span class=\"keyword\">import</span> get_lexer_by_name</span><br><span class=\"line\"><span class=\"keyword\">from</span> pygments.formatters.html <span class=\"keyword\">import</span> HtmlFormatter</span><br><span class=\"line\"><span class=\"keyword\">from</span> pygments <span class=\"keyword\">import</span> highlight</span><br><span class=\"line\"><span class=\"keyword\">from</span> pygments.styles <span class=\"keyword\">import</span> get_all_styles</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> signals</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">LEXERS = [item <span class=\"keyword\">for</span> item <span class=\"keyword\">in</span> get_all_lexers() <span class=\"keyword\">if</span> item[<span class=\"number\">1</span>]]</span><br><span class=\"line\">LANGUAGE_CHOICES = sorted([item[<span class=\"number\">1</span>][<span class=\"number\">0</span>], item[<span class=\"number\">0</span>]] <span class=\"keyword\">for</span> item <span class=\"keyword\">in</span> LEXERS)</span><br><span class=\"line\">STYLE_CHOICES = sorted((item, item) <span class=\"keyword\">for</span> item <span class=\"keyword\">in</span> get_all_styles())</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Snippet</span><span class=\"params\">(models.Model)</span>:</span></span><br><span class=\"line\"></span><br><span class=\"line\">    created = models.DateTimeField(auto_now_add=<span class=\"keyword\">True</span>)</span><br><span class=\"line\">    title = models.CharField(max_length=<span class=\"number\">100</span>, blank=<span class=\"keyword\">True</span>, default=<span class=\"string\">''</span>)</span><br><span class=\"line\">    code = models.TextField()</span><br><span class=\"line\">    linenos = models.BooleanField(default=<span class=\"keyword\">False</span>)</span><br><span class=\"line\">    language = models.CharField(choices=LANGUAGE_CHOICES, default=<span class=\"string\">'python'</span>, max_length=<span class=\"number\">100</span>)</span><br><span class=\"line\">    style = models.CharField(choices=STYLE_CHOICES, default=<span class=\"string\">'friendly'</span>, max_length=<span class=\"number\">100</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    owner = models.ForeignKey(<span class=\"string\">'auth.user'</span>, related_name=<span class=\"string\">'snippet'</span>, on_delete=models.CASCADE)</span><br><span class=\"line\">    highlighted = models.TextField()</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Meta</span>:</span></span><br><span class=\"line\">        ordering = (<span class=\"string\">'created'</span>, )</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">save</span><span class=\"params\">(self, *args, **kwargs)</span>:</span></span><br><span class=\"line\">        <span class=\"string\">\"\"\"</span></span><br><span class=\"line\"><span class=\"string\">        把snippet使用pygments来生成高亮的html代码</span></span><br><span class=\"line\"><span class=\"string\">        :param args:</span></span><br><span class=\"line\"><span class=\"string\">        :param kwargs:</span></span><br><span class=\"line\"><span class=\"string\">        :return:</span></span><br><span class=\"line\"><span class=\"string\">        \"\"\"</span></span><br><span class=\"line\">        lexer = get_lexer_by_name(self.language)</span><br><span class=\"line\">        linenos = self.linenos <span class=\"keyword\">and</span> <span class=\"string\">'table'</span> <span class=\"keyword\">or</span> <span class=\"keyword\">False</span></span><br><span class=\"line\">        options = self.title <span class=\"keyword\">and</span> &#123;<span class=\"string\">'title'</span>: self.title&#125; <span class=\"keyword\">or</span> &#123;&#125;</span><br><span class=\"line\">        formatter = HtmlFormatter(style=self.style, linenos=linenos,</span><br><span class=\"line\">                                  full=<span class=\"keyword\">True</span>, **options)</span><br><span class=\"line\">        self.highlighted = highlight(self.code, lexer, formatter)</span><br><span class=\"line\">        super(Snippet, self).save(*args, **kwargs)</span><br><span class=\"line\"></span><br><span class=\"line\">        signals.snippet_saved.send(sender=self.__class__, obj=self, instance=self)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">signals.snippet_saved.connect(receiver=signals.on_snippet_create, sender=Snippet)</span><br></pre></td></tr></table></figure>\n<p>当然除了使用connect函数，使用之前用到的receiver装饰器也是可以的。</p>\n<p>完成之后，开启测试服务器，put一段新的snippet，同样的能在控制台查看到打印的log。</p>\n<p>参考资料：</p>\n<p><a href=\"http://www.jianshu.com/p/7ad5db9a1b69\" target=\"_blank\" rel=\"noopener\">http://www.jianshu.com/p/7ad5db9a1b69</a></p>\n<p><a href=\"http://www.cnblogs.com/mindsbook/archive/2009/10/27/django_signal.html\" target=\"_blank\" rel=\"noopener\">http://www.cnblogs.com/mindsbook/archive/2009/10/27/django_signal.html</a></p>\n<p><a href=\"http://python.usyiyi.cn/translate/django_182/topics/signals.html\" target=\"_blank\" rel=\"noopener\">http://python.usyiyi.cn/translate/django_182/topics/signals.html</a></p>\n","site":{"data":{}},"excerpt":"<h3 id=\"Django的信号机制（Signals）\"><a href=\"#Django的信号机制（Signals）\" class=\"headerlink\" title=\"Django的信号机制（Signals）\"></a>Django的信号机制（Signals）</h3><p>Django自带一个信号调度程序允许<em>receiver</em>函数在某个动作出现的时候去获取通知。信号非常有用，当你需要你的代码去执行某些事件的时候同时正在发生其他事件。你还能够创建你自己的信号这样一来其他人可以在某个事件发生的时候获得通知。</p>","more":"<p>其中Django提供了一组内建信号，比如下面这些：</p>\n<ol>\n<li><p>django.db.models.signals.pre_save</p>\n<p>在模型 save()方法调用之前或之后发送。</p>\n</li>\n<li><p>django.db.models.signals.pre_delete</p>\n<p>在模型delete() 方法调用之前或之后发送。</p>\n</li>\n<li><p>django.db.models.signals.m2m_changed</p>\n<p>模型上的 ManyToManyField 修改时发送。</p>\n</li>\n<li><p>django.core.signals.request_started</p>\n<p>Django建立或关闭HTTP 请求时发送。</p>\n</li>\n</ol>\n<p>​</p>\n<p>上面的每个信号的完整使用方法可以参考Django官方的详细文档。</p>\n<h4 id=\"如何使用Django中的信号呢？\"><a href=\"#如何使用Django中的信号呢？\" class=\"headerlink\" title=\"如何使用Django中的信号呢？\"></a>如何使用Django中的信号呢？</h4><p>首先了解一下Django Signal的处理流程：</p>\n<p><img src=\"/blogimg/signal_process.png\" alt=\"image\"></p>\n<p>那么我就用个小例子来演示一下如何使用signal</p>\n<h5 id=\"应用目的\"><a href=\"#应用目的\" class=\"headerlink\" title=\"应用目的\"></a>应用目的</h5><p>之前根据DjangoRESTframework官方教程做了一个简单的管理代码片段的api，我想当有用户创建代码片段的时候打印点日志，这可以通过signal来完成。</p>\n<h4 id=\"使用receiver装饰器处理signal\"><a href=\"#使用receiver装饰器处理signal\" class=\"headerlink\" title=\"使用receiver装饰器处理signal\"></a>使用receiver装饰器处理signal</h4><p>在应用下新建一个signals.py文件，内容如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># -*- coding:utf-8 -*-</span></span><br><span class=\"line\"><span class=\"keyword\">from</span> django.db.models.signals <span class=\"keyword\">import</span> post_save</span><br><span class=\"line\"><span class=\"keyword\">from</span> django.dispatch <span class=\"keyword\">import</span> receiver</span><br><span class=\"line\"><span class=\"keyword\">from</span> snippets.models <span class=\"keyword\">import</span> Snippet</span><br><span class=\"line\"><span class=\"keyword\">import</span> logging</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#使用了receiver装饰器来将on_snippet_create注册成监听函数，用以监听Snippet这个model的post_save事件</span></span><br><span class=\"line\"><span class=\"meta\">@receiver(post_save, sender=Snippet)</span></span><br><span class=\"line\"><span class=\"comment\">#这个就是post_save事件对应的回调函数</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">on_snippet_create</span><span class=\"params\">(sender,instance, **kwargs)</span>:</span></span><br><span class=\"line\">    logging.debug(<span class=\"string\">\"New Snippet\"</span>)</span><br><span class=\"line\">    <span class=\"keyword\">print</span> <span class=\"string\">\"New snippet created!\"</span></span><br><span class=\"line\">    <span class=\"keyword\">print</span> <span class=\"string\">\"The code = %s\"</span> % instance.code</span><br></pre></td></tr></table></figure>\n<p>然后需要在app引入一下signals.py这个文件，不然它是不会被执行的。一个可以的位置是在apps.py中，在ready()方法中注册。apps.py文件内容如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># -*- coding: utf-8 -*-</span></span><br><span class=\"line\"><span class=\"keyword\">from</span> __future__ <span class=\"keyword\">import</span> unicode_literals</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> django.apps <span class=\"keyword\">import</span> AppConfig</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SnippetsConfig</span><span class=\"params\">(AppConfig)</span>:</span></span><br><span class=\"line\">   name = <span class=\"string\">'snippets'</span></span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">ready</span><span class=\"params\">(self)</span>:</span></span><br><span class=\"line\">       <span class=\"comment\"># import signal handlers</span></span><br><span class=\"line\">       <span class=\"keyword\">import</span> snippets.signals</span><br></pre></td></tr></table></figure>\n<p>  接下来可以开启测试服务器，看一下是否能够监听到model的post_save事件。</p>\n<p>  <img src=\"/blogimg/receiver_result.png\" alt=\"image\"></p>\n<p>  可以看到控制台已经打印出了log信息，说明监听成功。</p>\n<h4 id=\"使用connect-send来处理自定义信号\"><a href=\"#使用connect-send来处理自定义信号\" class=\"headerlink\" title=\"使用connect,send来处理自定义信号\"></a>使用connect,send来处理自定义信号</h4><p>除了使用Django内建信号，我们还可以自定义所需的信号，那么具体的步骤如下：</p>\n<h5 id=\"定义信号\"><a href=\"#定义信号\" class=\"headerlink\" title=\"定义信号\"></a>定义信号</h5><p>信号的定义是这样的：</p>\n<p>class Signal([providing_args=list])</p>\n<p>所有信号都是 django.dispatch.Signal 的实例。<code>providing_args</code>是一个列表，由信号将提供给监听者的参数名称组成。理论上是这样，但是实际上并没有任何检查来保证向监听者提供了这些参数。</p>\n<p>那么我们可以这样来定义一个信号：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> django.dispatch</span><br><span class=\"line\"></span><br><span class=\"line\">snippet_saved = django.dispatch.Signal(providing_args=[<span class=\"string\">'obj'</span>])</span><br></pre></td></tr></table></figure>\n<p>这段代码中我们声明了一个叫做snippet_saved的信号，它可以接收一个叫做obj的参数。</p>\n<h5 id=\"发送信号\"><a href=\"#发送信号\" class=\"headerlink\" title=\"发送信号\"></a>发送信号</h5><p>Django中可以有两种方法去发送信号</p>\n<ul>\n<li>Signal.send(sender, **kwargs)</li>\n</ul>\n<ul>\n<li>Signal.send_robust(sender, **kwargs)</li>\n</ul>\n<p>调用 Signal.send()来发送信号。你必须提供<code>sender</code> 参数（大多数情况下它是一个类），并且可以提供尽可能多的关键字参数。</p>\n<p>我们可以这样子来发送信号：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">save</span><span class=\"params\">(self, *args, **kwargs)</span>:</span></span><br><span class=\"line\">      <span class=\"string\">\"\"\"</span></span><br><span class=\"line\"><span class=\"string\">      把snippet使用pygments来生成高亮的html代码</span></span><br><span class=\"line\"><span class=\"string\">      :param args:</span></span><br><span class=\"line\"><span class=\"string\">      :param kwargs:</span></span><br><span class=\"line\"><span class=\"string\">      :return:</span></span><br><span class=\"line\"><span class=\"string\">      \"\"\"</span></span><br><span class=\"line\">      lexer = get_lexer_by_name(self.language)</span><br><span class=\"line\">      linenos = self.linenos <span class=\"keyword\">and</span> <span class=\"string\">'table'</span> <span class=\"keyword\">or</span> <span class=\"keyword\">False</span></span><br><span class=\"line\">      options = self.title <span class=\"keyword\">and</span> &#123;<span class=\"string\">'title'</span>: self.title&#125; <span class=\"keyword\">or</span> &#123;&#125;</span><br><span class=\"line\">      formatter = HtmlFormatter(style=self.style, linenos=linenos,</span><br><span class=\"line\">                                full=<span class=\"keyword\">True</span>, **options)</span><br><span class=\"line\">      self.highlighted = highlight(self.code, lexer, formatter)</span><br><span class=\"line\">      super(Snippet, self).save(*args, **kwargs)</span><br><span class=\"line\"><span class=\"comment\">#在保存model的时候发送该signal</span></span><br><span class=\"line\">      signals.snippet_saved.send(sender=self.__class__, obj=self, instance=self)</span><br></pre></td></tr></table></figure>\n<h5 id=\"把signal和receiver连接起来\"><a href=\"#把signal和receiver连接起来\" class=\"headerlink\" title=\"把signal和receiver连接起来\"></a>把signal和receiver连接起来</h5><p>最后别忘了在最后加上一句:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># -*- coding: utf-8 -*-</span></span><br><span class=\"line\"><span class=\"keyword\">from</span> __future__ <span class=\"keyword\">import</span> unicode_literals</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> django.db <span class=\"keyword\">import</span> models</span><br><span class=\"line\"><span class=\"keyword\">from</span> pygments.lexers <span class=\"keyword\">import</span> get_all_lexers</span><br><span class=\"line\"><span class=\"keyword\">from</span> pygments.lexers <span class=\"keyword\">import</span> get_lexer_by_name</span><br><span class=\"line\"><span class=\"keyword\">from</span> pygments.formatters.html <span class=\"keyword\">import</span> HtmlFormatter</span><br><span class=\"line\"><span class=\"keyword\">from</span> pygments <span class=\"keyword\">import</span> highlight</span><br><span class=\"line\"><span class=\"keyword\">from</span> pygments.styles <span class=\"keyword\">import</span> get_all_styles</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> signals</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">LEXERS = [item <span class=\"keyword\">for</span> item <span class=\"keyword\">in</span> get_all_lexers() <span class=\"keyword\">if</span> item[<span class=\"number\">1</span>]]</span><br><span class=\"line\">LANGUAGE_CHOICES = sorted([item[<span class=\"number\">1</span>][<span class=\"number\">0</span>], item[<span class=\"number\">0</span>]] <span class=\"keyword\">for</span> item <span class=\"keyword\">in</span> LEXERS)</span><br><span class=\"line\">STYLE_CHOICES = sorted((item, item) <span class=\"keyword\">for</span> item <span class=\"keyword\">in</span> get_all_styles())</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Snippet</span><span class=\"params\">(models.Model)</span>:</span></span><br><span class=\"line\"></span><br><span class=\"line\">    created = models.DateTimeField(auto_now_add=<span class=\"keyword\">True</span>)</span><br><span class=\"line\">    title = models.CharField(max_length=<span class=\"number\">100</span>, blank=<span class=\"keyword\">True</span>, default=<span class=\"string\">''</span>)</span><br><span class=\"line\">    code = models.TextField()</span><br><span class=\"line\">    linenos = models.BooleanField(default=<span class=\"keyword\">False</span>)</span><br><span class=\"line\">    language = models.CharField(choices=LANGUAGE_CHOICES, default=<span class=\"string\">'python'</span>, max_length=<span class=\"number\">100</span>)</span><br><span class=\"line\">    style = models.CharField(choices=STYLE_CHOICES, default=<span class=\"string\">'friendly'</span>, max_length=<span class=\"number\">100</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    owner = models.ForeignKey(<span class=\"string\">'auth.user'</span>, related_name=<span class=\"string\">'snippet'</span>, on_delete=models.CASCADE)</span><br><span class=\"line\">    highlighted = models.TextField()</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Meta</span>:</span></span><br><span class=\"line\">        ordering = (<span class=\"string\">'created'</span>, )</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">save</span><span class=\"params\">(self, *args, **kwargs)</span>:</span></span><br><span class=\"line\">        <span class=\"string\">\"\"\"</span></span><br><span class=\"line\"><span class=\"string\">        把snippet使用pygments来生成高亮的html代码</span></span><br><span class=\"line\"><span class=\"string\">        :param args:</span></span><br><span class=\"line\"><span class=\"string\">        :param kwargs:</span></span><br><span class=\"line\"><span class=\"string\">        :return:</span></span><br><span class=\"line\"><span class=\"string\">        \"\"\"</span></span><br><span class=\"line\">        lexer = get_lexer_by_name(self.language)</span><br><span class=\"line\">        linenos = self.linenos <span class=\"keyword\">and</span> <span class=\"string\">'table'</span> <span class=\"keyword\">or</span> <span class=\"keyword\">False</span></span><br><span class=\"line\">        options = self.title <span class=\"keyword\">and</span> &#123;<span class=\"string\">'title'</span>: self.title&#125; <span class=\"keyword\">or</span> &#123;&#125;</span><br><span class=\"line\">        formatter = HtmlFormatter(style=self.style, linenos=linenos,</span><br><span class=\"line\">                                  full=<span class=\"keyword\">True</span>, **options)</span><br><span class=\"line\">        self.highlighted = highlight(self.code, lexer, formatter)</span><br><span class=\"line\">        super(Snippet, self).save(*args, **kwargs)</span><br><span class=\"line\"></span><br><span class=\"line\">        signals.snippet_saved.send(sender=self.__class__, obj=self, instance=self)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">signals.snippet_saved.connect(receiver=signals.on_snippet_create, sender=Snippet)</span><br></pre></td></tr></table></figure>\n<p>当然除了使用connect函数，使用之前用到的receiver装饰器也是可以的。</p>\n<p>完成之后，开启测试服务器，put一段新的snippet，同样的能在控制台查看到打印的log。</p>\n<p>参考资料：</p>\n<p><a href=\"http://www.jianshu.com/p/7ad5db9a1b69\" target=\"_blank\" rel=\"noopener\">http://www.jianshu.com/p/7ad5db9a1b69</a></p>\n<p><a href=\"http://www.cnblogs.com/mindsbook/archive/2009/10/27/django_signal.html\" target=\"_blank\" rel=\"noopener\">http://www.cnblogs.com/mindsbook/archive/2009/10/27/django_signal.html</a></p>\n<p><a href=\"http://python.usyiyi.cn/translate/django_182/topics/signals.html\" target=\"_blank\" rel=\"noopener\">http://python.usyiyi.cn/translate/django_182/topics/signals.html</a></p>"},{"title":"Django 查询","date":"2017-10-12T09:28:34.000Z","_content":"\n# 执行查询\n\n一旦你建立好数据模型，Django 会自动为你生成一套数据库抽象的API，可以让你创建、检索、更新和删除对象。这篇文档阐述如何使用这些API。 关于模型查询所有选项的完整细节，请见数据模型参考。\n\n<!--more-->\n\n在整个文档（以及参考）中，我们将引用下面的模型，它构成一个博客应用：\n\n```\nfrom django.db import models\n\nclass Blog(models.Model):\n    name = models.CharField(max_length=100)\n    tagline = models.TextField()\n\n    def __str__(self):              # __unicode__ on Python 2\n        return self.name\n\nclass Author(models.Model):\n    name = models.CharField(max_length=50)\n    email = models.EmailField()\n\n    def __str__(self):              # __unicode__ on Python 2\n        return self.name\n\nclass Entry(models.Model):\n    blog = models.ForeignKey(Blog)\n    headline = models.CharField(max_length=255)\n    body_text = models.TextField()\n    pub_date = models.DateField()\n    mod_date = models.DateField()\n    authors = models.ManyToManyField(Author)\n    n_comments = models.IntegerField()\n    n_pingbacks = models.IntegerField()\n    rating = models.IntegerField()\n\n    def __str__(self):              # __unicode__ on Python 2\n        return self.headline\n```\n\n####创建对象\n\nDjango 使用一种直观的方式把数据库表中的数据表示成Python 对象：一个模型类代表数据库中的一个表，一个模型类的实例代表这个数据库表中的一条特定的记录。\n\n使用关键字参数实例化模型实例来创建一个对象，然后调用save() 把它保存到数据库中。\n\n假设模型存放于文件mysite/blog/models.py中，下面是一个例子：\n\n```\n>>> from blog.models import Blog\n>>> b = Blog(name='Beatles Blog', tagline='All the latest Beatles news.')\n>>> b.save()\n```\n\n上面的代码在背后执行了SQL 的INSERT 语句。在你显式调用save()之前，Django 不会访问数据库。\n\nsave() 方法没有返回值。\n\n请参见\n\nsave()方法带有一些高级选项，它们没有在这里给出。完整的细节请见save() 文档。\n\n如果你想只用一条语句创建并保存一个对象，使用create()方法。\n\n#### 保存对象的改动\n\n要保存对数据库中已存在的对象的改动，请使用save()。\n\n假设Blog 的一个实例b5 已经被保存在数据库中，下面这个例子将更改它的name 并且更新数据库中的记录：\n\n```\n>>> b5.name = 'New name'\n>>> b5.save()\n```\n\n上面的代码在背后执行SQL 的UPDATE语句。在你显式调用save()之前，Django不会访问数据库。\n\n#### 保存ForeignKey和ManyToManyField字段\n\n更新ForeignKey 字段的方式和保存普通字段相同 —— 只要把一个正确类型的对象赋值给该字段。下面的例子更新了Entry类的实例entry 的blog 属性，假设Entry 和Blog 分别已经有一个正确的实例保存在数据库中（所以我们可以像下面这样获取它们）：\n\n```\n>>> from blog.models import Entry\n>>> entry = Entry.objects.get(pk=1)\n>>> cheese_blog = Blog.objects.get(name=\"Cheddar Talk\")\n>>> entry.blog = cheese_blog\n>>> entry.save()\n```\n\n更新ManyToManyField 的方式有一些不同 —— 需要使用字段的add()方法来增加关联关系的一条记录。下面这个例子向entry 对象添加Author 类的实例joe：\n\n```\n>>> from blog.models import Author\n>>> joe = Author.objects.create(name=\"Joe\")\n>>> entry.authors.add(joe)\n```\n\n为了在一条语句中，向ManyToManyField添加多条记录，可以在调用add()方法时传入多个参数，像这样：\n\n```\n>>> john = Author.objects.create(name=\"John\")\n>>> paul = Author.objects.create(name=\"Paul\")\n>>> george = Author.objects.create(name=\"George\")\n>>> ringo = Author.objects.create(name=\"Ringo\")\n>>> entry.authors.add(john, paul, george, ringo)\n```\n\nDjango 将会在你赋值或添加错误类型的对象时报错。\n\n#### 获取对象\n通过模型中的管理器构造一个查询集，来从你的数据库中获取对象。\n\n查询集表示从数据库中取出来的对象的集合。它可以含有零个、一个或者多个过滤器。过滤器基于所给的参数限制查询的结果。 从SQL 的角度，查询集和SELECT 语句等价，过滤器是像WHERE 和LIMIT 一样的限制子句。\n\n你可以从模型的管理器那里取得查询集。每个模型都至少有一个管理器，它默认命名为objects。通过模型类来直接访问它，像这样：\n\n```\n>>> Blog.objects\n<django.db.models.manager.Manager object at ...>\n>>> b = Blog(name='Foo', tagline='Bar')\n>>> b.objects\nTraceback:\n    ...\nAttributeError: \"Manager isn't accessible via Blog instances.\"\n```\n\n注\n\n管理器只可以通过模型的类访问，而不可以通过模型的实例访问，目的是为了强制区分“表级别”的操作和“记录级别”的操作。\n\n对于一个模型来说，管理器是查询集的主要来源。例如，Blog.objects.all() 返回包含数据库中所有Blog 对象的一个查询集。\n\n#### 获取所有对象\n\n获取一个表中所有对象的最简单的方式是全部获取。可以使用管理器的all() 方法：\n\n```\n>>> all_entries = Entry.objects.all()\n```\n\nall()方法返回包含数据库中所有对象的一个查询集\n\n#### 使用过滤器获取特定对象\n\nall()。但在通常情况下，你往往想要获取的是完整数据集的一个子集。\n\n要创建这样一个子集，你需要在原始的的查询集两个最普遍的途径是：\n\n- `filter(**kwargs)`\n\n  返回一个新的查询集，它包含满足查询参数的对象。\n\n- `exclude(**kwargs)`\n\n  返回一个新的查询集，它包含*不*满足查询参数的对象。\n\n查询参数（上面函数定义中的`**kwargs`）需要满足特定的格式，下面[字段查询]一节中会提到。\n\n举个例子，要获取年份为2006的所有文章的查询集方法：\n\n```\nEntry.objects.filter(pub_date__year=2006)\n```\n\n利用默认的管理器，它相当于：\n\n```\nEntry.objects.all().filter(pub_date__year=2006)\n```\n\n#### 链式过滤\n\n查询集，所以可以将筛选语句链接在一起。像这样：\n\n```\n>>> Entry.objects.filter(\n...     headline__startswith='What'\n... ).exclude(\n...     pub_date__gte=datetime.date.today()\n... ).filter(\n...     pub_date__gte=datetime(2005, 1, 30)\n... )\n```\n\n这个例子最开始获取数据库中所有对象的一个查询集，它包含标题以”What“开头、发布日期在2005年1月30日至当天之间的所有记录。\n\n#### 过滤后的查询集是独立的\n\n每次你筛选一个查询集，它可以被存储及反复使用。\n\n例如：\n\n```\n>>> q1 = Entry.objects.filter(headline__startswith=\"What\")\n>>> q2 = q1.exclude(pub_date__gte=datetime.date.today())\n>>> q3 = q1.filter(pub_date__gte=datetime.date.today())\n```\n\n这三个`查询集`都是独立的。第一个是一个基础的查询集不会受到筛选过程的影响。\n\n#### 查询集是惰性执行的\n\n`查询集` 是惰性执行的 —— 创建查询集 需要*求值*时，Django 才会真正运行这个查询。看下这个例子：\n\n```\n>>> q = Entry.objects.filter(headline__startswith=\"What\")\n>>> q = q.filter(pub_date__lte=datetime.date.today())\n>>> q = q.exclude(body_text__icontains=\"food\")\n>>> print(q)\n```\n\n虽然它看上去有三次数据库访问，但事实上只有在最后一行（`print(q)`）时才访问一次数据库。一般来说，只有在“请求”查询集。\n\n### 通过get 获取一个单一的对象\n\nfilter()将只包含一个元素。\n\n如果你知道只有一个对象满足你的查询，你可以使用管理器 方法，它直接返回该对象：\n\n```\n>>> one_entry = Entry.objects.get(pk=1)\n```\n\n可以对get()。\n\n注意，使用get() 将引发一个`DoesNotExist` 异常。这个异常是正在查询的模型类的一个属性 —— 所以在上面的代码中，如果没有主键为1 的`Entry` 对象，Django 将引发一个`Entry.DoesNotExist`。\n\n类似地，如果有多条记录满足get()，它同样是模型类自身的一个属性。\n\n### 其它查询集方法\n\n大多数情况下，需要从数据库中查找对象时，你会使用all()。\n\n### 限制查询集\n\n可以使用Python 的切片语法来限制查询集记录的数目 。它等同于SQL 的`LIMIT` 和`OFFSET` 子句。\n\n例如，下面的语句返回前面5 个对象(`LIMIT 5`)：\n\n```\n>>> Entry.objects.all()[:5]\n```\n\n下面这条语句返回第6 至第10 个对象(`OFFSET 5 LIMIT 5`)：\n\n```\n>>> Entry.objects.all()[5:10]\n```\n\n不支持负的索引（例如`Entry.objects.all()[-1]`）。\n\n通常，查询集 —— 它不会执行查询。有一个例外，是如果你使用Python 切片语法中\"step\"参数。例如，下面的语句将返回前10 个对象中每隔*2*个对象，它将真实执行查询：\n\n```\n>>> Entry.objects.all()[:10:2]\n```\n\n若要获取一个*单一*的对象而不是一个列表（例如，`SELECT foo FROM bar LIMIT 1`），可以简单地使用一个索引而不是切片。例如，下面的语句返回数据库中根据标题排序后的第一条`Entry`：\n\n```\n>>> Entry.objects.order_by('headline')[0]\n```\n\n它大体等同于：\n\n```\n>>> Entry.objects.order_by('headline')[0:1].get()\n```\n\n然而请注意，如果没有对象满足给定的条件，第一条语句将引发`IndexError`而第二条语句将引发`DoesNotExist`。 更多细节参见get()。\n\n### 字段查询\n\n字段查询是指如何指定SQL `WHERE` 子句的内容。它们通过查询集 的关键字参数指定。\n\n查询的关键字参数的基本形式是`field__lookuptype=value`。（中间是两个下划线）。例如：\n\n```\n>>> Entry.objects.filter(pub_date__lte='2006-01-01')\n```\n\n翻译成SQL（大体）是：\n\n```\nSELECT * FROM blog_entry WHERE pub_date <= '2006-01-01';\n```\n\n这是如何实现的\n\nPython 定义的函数可以接收任意的键/值对参数，这些名称和参数可以在运行时求值。更多信息，参见Python 官方文档中的[关键字参数](https://docs.python.org/tutorial/controlflow.html#keyword-arguments)。\n\n查询条件中指定的字段必须是模型字段的名称。但有一个例外，对于ForeignKey你可以使用字段名加上`_id` 后缀。在这种情况下，该参数的值应该是外键的原始值。例如：\n\n```\n>>> Entry.objects.filter(blog_id=4)\n```\n\n如果你传递的是一个不合法的参数，查询函数将引发 `TypeError`。\n\n这些数据库API 支持大约二十多种查询的类型；在[*字段查询参考*] 中可以找到完整的参考。为了让你尝尝鲜，下面是一些你可能用到的常见查询：\n\n- exact\n\n  “精确”匹配。例如：`>>> Entry.objects.get(headline__exact=\"Man bites dog\")`将生成下面的SQL：`SELECT ... WHERE headline = 'Man bites dog';`如果你没有提供查询类型 —— 即如果你的关键字参数不包含双下划线 —— 默认假定查询类型是`exact`。例如，下面的两条语句相等：`>>> Blog.objects.get(id__exact=14)  # Explicit form>>> Blog.objects.get(id=14)         # __exact is implied`这是为了方便，因为`exact` 查询是最常见的情况。\n\n- iexact\n\n  大小写不敏感的匹配。所以，查询：`>>> Blog.objects.get(name__iexact=\"beatles blog\")`将匹配标题为`\"Beatles Blog\"`、`\"beatles blog\"` 甚至`\"BeAtlES blOG\"` 的`Blog`。\n\n- contains\n\n  大小写敏感的包含关系测试。例如：`Entry.objects.get(headline__contains='Lennon')`大体可以翻译成下面的SQL：`SELECT ... WHERE headline LIKE '%Lennon%';`注意，这将匹配`'Today Lennon honored'` 但不能匹配`'today lennon honored'`。还有一个大小写不敏感的版本，icontains。\n\n- startswith\n\n  分别表示以XXX开头和以XXX结尾。当然还有大小写不敏感的版本，叫做istartswith。\n\n同样，这里只是表面。完整的参考可以在[*字段查询参考*]中找到。\n\n### 跨关联关系的查询\n\nDjango 提供一种强大而又直观的方式来“处理”查询中的关联关系，它在后台自动帮你处理`JOIN`。 若要跨越关联关系，只需使用关联的模型字段的名称，并使用双下划线分隔，直至你想要的字段：\n\n下面这个例子获取所有`Blog` 的`name` 为`'Beatles Blog'` 的`Entry` 对象：\n\n```\n>>> Entry.objects.filter(blog__name='Beatles Blog')\n```\n\n这种跨越可以是任意的深度。\n\n它还可以反向工作。若要引用一个“反向”的关系，只需要使用该模型的小写的名称。\n\n下面的示例获取所有的`Blog` 对象，它们至少有一个`Entry` 的`headline` 包含`'Lennon'`：\n\n```\n>>> Blog.objects.filter(entry__headline__contains='Lennon')\n```\n\n如果你在多个关联关系直接过滤而且其中某个中介模型没有满足过滤条件的值，Django 将把它当做一个空的（所有的值都为`NULL`）但是合法的对象。这意味着不会有错误引发。例如，在下面的过滤器中：\n\n```\nBlog.objects.filter(entry__authors__name='Lennon')\n```\n\n（如果有一个相关联的`Author` 模型），如果Entry 中没有找到对应的`author`，那么它将当作其没有`name`，而不会因为没有`author` 引发一个错误。通常，这就是你想要的。唯一可能让你困惑的是当你使用isnull 的时候。因此：\n\n```\nBlog.objects.filter(entry__authors__name__isnull=True)\n```\n\n返回的`Blog` 对象包括`author` __`name` 为空的Blog对象,以及author__name不为空但author__name关联的`entry` __`author` 为空的对象。如果你不需要后者，你可以这样写：\n\n```\nBlog.objects.filter(entry__authors__isnull=False,\n        entry__authors__name__isnull=True)\n```\n\n#### 跨越多值的关联关系\n\n当你基于ManyToManyField 来过滤一个对象时，有两种不同种类的过滤器。考虑`Blog`/`Entry` 关联关系（`Blog` 和 `Entry` 是一对多的关系）。我们可能想找出headline为*“Lennon”* 并且pub_date为'2008'年的Entry。或者我们可能想查询headline为*“Lennon”* 的Entry或者pub_date为'2008'的Entry。因为实际上有和单个`Blog` 相关联的多个Entry，所以这两个查询在某些场景下都是有可能并有意义的。\n\nManyToManyField 叫做 `tags`，我们可能想找到tag 叫做*“music”* 和*“bands”* 的Entry，或者我们想找一个tag 名为*“music”* 且状态为*“public”*的Entry。\n\n对于这两种情况，Django 有种一致的方法来处理filter() 调用选择出来的对象。\n\n这些听起来可能有点混乱，所以希望展示一个例子使它变得更清晰。选择所有包含同时满足两个条件的entry的blog，这两个条件是headline 包含*Lennon* 和发表时间是2008 （同一个entry 满足两个条件），我们的代码是：\n\n```\nBlog.objects.filter(entry__headline__contains='Lennon',\n        entry__pub_date__year=2008)\n```\n\n从所有的blog模型实例中选择满足以下条件的blog实例：blog的enrty的headline属性值是*“Lennon”***，或者entry的**发表时间是2008（两个条件至少满足一个，也可以同时满足），我们的代码是：\n\n```\nBlog.objects.filter(entry__headline__contains='Lennon').filter(\n        entry__pub_date__year=2008)\n```\n\n假设这里有一个blog拥有一条包含*'Lennon'*的entries条目和一条来自2008的entries条目,但是没有一条来自2008并且包含*\"Lennon\"*的entries条目。第一个查询不会返回任何blog，第二个查询将会返回一个blog。\n\n在第二个例子中， 第一个filter 限定查询集中的blog 与headline 包含*“Lennon”* 的entry 关联。第二个filter *又* 限定查询集中的blog ，这些blog关联的entry 的发表时间是2008。（译者注：难点在如何理解further这个词！）第二个filter 过滤出来的entry 与第一个filter 过滤出来的entry 可能相同也可能不同。每个filter 语句过滤的是`Blog`，而不是`Entry`。\n\n注\n\n跨越多值关系的filter() 调用中的条件不必引用同一个记录。\n\n例如，下面的查询排除**headline 中包含*“Lennon”*的Entry*和*在2008 年发布的Entry：\n\n```\nBlog.objects.exclude(\n    entry__headline__contains='Lennon',\n    entry__pub_date__year=2008,\n)\n```\n\n然而，这与使用filter() 的行为不同，它不是排除同时满足两个条件的Entry。为了实现这点，即选择的Blog中不包含在2008年发布且healine 中带有*“Lennon”* 的Entry，你需要编写两个查询：\n\n```\nBlog.objects.exclude(\n    entry=Entry.objects.filter(\n        headline__contains='Lennon',\n        pub_date__year=2008,\n    ),\n)\n\n```\n\n### Filter 可以引用模型的字段\n\n到目前为止给出的示例中，我们构造过将模型字段与常量进行比较的filter。但是，如果你想将模型的一个字段与同一个模型的另外一个字段进行比较该怎么办？\n\nDjango 提供F 表达式` 返回的实例用作查询内部对模型字段的引用。这些引用可以用于查询的filter 中来比较相同模型实例上不同字段之间值的比较。\n\n例如，为了查找comments 数目多于pingbacks 的Entry，我们将构造一个`F()` 对象来引用pingback 数目，并在查询中使用该`F()` 对象：\n\n```\n>>> from django.db.models import F\n>>> Entry.objects.filter(n_comments__gt=F('n_pingbacks'))\n\n```\n\nDjango 支持对`F()` 对象使用加法、减法、乘法、除法、取模以及幂计算等算术操作，两个操作数可以都是常数和其它`F()` 对象。为了查找comments 数目比pingbacks *两倍*还要多的Entry，我们将查询修改为：\n\n```\n>>> Entry.objects.filter(n_comments__gt=F('n_pingbacks') * 2)\n\n```\n\nNew in Django 1.7:\n\n添加 `**` 操作符。\n\n为了查询rating 比pingback 和comment 数目总和要小的Entry，我们将这样查询：\n\n```\n>>> Entry.objects.filter(rating__lt=F('n_comments') + F('n_pingbacks'))\n\n```\n\n你还可以在`F()` 对象中使用双下划线标记来跨越关联关系。带有双下划线的`F()` 对象将引入任何需要的join 操作以访问关联的对象。例如，如要获取author 的名字与blog 名字相同的Entry，我们可以这样查询：\n\n```\n>>> Entry.objects.filter(authors__name=F('blog__name'))\n\n```\n\n对于date 和date/time 字段，你可以给它们加上或减去一个timedelta(https://docs.python.org/3/library/datetime.html#datetime.timedelta) 对象。下面的例子将返回发布超过3天后被修改的所有Entry：\n\n```\n>>> from datetime import timedelta\n>>> Entry.objects.filter(mod_date__gt=F('pub_date') + timedelta(days=3))\n\n```\n\n`F()` 对象支持`.bitand()` 和`.bitor()` 两种位操作，例如：\n\n```\n>>> F('somefield').bitand(16)\n\n```\n\n### 查询的快捷方式pk\n\n为了方便，Django 提供一个查询快捷方式`pk` ，它表示“primary key” 的意思。\n\n在`Blog` 模型示例中，主键是`id` 字段，所以下面三条语句是等同的：\n\n```\n>>> Blog.objects.get(id__exact=14) # Explicit form\n>>> Blog.objects.get(id=14) # __exact is implied\n>>> Blog.objects.get(pk=14) # pk implies id__exact\n\n```\n\n`pk` 的使用不仅限于`__exact` 查询 —— 任何查询类型都可以与`pk` 结合来完成一个模型上对主键的查询：\n\n```\n# Get blogs entries with id 1, 4 and 7\n>>> Blog.objects.filter(pk__in=[1,4,7])\n\n# Get all blog entries with id > 14\n>>> Blog.objects.filter(pk__gt=14)\n\n```\n\n`pk`查询在join 中也可以工作。例如，下面三个语句是等同的：\n\n```\n>>> Entry.objects.filter(blog__id__exact=3) # Explicit form\n>>> Entry.objects.filter(blog__id=3)        # __exact is implied\n>>> Entry.objects.filter(blog__pk=3)        # __pk implies __id__exact\n\n```\n\n### 转义LIKE 语句中的百分号和下划线\n\n与`LIKE` SQL 语句等同的字段查询（`iexact`、 `contains`、`icontains`、`startswith`、 `istartswith`、`endswith` 和`iendswith`）将自动转义在`LIKE` 语句中使用的两个特殊的字符 —— 百分号和下划线。（在`LIKE` 语句中，百分号通配符表示多个字符，下划线通配符表示单个字符）。\n\n这意味着语句将很直观，不会显得太抽象。例如，要获取包含一个百分号的所有的Entry，只需要像其它任何字符一样使用百分号：\n\n```\n>>> Entry.objects.filter(headline__contains='%')\n\n```\n\nDjango 会帮你转义；生成的SQL 看上去会是这样：\n\n```\nSELECT ... WHERE headline LIKE '%\\%%';\n\n```\n\n对于下划线是同样的道理。百分号和下划线都会透明地帮你处理。\n\n### 缓存和查询集\n\n每个查询集都包含一个缓存来最小化对数据库的访问。理解它是如何工作的将让你编写最高效的代码。\n\n在一个新创建的查询集 的求值将重用缓存的结果。\n\n请牢记这个缓存行为，因为对查询集，对它们求值，然后扔掉它们：\n\n```\n>>> print([e.headline for e in Entry.objects.all()])\n>>> print([e.pub_date for e in Entry.objects.all()])\n\n```\n\n这意味着相同的数据库查询将执行两次，显然倍增了你的数据库负载。同时，还有可能两个结果列表并不包含相同的数据库记录，因为在两次请求期间有可能有`Entry`被添加进来或删除掉。\n\n为了避免这个问题，只需保存查询集并重新使用它：\n\n```\n>>> queryset = Entry.objects.all()\n>>> print([p.headline for p in queryset]) # Evaluate the query set.\n>>> print([p.pub_date for p in queryset]) # Re-use the cache from the evaluation.\n\n```\n\n#### 何时查询集不会被缓存\n\n查询集不会永远缓存它们的结果。当只对查询集的*部分*进行求值时会检查缓存， 但是如果这个部分不在缓存中，那么接下来查询返回的记录都将不会被缓存。特别地，这意味着使用切片或索引来[*限制查询集*]将不会填充缓存。\n\n例如，重复获取查询集对象中一个特定的索引将每次都查询数据库：\n\n```\n>>> queryset = Entry.objects.all()\n>>> print queryset[5] # Queries the database\n>>> print queryset[5] # Queries the database again\n\n```\n\n然而，如果已经对全部查询集求值过，则将检查缓存：\n\n```\n>>> queryset = Entry.objects.all()\n>>> [entry for entry in queryset] # Queries the database\n>>> print queryset[5] # Uses cache\n>>> print queryset[5] # Uses cache\n\n```\n\n下面是一些其它例子，它们会使得全部的查询集被求值并填充到缓存中：\n\n```\n>>> [entry for entry in queryset]\n>>> bool(queryset)\n>>> entry in queryset\n>>> list(queryset)\n\n```\n\n注\n\n简单地打印查询集不会填充缓存。因为`__repr__()` 调用只返回全部查询集的一个切片。\n\n## 使用Q 对象进行复杂的查询\n\nfilter()。\n\nQ 对象 对象用于封装一组关键字参数。这些关键字参数就是上文“字段查询” 中所提及的那些。\n\n例如，下面的`Q` 对象封装一个`LIKE` 查询：\n\n```\nfrom django.db.models import Q\nQ(question__startswith='What')\n\n```\n\n`Q` 对象可以使用`&` 和`|` 操作符组合起来。当一个操作符在两个`Q` 对象上使用时，它产生一个新的`Q` 对象。\n\n例如，下面的语句产生一个`Q` 对象，表示两个`\"question__startswith\"` 查询的“OR” ：\n\n```\nQ(question__startswith='Who') | Q(question__startswith='What')\n\n```\n\n它等同于下面的SQL `WHERE` 子句：\n\n```\nWHERE question LIKE 'Who%' OR question LIKE 'What%'\n\n```\n\n你可以组合`&` 和`|`  操作符以及使用括号进行分组来编写任意复杂的`Q` 对象。同时，`Q` 对象可以使用`~` 操作符取反，这允许组合正常的查询和取反(`NOT`) 查询：\n\n```\nQ(question__startswith='Who') | ~Q(pub_date__year=2005)\n\n```\n\n每个接受关键字参数的查询函数（例如filter()）都可以传递一个或多个`Q` 对象作为位置（不带名的）参数。如果一个查询函数有多个`Q` 对象参数，这些参数的逻辑关系为“AND\"。例如：\n\n```\nPoll.objects.get(\n    Q(question__startswith='Who'),\n    Q(pub_date=date(2005, 5, 2)) | Q(pub_date=date(2005, 5, 6))\n)\n\n```\n\n... 大体上可以翻译成这个SQL：\n\n```\nSELECT * from polls WHERE question LIKE 'Who%'\n    AND (pub_date = '2005-05-02' OR pub_date = '2005-05-06')\n\n```\n\n查询函数可以混合使用`Q 对象`和关键字参数。所有提供给查询函数的参数（关键字参数或`Q` 对象）都将\"AND”在一起。但是，如果出现`Q` 对象，它必须位于所有关键字参数的前面。例如：\n\n```\nPoll.objects.get(\n    Q(pub_date=date(2005, 5, 2)) | Q(pub_date=date(2005, 5, 6)),\n    question__startswith='Who')\n\n```\n\n... 是一个合法的查询，等同于前面的例子；但是：\n\n```\n# INVALID QUERY\nPoll.objects.get(\n    question__startswith='Who',\n    Q(pub_date=date(2005, 5, 2)) | Q(pub_date=date(2005, 5, 6)))\n\n```\n\n... 是不合法的。\n\n另见\n\nDjango 单元测试中的[OR 查询示例](https://github.com/django/django/blob/master/tests/or_lookups/tests.py)演示了几种`Q` 的用法。\n\n## 比较对象\n\n为了比较两个模型实例，只需要使用标准的Python 比较操作符，即双等于符号：`==`。在后台，它会比较两个模型主键的值。\n\n利用上面的`Entry` 示例，下面两个语句是等同的：\n\n```\n>>> some_entry == other_entry\n>>> some_entry.id == other_entry.id\n\n```\n\n如果模型的主键不叫`id`，也没有问题。比较将始终使用主键，无论它叫什么。例如，如果模型的主键字段叫做`name`，下面的两条语句是等同的：\n\n```\n>>> some_obj == other_obj\n>>> some_obj.name == other_obj.name\n\n```\n\n## 删除对象\n\n删除方法，为了方便，就取名为delete()。这个方法将立即删除对象且没有返回值。例如：\n\n```\ne.delete()\n\n```\n\n你还可以批量删除对象。每个查询集中的所有成员。\n\n例如，下面的语句删除`pub_date` 为2005 的所有`Entry` 对象：\n\n```\nEntry.objects.filter(pub_date__year=2005).delete()\n\n```\n\n记住，这将尽可能地使用纯SQL 执行，所以这个过程中不需要调用每个对象实例的`delete()`方法。如果你给模型类提供了一个自定义的`delete()` 方法并希望确保它被调用，你需要手工删除该模型的实例（例如，迭代查询集 方法。\n\n当Django 删除一个对象时，它默认使用SQL `ON DELETE CASCADE` 约束 —— 换句话讲，任何有外键指向要删除对象的对象将一起删除。例如：\n\n```\nb = Blog.objects.get(pk=1)\n# This will delete the Blog and all of its Entry objects.\nb.delete()\n\n```\n\n这种级联的行为可以通过的ForeignKey 参数自定义。\n\n注意，delete()`，而删除*所有* 的条目。如果你*确实*想删除所有的对象，你必须明确地请求一个完全的查询集：\n\n```\nEntry.objects.all().delete()\n\n```\n\n## 拷贝模型实例\n\n虽然没有内建的方法用于拷贝模型实例，但还是很容易创建一个新的实例并让它的所有字段都拷贝过来。最简单的方法是，只需要将`pk` 设置为`None`。利用我们的Blog 示例：\n\n```\nblog = Blog(name='My blog', tagline='Blogging is easy')\nblog.save() # blog.pk == 1\n\nblog.pk = None\nblog.save() # blog.pk == 2\n\n```\n\n如果你用继承，那么会复杂一些。考虑下面`Blog` 的子类：\n\n```\nclass ThemeBlog(Blog):\n    theme = models.CharField(max_length=200)\n\ndjango_blog = ThemeBlog(name='Django', tagline='Django is easy', theme='python')\ndjango_blog.save() # django_blog.pk == 3\n\n```\n\n由于继承的工作方式，你必须设置`pk` 和 `id` 都为None：\n\n```\ndjango_blog.pk = None\ndjango_blog.id = None\ndjango_blog.save() # django_blog.pk == 4\n\n```\n\n这个过程不会拷贝关联的对象。如果你想拷贝关联关系，你必须编写一些更多的代码。在我们的例子中，`Entry` 有一个到`Author` 的多对多字段：\n\n```\nentry = Entry.objects.all()[0] # some previous entry\nold_authors = entry.authors.all()\nentry.pk = None\nentry.save()\nentry.authors = old_authors # saves new many2many relations\n\n```\n\n## 一次更新多个对象\n\n有时你想为一个查询集 方法。例如：\n\n```\n# Update all the headlines with pub_date in 2007.\nEntry.objects.filter(pub_date__year=2007).update(headline='Everything is the same')\n\n```\n\n你只可以对非关联字段和ForeignKey 字段，需设置新的值为你想指向的新的模型实例。例如：\n\n```\n>>> b = Blog.objects.get(pk=1)\n\n# Change every Entry so that it belongs to this Blog.\n>>> Entry.objects.all().update(blog=b)\n\n```\n\n`update()` 方法会立即执行并返回查询匹配的行数（如果有些行已经具有新的值，返回的行数可能和被更新的行数不相等）。更新查询集 唯一的限制是它只能访问一个数据库表，也就是模型的主表。你可以根据关联的字段过滤，但是你只能更新模型主表中的列。例如：\n\n```\n>>> b = Blog.objects.get(pk=1)\n\n# Update all the headlines belonging to this Blog.\n>>> Entry.objects.select_related().filter(blog=b).update(headline='Everything is the same')\n\n```\n\n要注意`update()` 方法会直接转换成一个SQL 语句。它是一个批量的直接更新操作。它不会运行模型的save()：\n\n```\nfor item in my_queryset:\n    item.save()\n\n```\n\n对update 的调用也可以使用F 表达式 来根据模型中的一个字段更新另外一个字段。这对于在当前值的基础上加上一个值特别有用。例如，增加Blog 中每个Entry 的pingback 个数：\n\n```\n>>> Entry.objects.all().update(n_pingbacks=F('n_pingbacks') + 1)\n\n```\n\n然而，与filter 和exclude 子句中的`F()` 对象不同，在update 中你不可以使用`F()` 对象引入join —— 你只可以引用正在更新的模型的字段。如果你尝试使用`F()` 对象引入一个join，将引发一个`FieldError`：\n\n```\n# THIS WILL RAISE A FieldError\n>>> Entry.objects.update(headline=F('blog__name'))\n\n```\n\n## 关联的对象\n\n当你在一个模型中定义一个关联关系时（例如，ForeignKey），该模型的实例将带有一个方便的API 来访问关联的对象。\n\n利用本页顶部的模型，一个`Entry` 对象`e` 可以通过`blog` 属性`e.blog` 获取关联的`Blog` 对象。\n\n（在幕后，这个功能是通过Python 的[描述器]实现的。这应该不会对你有什么真正的影响，但是这里我们指出它以满足你的好奇）。\n\nDjango 还会创建API 用于访问关联关系的另一头 —— 从关联的模型访问定义关联关系的模型。例如，`Blog` 对象`b` 可以通过`entry_set` 属性 `b.entry_set.all()`访问与它关联的所有`Entry` 对象。\n\n这一节中的所有示例都将使用本页顶部定义的`Blog`、 `Author` 和`Entry` 模型。\n\n### 一对多关系\n\n#### 前向查询\n\n如果一个模型具有ForeignKey，那么该模型的实例将可以通过属性访问关联的（外部）对象。\n\n例如：\n\n```\n>>> e = Entry.objects.get(id=2)\n>>> e.blog # Returns the related Blog object.\n\n```\n\n你可以通过外键属性获取和设置。和你预期的一样，对外键的修改不会保存到数据库中直至你调用save()。例如：\n\n```\n>>> e = Entry.objects.get(id=2)\n>>> e.blog = some_blog\n>>> e.save()\n\n```\n\n如果ForeignKey 字段有`null=True` 设置（即它允许`NULL` 值），你可以分配`None` 来删除对应的关联性。例如：\n\n```\n>>> e = Entry.objects.get(id=2)\n>>> e.blog = None\n>>> e.save() # \"UPDATE blog_entry SET blog_id = NULL ...;\"\n\n```\n\n一对多关联关系的前向访问在第一次访问关联的对象时被缓存。以后对同一个对象的外键的访问都使用缓存。例如：\n\n```\n>>> e = Entry.objects.get(id=2)\n>>> print(e.blog)  # Hits the database to retrieve the associated Blog.\n>>> print(e.blog)  # Doesn't hit the database; uses cached version.\n\n```\n\n注意select_related()方法递归地预填充所有的一对多关系到缓存中。例如：\n\n```\n>>> e = Entry.objects.select_related().get(id=2)\n>>> print(e.blog)  # Doesn't hit the database; uses cached version.\n>>> print(e.blog)  # Doesn't hit the database; uses cached version.\n\n```\n\n#### 反向查询\n\n如果模型I有一个ForeignKey返回的`查询集`可以用上一节提到的方式进行过滤和操作。\n\n例如：\n\n```\n>>> b = Blog.objects.get(id=1)\n>>> b.entry_set.all() # Returns all Entry objects related to Blog.\n\n# b.entry_set is a Manager that returns QuerySets.\n>>> b.entry_set.filter(headline__contains='Lennon')\n>>> b.entry_set.count()\n\n```\n\n你可以在ForeignKey`，那么上面的示例代码应该改成这样：\n\n```\n>>> b = Blog.objects.get(id=1)\n>>> b.entries.all() # Returns all Entry objects related to Blog.\n\n# b.entries is a Manager that returns QuerySets.\n>>> b.entries.filter(headline__contains='Lennon')\n>>> b.entries.count()\n\n```\n\n#### 使用自定义的反向管理器\n\nNew in Django 1.7.\n\n默认情况下，用于反向关联关系的RelatedManager 的子类。如果你想为一个查询指定一个不同的管理器，你可以使用下面的语法：\n\n```\nfrom django.db import models\n\nclass Entry(models.Model):\n    #...\n    objects = models.Manager()  # Default Manager\n    entries = EntryManager()    # Custom Manager\n\nb = Blog.objects.get(id=1)\nb.entry_set(manager='entries').all()\n\n```\n\n如果`EntryManager` 在它的`get_queryset()` 方法中使用默认的过滤，那么该过滤将适用于`all()` 调用。\n\n当然，指定一个自定义的管理器还可以让你调用自定义的方法：\n\n```\nb.entry_set(manager='entries').is_published()\n\n```\n\n#### 处理关联对象的其它方法\n\n除了在上面”获取对象“一节中定义的查询集 中找到。\n\n- `add(obj1, obj2, ...)`\n\n  添加一指定的模型对象到关联的对象集中。\n\n- `create(**kwargs)`\n\n  创建一个新的对象，将它保存并放在关联的对象集中。返回新创建的对象。\n\n- `remove(obj1, obj2, ...)`\n\n  从关联的对象集中删除指定的模型对象。\n\n- `clear()`\n\n  从关联的对象集中删除所有的对象。\n\n若要一次性给关联的对象集赋值，只需要给它赋值一个可迭代的对象。这个可迭代的对象可以包含对象的实例，或者一个主键值的列表。例如：\n\n```\nb = Blog.objects.get(id=1)\nb.entry_set = [e1, e2]\n\n```\n\n在这个例子中，`e1` 和`e2` 可以是Entry 实例，也可以是主键的整数值。\n\n如果有`clear()` 方法，那么在将可迭代对象中的成员添加到集合中之前，将从`entry_set` 中删除所有已经存在的对象。如果*没有*`clear()` 方法，那么将直接添加可迭代对象中的成员而不会删除所有已存在的对象。\n\n这一节中提到的每个”反向“操作都会立即对数据库产生作用。每个添加、创建和删除操作都会立即并自动保存到数据库中。\n\n### 多对多关系\n\n多对多关系的两端都会自动获得访问另一端的API。这些API 的工作方式与上面提到的“方向”一对多关系一样。\n\n唯一的区别在于属性的名称：定义 ManyToManyField 的模型使用该字段的属性名称，而“反向”模型使用源模型的小写名称加上`'_set'` （和一对多关系一样）。\n\n一个例子可以让它更好理解：\n\n```\ne = Entry.objects.get(id=3)\ne.authors.all() # Returns all Author objects for this Entry.\ne.authors.count()\ne.authors.filter(name__contains='John')\n\na = Author.objects.get(id=5)\na.entry_set.all() # Returns all Entry objects for this Author.\n\n```\n\n类似ForeignKey 指定`related_name='entries'`，那么`Author` 实例将使用 `entries` 属性而不是`entry_set`。\n\n### 一对一关系\n\n一对一关系与多对一关系非常相似。如果你在模型中定义一个OneToOneField，该模型的实例将可以通过该模型的一个简单属性访问关联的模型。\n\n例如：\n\n```\nclass EntryDetail(models.Model):\n    entry = models.OneToOneField(Entry)\n    details = models.TextField()\n\ned = EntryDetail.objects.get(id=2)\ned.entry # Returns the related Entry object.\n\n```\n\n在“反向”查询中有所不同。一对一关系中的关联模型同样具有一个管理器表示一个单一的对象而不是对象的集合：\n\n```\ne = Entry.objects.get(id=2)\ne.entrydetail # returns the related EntryDetail object\n\n```\n\n如果没有对象赋值给这个关联关系，Django 将引发一个`DoesNotExist` 异常。\n\n实例可以赋值给反向的关联关系，方法和正向的关联关系一样：\n\n```\ne.entrydetail = ed\n\n```\n\n### 反向的关联关系是如何实现的？\n\n其它对象关系映射要求你在关联关系的两端都要定义。Django 的开发人员相信这是对DRY（不要重复你自己的代码）原则的违背，所以Django 只要求你在一端定义关联关系。\n\n但是这怎么可能？因为一个模型类直到其它模型类被加载之后才知道哪些模型类是关联的。\n\n答案在app registry 中列出的每个应用，然后导入每个应用中的`models`模块。每创建一个新的模型时，Django 添加反向的关系到所有关联的模型。如果关联的模型还没有导入，Django 将保存关联关系的记录并在最终关联的模型导入时添加这些关联关系。\n\n由于这个原因，你使用的所有模型都定义在INSTALLED_APPS 列出的应用中就显得特别重要。否则，反向的关联关系将不能正确工作。\n\n### 通过关联的对象进行查询\n\n在关联对象字段上的查询与正常字段的查询遵循同样的规则。当你指定查询需要匹配的一个值时，你可以使用一个对象实例或者对象的主键的值。\n\n例如，如果你有一个`id=5` 的Blog 对象`b`，下面的三个查询将是完全一样的：\n\n```\nEntry.objects.filter(blog=b) # Query using object instance\nEntry.objects.filter(blog=b.id) # Query using id from instance\nEntry.objects.filter(blog=5) # Query using id directly\n\n```\n\n## 回归到原始的 SQL\n\n如果你发现需要编写的SQL 查询对于Django 的数据库映射机制太复杂，你可以回归到手工编写SQL。Django 对于编写原始的SQL 查询有多个选项；参见[*执行原始的SQL 查询*]。\n\n最后，值得注意的是Django 的数据库层只是数据库的一个接口。你可以利用其它工具、编程语言或数据库框架来访问数据库；对于数据库，Django 没有什么特别的地方。","source":"_posts/DjangoQuery.md","raw":"---\ntitle: Django 查询\ncategories:\n  - Program\ntags:\n  - django\ndate: 2017-10-12 17:28:34\n---\n\n# 执行查询\n\n一旦你建立好数据模型，Django 会自动为你生成一套数据库抽象的API，可以让你创建、检索、更新和删除对象。这篇文档阐述如何使用这些API。 关于模型查询所有选项的完整细节，请见数据模型参考。\n\n<!--more-->\n\n在整个文档（以及参考）中，我们将引用下面的模型，它构成一个博客应用：\n\n```\nfrom django.db import models\n\nclass Blog(models.Model):\n    name = models.CharField(max_length=100)\n    tagline = models.TextField()\n\n    def __str__(self):              # __unicode__ on Python 2\n        return self.name\n\nclass Author(models.Model):\n    name = models.CharField(max_length=50)\n    email = models.EmailField()\n\n    def __str__(self):              # __unicode__ on Python 2\n        return self.name\n\nclass Entry(models.Model):\n    blog = models.ForeignKey(Blog)\n    headline = models.CharField(max_length=255)\n    body_text = models.TextField()\n    pub_date = models.DateField()\n    mod_date = models.DateField()\n    authors = models.ManyToManyField(Author)\n    n_comments = models.IntegerField()\n    n_pingbacks = models.IntegerField()\n    rating = models.IntegerField()\n\n    def __str__(self):              # __unicode__ on Python 2\n        return self.headline\n```\n\n####创建对象\n\nDjango 使用一种直观的方式把数据库表中的数据表示成Python 对象：一个模型类代表数据库中的一个表，一个模型类的实例代表这个数据库表中的一条特定的记录。\n\n使用关键字参数实例化模型实例来创建一个对象，然后调用save() 把它保存到数据库中。\n\n假设模型存放于文件mysite/blog/models.py中，下面是一个例子：\n\n```\n>>> from blog.models import Blog\n>>> b = Blog(name='Beatles Blog', tagline='All the latest Beatles news.')\n>>> b.save()\n```\n\n上面的代码在背后执行了SQL 的INSERT 语句。在你显式调用save()之前，Django 不会访问数据库。\n\nsave() 方法没有返回值。\n\n请参见\n\nsave()方法带有一些高级选项，它们没有在这里给出。完整的细节请见save() 文档。\n\n如果你想只用一条语句创建并保存一个对象，使用create()方法。\n\n#### 保存对象的改动\n\n要保存对数据库中已存在的对象的改动，请使用save()。\n\n假设Blog 的一个实例b5 已经被保存在数据库中，下面这个例子将更改它的name 并且更新数据库中的记录：\n\n```\n>>> b5.name = 'New name'\n>>> b5.save()\n```\n\n上面的代码在背后执行SQL 的UPDATE语句。在你显式调用save()之前，Django不会访问数据库。\n\n#### 保存ForeignKey和ManyToManyField字段\n\n更新ForeignKey 字段的方式和保存普通字段相同 —— 只要把一个正确类型的对象赋值给该字段。下面的例子更新了Entry类的实例entry 的blog 属性，假设Entry 和Blog 分别已经有一个正确的实例保存在数据库中（所以我们可以像下面这样获取它们）：\n\n```\n>>> from blog.models import Entry\n>>> entry = Entry.objects.get(pk=1)\n>>> cheese_blog = Blog.objects.get(name=\"Cheddar Talk\")\n>>> entry.blog = cheese_blog\n>>> entry.save()\n```\n\n更新ManyToManyField 的方式有一些不同 —— 需要使用字段的add()方法来增加关联关系的一条记录。下面这个例子向entry 对象添加Author 类的实例joe：\n\n```\n>>> from blog.models import Author\n>>> joe = Author.objects.create(name=\"Joe\")\n>>> entry.authors.add(joe)\n```\n\n为了在一条语句中，向ManyToManyField添加多条记录，可以在调用add()方法时传入多个参数，像这样：\n\n```\n>>> john = Author.objects.create(name=\"John\")\n>>> paul = Author.objects.create(name=\"Paul\")\n>>> george = Author.objects.create(name=\"George\")\n>>> ringo = Author.objects.create(name=\"Ringo\")\n>>> entry.authors.add(john, paul, george, ringo)\n```\n\nDjango 将会在你赋值或添加错误类型的对象时报错。\n\n#### 获取对象\n通过模型中的管理器构造一个查询集，来从你的数据库中获取对象。\n\n查询集表示从数据库中取出来的对象的集合。它可以含有零个、一个或者多个过滤器。过滤器基于所给的参数限制查询的结果。 从SQL 的角度，查询集和SELECT 语句等价，过滤器是像WHERE 和LIMIT 一样的限制子句。\n\n你可以从模型的管理器那里取得查询集。每个模型都至少有一个管理器，它默认命名为objects。通过模型类来直接访问它，像这样：\n\n```\n>>> Blog.objects\n<django.db.models.manager.Manager object at ...>\n>>> b = Blog(name='Foo', tagline='Bar')\n>>> b.objects\nTraceback:\n    ...\nAttributeError: \"Manager isn't accessible via Blog instances.\"\n```\n\n注\n\n管理器只可以通过模型的类访问，而不可以通过模型的实例访问，目的是为了强制区分“表级别”的操作和“记录级别”的操作。\n\n对于一个模型来说，管理器是查询集的主要来源。例如，Blog.objects.all() 返回包含数据库中所有Blog 对象的一个查询集。\n\n#### 获取所有对象\n\n获取一个表中所有对象的最简单的方式是全部获取。可以使用管理器的all() 方法：\n\n```\n>>> all_entries = Entry.objects.all()\n```\n\nall()方法返回包含数据库中所有对象的一个查询集\n\n#### 使用过滤器获取特定对象\n\nall()。但在通常情况下，你往往想要获取的是完整数据集的一个子集。\n\n要创建这样一个子集，你需要在原始的的查询集两个最普遍的途径是：\n\n- `filter(**kwargs)`\n\n  返回一个新的查询集，它包含满足查询参数的对象。\n\n- `exclude(**kwargs)`\n\n  返回一个新的查询集，它包含*不*满足查询参数的对象。\n\n查询参数（上面函数定义中的`**kwargs`）需要满足特定的格式，下面[字段查询]一节中会提到。\n\n举个例子，要获取年份为2006的所有文章的查询集方法：\n\n```\nEntry.objects.filter(pub_date__year=2006)\n```\n\n利用默认的管理器，它相当于：\n\n```\nEntry.objects.all().filter(pub_date__year=2006)\n```\n\n#### 链式过滤\n\n查询集，所以可以将筛选语句链接在一起。像这样：\n\n```\n>>> Entry.objects.filter(\n...     headline__startswith='What'\n... ).exclude(\n...     pub_date__gte=datetime.date.today()\n... ).filter(\n...     pub_date__gte=datetime(2005, 1, 30)\n... )\n```\n\n这个例子最开始获取数据库中所有对象的一个查询集，它包含标题以”What“开头、发布日期在2005年1月30日至当天之间的所有记录。\n\n#### 过滤后的查询集是独立的\n\n每次你筛选一个查询集，它可以被存储及反复使用。\n\n例如：\n\n```\n>>> q1 = Entry.objects.filter(headline__startswith=\"What\")\n>>> q2 = q1.exclude(pub_date__gte=datetime.date.today())\n>>> q3 = q1.filter(pub_date__gte=datetime.date.today())\n```\n\n这三个`查询集`都是独立的。第一个是一个基础的查询集不会受到筛选过程的影响。\n\n#### 查询集是惰性执行的\n\n`查询集` 是惰性执行的 —— 创建查询集 需要*求值*时，Django 才会真正运行这个查询。看下这个例子：\n\n```\n>>> q = Entry.objects.filter(headline__startswith=\"What\")\n>>> q = q.filter(pub_date__lte=datetime.date.today())\n>>> q = q.exclude(body_text__icontains=\"food\")\n>>> print(q)\n```\n\n虽然它看上去有三次数据库访问，但事实上只有在最后一行（`print(q)`）时才访问一次数据库。一般来说，只有在“请求”查询集。\n\n### 通过get 获取一个单一的对象\n\nfilter()将只包含一个元素。\n\n如果你知道只有一个对象满足你的查询，你可以使用管理器 方法，它直接返回该对象：\n\n```\n>>> one_entry = Entry.objects.get(pk=1)\n```\n\n可以对get()。\n\n注意，使用get() 将引发一个`DoesNotExist` 异常。这个异常是正在查询的模型类的一个属性 —— 所以在上面的代码中，如果没有主键为1 的`Entry` 对象，Django 将引发一个`Entry.DoesNotExist`。\n\n类似地，如果有多条记录满足get()，它同样是模型类自身的一个属性。\n\n### 其它查询集方法\n\n大多数情况下，需要从数据库中查找对象时，你会使用all()。\n\n### 限制查询集\n\n可以使用Python 的切片语法来限制查询集记录的数目 。它等同于SQL 的`LIMIT` 和`OFFSET` 子句。\n\n例如，下面的语句返回前面5 个对象(`LIMIT 5`)：\n\n```\n>>> Entry.objects.all()[:5]\n```\n\n下面这条语句返回第6 至第10 个对象(`OFFSET 5 LIMIT 5`)：\n\n```\n>>> Entry.objects.all()[5:10]\n```\n\n不支持负的索引（例如`Entry.objects.all()[-1]`）。\n\n通常，查询集 —— 它不会执行查询。有一个例外，是如果你使用Python 切片语法中\"step\"参数。例如，下面的语句将返回前10 个对象中每隔*2*个对象，它将真实执行查询：\n\n```\n>>> Entry.objects.all()[:10:2]\n```\n\n若要获取一个*单一*的对象而不是一个列表（例如，`SELECT foo FROM bar LIMIT 1`），可以简单地使用一个索引而不是切片。例如，下面的语句返回数据库中根据标题排序后的第一条`Entry`：\n\n```\n>>> Entry.objects.order_by('headline')[0]\n```\n\n它大体等同于：\n\n```\n>>> Entry.objects.order_by('headline')[0:1].get()\n```\n\n然而请注意，如果没有对象满足给定的条件，第一条语句将引发`IndexError`而第二条语句将引发`DoesNotExist`。 更多细节参见get()。\n\n### 字段查询\n\n字段查询是指如何指定SQL `WHERE` 子句的内容。它们通过查询集 的关键字参数指定。\n\n查询的关键字参数的基本形式是`field__lookuptype=value`。（中间是两个下划线）。例如：\n\n```\n>>> Entry.objects.filter(pub_date__lte='2006-01-01')\n```\n\n翻译成SQL（大体）是：\n\n```\nSELECT * FROM blog_entry WHERE pub_date <= '2006-01-01';\n```\n\n这是如何实现的\n\nPython 定义的函数可以接收任意的键/值对参数，这些名称和参数可以在运行时求值。更多信息，参见Python 官方文档中的[关键字参数](https://docs.python.org/tutorial/controlflow.html#keyword-arguments)。\n\n查询条件中指定的字段必须是模型字段的名称。但有一个例外，对于ForeignKey你可以使用字段名加上`_id` 后缀。在这种情况下，该参数的值应该是外键的原始值。例如：\n\n```\n>>> Entry.objects.filter(blog_id=4)\n```\n\n如果你传递的是一个不合法的参数，查询函数将引发 `TypeError`。\n\n这些数据库API 支持大约二十多种查询的类型；在[*字段查询参考*] 中可以找到完整的参考。为了让你尝尝鲜，下面是一些你可能用到的常见查询：\n\n- exact\n\n  “精确”匹配。例如：`>>> Entry.objects.get(headline__exact=\"Man bites dog\")`将生成下面的SQL：`SELECT ... WHERE headline = 'Man bites dog';`如果你没有提供查询类型 —— 即如果你的关键字参数不包含双下划线 —— 默认假定查询类型是`exact`。例如，下面的两条语句相等：`>>> Blog.objects.get(id__exact=14)  # Explicit form>>> Blog.objects.get(id=14)         # __exact is implied`这是为了方便，因为`exact` 查询是最常见的情况。\n\n- iexact\n\n  大小写不敏感的匹配。所以，查询：`>>> Blog.objects.get(name__iexact=\"beatles blog\")`将匹配标题为`\"Beatles Blog\"`、`\"beatles blog\"` 甚至`\"BeAtlES blOG\"` 的`Blog`。\n\n- contains\n\n  大小写敏感的包含关系测试。例如：`Entry.objects.get(headline__contains='Lennon')`大体可以翻译成下面的SQL：`SELECT ... WHERE headline LIKE '%Lennon%';`注意，这将匹配`'Today Lennon honored'` 但不能匹配`'today lennon honored'`。还有一个大小写不敏感的版本，icontains。\n\n- startswith\n\n  分别表示以XXX开头和以XXX结尾。当然还有大小写不敏感的版本，叫做istartswith。\n\n同样，这里只是表面。完整的参考可以在[*字段查询参考*]中找到。\n\n### 跨关联关系的查询\n\nDjango 提供一种强大而又直观的方式来“处理”查询中的关联关系，它在后台自动帮你处理`JOIN`。 若要跨越关联关系，只需使用关联的模型字段的名称，并使用双下划线分隔，直至你想要的字段：\n\n下面这个例子获取所有`Blog` 的`name` 为`'Beatles Blog'` 的`Entry` 对象：\n\n```\n>>> Entry.objects.filter(blog__name='Beatles Blog')\n```\n\n这种跨越可以是任意的深度。\n\n它还可以反向工作。若要引用一个“反向”的关系，只需要使用该模型的小写的名称。\n\n下面的示例获取所有的`Blog` 对象，它们至少有一个`Entry` 的`headline` 包含`'Lennon'`：\n\n```\n>>> Blog.objects.filter(entry__headline__contains='Lennon')\n```\n\n如果你在多个关联关系直接过滤而且其中某个中介模型没有满足过滤条件的值，Django 将把它当做一个空的（所有的值都为`NULL`）但是合法的对象。这意味着不会有错误引发。例如，在下面的过滤器中：\n\n```\nBlog.objects.filter(entry__authors__name='Lennon')\n```\n\n（如果有一个相关联的`Author` 模型），如果Entry 中没有找到对应的`author`，那么它将当作其没有`name`，而不会因为没有`author` 引发一个错误。通常，这就是你想要的。唯一可能让你困惑的是当你使用isnull 的时候。因此：\n\n```\nBlog.objects.filter(entry__authors__name__isnull=True)\n```\n\n返回的`Blog` 对象包括`author` __`name` 为空的Blog对象,以及author__name不为空但author__name关联的`entry` __`author` 为空的对象。如果你不需要后者，你可以这样写：\n\n```\nBlog.objects.filter(entry__authors__isnull=False,\n        entry__authors__name__isnull=True)\n```\n\n#### 跨越多值的关联关系\n\n当你基于ManyToManyField 来过滤一个对象时，有两种不同种类的过滤器。考虑`Blog`/`Entry` 关联关系（`Blog` 和 `Entry` 是一对多的关系）。我们可能想找出headline为*“Lennon”* 并且pub_date为'2008'年的Entry。或者我们可能想查询headline为*“Lennon”* 的Entry或者pub_date为'2008'的Entry。因为实际上有和单个`Blog` 相关联的多个Entry，所以这两个查询在某些场景下都是有可能并有意义的。\n\nManyToManyField 叫做 `tags`，我们可能想找到tag 叫做*“music”* 和*“bands”* 的Entry，或者我们想找一个tag 名为*“music”* 且状态为*“public”*的Entry。\n\n对于这两种情况，Django 有种一致的方法来处理filter() 调用选择出来的对象。\n\n这些听起来可能有点混乱，所以希望展示一个例子使它变得更清晰。选择所有包含同时满足两个条件的entry的blog，这两个条件是headline 包含*Lennon* 和发表时间是2008 （同一个entry 满足两个条件），我们的代码是：\n\n```\nBlog.objects.filter(entry__headline__contains='Lennon',\n        entry__pub_date__year=2008)\n```\n\n从所有的blog模型实例中选择满足以下条件的blog实例：blog的enrty的headline属性值是*“Lennon”***，或者entry的**发表时间是2008（两个条件至少满足一个，也可以同时满足），我们的代码是：\n\n```\nBlog.objects.filter(entry__headline__contains='Lennon').filter(\n        entry__pub_date__year=2008)\n```\n\n假设这里有一个blog拥有一条包含*'Lennon'*的entries条目和一条来自2008的entries条目,但是没有一条来自2008并且包含*\"Lennon\"*的entries条目。第一个查询不会返回任何blog，第二个查询将会返回一个blog。\n\n在第二个例子中， 第一个filter 限定查询集中的blog 与headline 包含*“Lennon”* 的entry 关联。第二个filter *又* 限定查询集中的blog ，这些blog关联的entry 的发表时间是2008。（译者注：难点在如何理解further这个词！）第二个filter 过滤出来的entry 与第一个filter 过滤出来的entry 可能相同也可能不同。每个filter 语句过滤的是`Blog`，而不是`Entry`。\n\n注\n\n跨越多值关系的filter() 调用中的条件不必引用同一个记录。\n\n例如，下面的查询排除**headline 中包含*“Lennon”*的Entry*和*在2008 年发布的Entry：\n\n```\nBlog.objects.exclude(\n    entry__headline__contains='Lennon',\n    entry__pub_date__year=2008,\n)\n```\n\n然而，这与使用filter() 的行为不同，它不是排除同时满足两个条件的Entry。为了实现这点，即选择的Blog中不包含在2008年发布且healine 中带有*“Lennon”* 的Entry，你需要编写两个查询：\n\n```\nBlog.objects.exclude(\n    entry=Entry.objects.filter(\n        headline__contains='Lennon',\n        pub_date__year=2008,\n    ),\n)\n\n```\n\n### Filter 可以引用模型的字段\n\n到目前为止给出的示例中，我们构造过将模型字段与常量进行比较的filter。但是，如果你想将模型的一个字段与同一个模型的另外一个字段进行比较该怎么办？\n\nDjango 提供F 表达式` 返回的实例用作查询内部对模型字段的引用。这些引用可以用于查询的filter 中来比较相同模型实例上不同字段之间值的比较。\n\n例如，为了查找comments 数目多于pingbacks 的Entry，我们将构造一个`F()` 对象来引用pingback 数目，并在查询中使用该`F()` 对象：\n\n```\n>>> from django.db.models import F\n>>> Entry.objects.filter(n_comments__gt=F('n_pingbacks'))\n\n```\n\nDjango 支持对`F()` 对象使用加法、减法、乘法、除法、取模以及幂计算等算术操作，两个操作数可以都是常数和其它`F()` 对象。为了查找comments 数目比pingbacks *两倍*还要多的Entry，我们将查询修改为：\n\n```\n>>> Entry.objects.filter(n_comments__gt=F('n_pingbacks') * 2)\n\n```\n\nNew in Django 1.7:\n\n添加 `**` 操作符。\n\n为了查询rating 比pingback 和comment 数目总和要小的Entry，我们将这样查询：\n\n```\n>>> Entry.objects.filter(rating__lt=F('n_comments') + F('n_pingbacks'))\n\n```\n\n你还可以在`F()` 对象中使用双下划线标记来跨越关联关系。带有双下划线的`F()` 对象将引入任何需要的join 操作以访问关联的对象。例如，如要获取author 的名字与blog 名字相同的Entry，我们可以这样查询：\n\n```\n>>> Entry.objects.filter(authors__name=F('blog__name'))\n\n```\n\n对于date 和date/time 字段，你可以给它们加上或减去一个timedelta(https://docs.python.org/3/library/datetime.html#datetime.timedelta) 对象。下面的例子将返回发布超过3天后被修改的所有Entry：\n\n```\n>>> from datetime import timedelta\n>>> Entry.objects.filter(mod_date__gt=F('pub_date') + timedelta(days=3))\n\n```\n\n`F()` 对象支持`.bitand()` 和`.bitor()` 两种位操作，例如：\n\n```\n>>> F('somefield').bitand(16)\n\n```\n\n### 查询的快捷方式pk\n\n为了方便，Django 提供一个查询快捷方式`pk` ，它表示“primary key” 的意思。\n\n在`Blog` 模型示例中，主键是`id` 字段，所以下面三条语句是等同的：\n\n```\n>>> Blog.objects.get(id__exact=14) # Explicit form\n>>> Blog.objects.get(id=14) # __exact is implied\n>>> Blog.objects.get(pk=14) # pk implies id__exact\n\n```\n\n`pk` 的使用不仅限于`__exact` 查询 —— 任何查询类型都可以与`pk` 结合来完成一个模型上对主键的查询：\n\n```\n# Get blogs entries with id 1, 4 and 7\n>>> Blog.objects.filter(pk__in=[1,4,7])\n\n# Get all blog entries with id > 14\n>>> Blog.objects.filter(pk__gt=14)\n\n```\n\n`pk`查询在join 中也可以工作。例如，下面三个语句是等同的：\n\n```\n>>> Entry.objects.filter(blog__id__exact=3) # Explicit form\n>>> Entry.objects.filter(blog__id=3)        # __exact is implied\n>>> Entry.objects.filter(blog__pk=3)        # __pk implies __id__exact\n\n```\n\n### 转义LIKE 语句中的百分号和下划线\n\n与`LIKE` SQL 语句等同的字段查询（`iexact`、 `contains`、`icontains`、`startswith`、 `istartswith`、`endswith` 和`iendswith`）将自动转义在`LIKE` 语句中使用的两个特殊的字符 —— 百分号和下划线。（在`LIKE` 语句中，百分号通配符表示多个字符，下划线通配符表示单个字符）。\n\n这意味着语句将很直观，不会显得太抽象。例如，要获取包含一个百分号的所有的Entry，只需要像其它任何字符一样使用百分号：\n\n```\n>>> Entry.objects.filter(headline__contains='%')\n\n```\n\nDjango 会帮你转义；生成的SQL 看上去会是这样：\n\n```\nSELECT ... WHERE headline LIKE '%\\%%';\n\n```\n\n对于下划线是同样的道理。百分号和下划线都会透明地帮你处理。\n\n### 缓存和查询集\n\n每个查询集都包含一个缓存来最小化对数据库的访问。理解它是如何工作的将让你编写最高效的代码。\n\n在一个新创建的查询集 的求值将重用缓存的结果。\n\n请牢记这个缓存行为，因为对查询集，对它们求值，然后扔掉它们：\n\n```\n>>> print([e.headline for e in Entry.objects.all()])\n>>> print([e.pub_date for e in Entry.objects.all()])\n\n```\n\n这意味着相同的数据库查询将执行两次，显然倍增了你的数据库负载。同时，还有可能两个结果列表并不包含相同的数据库记录，因为在两次请求期间有可能有`Entry`被添加进来或删除掉。\n\n为了避免这个问题，只需保存查询集并重新使用它：\n\n```\n>>> queryset = Entry.objects.all()\n>>> print([p.headline for p in queryset]) # Evaluate the query set.\n>>> print([p.pub_date for p in queryset]) # Re-use the cache from the evaluation.\n\n```\n\n#### 何时查询集不会被缓存\n\n查询集不会永远缓存它们的结果。当只对查询集的*部分*进行求值时会检查缓存， 但是如果这个部分不在缓存中，那么接下来查询返回的记录都将不会被缓存。特别地，这意味着使用切片或索引来[*限制查询集*]将不会填充缓存。\n\n例如，重复获取查询集对象中一个特定的索引将每次都查询数据库：\n\n```\n>>> queryset = Entry.objects.all()\n>>> print queryset[5] # Queries the database\n>>> print queryset[5] # Queries the database again\n\n```\n\n然而，如果已经对全部查询集求值过，则将检查缓存：\n\n```\n>>> queryset = Entry.objects.all()\n>>> [entry for entry in queryset] # Queries the database\n>>> print queryset[5] # Uses cache\n>>> print queryset[5] # Uses cache\n\n```\n\n下面是一些其它例子，它们会使得全部的查询集被求值并填充到缓存中：\n\n```\n>>> [entry for entry in queryset]\n>>> bool(queryset)\n>>> entry in queryset\n>>> list(queryset)\n\n```\n\n注\n\n简单地打印查询集不会填充缓存。因为`__repr__()` 调用只返回全部查询集的一个切片。\n\n## 使用Q 对象进行复杂的查询\n\nfilter()。\n\nQ 对象 对象用于封装一组关键字参数。这些关键字参数就是上文“字段查询” 中所提及的那些。\n\n例如，下面的`Q` 对象封装一个`LIKE` 查询：\n\n```\nfrom django.db.models import Q\nQ(question__startswith='What')\n\n```\n\n`Q` 对象可以使用`&` 和`|` 操作符组合起来。当一个操作符在两个`Q` 对象上使用时，它产生一个新的`Q` 对象。\n\n例如，下面的语句产生一个`Q` 对象，表示两个`\"question__startswith\"` 查询的“OR” ：\n\n```\nQ(question__startswith='Who') | Q(question__startswith='What')\n\n```\n\n它等同于下面的SQL `WHERE` 子句：\n\n```\nWHERE question LIKE 'Who%' OR question LIKE 'What%'\n\n```\n\n你可以组合`&` 和`|`  操作符以及使用括号进行分组来编写任意复杂的`Q` 对象。同时，`Q` 对象可以使用`~` 操作符取反，这允许组合正常的查询和取反(`NOT`) 查询：\n\n```\nQ(question__startswith='Who') | ~Q(pub_date__year=2005)\n\n```\n\n每个接受关键字参数的查询函数（例如filter()）都可以传递一个或多个`Q` 对象作为位置（不带名的）参数。如果一个查询函数有多个`Q` 对象参数，这些参数的逻辑关系为“AND\"。例如：\n\n```\nPoll.objects.get(\n    Q(question__startswith='Who'),\n    Q(pub_date=date(2005, 5, 2)) | Q(pub_date=date(2005, 5, 6))\n)\n\n```\n\n... 大体上可以翻译成这个SQL：\n\n```\nSELECT * from polls WHERE question LIKE 'Who%'\n    AND (pub_date = '2005-05-02' OR pub_date = '2005-05-06')\n\n```\n\n查询函数可以混合使用`Q 对象`和关键字参数。所有提供给查询函数的参数（关键字参数或`Q` 对象）都将\"AND”在一起。但是，如果出现`Q` 对象，它必须位于所有关键字参数的前面。例如：\n\n```\nPoll.objects.get(\n    Q(pub_date=date(2005, 5, 2)) | Q(pub_date=date(2005, 5, 6)),\n    question__startswith='Who')\n\n```\n\n... 是一个合法的查询，等同于前面的例子；但是：\n\n```\n# INVALID QUERY\nPoll.objects.get(\n    question__startswith='Who',\n    Q(pub_date=date(2005, 5, 2)) | Q(pub_date=date(2005, 5, 6)))\n\n```\n\n... 是不合法的。\n\n另见\n\nDjango 单元测试中的[OR 查询示例](https://github.com/django/django/blob/master/tests/or_lookups/tests.py)演示了几种`Q` 的用法。\n\n## 比较对象\n\n为了比较两个模型实例，只需要使用标准的Python 比较操作符，即双等于符号：`==`。在后台，它会比较两个模型主键的值。\n\n利用上面的`Entry` 示例，下面两个语句是等同的：\n\n```\n>>> some_entry == other_entry\n>>> some_entry.id == other_entry.id\n\n```\n\n如果模型的主键不叫`id`，也没有问题。比较将始终使用主键，无论它叫什么。例如，如果模型的主键字段叫做`name`，下面的两条语句是等同的：\n\n```\n>>> some_obj == other_obj\n>>> some_obj.name == other_obj.name\n\n```\n\n## 删除对象\n\n删除方法，为了方便，就取名为delete()。这个方法将立即删除对象且没有返回值。例如：\n\n```\ne.delete()\n\n```\n\n你还可以批量删除对象。每个查询集中的所有成员。\n\n例如，下面的语句删除`pub_date` 为2005 的所有`Entry` 对象：\n\n```\nEntry.objects.filter(pub_date__year=2005).delete()\n\n```\n\n记住，这将尽可能地使用纯SQL 执行，所以这个过程中不需要调用每个对象实例的`delete()`方法。如果你给模型类提供了一个自定义的`delete()` 方法并希望确保它被调用，你需要手工删除该模型的实例（例如，迭代查询集 方法。\n\n当Django 删除一个对象时，它默认使用SQL `ON DELETE CASCADE` 约束 —— 换句话讲，任何有外键指向要删除对象的对象将一起删除。例如：\n\n```\nb = Blog.objects.get(pk=1)\n# This will delete the Blog and all of its Entry objects.\nb.delete()\n\n```\n\n这种级联的行为可以通过的ForeignKey 参数自定义。\n\n注意，delete()`，而删除*所有* 的条目。如果你*确实*想删除所有的对象，你必须明确地请求一个完全的查询集：\n\n```\nEntry.objects.all().delete()\n\n```\n\n## 拷贝模型实例\n\n虽然没有内建的方法用于拷贝模型实例，但还是很容易创建一个新的实例并让它的所有字段都拷贝过来。最简单的方法是，只需要将`pk` 设置为`None`。利用我们的Blog 示例：\n\n```\nblog = Blog(name='My blog', tagline='Blogging is easy')\nblog.save() # blog.pk == 1\n\nblog.pk = None\nblog.save() # blog.pk == 2\n\n```\n\n如果你用继承，那么会复杂一些。考虑下面`Blog` 的子类：\n\n```\nclass ThemeBlog(Blog):\n    theme = models.CharField(max_length=200)\n\ndjango_blog = ThemeBlog(name='Django', tagline='Django is easy', theme='python')\ndjango_blog.save() # django_blog.pk == 3\n\n```\n\n由于继承的工作方式，你必须设置`pk` 和 `id` 都为None：\n\n```\ndjango_blog.pk = None\ndjango_blog.id = None\ndjango_blog.save() # django_blog.pk == 4\n\n```\n\n这个过程不会拷贝关联的对象。如果你想拷贝关联关系，你必须编写一些更多的代码。在我们的例子中，`Entry` 有一个到`Author` 的多对多字段：\n\n```\nentry = Entry.objects.all()[0] # some previous entry\nold_authors = entry.authors.all()\nentry.pk = None\nentry.save()\nentry.authors = old_authors # saves new many2many relations\n\n```\n\n## 一次更新多个对象\n\n有时你想为一个查询集 方法。例如：\n\n```\n# Update all the headlines with pub_date in 2007.\nEntry.objects.filter(pub_date__year=2007).update(headline='Everything is the same')\n\n```\n\n你只可以对非关联字段和ForeignKey 字段，需设置新的值为你想指向的新的模型实例。例如：\n\n```\n>>> b = Blog.objects.get(pk=1)\n\n# Change every Entry so that it belongs to this Blog.\n>>> Entry.objects.all().update(blog=b)\n\n```\n\n`update()` 方法会立即执行并返回查询匹配的行数（如果有些行已经具有新的值，返回的行数可能和被更新的行数不相等）。更新查询集 唯一的限制是它只能访问一个数据库表，也就是模型的主表。你可以根据关联的字段过滤，但是你只能更新模型主表中的列。例如：\n\n```\n>>> b = Blog.objects.get(pk=1)\n\n# Update all the headlines belonging to this Blog.\n>>> Entry.objects.select_related().filter(blog=b).update(headline='Everything is the same')\n\n```\n\n要注意`update()` 方法会直接转换成一个SQL 语句。它是一个批量的直接更新操作。它不会运行模型的save()：\n\n```\nfor item in my_queryset:\n    item.save()\n\n```\n\n对update 的调用也可以使用F 表达式 来根据模型中的一个字段更新另外一个字段。这对于在当前值的基础上加上一个值特别有用。例如，增加Blog 中每个Entry 的pingback 个数：\n\n```\n>>> Entry.objects.all().update(n_pingbacks=F('n_pingbacks') + 1)\n\n```\n\n然而，与filter 和exclude 子句中的`F()` 对象不同，在update 中你不可以使用`F()` 对象引入join —— 你只可以引用正在更新的模型的字段。如果你尝试使用`F()` 对象引入一个join，将引发一个`FieldError`：\n\n```\n# THIS WILL RAISE A FieldError\n>>> Entry.objects.update(headline=F('blog__name'))\n\n```\n\n## 关联的对象\n\n当你在一个模型中定义一个关联关系时（例如，ForeignKey），该模型的实例将带有一个方便的API 来访问关联的对象。\n\n利用本页顶部的模型，一个`Entry` 对象`e` 可以通过`blog` 属性`e.blog` 获取关联的`Blog` 对象。\n\n（在幕后，这个功能是通过Python 的[描述器]实现的。这应该不会对你有什么真正的影响，但是这里我们指出它以满足你的好奇）。\n\nDjango 还会创建API 用于访问关联关系的另一头 —— 从关联的模型访问定义关联关系的模型。例如，`Blog` 对象`b` 可以通过`entry_set` 属性 `b.entry_set.all()`访问与它关联的所有`Entry` 对象。\n\n这一节中的所有示例都将使用本页顶部定义的`Blog`、 `Author` 和`Entry` 模型。\n\n### 一对多关系\n\n#### 前向查询\n\n如果一个模型具有ForeignKey，那么该模型的实例将可以通过属性访问关联的（外部）对象。\n\n例如：\n\n```\n>>> e = Entry.objects.get(id=2)\n>>> e.blog # Returns the related Blog object.\n\n```\n\n你可以通过外键属性获取和设置。和你预期的一样，对外键的修改不会保存到数据库中直至你调用save()。例如：\n\n```\n>>> e = Entry.objects.get(id=2)\n>>> e.blog = some_blog\n>>> e.save()\n\n```\n\n如果ForeignKey 字段有`null=True` 设置（即它允许`NULL` 值），你可以分配`None` 来删除对应的关联性。例如：\n\n```\n>>> e = Entry.objects.get(id=2)\n>>> e.blog = None\n>>> e.save() # \"UPDATE blog_entry SET blog_id = NULL ...;\"\n\n```\n\n一对多关联关系的前向访问在第一次访问关联的对象时被缓存。以后对同一个对象的外键的访问都使用缓存。例如：\n\n```\n>>> e = Entry.objects.get(id=2)\n>>> print(e.blog)  # Hits the database to retrieve the associated Blog.\n>>> print(e.blog)  # Doesn't hit the database; uses cached version.\n\n```\n\n注意select_related()方法递归地预填充所有的一对多关系到缓存中。例如：\n\n```\n>>> e = Entry.objects.select_related().get(id=2)\n>>> print(e.blog)  # Doesn't hit the database; uses cached version.\n>>> print(e.blog)  # Doesn't hit the database; uses cached version.\n\n```\n\n#### 反向查询\n\n如果模型I有一个ForeignKey返回的`查询集`可以用上一节提到的方式进行过滤和操作。\n\n例如：\n\n```\n>>> b = Blog.objects.get(id=1)\n>>> b.entry_set.all() # Returns all Entry objects related to Blog.\n\n# b.entry_set is a Manager that returns QuerySets.\n>>> b.entry_set.filter(headline__contains='Lennon')\n>>> b.entry_set.count()\n\n```\n\n你可以在ForeignKey`，那么上面的示例代码应该改成这样：\n\n```\n>>> b = Blog.objects.get(id=1)\n>>> b.entries.all() # Returns all Entry objects related to Blog.\n\n# b.entries is a Manager that returns QuerySets.\n>>> b.entries.filter(headline__contains='Lennon')\n>>> b.entries.count()\n\n```\n\n#### 使用自定义的反向管理器\n\nNew in Django 1.7.\n\n默认情况下，用于反向关联关系的RelatedManager 的子类。如果你想为一个查询指定一个不同的管理器，你可以使用下面的语法：\n\n```\nfrom django.db import models\n\nclass Entry(models.Model):\n    #...\n    objects = models.Manager()  # Default Manager\n    entries = EntryManager()    # Custom Manager\n\nb = Blog.objects.get(id=1)\nb.entry_set(manager='entries').all()\n\n```\n\n如果`EntryManager` 在它的`get_queryset()` 方法中使用默认的过滤，那么该过滤将适用于`all()` 调用。\n\n当然，指定一个自定义的管理器还可以让你调用自定义的方法：\n\n```\nb.entry_set(manager='entries').is_published()\n\n```\n\n#### 处理关联对象的其它方法\n\n除了在上面”获取对象“一节中定义的查询集 中找到。\n\n- `add(obj1, obj2, ...)`\n\n  添加一指定的模型对象到关联的对象集中。\n\n- `create(**kwargs)`\n\n  创建一个新的对象，将它保存并放在关联的对象集中。返回新创建的对象。\n\n- `remove(obj1, obj2, ...)`\n\n  从关联的对象集中删除指定的模型对象。\n\n- `clear()`\n\n  从关联的对象集中删除所有的对象。\n\n若要一次性给关联的对象集赋值，只需要给它赋值一个可迭代的对象。这个可迭代的对象可以包含对象的实例，或者一个主键值的列表。例如：\n\n```\nb = Blog.objects.get(id=1)\nb.entry_set = [e1, e2]\n\n```\n\n在这个例子中，`e1` 和`e2` 可以是Entry 实例，也可以是主键的整数值。\n\n如果有`clear()` 方法，那么在将可迭代对象中的成员添加到集合中之前，将从`entry_set` 中删除所有已经存在的对象。如果*没有*`clear()` 方法，那么将直接添加可迭代对象中的成员而不会删除所有已存在的对象。\n\n这一节中提到的每个”反向“操作都会立即对数据库产生作用。每个添加、创建和删除操作都会立即并自动保存到数据库中。\n\n### 多对多关系\n\n多对多关系的两端都会自动获得访问另一端的API。这些API 的工作方式与上面提到的“方向”一对多关系一样。\n\n唯一的区别在于属性的名称：定义 ManyToManyField 的模型使用该字段的属性名称，而“反向”模型使用源模型的小写名称加上`'_set'` （和一对多关系一样）。\n\n一个例子可以让它更好理解：\n\n```\ne = Entry.objects.get(id=3)\ne.authors.all() # Returns all Author objects for this Entry.\ne.authors.count()\ne.authors.filter(name__contains='John')\n\na = Author.objects.get(id=5)\na.entry_set.all() # Returns all Entry objects for this Author.\n\n```\n\n类似ForeignKey 指定`related_name='entries'`，那么`Author` 实例将使用 `entries` 属性而不是`entry_set`。\n\n### 一对一关系\n\n一对一关系与多对一关系非常相似。如果你在模型中定义一个OneToOneField，该模型的实例将可以通过该模型的一个简单属性访问关联的模型。\n\n例如：\n\n```\nclass EntryDetail(models.Model):\n    entry = models.OneToOneField(Entry)\n    details = models.TextField()\n\ned = EntryDetail.objects.get(id=2)\ned.entry # Returns the related Entry object.\n\n```\n\n在“反向”查询中有所不同。一对一关系中的关联模型同样具有一个管理器表示一个单一的对象而不是对象的集合：\n\n```\ne = Entry.objects.get(id=2)\ne.entrydetail # returns the related EntryDetail object\n\n```\n\n如果没有对象赋值给这个关联关系，Django 将引发一个`DoesNotExist` 异常。\n\n实例可以赋值给反向的关联关系，方法和正向的关联关系一样：\n\n```\ne.entrydetail = ed\n\n```\n\n### 反向的关联关系是如何实现的？\n\n其它对象关系映射要求你在关联关系的两端都要定义。Django 的开发人员相信这是对DRY（不要重复你自己的代码）原则的违背，所以Django 只要求你在一端定义关联关系。\n\n但是这怎么可能？因为一个模型类直到其它模型类被加载之后才知道哪些模型类是关联的。\n\n答案在app registry 中列出的每个应用，然后导入每个应用中的`models`模块。每创建一个新的模型时，Django 添加反向的关系到所有关联的模型。如果关联的模型还没有导入，Django 将保存关联关系的记录并在最终关联的模型导入时添加这些关联关系。\n\n由于这个原因，你使用的所有模型都定义在INSTALLED_APPS 列出的应用中就显得特别重要。否则，反向的关联关系将不能正确工作。\n\n### 通过关联的对象进行查询\n\n在关联对象字段上的查询与正常字段的查询遵循同样的规则。当你指定查询需要匹配的一个值时，你可以使用一个对象实例或者对象的主键的值。\n\n例如，如果你有一个`id=5` 的Blog 对象`b`，下面的三个查询将是完全一样的：\n\n```\nEntry.objects.filter(blog=b) # Query using object instance\nEntry.objects.filter(blog=b.id) # Query using id from instance\nEntry.objects.filter(blog=5) # Query using id directly\n\n```\n\n## 回归到原始的 SQL\n\n如果你发现需要编写的SQL 查询对于Django 的数据库映射机制太复杂，你可以回归到手工编写SQL。Django 对于编写原始的SQL 查询有多个选项；参见[*执行原始的SQL 查询*]。\n\n最后，值得注意的是Django 的数据库层只是数据库的一个接口。你可以利用其它工具、编程语言或数据库框架来访问数据库；对于数据库，Django 没有什么特别的地方。","slug":"DjangoQuery","published":1,"updated":"2017-12-04T07:27:28.745Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjeqig1kg000vlgqa83680iuv","content":"<h1 id=\"执行查询\"><a href=\"#执行查询\" class=\"headerlink\" title=\"执行查询\"></a>执行查询</h1><p>一旦你建立好数据模型，Django 会自动为你生成一套数据库抽象的API，可以让你创建、检索、更新和删除对象。这篇文档阐述如何使用这些API。 关于模型查询所有选项的完整细节，请见数据模型参考。</p>\n<a id=\"more\"></a>\n<p>在整个文档（以及参考）中，我们将引用下面的模型，它构成一个博客应用：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">from django.db import models</span><br><span class=\"line\"></span><br><span class=\"line\">class Blog(models.Model):</span><br><span class=\"line\">    name = models.CharField(max_length=100)</span><br><span class=\"line\">    tagline = models.TextField()</span><br><span class=\"line\"></span><br><span class=\"line\">    def __str__(self):              # __unicode__ on Python 2</span><br><span class=\"line\">        return self.name</span><br><span class=\"line\"></span><br><span class=\"line\">class Author(models.Model):</span><br><span class=\"line\">    name = models.CharField(max_length=50)</span><br><span class=\"line\">    email = models.EmailField()</span><br><span class=\"line\"></span><br><span class=\"line\">    def __str__(self):              # __unicode__ on Python 2</span><br><span class=\"line\">        return self.name</span><br><span class=\"line\"></span><br><span class=\"line\">class Entry(models.Model):</span><br><span class=\"line\">    blog = models.ForeignKey(Blog)</span><br><span class=\"line\">    headline = models.CharField(max_length=255)</span><br><span class=\"line\">    body_text = models.TextField()</span><br><span class=\"line\">    pub_date = models.DateField()</span><br><span class=\"line\">    mod_date = models.DateField()</span><br><span class=\"line\">    authors = models.ManyToManyField(Author)</span><br><span class=\"line\">    n_comments = models.IntegerField()</span><br><span class=\"line\">    n_pingbacks = models.IntegerField()</span><br><span class=\"line\">    rating = models.IntegerField()</span><br><span class=\"line\"></span><br><span class=\"line\">    def __str__(self):              # __unicode__ on Python 2</span><br><span class=\"line\">        return self.headline</span><br></pre></td></tr></table></figure>\n<p>####创建对象</p>\n<p>Django 使用一种直观的方式把数据库表中的数据表示成Python 对象：一个模型类代表数据库中的一个表，一个模型类的实例代表这个数据库表中的一条特定的记录。</p>\n<p>使用关键字参数实例化模型实例来创建一个对象，然后调用save() 把它保存到数据库中。</p>\n<p>假设模型存放于文件mysite/blog/models.py中，下面是一个例子：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; from blog.models import Blog</span><br><span class=\"line\">&gt;&gt;&gt; b = Blog(name=&apos;Beatles Blog&apos;, tagline=&apos;All the latest Beatles news.&apos;)</span><br><span class=\"line\">&gt;&gt;&gt; b.save()</span><br></pre></td></tr></table></figure>\n<p>上面的代码在背后执行了SQL 的INSERT 语句。在你显式调用save()之前，Django 不会访问数据库。</p>\n<p>save() 方法没有返回值。</p>\n<p>请参见</p>\n<p>save()方法带有一些高级选项，它们没有在这里给出。完整的细节请见save() 文档。</p>\n<p>如果你想只用一条语句创建并保存一个对象，使用create()方法。</p>\n<h4 id=\"保存对象的改动\"><a href=\"#保存对象的改动\" class=\"headerlink\" title=\"保存对象的改动\"></a>保存对象的改动</h4><p>要保存对数据库中已存在的对象的改动，请使用save()。</p>\n<p>假设Blog 的一个实例b5 已经被保存在数据库中，下面这个例子将更改它的name 并且更新数据库中的记录：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; b5.name = &apos;New name&apos;</span><br><span class=\"line\">&gt;&gt;&gt; b5.save()</span><br></pre></td></tr></table></figure>\n<p>上面的代码在背后执行SQL 的UPDATE语句。在你显式调用save()之前，Django不会访问数据库。</p>\n<h4 id=\"保存ForeignKey和ManyToManyField字段\"><a href=\"#保存ForeignKey和ManyToManyField字段\" class=\"headerlink\" title=\"保存ForeignKey和ManyToManyField字段\"></a>保存ForeignKey和ManyToManyField字段</h4><p>更新ForeignKey 字段的方式和保存普通字段相同 —— 只要把一个正确类型的对象赋值给该字段。下面的例子更新了Entry类的实例entry 的blog 属性，假设Entry 和Blog 分别已经有一个正确的实例保存在数据库中（所以我们可以像下面这样获取它们）：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; from blog.models import Entry</span><br><span class=\"line\">&gt;&gt;&gt; entry = Entry.objects.get(pk=1)</span><br><span class=\"line\">&gt;&gt;&gt; cheese_blog = Blog.objects.get(name=&quot;Cheddar Talk&quot;)</span><br><span class=\"line\">&gt;&gt;&gt; entry.blog = cheese_blog</span><br><span class=\"line\">&gt;&gt;&gt; entry.save()</span><br></pre></td></tr></table></figure>\n<p>更新ManyToManyField 的方式有一些不同 —— 需要使用字段的add()方法来增加关联关系的一条记录。下面这个例子向entry 对象添加Author 类的实例joe：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; from blog.models import Author</span><br><span class=\"line\">&gt;&gt;&gt; joe = Author.objects.create(name=&quot;Joe&quot;)</span><br><span class=\"line\">&gt;&gt;&gt; entry.authors.add(joe)</span><br></pre></td></tr></table></figure>\n<p>为了在一条语句中，向ManyToManyField添加多条记录，可以在调用add()方法时传入多个参数，像这样：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; john = Author.objects.create(name=&quot;John&quot;)</span><br><span class=\"line\">&gt;&gt;&gt; paul = Author.objects.create(name=&quot;Paul&quot;)</span><br><span class=\"line\">&gt;&gt;&gt; george = Author.objects.create(name=&quot;George&quot;)</span><br><span class=\"line\">&gt;&gt;&gt; ringo = Author.objects.create(name=&quot;Ringo&quot;)</span><br><span class=\"line\">&gt;&gt;&gt; entry.authors.add(john, paul, george, ringo)</span><br></pre></td></tr></table></figure>\n<p>Django 将会在你赋值或添加错误类型的对象时报错。</p>\n<h4 id=\"获取对象\"><a href=\"#获取对象\" class=\"headerlink\" title=\"获取对象\"></a>获取对象</h4><p>通过模型中的管理器构造一个查询集，来从你的数据库中获取对象。</p>\n<p>查询集表示从数据库中取出来的对象的集合。它可以含有零个、一个或者多个过滤器。过滤器基于所给的参数限制查询的结果。 从SQL 的角度，查询集和SELECT 语句等价，过滤器是像WHERE 和LIMIT 一样的限制子句。</p>\n<p>你可以从模型的管理器那里取得查询集。每个模型都至少有一个管理器，它默认命名为objects。通过模型类来直接访问它，像这样：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; Blog.objects</span><br><span class=\"line\">&lt;django.db.models.manager.Manager object at ...&gt;</span><br><span class=\"line\">&gt;&gt;&gt; b = Blog(name=&apos;Foo&apos;, tagline=&apos;Bar&apos;)</span><br><span class=\"line\">&gt;&gt;&gt; b.objects</span><br><span class=\"line\">Traceback:</span><br><span class=\"line\">    ...</span><br><span class=\"line\">AttributeError: &quot;Manager isn&apos;t accessible via Blog instances.&quot;</span><br></pre></td></tr></table></figure>\n<p>注</p>\n<p>管理器只可以通过模型的类访问，而不可以通过模型的实例访问，目的是为了强制区分“表级别”的操作和“记录级别”的操作。</p>\n<p>对于一个模型来说，管理器是查询集的主要来源。例如，Blog.objects.all() 返回包含数据库中所有Blog 对象的一个查询集。</p>\n<h4 id=\"获取所有对象\"><a href=\"#获取所有对象\" class=\"headerlink\" title=\"获取所有对象\"></a>获取所有对象</h4><p>获取一个表中所有对象的最简单的方式是全部获取。可以使用管理器的all() 方法：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; all_entries = Entry.objects.all()</span><br></pre></td></tr></table></figure>\n<p>all()方法返回包含数据库中所有对象的一个查询集</p>\n<h4 id=\"使用过滤器获取特定对象\"><a href=\"#使用过滤器获取特定对象\" class=\"headerlink\" title=\"使用过滤器获取特定对象\"></a>使用过滤器获取特定对象</h4><p>all()。但在通常情况下，你往往想要获取的是完整数据集的一个子集。</p>\n<p>要创建这样一个子集，你需要在原始的的查询集两个最普遍的途径是：</p>\n<ul>\n<li><p><code>filter(**kwargs)</code></p>\n<p>返回一个新的查询集，它包含满足查询参数的对象。</p>\n</li>\n<li><p><code>exclude(**kwargs)</code></p>\n<p>返回一个新的查询集，它包含<em>不</em>满足查询参数的对象。</p>\n</li>\n</ul>\n<p>查询参数（上面函数定义中的<code>**kwargs</code>）需要满足特定的格式，下面[字段查询]一节中会提到。</p>\n<p>举个例子，要获取年份为2006的所有文章的查询集方法：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Entry.objects.filter(pub_date__year=2006)</span><br></pre></td></tr></table></figure>\n<p>利用默认的管理器，它相当于：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Entry.objects.all().filter(pub_date__year=2006)</span><br></pre></td></tr></table></figure>\n<h4 id=\"链式过滤\"><a href=\"#链式过滤\" class=\"headerlink\" title=\"链式过滤\"></a>链式过滤</h4><p>查询集，所以可以将筛选语句链接在一起。像这样：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; Entry.objects.filter(</span><br><span class=\"line\">...     headline__startswith=&apos;What&apos;</span><br><span class=\"line\">... ).exclude(</span><br><span class=\"line\">...     pub_date__gte=datetime.date.today()</span><br><span class=\"line\">... ).filter(</span><br><span class=\"line\">...     pub_date__gte=datetime(2005, 1, 30)</span><br><span class=\"line\">... )</span><br></pre></td></tr></table></figure>\n<p>这个例子最开始获取数据库中所有对象的一个查询集，它包含标题以”What“开头、发布日期在2005年1月30日至当天之间的所有记录。</p>\n<h4 id=\"过滤后的查询集是独立的\"><a href=\"#过滤后的查询集是独立的\" class=\"headerlink\" title=\"过滤后的查询集是独立的\"></a>过滤后的查询集是独立的</h4><p>每次你筛选一个查询集，它可以被存储及反复使用。</p>\n<p>例如：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; q1 = Entry.objects.filter(headline__startswith=&quot;What&quot;)</span><br><span class=\"line\">&gt;&gt;&gt; q2 = q1.exclude(pub_date__gte=datetime.date.today())</span><br><span class=\"line\">&gt;&gt;&gt; q3 = q1.filter(pub_date__gte=datetime.date.today())</span><br></pre></td></tr></table></figure>\n<p>这三个<code>查询集</code>都是独立的。第一个是一个基础的查询集不会受到筛选过程的影响。</p>\n<h4 id=\"查询集是惰性执行的\"><a href=\"#查询集是惰性执行的\" class=\"headerlink\" title=\"查询集是惰性执行的\"></a>查询集是惰性执行的</h4><p><code>查询集</code> 是惰性执行的 —— 创建查询集 需要<em>求值</em>时，Django 才会真正运行这个查询。看下这个例子：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; q = Entry.objects.filter(headline__startswith=&quot;What&quot;)</span><br><span class=\"line\">&gt;&gt;&gt; q = q.filter(pub_date__lte=datetime.date.today())</span><br><span class=\"line\">&gt;&gt;&gt; q = q.exclude(body_text__icontains=&quot;food&quot;)</span><br><span class=\"line\">&gt;&gt;&gt; print(q)</span><br></pre></td></tr></table></figure>\n<p>虽然它看上去有三次数据库访问，但事实上只有在最后一行（<code>print(q)</code>）时才访问一次数据库。一般来说，只有在“请求”查询集。</p>\n<h3 id=\"通过get-获取一个单一的对象\"><a href=\"#通过get-获取一个单一的对象\" class=\"headerlink\" title=\"通过get 获取一个单一的对象\"></a>通过get 获取一个单一的对象</h3><p>filter()将只包含一个元素。</p>\n<p>如果你知道只有一个对象满足你的查询，你可以使用管理器 方法，它直接返回该对象：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; one_entry = Entry.objects.get(pk=1)</span><br></pre></td></tr></table></figure>\n<p>可以对get()。</p>\n<p>注意，使用get() 将引发一个<code>DoesNotExist</code> 异常。这个异常是正在查询的模型类的一个属性 —— 所以在上面的代码中，如果没有主键为1 的<code>Entry</code> 对象，Django 将引发一个<code>Entry.DoesNotExist</code>。</p>\n<p>类似地，如果有多条记录满足get()，它同样是模型类自身的一个属性。</p>\n<h3 id=\"其它查询集方法\"><a href=\"#其它查询集方法\" class=\"headerlink\" title=\"其它查询集方法\"></a>其它查询集方法</h3><p>大多数情况下，需要从数据库中查找对象时，你会使用all()。</p>\n<h3 id=\"限制查询集\"><a href=\"#限制查询集\" class=\"headerlink\" title=\"限制查询集\"></a>限制查询集</h3><p>可以使用Python 的切片语法来限制查询集记录的数目 。它等同于SQL 的<code>LIMIT</code> 和<code>OFFSET</code> 子句。</p>\n<p>例如，下面的语句返回前面5 个对象(<code>LIMIT 5</code>)：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; Entry.objects.all()[:5]</span><br></pre></td></tr></table></figure>\n<p>下面这条语句返回第6 至第10 个对象(<code>OFFSET 5 LIMIT 5</code>)：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; Entry.objects.all()[5:10]</span><br></pre></td></tr></table></figure>\n<p>不支持负的索引（例如<code>Entry.objects.all()[-1]</code>）。</p>\n<p>通常，查询集 —— 它不会执行查询。有一个例外，是如果你使用Python 切片语法中”step”参数。例如，下面的语句将返回前10 个对象中每隔<em>2</em>个对象，它将真实执行查询：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; Entry.objects.all()[:10:2]</span><br></pre></td></tr></table></figure>\n<p>若要获取一个<em>单一</em>的对象而不是一个列表（例如，<code>SELECT foo FROM bar LIMIT 1</code>），可以简单地使用一个索引而不是切片。例如，下面的语句返回数据库中根据标题排序后的第一条<code>Entry</code>：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; Entry.objects.order_by(&apos;headline&apos;)[0]</span><br></pre></td></tr></table></figure>\n<p>它大体等同于：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; Entry.objects.order_by(&apos;headline&apos;)[0:1].get()</span><br></pre></td></tr></table></figure>\n<p>然而请注意，如果没有对象满足给定的条件，第一条语句将引发<code>IndexError</code>而第二条语句将引发<code>DoesNotExist</code>。 更多细节参见get()。</p>\n<h3 id=\"字段查询\"><a href=\"#字段查询\" class=\"headerlink\" title=\"字段查询\"></a>字段查询</h3><p>字段查询是指如何指定SQL <code>WHERE</code> 子句的内容。它们通过查询集 的关键字参数指定。</p>\n<p>查询的关键字参数的基本形式是<code>field__lookuptype=value</code>。（中间是两个下划线）。例如：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; Entry.objects.filter(pub_date__lte=&apos;2006-01-01&apos;)</span><br></pre></td></tr></table></figure>\n<p>翻译成SQL（大体）是：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">SELECT * FROM blog_entry WHERE pub_date &lt;= &apos;2006-01-01&apos;;</span><br></pre></td></tr></table></figure>\n<p>这是如何实现的</p>\n<p>Python 定义的函数可以接收任意的键/值对参数，这些名称和参数可以在运行时求值。更多信息，参见Python 官方文档中的<a href=\"https://docs.python.org/tutorial/controlflow.html#keyword-arguments\" target=\"_blank\" rel=\"noopener\">关键字参数</a>。</p>\n<p>查询条件中指定的字段必须是模型字段的名称。但有一个例外，对于ForeignKey你可以使用字段名加上<code>_id</code> 后缀。在这种情况下，该参数的值应该是外键的原始值。例如：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; Entry.objects.filter(blog_id=4)</span><br></pre></td></tr></table></figure>\n<p>如果你传递的是一个不合法的参数，查询函数将引发 <code>TypeError</code>。</p>\n<p>这些数据库API 支持大约二十多种查询的类型；在[<em>字段查询参考</em>] 中可以找到完整的参考。为了让你尝尝鲜，下面是一些你可能用到的常见查询：</p>\n<ul>\n<li><p>exact</p>\n<p>“精确”匹配。例如：<code>&gt;&gt;&gt; Entry.objects.get(headline__exact=&quot;Man bites dog&quot;)</code>将生成下面的SQL：<code>SELECT ... WHERE headline = &#39;Man bites dog&#39;;</code>如果你没有提供查询类型 —— 即如果你的关键字参数不包含双下划线 —— 默认假定查询类型是<code>exact</code>。例如，下面的两条语句相等：<code>&gt;&gt;&gt; Blog.objects.get(id__exact=14)  # Explicit form&gt;&gt;&gt; Blog.objects.get(id=14)         # __exact is implied</code>这是为了方便，因为<code>exact</code> 查询是最常见的情况。</p>\n</li>\n<li><p>iexact</p>\n<p>大小写不敏感的匹配。所以，查询：<code>&gt;&gt;&gt; Blog.objects.get(name__iexact=&quot;beatles blog&quot;)</code>将匹配标题为<code>&quot;Beatles Blog&quot;</code>、<code>&quot;beatles blog&quot;</code> 甚至<code>&quot;BeAtlES blOG&quot;</code> 的<code>Blog</code>。</p>\n</li>\n<li><p>contains</p>\n<p>大小写敏感的包含关系测试。例如：<code>Entry.objects.get(headline__contains=&#39;Lennon&#39;)</code>大体可以翻译成下面的SQL：<code>SELECT ... WHERE headline LIKE &#39;%Lennon%&#39;;</code>注意，这将匹配<code>&#39;Today Lennon honored&#39;</code> 但不能匹配<code>&#39;today lennon honored&#39;</code>。还有一个大小写不敏感的版本，icontains。</p>\n</li>\n<li><p>startswith</p>\n<p>分别表示以XXX开头和以XXX结尾。当然还有大小写不敏感的版本，叫做istartswith。</p>\n</li>\n</ul>\n<p>同样，这里只是表面。完整的参考可以在[<em>字段查询参考</em>]中找到。</p>\n<h3 id=\"跨关联关系的查询\"><a href=\"#跨关联关系的查询\" class=\"headerlink\" title=\"跨关联关系的查询\"></a>跨关联关系的查询</h3><p>Django 提供一种强大而又直观的方式来“处理”查询中的关联关系，它在后台自动帮你处理<code>JOIN</code>。 若要跨越关联关系，只需使用关联的模型字段的名称，并使用双下划线分隔，直至你想要的字段：</p>\n<p>下面这个例子获取所有<code>Blog</code> 的<code>name</code> 为<code>&#39;Beatles Blog&#39;</code> 的<code>Entry</code> 对象：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; Entry.objects.filter(blog__name=&apos;Beatles Blog&apos;)</span><br></pre></td></tr></table></figure>\n<p>这种跨越可以是任意的深度。</p>\n<p>它还可以反向工作。若要引用一个“反向”的关系，只需要使用该模型的小写的名称。</p>\n<p>下面的示例获取所有的<code>Blog</code> 对象，它们至少有一个<code>Entry</code> 的<code>headline</code> 包含<code>&#39;Lennon&#39;</code>：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; Blog.objects.filter(entry__headline__contains=&apos;Lennon&apos;)</span><br></pre></td></tr></table></figure>\n<p>如果你在多个关联关系直接过滤而且其中某个中介模型没有满足过滤条件的值，Django 将把它当做一个空的（所有的值都为<code>NULL</code>）但是合法的对象。这意味着不会有错误引发。例如，在下面的过滤器中：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Blog.objects.filter(entry__authors__name=&apos;Lennon&apos;)</span><br></pre></td></tr></table></figure>\n<p>（如果有一个相关联的<code>Author</code> 模型），如果Entry 中没有找到对应的<code>author</code>，那么它将当作其没有<code>name</code>，而不会因为没有<code>author</code> 引发一个错误。通常，这就是你想要的。唯一可能让你困惑的是当你使用isnull 的时候。因此：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Blog.objects.filter(entry__authors__name__isnull=True)</span><br></pre></td></tr></table></figure>\n<p>返回的<code>Blog</code> 对象包括<code>author</code> <strong><code>name</code> 为空的Blog对象,以及author</strong>name不为空但author<strong>name关联的<code>entry</code> </strong><code>author</code> 为空的对象。如果你不需要后者，你可以这样写：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Blog.objects.filter(entry__authors__isnull=False,</span><br><span class=\"line\">        entry__authors__name__isnull=True)</span><br></pre></td></tr></table></figure>\n<h4 id=\"跨越多值的关联关系\"><a href=\"#跨越多值的关联关系\" class=\"headerlink\" title=\"跨越多值的关联关系\"></a>跨越多值的关联关系</h4><p>当你基于ManyToManyField 来过滤一个对象时，有两种不同种类的过滤器。考虑<code>Blog</code>/<code>Entry</code> 关联关系（<code>Blog</code> 和 <code>Entry</code> 是一对多的关系）。我们可能想找出headline为<em>“Lennon”</em> 并且pub_date为’2008’年的Entry。或者我们可能想查询headline为<em>“Lennon”</em> 的Entry或者pub_date为’2008’的Entry。因为实际上有和单个<code>Blog</code> 相关联的多个Entry，所以这两个查询在某些场景下都是有可能并有意义的。</p>\n<p>ManyToManyField 叫做 <code>tags</code>，我们可能想找到tag 叫做<em>“music”</em> 和<em>“bands”</em> 的Entry，或者我们想找一个tag 名为<em>“music”</em> 且状态为<em>“public”</em>的Entry。</p>\n<p>对于这两种情况，Django 有种一致的方法来处理filter() 调用选择出来的对象。</p>\n<p>这些听起来可能有点混乱，所以希望展示一个例子使它变得更清晰。选择所有包含同时满足两个条件的entry的blog，这两个条件是headline 包含<em>Lennon</em> 和发表时间是2008 （同一个entry 满足两个条件），我们的代码是：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Blog.objects.filter(entry__headline__contains=&apos;Lennon&apos;,</span><br><span class=\"line\">        entry__pub_date__year=2008)</span><br></pre></td></tr></table></figure>\n<p>从所有的blog模型实例中选择满足以下条件的blog实例：blog的enrty的headline属性值是<em>“Lennon”**</em>，或者entry的**发表时间是2008（两个条件至少满足一个，也可以同时满足），我们的代码是：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Blog.objects.filter(entry__headline__contains=&apos;Lennon&apos;).filter(</span><br><span class=\"line\">        entry__pub_date__year=2008)</span><br></pre></td></tr></table></figure>\n<p>假设这里有一个blog拥有一条包含<em>‘Lennon’</em>的entries条目和一条来自2008的entries条目,但是没有一条来自2008并且包含<em>“Lennon”</em>的entries条目。第一个查询不会返回任何blog，第二个查询将会返回一个blog。</p>\n<p>在第二个例子中， 第一个filter 限定查询集中的blog 与headline 包含<em>“Lennon”</em> 的entry 关联。第二个filter <em>又</em> 限定查询集中的blog ，这些blog关联的entry 的发表时间是2008。（译者注：难点在如何理解further这个词！）第二个filter 过滤出来的entry 与第一个filter 过滤出来的entry 可能相同也可能不同。每个filter 语句过滤的是<code>Blog</code>，而不是<code>Entry</code>。</p>\n<p>注</p>\n<p>跨越多值关系的filter() 调用中的条件不必引用同一个记录。</p>\n<p>例如，下面的查询排除<em>*headline 中包含</em>“Lennon”<em>的Entry</em>和*在2008 年发布的Entry：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Blog.objects.exclude(</span><br><span class=\"line\">    entry__headline__contains=&apos;Lennon&apos;,</span><br><span class=\"line\">    entry__pub_date__year=2008,</span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n<p>然而，这与使用filter() 的行为不同，它不是排除同时满足两个条件的Entry。为了实现这点，即选择的Blog中不包含在2008年发布且healine 中带有<em>“Lennon”</em> 的Entry，你需要编写两个查询：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Blog.objects.exclude(</span><br><span class=\"line\">    entry=Entry.objects.filter(</span><br><span class=\"line\">        headline__contains=&apos;Lennon&apos;,</span><br><span class=\"line\">        pub_date__year=2008,</span><br><span class=\"line\">    ),</span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n<h3 id=\"Filter-可以引用模型的字段\"><a href=\"#Filter-可以引用模型的字段\" class=\"headerlink\" title=\"Filter 可以引用模型的字段\"></a>Filter 可以引用模型的字段</h3><p>到目前为止给出的示例中，我们构造过将模型字段与常量进行比较的filter。但是，如果你想将模型的一个字段与同一个模型的另外一个字段进行比较该怎么办？</p>\n<p>Django 提供F 表达式` 返回的实例用作查询内部对模型字段的引用。这些引用可以用于查询的filter 中来比较相同模型实例上不同字段之间值的比较。</p>\n<p>例如，为了查找comments 数目多于pingbacks 的Entry，我们将构造一个<code>F()</code> 对象来引用pingback 数目，并在查询中使用该<code>F()</code> 对象：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; from django.db.models import F</span><br><span class=\"line\">&gt;&gt;&gt; Entry.objects.filter(n_comments__gt=F(&apos;n_pingbacks&apos;))</span><br></pre></td></tr></table></figure>\n<p>Django 支持对<code>F()</code> 对象使用加法、减法、乘法、除法、取模以及幂计算等算术操作，两个操作数可以都是常数和其它<code>F()</code> 对象。为了查找comments 数目比pingbacks <em>两倍</em>还要多的Entry，我们将查询修改为：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; Entry.objects.filter(n_comments__gt=F(&apos;n_pingbacks&apos;) * 2)</span><br></pre></td></tr></table></figure>\n<p>New in Django 1.7:</p>\n<p>添加 <code>**</code> 操作符。</p>\n<p>为了查询rating 比pingback 和comment 数目总和要小的Entry，我们将这样查询：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; Entry.objects.filter(rating__lt=F(&apos;n_comments&apos;) + F(&apos;n_pingbacks&apos;))</span><br></pre></td></tr></table></figure>\n<p>你还可以在<code>F()</code> 对象中使用双下划线标记来跨越关联关系。带有双下划线的<code>F()</code> 对象将引入任何需要的join 操作以访问关联的对象。例如，如要获取author 的名字与blog 名字相同的Entry，我们可以这样查询：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; Entry.objects.filter(authors__name=F(&apos;blog__name&apos;))</span><br></pre></td></tr></table></figure>\n<p>对于date 和date/time 字段，你可以给它们加上或减去一个timedelta(<a href=\"https://docs.python.org/3/library/datetime.html#datetime.timedelta\" target=\"_blank\" rel=\"noopener\">https://docs.python.org/3/library/datetime.html#datetime.timedelta</a>) 对象。下面的例子将返回发布超过3天后被修改的所有Entry：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; from datetime import timedelta</span><br><span class=\"line\">&gt;&gt;&gt; Entry.objects.filter(mod_date__gt=F(&apos;pub_date&apos;) + timedelta(days=3))</span><br></pre></td></tr></table></figure>\n<p><code>F()</code> 对象支持<code>.bitand()</code> 和<code>.bitor()</code> 两种位操作，例如：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; F(&apos;somefield&apos;).bitand(16)</span><br></pre></td></tr></table></figure>\n<h3 id=\"查询的快捷方式pk\"><a href=\"#查询的快捷方式pk\" class=\"headerlink\" title=\"查询的快捷方式pk\"></a>查询的快捷方式pk</h3><p>为了方便，Django 提供一个查询快捷方式<code>pk</code> ，它表示“primary key” 的意思。</p>\n<p>在<code>Blog</code> 模型示例中，主键是<code>id</code> 字段，所以下面三条语句是等同的：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; Blog.objects.get(id__exact=14) # Explicit form</span><br><span class=\"line\">&gt;&gt;&gt; Blog.objects.get(id=14) # __exact is implied</span><br><span class=\"line\">&gt;&gt;&gt; Blog.objects.get(pk=14) # pk implies id__exact</span><br></pre></td></tr></table></figure>\n<p><code>pk</code> 的使用不仅限于<code>__exact</code> 查询 —— 任何查询类型都可以与<code>pk</code> 结合来完成一个模型上对主键的查询：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># Get blogs entries with id 1, 4 and 7</span><br><span class=\"line\">&gt;&gt;&gt; Blog.objects.filter(pk__in=[1,4,7])</span><br><span class=\"line\"></span><br><span class=\"line\"># Get all blog entries with id &gt; 14</span><br><span class=\"line\">&gt;&gt;&gt; Blog.objects.filter(pk__gt=14)</span><br></pre></td></tr></table></figure>\n<p><code>pk</code>查询在join 中也可以工作。例如，下面三个语句是等同的：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; Entry.objects.filter(blog__id__exact=3) # Explicit form</span><br><span class=\"line\">&gt;&gt;&gt; Entry.objects.filter(blog__id=3)        # __exact is implied</span><br><span class=\"line\">&gt;&gt;&gt; Entry.objects.filter(blog__pk=3)        # __pk implies __id__exact</span><br></pre></td></tr></table></figure>\n<h3 id=\"转义LIKE-语句中的百分号和下划线\"><a href=\"#转义LIKE-语句中的百分号和下划线\" class=\"headerlink\" title=\"转义LIKE 语句中的百分号和下划线\"></a>转义LIKE 语句中的百分号和下划线</h3><p>与<code>LIKE</code> SQL 语句等同的字段查询（<code>iexact</code>、 <code>contains</code>、<code>icontains</code>、<code>startswith</code>、 <code>istartswith</code>、<code>endswith</code> 和<code>iendswith</code>）将自动转义在<code>LIKE</code> 语句中使用的两个特殊的字符 —— 百分号和下划线。（在<code>LIKE</code> 语句中，百分号通配符表示多个字符，下划线通配符表示单个字符）。</p>\n<p>这意味着语句将很直观，不会显得太抽象。例如，要获取包含一个百分号的所有的Entry，只需要像其它任何字符一样使用百分号：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; Entry.objects.filter(headline__contains=&apos;%&apos;)</span><br></pre></td></tr></table></figure>\n<p>Django 会帮你转义；生成的SQL 看上去会是这样：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">SELECT ... WHERE headline LIKE &apos;%\\%%&apos;;</span><br></pre></td></tr></table></figure>\n<p>对于下划线是同样的道理。百分号和下划线都会透明地帮你处理。</p>\n<h3 id=\"缓存和查询集\"><a href=\"#缓存和查询集\" class=\"headerlink\" title=\"缓存和查询集\"></a>缓存和查询集</h3><p>每个查询集都包含一个缓存来最小化对数据库的访问。理解它是如何工作的将让你编写最高效的代码。</p>\n<p>在一个新创建的查询集 的求值将重用缓存的结果。</p>\n<p>请牢记这个缓存行为，因为对查询集，对它们求值，然后扔掉它们：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; print([e.headline for e in Entry.objects.all()])</span><br><span class=\"line\">&gt;&gt;&gt; print([e.pub_date for e in Entry.objects.all()])</span><br></pre></td></tr></table></figure>\n<p>这意味着相同的数据库查询将执行两次，显然倍增了你的数据库负载。同时，还有可能两个结果列表并不包含相同的数据库记录，因为在两次请求期间有可能有<code>Entry</code>被添加进来或删除掉。</p>\n<p>为了避免这个问题，只需保存查询集并重新使用它：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; queryset = Entry.objects.all()</span><br><span class=\"line\">&gt;&gt;&gt; print([p.headline for p in queryset]) # Evaluate the query set.</span><br><span class=\"line\">&gt;&gt;&gt; print([p.pub_date for p in queryset]) # Re-use the cache from the evaluation.</span><br></pre></td></tr></table></figure>\n<h4 id=\"何时查询集不会被缓存\"><a href=\"#何时查询集不会被缓存\" class=\"headerlink\" title=\"何时查询集不会被缓存\"></a>何时查询集不会被缓存</h4><p>查询集不会永远缓存它们的结果。当只对查询集的<em>部分</em>进行求值时会检查缓存， 但是如果这个部分不在缓存中，那么接下来查询返回的记录都将不会被缓存。特别地，这意味着使用切片或索引来[<em>限制查询集</em>]将不会填充缓存。</p>\n<p>例如，重复获取查询集对象中一个特定的索引将每次都查询数据库：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; queryset = Entry.objects.all()</span><br><span class=\"line\">&gt;&gt;&gt; print queryset[5] # Queries the database</span><br><span class=\"line\">&gt;&gt;&gt; print queryset[5] # Queries the database again</span><br></pre></td></tr></table></figure>\n<p>然而，如果已经对全部查询集求值过，则将检查缓存：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; queryset = Entry.objects.all()</span><br><span class=\"line\">&gt;&gt;&gt; [entry for entry in queryset] # Queries the database</span><br><span class=\"line\">&gt;&gt;&gt; print queryset[5] # Uses cache</span><br><span class=\"line\">&gt;&gt;&gt; print queryset[5] # Uses cache</span><br></pre></td></tr></table></figure>\n<p>下面是一些其它例子，它们会使得全部的查询集被求值并填充到缓存中：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; [entry for entry in queryset]</span><br><span class=\"line\">&gt;&gt;&gt; bool(queryset)</span><br><span class=\"line\">&gt;&gt;&gt; entry in queryset</span><br><span class=\"line\">&gt;&gt;&gt; list(queryset)</span><br></pre></td></tr></table></figure>\n<p>注</p>\n<p>简单地打印查询集不会填充缓存。因为<code>__repr__()</code> 调用只返回全部查询集的一个切片。</p>\n<h2 id=\"使用Q-对象进行复杂的查询\"><a href=\"#使用Q-对象进行复杂的查询\" class=\"headerlink\" title=\"使用Q 对象进行复杂的查询\"></a>使用Q 对象进行复杂的查询</h2><p>filter()。</p>\n<p>Q 对象 对象用于封装一组关键字参数。这些关键字参数就是上文“字段查询” 中所提及的那些。</p>\n<p>例如，下面的<code>Q</code> 对象封装一个<code>LIKE</code> 查询：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">from django.db.models import Q</span><br><span class=\"line\">Q(question__startswith=&apos;What&apos;)</span><br></pre></td></tr></table></figure>\n<p><code>Q</code> 对象可以使用<code>&amp;</code> 和<code>|</code> 操作符组合起来。当一个操作符在两个<code>Q</code> 对象上使用时，它产生一个新的<code>Q</code> 对象。</p>\n<p>例如，下面的语句产生一个<code>Q</code> 对象，表示两个<code>&quot;question__startswith&quot;</code> 查询的“OR” ：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Q(question__startswith=&apos;Who&apos;) | Q(question__startswith=&apos;What&apos;)</span><br></pre></td></tr></table></figure>\n<p>它等同于下面的SQL <code>WHERE</code> 子句：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">WHERE question LIKE &apos;Who%&apos; OR question LIKE &apos;What%&apos;</span><br></pre></td></tr></table></figure>\n<p>你可以组合<code>&amp;</code> 和<code>|</code>  操作符以及使用括号进行分组来编写任意复杂的<code>Q</code> 对象。同时，<code>Q</code> 对象可以使用<code>~</code> 操作符取反，这允许组合正常的查询和取反(<code>NOT</code>) 查询：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Q(question__startswith=&apos;Who&apos;) | ~Q(pub_date__year=2005)</span><br></pre></td></tr></table></figure>\n<p>每个接受关键字参数的查询函数（例如filter()）都可以传递一个或多个<code>Q</code> 对象作为位置（不带名的）参数。如果一个查询函数有多个<code>Q</code> 对象参数，这些参数的逻辑关系为“AND”。例如：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Poll.objects.get(</span><br><span class=\"line\">    Q(question__startswith=&apos;Who&apos;),</span><br><span class=\"line\">    Q(pub_date=date(2005, 5, 2)) | Q(pub_date=date(2005, 5, 6))</span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n<p>… 大体上可以翻译成这个SQL：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">SELECT * from polls WHERE question LIKE &apos;Who%&apos;</span><br><span class=\"line\">    AND (pub_date = &apos;2005-05-02&apos; OR pub_date = &apos;2005-05-06&apos;)</span><br></pre></td></tr></table></figure>\n<p>查询函数可以混合使用<code>Q 对象</code>和关键字参数。所有提供给查询函数的参数（关键字参数或<code>Q</code> 对象）都将”AND”在一起。但是，如果出现<code>Q</code> 对象，它必须位于所有关键字参数的前面。例如：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Poll.objects.get(</span><br><span class=\"line\">    Q(pub_date=date(2005, 5, 2)) | Q(pub_date=date(2005, 5, 6)),</span><br><span class=\"line\">    question__startswith=&apos;Who&apos;)</span><br></pre></td></tr></table></figure>\n<p>… 是一个合法的查询，等同于前面的例子；但是：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># INVALID QUERY</span><br><span class=\"line\">Poll.objects.get(</span><br><span class=\"line\">    question__startswith=&apos;Who&apos;,</span><br><span class=\"line\">    Q(pub_date=date(2005, 5, 2)) | Q(pub_date=date(2005, 5, 6)))</span><br></pre></td></tr></table></figure>\n<p>… 是不合法的。</p>\n<p>另见</p>\n<p>Django 单元测试中的<a href=\"https://github.com/django/django/blob/master/tests/or_lookups/tests.py\" target=\"_blank\" rel=\"noopener\">OR 查询示例</a>演示了几种<code>Q</code> 的用法。</p>\n<h2 id=\"比较对象\"><a href=\"#比较对象\" class=\"headerlink\" title=\"比较对象\"></a>比较对象</h2><p>为了比较两个模型实例，只需要使用标准的Python 比较操作符，即双等于符号：<code>==</code>。在后台，它会比较两个模型主键的值。</p>\n<p>利用上面的<code>Entry</code> 示例，下面两个语句是等同的：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; some_entry == other_entry</span><br><span class=\"line\">&gt;&gt;&gt; some_entry.id == other_entry.id</span><br></pre></td></tr></table></figure>\n<p>如果模型的主键不叫<code>id</code>，也没有问题。比较将始终使用主键，无论它叫什么。例如，如果模型的主键字段叫做<code>name</code>，下面的两条语句是等同的：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; some_obj == other_obj</span><br><span class=\"line\">&gt;&gt;&gt; some_obj.name == other_obj.name</span><br></pre></td></tr></table></figure>\n<h2 id=\"删除对象\"><a href=\"#删除对象\" class=\"headerlink\" title=\"删除对象\"></a>删除对象</h2><p>删除方法，为了方便，就取名为delete()。这个方法将立即删除对象且没有返回值。例如：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">e.delete()</span><br></pre></td></tr></table></figure>\n<p>你还可以批量删除对象。每个查询集中的所有成员。</p>\n<p>例如，下面的语句删除<code>pub_date</code> 为2005 的所有<code>Entry</code> 对象：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Entry.objects.filter(pub_date__year=2005).delete()</span><br></pre></td></tr></table></figure>\n<p>记住，这将尽可能地使用纯SQL 执行，所以这个过程中不需要调用每个对象实例的<code>delete()</code>方法。如果你给模型类提供了一个自定义的<code>delete()</code> 方法并希望确保它被调用，你需要手工删除该模型的实例（例如，迭代查询集 方法。</p>\n<p>当Django 删除一个对象时，它默认使用SQL <code>ON DELETE CASCADE</code> 约束 —— 换句话讲，任何有外键指向要删除对象的对象将一起删除。例如：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">b = Blog.objects.get(pk=1)</span><br><span class=\"line\"># This will delete the Blog and all of its Entry objects.</span><br><span class=\"line\">b.delete()</span><br></pre></td></tr></table></figure>\n<p>这种级联的行为可以通过的ForeignKey 参数自定义。</p>\n<p>注意，delete()`，而删除<em>所有</em> 的条目。如果你<em>确实</em>想删除所有的对象，你必须明确地请求一个完全的查询集：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Entry.objects.all().delete()</span><br></pre></td></tr></table></figure>\n<h2 id=\"拷贝模型实例\"><a href=\"#拷贝模型实例\" class=\"headerlink\" title=\"拷贝模型实例\"></a>拷贝模型实例</h2><p>虽然没有内建的方法用于拷贝模型实例，但还是很容易创建一个新的实例并让它的所有字段都拷贝过来。最简单的方法是，只需要将<code>pk</code> 设置为<code>None</code>。利用我们的Blog 示例：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">blog = Blog(name=&apos;My blog&apos;, tagline=&apos;Blogging is easy&apos;)</span><br><span class=\"line\">blog.save() # blog.pk == 1</span><br><span class=\"line\"></span><br><span class=\"line\">blog.pk = None</span><br><span class=\"line\">blog.save() # blog.pk == 2</span><br></pre></td></tr></table></figure>\n<p>如果你用继承，那么会复杂一些。考虑下面<code>Blog</code> 的子类：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class ThemeBlog(Blog):</span><br><span class=\"line\">    theme = models.CharField(max_length=200)</span><br><span class=\"line\"></span><br><span class=\"line\">django_blog = ThemeBlog(name=&apos;Django&apos;, tagline=&apos;Django is easy&apos;, theme=&apos;python&apos;)</span><br><span class=\"line\">django_blog.save() # django_blog.pk == 3</span><br></pre></td></tr></table></figure>\n<p>由于继承的工作方式，你必须设置<code>pk</code> 和 <code>id</code> 都为None：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">django_blog.pk = None</span><br><span class=\"line\">django_blog.id = None</span><br><span class=\"line\">django_blog.save() # django_blog.pk == 4</span><br></pre></td></tr></table></figure>\n<p>这个过程不会拷贝关联的对象。如果你想拷贝关联关系，你必须编写一些更多的代码。在我们的例子中，<code>Entry</code> 有一个到<code>Author</code> 的多对多字段：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">entry = Entry.objects.all()[0] # some previous entry</span><br><span class=\"line\">old_authors = entry.authors.all()</span><br><span class=\"line\">entry.pk = None</span><br><span class=\"line\">entry.save()</span><br><span class=\"line\">entry.authors = old_authors # saves new many2many relations</span><br></pre></td></tr></table></figure>\n<h2 id=\"一次更新多个对象\"><a href=\"#一次更新多个对象\" class=\"headerlink\" title=\"一次更新多个对象\"></a>一次更新多个对象</h2><p>有时你想为一个查询集 方法。例如：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># Update all the headlines with pub_date in 2007.</span><br><span class=\"line\">Entry.objects.filter(pub_date__year=2007).update(headline=&apos;Everything is the same&apos;)</span><br></pre></td></tr></table></figure>\n<p>你只可以对非关联字段和ForeignKey 字段，需设置新的值为你想指向的新的模型实例。例如：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; b = Blog.objects.get(pk=1)</span><br><span class=\"line\"></span><br><span class=\"line\"># Change every Entry so that it belongs to this Blog.</span><br><span class=\"line\">&gt;&gt;&gt; Entry.objects.all().update(blog=b)</span><br></pre></td></tr></table></figure>\n<p><code>update()</code> 方法会立即执行并返回查询匹配的行数（如果有些行已经具有新的值，返回的行数可能和被更新的行数不相等）。更新查询集 唯一的限制是它只能访问一个数据库表，也就是模型的主表。你可以根据关联的字段过滤，但是你只能更新模型主表中的列。例如：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; b = Blog.objects.get(pk=1)</span><br><span class=\"line\"></span><br><span class=\"line\"># Update all the headlines belonging to this Blog.</span><br><span class=\"line\">&gt;&gt;&gt; Entry.objects.select_related().filter(blog=b).update(headline=&apos;Everything is the same&apos;)</span><br></pre></td></tr></table></figure>\n<p>要注意<code>update()</code> 方法会直接转换成一个SQL 语句。它是一个批量的直接更新操作。它不会运行模型的save()：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">for item in my_queryset:</span><br><span class=\"line\">    item.save()</span><br></pre></td></tr></table></figure>\n<p>对update 的调用也可以使用F 表达式 来根据模型中的一个字段更新另外一个字段。这对于在当前值的基础上加上一个值特别有用。例如，增加Blog 中每个Entry 的pingback 个数：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; Entry.objects.all().update(n_pingbacks=F(&apos;n_pingbacks&apos;) + 1)</span><br></pre></td></tr></table></figure>\n<p>然而，与filter 和exclude 子句中的<code>F()</code> 对象不同，在update 中你不可以使用<code>F()</code> 对象引入join —— 你只可以引用正在更新的模型的字段。如果你尝试使用<code>F()</code> 对象引入一个join，将引发一个<code>FieldError</code>：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># THIS WILL RAISE A FieldError</span><br><span class=\"line\">&gt;&gt;&gt; Entry.objects.update(headline=F(&apos;blog__name&apos;))</span><br></pre></td></tr></table></figure>\n<h2 id=\"关联的对象\"><a href=\"#关联的对象\" class=\"headerlink\" title=\"关联的对象\"></a>关联的对象</h2><p>当你在一个模型中定义一个关联关系时（例如，ForeignKey），该模型的实例将带有一个方便的API 来访问关联的对象。</p>\n<p>利用本页顶部的模型，一个<code>Entry</code> 对象<code>e</code> 可以通过<code>blog</code> 属性<code>e.blog</code> 获取关联的<code>Blog</code> 对象。</p>\n<p>（在幕后，这个功能是通过Python 的[描述器]实现的。这应该不会对你有什么真正的影响，但是这里我们指出它以满足你的好奇）。</p>\n<p>Django 还会创建API 用于访问关联关系的另一头 —— 从关联的模型访问定义关联关系的模型。例如，<code>Blog</code> 对象<code>b</code> 可以通过<code>entry_set</code> 属性 <code>b.entry_set.all()</code>访问与它关联的所有<code>Entry</code> 对象。</p>\n<p>这一节中的所有示例都将使用本页顶部定义的<code>Blog</code>、 <code>Author</code> 和<code>Entry</code> 模型。</p>\n<h3 id=\"一对多关系\"><a href=\"#一对多关系\" class=\"headerlink\" title=\"一对多关系\"></a>一对多关系</h3><h4 id=\"前向查询\"><a href=\"#前向查询\" class=\"headerlink\" title=\"前向查询\"></a>前向查询</h4><p>如果一个模型具有ForeignKey，那么该模型的实例将可以通过属性访问关联的（外部）对象。</p>\n<p>例如：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; e = Entry.objects.get(id=2)</span><br><span class=\"line\">&gt;&gt;&gt; e.blog # Returns the related Blog object.</span><br></pre></td></tr></table></figure>\n<p>你可以通过外键属性获取和设置。和你预期的一样，对外键的修改不会保存到数据库中直至你调用save()。例如：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; e = Entry.objects.get(id=2)</span><br><span class=\"line\">&gt;&gt;&gt; e.blog = some_blog</span><br><span class=\"line\">&gt;&gt;&gt; e.save()</span><br></pre></td></tr></table></figure>\n<p>如果ForeignKey 字段有<code>null=True</code> 设置（即它允许<code>NULL</code> 值），你可以分配<code>None</code> 来删除对应的关联性。例如：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; e = Entry.objects.get(id=2)</span><br><span class=\"line\">&gt;&gt;&gt; e.blog = None</span><br><span class=\"line\">&gt;&gt;&gt; e.save() # &quot;UPDATE blog_entry SET blog_id = NULL ...;&quot;</span><br></pre></td></tr></table></figure>\n<p>一对多关联关系的前向访问在第一次访问关联的对象时被缓存。以后对同一个对象的外键的访问都使用缓存。例如：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; e = Entry.objects.get(id=2)</span><br><span class=\"line\">&gt;&gt;&gt; print(e.blog)  # Hits the database to retrieve the associated Blog.</span><br><span class=\"line\">&gt;&gt;&gt; print(e.blog)  # Doesn&apos;t hit the database; uses cached version.</span><br></pre></td></tr></table></figure>\n<p>注意select_related()方法递归地预填充所有的一对多关系到缓存中。例如：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; e = Entry.objects.select_related().get(id=2)</span><br><span class=\"line\">&gt;&gt;&gt; print(e.blog)  # Doesn&apos;t hit the database; uses cached version.</span><br><span class=\"line\">&gt;&gt;&gt; print(e.blog)  # Doesn&apos;t hit the database; uses cached version.</span><br></pre></td></tr></table></figure>\n<h4 id=\"反向查询\"><a href=\"#反向查询\" class=\"headerlink\" title=\"反向查询\"></a>反向查询</h4><p>如果模型I有一个ForeignKey返回的<code>查询集</code>可以用上一节提到的方式进行过滤和操作。</p>\n<p>例如：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; b = Blog.objects.get(id=1)</span><br><span class=\"line\">&gt;&gt;&gt; b.entry_set.all() # Returns all Entry objects related to Blog.</span><br><span class=\"line\"></span><br><span class=\"line\"># b.entry_set is a Manager that returns QuerySets.</span><br><span class=\"line\">&gt;&gt;&gt; b.entry_set.filter(headline__contains=&apos;Lennon&apos;)</span><br><span class=\"line\">&gt;&gt;&gt; b.entry_set.count()</span><br></pre></td></tr></table></figure>\n<p>你可以在ForeignKey`，那么上面的示例代码应该改成这样：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; b = Blog.objects.get(id=1)</span><br><span class=\"line\">&gt;&gt;&gt; b.entries.all() # Returns all Entry objects related to Blog.</span><br><span class=\"line\"></span><br><span class=\"line\"># b.entries is a Manager that returns QuerySets.</span><br><span class=\"line\">&gt;&gt;&gt; b.entries.filter(headline__contains=&apos;Lennon&apos;)</span><br><span class=\"line\">&gt;&gt;&gt; b.entries.count()</span><br></pre></td></tr></table></figure>\n<h4 id=\"使用自定义的反向管理器\"><a href=\"#使用自定义的反向管理器\" class=\"headerlink\" title=\"使用自定义的反向管理器\"></a>使用自定义的反向管理器</h4><p>New in Django 1.7.</p>\n<p>默认情况下，用于反向关联关系的RelatedManager 的子类。如果你想为一个查询指定一个不同的管理器，你可以使用下面的语法：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">from django.db import models</span><br><span class=\"line\"></span><br><span class=\"line\">class Entry(models.Model):</span><br><span class=\"line\">    #...</span><br><span class=\"line\">    objects = models.Manager()  # Default Manager</span><br><span class=\"line\">    entries = EntryManager()    # Custom Manager</span><br><span class=\"line\"></span><br><span class=\"line\">b = Blog.objects.get(id=1)</span><br><span class=\"line\">b.entry_set(manager=&apos;entries&apos;).all()</span><br></pre></td></tr></table></figure>\n<p>如果<code>EntryManager</code> 在它的<code>get_queryset()</code> 方法中使用默认的过滤，那么该过滤将适用于<code>all()</code> 调用。</p>\n<p>当然，指定一个自定义的管理器还可以让你调用自定义的方法：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">b.entry_set(manager=&apos;entries&apos;).is_published()</span><br></pre></td></tr></table></figure>\n<h4 id=\"处理关联对象的其它方法\"><a href=\"#处理关联对象的其它方法\" class=\"headerlink\" title=\"处理关联对象的其它方法\"></a>处理关联对象的其它方法</h4><p>除了在上面”获取对象“一节中定义的查询集 中找到。</p>\n<ul>\n<li><p><code>add(obj1, obj2, ...)</code></p>\n<p>添加一指定的模型对象到关联的对象集中。</p>\n</li>\n<li><p><code>create(**kwargs)</code></p>\n<p>创建一个新的对象，将它保存并放在关联的对象集中。返回新创建的对象。</p>\n</li>\n<li><p><code>remove(obj1, obj2, ...)</code></p>\n<p>从关联的对象集中删除指定的模型对象。</p>\n</li>\n<li><p><code>clear()</code></p>\n<p>从关联的对象集中删除所有的对象。</p>\n</li>\n</ul>\n<p>若要一次性给关联的对象集赋值，只需要给它赋值一个可迭代的对象。这个可迭代的对象可以包含对象的实例，或者一个主键值的列表。例如：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">b = Blog.objects.get(id=1)</span><br><span class=\"line\">b.entry_set = [e1, e2]</span><br></pre></td></tr></table></figure>\n<p>在这个例子中，<code>e1</code> 和<code>e2</code> 可以是Entry 实例，也可以是主键的整数值。</p>\n<p>如果有<code>clear()</code> 方法，那么在将可迭代对象中的成员添加到集合中之前，将从<code>entry_set</code> 中删除所有已经存在的对象。如果<em>没有</em><code>clear()</code> 方法，那么将直接添加可迭代对象中的成员而不会删除所有已存在的对象。</p>\n<p>这一节中提到的每个”反向“操作都会立即对数据库产生作用。每个添加、创建和删除操作都会立即并自动保存到数据库中。</p>\n<h3 id=\"多对多关系\"><a href=\"#多对多关系\" class=\"headerlink\" title=\"多对多关系\"></a>多对多关系</h3><p>多对多关系的两端都会自动获得访问另一端的API。这些API 的工作方式与上面提到的“方向”一对多关系一样。</p>\n<p>唯一的区别在于属性的名称：定义 ManyToManyField 的模型使用该字段的属性名称，而“反向”模型使用源模型的小写名称加上<code>&#39;_set&#39;</code> （和一对多关系一样）。</p>\n<p>一个例子可以让它更好理解：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">e = Entry.objects.get(id=3)</span><br><span class=\"line\">e.authors.all() # Returns all Author objects for this Entry.</span><br><span class=\"line\">e.authors.count()</span><br><span class=\"line\">e.authors.filter(name__contains=&apos;John&apos;)</span><br><span class=\"line\"></span><br><span class=\"line\">a = Author.objects.get(id=5)</span><br><span class=\"line\">a.entry_set.all() # Returns all Entry objects for this Author.</span><br></pre></td></tr></table></figure>\n<p>类似ForeignKey 指定<code>related_name=&#39;entries&#39;</code>，那么<code>Author</code> 实例将使用 <code>entries</code> 属性而不是<code>entry_set</code>。</p>\n<h3 id=\"一对一关系\"><a href=\"#一对一关系\" class=\"headerlink\" title=\"一对一关系\"></a>一对一关系</h3><p>一对一关系与多对一关系非常相似。如果你在模型中定义一个OneToOneField，该模型的实例将可以通过该模型的一个简单属性访问关联的模型。</p>\n<p>例如：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class EntryDetail(models.Model):</span><br><span class=\"line\">    entry = models.OneToOneField(Entry)</span><br><span class=\"line\">    details = models.TextField()</span><br><span class=\"line\"></span><br><span class=\"line\">ed = EntryDetail.objects.get(id=2)</span><br><span class=\"line\">ed.entry # Returns the related Entry object.</span><br></pre></td></tr></table></figure>\n<p>在“反向”查询中有所不同。一对一关系中的关联模型同样具有一个管理器表示一个单一的对象而不是对象的集合：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">e = Entry.objects.get(id=2)</span><br><span class=\"line\">e.entrydetail # returns the related EntryDetail object</span><br></pre></td></tr></table></figure>\n<p>如果没有对象赋值给这个关联关系，Django 将引发一个<code>DoesNotExist</code> 异常。</p>\n<p>实例可以赋值给反向的关联关系，方法和正向的关联关系一样：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">e.entrydetail = ed</span><br></pre></td></tr></table></figure>\n<h3 id=\"反向的关联关系是如何实现的？\"><a href=\"#反向的关联关系是如何实现的？\" class=\"headerlink\" title=\"反向的关联关系是如何实现的？\"></a>反向的关联关系是如何实现的？</h3><p>其它对象关系映射要求你在关联关系的两端都要定义。Django 的开发人员相信这是对DRY（不要重复你自己的代码）原则的违背，所以Django 只要求你在一端定义关联关系。</p>\n<p>但是这怎么可能？因为一个模型类直到其它模型类被加载之后才知道哪些模型类是关联的。</p>\n<p>答案在app registry 中列出的每个应用，然后导入每个应用中的<code>models</code>模块。每创建一个新的模型时，Django 添加反向的关系到所有关联的模型。如果关联的模型还没有导入，Django 将保存关联关系的记录并在最终关联的模型导入时添加这些关联关系。</p>\n<p>由于这个原因，你使用的所有模型都定义在INSTALLED_APPS 列出的应用中就显得特别重要。否则，反向的关联关系将不能正确工作。</p>\n<h3 id=\"通过关联的对象进行查询\"><a href=\"#通过关联的对象进行查询\" class=\"headerlink\" title=\"通过关联的对象进行查询\"></a>通过关联的对象进行查询</h3><p>在关联对象字段上的查询与正常字段的查询遵循同样的规则。当你指定查询需要匹配的一个值时，你可以使用一个对象实例或者对象的主键的值。</p>\n<p>例如，如果你有一个<code>id=5</code> 的Blog 对象<code>b</code>，下面的三个查询将是完全一样的：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Entry.objects.filter(blog=b) # Query using object instance</span><br><span class=\"line\">Entry.objects.filter(blog=b.id) # Query using id from instance</span><br><span class=\"line\">Entry.objects.filter(blog=5) # Query using id directly</span><br></pre></td></tr></table></figure>\n<h2 id=\"回归到原始的-SQL\"><a href=\"#回归到原始的-SQL\" class=\"headerlink\" title=\"回归到原始的 SQL\"></a>回归到原始的 SQL</h2><p>如果你发现需要编写的SQL 查询对于Django 的数据库映射机制太复杂，你可以回归到手工编写SQL。Django 对于编写原始的SQL 查询有多个选项；参见[<em>执行原始的SQL 查询</em>]。</p>\n<p>最后，值得注意的是Django 的数据库层只是数据库的一个接口。你可以利用其它工具、编程语言或数据库框架来访问数据库；对于数据库，Django 没有什么特别的地方。</p>\n","site":{"data":{}},"excerpt":"<h1 id=\"执行查询\"><a href=\"#执行查询\" class=\"headerlink\" title=\"执行查询\"></a>执行查询</h1><p>一旦你建立好数据模型，Django 会自动为你生成一套数据库抽象的API，可以让你创建、检索、更新和删除对象。这篇文档阐述如何使用这些API。 关于模型查询所有选项的完整细节，请见数据模型参考。</p>","more":"<p>在整个文档（以及参考）中，我们将引用下面的模型，它构成一个博客应用：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">from django.db import models</span><br><span class=\"line\"></span><br><span class=\"line\">class Blog(models.Model):</span><br><span class=\"line\">    name = models.CharField(max_length=100)</span><br><span class=\"line\">    tagline = models.TextField()</span><br><span class=\"line\"></span><br><span class=\"line\">    def __str__(self):              # __unicode__ on Python 2</span><br><span class=\"line\">        return self.name</span><br><span class=\"line\"></span><br><span class=\"line\">class Author(models.Model):</span><br><span class=\"line\">    name = models.CharField(max_length=50)</span><br><span class=\"line\">    email = models.EmailField()</span><br><span class=\"line\"></span><br><span class=\"line\">    def __str__(self):              # __unicode__ on Python 2</span><br><span class=\"line\">        return self.name</span><br><span class=\"line\"></span><br><span class=\"line\">class Entry(models.Model):</span><br><span class=\"line\">    blog = models.ForeignKey(Blog)</span><br><span class=\"line\">    headline = models.CharField(max_length=255)</span><br><span class=\"line\">    body_text = models.TextField()</span><br><span class=\"line\">    pub_date = models.DateField()</span><br><span class=\"line\">    mod_date = models.DateField()</span><br><span class=\"line\">    authors = models.ManyToManyField(Author)</span><br><span class=\"line\">    n_comments = models.IntegerField()</span><br><span class=\"line\">    n_pingbacks = models.IntegerField()</span><br><span class=\"line\">    rating = models.IntegerField()</span><br><span class=\"line\"></span><br><span class=\"line\">    def __str__(self):              # __unicode__ on Python 2</span><br><span class=\"line\">        return self.headline</span><br></pre></td></tr></table></figure>\n<p>####创建对象</p>\n<p>Django 使用一种直观的方式把数据库表中的数据表示成Python 对象：一个模型类代表数据库中的一个表，一个模型类的实例代表这个数据库表中的一条特定的记录。</p>\n<p>使用关键字参数实例化模型实例来创建一个对象，然后调用save() 把它保存到数据库中。</p>\n<p>假设模型存放于文件mysite/blog/models.py中，下面是一个例子：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; from blog.models import Blog</span><br><span class=\"line\">&gt;&gt;&gt; b = Blog(name=&apos;Beatles Blog&apos;, tagline=&apos;All the latest Beatles news.&apos;)</span><br><span class=\"line\">&gt;&gt;&gt; b.save()</span><br></pre></td></tr></table></figure>\n<p>上面的代码在背后执行了SQL 的INSERT 语句。在你显式调用save()之前，Django 不会访问数据库。</p>\n<p>save() 方法没有返回值。</p>\n<p>请参见</p>\n<p>save()方法带有一些高级选项，它们没有在这里给出。完整的细节请见save() 文档。</p>\n<p>如果你想只用一条语句创建并保存一个对象，使用create()方法。</p>\n<h4 id=\"保存对象的改动\"><a href=\"#保存对象的改动\" class=\"headerlink\" title=\"保存对象的改动\"></a>保存对象的改动</h4><p>要保存对数据库中已存在的对象的改动，请使用save()。</p>\n<p>假设Blog 的一个实例b5 已经被保存在数据库中，下面这个例子将更改它的name 并且更新数据库中的记录：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; b5.name = &apos;New name&apos;</span><br><span class=\"line\">&gt;&gt;&gt; b5.save()</span><br></pre></td></tr></table></figure>\n<p>上面的代码在背后执行SQL 的UPDATE语句。在你显式调用save()之前，Django不会访问数据库。</p>\n<h4 id=\"保存ForeignKey和ManyToManyField字段\"><a href=\"#保存ForeignKey和ManyToManyField字段\" class=\"headerlink\" title=\"保存ForeignKey和ManyToManyField字段\"></a>保存ForeignKey和ManyToManyField字段</h4><p>更新ForeignKey 字段的方式和保存普通字段相同 —— 只要把一个正确类型的对象赋值给该字段。下面的例子更新了Entry类的实例entry 的blog 属性，假设Entry 和Blog 分别已经有一个正确的实例保存在数据库中（所以我们可以像下面这样获取它们）：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; from blog.models import Entry</span><br><span class=\"line\">&gt;&gt;&gt; entry = Entry.objects.get(pk=1)</span><br><span class=\"line\">&gt;&gt;&gt; cheese_blog = Blog.objects.get(name=&quot;Cheddar Talk&quot;)</span><br><span class=\"line\">&gt;&gt;&gt; entry.blog = cheese_blog</span><br><span class=\"line\">&gt;&gt;&gt; entry.save()</span><br></pre></td></tr></table></figure>\n<p>更新ManyToManyField 的方式有一些不同 —— 需要使用字段的add()方法来增加关联关系的一条记录。下面这个例子向entry 对象添加Author 类的实例joe：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; from blog.models import Author</span><br><span class=\"line\">&gt;&gt;&gt; joe = Author.objects.create(name=&quot;Joe&quot;)</span><br><span class=\"line\">&gt;&gt;&gt; entry.authors.add(joe)</span><br></pre></td></tr></table></figure>\n<p>为了在一条语句中，向ManyToManyField添加多条记录，可以在调用add()方法时传入多个参数，像这样：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; john = Author.objects.create(name=&quot;John&quot;)</span><br><span class=\"line\">&gt;&gt;&gt; paul = Author.objects.create(name=&quot;Paul&quot;)</span><br><span class=\"line\">&gt;&gt;&gt; george = Author.objects.create(name=&quot;George&quot;)</span><br><span class=\"line\">&gt;&gt;&gt; ringo = Author.objects.create(name=&quot;Ringo&quot;)</span><br><span class=\"line\">&gt;&gt;&gt; entry.authors.add(john, paul, george, ringo)</span><br></pre></td></tr></table></figure>\n<p>Django 将会在你赋值或添加错误类型的对象时报错。</p>\n<h4 id=\"获取对象\"><a href=\"#获取对象\" class=\"headerlink\" title=\"获取对象\"></a>获取对象</h4><p>通过模型中的管理器构造一个查询集，来从你的数据库中获取对象。</p>\n<p>查询集表示从数据库中取出来的对象的集合。它可以含有零个、一个或者多个过滤器。过滤器基于所给的参数限制查询的结果。 从SQL 的角度，查询集和SELECT 语句等价，过滤器是像WHERE 和LIMIT 一样的限制子句。</p>\n<p>你可以从模型的管理器那里取得查询集。每个模型都至少有一个管理器，它默认命名为objects。通过模型类来直接访问它，像这样：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; Blog.objects</span><br><span class=\"line\">&lt;django.db.models.manager.Manager object at ...&gt;</span><br><span class=\"line\">&gt;&gt;&gt; b = Blog(name=&apos;Foo&apos;, tagline=&apos;Bar&apos;)</span><br><span class=\"line\">&gt;&gt;&gt; b.objects</span><br><span class=\"line\">Traceback:</span><br><span class=\"line\">    ...</span><br><span class=\"line\">AttributeError: &quot;Manager isn&apos;t accessible via Blog instances.&quot;</span><br></pre></td></tr></table></figure>\n<p>注</p>\n<p>管理器只可以通过模型的类访问，而不可以通过模型的实例访问，目的是为了强制区分“表级别”的操作和“记录级别”的操作。</p>\n<p>对于一个模型来说，管理器是查询集的主要来源。例如，Blog.objects.all() 返回包含数据库中所有Blog 对象的一个查询集。</p>\n<h4 id=\"获取所有对象\"><a href=\"#获取所有对象\" class=\"headerlink\" title=\"获取所有对象\"></a>获取所有对象</h4><p>获取一个表中所有对象的最简单的方式是全部获取。可以使用管理器的all() 方法：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; all_entries = Entry.objects.all()</span><br></pre></td></tr></table></figure>\n<p>all()方法返回包含数据库中所有对象的一个查询集</p>\n<h4 id=\"使用过滤器获取特定对象\"><a href=\"#使用过滤器获取特定对象\" class=\"headerlink\" title=\"使用过滤器获取特定对象\"></a>使用过滤器获取特定对象</h4><p>all()。但在通常情况下，你往往想要获取的是完整数据集的一个子集。</p>\n<p>要创建这样一个子集，你需要在原始的的查询集两个最普遍的途径是：</p>\n<ul>\n<li><p><code>filter(**kwargs)</code></p>\n<p>返回一个新的查询集，它包含满足查询参数的对象。</p>\n</li>\n<li><p><code>exclude(**kwargs)</code></p>\n<p>返回一个新的查询集，它包含<em>不</em>满足查询参数的对象。</p>\n</li>\n</ul>\n<p>查询参数（上面函数定义中的<code>**kwargs</code>）需要满足特定的格式，下面[字段查询]一节中会提到。</p>\n<p>举个例子，要获取年份为2006的所有文章的查询集方法：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Entry.objects.filter(pub_date__year=2006)</span><br></pre></td></tr></table></figure>\n<p>利用默认的管理器，它相当于：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Entry.objects.all().filter(pub_date__year=2006)</span><br></pre></td></tr></table></figure>\n<h4 id=\"链式过滤\"><a href=\"#链式过滤\" class=\"headerlink\" title=\"链式过滤\"></a>链式过滤</h4><p>查询集，所以可以将筛选语句链接在一起。像这样：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; Entry.objects.filter(</span><br><span class=\"line\">...     headline__startswith=&apos;What&apos;</span><br><span class=\"line\">... ).exclude(</span><br><span class=\"line\">...     pub_date__gte=datetime.date.today()</span><br><span class=\"line\">... ).filter(</span><br><span class=\"line\">...     pub_date__gte=datetime(2005, 1, 30)</span><br><span class=\"line\">... )</span><br></pre></td></tr></table></figure>\n<p>这个例子最开始获取数据库中所有对象的一个查询集，它包含标题以”What“开头、发布日期在2005年1月30日至当天之间的所有记录。</p>\n<h4 id=\"过滤后的查询集是独立的\"><a href=\"#过滤后的查询集是独立的\" class=\"headerlink\" title=\"过滤后的查询集是独立的\"></a>过滤后的查询集是独立的</h4><p>每次你筛选一个查询集，它可以被存储及反复使用。</p>\n<p>例如：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; q1 = Entry.objects.filter(headline__startswith=&quot;What&quot;)</span><br><span class=\"line\">&gt;&gt;&gt; q2 = q1.exclude(pub_date__gte=datetime.date.today())</span><br><span class=\"line\">&gt;&gt;&gt; q3 = q1.filter(pub_date__gte=datetime.date.today())</span><br></pre></td></tr></table></figure>\n<p>这三个<code>查询集</code>都是独立的。第一个是一个基础的查询集不会受到筛选过程的影响。</p>\n<h4 id=\"查询集是惰性执行的\"><a href=\"#查询集是惰性执行的\" class=\"headerlink\" title=\"查询集是惰性执行的\"></a>查询集是惰性执行的</h4><p><code>查询集</code> 是惰性执行的 —— 创建查询集 需要<em>求值</em>时，Django 才会真正运行这个查询。看下这个例子：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; q = Entry.objects.filter(headline__startswith=&quot;What&quot;)</span><br><span class=\"line\">&gt;&gt;&gt; q = q.filter(pub_date__lte=datetime.date.today())</span><br><span class=\"line\">&gt;&gt;&gt; q = q.exclude(body_text__icontains=&quot;food&quot;)</span><br><span class=\"line\">&gt;&gt;&gt; print(q)</span><br></pre></td></tr></table></figure>\n<p>虽然它看上去有三次数据库访问，但事实上只有在最后一行（<code>print(q)</code>）时才访问一次数据库。一般来说，只有在“请求”查询集。</p>\n<h3 id=\"通过get-获取一个单一的对象\"><a href=\"#通过get-获取一个单一的对象\" class=\"headerlink\" title=\"通过get 获取一个单一的对象\"></a>通过get 获取一个单一的对象</h3><p>filter()将只包含一个元素。</p>\n<p>如果你知道只有一个对象满足你的查询，你可以使用管理器 方法，它直接返回该对象：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; one_entry = Entry.objects.get(pk=1)</span><br></pre></td></tr></table></figure>\n<p>可以对get()。</p>\n<p>注意，使用get() 将引发一个<code>DoesNotExist</code> 异常。这个异常是正在查询的模型类的一个属性 —— 所以在上面的代码中，如果没有主键为1 的<code>Entry</code> 对象，Django 将引发一个<code>Entry.DoesNotExist</code>。</p>\n<p>类似地，如果有多条记录满足get()，它同样是模型类自身的一个属性。</p>\n<h3 id=\"其它查询集方法\"><a href=\"#其它查询集方法\" class=\"headerlink\" title=\"其它查询集方法\"></a>其它查询集方法</h3><p>大多数情况下，需要从数据库中查找对象时，你会使用all()。</p>\n<h3 id=\"限制查询集\"><a href=\"#限制查询集\" class=\"headerlink\" title=\"限制查询集\"></a>限制查询集</h3><p>可以使用Python 的切片语法来限制查询集记录的数目 。它等同于SQL 的<code>LIMIT</code> 和<code>OFFSET</code> 子句。</p>\n<p>例如，下面的语句返回前面5 个对象(<code>LIMIT 5</code>)：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; Entry.objects.all()[:5]</span><br></pre></td></tr></table></figure>\n<p>下面这条语句返回第6 至第10 个对象(<code>OFFSET 5 LIMIT 5</code>)：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; Entry.objects.all()[5:10]</span><br></pre></td></tr></table></figure>\n<p>不支持负的索引（例如<code>Entry.objects.all()[-1]</code>）。</p>\n<p>通常，查询集 —— 它不会执行查询。有一个例外，是如果你使用Python 切片语法中”step”参数。例如，下面的语句将返回前10 个对象中每隔<em>2</em>个对象，它将真实执行查询：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; Entry.objects.all()[:10:2]</span><br></pre></td></tr></table></figure>\n<p>若要获取一个<em>单一</em>的对象而不是一个列表（例如，<code>SELECT foo FROM bar LIMIT 1</code>），可以简单地使用一个索引而不是切片。例如，下面的语句返回数据库中根据标题排序后的第一条<code>Entry</code>：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; Entry.objects.order_by(&apos;headline&apos;)[0]</span><br></pre></td></tr></table></figure>\n<p>它大体等同于：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; Entry.objects.order_by(&apos;headline&apos;)[0:1].get()</span><br></pre></td></tr></table></figure>\n<p>然而请注意，如果没有对象满足给定的条件，第一条语句将引发<code>IndexError</code>而第二条语句将引发<code>DoesNotExist</code>。 更多细节参见get()。</p>\n<h3 id=\"字段查询\"><a href=\"#字段查询\" class=\"headerlink\" title=\"字段查询\"></a>字段查询</h3><p>字段查询是指如何指定SQL <code>WHERE</code> 子句的内容。它们通过查询集 的关键字参数指定。</p>\n<p>查询的关键字参数的基本形式是<code>field__lookuptype=value</code>。（中间是两个下划线）。例如：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; Entry.objects.filter(pub_date__lte=&apos;2006-01-01&apos;)</span><br></pre></td></tr></table></figure>\n<p>翻译成SQL（大体）是：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">SELECT * FROM blog_entry WHERE pub_date &lt;= &apos;2006-01-01&apos;;</span><br></pre></td></tr></table></figure>\n<p>这是如何实现的</p>\n<p>Python 定义的函数可以接收任意的键/值对参数，这些名称和参数可以在运行时求值。更多信息，参见Python 官方文档中的<a href=\"https://docs.python.org/tutorial/controlflow.html#keyword-arguments\" target=\"_blank\" rel=\"noopener\">关键字参数</a>。</p>\n<p>查询条件中指定的字段必须是模型字段的名称。但有一个例外，对于ForeignKey你可以使用字段名加上<code>_id</code> 后缀。在这种情况下，该参数的值应该是外键的原始值。例如：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; Entry.objects.filter(blog_id=4)</span><br></pre></td></tr></table></figure>\n<p>如果你传递的是一个不合法的参数，查询函数将引发 <code>TypeError</code>。</p>\n<p>这些数据库API 支持大约二十多种查询的类型；在[<em>字段查询参考</em>] 中可以找到完整的参考。为了让你尝尝鲜，下面是一些你可能用到的常见查询：</p>\n<ul>\n<li><p>exact</p>\n<p>“精确”匹配。例如：<code>&gt;&gt;&gt; Entry.objects.get(headline__exact=&quot;Man bites dog&quot;)</code>将生成下面的SQL：<code>SELECT ... WHERE headline = &#39;Man bites dog&#39;;</code>如果你没有提供查询类型 —— 即如果你的关键字参数不包含双下划线 —— 默认假定查询类型是<code>exact</code>。例如，下面的两条语句相等：<code>&gt;&gt;&gt; Blog.objects.get(id__exact=14)  # Explicit form&gt;&gt;&gt; Blog.objects.get(id=14)         # __exact is implied</code>这是为了方便，因为<code>exact</code> 查询是最常见的情况。</p>\n</li>\n<li><p>iexact</p>\n<p>大小写不敏感的匹配。所以，查询：<code>&gt;&gt;&gt; Blog.objects.get(name__iexact=&quot;beatles blog&quot;)</code>将匹配标题为<code>&quot;Beatles Blog&quot;</code>、<code>&quot;beatles blog&quot;</code> 甚至<code>&quot;BeAtlES blOG&quot;</code> 的<code>Blog</code>。</p>\n</li>\n<li><p>contains</p>\n<p>大小写敏感的包含关系测试。例如：<code>Entry.objects.get(headline__contains=&#39;Lennon&#39;)</code>大体可以翻译成下面的SQL：<code>SELECT ... WHERE headline LIKE &#39;%Lennon%&#39;;</code>注意，这将匹配<code>&#39;Today Lennon honored&#39;</code> 但不能匹配<code>&#39;today lennon honored&#39;</code>。还有一个大小写不敏感的版本，icontains。</p>\n</li>\n<li><p>startswith</p>\n<p>分别表示以XXX开头和以XXX结尾。当然还有大小写不敏感的版本，叫做istartswith。</p>\n</li>\n</ul>\n<p>同样，这里只是表面。完整的参考可以在[<em>字段查询参考</em>]中找到。</p>\n<h3 id=\"跨关联关系的查询\"><a href=\"#跨关联关系的查询\" class=\"headerlink\" title=\"跨关联关系的查询\"></a>跨关联关系的查询</h3><p>Django 提供一种强大而又直观的方式来“处理”查询中的关联关系，它在后台自动帮你处理<code>JOIN</code>。 若要跨越关联关系，只需使用关联的模型字段的名称，并使用双下划线分隔，直至你想要的字段：</p>\n<p>下面这个例子获取所有<code>Blog</code> 的<code>name</code> 为<code>&#39;Beatles Blog&#39;</code> 的<code>Entry</code> 对象：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; Entry.objects.filter(blog__name=&apos;Beatles Blog&apos;)</span><br></pre></td></tr></table></figure>\n<p>这种跨越可以是任意的深度。</p>\n<p>它还可以反向工作。若要引用一个“反向”的关系，只需要使用该模型的小写的名称。</p>\n<p>下面的示例获取所有的<code>Blog</code> 对象，它们至少有一个<code>Entry</code> 的<code>headline</code> 包含<code>&#39;Lennon&#39;</code>：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; Blog.objects.filter(entry__headline__contains=&apos;Lennon&apos;)</span><br></pre></td></tr></table></figure>\n<p>如果你在多个关联关系直接过滤而且其中某个中介模型没有满足过滤条件的值，Django 将把它当做一个空的（所有的值都为<code>NULL</code>）但是合法的对象。这意味着不会有错误引发。例如，在下面的过滤器中：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Blog.objects.filter(entry__authors__name=&apos;Lennon&apos;)</span><br></pre></td></tr></table></figure>\n<p>（如果有一个相关联的<code>Author</code> 模型），如果Entry 中没有找到对应的<code>author</code>，那么它将当作其没有<code>name</code>，而不会因为没有<code>author</code> 引发一个错误。通常，这就是你想要的。唯一可能让你困惑的是当你使用isnull 的时候。因此：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Blog.objects.filter(entry__authors__name__isnull=True)</span><br></pre></td></tr></table></figure>\n<p>返回的<code>Blog</code> 对象包括<code>author</code> <strong><code>name</code> 为空的Blog对象,以及author</strong>name不为空但author<strong>name关联的<code>entry</code> </strong><code>author</code> 为空的对象。如果你不需要后者，你可以这样写：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Blog.objects.filter(entry__authors__isnull=False,</span><br><span class=\"line\">        entry__authors__name__isnull=True)</span><br></pre></td></tr></table></figure>\n<h4 id=\"跨越多值的关联关系\"><a href=\"#跨越多值的关联关系\" class=\"headerlink\" title=\"跨越多值的关联关系\"></a>跨越多值的关联关系</h4><p>当你基于ManyToManyField 来过滤一个对象时，有两种不同种类的过滤器。考虑<code>Blog</code>/<code>Entry</code> 关联关系（<code>Blog</code> 和 <code>Entry</code> 是一对多的关系）。我们可能想找出headline为<em>“Lennon”</em> 并且pub_date为’2008’年的Entry。或者我们可能想查询headline为<em>“Lennon”</em> 的Entry或者pub_date为’2008’的Entry。因为实际上有和单个<code>Blog</code> 相关联的多个Entry，所以这两个查询在某些场景下都是有可能并有意义的。</p>\n<p>ManyToManyField 叫做 <code>tags</code>，我们可能想找到tag 叫做<em>“music”</em> 和<em>“bands”</em> 的Entry，或者我们想找一个tag 名为<em>“music”</em> 且状态为<em>“public”</em>的Entry。</p>\n<p>对于这两种情况，Django 有种一致的方法来处理filter() 调用选择出来的对象。</p>\n<p>这些听起来可能有点混乱，所以希望展示一个例子使它变得更清晰。选择所有包含同时满足两个条件的entry的blog，这两个条件是headline 包含<em>Lennon</em> 和发表时间是2008 （同一个entry 满足两个条件），我们的代码是：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Blog.objects.filter(entry__headline__contains=&apos;Lennon&apos;,</span><br><span class=\"line\">        entry__pub_date__year=2008)</span><br></pre></td></tr></table></figure>\n<p>从所有的blog模型实例中选择满足以下条件的blog实例：blog的enrty的headline属性值是<em>“Lennon”**</em>，或者entry的**发表时间是2008（两个条件至少满足一个，也可以同时满足），我们的代码是：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Blog.objects.filter(entry__headline__contains=&apos;Lennon&apos;).filter(</span><br><span class=\"line\">        entry__pub_date__year=2008)</span><br></pre></td></tr></table></figure>\n<p>假设这里有一个blog拥有一条包含<em>‘Lennon’</em>的entries条目和一条来自2008的entries条目,但是没有一条来自2008并且包含<em>“Lennon”</em>的entries条目。第一个查询不会返回任何blog，第二个查询将会返回一个blog。</p>\n<p>在第二个例子中， 第一个filter 限定查询集中的blog 与headline 包含<em>“Lennon”</em> 的entry 关联。第二个filter <em>又</em> 限定查询集中的blog ，这些blog关联的entry 的发表时间是2008。（译者注：难点在如何理解further这个词！）第二个filter 过滤出来的entry 与第一个filter 过滤出来的entry 可能相同也可能不同。每个filter 语句过滤的是<code>Blog</code>，而不是<code>Entry</code>。</p>\n<p>注</p>\n<p>跨越多值关系的filter() 调用中的条件不必引用同一个记录。</p>\n<p>例如，下面的查询排除<em>*headline 中包含</em>“Lennon”<em>的Entry</em>和*在2008 年发布的Entry：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Blog.objects.exclude(</span><br><span class=\"line\">    entry__headline__contains=&apos;Lennon&apos;,</span><br><span class=\"line\">    entry__pub_date__year=2008,</span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n<p>然而，这与使用filter() 的行为不同，它不是排除同时满足两个条件的Entry。为了实现这点，即选择的Blog中不包含在2008年发布且healine 中带有<em>“Lennon”</em> 的Entry，你需要编写两个查询：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Blog.objects.exclude(</span><br><span class=\"line\">    entry=Entry.objects.filter(</span><br><span class=\"line\">        headline__contains=&apos;Lennon&apos;,</span><br><span class=\"line\">        pub_date__year=2008,</span><br><span class=\"line\">    ),</span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n<h3 id=\"Filter-可以引用模型的字段\"><a href=\"#Filter-可以引用模型的字段\" class=\"headerlink\" title=\"Filter 可以引用模型的字段\"></a>Filter 可以引用模型的字段</h3><p>到目前为止给出的示例中，我们构造过将模型字段与常量进行比较的filter。但是，如果你想将模型的一个字段与同一个模型的另外一个字段进行比较该怎么办？</p>\n<p>Django 提供F 表达式` 返回的实例用作查询内部对模型字段的引用。这些引用可以用于查询的filter 中来比较相同模型实例上不同字段之间值的比较。</p>\n<p>例如，为了查找comments 数目多于pingbacks 的Entry，我们将构造一个<code>F()</code> 对象来引用pingback 数目，并在查询中使用该<code>F()</code> 对象：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; from django.db.models import F</span><br><span class=\"line\">&gt;&gt;&gt; Entry.objects.filter(n_comments__gt=F(&apos;n_pingbacks&apos;))</span><br></pre></td></tr></table></figure>\n<p>Django 支持对<code>F()</code> 对象使用加法、减法、乘法、除法、取模以及幂计算等算术操作，两个操作数可以都是常数和其它<code>F()</code> 对象。为了查找comments 数目比pingbacks <em>两倍</em>还要多的Entry，我们将查询修改为：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; Entry.objects.filter(n_comments__gt=F(&apos;n_pingbacks&apos;) * 2)</span><br></pre></td></tr></table></figure>\n<p>New in Django 1.7:</p>\n<p>添加 <code>**</code> 操作符。</p>\n<p>为了查询rating 比pingback 和comment 数目总和要小的Entry，我们将这样查询：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; Entry.objects.filter(rating__lt=F(&apos;n_comments&apos;) + F(&apos;n_pingbacks&apos;))</span><br></pre></td></tr></table></figure>\n<p>你还可以在<code>F()</code> 对象中使用双下划线标记来跨越关联关系。带有双下划线的<code>F()</code> 对象将引入任何需要的join 操作以访问关联的对象。例如，如要获取author 的名字与blog 名字相同的Entry，我们可以这样查询：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; Entry.objects.filter(authors__name=F(&apos;blog__name&apos;))</span><br></pre></td></tr></table></figure>\n<p>对于date 和date/time 字段，你可以给它们加上或减去一个timedelta(<a href=\"https://docs.python.org/3/library/datetime.html#datetime.timedelta\" target=\"_blank\" rel=\"noopener\">https://docs.python.org/3/library/datetime.html#datetime.timedelta</a>) 对象。下面的例子将返回发布超过3天后被修改的所有Entry：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; from datetime import timedelta</span><br><span class=\"line\">&gt;&gt;&gt; Entry.objects.filter(mod_date__gt=F(&apos;pub_date&apos;) + timedelta(days=3))</span><br></pre></td></tr></table></figure>\n<p><code>F()</code> 对象支持<code>.bitand()</code> 和<code>.bitor()</code> 两种位操作，例如：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; F(&apos;somefield&apos;).bitand(16)</span><br></pre></td></tr></table></figure>\n<h3 id=\"查询的快捷方式pk\"><a href=\"#查询的快捷方式pk\" class=\"headerlink\" title=\"查询的快捷方式pk\"></a>查询的快捷方式pk</h3><p>为了方便，Django 提供一个查询快捷方式<code>pk</code> ，它表示“primary key” 的意思。</p>\n<p>在<code>Blog</code> 模型示例中，主键是<code>id</code> 字段，所以下面三条语句是等同的：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; Blog.objects.get(id__exact=14) # Explicit form</span><br><span class=\"line\">&gt;&gt;&gt; Blog.objects.get(id=14) # __exact is implied</span><br><span class=\"line\">&gt;&gt;&gt; Blog.objects.get(pk=14) # pk implies id__exact</span><br></pre></td></tr></table></figure>\n<p><code>pk</code> 的使用不仅限于<code>__exact</code> 查询 —— 任何查询类型都可以与<code>pk</code> 结合来完成一个模型上对主键的查询：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># Get blogs entries with id 1, 4 and 7</span><br><span class=\"line\">&gt;&gt;&gt; Blog.objects.filter(pk__in=[1,4,7])</span><br><span class=\"line\"></span><br><span class=\"line\"># Get all blog entries with id &gt; 14</span><br><span class=\"line\">&gt;&gt;&gt; Blog.objects.filter(pk__gt=14)</span><br></pre></td></tr></table></figure>\n<p><code>pk</code>查询在join 中也可以工作。例如，下面三个语句是等同的：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; Entry.objects.filter(blog__id__exact=3) # Explicit form</span><br><span class=\"line\">&gt;&gt;&gt; Entry.objects.filter(blog__id=3)        # __exact is implied</span><br><span class=\"line\">&gt;&gt;&gt; Entry.objects.filter(blog__pk=3)        # __pk implies __id__exact</span><br></pre></td></tr></table></figure>\n<h3 id=\"转义LIKE-语句中的百分号和下划线\"><a href=\"#转义LIKE-语句中的百分号和下划线\" class=\"headerlink\" title=\"转义LIKE 语句中的百分号和下划线\"></a>转义LIKE 语句中的百分号和下划线</h3><p>与<code>LIKE</code> SQL 语句等同的字段查询（<code>iexact</code>、 <code>contains</code>、<code>icontains</code>、<code>startswith</code>、 <code>istartswith</code>、<code>endswith</code> 和<code>iendswith</code>）将自动转义在<code>LIKE</code> 语句中使用的两个特殊的字符 —— 百分号和下划线。（在<code>LIKE</code> 语句中，百分号通配符表示多个字符，下划线通配符表示单个字符）。</p>\n<p>这意味着语句将很直观，不会显得太抽象。例如，要获取包含一个百分号的所有的Entry，只需要像其它任何字符一样使用百分号：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; Entry.objects.filter(headline__contains=&apos;%&apos;)</span><br></pre></td></tr></table></figure>\n<p>Django 会帮你转义；生成的SQL 看上去会是这样：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">SELECT ... WHERE headline LIKE &apos;%\\%%&apos;;</span><br></pre></td></tr></table></figure>\n<p>对于下划线是同样的道理。百分号和下划线都会透明地帮你处理。</p>\n<h3 id=\"缓存和查询集\"><a href=\"#缓存和查询集\" class=\"headerlink\" title=\"缓存和查询集\"></a>缓存和查询集</h3><p>每个查询集都包含一个缓存来最小化对数据库的访问。理解它是如何工作的将让你编写最高效的代码。</p>\n<p>在一个新创建的查询集 的求值将重用缓存的结果。</p>\n<p>请牢记这个缓存行为，因为对查询集，对它们求值，然后扔掉它们：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; print([e.headline for e in Entry.objects.all()])</span><br><span class=\"line\">&gt;&gt;&gt; print([e.pub_date for e in Entry.objects.all()])</span><br></pre></td></tr></table></figure>\n<p>这意味着相同的数据库查询将执行两次，显然倍增了你的数据库负载。同时，还有可能两个结果列表并不包含相同的数据库记录，因为在两次请求期间有可能有<code>Entry</code>被添加进来或删除掉。</p>\n<p>为了避免这个问题，只需保存查询集并重新使用它：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; queryset = Entry.objects.all()</span><br><span class=\"line\">&gt;&gt;&gt; print([p.headline for p in queryset]) # Evaluate the query set.</span><br><span class=\"line\">&gt;&gt;&gt; print([p.pub_date for p in queryset]) # Re-use the cache from the evaluation.</span><br></pre></td></tr></table></figure>\n<h4 id=\"何时查询集不会被缓存\"><a href=\"#何时查询集不会被缓存\" class=\"headerlink\" title=\"何时查询集不会被缓存\"></a>何时查询集不会被缓存</h4><p>查询集不会永远缓存它们的结果。当只对查询集的<em>部分</em>进行求值时会检查缓存， 但是如果这个部分不在缓存中，那么接下来查询返回的记录都将不会被缓存。特别地，这意味着使用切片或索引来[<em>限制查询集</em>]将不会填充缓存。</p>\n<p>例如，重复获取查询集对象中一个特定的索引将每次都查询数据库：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; queryset = Entry.objects.all()</span><br><span class=\"line\">&gt;&gt;&gt; print queryset[5] # Queries the database</span><br><span class=\"line\">&gt;&gt;&gt; print queryset[5] # Queries the database again</span><br></pre></td></tr></table></figure>\n<p>然而，如果已经对全部查询集求值过，则将检查缓存：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; queryset = Entry.objects.all()</span><br><span class=\"line\">&gt;&gt;&gt; [entry for entry in queryset] # Queries the database</span><br><span class=\"line\">&gt;&gt;&gt; print queryset[5] # Uses cache</span><br><span class=\"line\">&gt;&gt;&gt; print queryset[5] # Uses cache</span><br></pre></td></tr></table></figure>\n<p>下面是一些其它例子，它们会使得全部的查询集被求值并填充到缓存中：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; [entry for entry in queryset]</span><br><span class=\"line\">&gt;&gt;&gt; bool(queryset)</span><br><span class=\"line\">&gt;&gt;&gt; entry in queryset</span><br><span class=\"line\">&gt;&gt;&gt; list(queryset)</span><br></pre></td></tr></table></figure>\n<p>注</p>\n<p>简单地打印查询集不会填充缓存。因为<code>__repr__()</code> 调用只返回全部查询集的一个切片。</p>\n<h2 id=\"使用Q-对象进行复杂的查询\"><a href=\"#使用Q-对象进行复杂的查询\" class=\"headerlink\" title=\"使用Q 对象进行复杂的查询\"></a>使用Q 对象进行复杂的查询</h2><p>filter()。</p>\n<p>Q 对象 对象用于封装一组关键字参数。这些关键字参数就是上文“字段查询” 中所提及的那些。</p>\n<p>例如，下面的<code>Q</code> 对象封装一个<code>LIKE</code> 查询：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">from django.db.models import Q</span><br><span class=\"line\">Q(question__startswith=&apos;What&apos;)</span><br></pre></td></tr></table></figure>\n<p><code>Q</code> 对象可以使用<code>&amp;</code> 和<code>|</code> 操作符组合起来。当一个操作符在两个<code>Q</code> 对象上使用时，它产生一个新的<code>Q</code> 对象。</p>\n<p>例如，下面的语句产生一个<code>Q</code> 对象，表示两个<code>&quot;question__startswith&quot;</code> 查询的“OR” ：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Q(question__startswith=&apos;Who&apos;) | Q(question__startswith=&apos;What&apos;)</span><br></pre></td></tr></table></figure>\n<p>它等同于下面的SQL <code>WHERE</code> 子句：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">WHERE question LIKE &apos;Who%&apos; OR question LIKE &apos;What%&apos;</span><br></pre></td></tr></table></figure>\n<p>你可以组合<code>&amp;</code> 和<code>|</code>  操作符以及使用括号进行分组来编写任意复杂的<code>Q</code> 对象。同时，<code>Q</code> 对象可以使用<code>~</code> 操作符取反，这允许组合正常的查询和取反(<code>NOT</code>) 查询：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Q(question__startswith=&apos;Who&apos;) | ~Q(pub_date__year=2005)</span><br></pre></td></tr></table></figure>\n<p>每个接受关键字参数的查询函数（例如filter()）都可以传递一个或多个<code>Q</code> 对象作为位置（不带名的）参数。如果一个查询函数有多个<code>Q</code> 对象参数，这些参数的逻辑关系为“AND”。例如：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Poll.objects.get(</span><br><span class=\"line\">    Q(question__startswith=&apos;Who&apos;),</span><br><span class=\"line\">    Q(pub_date=date(2005, 5, 2)) | Q(pub_date=date(2005, 5, 6))</span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n<p>… 大体上可以翻译成这个SQL：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">SELECT * from polls WHERE question LIKE &apos;Who%&apos;</span><br><span class=\"line\">    AND (pub_date = &apos;2005-05-02&apos; OR pub_date = &apos;2005-05-06&apos;)</span><br></pre></td></tr></table></figure>\n<p>查询函数可以混合使用<code>Q 对象</code>和关键字参数。所有提供给查询函数的参数（关键字参数或<code>Q</code> 对象）都将”AND”在一起。但是，如果出现<code>Q</code> 对象，它必须位于所有关键字参数的前面。例如：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Poll.objects.get(</span><br><span class=\"line\">    Q(pub_date=date(2005, 5, 2)) | Q(pub_date=date(2005, 5, 6)),</span><br><span class=\"line\">    question__startswith=&apos;Who&apos;)</span><br></pre></td></tr></table></figure>\n<p>… 是一个合法的查询，等同于前面的例子；但是：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># INVALID QUERY</span><br><span class=\"line\">Poll.objects.get(</span><br><span class=\"line\">    question__startswith=&apos;Who&apos;,</span><br><span class=\"line\">    Q(pub_date=date(2005, 5, 2)) | Q(pub_date=date(2005, 5, 6)))</span><br></pre></td></tr></table></figure>\n<p>… 是不合法的。</p>\n<p>另见</p>\n<p>Django 单元测试中的<a href=\"https://github.com/django/django/blob/master/tests/or_lookups/tests.py\" target=\"_blank\" rel=\"noopener\">OR 查询示例</a>演示了几种<code>Q</code> 的用法。</p>\n<h2 id=\"比较对象\"><a href=\"#比较对象\" class=\"headerlink\" title=\"比较对象\"></a>比较对象</h2><p>为了比较两个模型实例，只需要使用标准的Python 比较操作符，即双等于符号：<code>==</code>。在后台，它会比较两个模型主键的值。</p>\n<p>利用上面的<code>Entry</code> 示例，下面两个语句是等同的：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; some_entry == other_entry</span><br><span class=\"line\">&gt;&gt;&gt; some_entry.id == other_entry.id</span><br></pre></td></tr></table></figure>\n<p>如果模型的主键不叫<code>id</code>，也没有问题。比较将始终使用主键，无论它叫什么。例如，如果模型的主键字段叫做<code>name</code>，下面的两条语句是等同的：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; some_obj == other_obj</span><br><span class=\"line\">&gt;&gt;&gt; some_obj.name == other_obj.name</span><br></pre></td></tr></table></figure>\n<h2 id=\"删除对象\"><a href=\"#删除对象\" class=\"headerlink\" title=\"删除对象\"></a>删除对象</h2><p>删除方法，为了方便，就取名为delete()。这个方法将立即删除对象且没有返回值。例如：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">e.delete()</span><br></pre></td></tr></table></figure>\n<p>你还可以批量删除对象。每个查询集中的所有成员。</p>\n<p>例如，下面的语句删除<code>pub_date</code> 为2005 的所有<code>Entry</code> 对象：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Entry.objects.filter(pub_date__year=2005).delete()</span><br></pre></td></tr></table></figure>\n<p>记住，这将尽可能地使用纯SQL 执行，所以这个过程中不需要调用每个对象实例的<code>delete()</code>方法。如果你给模型类提供了一个自定义的<code>delete()</code> 方法并希望确保它被调用，你需要手工删除该模型的实例（例如，迭代查询集 方法。</p>\n<p>当Django 删除一个对象时，它默认使用SQL <code>ON DELETE CASCADE</code> 约束 —— 换句话讲，任何有外键指向要删除对象的对象将一起删除。例如：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">b = Blog.objects.get(pk=1)</span><br><span class=\"line\"># This will delete the Blog and all of its Entry objects.</span><br><span class=\"line\">b.delete()</span><br></pre></td></tr></table></figure>\n<p>这种级联的行为可以通过的ForeignKey 参数自定义。</p>\n<p>注意，delete()`，而删除<em>所有</em> 的条目。如果你<em>确实</em>想删除所有的对象，你必须明确地请求一个完全的查询集：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Entry.objects.all().delete()</span><br></pre></td></tr></table></figure>\n<h2 id=\"拷贝模型实例\"><a href=\"#拷贝模型实例\" class=\"headerlink\" title=\"拷贝模型实例\"></a>拷贝模型实例</h2><p>虽然没有内建的方法用于拷贝模型实例，但还是很容易创建一个新的实例并让它的所有字段都拷贝过来。最简单的方法是，只需要将<code>pk</code> 设置为<code>None</code>。利用我们的Blog 示例：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">blog = Blog(name=&apos;My blog&apos;, tagline=&apos;Blogging is easy&apos;)</span><br><span class=\"line\">blog.save() # blog.pk == 1</span><br><span class=\"line\"></span><br><span class=\"line\">blog.pk = None</span><br><span class=\"line\">blog.save() # blog.pk == 2</span><br></pre></td></tr></table></figure>\n<p>如果你用继承，那么会复杂一些。考虑下面<code>Blog</code> 的子类：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class ThemeBlog(Blog):</span><br><span class=\"line\">    theme = models.CharField(max_length=200)</span><br><span class=\"line\"></span><br><span class=\"line\">django_blog = ThemeBlog(name=&apos;Django&apos;, tagline=&apos;Django is easy&apos;, theme=&apos;python&apos;)</span><br><span class=\"line\">django_blog.save() # django_blog.pk == 3</span><br></pre></td></tr></table></figure>\n<p>由于继承的工作方式，你必须设置<code>pk</code> 和 <code>id</code> 都为None：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">django_blog.pk = None</span><br><span class=\"line\">django_blog.id = None</span><br><span class=\"line\">django_blog.save() # django_blog.pk == 4</span><br></pre></td></tr></table></figure>\n<p>这个过程不会拷贝关联的对象。如果你想拷贝关联关系，你必须编写一些更多的代码。在我们的例子中，<code>Entry</code> 有一个到<code>Author</code> 的多对多字段：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">entry = Entry.objects.all()[0] # some previous entry</span><br><span class=\"line\">old_authors = entry.authors.all()</span><br><span class=\"line\">entry.pk = None</span><br><span class=\"line\">entry.save()</span><br><span class=\"line\">entry.authors = old_authors # saves new many2many relations</span><br></pre></td></tr></table></figure>\n<h2 id=\"一次更新多个对象\"><a href=\"#一次更新多个对象\" class=\"headerlink\" title=\"一次更新多个对象\"></a>一次更新多个对象</h2><p>有时你想为一个查询集 方法。例如：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># Update all the headlines with pub_date in 2007.</span><br><span class=\"line\">Entry.objects.filter(pub_date__year=2007).update(headline=&apos;Everything is the same&apos;)</span><br></pre></td></tr></table></figure>\n<p>你只可以对非关联字段和ForeignKey 字段，需设置新的值为你想指向的新的模型实例。例如：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; b = Blog.objects.get(pk=1)</span><br><span class=\"line\"></span><br><span class=\"line\"># Change every Entry so that it belongs to this Blog.</span><br><span class=\"line\">&gt;&gt;&gt; Entry.objects.all().update(blog=b)</span><br></pre></td></tr></table></figure>\n<p><code>update()</code> 方法会立即执行并返回查询匹配的行数（如果有些行已经具有新的值，返回的行数可能和被更新的行数不相等）。更新查询集 唯一的限制是它只能访问一个数据库表，也就是模型的主表。你可以根据关联的字段过滤，但是你只能更新模型主表中的列。例如：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; b = Blog.objects.get(pk=1)</span><br><span class=\"line\"></span><br><span class=\"line\"># Update all the headlines belonging to this Blog.</span><br><span class=\"line\">&gt;&gt;&gt; Entry.objects.select_related().filter(blog=b).update(headline=&apos;Everything is the same&apos;)</span><br></pre></td></tr></table></figure>\n<p>要注意<code>update()</code> 方法会直接转换成一个SQL 语句。它是一个批量的直接更新操作。它不会运行模型的save()：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">for item in my_queryset:</span><br><span class=\"line\">    item.save()</span><br></pre></td></tr></table></figure>\n<p>对update 的调用也可以使用F 表达式 来根据模型中的一个字段更新另外一个字段。这对于在当前值的基础上加上一个值特别有用。例如，增加Blog 中每个Entry 的pingback 个数：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; Entry.objects.all().update(n_pingbacks=F(&apos;n_pingbacks&apos;) + 1)</span><br></pre></td></tr></table></figure>\n<p>然而，与filter 和exclude 子句中的<code>F()</code> 对象不同，在update 中你不可以使用<code>F()</code> 对象引入join —— 你只可以引用正在更新的模型的字段。如果你尝试使用<code>F()</code> 对象引入一个join，将引发一个<code>FieldError</code>：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># THIS WILL RAISE A FieldError</span><br><span class=\"line\">&gt;&gt;&gt; Entry.objects.update(headline=F(&apos;blog__name&apos;))</span><br></pre></td></tr></table></figure>\n<h2 id=\"关联的对象\"><a href=\"#关联的对象\" class=\"headerlink\" title=\"关联的对象\"></a>关联的对象</h2><p>当你在一个模型中定义一个关联关系时（例如，ForeignKey），该模型的实例将带有一个方便的API 来访问关联的对象。</p>\n<p>利用本页顶部的模型，一个<code>Entry</code> 对象<code>e</code> 可以通过<code>blog</code> 属性<code>e.blog</code> 获取关联的<code>Blog</code> 对象。</p>\n<p>（在幕后，这个功能是通过Python 的[描述器]实现的。这应该不会对你有什么真正的影响，但是这里我们指出它以满足你的好奇）。</p>\n<p>Django 还会创建API 用于访问关联关系的另一头 —— 从关联的模型访问定义关联关系的模型。例如，<code>Blog</code> 对象<code>b</code> 可以通过<code>entry_set</code> 属性 <code>b.entry_set.all()</code>访问与它关联的所有<code>Entry</code> 对象。</p>\n<p>这一节中的所有示例都将使用本页顶部定义的<code>Blog</code>、 <code>Author</code> 和<code>Entry</code> 模型。</p>\n<h3 id=\"一对多关系\"><a href=\"#一对多关系\" class=\"headerlink\" title=\"一对多关系\"></a>一对多关系</h3><h4 id=\"前向查询\"><a href=\"#前向查询\" class=\"headerlink\" title=\"前向查询\"></a>前向查询</h4><p>如果一个模型具有ForeignKey，那么该模型的实例将可以通过属性访问关联的（外部）对象。</p>\n<p>例如：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; e = Entry.objects.get(id=2)</span><br><span class=\"line\">&gt;&gt;&gt; e.blog # Returns the related Blog object.</span><br></pre></td></tr></table></figure>\n<p>你可以通过外键属性获取和设置。和你预期的一样，对外键的修改不会保存到数据库中直至你调用save()。例如：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; e = Entry.objects.get(id=2)</span><br><span class=\"line\">&gt;&gt;&gt; e.blog = some_blog</span><br><span class=\"line\">&gt;&gt;&gt; e.save()</span><br></pre></td></tr></table></figure>\n<p>如果ForeignKey 字段有<code>null=True</code> 设置（即它允许<code>NULL</code> 值），你可以分配<code>None</code> 来删除对应的关联性。例如：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; e = Entry.objects.get(id=2)</span><br><span class=\"line\">&gt;&gt;&gt; e.blog = None</span><br><span class=\"line\">&gt;&gt;&gt; e.save() # &quot;UPDATE blog_entry SET blog_id = NULL ...;&quot;</span><br></pre></td></tr></table></figure>\n<p>一对多关联关系的前向访问在第一次访问关联的对象时被缓存。以后对同一个对象的外键的访问都使用缓存。例如：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; e = Entry.objects.get(id=2)</span><br><span class=\"line\">&gt;&gt;&gt; print(e.blog)  # Hits the database to retrieve the associated Blog.</span><br><span class=\"line\">&gt;&gt;&gt; print(e.blog)  # Doesn&apos;t hit the database; uses cached version.</span><br></pre></td></tr></table></figure>\n<p>注意select_related()方法递归地预填充所有的一对多关系到缓存中。例如：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; e = Entry.objects.select_related().get(id=2)</span><br><span class=\"line\">&gt;&gt;&gt; print(e.blog)  # Doesn&apos;t hit the database; uses cached version.</span><br><span class=\"line\">&gt;&gt;&gt; print(e.blog)  # Doesn&apos;t hit the database; uses cached version.</span><br></pre></td></tr></table></figure>\n<h4 id=\"反向查询\"><a href=\"#反向查询\" class=\"headerlink\" title=\"反向查询\"></a>反向查询</h4><p>如果模型I有一个ForeignKey返回的<code>查询集</code>可以用上一节提到的方式进行过滤和操作。</p>\n<p>例如：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; b = Blog.objects.get(id=1)</span><br><span class=\"line\">&gt;&gt;&gt; b.entry_set.all() # Returns all Entry objects related to Blog.</span><br><span class=\"line\"></span><br><span class=\"line\"># b.entry_set is a Manager that returns QuerySets.</span><br><span class=\"line\">&gt;&gt;&gt; b.entry_set.filter(headline__contains=&apos;Lennon&apos;)</span><br><span class=\"line\">&gt;&gt;&gt; b.entry_set.count()</span><br></pre></td></tr></table></figure>\n<p>你可以在ForeignKey`，那么上面的示例代码应该改成这样：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; b = Blog.objects.get(id=1)</span><br><span class=\"line\">&gt;&gt;&gt; b.entries.all() # Returns all Entry objects related to Blog.</span><br><span class=\"line\"></span><br><span class=\"line\"># b.entries is a Manager that returns QuerySets.</span><br><span class=\"line\">&gt;&gt;&gt; b.entries.filter(headline__contains=&apos;Lennon&apos;)</span><br><span class=\"line\">&gt;&gt;&gt; b.entries.count()</span><br></pre></td></tr></table></figure>\n<h4 id=\"使用自定义的反向管理器\"><a href=\"#使用自定义的反向管理器\" class=\"headerlink\" title=\"使用自定义的反向管理器\"></a>使用自定义的反向管理器</h4><p>New in Django 1.7.</p>\n<p>默认情况下，用于反向关联关系的RelatedManager 的子类。如果你想为一个查询指定一个不同的管理器，你可以使用下面的语法：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">from django.db import models</span><br><span class=\"line\"></span><br><span class=\"line\">class Entry(models.Model):</span><br><span class=\"line\">    #...</span><br><span class=\"line\">    objects = models.Manager()  # Default Manager</span><br><span class=\"line\">    entries = EntryManager()    # Custom Manager</span><br><span class=\"line\"></span><br><span class=\"line\">b = Blog.objects.get(id=1)</span><br><span class=\"line\">b.entry_set(manager=&apos;entries&apos;).all()</span><br></pre></td></tr></table></figure>\n<p>如果<code>EntryManager</code> 在它的<code>get_queryset()</code> 方法中使用默认的过滤，那么该过滤将适用于<code>all()</code> 调用。</p>\n<p>当然，指定一个自定义的管理器还可以让你调用自定义的方法：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">b.entry_set(manager=&apos;entries&apos;).is_published()</span><br></pre></td></tr></table></figure>\n<h4 id=\"处理关联对象的其它方法\"><a href=\"#处理关联对象的其它方法\" class=\"headerlink\" title=\"处理关联对象的其它方法\"></a>处理关联对象的其它方法</h4><p>除了在上面”获取对象“一节中定义的查询集 中找到。</p>\n<ul>\n<li><p><code>add(obj1, obj2, ...)</code></p>\n<p>添加一指定的模型对象到关联的对象集中。</p>\n</li>\n<li><p><code>create(**kwargs)</code></p>\n<p>创建一个新的对象，将它保存并放在关联的对象集中。返回新创建的对象。</p>\n</li>\n<li><p><code>remove(obj1, obj2, ...)</code></p>\n<p>从关联的对象集中删除指定的模型对象。</p>\n</li>\n<li><p><code>clear()</code></p>\n<p>从关联的对象集中删除所有的对象。</p>\n</li>\n</ul>\n<p>若要一次性给关联的对象集赋值，只需要给它赋值一个可迭代的对象。这个可迭代的对象可以包含对象的实例，或者一个主键值的列表。例如：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">b = Blog.objects.get(id=1)</span><br><span class=\"line\">b.entry_set = [e1, e2]</span><br></pre></td></tr></table></figure>\n<p>在这个例子中，<code>e1</code> 和<code>e2</code> 可以是Entry 实例，也可以是主键的整数值。</p>\n<p>如果有<code>clear()</code> 方法，那么在将可迭代对象中的成员添加到集合中之前，将从<code>entry_set</code> 中删除所有已经存在的对象。如果<em>没有</em><code>clear()</code> 方法，那么将直接添加可迭代对象中的成员而不会删除所有已存在的对象。</p>\n<p>这一节中提到的每个”反向“操作都会立即对数据库产生作用。每个添加、创建和删除操作都会立即并自动保存到数据库中。</p>\n<h3 id=\"多对多关系\"><a href=\"#多对多关系\" class=\"headerlink\" title=\"多对多关系\"></a>多对多关系</h3><p>多对多关系的两端都会自动获得访问另一端的API。这些API 的工作方式与上面提到的“方向”一对多关系一样。</p>\n<p>唯一的区别在于属性的名称：定义 ManyToManyField 的模型使用该字段的属性名称，而“反向”模型使用源模型的小写名称加上<code>&#39;_set&#39;</code> （和一对多关系一样）。</p>\n<p>一个例子可以让它更好理解：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">e = Entry.objects.get(id=3)</span><br><span class=\"line\">e.authors.all() # Returns all Author objects for this Entry.</span><br><span class=\"line\">e.authors.count()</span><br><span class=\"line\">e.authors.filter(name__contains=&apos;John&apos;)</span><br><span class=\"line\"></span><br><span class=\"line\">a = Author.objects.get(id=5)</span><br><span class=\"line\">a.entry_set.all() # Returns all Entry objects for this Author.</span><br></pre></td></tr></table></figure>\n<p>类似ForeignKey 指定<code>related_name=&#39;entries&#39;</code>，那么<code>Author</code> 实例将使用 <code>entries</code> 属性而不是<code>entry_set</code>。</p>\n<h3 id=\"一对一关系\"><a href=\"#一对一关系\" class=\"headerlink\" title=\"一对一关系\"></a>一对一关系</h3><p>一对一关系与多对一关系非常相似。如果你在模型中定义一个OneToOneField，该模型的实例将可以通过该模型的一个简单属性访问关联的模型。</p>\n<p>例如：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class EntryDetail(models.Model):</span><br><span class=\"line\">    entry = models.OneToOneField(Entry)</span><br><span class=\"line\">    details = models.TextField()</span><br><span class=\"line\"></span><br><span class=\"line\">ed = EntryDetail.objects.get(id=2)</span><br><span class=\"line\">ed.entry # Returns the related Entry object.</span><br></pre></td></tr></table></figure>\n<p>在“反向”查询中有所不同。一对一关系中的关联模型同样具有一个管理器表示一个单一的对象而不是对象的集合：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">e = Entry.objects.get(id=2)</span><br><span class=\"line\">e.entrydetail # returns the related EntryDetail object</span><br></pre></td></tr></table></figure>\n<p>如果没有对象赋值给这个关联关系，Django 将引发一个<code>DoesNotExist</code> 异常。</p>\n<p>实例可以赋值给反向的关联关系，方法和正向的关联关系一样：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">e.entrydetail = ed</span><br></pre></td></tr></table></figure>\n<h3 id=\"反向的关联关系是如何实现的？\"><a href=\"#反向的关联关系是如何实现的？\" class=\"headerlink\" title=\"反向的关联关系是如何实现的？\"></a>反向的关联关系是如何实现的？</h3><p>其它对象关系映射要求你在关联关系的两端都要定义。Django 的开发人员相信这是对DRY（不要重复你自己的代码）原则的违背，所以Django 只要求你在一端定义关联关系。</p>\n<p>但是这怎么可能？因为一个模型类直到其它模型类被加载之后才知道哪些模型类是关联的。</p>\n<p>答案在app registry 中列出的每个应用，然后导入每个应用中的<code>models</code>模块。每创建一个新的模型时，Django 添加反向的关系到所有关联的模型。如果关联的模型还没有导入，Django 将保存关联关系的记录并在最终关联的模型导入时添加这些关联关系。</p>\n<p>由于这个原因，你使用的所有模型都定义在INSTALLED_APPS 列出的应用中就显得特别重要。否则，反向的关联关系将不能正确工作。</p>\n<h3 id=\"通过关联的对象进行查询\"><a href=\"#通过关联的对象进行查询\" class=\"headerlink\" title=\"通过关联的对象进行查询\"></a>通过关联的对象进行查询</h3><p>在关联对象字段上的查询与正常字段的查询遵循同样的规则。当你指定查询需要匹配的一个值时，你可以使用一个对象实例或者对象的主键的值。</p>\n<p>例如，如果你有一个<code>id=5</code> 的Blog 对象<code>b</code>，下面的三个查询将是完全一样的：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Entry.objects.filter(blog=b) # Query using object instance</span><br><span class=\"line\">Entry.objects.filter(blog=b.id) # Query using id from instance</span><br><span class=\"line\">Entry.objects.filter(blog=5) # Query using id directly</span><br></pre></td></tr></table></figure>\n<h2 id=\"回归到原始的-SQL\"><a href=\"#回归到原始的-SQL\" class=\"headerlink\" title=\"回归到原始的 SQL\"></a>回归到原始的 SQL</h2><p>如果你发现需要编写的SQL 查询对于Django 的数据库映射机制太复杂，你可以回归到手工编写SQL。Django 对于编写原始的SQL 查询有多个选项；参见[<em>执行原始的SQL 查询</em>]。</p>\n<p>最后，值得注意的是Django 的数据库层只是数据库的一个接口。你可以利用其它工具、编程语言或数据库框架来访问数据库；对于数据库，Django 没有什么特别的地方。</p>"},{"title":"Django快速上手笔记之安装Django","date":"2017-10-02T04:33:17.000Z","_content":"\n### Django简介\n\nDjango是一款开源的web框架，由python编写。采用了MVC的框架模式。Django最初是被用来开发用于管理劳伦斯出版集团旗下的一些以新闻内容为主的网站（CMS）,于2005年以BSD许可证发布。\n\n<!--more -->\n\nDjango的设计之美：\n\n- 对象关系映射（ORM）:以Python类形式定义数据模型，ORM将模型和关系数据库连接起来，得到一个十分容易使用的数据库API,同时在Django中也可以使用原生SQL语句。\n- URL路由：使用正则表达式匹配URL,可以设计任意的URL，没有框架的特定限定，十分灵活。\n- 模版系统：使用Django强大而可扩展的模版语言，可以分隔设计、内容和Python代码。具有可继承性。\n- 表单处理：可以方便的生成各种表单模型，实现表单的有效性检验。可以方便的从你定义的模型实例生成对应的表单。\n- Cache系统：可以挂载内存缓冲或其它的框架实现超级缓冲。\n- 会话（session），用户登录与权限检查，快速开发用户会话功能。\n- 国际化：内置国际化系统，方便开发出多种语言的网站。\n- 自动化的管理界面：不需要你花大量的工作来创建人员管理和更新内容。Django自带一个Admin site，类似于内容管理系统。\n\n总的来说，Django是一个大而全的框架，你所需要的它都有。那么怎么来使用它呢？怎么去一步一步的学习使用它呢？从本篇博文开始，我就要开始探索Django框架了。\n### 安装Django\n首先从安装开始，安装方式有两种：使用pip安装或源码安装。\npip安装很简单，在配置好python环境后，在命令提示符下或终端输入pip install django就行了。下面是我在自己的windowns电脑上的安装记录：\n```powershell\nPS C:\\Users\\star-chen> pip install django\nCollecting django\n  Downloading Django-1.11.5-py2.py3-none-any.whl (6.9MB)\n    100% |████████████████████████████████| 7.0MB 149kB/s\nCollecting pytz (from django)\n  Downloading pytz-2017.2-py2.py3-none-any.whl (484kB)\n    100% |████████████████████████████████| 491kB 377kB/s\nInstalling collected packages: pytz, django\nSuccessfully installed django-1.11.5 pytz-2017.2\nYou are using pip version 8.1.2, however version 9.0.1 is available.\nYou should consider upgrading via the 'python -m pip install --upgrade pip' command.\n```\n\n源码安装：\n\n从github上的Django项目上下载相关的release压缩包 \nhttps://github.com/django/django/releases，\n选择你所需要的版本。这里我下载1.11.5版本的zip格式压缩包。将下载到的压缩包解压到任何目录，在该目录按住shift键再鼠标右击，打开命令提示符，输入python选择你所需要的版本。这里我下载1.11.5版本的zip格式压缩包。将下载到的压缩包解压到任何目录，在该目录按住shift键再鼠标右击，打开命令提示符，输入python setup.py install即可。\n\n```powershell\nPS F:\\一些源码\\django-1.11.5> python .\\setup.py install\n```\n\n为了日后使用方便，可以将Django的相关可执行文件添加到系统的可执行目录。\n\n```\nC:\\Python27\\Scripts\n```\n\n在我的机器上，没进行添加环境变量也可以正常调用django命令了，就省去这个步骤了。\n\n```pow\nPS C:\\Users\\star-chen> django-admin\n\nType 'django-admin-script.py help <subcommand>' for help on a specific subcommand.\n\nAvailable subcommands:\n\n[django]\n    check\n    compilemessages\n    createcachetable\n    dbshell\n    diffsettings\n    dumpdata\n    flush\n    inspectdb\n    loaddata\n    makemessages\n    makemigrations\n    migrate\n    runserver\n    sendtestemail\n    shell\n    showmigrations\n    sqlflush\n    sqlmigrate\n    sqlsequencereset\n    squashmigrations\n    startapp\n    startproject\n    test\n    testserver\n```\n\n\n\nOK,安装过程就是这么简单，接下来就是实际体验时刻了，下篇博文见。","source":"_posts/Django-install.md","raw":"---\ntitle: Django快速上手笔记之安装Django\ncategories:\n  - Program\ntags:\n  - python web Django\ndate: 2017-10-02 12:33:17\n---\n\n### Django简介\n\nDjango是一款开源的web框架，由python编写。采用了MVC的框架模式。Django最初是被用来开发用于管理劳伦斯出版集团旗下的一些以新闻内容为主的网站（CMS）,于2005年以BSD许可证发布。\n\n<!--more -->\n\nDjango的设计之美：\n\n- 对象关系映射（ORM）:以Python类形式定义数据模型，ORM将模型和关系数据库连接起来，得到一个十分容易使用的数据库API,同时在Django中也可以使用原生SQL语句。\n- URL路由：使用正则表达式匹配URL,可以设计任意的URL，没有框架的特定限定，十分灵活。\n- 模版系统：使用Django强大而可扩展的模版语言，可以分隔设计、内容和Python代码。具有可继承性。\n- 表单处理：可以方便的生成各种表单模型，实现表单的有效性检验。可以方便的从你定义的模型实例生成对应的表单。\n- Cache系统：可以挂载内存缓冲或其它的框架实现超级缓冲。\n- 会话（session），用户登录与权限检查，快速开发用户会话功能。\n- 国际化：内置国际化系统，方便开发出多种语言的网站。\n- 自动化的管理界面：不需要你花大量的工作来创建人员管理和更新内容。Django自带一个Admin site，类似于内容管理系统。\n\n总的来说，Django是一个大而全的框架，你所需要的它都有。那么怎么来使用它呢？怎么去一步一步的学习使用它呢？从本篇博文开始，我就要开始探索Django框架了。\n### 安装Django\n首先从安装开始，安装方式有两种：使用pip安装或源码安装。\npip安装很简单，在配置好python环境后，在命令提示符下或终端输入pip install django就行了。下面是我在自己的windowns电脑上的安装记录：\n```powershell\nPS C:\\Users\\star-chen> pip install django\nCollecting django\n  Downloading Django-1.11.5-py2.py3-none-any.whl (6.9MB)\n    100% |████████████████████████████████| 7.0MB 149kB/s\nCollecting pytz (from django)\n  Downloading pytz-2017.2-py2.py3-none-any.whl (484kB)\n    100% |████████████████████████████████| 491kB 377kB/s\nInstalling collected packages: pytz, django\nSuccessfully installed django-1.11.5 pytz-2017.2\nYou are using pip version 8.1.2, however version 9.0.1 is available.\nYou should consider upgrading via the 'python -m pip install --upgrade pip' command.\n```\n\n源码安装：\n\n从github上的Django项目上下载相关的release压缩包 \nhttps://github.com/django/django/releases，\n选择你所需要的版本。这里我下载1.11.5版本的zip格式压缩包。将下载到的压缩包解压到任何目录，在该目录按住shift键再鼠标右击，打开命令提示符，输入python选择你所需要的版本。这里我下载1.11.5版本的zip格式压缩包。将下载到的压缩包解压到任何目录，在该目录按住shift键再鼠标右击，打开命令提示符，输入python setup.py install即可。\n\n```powershell\nPS F:\\一些源码\\django-1.11.5> python .\\setup.py install\n```\n\n为了日后使用方便，可以将Django的相关可执行文件添加到系统的可执行目录。\n\n```\nC:\\Python27\\Scripts\n```\n\n在我的机器上，没进行添加环境变量也可以正常调用django命令了，就省去这个步骤了。\n\n```pow\nPS C:\\Users\\star-chen> django-admin\n\nType 'django-admin-script.py help <subcommand>' for help on a specific subcommand.\n\nAvailable subcommands:\n\n[django]\n    check\n    compilemessages\n    createcachetable\n    dbshell\n    diffsettings\n    dumpdata\n    flush\n    inspectdb\n    loaddata\n    makemessages\n    makemigrations\n    migrate\n    runserver\n    sendtestemail\n    shell\n    showmigrations\n    sqlflush\n    sqlmigrate\n    sqlsequencereset\n    squashmigrations\n    startapp\n    startproject\n    test\n    testserver\n```\n\n\n\nOK,安装过程就是这么简单，接下来就是实际体验时刻了，下篇博文见。","slug":"Django-install","published":1,"updated":"2017-12-04T07:27:28.745Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjeqig1kk000ylgqau67h9fov","content":"<h3 id=\"Django简介\"><a href=\"#Django简介\" class=\"headerlink\" title=\"Django简介\"></a>Django简介</h3><p>Django是一款开源的web框架，由python编写。采用了MVC的框架模式。Django最初是被用来开发用于管理劳伦斯出版集团旗下的一些以新闻内容为主的网站（CMS）,于2005年以BSD许可证发布。</p>\n<a id=\"more\"></a>\n<p>Django的设计之美：</p>\n<ul>\n<li>对象关系映射（ORM）:以Python类形式定义数据模型，ORM将模型和关系数据库连接起来，得到一个十分容易使用的数据库API,同时在Django中也可以使用原生SQL语句。</li>\n<li>URL路由：使用正则表达式匹配URL,可以设计任意的URL，没有框架的特定限定，十分灵活。</li>\n<li>模版系统：使用Django强大而可扩展的模版语言，可以分隔设计、内容和Python代码。具有可继承性。</li>\n<li>表单处理：可以方便的生成各种表单模型，实现表单的有效性检验。可以方便的从你定义的模型实例生成对应的表单。</li>\n<li>Cache系统：可以挂载内存缓冲或其它的框架实现超级缓冲。</li>\n<li>会话（session），用户登录与权限检查，快速开发用户会话功能。</li>\n<li>国际化：内置国际化系统，方便开发出多种语言的网站。</li>\n<li>自动化的管理界面：不需要你花大量的工作来创建人员管理和更新内容。Django自带一个Admin site，类似于内容管理系统。</li>\n</ul>\n<p>总的来说，Django是一个大而全的框架，你所需要的它都有。那么怎么来使用它呢？怎么去一步一步的学习使用它呢？从本篇博文开始，我就要开始探索Django框架了。</p>\n<h3 id=\"安装Django\"><a href=\"#安装Django\" class=\"headerlink\" title=\"安装Django\"></a>安装Django</h3><p>首先从安装开始，安装方式有两种：使用pip安装或源码安装。<br>pip安装很简单，在配置好python环境后，在命令提示符下或终端输入pip install django就行了。下面是我在自己的windowns电脑上的安装记录：<br><figure class=\"highlight powershell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PS C:\\Users\\star-chen&gt; pip install django</span><br><span class=\"line\">Collecting django</span><br><span class=\"line\">  Downloading Django-<span class=\"number\">1.11</span>.<span class=\"number\">5</span>-py2.py3-none-any.whl (<span class=\"number\">6.9</span>MB)</span><br><span class=\"line\">    <span class=\"number\">100</span>% |████████████████████████████████| <span class=\"number\">7.0</span>MB <span class=\"number\">149</span>kB/s</span><br><span class=\"line\">Collecting pytz (from django)</span><br><span class=\"line\">  Downloading pytz-<span class=\"number\">2017.2</span>-py2.py3-none-any.whl (<span class=\"number\">484</span>kB)</span><br><span class=\"line\">    <span class=\"number\">100</span>% |████████████████████████████████| <span class=\"number\">491</span>kB <span class=\"number\">377</span>kB/s</span><br><span class=\"line\">Installing collected packages: pytz, django</span><br><span class=\"line\">Successfully installed django-<span class=\"number\">1.11</span>.<span class=\"number\">5</span> pytz-<span class=\"number\">2017.2</span></span><br><span class=\"line\">You are using pip version <span class=\"number\">8.1</span>.<span class=\"number\">2</span>, however version <span class=\"number\">9.0</span>.<span class=\"number\">1</span> is available.</span><br><span class=\"line\">You should consider upgrading via the <span class=\"string\">'python -m pip install --upgrade pip'</span> command.</span><br></pre></td></tr></table></figure></p>\n<p>源码安装：</p>\n<p>从github上的Django项目上下载相关的release压缩包<br><a href=\"https://github.com/django/django/releases，\" target=\"_blank\" rel=\"noopener\">https://github.com/django/django/releases，</a><br>选择你所需要的版本。这里我下载1.11.5版本的zip格式压缩包。将下载到的压缩包解压到任何目录，在该目录按住shift键再鼠标右击，打开命令提示符，输入python选择你所需要的版本。这里我下载1.11.5版本的zip格式压缩包。将下载到的压缩包解压到任何目录，在该目录按住shift键再鼠标右击，打开命令提示符，输入python setup.py install即可。</p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PS F:\\一些源码\\django-<span class=\"number\">1.11</span>.<span class=\"number\">5</span>&gt; python .\\setup.py install</span><br></pre></td></tr></table></figure>\n<p>为了日后使用方便，可以将Django的相关可执行文件添加到系统的可执行目录。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">C:\\Python27\\Scripts</span><br></pre></td></tr></table></figure>\n<p>在我的机器上，没进行添加环境变量也可以正常调用django命令了，就省去这个步骤了。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PS C:\\Users\\star-chen&gt; django-admin</span><br><span class=\"line\"></span><br><span class=\"line\">Type &apos;django-admin-script.py help &lt;subcommand&gt;&apos; for help on a specific subcommand.</span><br><span class=\"line\"></span><br><span class=\"line\">Available subcommands:</span><br><span class=\"line\"></span><br><span class=\"line\">[django]</span><br><span class=\"line\">    check</span><br><span class=\"line\">    compilemessages</span><br><span class=\"line\">    createcachetable</span><br><span class=\"line\">    dbshell</span><br><span class=\"line\">    diffsettings</span><br><span class=\"line\">    dumpdata</span><br><span class=\"line\">    flush</span><br><span class=\"line\">    inspectdb</span><br><span class=\"line\">    loaddata</span><br><span class=\"line\">    makemessages</span><br><span class=\"line\">    makemigrations</span><br><span class=\"line\">    migrate</span><br><span class=\"line\">    runserver</span><br><span class=\"line\">    sendtestemail</span><br><span class=\"line\">    shell</span><br><span class=\"line\">    showmigrations</span><br><span class=\"line\">    sqlflush</span><br><span class=\"line\">    sqlmigrate</span><br><span class=\"line\">    sqlsequencereset</span><br><span class=\"line\">    squashmigrations</span><br><span class=\"line\">    startapp</span><br><span class=\"line\">    startproject</span><br><span class=\"line\">    test</span><br><span class=\"line\">    testserver</span><br></pre></td></tr></table></figure>\n<p>OK,安装过程就是这么简单，接下来就是实际体验时刻了，下篇博文见。</p>\n","site":{"data":{}},"excerpt":"<h3 id=\"Django简介\"><a href=\"#Django简介\" class=\"headerlink\" title=\"Django简介\"></a>Django简介</h3><p>Django是一款开源的web框架，由python编写。采用了MVC的框架模式。Django最初是被用来开发用于管理劳伦斯出版集团旗下的一些以新闻内容为主的网站（CMS）,于2005年以BSD许可证发布。</p>","more":"<p>Django的设计之美：</p>\n<ul>\n<li>对象关系映射（ORM）:以Python类形式定义数据模型，ORM将模型和关系数据库连接起来，得到一个十分容易使用的数据库API,同时在Django中也可以使用原生SQL语句。</li>\n<li>URL路由：使用正则表达式匹配URL,可以设计任意的URL，没有框架的特定限定，十分灵活。</li>\n<li>模版系统：使用Django强大而可扩展的模版语言，可以分隔设计、内容和Python代码。具有可继承性。</li>\n<li>表单处理：可以方便的生成各种表单模型，实现表单的有效性检验。可以方便的从你定义的模型实例生成对应的表单。</li>\n<li>Cache系统：可以挂载内存缓冲或其它的框架实现超级缓冲。</li>\n<li>会话（session），用户登录与权限检查，快速开发用户会话功能。</li>\n<li>国际化：内置国际化系统，方便开发出多种语言的网站。</li>\n<li>自动化的管理界面：不需要你花大量的工作来创建人员管理和更新内容。Django自带一个Admin site，类似于内容管理系统。</li>\n</ul>\n<p>总的来说，Django是一个大而全的框架，你所需要的它都有。那么怎么来使用它呢？怎么去一步一步的学习使用它呢？从本篇博文开始，我就要开始探索Django框架了。</p>\n<h3 id=\"安装Django\"><a href=\"#安装Django\" class=\"headerlink\" title=\"安装Django\"></a>安装Django</h3><p>首先从安装开始，安装方式有两种：使用pip安装或源码安装。<br>pip安装很简单，在配置好python环境后，在命令提示符下或终端输入pip install django就行了。下面是我在自己的windowns电脑上的安装记录：<br><figure class=\"highlight powershell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PS C:\\Users\\star-chen&gt; pip install django</span><br><span class=\"line\">Collecting django</span><br><span class=\"line\">  Downloading Django-<span class=\"number\">1.11</span>.<span class=\"number\">5</span>-py2.py3-none-any.whl (<span class=\"number\">6.9</span>MB)</span><br><span class=\"line\">    <span class=\"number\">100</span>% |████████████████████████████████| <span class=\"number\">7.0</span>MB <span class=\"number\">149</span>kB/s</span><br><span class=\"line\">Collecting pytz (from django)</span><br><span class=\"line\">  Downloading pytz-<span class=\"number\">2017.2</span>-py2.py3-none-any.whl (<span class=\"number\">484</span>kB)</span><br><span class=\"line\">    <span class=\"number\">100</span>% |████████████████████████████████| <span class=\"number\">491</span>kB <span class=\"number\">377</span>kB/s</span><br><span class=\"line\">Installing collected packages: pytz, django</span><br><span class=\"line\">Successfully installed django-<span class=\"number\">1.11</span>.<span class=\"number\">5</span> pytz-<span class=\"number\">2017.2</span></span><br><span class=\"line\">You are using pip version <span class=\"number\">8.1</span>.<span class=\"number\">2</span>, however version <span class=\"number\">9.0</span>.<span class=\"number\">1</span> is available.</span><br><span class=\"line\">You should consider upgrading via the <span class=\"string\">'python -m pip install --upgrade pip'</span> command.</span><br></pre></td></tr></table></figure></p>\n<p>源码安装：</p>\n<p>从github上的Django项目上下载相关的release压缩包<br><a href=\"https://github.com/django/django/releases，\" target=\"_blank\" rel=\"noopener\">https://github.com/django/django/releases，</a><br>选择你所需要的版本。这里我下载1.11.5版本的zip格式压缩包。将下载到的压缩包解压到任何目录，在该目录按住shift键再鼠标右击，打开命令提示符，输入python选择你所需要的版本。这里我下载1.11.5版本的zip格式压缩包。将下载到的压缩包解压到任何目录，在该目录按住shift键再鼠标右击，打开命令提示符，输入python setup.py install即可。</p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PS F:\\一些源码\\django-<span class=\"number\">1.11</span>.<span class=\"number\">5</span>&gt; python .\\setup.py install</span><br></pre></td></tr></table></figure>\n<p>为了日后使用方便，可以将Django的相关可执行文件添加到系统的可执行目录。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">C:\\Python27\\Scripts</span><br></pre></td></tr></table></figure>\n<p>在我的机器上，没进行添加环境变量也可以正常调用django命令了，就省去这个步骤了。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PS C:\\Users\\star-chen&gt; django-admin</span><br><span class=\"line\"></span><br><span class=\"line\">Type &apos;django-admin-script.py help &lt;subcommand&gt;&apos; for help on a specific subcommand.</span><br><span class=\"line\"></span><br><span class=\"line\">Available subcommands:</span><br><span class=\"line\"></span><br><span class=\"line\">[django]</span><br><span class=\"line\">    check</span><br><span class=\"line\">    compilemessages</span><br><span class=\"line\">    createcachetable</span><br><span class=\"line\">    dbshell</span><br><span class=\"line\">    diffsettings</span><br><span class=\"line\">    dumpdata</span><br><span class=\"line\">    flush</span><br><span class=\"line\">    inspectdb</span><br><span class=\"line\">    loaddata</span><br><span class=\"line\">    makemessages</span><br><span class=\"line\">    makemigrations</span><br><span class=\"line\">    migrate</span><br><span class=\"line\">    runserver</span><br><span class=\"line\">    sendtestemail</span><br><span class=\"line\">    shell</span><br><span class=\"line\">    showmigrations</span><br><span class=\"line\">    sqlflush</span><br><span class=\"line\">    sqlmigrate</span><br><span class=\"line\">    sqlsequencereset</span><br><span class=\"line\">    squashmigrations</span><br><span class=\"line\">    startapp</span><br><span class=\"line\">    startproject</span><br><span class=\"line\">    test</span><br><span class=\"line\">    testserver</span><br></pre></td></tr></table></figure>\n<p>OK,安装过程就是这么简单，接下来就是实际体验时刻了，下篇博文见。</p>"},{"title":"DjangoRESTframework-认证与权限","date":"2017-10-11T04:22:18.000Z","_content":"\n### DjangoRESTframework  认证和权限（Authentication & Permissions）\n\n直到目前，我们的API都没有包含任何的限制条件，任何人都能够编辑或者删除code snippet。我们应该添加一点高级的行为和规则以确保：\n\n1.code snippet 总是和创建者保持相关\n\n2.只有通过认证的用户能够创建snippet\n\n3.只有创建者能够更新和删除snippet\n\n4.未认证的用户的请求应该被限制为只读权限\n\n<!--more-->\n\n#### 给我们的model添加一点额外的信息\n\n我们将为Snippet这个model进行一点改变。首先，添加一些成员变量，其中一个成员变量表示Snippet的创建者，另一个成员变量用来存储高亮的html之后的Snippet。在models.py文件中，对Snippet进行更改如下：\n\n```python\nowner = models.ForeignKey('auth.User', related_name='snippets', on_delete=models.CASCADE)\nhighlighted = models.TextField()\n```\n\n我们需要确保model被正确存储，我们再使用pygments生成高亮的html。我们需要再引入一点其他的东西：\n\n```python\nfrom pygments.lexers import get_lexer_by_name\nfrom pygments.formatters.html import HtmlFormatter\nfrom pygments import highlight\n```\n\n然后，我们添加一个.save()方法\n\n```python\ndef save(self, *args, **kwargs):\n    \"\"\"\n    Use the `pygments` library to create a highlighted HTML\n    representation of the code snippet.\n    \"\"\"\n    lexer = get_lexer_by_name(self.language)\n    linenos = self.linenos and 'table' or False\n    options = self.title and {'title': self.title} or {}\n    formatter = HtmlFormatter(style=self.style, linenos=linenos,\n                              full=True, **options)\n    self.highlighted = highlight(self.code, lexer, formatter)\n    super(Snippet, self).save(*args, **kwargs)\n```\n\n当以上工作完成之后，我们需要更新一下数据库中的表，通常的做法是创建一个migration来做这个事儿，但是在这个教程中，我们把它删掉，建个新的来用。\n\n```shell\nrm -f tmp.db db.sqlite3\nrm -r snippets/migrations\npython manage.py makemigrations snippets\npython manage.py migrate\n```\n\n你可能需要创建一些不同的用户来测试这个API,最方便的办法是利用createsuperuser命令\n\n```shell\npython manage.py createsuperuser\n```\n\n#### 给咱们的用户model添加一些方法\n\n现在我们已经有了几个用户，我们最好能够在我们的API中展示这些用户，那么创建给serializer吧。在serializers.py中添加如下代码：\n\n```python\nfrom django.contrib.auth.models import User\n\nclass UserSerializer(serializers.ModelSerializer):\n    snippets = serializers.PrimaryKeyRelatedField(many=True, queryset=Snippet.objects.all())\n\n    class Meta:\n        model = User\n        fields = ('id', 'username', 'snippets')\n```\n\n由于snippets和user 是一个相对的关系，所以在使用ModelSerializer类时，它不会被包含在内，所以我们需要为它添加一个显式的字段。\n\n我们还会向views.py添加一些视图。我们希望仅对用户表示使用只读视图，因此我们将使用基于ListAPIView类和RetrieveAPIView类的类视图。\n\n```python\nfrom django.contrib.auth.models import User\n\n\nclass UserList(generics.ListAPIView):\n    queryset = User.objects.all()\n    serializer_class = UserSerializer\n\n\nclass UserDetail(generics.RetrieveAPIView):\n    queryset = User.objects.all()\n    serializer_class = UserSerializer\n```\n\n确保引入了UserSerializer类\n\n```python\nfrom snippets.serializers import UserSerializer\n```\n\n最后，我们需要将这些视图添加到API中，并从URL conf中引用它们，并将以下内容添加到urls.py中的规则中。\n\n```python\nurl(r'^users/$', views.UserList.as_view()),\nurl(r'^users/(?P<pk>[0-9]+)/$', views.UserDetail.as_view()),\n```\n\n#### 将Snippets和Users进行关联\n\n现在，如果我们创建了一个code snippet，那么就没有办法将创建code snippet的用户与snippet实例关联起来。用户不是作为序列化表示的一部分发送的，而是作为传入请求的一个属性。\n\n我们处理这个问题的方法是在代码片段视图上覆盖一个.performcreate()方法，它允许我们修改实例保存的方式，并处理传入请求或请求URL中隐式的任何信息。\n\n在SnippetList视图类中，添加以下方法:\n\n```python\ndef perform_create(self, serializer):\n    serializer.save(owner=self.request.user)\n```\n\n我们的serializer的create()方法现在将通过一个附加的“ower”字段，以及来自请求的验证数据。\n\n#### 更新serializer\n\n现在这些代码片段与创建它们的用户相关联，让我们更新我们的SnippetSerializer来反映这一点。在serializers.py中添加以下字段到序列化器定义。\n\n```python\nowner = serializers.ReadOnlyField(source='owner.username')\n```\n\n注意:确保你还添加了“owner”，到内部元类的字段列表中。\n\n这个领域正在做一些非常有趣的事情。源参数控制使用哪个属性来填充字段，并且可以指向序列化实例的任何属性。它还可以使用上面所示的虚线符号，在这种情况下，它将遍历给定的属性，与Django的模板语言使用的方式类似。\n\n我们添加的字段是非类型化的read只读字段类，这与其他类型的字段形成对比，如CharField、布尔菲尔德等。未类型化的readonly字段始终是只读的，并且将用于序列化表示，但在反序列化时不会用于更新模型实例。我们也可以在这里使用CharField(readonly=True)。\n\n#### 为视图添加所需的权限\n\n现在，code snippet与用户相关，我们希望确保只有经过身份验证的用户能够创建、更新和删除代码片段。\n\nREST framework包含了许多权限类，我们可以使用这些类来限制谁可以访问给定的视图。在这种情况下,我们正在寻找IsAuthenticatedOrReadOnly,这将确保经过身份验证的请求得到读写访问,和未经身份验证的请求得到只读访问。\n\n先在视图模块中添加以下导入:\n\n```python\nfrom rest_framework import permissions\n```\n\n然后，将以下属性添加到SnippetList和SnippetDetail视图类中。\n\n```python\npermission_classes = (permissions.IsAuthenticatedOrReadOnly,)\n```\n\n#### 为可视化API添加登录功能\n\n如果您现在打开浏览器并导航到可浏览的API，您将发现您不再能够创建新的代码片段。为了实现这一目的，我们需要能够以用户身份登录。\n\n我们可以通过在我们的项目级url中编辑URLconf，添加一个用于可浏览的API的登录视图。urls.py文件。\n\n```python\nfrom django.conf.urls import include\n```\n\n在文件的最后，添加一个模式来包含可浏览的API的登录和注销视图。\n\n```python\nurlpatterns += [\n    url(r'^api-auth/', include('rest_framework.urls',\n                               namespace='rest_framework')),\n]\n```\n\nr'^api-auth/'部分模式实际上可以是你想要使用的任何URL。惟一的限制是所包含的url必须使用“restframework”名称空间。在Django 1.9+中，REST框架将设置名称空间，因此您可以将其保留。\n\n现在，如果您再次打开浏览器并刷新页面，您将看到页面右上角的“登录”链接。如果您以您之前创建的用户的身份登录，那么您将能够再次创建代码片段。\n\n一旦您创建了一些代码片段，导航到'/users/'端点，并注意到该表示包含了一个列表.\n\n#### 对象的等级权限\n\n实际上，我们希望所有代码片段都能被任何人看到，但也要确保只有创建了代码片段的用户能够更新或删除它。\n\n要做到这一点，我们需要创建一个自定义权限。\n\n在代码片段应用程序中，创建一个新的文件，permissions.py。\n\n```python\nfrom rest_framework import permissions\n\n\nclass IsOwnerOrReadOnly(permissions.BasePermission):\n    \"\"\"\n    Custom permission to only allow owners of an object to edit it.\n    \"\"\"\n\n    def has_object_permission(self, request, view, obj):\n        # Read permissions are allowed to any request,\n        # so we'll always allow GET, HEAD or OPTIONS requests.\n        if request.method in permissions.SAFE_METHODS:\n            return True\n\n        # Write permissions are only allowed to the owner of the snippet.\n        return obj.owner == request.user\n```\n\n现在，我们可以通过在SnippetDetail视图类上编辑permissionclass属性，将这个定制权限添加到我们的代码片段实例端点。\n\n请确保导入IsOwnerOrReadOnly类。\n\n```python\nfrom snippets.permissions import IsOwnerOrReadOnly\n```\n\n现在，如果您再次打开浏览器，您会发现“DELETE”和“PUT”操作只出现在代码片段实例端点上，如果您登录的是创建代码片段的相同用户。\n\n#### 为API添加认证功能\n\n因为我们现在有了API的一组权限，所以如果我们想要编辑任何代码片段，就需要对请求进行身份验证。我们还没有设置任何身份验证类，因此目前应用了缺省值，即SessionAuthentication和BasicAuthentication。\n\n当我们通过web浏览器与API进行交互时，我们可以登录，然后浏览器会话将为请求提供所需的身份验证。\n\n如果我们以编程方式与API交互，我们需要在每个请求上显式地提供身份验证凭证。\n\n如果我们尝试创建一个不进行身份验证的代码片段，我们会得到一个错误:\n\n```shell\nhttp POST http://127.0.0.1:8000/snippets/ code=\"print 123\"\n\n{\n    \"detail\": \"Authentication credentials were not provided.\"\n}\n```\n\n我们可以通过包括我们先前创建的一个用户的用户名和密码来获得成功的请求。\n\n```shell\nhttp -a tom:password123 POST http://127.0.0.1:8000/snippets/ code=\"print 789\"\n\n{\n    \"id\": 1,\n    \"owner\": \"tom\",\n    \"title\": \"foo\",\n    \"code\": \"print 789\",\n    \"linenos\": false,\n    \"language\": \"python\",\n    \"style\": \"friendly\"\n}\n```\n\n#### 总结\n\n现在，我们已经获得了一组相当细粒度的Web API权限，以及系统用户和他们创建的代码片段的端点。\n\n原文：http://www.django-rest-framework.org/tutorial/4-authentication-and-permissions/\n\n","source":"_posts/DjangoRESTframework-AuthenticationPermissions.md","raw":"---\ntitle: DjangoRESTframework-认证与权限\ncategories:\n  - Program\ntags:\n  - djangorestframework\ndate: 2017-10-11 12:22:18\n---\n\n### DjangoRESTframework  认证和权限（Authentication & Permissions）\n\n直到目前，我们的API都没有包含任何的限制条件，任何人都能够编辑或者删除code snippet。我们应该添加一点高级的行为和规则以确保：\n\n1.code snippet 总是和创建者保持相关\n\n2.只有通过认证的用户能够创建snippet\n\n3.只有创建者能够更新和删除snippet\n\n4.未认证的用户的请求应该被限制为只读权限\n\n<!--more-->\n\n#### 给我们的model添加一点额外的信息\n\n我们将为Snippet这个model进行一点改变。首先，添加一些成员变量，其中一个成员变量表示Snippet的创建者，另一个成员变量用来存储高亮的html之后的Snippet。在models.py文件中，对Snippet进行更改如下：\n\n```python\nowner = models.ForeignKey('auth.User', related_name='snippets', on_delete=models.CASCADE)\nhighlighted = models.TextField()\n```\n\n我们需要确保model被正确存储，我们再使用pygments生成高亮的html。我们需要再引入一点其他的东西：\n\n```python\nfrom pygments.lexers import get_lexer_by_name\nfrom pygments.formatters.html import HtmlFormatter\nfrom pygments import highlight\n```\n\n然后，我们添加一个.save()方法\n\n```python\ndef save(self, *args, **kwargs):\n    \"\"\"\n    Use the `pygments` library to create a highlighted HTML\n    representation of the code snippet.\n    \"\"\"\n    lexer = get_lexer_by_name(self.language)\n    linenos = self.linenos and 'table' or False\n    options = self.title and {'title': self.title} or {}\n    formatter = HtmlFormatter(style=self.style, linenos=linenos,\n                              full=True, **options)\n    self.highlighted = highlight(self.code, lexer, formatter)\n    super(Snippet, self).save(*args, **kwargs)\n```\n\n当以上工作完成之后，我们需要更新一下数据库中的表，通常的做法是创建一个migration来做这个事儿，但是在这个教程中，我们把它删掉，建个新的来用。\n\n```shell\nrm -f tmp.db db.sqlite3\nrm -r snippets/migrations\npython manage.py makemigrations snippets\npython manage.py migrate\n```\n\n你可能需要创建一些不同的用户来测试这个API,最方便的办法是利用createsuperuser命令\n\n```shell\npython manage.py createsuperuser\n```\n\n#### 给咱们的用户model添加一些方法\n\n现在我们已经有了几个用户，我们最好能够在我们的API中展示这些用户，那么创建给serializer吧。在serializers.py中添加如下代码：\n\n```python\nfrom django.contrib.auth.models import User\n\nclass UserSerializer(serializers.ModelSerializer):\n    snippets = serializers.PrimaryKeyRelatedField(many=True, queryset=Snippet.objects.all())\n\n    class Meta:\n        model = User\n        fields = ('id', 'username', 'snippets')\n```\n\n由于snippets和user 是一个相对的关系，所以在使用ModelSerializer类时，它不会被包含在内，所以我们需要为它添加一个显式的字段。\n\n我们还会向views.py添加一些视图。我们希望仅对用户表示使用只读视图，因此我们将使用基于ListAPIView类和RetrieveAPIView类的类视图。\n\n```python\nfrom django.contrib.auth.models import User\n\n\nclass UserList(generics.ListAPIView):\n    queryset = User.objects.all()\n    serializer_class = UserSerializer\n\n\nclass UserDetail(generics.RetrieveAPIView):\n    queryset = User.objects.all()\n    serializer_class = UserSerializer\n```\n\n确保引入了UserSerializer类\n\n```python\nfrom snippets.serializers import UserSerializer\n```\n\n最后，我们需要将这些视图添加到API中，并从URL conf中引用它们，并将以下内容添加到urls.py中的规则中。\n\n```python\nurl(r'^users/$', views.UserList.as_view()),\nurl(r'^users/(?P<pk>[0-9]+)/$', views.UserDetail.as_view()),\n```\n\n#### 将Snippets和Users进行关联\n\n现在，如果我们创建了一个code snippet，那么就没有办法将创建code snippet的用户与snippet实例关联起来。用户不是作为序列化表示的一部分发送的，而是作为传入请求的一个属性。\n\n我们处理这个问题的方法是在代码片段视图上覆盖一个.performcreate()方法，它允许我们修改实例保存的方式，并处理传入请求或请求URL中隐式的任何信息。\n\n在SnippetList视图类中，添加以下方法:\n\n```python\ndef perform_create(self, serializer):\n    serializer.save(owner=self.request.user)\n```\n\n我们的serializer的create()方法现在将通过一个附加的“ower”字段，以及来自请求的验证数据。\n\n#### 更新serializer\n\n现在这些代码片段与创建它们的用户相关联，让我们更新我们的SnippetSerializer来反映这一点。在serializers.py中添加以下字段到序列化器定义。\n\n```python\nowner = serializers.ReadOnlyField(source='owner.username')\n```\n\n注意:确保你还添加了“owner”，到内部元类的字段列表中。\n\n这个领域正在做一些非常有趣的事情。源参数控制使用哪个属性来填充字段，并且可以指向序列化实例的任何属性。它还可以使用上面所示的虚线符号，在这种情况下，它将遍历给定的属性，与Django的模板语言使用的方式类似。\n\n我们添加的字段是非类型化的read只读字段类，这与其他类型的字段形成对比，如CharField、布尔菲尔德等。未类型化的readonly字段始终是只读的，并且将用于序列化表示，但在反序列化时不会用于更新模型实例。我们也可以在这里使用CharField(readonly=True)。\n\n#### 为视图添加所需的权限\n\n现在，code snippet与用户相关，我们希望确保只有经过身份验证的用户能够创建、更新和删除代码片段。\n\nREST framework包含了许多权限类，我们可以使用这些类来限制谁可以访问给定的视图。在这种情况下,我们正在寻找IsAuthenticatedOrReadOnly,这将确保经过身份验证的请求得到读写访问,和未经身份验证的请求得到只读访问。\n\n先在视图模块中添加以下导入:\n\n```python\nfrom rest_framework import permissions\n```\n\n然后，将以下属性添加到SnippetList和SnippetDetail视图类中。\n\n```python\npermission_classes = (permissions.IsAuthenticatedOrReadOnly,)\n```\n\n#### 为可视化API添加登录功能\n\n如果您现在打开浏览器并导航到可浏览的API，您将发现您不再能够创建新的代码片段。为了实现这一目的，我们需要能够以用户身份登录。\n\n我们可以通过在我们的项目级url中编辑URLconf，添加一个用于可浏览的API的登录视图。urls.py文件。\n\n```python\nfrom django.conf.urls import include\n```\n\n在文件的最后，添加一个模式来包含可浏览的API的登录和注销视图。\n\n```python\nurlpatterns += [\n    url(r'^api-auth/', include('rest_framework.urls',\n                               namespace='rest_framework')),\n]\n```\n\nr'^api-auth/'部分模式实际上可以是你想要使用的任何URL。惟一的限制是所包含的url必须使用“restframework”名称空间。在Django 1.9+中，REST框架将设置名称空间，因此您可以将其保留。\n\n现在，如果您再次打开浏览器并刷新页面，您将看到页面右上角的“登录”链接。如果您以您之前创建的用户的身份登录，那么您将能够再次创建代码片段。\n\n一旦您创建了一些代码片段，导航到'/users/'端点，并注意到该表示包含了一个列表.\n\n#### 对象的等级权限\n\n实际上，我们希望所有代码片段都能被任何人看到，但也要确保只有创建了代码片段的用户能够更新或删除它。\n\n要做到这一点，我们需要创建一个自定义权限。\n\n在代码片段应用程序中，创建一个新的文件，permissions.py。\n\n```python\nfrom rest_framework import permissions\n\n\nclass IsOwnerOrReadOnly(permissions.BasePermission):\n    \"\"\"\n    Custom permission to only allow owners of an object to edit it.\n    \"\"\"\n\n    def has_object_permission(self, request, view, obj):\n        # Read permissions are allowed to any request,\n        # so we'll always allow GET, HEAD or OPTIONS requests.\n        if request.method in permissions.SAFE_METHODS:\n            return True\n\n        # Write permissions are only allowed to the owner of the snippet.\n        return obj.owner == request.user\n```\n\n现在，我们可以通过在SnippetDetail视图类上编辑permissionclass属性，将这个定制权限添加到我们的代码片段实例端点。\n\n请确保导入IsOwnerOrReadOnly类。\n\n```python\nfrom snippets.permissions import IsOwnerOrReadOnly\n```\n\n现在，如果您再次打开浏览器，您会发现“DELETE”和“PUT”操作只出现在代码片段实例端点上，如果您登录的是创建代码片段的相同用户。\n\n#### 为API添加认证功能\n\n因为我们现在有了API的一组权限，所以如果我们想要编辑任何代码片段，就需要对请求进行身份验证。我们还没有设置任何身份验证类，因此目前应用了缺省值，即SessionAuthentication和BasicAuthentication。\n\n当我们通过web浏览器与API进行交互时，我们可以登录，然后浏览器会话将为请求提供所需的身份验证。\n\n如果我们以编程方式与API交互，我们需要在每个请求上显式地提供身份验证凭证。\n\n如果我们尝试创建一个不进行身份验证的代码片段，我们会得到一个错误:\n\n```shell\nhttp POST http://127.0.0.1:8000/snippets/ code=\"print 123\"\n\n{\n    \"detail\": \"Authentication credentials were not provided.\"\n}\n```\n\n我们可以通过包括我们先前创建的一个用户的用户名和密码来获得成功的请求。\n\n```shell\nhttp -a tom:password123 POST http://127.0.0.1:8000/snippets/ code=\"print 789\"\n\n{\n    \"id\": 1,\n    \"owner\": \"tom\",\n    \"title\": \"foo\",\n    \"code\": \"print 789\",\n    \"linenos\": false,\n    \"language\": \"python\",\n    \"style\": \"friendly\"\n}\n```\n\n#### 总结\n\n现在，我们已经获得了一组相当细粒度的Web API权限，以及系统用户和他们创建的代码片段的端点。\n\n原文：http://www.django-rest-framework.org/tutorial/4-authentication-and-permissions/\n\n","slug":"DjangoRESTframework-AuthenticationPermissions","published":1,"updated":"2017-12-04T07:27:28.753Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjeqig1ko0011lgqahgvvt64f","content":"<h3 id=\"DjangoRESTframework-认证和权限（Authentication-amp-Permissions）\"><a href=\"#DjangoRESTframework-认证和权限（Authentication-amp-Permissions）\" class=\"headerlink\" title=\"DjangoRESTframework  认证和权限（Authentication &amp; Permissions）\"></a>DjangoRESTframework  认证和权限（Authentication &amp; Permissions）</h3><p>直到目前，我们的API都没有包含任何的限制条件，任何人都能够编辑或者删除code snippet。我们应该添加一点高级的行为和规则以确保：</p>\n<p>1.code snippet 总是和创建者保持相关</p>\n<p>2.只有通过认证的用户能够创建snippet</p>\n<p>3.只有创建者能够更新和删除snippet</p>\n<p>4.未认证的用户的请求应该被限制为只读权限</p>\n<a id=\"more\"></a>\n<h4 id=\"给我们的model添加一点额外的信息\"><a href=\"#给我们的model添加一点额外的信息\" class=\"headerlink\" title=\"给我们的model添加一点额外的信息\"></a>给我们的model添加一点额外的信息</h4><p>我们将为Snippet这个model进行一点改变。首先，添加一些成员变量，其中一个成员变量表示Snippet的创建者，另一个成员变量用来存储高亮的html之后的Snippet。在models.py文件中，对Snippet进行更改如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">owner = models.ForeignKey(<span class=\"string\">'auth.User'</span>, related_name=<span class=\"string\">'snippets'</span>, on_delete=models.CASCADE)</span><br><span class=\"line\">highlighted = models.TextField()</span><br></pre></td></tr></table></figure>\n<p>我们需要确保model被正确存储，我们再使用pygments生成高亮的html。我们需要再引入一点其他的东西：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> pygments.lexers <span class=\"keyword\">import</span> get_lexer_by_name</span><br><span class=\"line\"><span class=\"keyword\">from</span> pygments.formatters.html <span class=\"keyword\">import</span> HtmlFormatter</span><br><span class=\"line\"><span class=\"keyword\">from</span> pygments <span class=\"keyword\">import</span> highlight</span><br></pre></td></tr></table></figure>\n<p>然后，我们添加一个.save()方法</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">save</span><span class=\"params\">(self, *args, **kwargs)</span>:</span></span><br><span class=\"line\">    <span class=\"string\">\"\"\"</span></span><br><span class=\"line\"><span class=\"string\">    Use the `pygments` library to create a highlighted HTML</span></span><br><span class=\"line\"><span class=\"string\">    representation of the code snippet.</span></span><br><span class=\"line\"><span class=\"string\">    \"\"\"</span></span><br><span class=\"line\">    lexer = get_lexer_by_name(self.language)</span><br><span class=\"line\">    linenos = self.linenos <span class=\"keyword\">and</span> <span class=\"string\">'table'</span> <span class=\"keyword\">or</span> <span class=\"keyword\">False</span></span><br><span class=\"line\">    options = self.title <span class=\"keyword\">and</span> &#123;<span class=\"string\">'title'</span>: self.title&#125; <span class=\"keyword\">or</span> &#123;&#125;</span><br><span class=\"line\">    formatter = HtmlFormatter(style=self.style, linenos=linenos,</span><br><span class=\"line\">                              full=<span class=\"keyword\">True</span>, **options)</span><br><span class=\"line\">    self.highlighted = highlight(self.code, lexer, formatter)</span><br><span class=\"line\">    super(Snippet, self).save(*args, **kwargs)</span><br></pre></td></tr></table></figure>\n<p>当以上工作完成之后，我们需要更新一下数据库中的表，通常的做法是创建一个migration来做这个事儿，但是在这个教程中，我们把它删掉，建个新的来用。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rm -f tmp.db db.sqlite3</span><br><span class=\"line\">rm -r snippets/migrations</span><br><span class=\"line\">python manage.py makemigrations snippets</span><br><span class=\"line\">python manage.py migrate</span><br></pre></td></tr></table></figure>\n<p>你可能需要创建一些不同的用户来测试这个API,最方便的办法是利用createsuperuser命令</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">python manage.py createsuperuser</span><br></pre></td></tr></table></figure>\n<h4 id=\"给咱们的用户model添加一些方法\"><a href=\"#给咱们的用户model添加一些方法\" class=\"headerlink\" title=\"给咱们的用户model添加一些方法\"></a>给咱们的用户model添加一些方法</h4><p>现在我们已经有了几个用户，我们最好能够在我们的API中展示这些用户，那么创建给serializer吧。在serializers.py中添加如下代码：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> django.contrib.auth.models <span class=\"keyword\">import</span> User</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">UserSerializer</span><span class=\"params\">(serializers.ModelSerializer)</span>:</span></span><br><span class=\"line\">    snippets = serializers.PrimaryKeyRelatedField(many=<span class=\"keyword\">True</span>, queryset=Snippet.objects.all())</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Meta</span>:</span></span><br><span class=\"line\">        model = User</span><br><span class=\"line\">        fields = (<span class=\"string\">'id'</span>, <span class=\"string\">'username'</span>, <span class=\"string\">'snippets'</span>)</span><br></pre></td></tr></table></figure>\n<p>由于snippets和user 是一个相对的关系，所以在使用ModelSerializer类时，它不会被包含在内，所以我们需要为它添加一个显式的字段。</p>\n<p>我们还会向views.py添加一些视图。我们希望仅对用户表示使用只读视图，因此我们将使用基于ListAPIView类和RetrieveAPIView类的类视图。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> django.contrib.auth.models <span class=\"keyword\">import</span> User</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">UserList</span><span class=\"params\">(generics.ListAPIView)</span>:</span></span><br><span class=\"line\">    queryset = User.objects.all()</span><br><span class=\"line\">    serializer_class = UserSerializer</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">UserDetail</span><span class=\"params\">(generics.RetrieveAPIView)</span>:</span></span><br><span class=\"line\">    queryset = User.objects.all()</span><br><span class=\"line\">    serializer_class = UserSerializer</span><br></pre></td></tr></table></figure>\n<p>确保引入了UserSerializer类</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> snippets.serializers <span class=\"keyword\">import</span> UserSerializer</span><br></pre></td></tr></table></figure>\n<p>最后，我们需要将这些视图添加到API中，并从URL conf中引用它们，并将以下内容添加到urls.py中的规则中。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">url(<span class=\"string\">r'^users/$'</span>, views.UserList.as_view()),</span><br><span class=\"line\">url(<span class=\"string\">r'^users/(?P&lt;pk&gt;[0-9]+)/$'</span>, views.UserDetail.as_view()),</span><br></pre></td></tr></table></figure>\n<h4 id=\"将Snippets和Users进行关联\"><a href=\"#将Snippets和Users进行关联\" class=\"headerlink\" title=\"将Snippets和Users进行关联\"></a>将Snippets和Users进行关联</h4><p>现在，如果我们创建了一个code snippet，那么就没有办法将创建code snippet的用户与snippet实例关联起来。用户不是作为序列化表示的一部分发送的，而是作为传入请求的一个属性。</p>\n<p>我们处理这个问题的方法是在代码片段视图上覆盖一个.performcreate()方法，它允许我们修改实例保存的方式，并处理传入请求或请求URL中隐式的任何信息。</p>\n<p>在SnippetList视图类中，添加以下方法:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">perform_create</span><span class=\"params\">(self, serializer)</span>:</span></span><br><span class=\"line\">    serializer.save(owner=self.request.user)</span><br></pre></td></tr></table></figure>\n<p>我们的serializer的create()方法现在将通过一个附加的“ower”字段，以及来自请求的验证数据。</p>\n<h4 id=\"更新serializer\"><a href=\"#更新serializer\" class=\"headerlink\" title=\"更新serializer\"></a>更新serializer</h4><p>现在这些代码片段与创建它们的用户相关联，让我们更新我们的SnippetSerializer来反映这一点。在serializers.py中添加以下字段到序列化器定义。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">owner = serializers.ReadOnlyField(source=<span class=\"string\">'owner.username'</span>)</span><br></pre></td></tr></table></figure>\n<p>注意:确保你还添加了“owner”，到内部元类的字段列表中。</p>\n<p>这个领域正在做一些非常有趣的事情。源参数控制使用哪个属性来填充字段，并且可以指向序列化实例的任何属性。它还可以使用上面所示的虚线符号，在这种情况下，它将遍历给定的属性，与Django的模板语言使用的方式类似。</p>\n<p>我们添加的字段是非类型化的read只读字段类，这与其他类型的字段形成对比，如CharField、布尔菲尔德等。未类型化的readonly字段始终是只读的，并且将用于序列化表示，但在反序列化时不会用于更新模型实例。我们也可以在这里使用CharField(readonly=True)。</p>\n<h4 id=\"为视图添加所需的权限\"><a href=\"#为视图添加所需的权限\" class=\"headerlink\" title=\"为视图添加所需的权限\"></a>为视图添加所需的权限</h4><p>现在，code snippet与用户相关，我们希望确保只有经过身份验证的用户能够创建、更新和删除代码片段。</p>\n<p>REST framework包含了许多权限类，我们可以使用这些类来限制谁可以访问给定的视图。在这种情况下,我们正在寻找IsAuthenticatedOrReadOnly,这将确保经过身份验证的请求得到读写访问,和未经身份验证的请求得到只读访问。</p>\n<p>先在视图模块中添加以下导入:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> rest_framework <span class=\"keyword\">import</span> permissions</span><br></pre></td></tr></table></figure>\n<p>然后，将以下属性添加到SnippetList和SnippetDetail视图类中。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">permission_classes = (permissions.IsAuthenticatedOrReadOnly,)</span><br></pre></td></tr></table></figure>\n<h4 id=\"为可视化API添加登录功能\"><a href=\"#为可视化API添加登录功能\" class=\"headerlink\" title=\"为可视化API添加登录功能\"></a>为可视化API添加登录功能</h4><p>如果您现在打开浏览器并导航到可浏览的API，您将发现您不再能够创建新的代码片段。为了实现这一目的，我们需要能够以用户身份登录。</p>\n<p>我们可以通过在我们的项目级url中编辑URLconf，添加一个用于可浏览的API的登录视图。urls.py文件。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> django.conf.urls <span class=\"keyword\">import</span> include</span><br></pre></td></tr></table></figure>\n<p>在文件的最后，添加一个模式来包含可浏览的API的登录和注销视图。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">urlpatterns += [</span><br><span class=\"line\">    url(<span class=\"string\">r'^api-auth/'</span>, include(<span class=\"string\">'rest_framework.urls'</span>,</span><br><span class=\"line\">                               namespace=<span class=\"string\">'rest_framework'</span>)),</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n<p>r’^api-auth/‘部分模式实际上可以是你想要使用的任何URL。惟一的限制是所包含的url必须使用“restframework”名称空间。在Django 1.9+中，REST框架将设置名称空间，因此您可以将其保留。</p>\n<p>现在，如果您再次打开浏览器并刷新页面，您将看到页面右上角的“登录”链接。如果您以您之前创建的用户的身份登录，那么您将能够再次创建代码片段。</p>\n<p>一旦您创建了一些代码片段，导航到’/users/‘端点，并注意到该表示包含了一个列表.</p>\n<h4 id=\"对象的等级权限\"><a href=\"#对象的等级权限\" class=\"headerlink\" title=\"对象的等级权限\"></a>对象的等级权限</h4><p>实际上，我们希望所有代码片段都能被任何人看到，但也要确保只有创建了代码片段的用户能够更新或删除它。</p>\n<p>要做到这一点，我们需要创建一个自定义权限。</p>\n<p>在代码片段应用程序中，创建一个新的文件，permissions.py。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> rest_framework <span class=\"keyword\">import</span> permissions</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">IsOwnerOrReadOnly</span><span class=\"params\">(permissions.BasePermission)</span>:</span></span><br><span class=\"line\">    <span class=\"string\">\"\"\"</span></span><br><span class=\"line\"><span class=\"string\">    Custom permission to only allow owners of an object to edit it.</span></span><br><span class=\"line\"><span class=\"string\">    \"\"\"</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">has_object_permission</span><span class=\"params\">(self, request, view, obj)</span>:</span></span><br><span class=\"line\">        <span class=\"comment\"># Read permissions are allowed to any request,</span></span><br><span class=\"line\">        <span class=\"comment\"># so we'll always allow GET, HEAD or OPTIONS requests.</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> request.method <span class=\"keyword\">in</span> permissions.SAFE_METHODS:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">True</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\"># Write permissions are only allowed to the owner of the snippet.</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> obj.owner == request.user</span><br></pre></td></tr></table></figure>\n<p>现在，我们可以通过在SnippetDetail视图类上编辑permissionclass属性，将这个定制权限添加到我们的代码片段实例端点。</p>\n<p>请确保导入IsOwnerOrReadOnly类。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> snippets.permissions <span class=\"keyword\">import</span> IsOwnerOrReadOnly</span><br></pre></td></tr></table></figure>\n<p>现在，如果您再次打开浏览器，您会发现“DELETE”和“PUT”操作只出现在代码片段实例端点上，如果您登录的是创建代码片段的相同用户。</p>\n<h4 id=\"为API添加认证功能\"><a href=\"#为API添加认证功能\" class=\"headerlink\" title=\"为API添加认证功能\"></a>为API添加认证功能</h4><p>因为我们现在有了API的一组权限，所以如果我们想要编辑任何代码片段，就需要对请求进行身份验证。我们还没有设置任何身份验证类，因此目前应用了缺省值，即SessionAuthentication和BasicAuthentication。</p>\n<p>当我们通过web浏览器与API进行交互时，我们可以登录，然后浏览器会话将为请求提供所需的身份验证。</p>\n<p>如果我们以编程方式与API交互，我们需要在每个请求上显式地提供身份验证凭证。</p>\n<p>如果我们尝试创建一个不进行身份验证的代码片段，我们会得到一个错误:</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http POST http://127.0.0.1:8000/snippets/ code=\"print 123\"</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    \"detail\": \"Authentication credentials were not provided.\"</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>我们可以通过包括我们先前创建的一个用户的用户名和密码来获得成功的请求。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http -a tom:password123 POST http://127.0.0.1:8000/snippets/ code=\"print 789\"</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    \"id\": 1,</span><br><span class=\"line\">    \"owner\": \"tom\",</span><br><span class=\"line\">    \"title\": \"foo\",</span><br><span class=\"line\">    \"code\": \"print 789\",</span><br><span class=\"line\">    \"linenos\": false,</span><br><span class=\"line\">    \"language\": \"python\",</span><br><span class=\"line\">    \"style\": \"friendly\"</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h4><p>现在，我们已经获得了一组相当细粒度的Web API权限，以及系统用户和他们创建的代码片段的端点。</p>\n<p>原文：<a href=\"http://www.django-rest-framework.org/tutorial/4-authentication-and-permissions/\" target=\"_blank\" rel=\"noopener\">http://www.django-rest-framework.org/tutorial/4-authentication-and-permissions/</a></p>\n","site":{"data":{}},"excerpt":"<h3 id=\"DjangoRESTframework-认证和权限（Authentication-amp-Permissions）\"><a href=\"#DjangoRESTframework-认证和权限（Authentication-amp-Permissions）\" class=\"headerlink\" title=\"DjangoRESTframework  认证和权限（Authentication &amp; Permissions）\"></a>DjangoRESTframework  认证和权限（Authentication &amp; Permissions）</h3><p>直到目前，我们的API都没有包含任何的限制条件，任何人都能够编辑或者删除code snippet。我们应该添加一点高级的行为和规则以确保：</p>\n<p>1.code snippet 总是和创建者保持相关</p>\n<p>2.只有通过认证的用户能够创建snippet</p>\n<p>3.只有创建者能够更新和删除snippet</p>\n<p>4.未认证的用户的请求应该被限制为只读权限</p>","more":"<h4 id=\"给我们的model添加一点额外的信息\"><a href=\"#给我们的model添加一点额外的信息\" class=\"headerlink\" title=\"给我们的model添加一点额外的信息\"></a>给我们的model添加一点额外的信息</h4><p>我们将为Snippet这个model进行一点改变。首先，添加一些成员变量，其中一个成员变量表示Snippet的创建者，另一个成员变量用来存储高亮的html之后的Snippet。在models.py文件中，对Snippet进行更改如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">owner = models.ForeignKey(<span class=\"string\">'auth.User'</span>, related_name=<span class=\"string\">'snippets'</span>, on_delete=models.CASCADE)</span><br><span class=\"line\">highlighted = models.TextField()</span><br></pre></td></tr></table></figure>\n<p>我们需要确保model被正确存储，我们再使用pygments生成高亮的html。我们需要再引入一点其他的东西：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> pygments.lexers <span class=\"keyword\">import</span> get_lexer_by_name</span><br><span class=\"line\"><span class=\"keyword\">from</span> pygments.formatters.html <span class=\"keyword\">import</span> HtmlFormatter</span><br><span class=\"line\"><span class=\"keyword\">from</span> pygments <span class=\"keyword\">import</span> highlight</span><br></pre></td></tr></table></figure>\n<p>然后，我们添加一个.save()方法</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">save</span><span class=\"params\">(self, *args, **kwargs)</span>:</span></span><br><span class=\"line\">    <span class=\"string\">\"\"\"</span></span><br><span class=\"line\"><span class=\"string\">    Use the `pygments` library to create a highlighted HTML</span></span><br><span class=\"line\"><span class=\"string\">    representation of the code snippet.</span></span><br><span class=\"line\"><span class=\"string\">    \"\"\"</span></span><br><span class=\"line\">    lexer = get_lexer_by_name(self.language)</span><br><span class=\"line\">    linenos = self.linenos <span class=\"keyword\">and</span> <span class=\"string\">'table'</span> <span class=\"keyword\">or</span> <span class=\"keyword\">False</span></span><br><span class=\"line\">    options = self.title <span class=\"keyword\">and</span> &#123;<span class=\"string\">'title'</span>: self.title&#125; <span class=\"keyword\">or</span> &#123;&#125;</span><br><span class=\"line\">    formatter = HtmlFormatter(style=self.style, linenos=linenos,</span><br><span class=\"line\">                              full=<span class=\"keyword\">True</span>, **options)</span><br><span class=\"line\">    self.highlighted = highlight(self.code, lexer, formatter)</span><br><span class=\"line\">    super(Snippet, self).save(*args, **kwargs)</span><br></pre></td></tr></table></figure>\n<p>当以上工作完成之后，我们需要更新一下数据库中的表，通常的做法是创建一个migration来做这个事儿，但是在这个教程中，我们把它删掉，建个新的来用。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rm -f tmp.db db.sqlite3</span><br><span class=\"line\">rm -r snippets/migrations</span><br><span class=\"line\">python manage.py makemigrations snippets</span><br><span class=\"line\">python manage.py migrate</span><br></pre></td></tr></table></figure>\n<p>你可能需要创建一些不同的用户来测试这个API,最方便的办法是利用createsuperuser命令</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">python manage.py createsuperuser</span><br></pre></td></tr></table></figure>\n<h4 id=\"给咱们的用户model添加一些方法\"><a href=\"#给咱们的用户model添加一些方法\" class=\"headerlink\" title=\"给咱们的用户model添加一些方法\"></a>给咱们的用户model添加一些方法</h4><p>现在我们已经有了几个用户，我们最好能够在我们的API中展示这些用户，那么创建给serializer吧。在serializers.py中添加如下代码：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> django.contrib.auth.models <span class=\"keyword\">import</span> User</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">UserSerializer</span><span class=\"params\">(serializers.ModelSerializer)</span>:</span></span><br><span class=\"line\">    snippets = serializers.PrimaryKeyRelatedField(many=<span class=\"keyword\">True</span>, queryset=Snippet.objects.all())</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Meta</span>:</span></span><br><span class=\"line\">        model = User</span><br><span class=\"line\">        fields = (<span class=\"string\">'id'</span>, <span class=\"string\">'username'</span>, <span class=\"string\">'snippets'</span>)</span><br></pre></td></tr></table></figure>\n<p>由于snippets和user 是一个相对的关系，所以在使用ModelSerializer类时，它不会被包含在内，所以我们需要为它添加一个显式的字段。</p>\n<p>我们还会向views.py添加一些视图。我们希望仅对用户表示使用只读视图，因此我们将使用基于ListAPIView类和RetrieveAPIView类的类视图。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> django.contrib.auth.models <span class=\"keyword\">import</span> User</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">UserList</span><span class=\"params\">(generics.ListAPIView)</span>:</span></span><br><span class=\"line\">    queryset = User.objects.all()</span><br><span class=\"line\">    serializer_class = UserSerializer</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">UserDetail</span><span class=\"params\">(generics.RetrieveAPIView)</span>:</span></span><br><span class=\"line\">    queryset = User.objects.all()</span><br><span class=\"line\">    serializer_class = UserSerializer</span><br></pre></td></tr></table></figure>\n<p>确保引入了UserSerializer类</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> snippets.serializers <span class=\"keyword\">import</span> UserSerializer</span><br></pre></td></tr></table></figure>\n<p>最后，我们需要将这些视图添加到API中，并从URL conf中引用它们，并将以下内容添加到urls.py中的规则中。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">url(<span class=\"string\">r'^users/$'</span>, views.UserList.as_view()),</span><br><span class=\"line\">url(<span class=\"string\">r'^users/(?P&lt;pk&gt;[0-9]+)/$'</span>, views.UserDetail.as_view()),</span><br></pre></td></tr></table></figure>\n<h4 id=\"将Snippets和Users进行关联\"><a href=\"#将Snippets和Users进行关联\" class=\"headerlink\" title=\"将Snippets和Users进行关联\"></a>将Snippets和Users进行关联</h4><p>现在，如果我们创建了一个code snippet，那么就没有办法将创建code snippet的用户与snippet实例关联起来。用户不是作为序列化表示的一部分发送的，而是作为传入请求的一个属性。</p>\n<p>我们处理这个问题的方法是在代码片段视图上覆盖一个.performcreate()方法，它允许我们修改实例保存的方式，并处理传入请求或请求URL中隐式的任何信息。</p>\n<p>在SnippetList视图类中，添加以下方法:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">perform_create</span><span class=\"params\">(self, serializer)</span>:</span></span><br><span class=\"line\">    serializer.save(owner=self.request.user)</span><br></pre></td></tr></table></figure>\n<p>我们的serializer的create()方法现在将通过一个附加的“ower”字段，以及来自请求的验证数据。</p>\n<h4 id=\"更新serializer\"><a href=\"#更新serializer\" class=\"headerlink\" title=\"更新serializer\"></a>更新serializer</h4><p>现在这些代码片段与创建它们的用户相关联，让我们更新我们的SnippetSerializer来反映这一点。在serializers.py中添加以下字段到序列化器定义。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">owner = serializers.ReadOnlyField(source=<span class=\"string\">'owner.username'</span>)</span><br></pre></td></tr></table></figure>\n<p>注意:确保你还添加了“owner”，到内部元类的字段列表中。</p>\n<p>这个领域正在做一些非常有趣的事情。源参数控制使用哪个属性来填充字段，并且可以指向序列化实例的任何属性。它还可以使用上面所示的虚线符号，在这种情况下，它将遍历给定的属性，与Django的模板语言使用的方式类似。</p>\n<p>我们添加的字段是非类型化的read只读字段类，这与其他类型的字段形成对比，如CharField、布尔菲尔德等。未类型化的readonly字段始终是只读的，并且将用于序列化表示，但在反序列化时不会用于更新模型实例。我们也可以在这里使用CharField(readonly=True)。</p>\n<h4 id=\"为视图添加所需的权限\"><a href=\"#为视图添加所需的权限\" class=\"headerlink\" title=\"为视图添加所需的权限\"></a>为视图添加所需的权限</h4><p>现在，code snippet与用户相关，我们希望确保只有经过身份验证的用户能够创建、更新和删除代码片段。</p>\n<p>REST framework包含了许多权限类，我们可以使用这些类来限制谁可以访问给定的视图。在这种情况下,我们正在寻找IsAuthenticatedOrReadOnly,这将确保经过身份验证的请求得到读写访问,和未经身份验证的请求得到只读访问。</p>\n<p>先在视图模块中添加以下导入:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> rest_framework <span class=\"keyword\">import</span> permissions</span><br></pre></td></tr></table></figure>\n<p>然后，将以下属性添加到SnippetList和SnippetDetail视图类中。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">permission_classes = (permissions.IsAuthenticatedOrReadOnly,)</span><br></pre></td></tr></table></figure>\n<h4 id=\"为可视化API添加登录功能\"><a href=\"#为可视化API添加登录功能\" class=\"headerlink\" title=\"为可视化API添加登录功能\"></a>为可视化API添加登录功能</h4><p>如果您现在打开浏览器并导航到可浏览的API，您将发现您不再能够创建新的代码片段。为了实现这一目的，我们需要能够以用户身份登录。</p>\n<p>我们可以通过在我们的项目级url中编辑URLconf，添加一个用于可浏览的API的登录视图。urls.py文件。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> django.conf.urls <span class=\"keyword\">import</span> include</span><br></pre></td></tr></table></figure>\n<p>在文件的最后，添加一个模式来包含可浏览的API的登录和注销视图。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">urlpatterns += [</span><br><span class=\"line\">    url(<span class=\"string\">r'^api-auth/'</span>, include(<span class=\"string\">'rest_framework.urls'</span>,</span><br><span class=\"line\">                               namespace=<span class=\"string\">'rest_framework'</span>)),</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n<p>r’^api-auth/‘部分模式实际上可以是你想要使用的任何URL。惟一的限制是所包含的url必须使用“restframework”名称空间。在Django 1.9+中，REST框架将设置名称空间，因此您可以将其保留。</p>\n<p>现在，如果您再次打开浏览器并刷新页面，您将看到页面右上角的“登录”链接。如果您以您之前创建的用户的身份登录，那么您将能够再次创建代码片段。</p>\n<p>一旦您创建了一些代码片段，导航到’/users/‘端点，并注意到该表示包含了一个列表.</p>\n<h4 id=\"对象的等级权限\"><a href=\"#对象的等级权限\" class=\"headerlink\" title=\"对象的等级权限\"></a>对象的等级权限</h4><p>实际上，我们希望所有代码片段都能被任何人看到，但也要确保只有创建了代码片段的用户能够更新或删除它。</p>\n<p>要做到这一点，我们需要创建一个自定义权限。</p>\n<p>在代码片段应用程序中，创建一个新的文件，permissions.py。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> rest_framework <span class=\"keyword\">import</span> permissions</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">IsOwnerOrReadOnly</span><span class=\"params\">(permissions.BasePermission)</span>:</span></span><br><span class=\"line\">    <span class=\"string\">\"\"\"</span></span><br><span class=\"line\"><span class=\"string\">    Custom permission to only allow owners of an object to edit it.</span></span><br><span class=\"line\"><span class=\"string\">    \"\"\"</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">has_object_permission</span><span class=\"params\">(self, request, view, obj)</span>:</span></span><br><span class=\"line\">        <span class=\"comment\"># Read permissions are allowed to any request,</span></span><br><span class=\"line\">        <span class=\"comment\"># so we'll always allow GET, HEAD or OPTIONS requests.</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> request.method <span class=\"keyword\">in</span> permissions.SAFE_METHODS:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">True</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\"># Write permissions are only allowed to the owner of the snippet.</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> obj.owner == request.user</span><br></pre></td></tr></table></figure>\n<p>现在，我们可以通过在SnippetDetail视图类上编辑permissionclass属性，将这个定制权限添加到我们的代码片段实例端点。</p>\n<p>请确保导入IsOwnerOrReadOnly类。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> snippets.permissions <span class=\"keyword\">import</span> IsOwnerOrReadOnly</span><br></pre></td></tr></table></figure>\n<p>现在，如果您再次打开浏览器，您会发现“DELETE”和“PUT”操作只出现在代码片段实例端点上，如果您登录的是创建代码片段的相同用户。</p>\n<h4 id=\"为API添加认证功能\"><a href=\"#为API添加认证功能\" class=\"headerlink\" title=\"为API添加认证功能\"></a>为API添加认证功能</h4><p>因为我们现在有了API的一组权限，所以如果我们想要编辑任何代码片段，就需要对请求进行身份验证。我们还没有设置任何身份验证类，因此目前应用了缺省值，即SessionAuthentication和BasicAuthentication。</p>\n<p>当我们通过web浏览器与API进行交互时，我们可以登录，然后浏览器会话将为请求提供所需的身份验证。</p>\n<p>如果我们以编程方式与API交互，我们需要在每个请求上显式地提供身份验证凭证。</p>\n<p>如果我们尝试创建一个不进行身份验证的代码片段，我们会得到一个错误:</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http POST http://127.0.0.1:8000/snippets/ code=\"print 123\"</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    \"detail\": \"Authentication credentials were not provided.\"</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>我们可以通过包括我们先前创建的一个用户的用户名和密码来获得成功的请求。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http -a tom:password123 POST http://127.0.0.1:8000/snippets/ code=\"print 789\"</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    \"id\": 1,</span><br><span class=\"line\">    \"owner\": \"tom\",</span><br><span class=\"line\">    \"title\": \"foo\",</span><br><span class=\"line\">    \"code\": \"print 789\",</span><br><span class=\"line\">    \"linenos\": false,</span><br><span class=\"line\">    \"language\": \"python\",</span><br><span class=\"line\">    \"style\": \"friendly\"</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h4><p>现在，我们已经获得了一组相当细粒度的Web API权限，以及系统用户和他们创建的代码片段的端点。</p>\n<p>原文：<a href=\"http://www.django-rest-framework.org/tutorial/4-authentication-and-permissions/\" target=\"_blank\" rel=\"noopener\">http://www.django-rest-framework.org/tutorial/4-authentication-and-permissions/</a></p>"},{"title":"DjangoRESTframework-关系与超链接API","date":"2017-10-11T04:24:04.000Z","_content":"\n### DjangoRESTframework 关系和超链接API(Relationships & Hyperlinked APIs)\n\n目前，我们的API内部的关系是通过使用主键来表示的。在本教程的这一部分中，我们将通过使用超链接关系来改善我们的API的内聚性和可发现性。\n\n<!--more-->\n\n#### 为我们的API创建一个入口\n\n目前为止我们已经有了snippets和users两个接口，但是我们没有一个单独的API的入口点。我们使用基于方法的视图来创建一个视图，并用上之前介绍过的@api_view装饰器。需要编辑的文件是snippets/views.py,添加上如下的代码：\n\n```python\nfrom rest_framework.decorators import api_view\nfrom rest_framework.response import Response\nfrom rest_framework.reverse import reverse\n\n\n@api_view(['GET'])\ndef api_root(request, format=None):\n    return Response({\n        'users': reverse('user-list', request=request, format=format),\n        'snippets': reverse('snippet-list', request=request, format=format)\n    })\n```\n\n这里需要注意两点。第一，我们使用了REST framework框架的reverse方法来返回完整限定(fully-qualified)的URLs.第二,URL规则使用名称来方便辨识的，这在之后编辑snippets/urls.py的时候将被提到。\n\n#### 创建一个代码高亮的接口\n\n我们的api还缺少一个关键点--代码高亮接口。\n\n不像其他的API接口，我们不希望使用JSON,我们更愿意使用HTML来作为渲染输出。REST framework提供了两种风格的HTML渲染器，第一种先使用模版来处理预渲染HTMl(pre-rendered HTML)，第二种渲染器就像之前我们所用到的。\n\n另外一件事情我们需要考虑的是创建代码高亮视图的时候不能使用现有的generic view，我们并没有返回一个对象实例，而是对象实例中的某个属性。\n\n除了使用内建的generic view，我们将使用一个base class来展示实例，创建爱你我们自己的.get()方法。需要编辑的文件是snippets/views.py。\n\n```python\nfrom rest_framework import renderers\nfrom rest_framework.response import Response\n\nclass SnippetHighlight(generics.GenericAPIView):\n    queryset = Snippet.objects.all()\n    renderer_classes = (renderers.StaticHTMLRenderer,)\n\n    def get(self, request, *args, **kwargs):\n        snippet = self.get_object()\n        return Response(snippet.highlighted)\n```\n\n通常我们需要把新添加的视图增添到url配置中，编辑snippets/urls.py文件，添加我们的API:\n\n```python\nurl(r'^$', views.api_root),\n```\n\n添加代码高亮接口的url：\n\n```python\nurl(r'^snippets/(?P<pk>[0-9]+)/highlight/$', views.SnippetHighlight.as_view()),\n```\n\n#### 让我们的API变得超链接一点（Hyperlinking our API）\n\n处理实体之间的关系是Web API设计中更具挑战性的方面之一。我们有很多不同的方式来表示一段关系:\n\n1.使用主键\n\n2.在不同的实体之间使用超链接（hyperlinking）\n\n3.使用唯一标识\n\n4.使用相关实体的默认字符串\n\n5.在父表中嵌套相关的实体\n\n6.一些其他的自定义的实现\n\nREST framework支持以上全部的策略，可以将它们应用于转发或反向关系，或者将它们应用到通用的管理器，例如通用的外键。\n\n在本例中，我们希望在实体之间使用超链接风格。为了这样做,我们会修改我们的序列化器来扩展HyperlinkedModelSerializer代替现有ModelSerializer。\n\nModelSerializer HyperlinkedModelSerializer有以下区别:\n\n1.它默认不包含id字段\n\n2.它使用HyperlinkedIdentityField,包含url字段。\n\n3.使用HyperlinkedRelatedField来替代PrimaryKeyRelatedField表示关系\n\n编辑snippets/serializers.py文件，使用超链接来改写序列化器：\n\n```python\nclass SnippetSerializer(serializers.HyperlinkedModelSerializer):\n    owner = serializers.ReadOnlyField(source='owner.username')\n    highlight = serializers.HyperlinkedIdentityField(view_name='snippet-highlight', format='html')\n\n    class Meta:\n        model = Snippet\n        fields = ('url', 'id', 'highlight', 'owner',\n                  'title', 'code', 'linenos', 'language', 'style')\n\n\nclass UserSerializer(serializers.HyperlinkedModelSerializer):\n    snippets = serializers.HyperlinkedRelatedField(many=True, view_name='snippet-detail', read_only=True)\n\n    class Meta:\n        model = User\n        fields = ('url', 'id', 'username', 'snippets')\n```\n\n需要注意，我们已经添加了新的hightlight字段。这个字段和url字段是相同的类型。它指向的是snippet-hightlight这个url配置，而不是snippet-detail这个url配置。\n\n因为我们包含了format suffixed URLs,支持类似于.json这个url，我们还需要在hightlight字段中指出，任何格式的后缀超链接都应该使用“。”html的后缀。\n\n#### 让我们的URL配置已被命名（Make sure our URL patterns are named）\n\n如果我们要有一个超链接的API，我们需要确定我们的URL路由。让我们看一下需要命名的UR路由。\n\n1.我们的API的根路由，比如user-list和snippet-list。\n\n2.我们的snippet序列化器包含的snippet-hightlight字段。\n\n3.我们的序列化器包含的snippet-detail字段。\n\n4.我们的snippet和user序列化器包含的url字段，它们默认指向{model_name}-detail，达到这样的效果snippet-detail和user-detail。\n\n当我们把以上这些名称都添加到了URL配置中后，snippets/urls.py这个文件看起来应该是这个样子的。\n\n```python\nfrom django.conf.urls import url, include\nfrom rest_framework.urlpatterns import format_suffix_patterns\nfrom snippets import views\n\n# API endpoints\nurlpatterns = format_suffix_patterns([\n    url(r'^$', views.api_root),\n    url(r'^snippets/$',\n        views.SnippetList.as_view(),\n        name='snippet-list'),\n    url(r'^snippets/(?P<pk>[0-9]+)/$',\n        views.SnippetDetail.as_view(),\n        name='snippet-detail'),\n    url(r'^snippets/(?P<pk>[0-9]+)/highlight/$',\n        views.SnippetHighlight.as_view(),\n        name='snippet-highlight'),\n    url(r'^users/$',\n        views.UserList.as_view(),\n        name='user-list'),\n    url(r'^users/(?P<pk>[0-9]+)/$',\n        views.UserDetail.as_view(),\n        name='user-detail')\n])\n\n# Login and logout views for the browsable API\nurlpatterns += [\n    url(r'^api-auth/', include('rest_framework.urls',\n                               namespace='rest_framework')),\n]\n```\n\n#### 添加分页功能\n\n我们的user或者code snippet可能会返回大量的实例，所以我们最好能够让它们分页展示，也许API客户端能够获取到独立的页面。\n\n我们可以使用分页来更改默认的列表风格，需要更改tutorial/settings.py文件：\n\n```python\nREST_FRAMEWORK = {\n    'PAGE_SIZE': 10\n}\n```\n\n注意：REST framework中的设置都被命名为一个名为“REST_FRAMEWORK”的单一字典，这有助于使它们与其他项目设置保持良好的分离。\n\n如果需要的话，我们也可以自定义分页样式，但在本例中，我们只使用缺省值。\n\n#### 浏览更改之后的API\n\n如果我们打开一个浏览器打开API链接，您会发现现在可以通过跟踪超链接来使用这个API。\n\n您还可以看到snippet上的“hightlight”链接，点击浏览能够看到代码高亮的HTML表示。\n\n![image](/blogimg/api_root.png)\n\n![image](/blogimg/highlight.png)\n\n原文链接：http://www.django-rest-framework.org/tutorial/5-relationships-and-hyperlinked-apis/","source":"_posts/DjangoRESTframework-RelationshipsHyperlinkedAPI.md","raw":"---\ntitle: DjangoRESTframework-关系与超链接API\ncategories:\n  - Program\ntags:\n  - djangorestframework\ndate: 2017-10-11 12:24:04\n---\n\n### DjangoRESTframework 关系和超链接API(Relationships & Hyperlinked APIs)\n\n目前，我们的API内部的关系是通过使用主键来表示的。在本教程的这一部分中，我们将通过使用超链接关系来改善我们的API的内聚性和可发现性。\n\n<!--more-->\n\n#### 为我们的API创建一个入口\n\n目前为止我们已经有了snippets和users两个接口，但是我们没有一个单独的API的入口点。我们使用基于方法的视图来创建一个视图，并用上之前介绍过的@api_view装饰器。需要编辑的文件是snippets/views.py,添加上如下的代码：\n\n```python\nfrom rest_framework.decorators import api_view\nfrom rest_framework.response import Response\nfrom rest_framework.reverse import reverse\n\n\n@api_view(['GET'])\ndef api_root(request, format=None):\n    return Response({\n        'users': reverse('user-list', request=request, format=format),\n        'snippets': reverse('snippet-list', request=request, format=format)\n    })\n```\n\n这里需要注意两点。第一，我们使用了REST framework框架的reverse方法来返回完整限定(fully-qualified)的URLs.第二,URL规则使用名称来方便辨识的，这在之后编辑snippets/urls.py的时候将被提到。\n\n#### 创建一个代码高亮的接口\n\n我们的api还缺少一个关键点--代码高亮接口。\n\n不像其他的API接口，我们不希望使用JSON,我们更愿意使用HTML来作为渲染输出。REST framework提供了两种风格的HTML渲染器，第一种先使用模版来处理预渲染HTMl(pre-rendered HTML)，第二种渲染器就像之前我们所用到的。\n\n另外一件事情我们需要考虑的是创建代码高亮视图的时候不能使用现有的generic view，我们并没有返回一个对象实例，而是对象实例中的某个属性。\n\n除了使用内建的generic view，我们将使用一个base class来展示实例，创建爱你我们自己的.get()方法。需要编辑的文件是snippets/views.py。\n\n```python\nfrom rest_framework import renderers\nfrom rest_framework.response import Response\n\nclass SnippetHighlight(generics.GenericAPIView):\n    queryset = Snippet.objects.all()\n    renderer_classes = (renderers.StaticHTMLRenderer,)\n\n    def get(self, request, *args, **kwargs):\n        snippet = self.get_object()\n        return Response(snippet.highlighted)\n```\n\n通常我们需要把新添加的视图增添到url配置中，编辑snippets/urls.py文件，添加我们的API:\n\n```python\nurl(r'^$', views.api_root),\n```\n\n添加代码高亮接口的url：\n\n```python\nurl(r'^snippets/(?P<pk>[0-9]+)/highlight/$', views.SnippetHighlight.as_view()),\n```\n\n#### 让我们的API变得超链接一点（Hyperlinking our API）\n\n处理实体之间的关系是Web API设计中更具挑战性的方面之一。我们有很多不同的方式来表示一段关系:\n\n1.使用主键\n\n2.在不同的实体之间使用超链接（hyperlinking）\n\n3.使用唯一标识\n\n4.使用相关实体的默认字符串\n\n5.在父表中嵌套相关的实体\n\n6.一些其他的自定义的实现\n\nREST framework支持以上全部的策略，可以将它们应用于转发或反向关系，或者将它们应用到通用的管理器，例如通用的外键。\n\n在本例中，我们希望在实体之间使用超链接风格。为了这样做,我们会修改我们的序列化器来扩展HyperlinkedModelSerializer代替现有ModelSerializer。\n\nModelSerializer HyperlinkedModelSerializer有以下区别:\n\n1.它默认不包含id字段\n\n2.它使用HyperlinkedIdentityField,包含url字段。\n\n3.使用HyperlinkedRelatedField来替代PrimaryKeyRelatedField表示关系\n\n编辑snippets/serializers.py文件，使用超链接来改写序列化器：\n\n```python\nclass SnippetSerializer(serializers.HyperlinkedModelSerializer):\n    owner = serializers.ReadOnlyField(source='owner.username')\n    highlight = serializers.HyperlinkedIdentityField(view_name='snippet-highlight', format='html')\n\n    class Meta:\n        model = Snippet\n        fields = ('url', 'id', 'highlight', 'owner',\n                  'title', 'code', 'linenos', 'language', 'style')\n\n\nclass UserSerializer(serializers.HyperlinkedModelSerializer):\n    snippets = serializers.HyperlinkedRelatedField(many=True, view_name='snippet-detail', read_only=True)\n\n    class Meta:\n        model = User\n        fields = ('url', 'id', 'username', 'snippets')\n```\n\n需要注意，我们已经添加了新的hightlight字段。这个字段和url字段是相同的类型。它指向的是snippet-hightlight这个url配置，而不是snippet-detail这个url配置。\n\n因为我们包含了format suffixed URLs,支持类似于.json这个url，我们还需要在hightlight字段中指出，任何格式的后缀超链接都应该使用“。”html的后缀。\n\n#### 让我们的URL配置已被命名（Make sure our URL patterns are named）\n\n如果我们要有一个超链接的API，我们需要确定我们的URL路由。让我们看一下需要命名的UR路由。\n\n1.我们的API的根路由，比如user-list和snippet-list。\n\n2.我们的snippet序列化器包含的snippet-hightlight字段。\n\n3.我们的序列化器包含的snippet-detail字段。\n\n4.我们的snippet和user序列化器包含的url字段，它们默认指向{model_name}-detail，达到这样的效果snippet-detail和user-detail。\n\n当我们把以上这些名称都添加到了URL配置中后，snippets/urls.py这个文件看起来应该是这个样子的。\n\n```python\nfrom django.conf.urls import url, include\nfrom rest_framework.urlpatterns import format_suffix_patterns\nfrom snippets import views\n\n# API endpoints\nurlpatterns = format_suffix_patterns([\n    url(r'^$', views.api_root),\n    url(r'^snippets/$',\n        views.SnippetList.as_view(),\n        name='snippet-list'),\n    url(r'^snippets/(?P<pk>[0-9]+)/$',\n        views.SnippetDetail.as_view(),\n        name='snippet-detail'),\n    url(r'^snippets/(?P<pk>[0-9]+)/highlight/$',\n        views.SnippetHighlight.as_view(),\n        name='snippet-highlight'),\n    url(r'^users/$',\n        views.UserList.as_view(),\n        name='user-list'),\n    url(r'^users/(?P<pk>[0-9]+)/$',\n        views.UserDetail.as_view(),\n        name='user-detail')\n])\n\n# Login and logout views for the browsable API\nurlpatterns += [\n    url(r'^api-auth/', include('rest_framework.urls',\n                               namespace='rest_framework')),\n]\n```\n\n#### 添加分页功能\n\n我们的user或者code snippet可能会返回大量的实例，所以我们最好能够让它们分页展示，也许API客户端能够获取到独立的页面。\n\n我们可以使用分页来更改默认的列表风格，需要更改tutorial/settings.py文件：\n\n```python\nREST_FRAMEWORK = {\n    'PAGE_SIZE': 10\n}\n```\n\n注意：REST framework中的设置都被命名为一个名为“REST_FRAMEWORK”的单一字典，这有助于使它们与其他项目设置保持良好的分离。\n\n如果需要的话，我们也可以自定义分页样式，但在本例中，我们只使用缺省值。\n\n#### 浏览更改之后的API\n\n如果我们打开一个浏览器打开API链接，您会发现现在可以通过跟踪超链接来使用这个API。\n\n您还可以看到snippet上的“hightlight”链接，点击浏览能够看到代码高亮的HTML表示。\n\n![image](/blogimg/api_root.png)\n\n![image](/blogimg/highlight.png)\n\n原文链接：http://www.django-rest-framework.org/tutorial/5-relationships-and-hyperlinked-apis/","slug":"DjangoRESTframework-RelationshipsHyperlinkedAPI","published":1,"updated":"2017-12-04T07:27:28.753Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjeqig1kr0013lgqan5fmpkel","content":"<h3 id=\"DjangoRESTframework-关系和超链接API-Relationships-amp-Hyperlinked-APIs\"><a href=\"#DjangoRESTframework-关系和超链接API-Relationships-amp-Hyperlinked-APIs\" class=\"headerlink\" title=\"DjangoRESTframework 关系和超链接API(Relationships &amp; Hyperlinked APIs)\"></a>DjangoRESTframework 关系和超链接API(Relationships &amp; Hyperlinked APIs)</h3><p>目前，我们的API内部的关系是通过使用主键来表示的。在本教程的这一部分中，我们将通过使用超链接关系来改善我们的API的内聚性和可发现性。</p>\n<a id=\"more\"></a>\n<h4 id=\"为我们的API创建一个入口\"><a href=\"#为我们的API创建一个入口\" class=\"headerlink\" title=\"为我们的API创建一个入口\"></a>为我们的API创建一个入口</h4><p>目前为止我们已经有了snippets和users两个接口，但是我们没有一个单独的API的入口点。我们使用基于方法的视图来创建一个视图，并用上之前介绍过的@api_view装饰器。需要编辑的文件是snippets/views.py,添加上如下的代码：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> rest_framework.decorators <span class=\"keyword\">import</span> api_view</span><br><span class=\"line\"><span class=\"keyword\">from</span> rest_framework.response <span class=\"keyword\">import</span> Response</span><br><span class=\"line\"><span class=\"keyword\">from</span> rest_framework.reverse <span class=\"keyword\">import</span> reverse</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@api_view(['GET'])</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">api_root</span><span class=\"params\">(request, format=None)</span>:</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> Response(&#123;</span><br><span class=\"line\">        <span class=\"string\">'users'</span>: reverse(<span class=\"string\">'user-list'</span>, request=request, format=format),</span><br><span class=\"line\">        <span class=\"string\">'snippets'</span>: reverse(<span class=\"string\">'snippet-list'</span>, request=request, format=format)</span><br><span class=\"line\">    &#125;)</span><br></pre></td></tr></table></figure>\n<p>这里需要注意两点。第一，我们使用了REST framework框架的reverse方法来返回完整限定(fully-qualified)的URLs.第二,URL规则使用名称来方便辨识的，这在之后编辑snippets/urls.py的时候将被提到。</p>\n<h4 id=\"创建一个代码高亮的接口\"><a href=\"#创建一个代码高亮的接口\" class=\"headerlink\" title=\"创建一个代码高亮的接口\"></a>创建一个代码高亮的接口</h4><p>我们的api还缺少一个关键点–代码高亮接口。</p>\n<p>不像其他的API接口，我们不希望使用JSON,我们更愿意使用HTML来作为渲染输出。REST framework提供了两种风格的HTML渲染器，第一种先使用模版来处理预渲染HTMl(pre-rendered HTML)，第二种渲染器就像之前我们所用到的。</p>\n<p>另外一件事情我们需要考虑的是创建代码高亮视图的时候不能使用现有的generic view，我们并没有返回一个对象实例，而是对象实例中的某个属性。</p>\n<p>除了使用内建的generic view，我们将使用一个base class来展示实例，创建爱你我们自己的.get()方法。需要编辑的文件是snippets/views.py。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> rest_framework <span class=\"keyword\">import</span> renderers</span><br><span class=\"line\"><span class=\"keyword\">from</span> rest_framework.response <span class=\"keyword\">import</span> Response</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SnippetHighlight</span><span class=\"params\">(generics.GenericAPIView)</span>:</span></span><br><span class=\"line\">    queryset = Snippet.objects.all()</span><br><span class=\"line\">    renderer_classes = (renderers.StaticHTMLRenderer,)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get</span><span class=\"params\">(self, request, *args, **kwargs)</span>:</span></span><br><span class=\"line\">        snippet = self.get_object()</span><br><span class=\"line\">        <span class=\"keyword\">return</span> Response(snippet.highlighted)</span><br></pre></td></tr></table></figure>\n<p>通常我们需要把新添加的视图增添到url配置中，编辑snippets/urls.py文件，添加我们的API:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">url(<span class=\"string\">r'^$'</span>, views.api_root),</span><br></pre></td></tr></table></figure>\n<p>添加代码高亮接口的url：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">url(<span class=\"string\">r'^snippets/(?P&lt;pk&gt;[0-9]+)/highlight/$'</span>, views.SnippetHighlight.as_view()),</span><br></pre></td></tr></table></figure>\n<h4 id=\"让我们的API变得超链接一点（Hyperlinking-our-API）\"><a href=\"#让我们的API变得超链接一点（Hyperlinking-our-API）\" class=\"headerlink\" title=\"让我们的API变得超链接一点（Hyperlinking our API）\"></a>让我们的API变得超链接一点（Hyperlinking our API）</h4><p>处理实体之间的关系是Web API设计中更具挑战性的方面之一。我们有很多不同的方式来表示一段关系:</p>\n<p>1.使用主键</p>\n<p>2.在不同的实体之间使用超链接（hyperlinking）</p>\n<p>3.使用唯一标识</p>\n<p>4.使用相关实体的默认字符串</p>\n<p>5.在父表中嵌套相关的实体</p>\n<p>6.一些其他的自定义的实现</p>\n<p>REST framework支持以上全部的策略，可以将它们应用于转发或反向关系，或者将它们应用到通用的管理器，例如通用的外键。</p>\n<p>在本例中，我们希望在实体之间使用超链接风格。为了这样做,我们会修改我们的序列化器来扩展HyperlinkedModelSerializer代替现有ModelSerializer。</p>\n<p>ModelSerializer HyperlinkedModelSerializer有以下区别:</p>\n<p>1.它默认不包含id字段</p>\n<p>2.它使用HyperlinkedIdentityField,包含url字段。</p>\n<p>3.使用HyperlinkedRelatedField来替代PrimaryKeyRelatedField表示关系</p>\n<p>编辑snippets/serializers.py文件，使用超链接来改写序列化器：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SnippetSerializer</span><span class=\"params\">(serializers.HyperlinkedModelSerializer)</span>:</span></span><br><span class=\"line\">    owner = serializers.ReadOnlyField(source=<span class=\"string\">'owner.username'</span>)</span><br><span class=\"line\">    highlight = serializers.HyperlinkedIdentityField(view_name=<span class=\"string\">'snippet-highlight'</span>, format=<span class=\"string\">'html'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Meta</span>:</span></span><br><span class=\"line\">        model = Snippet</span><br><span class=\"line\">        fields = (<span class=\"string\">'url'</span>, <span class=\"string\">'id'</span>, <span class=\"string\">'highlight'</span>, <span class=\"string\">'owner'</span>,</span><br><span class=\"line\">                  <span class=\"string\">'title'</span>, <span class=\"string\">'code'</span>, <span class=\"string\">'linenos'</span>, <span class=\"string\">'language'</span>, <span class=\"string\">'style'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">UserSerializer</span><span class=\"params\">(serializers.HyperlinkedModelSerializer)</span>:</span></span><br><span class=\"line\">    snippets = serializers.HyperlinkedRelatedField(many=<span class=\"keyword\">True</span>, view_name=<span class=\"string\">'snippet-detail'</span>, read_only=<span class=\"keyword\">True</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Meta</span>:</span></span><br><span class=\"line\">        model = User</span><br><span class=\"line\">        fields = (<span class=\"string\">'url'</span>, <span class=\"string\">'id'</span>, <span class=\"string\">'username'</span>, <span class=\"string\">'snippets'</span>)</span><br></pre></td></tr></table></figure>\n<p>需要注意，我们已经添加了新的hightlight字段。这个字段和url字段是相同的类型。它指向的是snippet-hightlight这个url配置，而不是snippet-detail这个url配置。</p>\n<p>因为我们包含了format suffixed URLs,支持类似于.json这个url，我们还需要在hightlight字段中指出，任何格式的后缀超链接都应该使用“。”html的后缀。</p>\n<h4 id=\"让我们的URL配置已被命名（Make-sure-our-URL-patterns-are-named）\"><a href=\"#让我们的URL配置已被命名（Make-sure-our-URL-patterns-are-named）\" class=\"headerlink\" title=\"让我们的URL配置已被命名（Make sure our URL patterns are named）\"></a>让我们的URL配置已被命名（Make sure our URL patterns are named）</h4><p>如果我们要有一个超链接的API，我们需要确定我们的URL路由。让我们看一下需要命名的UR路由。</p>\n<p>1.我们的API的根路由，比如user-list和snippet-list。</p>\n<p>2.我们的snippet序列化器包含的snippet-hightlight字段。</p>\n<p>3.我们的序列化器包含的snippet-detail字段。</p>\n<p>4.我们的snippet和user序列化器包含的url字段，它们默认指向{model_name}-detail，达到这样的效果snippet-detail和user-detail。</p>\n<p>当我们把以上这些名称都添加到了URL配置中后，snippets/urls.py这个文件看起来应该是这个样子的。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> django.conf.urls <span class=\"keyword\">import</span> url, include</span><br><span class=\"line\"><span class=\"keyword\">from</span> rest_framework.urlpatterns <span class=\"keyword\">import</span> format_suffix_patterns</span><br><span class=\"line\"><span class=\"keyword\">from</span> snippets <span class=\"keyword\">import</span> views</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># API endpoints</span></span><br><span class=\"line\">urlpatterns = format_suffix_patterns([</span><br><span class=\"line\">    url(<span class=\"string\">r'^$'</span>, views.api_root),</span><br><span class=\"line\">    url(<span class=\"string\">r'^snippets/$'</span>,</span><br><span class=\"line\">        views.SnippetList.as_view(),</span><br><span class=\"line\">        name=<span class=\"string\">'snippet-list'</span>),</span><br><span class=\"line\">    url(<span class=\"string\">r'^snippets/(?P&lt;pk&gt;[0-9]+)/$'</span>,</span><br><span class=\"line\">        views.SnippetDetail.as_view(),</span><br><span class=\"line\">        name=<span class=\"string\">'snippet-detail'</span>),</span><br><span class=\"line\">    url(<span class=\"string\">r'^snippets/(?P&lt;pk&gt;[0-9]+)/highlight/$'</span>,</span><br><span class=\"line\">        views.SnippetHighlight.as_view(),</span><br><span class=\"line\">        name=<span class=\"string\">'snippet-highlight'</span>),</span><br><span class=\"line\">    url(<span class=\"string\">r'^users/$'</span>,</span><br><span class=\"line\">        views.UserList.as_view(),</span><br><span class=\"line\">        name=<span class=\"string\">'user-list'</span>),</span><br><span class=\"line\">    url(<span class=\"string\">r'^users/(?P&lt;pk&gt;[0-9]+)/$'</span>,</span><br><span class=\"line\">        views.UserDetail.as_view(),</span><br><span class=\"line\">        name=<span class=\"string\">'user-detail'</span>)</span><br><span class=\"line\">])</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Login and logout views for the browsable API</span></span><br><span class=\"line\">urlpatterns += [</span><br><span class=\"line\">    url(<span class=\"string\">r'^api-auth/'</span>, include(<span class=\"string\">'rest_framework.urls'</span>,</span><br><span class=\"line\">                               namespace=<span class=\"string\">'rest_framework'</span>)),</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n<h4 id=\"添加分页功能\"><a href=\"#添加分页功能\" class=\"headerlink\" title=\"添加分页功能\"></a>添加分页功能</h4><p>我们的user或者code snippet可能会返回大量的实例，所以我们最好能够让它们分页展示，也许API客户端能够获取到独立的页面。</p>\n<p>我们可以使用分页来更改默认的列表风格，需要更改tutorial/settings.py文件：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">REST_FRAMEWORK = &#123;</span><br><span class=\"line\">    <span class=\"string\">'PAGE_SIZE'</span>: <span class=\"number\">10</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>注意：REST framework中的设置都被命名为一个名为“REST_FRAMEWORK”的单一字典，这有助于使它们与其他项目设置保持良好的分离。</p>\n<p>如果需要的话，我们也可以自定义分页样式，但在本例中，我们只使用缺省值。</p>\n<h4 id=\"浏览更改之后的API\"><a href=\"#浏览更改之后的API\" class=\"headerlink\" title=\"浏览更改之后的API\"></a>浏览更改之后的API</h4><p>如果我们打开一个浏览器打开API链接，您会发现现在可以通过跟踪超链接来使用这个API。</p>\n<p>您还可以看到snippet上的“hightlight”链接，点击浏览能够看到代码高亮的HTML表示。</p>\n<p><img src=\"/blogimg/api_root.png\" alt=\"image\"></p>\n<p><img src=\"/blogimg/highlight.png\" alt=\"image\"></p>\n<p>原文链接：<a href=\"http://www.django-rest-framework.org/tutorial/5-relationships-and-hyperlinked-apis/\" target=\"_blank\" rel=\"noopener\">http://www.django-rest-framework.org/tutorial/5-relationships-and-hyperlinked-apis/</a></p>\n","site":{"data":{}},"excerpt":"<h3 id=\"DjangoRESTframework-关系和超链接API-Relationships-amp-Hyperlinked-APIs\"><a href=\"#DjangoRESTframework-关系和超链接API-Relationships-amp-Hyperlinked-APIs\" class=\"headerlink\" title=\"DjangoRESTframework 关系和超链接API(Relationships &amp; Hyperlinked APIs)\"></a>DjangoRESTframework 关系和超链接API(Relationships &amp; Hyperlinked APIs)</h3><p>目前，我们的API内部的关系是通过使用主键来表示的。在本教程的这一部分中，我们将通过使用超链接关系来改善我们的API的内聚性和可发现性。</p>","more":"<h4 id=\"为我们的API创建一个入口\"><a href=\"#为我们的API创建一个入口\" class=\"headerlink\" title=\"为我们的API创建一个入口\"></a>为我们的API创建一个入口</h4><p>目前为止我们已经有了snippets和users两个接口，但是我们没有一个单独的API的入口点。我们使用基于方法的视图来创建一个视图，并用上之前介绍过的@api_view装饰器。需要编辑的文件是snippets/views.py,添加上如下的代码：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> rest_framework.decorators <span class=\"keyword\">import</span> api_view</span><br><span class=\"line\"><span class=\"keyword\">from</span> rest_framework.response <span class=\"keyword\">import</span> Response</span><br><span class=\"line\"><span class=\"keyword\">from</span> rest_framework.reverse <span class=\"keyword\">import</span> reverse</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@api_view(['GET'])</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">api_root</span><span class=\"params\">(request, format=None)</span>:</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> Response(&#123;</span><br><span class=\"line\">        <span class=\"string\">'users'</span>: reverse(<span class=\"string\">'user-list'</span>, request=request, format=format),</span><br><span class=\"line\">        <span class=\"string\">'snippets'</span>: reverse(<span class=\"string\">'snippet-list'</span>, request=request, format=format)</span><br><span class=\"line\">    &#125;)</span><br></pre></td></tr></table></figure>\n<p>这里需要注意两点。第一，我们使用了REST framework框架的reverse方法来返回完整限定(fully-qualified)的URLs.第二,URL规则使用名称来方便辨识的，这在之后编辑snippets/urls.py的时候将被提到。</p>\n<h4 id=\"创建一个代码高亮的接口\"><a href=\"#创建一个代码高亮的接口\" class=\"headerlink\" title=\"创建一个代码高亮的接口\"></a>创建一个代码高亮的接口</h4><p>我们的api还缺少一个关键点–代码高亮接口。</p>\n<p>不像其他的API接口，我们不希望使用JSON,我们更愿意使用HTML来作为渲染输出。REST framework提供了两种风格的HTML渲染器，第一种先使用模版来处理预渲染HTMl(pre-rendered HTML)，第二种渲染器就像之前我们所用到的。</p>\n<p>另外一件事情我们需要考虑的是创建代码高亮视图的时候不能使用现有的generic view，我们并没有返回一个对象实例，而是对象实例中的某个属性。</p>\n<p>除了使用内建的generic view，我们将使用一个base class来展示实例，创建爱你我们自己的.get()方法。需要编辑的文件是snippets/views.py。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> rest_framework <span class=\"keyword\">import</span> renderers</span><br><span class=\"line\"><span class=\"keyword\">from</span> rest_framework.response <span class=\"keyword\">import</span> Response</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SnippetHighlight</span><span class=\"params\">(generics.GenericAPIView)</span>:</span></span><br><span class=\"line\">    queryset = Snippet.objects.all()</span><br><span class=\"line\">    renderer_classes = (renderers.StaticHTMLRenderer,)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get</span><span class=\"params\">(self, request, *args, **kwargs)</span>:</span></span><br><span class=\"line\">        snippet = self.get_object()</span><br><span class=\"line\">        <span class=\"keyword\">return</span> Response(snippet.highlighted)</span><br></pre></td></tr></table></figure>\n<p>通常我们需要把新添加的视图增添到url配置中，编辑snippets/urls.py文件，添加我们的API:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">url(<span class=\"string\">r'^$'</span>, views.api_root),</span><br></pre></td></tr></table></figure>\n<p>添加代码高亮接口的url：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">url(<span class=\"string\">r'^snippets/(?P&lt;pk&gt;[0-9]+)/highlight/$'</span>, views.SnippetHighlight.as_view()),</span><br></pre></td></tr></table></figure>\n<h4 id=\"让我们的API变得超链接一点（Hyperlinking-our-API）\"><a href=\"#让我们的API变得超链接一点（Hyperlinking-our-API）\" class=\"headerlink\" title=\"让我们的API变得超链接一点（Hyperlinking our API）\"></a>让我们的API变得超链接一点（Hyperlinking our API）</h4><p>处理实体之间的关系是Web API设计中更具挑战性的方面之一。我们有很多不同的方式来表示一段关系:</p>\n<p>1.使用主键</p>\n<p>2.在不同的实体之间使用超链接（hyperlinking）</p>\n<p>3.使用唯一标识</p>\n<p>4.使用相关实体的默认字符串</p>\n<p>5.在父表中嵌套相关的实体</p>\n<p>6.一些其他的自定义的实现</p>\n<p>REST framework支持以上全部的策略，可以将它们应用于转发或反向关系，或者将它们应用到通用的管理器，例如通用的外键。</p>\n<p>在本例中，我们希望在实体之间使用超链接风格。为了这样做,我们会修改我们的序列化器来扩展HyperlinkedModelSerializer代替现有ModelSerializer。</p>\n<p>ModelSerializer HyperlinkedModelSerializer有以下区别:</p>\n<p>1.它默认不包含id字段</p>\n<p>2.它使用HyperlinkedIdentityField,包含url字段。</p>\n<p>3.使用HyperlinkedRelatedField来替代PrimaryKeyRelatedField表示关系</p>\n<p>编辑snippets/serializers.py文件，使用超链接来改写序列化器：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SnippetSerializer</span><span class=\"params\">(serializers.HyperlinkedModelSerializer)</span>:</span></span><br><span class=\"line\">    owner = serializers.ReadOnlyField(source=<span class=\"string\">'owner.username'</span>)</span><br><span class=\"line\">    highlight = serializers.HyperlinkedIdentityField(view_name=<span class=\"string\">'snippet-highlight'</span>, format=<span class=\"string\">'html'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Meta</span>:</span></span><br><span class=\"line\">        model = Snippet</span><br><span class=\"line\">        fields = (<span class=\"string\">'url'</span>, <span class=\"string\">'id'</span>, <span class=\"string\">'highlight'</span>, <span class=\"string\">'owner'</span>,</span><br><span class=\"line\">                  <span class=\"string\">'title'</span>, <span class=\"string\">'code'</span>, <span class=\"string\">'linenos'</span>, <span class=\"string\">'language'</span>, <span class=\"string\">'style'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">UserSerializer</span><span class=\"params\">(serializers.HyperlinkedModelSerializer)</span>:</span></span><br><span class=\"line\">    snippets = serializers.HyperlinkedRelatedField(many=<span class=\"keyword\">True</span>, view_name=<span class=\"string\">'snippet-detail'</span>, read_only=<span class=\"keyword\">True</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Meta</span>:</span></span><br><span class=\"line\">        model = User</span><br><span class=\"line\">        fields = (<span class=\"string\">'url'</span>, <span class=\"string\">'id'</span>, <span class=\"string\">'username'</span>, <span class=\"string\">'snippets'</span>)</span><br></pre></td></tr></table></figure>\n<p>需要注意，我们已经添加了新的hightlight字段。这个字段和url字段是相同的类型。它指向的是snippet-hightlight这个url配置，而不是snippet-detail这个url配置。</p>\n<p>因为我们包含了format suffixed URLs,支持类似于.json这个url，我们还需要在hightlight字段中指出，任何格式的后缀超链接都应该使用“。”html的后缀。</p>\n<h4 id=\"让我们的URL配置已被命名（Make-sure-our-URL-patterns-are-named）\"><a href=\"#让我们的URL配置已被命名（Make-sure-our-URL-patterns-are-named）\" class=\"headerlink\" title=\"让我们的URL配置已被命名（Make sure our URL patterns are named）\"></a>让我们的URL配置已被命名（Make sure our URL patterns are named）</h4><p>如果我们要有一个超链接的API，我们需要确定我们的URL路由。让我们看一下需要命名的UR路由。</p>\n<p>1.我们的API的根路由，比如user-list和snippet-list。</p>\n<p>2.我们的snippet序列化器包含的snippet-hightlight字段。</p>\n<p>3.我们的序列化器包含的snippet-detail字段。</p>\n<p>4.我们的snippet和user序列化器包含的url字段，它们默认指向{model_name}-detail，达到这样的效果snippet-detail和user-detail。</p>\n<p>当我们把以上这些名称都添加到了URL配置中后，snippets/urls.py这个文件看起来应该是这个样子的。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> django.conf.urls <span class=\"keyword\">import</span> url, include</span><br><span class=\"line\"><span class=\"keyword\">from</span> rest_framework.urlpatterns <span class=\"keyword\">import</span> format_suffix_patterns</span><br><span class=\"line\"><span class=\"keyword\">from</span> snippets <span class=\"keyword\">import</span> views</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># API endpoints</span></span><br><span class=\"line\">urlpatterns = format_suffix_patterns([</span><br><span class=\"line\">    url(<span class=\"string\">r'^$'</span>, views.api_root),</span><br><span class=\"line\">    url(<span class=\"string\">r'^snippets/$'</span>,</span><br><span class=\"line\">        views.SnippetList.as_view(),</span><br><span class=\"line\">        name=<span class=\"string\">'snippet-list'</span>),</span><br><span class=\"line\">    url(<span class=\"string\">r'^snippets/(?P&lt;pk&gt;[0-9]+)/$'</span>,</span><br><span class=\"line\">        views.SnippetDetail.as_view(),</span><br><span class=\"line\">        name=<span class=\"string\">'snippet-detail'</span>),</span><br><span class=\"line\">    url(<span class=\"string\">r'^snippets/(?P&lt;pk&gt;[0-9]+)/highlight/$'</span>,</span><br><span class=\"line\">        views.SnippetHighlight.as_view(),</span><br><span class=\"line\">        name=<span class=\"string\">'snippet-highlight'</span>),</span><br><span class=\"line\">    url(<span class=\"string\">r'^users/$'</span>,</span><br><span class=\"line\">        views.UserList.as_view(),</span><br><span class=\"line\">        name=<span class=\"string\">'user-list'</span>),</span><br><span class=\"line\">    url(<span class=\"string\">r'^users/(?P&lt;pk&gt;[0-9]+)/$'</span>,</span><br><span class=\"line\">        views.UserDetail.as_view(),</span><br><span class=\"line\">        name=<span class=\"string\">'user-detail'</span>)</span><br><span class=\"line\">])</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Login and logout views for the browsable API</span></span><br><span class=\"line\">urlpatterns += [</span><br><span class=\"line\">    url(<span class=\"string\">r'^api-auth/'</span>, include(<span class=\"string\">'rest_framework.urls'</span>,</span><br><span class=\"line\">                               namespace=<span class=\"string\">'rest_framework'</span>)),</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n<h4 id=\"添加分页功能\"><a href=\"#添加分页功能\" class=\"headerlink\" title=\"添加分页功能\"></a>添加分页功能</h4><p>我们的user或者code snippet可能会返回大量的实例，所以我们最好能够让它们分页展示，也许API客户端能够获取到独立的页面。</p>\n<p>我们可以使用分页来更改默认的列表风格，需要更改tutorial/settings.py文件：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">REST_FRAMEWORK = &#123;</span><br><span class=\"line\">    <span class=\"string\">'PAGE_SIZE'</span>: <span class=\"number\">10</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>注意：REST framework中的设置都被命名为一个名为“REST_FRAMEWORK”的单一字典，这有助于使它们与其他项目设置保持良好的分离。</p>\n<p>如果需要的话，我们也可以自定义分页样式，但在本例中，我们只使用缺省值。</p>\n<h4 id=\"浏览更改之后的API\"><a href=\"#浏览更改之后的API\" class=\"headerlink\" title=\"浏览更改之后的API\"></a>浏览更改之后的API</h4><p>如果我们打开一个浏览器打开API链接，您会发现现在可以通过跟踪超链接来使用这个API。</p>\n<p>您还可以看到snippet上的“hightlight”链接，点击浏览能够看到代码高亮的HTML表示。</p>\n<p><img src=\"/blogimg/api_root.png\" alt=\"image\"></p>\n<p><img src=\"/blogimg/highlight.png\" alt=\"image\"></p>\n<p>原文链接：<a href=\"http://www.django-rest-framework.org/tutorial/5-relationships-and-hyperlinked-apis/\" target=\"_blank\" rel=\"noopener\">http://www.django-rest-framework.org/tutorial/5-relationships-and-hyperlinked-apis/</a></p>"},{"title":"DjangoRESTframework-Schema和客户端类库","date":"2017-10-11T04:28:03.000Z","_content":"\n### DjangoRESTframework    Schemas & client libraries\n\nshema是一种机器可读的文档，描述了可用的API端点、它们的url以及它们支持的操作。\n\nshema可以成为自动生成文档的有用工具，还可以用于驱动与API交互的动态客户端库。\n\n<!--more-->\n\n#### Core API\n\n为了提供shema支持REST框架使用了Core API。\n\nCore API是用于描述API的文档规范。它用于提供可用接口的内部表示格式和API公开的可能交互。它既可以使用服务器端，也可以使用客户端。\n\n在使用服务器端时，Core API允许API支持对多种schema或hypermedia格式的呈现。\n\n在使用客户端时，Core API允许动态驱动的客户端库，可以与公开支持的模式或hypermedia格式的任何API交互。\n\n#### 添加schema\n\nREST framework支持显式定义的模式视图或自动生成的模式。由于我们使用的是viewset和路由器，所以我们可以简单地使用自动模式生成。\n\n为了包含API schema，您需要安装coreapi 包。\n\n```shell\npip install coreapi\n```\n\n现在，我们可以通过在URL配置中包含一个自动生成的模式视图来包含API的模式。\n\n```python\nfrom rest_framework.schemas import get_schema_view\n\nschema_view = get_schema_view(title='Pastebin API')\n\nurlpatterns = [\n    url(r'^schema/$', schema_view),\n    ...\n]\n```\n\n如果您在浏览器中访问API接口，您现在应该可以看到corejson表示作为一个选项可用。\n\n我们还可以从命令行请求schema，通过在Accept标头中指定所需的内容类型。\n\n```ptyhon\n$ http http://127.0.0.1:8000/schema/ Accept:application/coreapi+json\nHTTP/1.0 200 OK\nAllow: GET, HEAD, OPTIONS\nContent-Type: application/coreapi+json\n\n{\n    \"_meta\": {\n        \"title\": \"Pastebin API\"\n    },\n    \"_type\": \"document\",\n    ...\n```\n\n默认的输出样式是使用核心的JSON编码。\n\n其他的模式格式，如Open API也得到了支持。\n\n#### 使用命令行的客户端\n\n既然我们的API公开了一个schema 接口，我们就可以使用动态客户端库来与API交互。为了演示这一点，让我们使用核心API命令行客户端。\n\n命令行客户端可以作为coreapi-cli包:\n\n```python\n pip install coreapi-cli\n```\n\n现在检查命令行上是否有可用的命令。\n\n```shell\n$ coreapi\nUsage: coreapi [OPTIONS] COMMAND [ARGS]...\n\n  Command line client for interacting with CoreAPI services.\n\n  Visit http://www.coreapi.org for more information.\n\nOptions:\n  --version  Display the package version number.\n  --help     Show this message and exit.\n\nCommands:\n...\n```\n\n首先，我们将使用命令行客户端加载API schema。\n\n```python\n$ coreapi get http://127.0.0.1:8000/schema/\n<Pastebin API \"http://127.0.0.1:8000/schema/\">\n    snippets: {\n        highlight(id)\n        list()\n        read(id)\n    }\n    users: {\n        list()\n        read(id)\n    }\n```\n\n我们还没有经过身份验证，所以现在我们只能看到只读的接口，这与我们如何设置API的权限是一致的。\n\n让我们尝试使用命令行客户端来列出已存在的代码片段:\n\n```shell\n$ coreapi action snippets list\n[\n    {\n        \"url\": \"http://127.0.0.1:8000/snippets/1/\",\n        \"id\": 1,\n        \"highlight\": \"http://127.0.0.1:8000/snippets/1/highlight/\",\n        \"owner\": \"lucy\",\n        \"title\": \"Example\",\n        \"code\": \"print('hello, world!')\",\n        \"linenos\": true,\n        \"language\": \"python\",\n        \"style\": \"friendly\"\n    },\n    ...\n```\n\n一些API接口需要指定的参数。例如，为了获取特定代码片段的突出显示HTML，我们需要提供一个id。\n\n```shell\n$ coreapi action snippets highlight --param id=1\n<!DOCTYPE html PUBLIC \"-//W3C//DTD HTML 4.01//EN\" \"http://www.w3.org/TR/html4/strict.dtd\">\n\n<html>\n<head>\n  <title>Example</title>\n  ...\n```\n\n#### 客户端登录认证\n\n如果我们想要创建、编辑和删除代码片段，我们需要作为一个有效的用户进行身份验证。在本例中，我们将使用基本的身份验证。\n\n使用您的实际用户名和密码来替换下面的用户名和密码。\n\n```python\n$ coreapi credentials add 127.0.0.1 <username>:<password> --auth basic\nAdded credentials\n127.0.0.1 \"Basic <...>\"\n```\n\n现在，如果我们再次获取shema，我们应该能够看到完整的可用交互集。\n\n```shell\n$ coreapi reload\nPastebin API \"http://127.0.0.1:8000/schema/\">\n    snippets: {\n        create(code, [title], [linenos], [language], [style])\n        delete(id)\n        highlight(id)\n        list()\n        partial_update(id, [title], [code], [linenos], [language], [style])\n        read(id)\n        update(id, code, [title], [linenos], [language], [style])\n    }\n    users: {\n        list()\n        read(id)\n    }\n```\n\n我们现在可以与这些接口进行交互。例如，要创建一个新的代码片段:\n\n```shell\n$ coreapi action snippets create --param title=\"Example\" --param code=\"print('hello, world')\"\n{\n    \"url\": \"http://127.0.0.1:8000/snippets/7/\",\n    \"id\": 7,\n    \"highlight\": \"http://127.0.0.1:8000/snippets/7/highlight/\",\n    \"owner\": \"lucy\",\n    \"title\": \"Example\",\n    \"code\": \"print('hello, world')\",\n    \"linenos\": false,\n    \"language\": \"python\",\n    \"style\": \"friendly\"\n}\n```\n\n然后删除一个片段:\n\n```shell\n$ coreapi action snippets delete --param id=7\n```\n\n除了命令行客户端，开发人员还可以使用客户端库与您的API进行交互。Python客户机库是第一个可用的，并且计划很快发布一个Javascript客户机库。\n\n关于定制模式生成和使用核心API客户端库的更多细节，您需要参考完整的文档。\n\n#### 回顾一下我们的工作\n\n有了非常少的代码，我们现在得到了一个完整的粘贴本Web API，它是完全Web浏览的，包括一个由模式驱动的客户端库，并且完成了身份验证、每个对象的权限和多个渲染器格式。\n\n我们已经经历了设计过程的每一步，并看到如果我们需要定制任何东西，我们就可以逐步地使用普通的Django视图。\n\n您可以在GitHub上查看最终的教程代码，或者在沙箱中尝试这个示例。\n\n原文链接:http://www.django-rest-framework.org/tutorial/7-schemas-and-client-libraries/","source":"_posts/DjangoRESTframework-SchemaClientLib.md","raw":"---\ntitle: DjangoRESTframework-Schema和客户端类库\ncategories:\n  - Program\ntags:\n  - djangorestframework\ndate: 2017-10-11 12:28:03\n---\n\n### DjangoRESTframework    Schemas & client libraries\n\nshema是一种机器可读的文档，描述了可用的API端点、它们的url以及它们支持的操作。\n\nshema可以成为自动生成文档的有用工具，还可以用于驱动与API交互的动态客户端库。\n\n<!--more-->\n\n#### Core API\n\n为了提供shema支持REST框架使用了Core API。\n\nCore API是用于描述API的文档规范。它用于提供可用接口的内部表示格式和API公开的可能交互。它既可以使用服务器端，也可以使用客户端。\n\n在使用服务器端时，Core API允许API支持对多种schema或hypermedia格式的呈现。\n\n在使用客户端时，Core API允许动态驱动的客户端库，可以与公开支持的模式或hypermedia格式的任何API交互。\n\n#### 添加schema\n\nREST framework支持显式定义的模式视图或自动生成的模式。由于我们使用的是viewset和路由器，所以我们可以简单地使用自动模式生成。\n\n为了包含API schema，您需要安装coreapi 包。\n\n```shell\npip install coreapi\n```\n\n现在，我们可以通过在URL配置中包含一个自动生成的模式视图来包含API的模式。\n\n```python\nfrom rest_framework.schemas import get_schema_view\n\nschema_view = get_schema_view(title='Pastebin API')\n\nurlpatterns = [\n    url(r'^schema/$', schema_view),\n    ...\n]\n```\n\n如果您在浏览器中访问API接口，您现在应该可以看到corejson表示作为一个选项可用。\n\n我们还可以从命令行请求schema，通过在Accept标头中指定所需的内容类型。\n\n```ptyhon\n$ http http://127.0.0.1:8000/schema/ Accept:application/coreapi+json\nHTTP/1.0 200 OK\nAllow: GET, HEAD, OPTIONS\nContent-Type: application/coreapi+json\n\n{\n    \"_meta\": {\n        \"title\": \"Pastebin API\"\n    },\n    \"_type\": \"document\",\n    ...\n```\n\n默认的输出样式是使用核心的JSON编码。\n\n其他的模式格式，如Open API也得到了支持。\n\n#### 使用命令行的客户端\n\n既然我们的API公开了一个schema 接口，我们就可以使用动态客户端库来与API交互。为了演示这一点，让我们使用核心API命令行客户端。\n\n命令行客户端可以作为coreapi-cli包:\n\n```python\n pip install coreapi-cli\n```\n\n现在检查命令行上是否有可用的命令。\n\n```shell\n$ coreapi\nUsage: coreapi [OPTIONS] COMMAND [ARGS]...\n\n  Command line client for interacting with CoreAPI services.\n\n  Visit http://www.coreapi.org for more information.\n\nOptions:\n  --version  Display the package version number.\n  --help     Show this message and exit.\n\nCommands:\n...\n```\n\n首先，我们将使用命令行客户端加载API schema。\n\n```python\n$ coreapi get http://127.0.0.1:8000/schema/\n<Pastebin API \"http://127.0.0.1:8000/schema/\">\n    snippets: {\n        highlight(id)\n        list()\n        read(id)\n    }\n    users: {\n        list()\n        read(id)\n    }\n```\n\n我们还没有经过身份验证，所以现在我们只能看到只读的接口，这与我们如何设置API的权限是一致的。\n\n让我们尝试使用命令行客户端来列出已存在的代码片段:\n\n```shell\n$ coreapi action snippets list\n[\n    {\n        \"url\": \"http://127.0.0.1:8000/snippets/1/\",\n        \"id\": 1,\n        \"highlight\": \"http://127.0.0.1:8000/snippets/1/highlight/\",\n        \"owner\": \"lucy\",\n        \"title\": \"Example\",\n        \"code\": \"print('hello, world!')\",\n        \"linenos\": true,\n        \"language\": \"python\",\n        \"style\": \"friendly\"\n    },\n    ...\n```\n\n一些API接口需要指定的参数。例如，为了获取特定代码片段的突出显示HTML，我们需要提供一个id。\n\n```shell\n$ coreapi action snippets highlight --param id=1\n<!DOCTYPE html PUBLIC \"-//W3C//DTD HTML 4.01//EN\" \"http://www.w3.org/TR/html4/strict.dtd\">\n\n<html>\n<head>\n  <title>Example</title>\n  ...\n```\n\n#### 客户端登录认证\n\n如果我们想要创建、编辑和删除代码片段，我们需要作为一个有效的用户进行身份验证。在本例中，我们将使用基本的身份验证。\n\n使用您的实际用户名和密码来替换下面的用户名和密码。\n\n```python\n$ coreapi credentials add 127.0.0.1 <username>:<password> --auth basic\nAdded credentials\n127.0.0.1 \"Basic <...>\"\n```\n\n现在，如果我们再次获取shema，我们应该能够看到完整的可用交互集。\n\n```shell\n$ coreapi reload\nPastebin API \"http://127.0.0.1:8000/schema/\">\n    snippets: {\n        create(code, [title], [linenos], [language], [style])\n        delete(id)\n        highlight(id)\n        list()\n        partial_update(id, [title], [code], [linenos], [language], [style])\n        read(id)\n        update(id, code, [title], [linenos], [language], [style])\n    }\n    users: {\n        list()\n        read(id)\n    }\n```\n\n我们现在可以与这些接口进行交互。例如，要创建一个新的代码片段:\n\n```shell\n$ coreapi action snippets create --param title=\"Example\" --param code=\"print('hello, world')\"\n{\n    \"url\": \"http://127.0.0.1:8000/snippets/7/\",\n    \"id\": 7,\n    \"highlight\": \"http://127.0.0.1:8000/snippets/7/highlight/\",\n    \"owner\": \"lucy\",\n    \"title\": \"Example\",\n    \"code\": \"print('hello, world')\",\n    \"linenos\": false,\n    \"language\": \"python\",\n    \"style\": \"friendly\"\n}\n```\n\n然后删除一个片段:\n\n```shell\n$ coreapi action snippets delete --param id=7\n```\n\n除了命令行客户端，开发人员还可以使用客户端库与您的API进行交互。Python客户机库是第一个可用的，并且计划很快发布一个Javascript客户机库。\n\n关于定制模式生成和使用核心API客户端库的更多细节，您需要参考完整的文档。\n\n#### 回顾一下我们的工作\n\n有了非常少的代码，我们现在得到了一个完整的粘贴本Web API，它是完全Web浏览的，包括一个由模式驱动的客户端库，并且完成了身份验证、每个对象的权限和多个渲染器格式。\n\n我们已经经历了设计过程的每一步，并看到如果我们需要定制任何东西，我们就可以逐步地使用普通的Django视图。\n\n您可以在GitHub上查看最终的教程代码，或者在沙箱中尝试这个示例。\n\n原文链接:http://www.django-rest-framework.org/tutorial/7-schemas-and-client-libraries/","slug":"DjangoRESTframework-SchemaClientLib","published":1,"updated":"2017-12-04T07:27:28.754Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjeqig1ku0016lgqakw75olx8","content":"<h3 id=\"DjangoRESTframework-Schemas-amp-client-libraries\"><a href=\"#DjangoRESTframework-Schemas-amp-client-libraries\" class=\"headerlink\" title=\"DjangoRESTframework    Schemas &amp; client libraries\"></a>DjangoRESTframework    Schemas &amp; client libraries</h3><p>shema是一种机器可读的文档，描述了可用的API端点、它们的url以及它们支持的操作。</p>\n<p>shema可以成为自动生成文档的有用工具，还可以用于驱动与API交互的动态客户端库。</p>\n<a id=\"more\"></a>\n<h4 id=\"Core-API\"><a href=\"#Core-API\" class=\"headerlink\" title=\"Core API\"></a>Core API</h4><p>为了提供shema支持REST框架使用了Core API。</p>\n<p>Core API是用于描述API的文档规范。它用于提供可用接口的内部表示格式和API公开的可能交互。它既可以使用服务器端，也可以使用客户端。</p>\n<p>在使用服务器端时，Core API允许API支持对多种schema或hypermedia格式的呈现。</p>\n<p>在使用客户端时，Core API允许动态驱动的客户端库，可以与公开支持的模式或hypermedia格式的任何API交互。</p>\n<h4 id=\"添加schema\"><a href=\"#添加schema\" class=\"headerlink\" title=\"添加schema\"></a>添加schema</h4><p>REST framework支持显式定义的模式视图或自动生成的模式。由于我们使用的是viewset和路由器，所以我们可以简单地使用自动模式生成。</p>\n<p>为了包含API schema，您需要安装coreapi 包。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip install coreapi</span><br></pre></td></tr></table></figure>\n<p>现在，我们可以通过在URL配置中包含一个自动生成的模式视图来包含API的模式。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> rest_framework.schemas <span class=\"keyword\">import</span> get_schema_view</span><br><span class=\"line\"></span><br><span class=\"line\">schema_view = get_schema_view(title=<span class=\"string\">'Pastebin API'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">urlpatterns = [</span><br><span class=\"line\">    url(<span class=\"string\">r'^schema/$'</span>, schema_view),</span><br><span class=\"line\">    ...</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n<p>如果您在浏览器中访问API接口，您现在应该可以看到corejson表示作为一个选项可用。</p>\n<p>我们还可以从命令行请求schema，通过在Accept标头中指定所需的内容类型。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ http http://127.0.0.1:8000/schema/ Accept:application/coreapi+json</span><br><span class=\"line\">HTTP/1.0 200 OK</span><br><span class=\"line\">Allow: GET, HEAD, OPTIONS</span><br><span class=\"line\">Content-Type: application/coreapi+json</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    &quot;_meta&quot;: &#123;</span><br><span class=\"line\">        &quot;title&quot;: &quot;Pastebin API&quot;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &quot;_type&quot;: &quot;document&quot;,</span><br><span class=\"line\">    ...</span><br></pre></td></tr></table></figure>\n<p>默认的输出样式是使用核心的JSON编码。</p>\n<p>其他的模式格式，如Open API也得到了支持。</p>\n<h4 id=\"使用命令行的客户端\"><a href=\"#使用命令行的客户端\" class=\"headerlink\" title=\"使用命令行的客户端\"></a>使用命令行的客户端</h4><p>既然我们的API公开了一个schema 接口，我们就可以使用动态客户端库来与API交互。为了演示这一点，让我们使用核心API命令行客户端。</p>\n<p>命令行客户端可以作为coreapi-cli包:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip install coreapi-cli</span><br></pre></td></tr></table></figure>\n<p>现在检查命令行上是否有可用的命令。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> coreapi</span></span><br><span class=\"line\">Usage: coreapi [OPTIONS] COMMAND [ARGS]...</span><br><span class=\"line\"></span><br><span class=\"line\">  Command line client for interacting with CoreAPI services.</span><br><span class=\"line\"></span><br><span class=\"line\">  Visit http://www.coreapi.org for more information.</span><br><span class=\"line\"></span><br><span class=\"line\">Options:</span><br><span class=\"line\">  --version  Display the package version number.</span><br><span class=\"line\">  --help     Show this message and exit.</span><br><span class=\"line\"></span><br><span class=\"line\">Commands:</span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure>\n<p>首先，我们将使用命令行客户端加载API schema。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ coreapi get http://<span class=\"number\">127.0</span><span class=\"number\">.0</span><span class=\"number\">.1</span>:<span class=\"number\">8000</span>/schema/</span><br><span class=\"line\">&lt;Pastebin API <span class=\"string\">\"http://127.0.0.1:8000/schema/\"</span>&gt;</span><br><span class=\"line\">    snippets: &#123;</span><br><span class=\"line\">        highlight(id)</span><br><span class=\"line\">        list()</span><br><span class=\"line\">        read(id)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    users: &#123;</span><br><span class=\"line\">        list()</span><br><span class=\"line\">        read(id)</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<p>我们还没有经过身份验证，所以现在我们只能看到只读的接口，这与我们如何设置API的权限是一致的。</p>\n<p>让我们尝试使用命令行客户端来列出已存在的代码片段:</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> coreapi action snippets list</span></span><br><span class=\"line\">[</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        \"url\": \"http://127.0.0.1:8000/snippets/1/\",</span><br><span class=\"line\">        \"id\": 1,</span><br><span class=\"line\">        \"highlight\": \"http://127.0.0.1:8000/snippets/1/highlight/\",</span><br><span class=\"line\">        \"owner\": \"lucy\",</span><br><span class=\"line\">        \"title\": \"Example\",</span><br><span class=\"line\">        \"code\": \"print('hello, world!')\",</span><br><span class=\"line\">        \"linenos\": true,</span><br><span class=\"line\">        \"language\": \"python\",</span><br><span class=\"line\">        \"style\": \"friendly\"</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    ...</span><br></pre></td></tr></table></figure>\n<p>一些API接口需要指定的参数。例如，为了获取特定代码片段的突出显示HTML，我们需要提供一个id。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> coreapi action snippets highlight --param id=1</span></span><br><span class=\"line\">&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD HTML 4.01//EN\" \"http://www.w3.org/TR/html4/strict.dtd\"&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;html&gt;</span><br><span class=\"line\">&lt;head&gt;</span><br><span class=\"line\">  &lt;title&gt;Example&lt;/title&gt;</span><br><span class=\"line\">  ...</span><br></pre></td></tr></table></figure>\n<h4 id=\"客户端登录认证\"><a href=\"#客户端登录认证\" class=\"headerlink\" title=\"客户端登录认证\"></a>客户端登录认证</h4><p>如果我们想要创建、编辑和删除代码片段，我们需要作为一个有效的用户进行身份验证。在本例中，我们将使用基本的身份验证。</p>\n<p>使用您的实际用户名和密码来替换下面的用户名和密码。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ coreapi credentials add <span class=\"number\">127.0</span><span class=\"number\">.0</span><span class=\"number\">.1</span> &lt;username&gt;:&lt;password&gt; --auth basic</span><br><span class=\"line\">Added credentials</span><br><span class=\"line\"><span class=\"number\">127.0</span><span class=\"number\">.0</span><span class=\"number\">.1</span> <span class=\"string\">\"Basic &lt;...&gt;\"</span></span><br></pre></td></tr></table></figure>\n<p>现在，如果我们再次获取shema，我们应该能够看到完整的可用交互集。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> coreapi reload</span></span><br><span class=\"line\">Pastebin API \"http://127.0.0.1:8000/schema/\"&gt;</span><br><span class=\"line\">    snippets: &#123;</span><br><span class=\"line\">        create(code, [title], [linenos], [language], [style])</span><br><span class=\"line\">        delete(id)</span><br><span class=\"line\">        highlight(id)</span><br><span class=\"line\">        list()</span><br><span class=\"line\">        partial_update(id, [title], [code], [linenos], [language], [style])</span><br><span class=\"line\">        read(id)</span><br><span class=\"line\">        update(id, code, [title], [linenos], [language], [style])</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    users: &#123;</span><br><span class=\"line\">        list()</span><br><span class=\"line\">        read(id)</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<p>我们现在可以与这些接口进行交互。例如，要创建一个新的代码片段:</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> coreapi action snippets create --param title=<span class=\"string\">\"Example\"</span> --param code=<span class=\"string\">\"print('hello, world')\"</span></span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    \"url\": \"http://127.0.0.1:8000/snippets/7/\",</span><br><span class=\"line\">    \"id\": 7,</span><br><span class=\"line\">    \"highlight\": \"http://127.0.0.1:8000/snippets/7/highlight/\",</span><br><span class=\"line\">    \"owner\": \"lucy\",</span><br><span class=\"line\">    \"title\": \"Example\",</span><br><span class=\"line\">    \"code\": \"print('hello, world')\",</span><br><span class=\"line\">    \"linenos\": false,</span><br><span class=\"line\">    \"language\": \"python\",</span><br><span class=\"line\">    \"style\": \"friendly\"</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>然后删除一个片段:</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> coreapi action snippets delete --param id=7</span></span><br></pre></td></tr></table></figure>\n<p>除了命令行客户端，开发人员还可以使用客户端库与您的API进行交互。Python客户机库是第一个可用的，并且计划很快发布一个Javascript客户机库。</p>\n<p>关于定制模式生成和使用核心API客户端库的更多细节，您需要参考完整的文档。</p>\n<h4 id=\"回顾一下我们的工作\"><a href=\"#回顾一下我们的工作\" class=\"headerlink\" title=\"回顾一下我们的工作\"></a>回顾一下我们的工作</h4><p>有了非常少的代码，我们现在得到了一个完整的粘贴本Web API，它是完全Web浏览的，包括一个由模式驱动的客户端库，并且完成了身份验证、每个对象的权限和多个渲染器格式。</p>\n<p>我们已经经历了设计过程的每一步，并看到如果我们需要定制任何东西，我们就可以逐步地使用普通的Django视图。</p>\n<p>您可以在GitHub上查看最终的教程代码，或者在沙箱中尝试这个示例。</p>\n<p>原文链接:<a href=\"http://www.django-rest-framework.org/tutorial/7-schemas-and-client-libraries/\" target=\"_blank\" rel=\"noopener\">http://www.django-rest-framework.org/tutorial/7-schemas-and-client-libraries/</a></p>\n","site":{"data":{}},"excerpt":"<h3 id=\"DjangoRESTframework-Schemas-amp-client-libraries\"><a href=\"#DjangoRESTframework-Schemas-amp-client-libraries\" class=\"headerlink\" title=\"DjangoRESTframework    Schemas &amp; client libraries\"></a>DjangoRESTframework    Schemas &amp; client libraries</h3><p>shema是一种机器可读的文档，描述了可用的API端点、它们的url以及它们支持的操作。</p>\n<p>shema可以成为自动生成文档的有用工具，还可以用于驱动与API交互的动态客户端库。</p>","more":"<h4 id=\"Core-API\"><a href=\"#Core-API\" class=\"headerlink\" title=\"Core API\"></a>Core API</h4><p>为了提供shema支持REST框架使用了Core API。</p>\n<p>Core API是用于描述API的文档规范。它用于提供可用接口的内部表示格式和API公开的可能交互。它既可以使用服务器端，也可以使用客户端。</p>\n<p>在使用服务器端时，Core API允许API支持对多种schema或hypermedia格式的呈现。</p>\n<p>在使用客户端时，Core API允许动态驱动的客户端库，可以与公开支持的模式或hypermedia格式的任何API交互。</p>\n<h4 id=\"添加schema\"><a href=\"#添加schema\" class=\"headerlink\" title=\"添加schema\"></a>添加schema</h4><p>REST framework支持显式定义的模式视图或自动生成的模式。由于我们使用的是viewset和路由器，所以我们可以简单地使用自动模式生成。</p>\n<p>为了包含API schema，您需要安装coreapi 包。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip install coreapi</span><br></pre></td></tr></table></figure>\n<p>现在，我们可以通过在URL配置中包含一个自动生成的模式视图来包含API的模式。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> rest_framework.schemas <span class=\"keyword\">import</span> get_schema_view</span><br><span class=\"line\"></span><br><span class=\"line\">schema_view = get_schema_view(title=<span class=\"string\">'Pastebin API'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">urlpatterns = [</span><br><span class=\"line\">    url(<span class=\"string\">r'^schema/$'</span>, schema_view),</span><br><span class=\"line\">    ...</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n<p>如果您在浏览器中访问API接口，您现在应该可以看到corejson表示作为一个选项可用。</p>\n<p>我们还可以从命令行请求schema，通过在Accept标头中指定所需的内容类型。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ http http://127.0.0.1:8000/schema/ Accept:application/coreapi+json</span><br><span class=\"line\">HTTP/1.0 200 OK</span><br><span class=\"line\">Allow: GET, HEAD, OPTIONS</span><br><span class=\"line\">Content-Type: application/coreapi+json</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    &quot;_meta&quot;: &#123;</span><br><span class=\"line\">        &quot;title&quot;: &quot;Pastebin API&quot;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &quot;_type&quot;: &quot;document&quot;,</span><br><span class=\"line\">    ...</span><br></pre></td></tr></table></figure>\n<p>默认的输出样式是使用核心的JSON编码。</p>\n<p>其他的模式格式，如Open API也得到了支持。</p>\n<h4 id=\"使用命令行的客户端\"><a href=\"#使用命令行的客户端\" class=\"headerlink\" title=\"使用命令行的客户端\"></a>使用命令行的客户端</h4><p>既然我们的API公开了一个schema 接口，我们就可以使用动态客户端库来与API交互。为了演示这一点，让我们使用核心API命令行客户端。</p>\n<p>命令行客户端可以作为coreapi-cli包:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip install coreapi-cli</span><br></pre></td></tr></table></figure>\n<p>现在检查命令行上是否有可用的命令。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> coreapi</span></span><br><span class=\"line\">Usage: coreapi [OPTIONS] COMMAND [ARGS]...</span><br><span class=\"line\"></span><br><span class=\"line\">  Command line client for interacting with CoreAPI services.</span><br><span class=\"line\"></span><br><span class=\"line\">  Visit http://www.coreapi.org for more information.</span><br><span class=\"line\"></span><br><span class=\"line\">Options:</span><br><span class=\"line\">  --version  Display the package version number.</span><br><span class=\"line\">  --help     Show this message and exit.</span><br><span class=\"line\"></span><br><span class=\"line\">Commands:</span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure>\n<p>首先，我们将使用命令行客户端加载API schema。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ coreapi get http://<span class=\"number\">127.0</span><span class=\"number\">.0</span><span class=\"number\">.1</span>:<span class=\"number\">8000</span>/schema/</span><br><span class=\"line\">&lt;Pastebin API <span class=\"string\">\"http://127.0.0.1:8000/schema/\"</span>&gt;</span><br><span class=\"line\">    snippets: &#123;</span><br><span class=\"line\">        highlight(id)</span><br><span class=\"line\">        list()</span><br><span class=\"line\">        read(id)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    users: &#123;</span><br><span class=\"line\">        list()</span><br><span class=\"line\">        read(id)</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<p>我们还没有经过身份验证，所以现在我们只能看到只读的接口，这与我们如何设置API的权限是一致的。</p>\n<p>让我们尝试使用命令行客户端来列出已存在的代码片段:</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> coreapi action snippets list</span></span><br><span class=\"line\">[</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        \"url\": \"http://127.0.0.1:8000/snippets/1/\",</span><br><span class=\"line\">        \"id\": 1,</span><br><span class=\"line\">        \"highlight\": \"http://127.0.0.1:8000/snippets/1/highlight/\",</span><br><span class=\"line\">        \"owner\": \"lucy\",</span><br><span class=\"line\">        \"title\": \"Example\",</span><br><span class=\"line\">        \"code\": \"print('hello, world!')\",</span><br><span class=\"line\">        \"linenos\": true,</span><br><span class=\"line\">        \"language\": \"python\",</span><br><span class=\"line\">        \"style\": \"friendly\"</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    ...</span><br></pre></td></tr></table></figure>\n<p>一些API接口需要指定的参数。例如，为了获取特定代码片段的突出显示HTML，我们需要提供一个id。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> coreapi action snippets highlight --param id=1</span></span><br><span class=\"line\">&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD HTML 4.01//EN\" \"http://www.w3.org/TR/html4/strict.dtd\"&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;html&gt;</span><br><span class=\"line\">&lt;head&gt;</span><br><span class=\"line\">  &lt;title&gt;Example&lt;/title&gt;</span><br><span class=\"line\">  ...</span><br></pre></td></tr></table></figure>\n<h4 id=\"客户端登录认证\"><a href=\"#客户端登录认证\" class=\"headerlink\" title=\"客户端登录认证\"></a>客户端登录认证</h4><p>如果我们想要创建、编辑和删除代码片段，我们需要作为一个有效的用户进行身份验证。在本例中，我们将使用基本的身份验证。</p>\n<p>使用您的实际用户名和密码来替换下面的用户名和密码。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ coreapi credentials add <span class=\"number\">127.0</span><span class=\"number\">.0</span><span class=\"number\">.1</span> &lt;username&gt;:&lt;password&gt; --auth basic</span><br><span class=\"line\">Added credentials</span><br><span class=\"line\"><span class=\"number\">127.0</span><span class=\"number\">.0</span><span class=\"number\">.1</span> <span class=\"string\">\"Basic &lt;...&gt;\"</span></span><br></pre></td></tr></table></figure>\n<p>现在，如果我们再次获取shema，我们应该能够看到完整的可用交互集。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> coreapi reload</span></span><br><span class=\"line\">Pastebin API \"http://127.0.0.1:8000/schema/\"&gt;</span><br><span class=\"line\">    snippets: &#123;</span><br><span class=\"line\">        create(code, [title], [linenos], [language], [style])</span><br><span class=\"line\">        delete(id)</span><br><span class=\"line\">        highlight(id)</span><br><span class=\"line\">        list()</span><br><span class=\"line\">        partial_update(id, [title], [code], [linenos], [language], [style])</span><br><span class=\"line\">        read(id)</span><br><span class=\"line\">        update(id, code, [title], [linenos], [language], [style])</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    users: &#123;</span><br><span class=\"line\">        list()</span><br><span class=\"line\">        read(id)</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<p>我们现在可以与这些接口进行交互。例如，要创建一个新的代码片段:</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> coreapi action snippets create --param title=<span class=\"string\">\"Example\"</span> --param code=<span class=\"string\">\"print('hello, world')\"</span></span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    \"url\": \"http://127.0.0.1:8000/snippets/7/\",</span><br><span class=\"line\">    \"id\": 7,</span><br><span class=\"line\">    \"highlight\": \"http://127.0.0.1:8000/snippets/7/highlight/\",</span><br><span class=\"line\">    \"owner\": \"lucy\",</span><br><span class=\"line\">    \"title\": \"Example\",</span><br><span class=\"line\">    \"code\": \"print('hello, world')\",</span><br><span class=\"line\">    \"linenos\": false,</span><br><span class=\"line\">    \"language\": \"python\",</span><br><span class=\"line\">    \"style\": \"friendly\"</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>然后删除一个片段:</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> coreapi action snippets delete --param id=7</span></span><br></pre></td></tr></table></figure>\n<p>除了命令行客户端，开发人员还可以使用客户端库与您的API进行交互。Python客户机库是第一个可用的，并且计划很快发布一个Javascript客户机库。</p>\n<p>关于定制模式生成和使用核心API客户端库的更多细节，您需要参考完整的文档。</p>\n<h4 id=\"回顾一下我们的工作\"><a href=\"#回顾一下我们的工作\" class=\"headerlink\" title=\"回顾一下我们的工作\"></a>回顾一下我们的工作</h4><p>有了非常少的代码，我们现在得到了一个完整的粘贴本Web API，它是完全Web浏览的，包括一个由模式驱动的客户端库，并且完成了身份验证、每个对象的权限和多个渲染器格式。</p>\n<p>我们已经经历了设计过程的每一步，并看到如果我们需要定制任何东西，我们就可以逐步地使用普通的Django视图。</p>\n<p>您可以在GitHub上查看最终的教程代码，或者在沙箱中尝试这个示例。</p>\n<p>原文链接:<a href=\"http://www.django-rest-framework.org/tutorial/7-schemas-and-client-libraries/\" target=\"_blank\" rel=\"noopener\">http://www.django-rest-framework.org/tutorial/7-schemas-and-client-libraries/</a></p>"},{"title":"DjangoRESTframework-请求与响应（Request Response）","date":"2017-10-10T08:05:41.000Z","_content":"\n### DjangoRESTframework-------请求与响应（Request and Response）\n\n在这一章，我们将真正的开始接触REST framework的核心了。接下来介绍一下几个内建模块。\n\n#### Request对象\n\nREST framework提供了一个Request对象，它派生自HttpRequest，提供更多弹性的访问数据的序列化操作。它的核心是request.data属性，它类似于request.POST，在Web API中用处很大。\n\n<!--more-->\n\n```code\nrequest.POST #只能处理表单数据，只能在POST方法中起作用\nrequest.data #可以处理任意的数据，能够在POST,PUT,PATCH方法中起作用\n```\n\n#### Response对象\n\nREST framework提供了Response对象，他是一个TemplateResponse类型的对象，它能够提供未渲染的内容，使用合适的数据类型返回给客户端。\n\n```code\nreturn Response(data) #渲染数据给客户端\n```\n\n#### Status codes\n\n使用数字状态的HTTP响应码，用于不必要的数据读取。它的使用需要非常注意，如果你给出了一个错误的状态码。REST framework为每个状态提供了更明确的状态码，比如HTTP_400_BAD_REQUEST\n\n#### Wrapping API views\n\nREST framework提供了两种wrapper，你可以用来编写API views\n\n1.@api_view 装饰器，用于基于方法的视图\n\n2.APIVIEW类，用于基于类的视图\n\n这些装饰器提供了基本的方法能够确保你收到Request实例，为Reponse对象添加上下文。\n\n这些装饰器也提供一些行为控制，比如返回405 Method Not Allowed在合适的情况下，也能够处理任何ParseError异常，当request.data是非法输入时。\n\n#### 把以上的内容拼起来复习一下，Pulling it all together\n\n好了，现在我们可以使用这些新组件来编写view了。我们不需views.py中引入JSONResponse类，删掉它，继续coding。\n\n```python\nfrom rest_framework import status\nfrom rest_framework.decorators import api_view\nfrom rest_framework.response import Response\nfrom snippets.models import Snippet\nfrom snippets.serializers import SnippetSerializer\n\n@api_view(['GET', 'POST'])\ndef snippet_list(request):\n  if request.method == 'GET':\n    snippet = Snippet.objects.all()\n    serializer = SnippetSerializer(snippets, many=True)\n    return Reponse(serializer.data)\n  \n  elif request.method == 'POST':\n    serializer = SnippetSerializer(data=request.data)\n    if serializer.is_valid():\n      serializer.save()\n      return Response(serializer.data, status=status.HTTP_201_CREATED)\n    return Response(serializer.errors, status=status.HTTP_400_BAD_REQUEST)\n```\n\n现在的视图与之前相比，显得更加简洁了一些，看起来和Forms API看起来也非常相似。我们也使用了status codes，使我们返回的意义更加明确。下面是snippet的详细视图，对应的文件是views.py:\n\n```python\n@api_view(['GET', 'PUT', 'DELETE'])\ndef snippet_detail(request, pk):\n    \"\"\"\n    Retrieve, update or delete a code snippet.\n    \"\"\"\n    try:\n        snippet = Snippet.objects.get(pk=pk)\n    except Snippet.DoesNotExist:\n        return Response(status=status.HTTP_404_NOT_FOUND)\n\n    if request.method == 'GET':\n        serializer = SnippetSerializer(snippet)\n        return Response(serializer.data)\n\n    elif request.method == 'PUT':\n        serializer = SnippetSerializer(snippet, data=request.data)\n        if serializer.is_valid():\n            serializer.save()\n            return Response(serializer.data)\n        return Response(serializer.errors, status=status.HTTP_400_BAD_REQUEST)\n\n    elif request.method == 'DELETE':\n        snippet.delete()\n        return Response(status=status.HTTP_204_NO_CONTENT)\n```\n\n这看起来就更加熟悉了，和一般的Django视图区别不大。\n\n注意：我们不再明确的指定request和response中的内容类型，request.data能够帮我们处理传入的json格式的请求数据，但是它也能给处理其他类型的格式。类似地，我们能返回响应对象数据，允许REST framework用合适的数据类型渲染响应。\n\n#### 给我们的URLs添加可选的格式前缀\n\n利用这一优点，我们的响应内容不再硬生生的绑定单一的内容格式，而可以支持格式前缀，定义我们需要返回的格式。比如http://example.com/api/items/4.sjon.\n\n要达到这个目的的话，需要给添加一个format参数，就像这样：\n\n```python\ndef snippet_list(request, format=None)\n```\n\n```python\ndef snippet_detail(request, pk, format=None)\n```\n\n现在需要更新urls.py,追加format_suffix_patterns\n\n```python\nfrom django.conf.urls import url\nfrom rest_framework.urlpatterns import format_suffix_patterns\nfrom snippets import views\n\n\nurlpatterns = [\n    url(r'^snippets/$', views.snippet_list),\n    url(r'^snippets/(?P<pk>[0-9]+)$', views.snippet_detail),\n]\n\nurlpatterns = fromat_suffix_patterns(urlpatterns)\n```\n\n\n\n我们就不再需要添加其他额外的url策略，就能够给我们一个清晰，简洁的支持指定需要的响应格式。\n\n#### 应用跑起来是怎样的呢？\n\n我们可以和之前一样列出所有的snippets\n\n```shell\nPS E:\\Study\\Serializer_tutorial\\tutorial> http http://127.0.0.1:8000/snippets/\nHTTP/1.0 200 OK\nAllow: POST, OPTIONS, GET\nContent-Length: 319\nContent-Type: application/json\nDate: Tue, 10 Oct 2017 07:52:59 GMT\nServer: WSGIServer/0.1 Python/2.7.13\nVary: Accept, Cookie\nX-Frame-Options: SAMEORIGIN\n\n[\n    {\n        \"code\": \"foo = \\\"bar\\\"\\n\",\n        \"id\": 1,\n        \"language\": \"python\",\n        \"linenos\": false,\n        \"style\": \"friendly\",\n        \"title\": \"\"\n    },\n    {\n        \"code\": \"print \\\"hello, world\\n\\\"\",\n        \"id\": 2,\n        \"language\": \"python\",\n        \"linenos\": false,\n        \"style\": \"friendly\",\n        \"title\": \"\"\n    },\n    {\n        \"code\": \"print \\\"hello, world\\n\\\"\",\n        \"id\": 3,\n        \"language\": \"python\",\n        \"linenos\": false,\n        \"style\": \"friendly\",\n        \"title\": \"\"\n    }\n]\n```\n\n我们也可以控制返回的格式，利用HTTP头或者格式前缀。\n\n```bash\n\nPS E:\\Study\\Serializer_tutorial\\tutorial> http http://127.0.0.1:8000/snippets/ Accept:application/json\nHTTP/1.0 200 OK\nAllow: POST, OPTIONS, GET\nContent-Length: 319\nContent-Type: application/json\nDate: Tue, 10 Oct 2017 07:54:19 GMT\nServer: WSGIServer/0.1 Python/2.7.13\nVary: Accept, Cookie\nX-Frame-Options: SAMEORIGIN\n\n[\n    {\n        \"code\": \"foo = \\\"bar\\\"\\n\",\n        \"id\": 1,\n        \"language\": \"python\",\n        \"linenos\": false,\n        \"style\": \"friendly\",\n        \"title\": \"\"\n    },\n    {\n        \"code\": \"print \\\"hello, world\\n\\\"\",\n        \"id\": 2,\n        \"language\": \"python\",\n        \"linenos\": false,\n        \"style\": \"friendly\",\n        \"title\": \"\"\n    },\n    {\n        \"code\": \"print \\\"hello, world\\n\\\"\",\n        \"id\": 3,\n        \"language\": \"python\",\n        \"linenos\": false,\n        \"style\": \"friendly\",\n        \"title\": \"\"\n    }\n]\nPS E:\\Study\\Serializer_tutorial\\tutorial> http http://127.0.0.1:8000/snippets/ Accept:text/html\nHTTP/1.0 200 OK\nAllow: POST, OPTIONS, GET\nContent-Length: 7647\nContent-Type: text/html; charset=utf-8\nDate: Tue, 10 Oct 2017 07:54:50 GMT\nServer: WSGIServer/0.1 Python/2.7.13\nVary: Accept, Cookie\nX-Frame-Options: SAMEORIGIN\n\n<!DOCTYPE html>\n<html>\n  <head>\n\n\n\n        <meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\"/>\n        <meta name=\"robots\" content=\"NONE,NOARCHIVE\" />\n\n\n      <title>Snippet List – Django REST framework</title>\nPS E:\\Study\\Serializer_tutorial\\tutorial> http http://127.0.0.1:8000/snippets.json\nHTTP/1.0 200 OK\nAllow: POST, OPTIONS, GET\nContent-Length: 319\nContent-Type: application/json\nDate: Tue, 10 Oct 2017 07:55:25 GMT\nServer: WSGIServer/0.1 Python/2.7.13\nVary: Accept, Cookie\nX-Frame-Options: SAMEORIGIN\n\n[\n    {\n        \"code\": \"foo = \\\"bar\\\"\\n\",\n        \"id\": 1,\n        \"language\": \"python\",\n        \"linenos\": false,\n        \"style\": \"friendly\",\n        \"title\": \"\"\n    },\n    {\n        \"code\": \"print \\\"hello, world\\n\\\"\",\nPS E:\\Study\\Serializer_tutorial\\tutorial> http http://127.0.0.1:8000/snippets.api\nHTTP/1.0 200 OK\nAllow: POST, OPTIONS, GET\nContent-Length: 7668\nContent-Type: text/html; charset=utf-8\nDate: Tue, 10 Oct 2017 07:55:42 GMT\nServer: WSGIServer/0.1 Python/2.7.13\nVary: Accept, Cookie\nX-Frame-Options: SAMEORIGIN\n\n<!DOCTYPE html>\n<html>\n  <head>\n\n\n\n        <meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\"/>\n        <meta name=\"robots\" content=\"NONE,NOARCHIVE\" />\n\n\n      <title>Snippet List – Django REST framework</title>\n\n\n```\n\n同时，我们可以控制请求数据的格式，利用Content-type头。\n\n```shell\nPS E:\\Study\\Serializer_tutorial\\tutorial> http --form POST http://127.0.0.1:8000/snippets/ code=\"print 123\"\nHTTP/1.0 201 Created\nAllow: POST, OPTIONS, GET\nContent-Length: 93\nContent-Type: application/json\nDate: Tue, 10 Oct 2017 07:58:55 GMT\nServer: WSGIServer/0.1 Python/2.7.13\nVary: Accept, Cookie\nX-Frame-Options: SAMEORIGIN\n\n{\n    \"code\": \"print 123\",\n    \"id\": 4,\n    \"language\": \"python\",\n    \"linenos\": false,\n    \"style\": \"friendly\",\n    \"title\": \"\"\n}\n\nPS E:\\Study\\Serializer_tutorial\\tutorial> http --json POST http://127.0.0.1:8000/snippets/ code=\"print 456\"\nHTTP/1.0 201 Created\nAllow: POST, OPTIONS, GET\nContent-Length: 93\nContent-Type: application/json\nDate: Tue, 10 Oct 2017 07:59:24 GMT\nServer: WSGIServer/0.1 Python/2.7.13\nVary: Accept, Cookie\nX-Frame-Options: SAMEORIGIN\n\n{\n    \"code\": \"print 456\",\n    \"id\": 5,\n    \"language\": \"python\",\n    \"linenos\": false,\n    \"style\": \"friendly\",\n    \"title\": \"\"\n}\n```\n\n\n\n#### 可视化\n\n由于API可以根据客户端的请求选择合适的响应类型。因此当接收到来自浏览器的请求时，会默认以html的格式响应请求。这可以让api能够返回，用于网页浏览。可视化之后，用浏览器开发和使用api将变得十分方便。所以现在用浏览器查看是这个画风：\n\n![image](/blogimg/reqres.png)\n\n","source":"_posts/DjangoRESTframework-ReqAndRes.md","raw":"---\ntitle: DjangoRESTframework-请求与响应（Request Response）\ncategories:\n  - Program\ntags:\n  - djangorestframework\ndate: 2017-10-10 16:05:41\n---\n\n### DjangoRESTframework-------请求与响应（Request and Response）\n\n在这一章，我们将真正的开始接触REST framework的核心了。接下来介绍一下几个内建模块。\n\n#### Request对象\n\nREST framework提供了一个Request对象，它派生自HttpRequest，提供更多弹性的访问数据的序列化操作。它的核心是request.data属性，它类似于request.POST，在Web API中用处很大。\n\n<!--more-->\n\n```code\nrequest.POST #只能处理表单数据，只能在POST方法中起作用\nrequest.data #可以处理任意的数据，能够在POST,PUT,PATCH方法中起作用\n```\n\n#### Response对象\n\nREST framework提供了Response对象，他是一个TemplateResponse类型的对象，它能够提供未渲染的内容，使用合适的数据类型返回给客户端。\n\n```code\nreturn Response(data) #渲染数据给客户端\n```\n\n#### Status codes\n\n使用数字状态的HTTP响应码，用于不必要的数据读取。它的使用需要非常注意，如果你给出了一个错误的状态码。REST framework为每个状态提供了更明确的状态码，比如HTTP_400_BAD_REQUEST\n\n#### Wrapping API views\n\nREST framework提供了两种wrapper，你可以用来编写API views\n\n1.@api_view 装饰器，用于基于方法的视图\n\n2.APIVIEW类，用于基于类的视图\n\n这些装饰器提供了基本的方法能够确保你收到Request实例，为Reponse对象添加上下文。\n\n这些装饰器也提供一些行为控制，比如返回405 Method Not Allowed在合适的情况下，也能够处理任何ParseError异常，当request.data是非法输入时。\n\n#### 把以上的内容拼起来复习一下，Pulling it all together\n\n好了，现在我们可以使用这些新组件来编写view了。我们不需views.py中引入JSONResponse类，删掉它，继续coding。\n\n```python\nfrom rest_framework import status\nfrom rest_framework.decorators import api_view\nfrom rest_framework.response import Response\nfrom snippets.models import Snippet\nfrom snippets.serializers import SnippetSerializer\n\n@api_view(['GET', 'POST'])\ndef snippet_list(request):\n  if request.method == 'GET':\n    snippet = Snippet.objects.all()\n    serializer = SnippetSerializer(snippets, many=True)\n    return Reponse(serializer.data)\n  \n  elif request.method == 'POST':\n    serializer = SnippetSerializer(data=request.data)\n    if serializer.is_valid():\n      serializer.save()\n      return Response(serializer.data, status=status.HTTP_201_CREATED)\n    return Response(serializer.errors, status=status.HTTP_400_BAD_REQUEST)\n```\n\n现在的视图与之前相比，显得更加简洁了一些，看起来和Forms API看起来也非常相似。我们也使用了status codes，使我们返回的意义更加明确。下面是snippet的详细视图，对应的文件是views.py:\n\n```python\n@api_view(['GET', 'PUT', 'DELETE'])\ndef snippet_detail(request, pk):\n    \"\"\"\n    Retrieve, update or delete a code snippet.\n    \"\"\"\n    try:\n        snippet = Snippet.objects.get(pk=pk)\n    except Snippet.DoesNotExist:\n        return Response(status=status.HTTP_404_NOT_FOUND)\n\n    if request.method == 'GET':\n        serializer = SnippetSerializer(snippet)\n        return Response(serializer.data)\n\n    elif request.method == 'PUT':\n        serializer = SnippetSerializer(snippet, data=request.data)\n        if serializer.is_valid():\n            serializer.save()\n            return Response(serializer.data)\n        return Response(serializer.errors, status=status.HTTP_400_BAD_REQUEST)\n\n    elif request.method == 'DELETE':\n        snippet.delete()\n        return Response(status=status.HTTP_204_NO_CONTENT)\n```\n\n这看起来就更加熟悉了，和一般的Django视图区别不大。\n\n注意：我们不再明确的指定request和response中的内容类型，request.data能够帮我们处理传入的json格式的请求数据，但是它也能给处理其他类型的格式。类似地，我们能返回响应对象数据，允许REST framework用合适的数据类型渲染响应。\n\n#### 给我们的URLs添加可选的格式前缀\n\n利用这一优点，我们的响应内容不再硬生生的绑定单一的内容格式，而可以支持格式前缀，定义我们需要返回的格式。比如http://example.com/api/items/4.sjon.\n\n要达到这个目的的话，需要给添加一个format参数，就像这样：\n\n```python\ndef snippet_list(request, format=None)\n```\n\n```python\ndef snippet_detail(request, pk, format=None)\n```\n\n现在需要更新urls.py,追加format_suffix_patterns\n\n```python\nfrom django.conf.urls import url\nfrom rest_framework.urlpatterns import format_suffix_patterns\nfrom snippets import views\n\n\nurlpatterns = [\n    url(r'^snippets/$', views.snippet_list),\n    url(r'^snippets/(?P<pk>[0-9]+)$', views.snippet_detail),\n]\n\nurlpatterns = fromat_suffix_patterns(urlpatterns)\n```\n\n\n\n我们就不再需要添加其他额外的url策略，就能够给我们一个清晰，简洁的支持指定需要的响应格式。\n\n#### 应用跑起来是怎样的呢？\n\n我们可以和之前一样列出所有的snippets\n\n```shell\nPS E:\\Study\\Serializer_tutorial\\tutorial> http http://127.0.0.1:8000/snippets/\nHTTP/1.0 200 OK\nAllow: POST, OPTIONS, GET\nContent-Length: 319\nContent-Type: application/json\nDate: Tue, 10 Oct 2017 07:52:59 GMT\nServer: WSGIServer/0.1 Python/2.7.13\nVary: Accept, Cookie\nX-Frame-Options: SAMEORIGIN\n\n[\n    {\n        \"code\": \"foo = \\\"bar\\\"\\n\",\n        \"id\": 1,\n        \"language\": \"python\",\n        \"linenos\": false,\n        \"style\": \"friendly\",\n        \"title\": \"\"\n    },\n    {\n        \"code\": \"print \\\"hello, world\\n\\\"\",\n        \"id\": 2,\n        \"language\": \"python\",\n        \"linenos\": false,\n        \"style\": \"friendly\",\n        \"title\": \"\"\n    },\n    {\n        \"code\": \"print \\\"hello, world\\n\\\"\",\n        \"id\": 3,\n        \"language\": \"python\",\n        \"linenos\": false,\n        \"style\": \"friendly\",\n        \"title\": \"\"\n    }\n]\n```\n\n我们也可以控制返回的格式，利用HTTP头或者格式前缀。\n\n```bash\n\nPS E:\\Study\\Serializer_tutorial\\tutorial> http http://127.0.0.1:8000/snippets/ Accept:application/json\nHTTP/1.0 200 OK\nAllow: POST, OPTIONS, GET\nContent-Length: 319\nContent-Type: application/json\nDate: Tue, 10 Oct 2017 07:54:19 GMT\nServer: WSGIServer/0.1 Python/2.7.13\nVary: Accept, Cookie\nX-Frame-Options: SAMEORIGIN\n\n[\n    {\n        \"code\": \"foo = \\\"bar\\\"\\n\",\n        \"id\": 1,\n        \"language\": \"python\",\n        \"linenos\": false,\n        \"style\": \"friendly\",\n        \"title\": \"\"\n    },\n    {\n        \"code\": \"print \\\"hello, world\\n\\\"\",\n        \"id\": 2,\n        \"language\": \"python\",\n        \"linenos\": false,\n        \"style\": \"friendly\",\n        \"title\": \"\"\n    },\n    {\n        \"code\": \"print \\\"hello, world\\n\\\"\",\n        \"id\": 3,\n        \"language\": \"python\",\n        \"linenos\": false,\n        \"style\": \"friendly\",\n        \"title\": \"\"\n    }\n]\nPS E:\\Study\\Serializer_tutorial\\tutorial> http http://127.0.0.1:8000/snippets/ Accept:text/html\nHTTP/1.0 200 OK\nAllow: POST, OPTIONS, GET\nContent-Length: 7647\nContent-Type: text/html; charset=utf-8\nDate: Tue, 10 Oct 2017 07:54:50 GMT\nServer: WSGIServer/0.1 Python/2.7.13\nVary: Accept, Cookie\nX-Frame-Options: SAMEORIGIN\n\n<!DOCTYPE html>\n<html>\n  <head>\n\n\n\n        <meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\"/>\n        <meta name=\"robots\" content=\"NONE,NOARCHIVE\" />\n\n\n      <title>Snippet List – Django REST framework</title>\nPS E:\\Study\\Serializer_tutorial\\tutorial> http http://127.0.0.1:8000/snippets.json\nHTTP/1.0 200 OK\nAllow: POST, OPTIONS, GET\nContent-Length: 319\nContent-Type: application/json\nDate: Tue, 10 Oct 2017 07:55:25 GMT\nServer: WSGIServer/0.1 Python/2.7.13\nVary: Accept, Cookie\nX-Frame-Options: SAMEORIGIN\n\n[\n    {\n        \"code\": \"foo = \\\"bar\\\"\\n\",\n        \"id\": 1,\n        \"language\": \"python\",\n        \"linenos\": false,\n        \"style\": \"friendly\",\n        \"title\": \"\"\n    },\n    {\n        \"code\": \"print \\\"hello, world\\n\\\"\",\nPS E:\\Study\\Serializer_tutorial\\tutorial> http http://127.0.0.1:8000/snippets.api\nHTTP/1.0 200 OK\nAllow: POST, OPTIONS, GET\nContent-Length: 7668\nContent-Type: text/html; charset=utf-8\nDate: Tue, 10 Oct 2017 07:55:42 GMT\nServer: WSGIServer/0.1 Python/2.7.13\nVary: Accept, Cookie\nX-Frame-Options: SAMEORIGIN\n\n<!DOCTYPE html>\n<html>\n  <head>\n\n\n\n        <meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\"/>\n        <meta name=\"robots\" content=\"NONE,NOARCHIVE\" />\n\n\n      <title>Snippet List – Django REST framework</title>\n\n\n```\n\n同时，我们可以控制请求数据的格式，利用Content-type头。\n\n```shell\nPS E:\\Study\\Serializer_tutorial\\tutorial> http --form POST http://127.0.0.1:8000/snippets/ code=\"print 123\"\nHTTP/1.0 201 Created\nAllow: POST, OPTIONS, GET\nContent-Length: 93\nContent-Type: application/json\nDate: Tue, 10 Oct 2017 07:58:55 GMT\nServer: WSGIServer/0.1 Python/2.7.13\nVary: Accept, Cookie\nX-Frame-Options: SAMEORIGIN\n\n{\n    \"code\": \"print 123\",\n    \"id\": 4,\n    \"language\": \"python\",\n    \"linenos\": false,\n    \"style\": \"friendly\",\n    \"title\": \"\"\n}\n\nPS E:\\Study\\Serializer_tutorial\\tutorial> http --json POST http://127.0.0.1:8000/snippets/ code=\"print 456\"\nHTTP/1.0 201 Created\nAllow: POST, OPTIONS, GET\nContent-Length: 93\nContent-Type: application/json\nDate: Tue, 10 Oct 2017 07:59:24 GMT\nServer: WSGIServer/0.1 Python/2.7.13\nVary: Accept, Cookie\nX-Frame-Options: SAMEORIGIN\n\n{\n    \"code\": \"print 456\",\n    \"id\": 5,\n    \"language\": \"python\",\n    \"linenos\": false,\n    \"style\": \"friendly\",\n    \"title\": \"\"\n}\n```\n\n\n\n#### 可视化\n\n由于API可以根据客户端的请求选择合适的响应类型。因此当接收到来自浏览器的请求时，会默认以html的格式响应请求。这可以让api能够返回，用于网页浏览。可视化之后，用浏览器开发和使用api将变得十分方便。所以现在用浏览器查看是这个画风：\n\n![image](/blogimg/reqres.png)\n\n","slug":"DjangoRESTframework-ReqAndRes","published":1,"updated":"2017-12-04T07:27:28.754Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjeqig1ky0019lgqaom3fl4hu","content":"<h3 id=\"DjangoRESTframework——-请求与响应（Request-and-Response）\"><a href=\"#DjangoRESTframework——-请求与响应（Request-and-Response）\" class=\"headerlink\" title=\"DjangoRESTframework——-请求与响应（Request and Response）\"></a>DjangoRESTframework——-请求与响应（Request and Response）</h3><p>在这一章，我们将真正的开始接触REST framework的核心了。接下来介绍一下几个内建模块。</p>\n<h4 id=\"Request对象\"><a href=\"#Request对象\" class=\"headerlink\" title=\"Request对象\"></a>Request对象</h4><p>REST framework提供了一个Request对象，它派生自HttpRequest，提供更多弹性的访问数据的序列化操作。它的核心是request.data属性，它类似于request.POST，在Web API中用处很大。</p>\n<a id=\"more\"></a>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">request.POST #只能处理表单数据，只能在POST方法中起作用</span><br><span class=\"line\">request.data #可以处理任意的数据，能够在POST,PUT,PATCH方法中起作用</span><br></pre></td></tr></table></figure>\n<h4 id=\"Response对象\"><a href=\"#Response对象\" class=\"headerlink\" title=\"Response对象\"></a>Response对象</h4><p>REST framework提供了Response对象，他是一个TemplateResponse类型的对象，它能够提供未渲染的内容，使用合适的数据类型返回给客户端。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">return Response(data) #渲染数据给客户端</span><br></pre></td></tr></table></figure>\n<h4 id=\"Status-codes\"><a href=\"#Status-codes\" class=\"headerlink\" title=\"Status codes\"></a>Status codes</h4><p>使用数字状态的HTTP响应码，用于不必要的数据读取。它的使用需要非常注意，如果你给出了一个错误的状态码。REST framework为每个状态提供了更明确的状态码，比如HTTP_400_BAD_REQUEST</p>\n<h4 id=\"Wrapping-API-views\"><a href=\"#Wrapping-API-views\" class=\"headerlink\" title=\"Wrapping API views\"></a>Wrapping API views</h4><p>REST framework提供了两种wrapper，你可以用来编写API views</p>\n<p>1.@api_view 装饰器，用于基于方法的视图</p>\n<p>2.APIVIEW类，用于基于类的视图</p>\n<p>这些装饰器提供了基本的方法能够确保你收到Request实例，为Reponse对象添加上下文。</p>\n<p>这些装饰器也提供一些行为控制，比如返回405 Method Not Allowed在合适的情况下，也能够处理任何ParseError异常，当request.data是非法输入时。</p>\n<h4 id=\"把以上的内容拼起来复习一下，Pulling-it-all-together\"><a href=\"#把以上的内容拼起来复习一下，Pulling-it-all-together\" class=\"headerlink\" title=\"把以上的内容拼起来复习一下，Pulling it all together\"></a>把以上的内容拼起来复习一下，Pulling it all together</h4><p>好了，现在我们可以使用这些新组件来编写view了。我们不需views.py中引入JSONResponse类，删掉它，继续coding。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> rest_framework <span class=\"keyword\">import</span> status</span><br><span class=\"line\"><span class=\"keyword\">from</span> rest_framework.decorators <span class=\"keyword\">import</span> api_view</span><br><span class=\"line\"><span class=\"keyword\">from</span> rest_framework.response <span class=\"keyword\">import</span> Response</span><br><span class=\"line\"><span class=\"keyword\">from</span> snippets.models <span class=\"keyword\">import</span> Snippet</span><br><span class=\"line\"><span class=\"keyword\">from</span> snippets.serializers <span class=\"keyword\">import</span> SnippetSerializer</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@api_view(['GET', 'POST'])</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">snippet_list</span><span class=\"params\">(request)</span>:</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> request.method == <span class=\"string\">'GET'</span>:</span><br><span class=\"line\">    snippet = Snippet.objects.all()</span><br><span class=\"line\">    serializer = SnippetSerializer(snippets, many=<span class=\"keyword\">True</span>)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> Reponse(serializer.data)</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"keyword\">elif</span> request.method == <span class=\"string\">'POST'</span>:</span><br><span class=\"line\">    serializer = SnippetSerializer(data=request.data)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> serializer.is_valid():</span><br><span class=\"line\">      serializer.save()</span><br><span class=\"line\">      <span class=\"keyword\">return</span> Response(serializer.data, status=status.HTTP_201_CREATED)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> Response(serializer.errors, status=status.HTTP_400_BAD_REQUEST)</span><br></pre></td></tr></table></figure>\n<p>现在的视图与之前相比，显得更加简洁了一些，看起来和Forms API看起来也非常相似。我们也使用了status codes，使我们返回的意义更加明确。下面是snippet的详细视图，对应的文件是views.py:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@api_view(['GET', 'PUT', 'DELETE'])</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">snippet_detail</span><span class=\"params\">(request, pk)</span>:</span></span><br><span class=\"line\">    <span class=\"string\">\"\"\"</span></span><br><span class=\"line\"><span class=\"string\">    Retrieve, update or delete a code snippet.</span></span><br><span class=\"line\"><span class=\"string\">    \"\"\"</span></span><br><span class=\"line\">    <span class=\"keyword\">try</span>:</span><br><span class=\"line\">        snippet = Snippet.objects.get(pk=pk)</span><br><span class=\"line\">    <span class=\"keyword\">except</span> Snippet.DoesNotExist:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> Response(status=status.HTTP_404_NOT_FOUND)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> request.method == <span class=\"string\">'GET'</span>:</span><br><span class=\"line\">        serializer = SnippetSerializer(snippet)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> Response(serializer.data)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">elif</span> request.method == <span class=\"string\">'PUT'</span>:</span><br><span class=\"line\">        serializer = SnippetSerializer(snippet, data=request.data)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> serializer.is_valid():</span><br><span class=\"line\">            serializer.save()</span><br><span class=\"line\">            <span class=\"keyword\">return</span> Response(serializer.data)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> Response(serializer.errors, status=status.HTTP_400_BAD_REQUEST)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">elif</span> request.method == <span class=\"string\">'DELETE'</span>:</span><br><span class=\"line\">        snippet.delete()</span><br><span class=\"line\">        <span class=\"keyword\">return</span> Response(status=status.HTTP_204_NO_CONTENT)</span><br></pre></td></tr></table></figure>\n<p>这看起来就更加熟悉了，和一般的Django视图区别不大。</p>\n<p>注意：我们不再明确的指定request和response中的内容类型，request.data能够帮我们处理传入的json格式的请求数据，但是它也能给处理其他类型的格式。类似地，我们能返回响应对象数据，允许REST framework用合适的数据类型渲染响应。</p>\n<h4 id=\"给我们的URLs添加可选的格式前缀\"><a href=\"#给我们的URLs添加可选的格式前缀\" class=\"headerlink\" title=\"给我们的URLs添加可选的格式前缀\"></a>给我们的URLs添加可选的格式前缀</h4><p>利用这一优点，我们的响应内容不再硬生生的绑定单一的内容格式，而可以支持格式前缀，定义我们需要返回的格式。比如<a href=\"http://example.com/api/items/4.sjon\" target=\"_blank\" rel=\"noopener\">http://example.com/api/items/4.sjon</a>.</p>\n<p>要达到这个目的的话，需要给添加一个format参数，就像这样：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">snippet_list</span><span class=\"params\">(request, format=None)</span></span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">snippet_detail</span><span class=\"params\">(request, pk, format=None)</span></span></span><br></pre></td></tr></table></figure>\n<p>现在需要更新urls.py,追加format_suffix_patterns</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> django.conf.urls <span class=\"keyword\">import</span> url</span><br><span class=\"line\"><span class=\"keyword\">from</span> rest_framework.urlpatterns <span class=\"keyword\">import</span> format_suffix_patterns</span><br><span class=\"line\"><span class=\"keyword\">from</span> snippets <span class=\"keyword\">import</span> views</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">urlpatterns = [</span><br><span class=\"line\">    url(<span class=\"string\">r'^snippets/$'</span>, views.snippet_list),</span><br><span class=\"line\">    url(<span class=\"string\">r'^snippets/(?P&lt;pk&gt;[0-9]+)$'</span>, views.snippet_detail),</span><br><span class=\"line\">]</span><br><span class=\"line\"></span><br><span class=\"line\">urlpatterns = fromat_suffix_patterns(urlpatterns)</span><br></pre></td></tr></table></figure>\n<p>我们就不再需要添加其他额外的url策略，就能够给我们一个清晰，简洁的支持指定需要的响应格式。</p>\n<h4 id=\"应用跑起来是怎样的呢？\"><a href=\"#应用跑起来是怎样的呢？\" class=\"headerlink\" title=\"应用跑起来是怎样的呢？\"></a>应用跑起来是怎样的呢？</h4><p>我们可以和之前一样列出所有的snippets</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PS E:\\Study\\Serializer_tutorial\\tutorial&gt; http http://127.0.0.1:8000/snippets/</span><br><span class=\"line\">HTTP/1.0 200 OK</span><br><span class=\"line\">Allow: POST, OPTIONS, GET</span><br><span class=\"line\">Content-Length: 319</span><br><span class=\"line\">Content-Type: application/json</span><br><span class=\"line\">Date: Tue, 10 Oct 2017 07:52:59 GMT</span><br><span class=\"line\">Server: WSGIServer/0.1 Python/2.7.13</span><br><span class=\"line\">Vary: Accept, Cookie</span><br><span class=\"line\">X-Frame-Options: SAMEORIGIN</span><br><span class=\"line\"></span><br><span class=\"line\">[</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        \"code\": \"foo = \\\"bar\\\"\\n\",</span><br><span class=\"line\">        \"id\": 1,</span><br><span class=\"line\">        \"language\": \"python\",</span><br><span class=\"line\">        \"linenos\": false,</span><br><span class=\"line\">        \"style\": \"friendly\",</span><br><span class=\"line\">        \"title\": \"\"</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        \"code\": \"print \\\"hello, world\\n\\\"\",</span><br><span class=\"line\">        \"id\": 2,</span><br><span class=\"line\">        \"language\": \"python\",</span><br><span class=\"line\">        \"linenos\": false,</span><br><span class=\"line\">        \"style\": \"friendly\",</span><br><span class=\"line\">        \"title\": \"\"</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        \"code\": \"print \\\"hello, world\\n\\\"\",</span><br><span class=\"line\">        \"id\": 3,</span><br><span class=\"line\">        \"language\": \"python\",</span><br><span class=\"line\">        \"linenos\": false,</span><br><span class=\"line\">        \"style\": \"friendly\",</span><br><span class=\"line\">        \"title\": \"\"</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n<p>我们也可以控制返回的格式，利用HTTP头或者格式前缀。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">PS E:\\Study\\Serializer_tutorial\\tutorial&gt; http http://127.0.0.1:8000/snippets/ Accept:application/json</span><br><span class=\"line\">HTTP/1.0 200 OK</span><br><span class=\"line\">Allow: POST, OPTIONS, GET</span><br><span class=\"line\">Content-Length: 319</span><br><span class=\"line\">Content-Type: application/json</span><br><span class=\"line\">Date: Tue, 10 Oct 2017 07:54:19 GMT</span><br><span class=\"line\">Server: WSGIServer/0.1 Python/2.7.13</span><br><span class=\"line\">Vary: Accept, Cookie</span><br><span class=\"line\">X-Frame-Options: SAMEORIGIN</span><br><span class=\"line\"></span><br><span class=\"line\">[</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"string\">\"code\"</span>: <span class=\"string\">\"foo = \\\"bar\\\"\\n\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"id\"</span>: 1,</span><br><span class=\"line\">        <span class=\"string\">\"language\"</span>: <span class=\"string\">\"python\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"linenos\"</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">        <span class=\"string\">\"style\"</span>: <span class=\"string\">\"friendly\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"title\"</span>: <span class=\"string\">\"\"</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"string\">\"code\"</span>: <span class=\"string\">\"print \\\"hello, world\\n\\\"\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"id\"</span>: 2,</span><br><span class=\"line\">        <span class=\"string\">\"language\"</span>: <span class=\"string\">\"python\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"linenos\"</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">        <span class=\"string\">\"style\"</span>: <span class=\"string\">\"friendly\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"title\"</span>: <span class=\"string\">\"\"</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"string\">\"code\"</span>: <span class=\"string\">\"print \\\"hello, world\\n\\\"\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"id\"</span>: 3,</span><br><span class=\"line\">        <span class=\"string\">\"language\"</span>: <span class=\"string\">\"python\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"linenos\"</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">        <span class=\"string\">\"style\"</span>: <span class=\"string\">\"friendly\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"title\"</span>: <span class=\"string\">\"\"</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">]</span><br><span class=\"line\">PS E:\\Study\\Serializer_tutorial\\tutorial&gt; http http://127.0.0.1:8000/snippets/ Accept:text/html</span><br><span class=\"line\">HTTP/1.0 200 OK</span><br><span class=\"line\">Allow: POST, OPTIONS, GET</span><br><span class=\"line\">Content-Length: 7647</span><br><span class=\"line\">Content-Type: text/html; charset=utf-8</span><br><span class=\"line\">Date: Tue, 10 Oct 2017 07:54:50 GMT</span><br><span class=\"line\">Server: WSGIServer/0.1 Python/2.7.13</span><br><span class=\"line\">Vary: Accept, Cookie</span><br><span class=\"line\">X-Frame-Options: SAMEORIGIN</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;!DOCTYPE html&gt;</span><br><span class=\"line\">&lt;html&gt;</span><br><span class=\"line\">  &lt;head&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        &lt;meta http-equiv=<span class=\"string\">\"Content-Type\"</span> content=<span class=\"string\">\"text/html; charset=utf-8\"</span>/&gt;</span><br><span class=\"line\">        &lt;meta name=<span class=\"string\">\"robots\"</span> content=<span class=\"string\">\"NONE,NOARCHIVE\"</span> /&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">      &lt;title&gt;Snippet List – Django REST framework&lt;/title&gt;</span><br><span class=\"line\">PS E:\\Study\\Serializer_tutorial\\tutorial&gt; http http://127.0.0.1:8000/snippets.json</span><br><span class=\"line\">HTTP/1.0 200 OK</span><br><span class=\"line\">Allow: POST, OPTIONS, GET</span><br><span class=\"line\">Content-Length: 319</span><br><span class=\"line\">Content-Type: application/json</span><br><span class=\"line\">Date: Tue, 10 Oct 2017 07:55:25 GMT</span><br><span class=\"line\">Server: WSGIServer/0.1 Python/2.7.13</span><br><span class=\"line\">Vary: Accept, Cookie</span><br><span class=\"line\">X-Frame-Options: SAMEORIGIN</span><br><span class=\"line\"></span><br><span class=\"line\">[</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"string\">\"code\"</span>: <span class=\"string\">\"foo = \\\"bar\\\"\\n\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"id\"</span>: 1,</span><br><span class=\"line\">        <span class=\"string\">\"language\"</span>: <span class=\"string\">\"python\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"linenos\"</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">        <span class=\"string\">\"style\"</span>: <span class=\"string\">\"friendly\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"title\"</span>: <span class=\"string\">\"\"</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"string\">\"code\"</span>: <span class=\"string\">\"print \\\"hello, world\\n\\\"\"</span>,</span><br><span class=\"line\">PS E:\\Study\\Serializer_tutorial\\tutorial&gt; http http://127.0.0.1:8000/snippets.api</span><br><span class=\"line\">HTTP/1.0 200 OK</span><br><span class=\"line\">Allow: POST, OPTIONS, GET</span><br><span class=\"line\">Content-Length: 7668</span><br><span class=\"line\">Content-Type: text/html; charset=utf-8</span><br><span class=\"line\">Date: Tue, 10 Oct 2017 07:55:42 GMT</span><br><span class=\"line\">Server: WSGIServer/0.1 Python/2.7.13</span><br><span class=\"line\">Vary: Accept, Cookie</span><br><span class=\"line\">X-Frame-Options: SAMEORIGIN</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;!DOCTYPE html&gt;</span><br><span class=\"line\">&lt;html&gt;</span><br><span class=\"line\">  &lt;head&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        &lt;meta http-equiv=<span class=\"string\">\"Content-Type\"</span> content=<span class=\"string\">\"text/html; charset=utf-8\"</span>/&gt;</span><br><span class=\"line\">        &lt;meta name=<span class=\"string\">\"robots\"</span> content=<span class=\"string\">\"NONE,NOARCHIVE\"</span> /&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">      &lt;title&gt;Snippet List – Django REST framework&lt;/title&gt;</span><br></pre></td></tr></table></figure>\n<p>同时，我们可以控制请求数据的格式，利用Content-type头。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PS E:\\Study\\Serializer_tutorial\\tutorial&gt; http --form POST http://127.0.0.1:8000/snippets/ code=\"print 123\"</span><br><span class=\"line\">HTTP/1.0 201 Created</span><br><span class=\"line\">Allow: POST, OPTIONS, GET</span><br><span class=\"line\">Content-Length: 93</span><br><span class=\"line\">Content-Type: application/json</span><br><span class=\"line\">Date: Tue, 10 Oct 2017 07:58:55 GMT</span><br><span class=\"line\">Server: WSGIServer/0.1 Python/2.7.13</span><br><span class=\"line\">Vary: Accept, Cookie</span><br><span class=\"line\">X-Frame-Options: SAMEORIGIN</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    \"code\": \"print 123\",</span><br><span class=\"line\">    \"id\": 4,</span><br><span class=\"line\">    \"language\": \"python\",</span><br><span class=\"line\">    \"linenos\": false,</span><br><span class=\"line\">    \"style\": \"friendly\",</span><br><span class=\"line\">    \"title\": \"\"</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">PS E:\\Study\\Serializer_tutorial\\tutorial&gt; http --json POST http://127.0.0.1:8000/snippets/ code=\"print 456\"</span><br><span class=\"line\">HTTP/1.0 201 Created</span><br><span class=\"line\">Allow: POST, OPTIONS, GET</span><br><span class=\"line\">Content-Length: 93</span><br><span class=\"line\">Content-Type: application/json</span><br><span class=\"line\">Date: Tue, 10 Oct 2017 07:59:24 GMT</span><br><span class=\"line\">Server: WSGIServer/0.1 Python/2.7.13</span><br><span class=\"line\">Vary: Accept, Cookie</span><br><span class=\"line\">X-Frame-Options: SAMEORIGIN</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    \"code\": \"print 456\",</span><br><span class=\"line\">    \"id\": 5,</span><br><span class=\"line\">    \"language\": \"python\",</span><br><span class=\"line\">    \"linenos\": false,</span><br><span class=\"line\">    \"style\": \"friendly\",</span><br><span class=\"line\">    \"title\": \"\"</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"可视化\"><a href=\"#可视化\" class=\"headerlink\" title=\"可视化\"></a>可视化</h4><p>由于API可以根据客户端的请求选择合适的响应类型。因此当接收到来自浏览器的请求时，会默认以html的格式响应请求。这可以让api能够返回，用于网页浏览。可视化之后，用浏览器开发和使用api将变得十分方便。所以现在用浏览器查看是这个画风：</p>\n<p><img src=\"/blogimg/reqres.png\" alt=\"image\"></p>\n","site":{"data":{}},"excerpt":"<h3 id=\"DjangoRESTframework——-请求与响应（Request-and-Response）\"><a href=\"#DjangoRESTframework——-请求与响应（Request-and-Response）\" class=\"headerlink\" title=\"DjangoRESTframework——-请求与响应（Request and Response）\"></a>DjangoRESTframework——-请求与响应（Request and Response）</h3><p>在这一章，我们将真正的开始接触REST framework的核心了。接下来介绍一下几个内建模块。</p>\n<h4 id=\"Request对象\"><a href=\"#Request对象\" class=\"headerlink\" title=\"Request对象\"></a>Request对象</h4><p>REST framework提供了一个Request对象，它派生自HttpRequest，提供更多弹性的访问数据的序列化操作。它的核心是request.data属性，它类似于request.POST，在Web API中用处很大。</p>","more":"<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">request.POST #只能处理表单数据，只能在POST方法中起作用</span><br><span class=\"line\">request.data #可以处理任意的数据，能够在POST,PUT,PATCH方法中起作用</span><br></pre></td></tr></table></figure>\n<h4 id=\"Response对象\"><a href=\"#Response对象\" class=\"headerlink\" title=\"Response对象\"></a>Response对象</h4><p>REST framework提供了Response对象，他是一个TemplateResponse类型的对象，它能够提供未渲染的内容，使用合适的数据类型返回给客户端。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">return Response(data) #渲染数据给客户端</span><br></pre></td></tr></table></figure>\n<h4 id=\"Status-codes\"><a href=\"#Status-codes\" class=\"headerlink\" title=\"Status codes\"></a>Status codes</h4><p>使用数字状态的HTTP响应码，用于不必要的数据读取。它的使用需要非常注意，如果你给出了一个错误的状态码。REST framework为每个状态提供了更明确的状态码，比如HTTP_400_BAD_REQUEST</p>\n<h4 id=\"Wrapping-API-views\"><a href=\"#Wrapping-API-views\" class=\"headerlink\" title=\"Wrapping API views\"></a>Wrapping API views</h4><p>REST framework提供了两种wrapper，你可以用来编写API views</p>\n<p>1.@api_view 装饰器，用于基于方法的视图</p>\n<p>2.APIVIEW类，用于基于类的视图</p>\n<p>这些装饰器提供了基本的方法能够确保你收到Request实例，为Reponse对象添加上下文。</p>\n<p>这些装饰器也提供一些行为控制，比如返回405 Method Not Allowed在合适的情况下，也能够处理任何ParseError异常，当request.data是非法输入时。</p>\n<h4 id=\"把以上的内容拼起来复习一下，Pulling-it-all-together\"><a href=\"#把以上的内容拼起来复习一下，Pulling-it-all-together\" class=\"headerlink\" title=\"把以上的内容拼起来复习一下，Pulling it all together\"></a>把以上的内容拼起来复习一下，Pulling it all together</h4><p>好了，现在我们可以使用这些新组件来编写view了。我们不需views.py中引入JSONResponse类，删掉它，继续coding。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> rest_framework <span class=\"keyword\">import</span> status</span><br><span class=\"line\"><span class=\"keyword\">from</span> rest_framework.decorators <span class=\"keyword\">import</span> api_view</span><br><span class=\"line\"><span class=\"keyword\">from</span> rest_framework.response <span class=\"keyword\">import</span> Response</span><br><span class=\"line\"><span class=\"keyword\">from</span> snippets.models <span class=\"keyword\">import</span> Snippet</span><br><span class=\"line\"><span class=\"keyword\">from</span> snippets.serializers <span class=\"keyword\">import</span> SnippetSerializer</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@api_view(['GET', 'POST'])</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">snippet_list</span><span class=\"params\">(request)</span>:</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> request.method == <span class=\"string\">'GET'</span>:</span><br><span class=\"line\">    snippet = Snippet.objects.all()</span><br><span class=\"line\">    serializer = SnippetSerializer(snippets, many=<span class=\"keyword\">True</span>)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> Reponse(serializer.data)</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"keyword\">elif</span> request.method == <span class=\"string\">'POST'</span>:</span><br><span class=\"line\">    serializer = SnippetSerializer(data=request.data)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> serializer.is_valid():</span><br><span class=\"line\">      serializer.save()</span><br><span class=\"line\">      <span class=\"keyword\">return</span> Response(serializer.data, status=status.HTTP_201_CREATED)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> Response(serializer.errors, status=status.HTTP_400_BAD_REQUEST)</span><br></pre></td></tr></table></figure>\n<p>现在的视图与之前相比，显得更加简洁了一些，看起来和Forms API看起来也非常相似。我们也使用了status codes，使我们返回的意义更加明确。下面是snippet的详细视图，对应的文件是views.py:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@api_view(['GET', 'PUT', 'DELETE'])</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">snippet_detail</span><span class=\"params\">(request, pk)</span>:</span></span><br><span class=\"line\">    <span class=\"string\">\"\"\"</span></span><br><span class=\"line\"><span class=\"string\">    Retrieve, update or delete a code snippet.</span></span><br><span class=\"line\"><span class=\"string\">    \"\"\"</span></span><br><span class=\"line\">    <span class=\"keyword\">try</span>:</span><br><span class=\"line\">        snippet = Snippet.objects.get(pk=pk)</span><br><span class=\"line\">    <span class=\"keyword\">except</span> Snippet.DoesNotExist:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> Response(status=status.HTTP_404_NOT_FOUND)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> request.method == <span class=\"string\">'GET'</span>:</span><br><span class=\"line\">        serializer = SnippetSerializer(snippet)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> Response(serializer.data)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">elif</span> request.method == <span class=\"string\">'PUT'</span>:</span><br><span class=\"line\">        serializer = SnippetSerializer(snippet, data=request.data)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> serializer.is_valid():</span><br><span class=\"line\">            serializer.save()</span><br><span class=\"line\">            <span class=\"keyword\">return</span> Response(serializer.data)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> Response(serializer.errors, status=status.HTTP_400_BAD_REQUEST)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">elif</span> request.method == <span class=\"string\">'DELETE'</span>:</span><br><span class=\"line\">        snippet.delete()</span><br><span class=\"line\">        <span class=\"keyword\">return</span> Response(status=status.HTTP_204_NO_CONTENT)</span><br></pre></td></tr></table></figure>\n<p>这看起来就更加熟悉了，和一般的Django视图区别不大。</p>\n<p>注意：我们不再明确的指定request和response中的内容类型，request.data能够帮我们处理传入的json格式的请求数据，但是它也能给处理其他类型的格式。类似地，我们能返回响应对象数据，允许REST framework用合适的数据类型渲染响应。</p>\n<h4 id=\"给我们的URLs添加可选的格式前缀\"><a href=\"#给我们的URLs添加可选的格式前缀\" class=\"headerlink\" title=\"给我们的URLs添加可选的格式前缀\"></a>给我们的URLs添加可选的格式前缀</h4><p>利用这一优点，我们的响应内容不再硬生生的绑定单一的内容格式，而可以支持格式前缀，定义我们需要返回的格式。比如<a href=\"http://example.com/api/items/4.sjon\" target=\"_blank\" rel=\"noopener\">http://example.com/api/items/4.sjon</a>.</p>\n<p>要达到这个目的的话，需要给添加一个format参数，就像这样：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">snippet_list</span><span class=\"params\">(request, format=None)</span></span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">snippet_detail</span><span class=\"params\">(request, pk, format=None)</span></span></span><br></pre></td></tr></table></figure>\n<p>现在需要更新urls.py,追加format_suffix_patterns</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> django.conf.urls <span class=\"keyword\">import</span> url</span><br><span class=\"line\"><span class=\"keyword\">from</span> rest_framework.urlpatterns <span class=\"keyword\">import</span> format_suffix_patterns</span><br><span class=\"line\"><span class=\"keyword\">from</span> snippets <span class=\"keyword\">import</span> views</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">urlpatterns = [</span><br><span class=\"line\">    url(<span class=\"string\">r'^snippets/$'</span>, views.snippet_list),</span><br><span class=\"line\">    url(<span class=\"string\">r'^snippets/(?P&lt;pk&gt;[0-9]+)$'</span>, views.snippet_detail),</span><br><span class=\"line\">]</span><br><span class=\"line\"></span><br><span class=\"line\">urlpatterns = fromat_suffix_patterns(urlpatterns)</span><br></pre></td></tr></table></figure>\n<p>我们就不再需要添加其他额外的url策略，就能够给我们一个清晰，简洁的支持指定需要的响应格式。</p>\n<h4 id=\"应用跑起来是怎样的呢？\"><a href=\"#应用跑起来是怎样的呢？\" class=\"headerlink\" title=\"应用跑起来是怎样的呢？\"></a>应用跑起来是怎样的呢？</h4><p>我们可以和之前一样列出所有的snippets</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PS E:\\Study\\Serializer_tutorial\\tutorial&gt; http http://127.0.0.1:8000/snippets/</span><br><span class=\"line\">HTTP/1.0 200 OK</span><br><span class=\"line\">Allow: POST, OPTIONS, GET</span><br><span class=\"line\">Content-Length: 319</span><br><span class=\"line\">Content-Type: application/json</span><br><span class=\"line\">Date: Tue, 10 Oct 2017 07:52:59 GMT</span><br><span class=\"line\">Server: WSGIServer/0.1 Python/2.7.13</span><br><span class=\"line\">Vary: Accept, Cookie</span><br><span class=\"line\">X-Frame-Options: SAMEORIGIN</span><br><span class=\"line\"></span><br><span class=\"line\">[</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        \"code\": \"foo = \\\"bar\\\"\\n\",</span><br><span class=\"line\">        \"id\": 1,</span><br><span class=\"line\">        \"language\": \"python\",</span><br><span class=\"line\">        \"linenos\": false,</span><br><span class=\"line\">        \"style\": \"friendly\",</span><br><span class=\"line\">        \"title\": \"\"</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        \"code\": \"print \\\"hello, world\\n\\\"\",</span><br><span class=\"line\">        \"id\": 2,</span><br><span class=\"line\">        \"language\": \"python\",</span><br><span class=\"line\">        \"linenos\": false,</span><br><span class=\"line\">        \"style\": \"friendly\",</span><br><span class=\"line\">        \"title\": \"\"</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        \"code\": \"print \\\"hello, world\\n\\\"\",</span><br><span class=\"line\">        \"id\": 3,</span><br><span class=\"line\">        \"language\": \"python\",</span><br><span class=\"line\">        \"linenos\": false,</span><br><span class=\"line\">        \"style\": \"friendly\",</span><br><span class=\"line\">        \"title\": \"\"</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n<p>我们也可以控制返回的格式，利用HTTP头或者格式前缀。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">PS E:\\Study\\Serializer_tutorial\\tutorial&gt; http http://127.0.0.1:8000/snippets/ Accept:application/json</span><br><span class=\"line\">HTTP/1.0 200 OK</span><br><span class=\"line\">Allow: POST, OPTIONS, GET</span><br><span class=\"line\">Content-Length: 319</span><br><span class=\"line\">Content-Type: application/json</span><br><span class=\"line\">Date: Tue, 10 Oct 2017 07:54:19 GMT</span><br><span class=\"line\">Server: WSGIServer/0.1 Python/2.7.13</span><br><span class=\"line\">Vary: Accept, Cookie</span><br><span class=\"line\">X-Frame-Options: SAMEORIGIN</span><br><span class=\"line\"></span><br><span class=\"line\">[</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"string\">\"code\"</span>: <span class=\"string\">\"foo = \\\"bar\\\"\\n\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"id\"</span>: 1,</span><br><span class=\"line\">        <span class=\"string\">\"language\"</span>: <span class=\"string\">\"python\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"linenos\"</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">        <span class=\"string\">\"style\"</span>: <span class=\"string\">\"friendly\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"title\"</span>: <span class=\"string\">\"\"</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"string\">\"code\"</span>: <span class=\"string\">\"print \\\"hello, world\\n\\\"\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"id\"</span>: 2,</span><br><span class=\"line\">        <span class=\"string\">\"language\"</span>: <span class=\"string\">\"python\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"linenos\"</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">        <span class=\"string\">\"style\"</span>: <span class=\"string\">\"friendly\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"title\"</span>: <span class=\"string\">\"\"</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"string\">\"code\"</span>: <span class=\"string\">\"print \\\"hello, world\\n\\\"\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"id\"</span>: 3,</span><br><span class=\"line\">        <span class=\"string\">\"language\"</span>: <span class=\"string\">\"python\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"linenos\"</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">        <span class=\"string\">\"style\"</span>: <span class=\"string\">\"friendly\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"title\"</span>: <span class=\"string\">\"\"</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">]</span><br><span class=\"line\">PS E:\\Study\\Serializer_tutorial\\tutorial&gt; http http://127.0.0.1:8000/snippets/ Accept:text/html</span><br><span class=\"line\">HTTP/1.0 200 OK</span><br><span class=\"line\">Allow: POST, OPTIONS, GET</span><br><span class=\"line\">Content-Length: 7647</span><br><span class=\"line\">Content-Type: text/html; charset=utf-8</span><br><span class=\"line\">Date: Tue, 10 Oct 2017 07:54:50 GMT</span><br><span class=\"line\">Server: WSGIServer/0.1 Python/2.7.13</span><br><span class=\"line\">Vary: Accept, Cookie</span><br><span class=\"line\">X-Frame-Options: SAMEORIGIN</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;!DOCTYPE html&gt;</span><br><span class=\"line\">&lt;html&gt;</span><br><span class=\"line\">  &lt;head&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        &lt;meta http-equiv=<span class=\"string\">\"Content-Type\"</span> content=<span class=\"string\">\"text/html; charset=utf-8\"</span>/&gt;</span><br><span class=\"line\">        &lt;meta name=<span class=\"string\">\"robots\"</span> content=<span class=\"string\">\"NONE,NOARCHIVE\"</span> /&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">      &lt;title&gt;Snippet List – Django REST framework&lt;/title&gt;</span><br><span class=\"line\">PS E:\\Study\\Serializer_tutorial\\tutorial&gt; http http://127.0.0.1:8000/snippets.json</span><br><span class=\"line\">HTTP/1.0 200 OK</span><br><span class=\"line\">Allow: POST, OPTIONS, GET</span><br><span class=\"line\">Content-Length: 319</span><br><span class=\"line\">Content-Type: application/json</span><br><span class=\"line\">Date: Tue, 10 Oct 2017 07:55:25 GMT</span><br><span class=\"line\">Server: WSGIServer/0.1 Python/2.7.13</span><br><span class=\"line\">Vary: Accept, Cookie</span><br><span class=\"line\">X-Frame-Options: SAMEORIGIN</span><br><span class=\"line\"></span><br><span class=\"line\">[</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"string\">\"code\"</span>: <span class=\"string\">\"foo = \\\"bar\\\"\\n\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"id\"</span>: 1,</span><br><span class=\"line\">        <span class=\"string\">\"language\"</span>: <span class=\"string\">\"python\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"linenos\"</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">        <span class=\"string\">\"style\"</span>: <span class=\"string\">\"friendly\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"title\"</span>: <span class=\"string\">\"\"</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"string\">\"code\"</span>: <span class=\"string\">\"print \\\"hello, world\\n\\\"\"</span>,</span><br><span class=\"line\">PS E:\\Study\\Serializer_tutorial\\tutorial&gt; http http://127.0.0.1:8000/snippets.api</span><br><span class=\"line\">HTTP/1.0 200 OK</span><br><span class=\"line\">Allow: POST, OPTIONS, GET</span><br><span class=\"line\">Content-Length: 7668</span><br><span class=\"line\">Content-Type: text/html; charset=utf-8</span><br><span class=\"line\">Date: Tue, 10 Oct 2017 07:55:42 GMT</span><br><span class=\"line\">Server: WSGIServer/0.1 Python/2.7.13</span><br><span class=\"line\">Vary: Accept, Cookie</span><br><span class=\"line\">X-Frame-Options: SAMEORIGIN</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;!DOCTYPE html&gt;</span><br><span class=\"line\">&lt;html&gt;</span><br><span class=\"line\">  &lt;head&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        &lt;meta http-equiv=<span class=\"string\">\"Content-Type\"</span> content=<span class=\"string\">\"text/html; charset=utf-8\"</span>/&gt;</span><br><span class=\"line\">        &lt;meta name=<span class=\"string\">\"robots\"</span> content=<span class=\"string\">\"NONE,NOARCHIVE\"</span> /&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">      &lt;title&gt;Snippet List – Django REST framework&lt;/title&gt;</span><br></pre></td></tr></table></figure>\n<p>同时，我们可以控制请求数据的格式，利用Content-type头。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PS E:\\Study\\Serializer_tutorial\\tutorial&gt; http --form POST http://127.0.0.1:8000/snippets/ code=\"print 123\"</span><br><span class=\"line\">HTTP/1.0 201 Created</span><br><span class=\"line\">Allow: POST, OPTIONS, GET</span><br><span class=\"line\">Content-Length: 93</span><br><span class=\"line\">Content-Type: application/json</span><br><span class=\"line\">Date: Tue, 10 Oct 2017 07:58:55 GMT</span><br><span class=\"line\">Server: WSGIServer/0.1 Python/2.7.13</span><br><span class=\"line\">Vary: Accept, Cookie</span><br><span class=\"line\">X-Frame-Options: SAMEORIGIN</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    \"code\": \"print 123\",</span><br><span class=\"line\">    \"id\": 4,</span><br><span class=\"line\">    \"language\": \"python\",</span><br><span class=\"line\">    \"linenos\": false,</span><br><span class=\"line\">    \"style\": \"friendly\",</span><br><span class=\"line\">    \"title\": \"\"</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">PS E:\\Study\\Serializer_tutorial\\tutorial&gt; http --json POST http://127.0.0.1:8000/snippets/ code=\"print 456\"</span><br><span class=\"line\">HTTP/1.0 201 Created</span><br><span class=\"line\">Allow: POST, OPTIONS, GET</span><br><span class=\"line\">Content-Length: 93</span><br><span class=\"line\">Content-Type: application/json</span><br><span class=\"line\">Date: Tue, 10 Oct 2017 07:59:24 GMT</span><br><span class=\"line\">Server: WSGIServer/0.1 Python/2.7.13</span><br><span class=\"line\">Vary: Accept, Cookie</span><br><span class=\"line\">X-Frame-Options: SAMEORIGIN</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    \"code\": \"print 456\",</span><br><span class=\"line\">    \"id\": 5,</span><br><span class=\"line\">    \"language\": \"python\",</span><br><span class=\"line\">    \"linenos\": false,</span><br><span class=\"line\">    \"style\": \"friendly\",</span><br><span class=\"line\">    \"title\": \"\"</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"可视化\"><a href=\"#可视化\" class=\"headerlink\" title=\"可视化\"></a>可视化</h4><p>由于API可以根据客户端的请求选择合适的响应类型。因此当接收到来自浏览器的请求时，会默认以html的格式响应请求。这可以让api能够返回，用于网页浏览。可视化之后，用浏览器开发和使用api将变得十分方便。所以现在用浏览器查看是这个画风：</p>\n<p><img src=\"/blogimg/reqres.png\" alt=\"image\"></p>"},{"title":"DjangoRESTframework-视图集合和路由","date":"2017-10-11T04:26:23.000Z","_content":"\n### DjangoRESTframework    视图集合和路由（ViewSets & Routers）\n\nREST framework包含一个用于处理ViewSets的抽象，它允许开发人员专注于对状态和API的交互进行建模，并根据公共约定自动构建URL。\n\nViewSet类做的事情和View类做的事情差不多，除开它们都提供read或者update操作，而不是处理get或者put。\n\nViewSet类仅在最后时刻绑定到一组方法处理程序，当它被实例化为一组视图时，通常使用一个Router类来处理它，为你定义复杂的URL配置。\n\n<!--more-->\n\n#### 使用ViewSets重构\n\n让我们来看看当前的视图，并将它们重构为view sets。\n\n首先，让我们将UserList和UserDetail视图重构为一个单独的UserViewSet。我们可以删除这两个视图，并将它们替换为单个类:\n\n```python\nfrom rest_framework import viewsets\n\nclass UserViewSet(viewsets.ReadOnlyModelViewSet):\n    \"\"\"\n    This viewset automatically provides `list` and `detail` actions.\n    \"\"\"\n    queryset = User.objects.all()\n    serializer_class = UserSerializer\n```\n\n这里我们使用了ReadOnlyModelViewSet类来自动提供默认的“只读”操作。我们仍然设置了queryset和serializer_class属性，就像我们使用常规视图时那样，但是我们不再需要向两个单独的类提供相同的信息。\n\n接下来，我们将替换SnippetList、SnippetDetail和SnippetHighLight视图类。我们可以删除这三个视图，然后用一个类替换它们。\n\n```python\nfrom rest_framework.decorators import detail_route\nfrom rest_framework.response import Response\n\nclass SnippetViewSet(viewsets.ModelViewSet):\n    \"\"\"\n    This viewset automatically provides `list`, `create`, `retrieve`,\n    `update` and `destroy` actions.\n\n    Additionally we also provide an extra `highlight` action.\n    \"\"\"\n    queryset = Snippet.objects.all()\n    serializer_class = SnippetSerializer\n    permission_classes = (permissions.IsAuthenticatedOrReadOnly,\n                          IsOwnerOrReadOnly,)\n\n    @detail_route(renderer_classes=[renderers.StaticHTMLRenderer])\n    def highlight(self, request, *args, **kwargs):\n        snippet = self.get_object()\n        return Response(snippet.highlighted)\n\n    def perform_create(self, serializer):\n        serializer.save(owner=self.request.user)\n```\n\n这一次，我们使用了ModelViewSet类，以便获得完整的默认读和写操作集。\n\n请注意，我们还使用@detail_route装饰器创建了一个自定义动作，名为highlight。这个装饰器可以用来添加任何不符合标准的create/updat/delete样式的自定义入口点。\n\n使用@detail_route装饰器的自定义操作会在缺省情况下响应GET请求。如果我们想要一个响应POST请求的操作，我们可以使用methods参数来指定。\n\n缺省情况下，自定义操作的url依赖于方法名本身。如果您想要更改url的构造方式，可以将url_path作为修饰器关键字参数。\n\n#### 将Viewsets和URL分别进行绑定\n\n当我们定义URL配置时，处理程序方法只能绑定到操作。为了查看底层的情况，让我们首先从我们的视图中创建一组视图。\n\n在url.py文件将我们的ViewSet类绑定到一组具体的视图中。\n\n```python\nfrom snippets.views import SnippetViewSet, UserViewSet, api_root\nfrom rest_framework import renderers\n\nsnippet_list = SnippetViewSet.as_view({\n    'get': 'list',\n    'post': 'create'\n})\nsnippet_detail = SnippetViewSet.as_view({\n    'get': 'retrieve',\n    'put': 'update',\n    'patch': 'partial_update',\n    'delete': 'destroy'\n})\nsnippet_highlight = SnippetViewSet.as_view({\n    'get': 'highlight'\n}, renderer_classes=[renderers.StaticHTMLRenderer])\nuser_list = UserViewSet.as_view({\n    'get': 'list'\n})\nuser_detail = UserViewSet.as_view({\n    'get': 'retrieve'\n})\n```\n\n注意，通过将http方法绑定到每个视图所需的操作，我们如何从每个ViewSet类创建多个视图。\n\n既然我们已经将我们的资源绑定到具体的视图中，我们可以像往常一样使用URL conf注册视图。\n\n```python\nurlpatterns = format_suffix_patterns([\n    url(r'^$', api_root),\n    url(r'^snippets/$', snippet_list, name='snippet-list'),\n    url(r'^snippets/(?P<pk>[0-9]+)/$', snippet_detail, name='snippet-detail'),\n    url(r'^snippets/(?P<pk>[0-9]+)/highlight/$', snippet_highlight, name='snippet-highlight'),\n    url(r'^users/$', user_list, name='user-list'),\n    url(r'^users/(?P<pk>[0-9]+)/$', user_detail, name='user-detail')\n])\n```\n\n#### URL路由\n\n因为我们使用的是ViewSet类而不是视图类，所以我们实际上不需要自己设计URL。将资源连接到视图和url的约定可以通过路由器类自动处理。我们所要做的就是用一个路由器注册合适的视图集，然后让它完成剩下的工作。\n\n现在的urls.py文件是这样的\n\n```python\nfrom django.conf.urls import url, include\nfrom snippets import views\nfrom rest_framework.routers import DefaultRouter\n\n# Create a router and register our viewsets with it.\nrouter = DefaultRouter()\nrouter.register(r'snippets', views.SnippetViewSet)\nrouter.register(r'users', views.UserViewSet)\n\n# The API URLs are now determined automatically by the router.\n# Additionally, we include the login URLs for the browsable API.\nurlpatterns = [\n    url(r'^', include(router.urls)),\n    url(r'^api-auth/', include('rest_framework.urls', namespace='rest_framework'))\n]\n```\n\n用路由器注册viewset类似于提供一个urlpattern。我们包括两个参数:视图的URL前缀和viewset本身。\n\n我们使用的DefaultRouter类也会自动为我们创建API根视图，因此我们现在可以从views模块中删除api_root方法。\n\n#### views和viewsets之间的权衡\n\n使用viewset是一个非常有用的抽象。它有助于确保URL约定在您的API中是一致的，最小化您需要编写的代码量，并允许您集中精力于您的API所提供的交互和表示，而不是URL conf的细节。\n\n这并不意味着它总是正确的方法。在使用基于类的视图而不是基于函数的视图时，还需要考虑类似的权衡。使用viewset比单独构建视图更显式。\n\n原文链接：http://www.django-rest-framework.org/tutorial/6-viewsets-and-routers/","source":"_posts/DjangoRESTframework-ViewsetsRouters.md","raw":"---\ntitle: DjangoRESTframework-视图集合和路由\ncategories:\n  - Program\ntags:\n  - djangorestframework\ndate: 2017-10-11 12:26:23\n---\n\n### DjangoRESTframework    视图集合和路由（ViewSets & Routers）\n\nREST framework包含一个用于处理ViewSets的抽象，它允许开发人员专注于对状态和API的交互进行建模，并根据公共约定自动构建URL。\n\nViewSet类做的事情和View类做的事情差不多，除开它们都提供read或者update操作，而不是处理get或者put。\n\nViewSet类仅在最后时刻绑定到一组方法处理程序，当它被实例化为一组视图时，通常使用一个Router类来处理它，为你定义复杂的URL配置。\n\n<!--more-->\n\n#### 使用ViewSets重构\n\n让我们来看看当前的视图，并将它们重构为view sets。\n\n首先，让我们将UserList和UserDetail视图重构为一个单独的UserViewSet。我们可以删除这两个视图，并将它们替换为单个类:\n\n```python\nfrom rest_framework import viewsets\n\nclass UserViewSet(viewsets.ReadOnlyModelViewSet):\n    \"\"\"\n    This viewset automatically provides `list` and `detail` actions.\n    \"\"\"\n    queryset = User.objects.all()\n    serializer_class = UserSerializer\n```\n\n这里我们使用了ReadOnlyModelViewSet类来自动提供默认的“只读”操作。我们仍然设置了queryset和serializer_class属性，就像我们使用常规视图时那样，但是我们不再需要向两个单独的类提供相同的信息。\n\n接下来，我们将替换SnippetList、SnippetDetail和SnippetHighLight视图类。我们可以删除这三个视图，然后用一个类替换它们。\n\n```python\nfrom rest_framework.decorators import detail_route\nfrom rest_framework.response import Response\n\nclass SnippetViewSet(viewsets.ModelViewSet):\n    \"\"\"\n    This viewset automatically provides `list`, `create`, `retrieve`,\n    `update` and `destroy` actions.\n\n    Additionally we also provide an extra `highlight` action.\n    \"\"\"\n    queryset = Snippet.objects.all()\n    serializer_class = SnippetSerializer\n    permission_classes = (permissions.IsAuthenticatedOrReadOnly,\n                          IsOwnerOrReadOnly,)\n\n    @detail_route(renderer_classes=[renderers.StaticHTMLRenderer])\n    def highlight(self, request, *args, **kwargs):\n        snippet = self.get_object()\n        return Response(snippet.highlighted)\n\n    def perform_create(self, serializer):\n        serializer.save(owner=self.request.user)\n```\n\n这一次，我们使用了ModelViewSet类，以便获得完整的默认读和写操作集。\n\n请注意，我们还使用@detail_route装饰器创建了一个自定义动作，名为highlight。这个装饰器可以用来添加任何不符合标准的create/updat/delete样式的自定义入口点。\n\n使用@detail_route装饰器的自定义操作会在缺省情况下响应GET请求。如果我们想要一个响应POST请求的操作，我们可以使用methods参数来指定。\n\n缺省情况下，自定义操作的url依赖于方法名本身。如果您想要更改url的构造方式，可以将url_path作为修饰器关键字参数。\n\n#### 将Viewsets和URL分别进行绑定\n\n当我们定义URL配置时，处理程序方法只能绑定到操作。为了查看底层的情况，让我们首先从我们的视图中创建一组视图。\n\n在url.py文件将我们的ViewSet类绑定到一组具体的视图中。\n\n```python\nfrom snippets.views import SnippetViewSet, UserViewSet, api_root\nfrom rest_framework import renderers\n\nsnippet_list = SnippetViewSet.as_view({\n    'get': 'list',\n    'post': 'create'\n})\nsnippet_detail = SnippetViewSet.as_view({\n    'get': 'retrieve',\n    'put': 'update',\n    'patch': 'partial_update',\n    'delete': 'destroy'\n})\nsnippet_highlight = SnippetViewSet.as_view({\n    'get': 'highlight'\n}, renderer_classes=[renderers.StaticHTMLRenderer])\nuser_list = UserViewSet.as_view({\n    'get': 'list'\n})\nuser_detail = UserViewSet.as_view({\n    'get': 'retrieve'\n})\n```\n\n注意，通过将http方法绑定到每个视图所需的操作，我们如何从每个ViewSet类创建多个视图。\n\n既然我们已经将我们的资源绑定到具体的视图中，我们可以像往常一样使用URL conf注册视图。\n\n```python\nurlpatterns = format_suffix_patterns([\n    url(r'^$', api_root),\n    url(r'^snippets/$', snippet_list, name='snippet-list'),\n    url(r'^snippets/(?P<pk>[0-9]+)/$', snippet_detail, name='snippet-detail'),\n    url(r'^snippets/(?P<pk>[0-9]+)/highlight/$', snippet_highlight, name='snippet-highlight'),\n    url(r'^users/$', user_list, name='user-list'),\n    url(r'^users/(?P<pk>[0-9]+)/$', user_detail, name='user-detail')\n])\n```\n\n#### URL路由\n\n因为我们使用的是ViewSet类而不是视图类，所以我们实际上不需要自己设计URL。将资源连接到视图和url的约定可以通过路由器类自动处理。我们所要做的就是用一个路由器注册合适的视图集，然后让它完成剩下的工作。\n\n现在的urls.py文件是这样的\n\n```python\nfrom django.conf.urls import url, include\nfrom snippets import views\nfrom rest_framework.routers import DefaultRouter\n\n# Create a router and register our viewsets with it.\nrouter = DefaultRouter()\nrouter.register(r'snippets', views.SnippetViewSet)\nrouter.register(r'users', views.UserViewSet)\n\n# The API URLs are now determined automatically by the router.\n# Additionally, we include the login URLs for the browsable API.\nurlpatterns = [\n    url(r'^', include(router.urls)),\n    url(r'^api-auth/', include('rest_framework.urls', namespace='rest_framework'))\n]\n```\n\n用路由器注册viewset类似于提供一个urlpattern。我们包括两个参数:视图的URL前缀和viewset本身。\n\n我们使用的DefaultRouter类也会自动为我们创建API根视图，因此我们现在可以从views模块中删除api_root方法。\n\n#### views和viewsets之间的权衡\n\n使用viewset是一个非常有用的抽象。它有助于确保URL约定在您的API中是一致的，最小化您需要编写的代码量，并允许您集中精力于您的API所提供的交互和表示，而不是URL conf的细节。\n\n这并不意味着它总是正确的方法。在使用基于类的视图而不是基于函数的视图时，还需要考虑类似的权衡。使用viewset比单独构建视图更显式。\n\n原文链接：http://www.django-rest-framework.org/tutorial/6-viewsets-and-routers/","slug":"DjangoRESTframework-ViewsetsRouters","published":1,"updated":"2017-12-04T07:27:28.754Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjeqig1l6001dlgqavw7i8wqu","content":"<h3 id=\"DjangoRESTframework-视图集合和路由（ViewSets-amp-Routers）\"><a href=\"#DjangoRESTframework-视图集合和路由（ViewSets-amp-Routers）\" class=\"headerlink\" title=\"DjangoRESTframework    视图集合和路由（ViewSets &amp; Routers）\"></a>DjangoRESTframework    视图集合和路由（ViewSets &amp; Routers）</h3><p>REST framework包含一个用于处理ViewSets的抽象，它允许开发人员专注于对状态和API的交互进行建模，并根据公共约定自动构建URL。</p>\n<p>ViewSet类做的事情和View类做的事情差不多，除开它们都提供read或者update操作，而不是处理get或者put。</p>\n<p>ViewSet类仅在最后时刻绑定到一组方法处理程序，当它被实例化为一组视图时，通常使用一个Router类来处理它，为你定义复杂的URL配置。</p>\n<a id=\"more\"></a>\n<h4 id=\"使用ViewSets重构\"><a href=\"#使用ViewSets重构\" class=\"headerlink\" title=\"使用ViewSets重构\"></a>使用ViewSets重构</h4><p>让我们来看看当前的视图，并将它们重构为view sets。</p>\n<p>首先，让我们将UserList和UserDetail视图重构为一个单独的UserViewSet。我们可以删除这两个视图，并将它们替换为单个类:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> rest_framework <span class=\"keyword\">import</span> viewsets</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">UserViewSet</span><span class=\"params\">(viewsets.ReadOnlyModelViewSet)</span>:</span></span><br><span class=\"line\">    <span class=\"string\">\"\"\"</span></span><br><span class=\"line\"><span class=\"string\">    This viewset automatically provides `list` and `detail` actions.</span></span><br><span class=\"line\"><span class=\"string\">    \"\"\"</span></span><br><span class=\"line\">    queryset = User.objects.all()</span><br><span class=\"line\">    serializer_class = UserSerializer</span><br></pre></td></tr></table></figure>\n<p>这里我们使用了ReadOnlyModelViewSet类来自动提供默认的“只读”操作。我们仍然设置了queryset和serializer_class属性，就像我们使用常规视图时那样，但是我们不再需要向两个单独的类提供相同的信息。</p>\n<p>接下来，我们将替换SnippetList、SnippetDetail和SnippetHighLight视图类。我们可以删除这三个视图，然后用一个类替换它们。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> rest_framework.decorators <span class=\"keyword\">import</span> detail_route</span><br><span class=\"line\"><span class=\"keyword\">from</span> rest_framework.response <span class=\"keyword\">import</span> Response</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SnippetViewSet</span><span class=\"params\">(viewsets.ModelViewSet)</span>:</span></span><br><span class=\"line\">    <span class=\"string\">\"\"\"</span></span><br><span class=\"line\"><span class=\"string\">    This viewset automatically provides `list`, `create`, `retrieve`,</span></span><br><span class=\"line\"><span class=\"string\">    `update` and `destroy` actions.</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">    Additionally we also provide an extra `highlight` action.</span></span><br><span class=\"line\"><span class=\"string\">    \"\"\"</span></span><br><span class=\"line\">    queryset = Snippet.objects.all()</span><br><span class=\"line\">    serializer_class = SnippetSerializer</span><br><span class=\"line\">    permission_classes = (permissions.IsAuthenticatedOrReadOnly,</span><br><span class=\"line\">                          IsOwnerOrReadOnly,)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">    @detail_route(renderer_classes=[renderers.StaticHTMLRenderer])</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">highlight</span><span class=\"params\">(self, request, *args, **kwargs)</span>:</span></span><br><span class=\"line\">        snippet = self.get_object()</span><br><span class=\"line\">        <span class=\"keyword\">return</span> Response(snippet.highlighted)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">perform_create</span><span class=\"params\">(self, serializer)</span>:</span></span><br><span class=\"line\">        serializer.save(owner=self.request.user)</span><br></pre></td></tr></table></figure>\n<p>这一次，我们使用了ModelViewSet类，以便获得完整的默认读和写操作集。</p>\n<p>请注意，我们还使用@detail_route装饰器创建了一个自定义动作，名为highlight。这个装饰器可以用来添加任何不符合标准的create/updat/delete样式的自定义入口点。</p>\n<p>使用@detail_route装饰器的自定义操作会在缺省情况下响应GET请求。如果我们想要一个响应POST请求的操作，我们可以使用methods参数来指定。</p>\n<p>缺省情况下，自定义操作的url依赖于方法名本身。如果您想要更改url的构造方式，可以将url_path作为修饰器关键字参数。</p>\n<h4 id=\"将Viewsets和URL分别进行绑定\"><a href=\"#将Viewsets和URL分别进行绑定\" class=\"headerlink\" title=\"将Viewsets和URL分别进行绑定\"></a>将Viewsets和URL分别进行绑定</h4><p>当我们定义URL配置时，处理程序方法只能绑定到操作。为了查看底层的情况，让我们首先从我们的视图中创建一组视图。</p>\n<p>在url.py文件将我们的ViewSet类绑定到一组具体的视图中。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> snippets.views <span class=\"keyword\">import</span> SnippetViewSet, UserViewSet, api_root</span><br><span class=\"line\"><span class=\"keyword\">from</span> rest_framework <span class=\"keyword\">import</span> renderers</span><br><span class=\"line\"></span><br><span class=\"line\">snippet_list = SnippetViewSet.as_view(&#123;</span><br><span class=\"line\">    <span class=\"string\">'get'</span>: <span class=\"string\">'list'</span>,</span><br><span class=\"line\">    <span class=\"string\">'post'</span>: <span class=\"string\">'create'</span></span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">snippet_detail = SnippetViewSet.as_view(&#123;</span><br><span class=\"line\">    <span class=\"string\">'get'</span>: <span class=\"string\">'retrieve'</span>,</span><br><span class=\"line\">    <span class=\"string\">'put'</span>: <span class=\"string\">'update'</span>,</span><br><span class=\"line\">    <span class=\"string\">'patch'</span>: <span class=\"string\">'partial_update'</span>,</span><br><span class=\"line\">    <span class=\"string\">'delete'</span>: <span class=\"string\">'destroy'</span></span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">snippet_highlight = SnippetViewSet.as_view(&#123;</span><br><span class=\"line\">    <span class=\"string\">'get'</span>: <span class=\"string\">'highlight'</span></span><br><span class=\"line\">&#125;, renderer_classes=[renderers.StaticHTMLRenderer])</span><br><span class=\"line\">user_list = UserViewSet.as_view(&#123;</span><br><span class=\"line\">    <span class=\"string\">'get'</span>: <span class=\"string\">'list'</span></span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">user_detail = UserViewSet.as_view(&#123;</span><br><span class=\"line\">    <span class=\"string\">'get'</span>: <span class=\"string\">'retrieve'</span></span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n<p>注意，通过将http方法绑定到每个视图所需的操作，我们如何从每个ViewSet类创建多个视图。</p>\n<p>既然我们已经将我们的资源绑定到具体的视图中，我们可以像往常一样使用URL conf注册视图。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">urlpatterns = format_suffix_patterns([</span><br><span class=\"line\">    url(<span class=\"string\">r'^$'</span>, api_root),</span><br><span class=\"line\">    url(<span class=\"string\">r'^snippets/$'</span>, snippet_list, name=<span class=\"string\">'snippet-list'</span>),</span><br><span class=\"line\">    url(<span class=\"string\">r'^snippets/(?P&lt;pk&gt;[0-9]+)/$'</span>, snippet_detail, name=<span class=\"string\">'snippet-detail'</span>),</span><br><span class=\"line\">    url(<span class=\"string\">r'^snippets/(?P&lt;pk&gt;[0-9]+)/highlight/$'</span>, snippet_highlight, name=<span class=\"string\">'snippet-highlight'</span>),</span><br><span class=\"line\">    url(<span class=\"string\">r'^users/$'</span>, user_list, name=<span class=\"string\">'user-list'</span>),</span><br><span class=\"line\">    url(<span class=\"string\">r'^users/(?P&lt;pk&gt;[0-9]+)/$'</span>, user_detail, name=<span class=\"string\">'user-detail'</span>)</span><br><span class=\"line\">])</span><br></pre></td></tr></table></figure>\n<h4 id=\"URL路由\"><a href=\"#URL路由\" class=\"headerlink\" title=\"URL路由\"></a>URL路由</h4><p>因为我们使用的是ViewSet类而不是视图类，所以我们实际上不需要自己设计URL。将资源连接到视图和url的约定可以通过路由器类自动处理。我们所要做的就是用一个路由器注册合适的视图集，然后让它完成剩下的工作。</p>\n<p>现在的urls.py文件是这样的</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> django.conf.urls <span class=\"keyword\">import</span> url, include</span><br><span class=\"line\"><span class=\"keyword\">from</span> snippets <span class=\"keyword\">import</span> views</span><br><span class=\"line\"><span class=\"keyword\">from</span> rest_framework.routers <span class=\"keyword\">import</span> DefaultRouter</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Create a router and register our viewsets with it.</span></span><br><span class=\"line\">router = DefaultRouter()</span><br><span class=\"line\">router.register(<span class=\"string\">r'snippets'</span>, views.SnippetViewSet)</span><br><span class=\"line\">router.register(<span class=\"string\">r'users'</span>, views.UserViewSet)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># The API URLs are now determined automatically by the router.</span></span><br><span class=\"line\"><span class=\"comment\"># Additionally, we include the login URLs for the browsable API.</span></span><br><span class=\"line\">urlpatterns = [</span><br><span class=\"line\">    url(<span class=\"string\">r'^'</span>, include(router.urls)),</span><br><span class=\"line\">    url(<span class=\"string\">r'^api-auth/'</span>, include(<span class=\"string\">'rest_framework.urls'</span>, namespace=<span class=\"string\">'rest_framework'</span>))</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n<p>用路由器注册viewset类似于提供一个urlpattern。我们包括两个参数:视图的URL前缀和viewset本身。</p>\n<p>我们使用的DefaultRouter类也会自动为我们创建API根视图，因此我们现在可以从views模块中删除api_root方法。</p>\n<h4 id=\"views和viewsets之间的权衡\"><a href=\"#views和viewsets之间的权衡\" class=\"headerlink\" title=\"views和viewsets之间的权衡\"></a>views和viewsets之间的权衡</h4><p>使用viewset是一个非常有用的抽象。它有助于确保URL约定在您的API中是一致的，最小化您需要编写的代码量，并允许您集中精力于您的API所提供的交互和表示，而不是URL conf的细节。</p>\n<p>这并不意味着它总是正确的方法。在使用基于类的视图而不是基于函数的视图时，还需要考虑类似的权衡。使用viewset比单独构建视图更显式。</p>\n<p>原文链接：<a href=\"http://www.django-rest-framework.org/tutorial/6-viewsets-and-routers/\" target=\"_blank\" rel=\"noopener\">http://www.django-rest-framework.org/tutorial/6-viewsets-and-routers/</a></p>\n","site":{"data":{}},"excerpt":"<h3 id=\"DjangoRESTframework-视图集合和路由（ViewSets-amp-Routers）\"><a href=\"#DjangoRESTframework-视图集合和路由（ViewSets-amp-Routers）\" class=\"headerlink\" title=\"DjangoRESTframework    视图集合和路由（ViewSets &amp; Routers）\"></a>DjangoRESTframework    视图集合和路由（ViewSets &amp; Routers）</h3><p>REST framework包含一个用于处理ViewSets的抽象，它允许开发人员专注于对状态和API的交互进行建模，并根据公共约定自动构建URL。</p>\n<p>ViewSet类做的事情和View类做的事情差不多，除开它们都提供read或者update操作，而不是处理get或者put。</p>\n<p>ViewSet类仅在最后时刻绑定到一组方法处理程序，当它被实例化为一组视图时，通常使用一个Router类来处理它，为你定义复杂的URL配置。</p>","more":"<h4 id=\"使用ViewSets重构\"><a href=\"#使用ViewSets重构\" class=\"headerlink\" title=\"使用ViewSets重构\"></a>使用ViewSets重构</h4><p>让我们来看看当前的视图，并将它们重构为view sets。</p>\n<p>首先，让我们将UserList和UserDetail视图重构为一个单独的UserViewSet。我们可以删除这两个视图，并将它们替换为单个类:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> rest_framework <span class=\"keyword\">import</span> viewsets</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">UserViewSet</span><span class=\"params\">(viewsets.ReadOnlyModelViewSet)</span>:</span></span><br><span class=\"line\">    <span class=\"string\">\"\"\"</span></span><br><span class=\"line\"><span class=\"string\">    This viewset automatically provides `list` and `detail` actions.</span></span><br><span class=\"line\"><span class=\"string\">    \"\"\"</span></span><br><span class=\"line\">    queryset = User.objects.all()</span><br><span class=\"line\">    serializer_class = UserSerializer</span><br></pre></td></tr></table></figure>\n<p>这里我们使用了ReadOnlyModelViewSet类来自动提供默认的“只读”操作。我们仍然设置了queryset和serializer_class属性，就像我们使用常规视图时那样，但是我们不再需要向两个单独的类提供相同的信息。</p>\n<p>接下来，我们将替换SnippetList、SnippetDetail和SnippetHighLight视图类。我们可以删除这三个视图，然后用一个类替换它们。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> rest_framework.decorators <span class=\"keyword\">import</span> detail_route</span><br><span class=\"line\"><span class=\"keyword\">from</span> rest_framework.response <span class=\"keyword\">import</span> Response</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SnippetViewSet</span><span class=\"params\">(viewsets.ModelViewSet)</span>:</span></span><br><span class=\"line\">    <span class=\"string\">\"\"\"</span></span><br><span class=\"line\"><span class=\"string\">    This viewset automatically provides `list`, `create`, `retrieve`,</span></span><br><span class=\"line\"><span class=\"string\">    `update` and `destroy` actions.</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">    Additionally we also provide an extra `highlight` action.</span></span><br><span class=\"line\"><span class=\"string\">    \"\"\"</span></span><br><span class=\"line\">    queryset = Snippet.objects.all()</span><br><span class=\"line\">    serializer_class = SnippetSerializer</span><br><span class=\"line\">    permission_classes = (permissions.IsAuthenticatedOrReadOnly,</span><br><span class=\"line\">                          IsOwnerOrReadOnly,)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">    @detail_route(renderer_classes=[renderers.StaticHTMLRenderer])</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">highlight</span><span class=\"params\">(self, request, *args, **kwargs)</span>:</span></span><br><span class=\"line\">        snippet = self.get_object()</span><br><span class=\"line\">        <span class=\"keyword\">return</span> Response(snippet.highlighted)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">perform_create</span><span class=\"params\">(self, serializer)</span>:</span></span><br><span class=\"line\">        serializer.save(owner=self.request.user)</span><br></pre></td></tr></table></figure>\n<p>这一次，我们使用了ModelViewSet类，以便获得完整的默认读和写操作集。</p>\n<p>请注意，我们还使用@detail_route装饰器创建了一个自定义动作，名为highlight。这个装饰器可以用来添加任何不符合标准的create/updat/delete样式的自定义入口点。</p>\n<p>使用@detail_route装饰器的自定义操作会在缺省情况下响应GET请求。如果我们想要一个响应POST请求的操作，我们可以使用methods参数来指定。</p>\n<p>缺省情况下，自定义操作的url依赖于方法名本身。如果您想要更改url的构造方式，可以将url_path作为修饰器关键字参数。</p>\n<h4 id=\"将Viewsets和URL分别进行绑定\"><a href=\"#将Viewsets和URL分别进行绑定\" class=\"headerlink\" title=\"将Viewsets和URL分别进行绑定\"></a>将Viewsets和URL分别进行绑定</h4><p>当我们定义URL配置时，处理程序方法只能绑定到操作。为了查看底层的情况，让我们首先从我们的视图中创建一组视图。</p>\n<p>在url.py文件将我们的ViewSet类绑定到一组具体的视图中。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> snippets.views <span class=\"keyword\">import</span> SnippetViewSet, UserViewSet, api_root</span><br><span class=\"line\"><span class=\"keyword\">from</span> rest_framework <span class=\"keyword\">import</span> renderers</span><br><span class=\"line\"></span><br><span class=\"line\">snippet_list = SnippetViewSet.as_view(&#123;</span><br><span class=\"line\">    <span class=\"string\">'get'</span>: <span class=\"string\">'list'</span>,</span><br><span class=\"line\">    <span class=\"string\">'post'</span>: <span class=\"string\">'create'</span></span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">snippet_detail = SnippetViewSet.as_view(&#123;</span><br><span class=\"line\">    <span class=\"string\">'get'</span>: <span class=\"string\">'retrieve'</span>,</span><br><span class=\"line\">    <span class=\"string\">'put'</span>: <span class=\"string\">'update'</span>,</span><br><span class=\"line\">    <span class=\"string\">'patch'</span>: <span class=\"string\">'partial_update'</span>,</span><br><span class=\"line\">    <span class=\"string\">'delete'</span>: <span class=\"string\">'destroy'</span></span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">snippet_highlight = SnippetViewSet.as_view(&#123;</span><br><span class=\"line\">    <span class=\"string\">'get'</span>: <span class=\"string\">'highlight'</span></span><br><span class=\"line\">&#125;, renderer_classes=[renderers.StaticHTMLRenderer])</span><br><span class=\"line\">user_list = UserViewSet.as_view(&#123;</span><br><span class=\"line\">    <span class=\"string\">'get'</span>: <span class=\"string\">'list'</span></span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">user_detail = UserViewSet.as_view(&#123;</span><br><span class=\"line\">    <span class=\"string\">'get'</span>: <span class=\"string\">'retrieve'</span></span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n<p>注意，通过将http方法绑定到每个视图所需的操作，我们如何从每个ViewSet类创建多个视图。</p>\n<p>既然我们已经将我们的资源绑定到具体的视图中，我们可以像往常一样使用URL conf注册视图。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">urlpatterns = format_suffix_patterns([</span><br><span class=\"line\">    url(<span class=\"string\">r'^$'</span>, api_root),</span><br><span class=\"line\">    url(<span class=\"string\">r'^snippets/$'</span>, snippet_list, name=<span class=\"string\">'snippet-list'</span>),</span><br><span class=\"line\">    url(<span class=\"string\">r'^snippets/(?P&lt;pk&gt;[0-9]+)/$'</span>, snippet_detail, name=<span class=\"string\">'snippet-detail'</span>),</span><br><span class=\"line\">    url(<span class=\"string\">r'^snippets/(?P&lt;pk&gt;[0-9]+)/highlight/$'</span>, snippet_highlight, name=<span class=\"string\">'snippet-highlight'</span>),</span><br><span class=\"line\">    url(<span class=\"string\">r'^users/$'</span>, user_list, name=<span class=\"string\">'user-list'</span>),</span><br><span class=\"line\">    url(<span class=\"string\">r'^users/(?P&lt;pk&gt;[0-9]+)/$'</span>, user_detail, name=<span class=\"string\">'user-detail'</span>)</span><br><span class=\"line\">])</span><br></pre></td></tr></table></figure>\n<h4 id=\"URL路由\"><a href=\"#URL路由\" class=\"headerlink\" title=\"URL路由\"></a>URL路由</h4><p>因为我们使用的是ViewSet类而不是视图类，所以我们实际上不需要自己设计URL。将资源连接到视图和url的约定可以通过路由器类自动处理。我们所要做的就是用一个路由器注册合适的视图集，然后让它完成剩下的工作。</p>\n<p>现在的urls.py文件是这样的</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> django.conf.urls <span class=\"keyword\">import</span> url, include</span><br><span class=\"line\"><span class=\"keyword\">from</span> snippets <span class=\"keyword\">import</span> views</span><br><span class=\"line\"><span class=\"keyword\">from</span> rest_framework.routers <span class=\"keyword\">import</span> DefaultRouter</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Create a router and register our viewsets with it.</span></span><br><span class=\"line\">router = DefaultRouter()</span><br><span class=\"line\">router.register(<span class=\"string\">r'snippets'</span>, views.SnippetViewSet)</span><br><span class=\"line\">router.register(<span class=\"string\">r'users'</span>, views.UserViewSet)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># The API URLs are now determined automatically by the router.</span></span><br><span class=\"line\"><span class=\"comment\"># Additionally, we include the login URLs for the browsable API.</span></span><br><span class=\"line\">urlpatterns = [</span><br><span class=\"line\">    url(<span class=\"string\">r'^'</span>, include(router.urls)),</span><br><span class=\"line\">    url(<span class=\"string\">r'^api-auth/'</span>, include(<span class=\"string\">'rest_framework.urls'</span>, namespace=<span class=\"string\">'rest_framework'</span>))</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n<p>用路由器注册viewset类似于提供一个urlpattern。我们包括两个参数:视图的URL前缀和viewset本身。</p>\n<p>我们使用的DefaultRouter类也会自动为我们创建API根视图，因此我们现在可以从views模块中删除api_root方法。</p>\n<h4 id=\"views和viewsets之间的权衡\"><a href=\"#views和viewsets之间的权衡\" class=\"headerlink\" title=\"views和viewsets之间的权衡\"></a>views和viewsets之间的权衡</h4><p>使用viewset是一个非常有用的抽象。它有助于确保URL约定在您的API中是一致的，最小化您需要编写的代码量，并允许您集中精力于您的API所提供的交互和表示，而不是URL conf的细节。</p>\n<p>这并不意味着它总是正确的方法。在使用基于类的视图而不是基于函数的视图时，还需要考虑类似的权衡。使用viewset比单独构建视图更显式。</p>\n<p>原文链接：<a href=\"http://www.django-rest-framework.org/tutorial/6-viewsets-and-routers/\" target=\"_blank\" rel=\"noopener\">http://www.django-rest-framework.org/tutorial/6-viewsets-and-routers/</a></p>"},{"title":"DjangoRESTframework-基于类的视图（class-based views）","date":"2017-10-10T09:13:09.000Z","_content":"\n### DjangoRESTframework    基于类的视图（Class-based Views）\n\n我们也能够使用基于类的视图来替代基于方法的视图。让我们来看看这个强大的模式，让我们重用许多基本方法，帮助我们保持代码的DRY(Don't Repeat Yourself)。\n\n<!--more-->\n\n#### 利用基于类的视图重写我们的API\n\n我们将使用基于类的视图来重写咱们的视图，这个需要重构一下views.py了\n\n```python\nfrom snippets.models import Snippet\nfrom snippets.serializers import SnippetSerializer\nfrom django.http import Http404\nfrom rest_framework.views import APIView\nfrom rest_framework.response import Response\nfrom rest_framework import status\n\n\nclass SnippetList(APIView):\n    \"\"\"\n    List all snippets, or create a new snippet.\n    \"\"\"\n    def get(self, request, format=None):\n        snippets = Snippet.objects.all()\n        serializer = SnippetSerializer(snippets, many=True)\n        return Response(serializer.data)\n\n    def post(self, request, format=None):\n        serializer = SnippetSerializer(data=request.data)\n        if serializer.is_valid():\n            serializer.save()\n            return Response(serializer.data, status=status.HTTP_201_CREATED)\n        return Response(serializer.errors, status=status.HTTP_400_BAD_REQUEST)\n```\n\n到目前为止，它看起来和我们之前写的非常相似，但是我们已经很好的分离了不同的HTTP请求方法，继续改。\n\n```python\nclass SnippetDetail(APIView):\n    \"\"\"\n    Retrieve, update or delete a snippet instance.\n    \"\"\"\n    def get_object(self, pk):\n        try:\n            return Snippet.objects.get(pk=pk)\n        except Snippet.DoesNotExist:\n            raise Http404\n\n    def get(self, request, pk, format=None):\n        snippet = self.get_object(pk)\n        serializer = SnippetSerializer(snippet)\n        return Response(serializer.data)\n\n    def put(self, request, pk, format=None):\n        snippet = self.get_object(pk)\n        serializer = SnippetSerializer(snippet, data=request.data)\n        if serializer.is_valid():\n            serializer.save()\n            return Response(serializer.data)\n        return Response(serializer.errors, status=status.HTTP_400_BAD_REQUEST)\n\n    def delete(self, request, pk, format=None):\n        snippet = self.get_object(pk)\n        snippet.delete()\n        return Response(status=status.HTTP_204_NO_CONTENT)\n```\n\n这看起来很好嘛。但是看起来还是和之前差不太多，继续重构urls.py,更好的支持基于类的视图。\n\n```python\nfrom django.conf.urls import url\nfrom rest_framework.urlpatterns import format_suffix_patterns\nfrom snippets import views\n\nurlpatterns = [\n    url(r'^snippets/$', views.SnippetList.as_view()),\n    url(r'^snippets/(?P<pk>[0-9]+)/$', views.SnippetDetail.as_view()),\n]\n\nurlpatterns = format_suffix_patterns(urlpatterns)\n```\n\n哇，好了。打开开发服务器，一切都将和之前一样的运转。\n\n#### 使用mixins（Use mixins）\n\n使用基于类的视图的一大好处就是允许我们能够容易的组织可重用的行为。\n\ncreate/retrieve/updae/delete操作，在我们创建的支持模型的视图中都区别不大。这些行为都已经在REST framework中通过mixins很好的实现了。\n\n来看看使用mixin类如何组织我们的视图，同样是更改views.py\n\n```python\nfrom snippets.models import Snippet\nfrom snippets.serializers import SnippetSerializer\nfrom rest_framework import mixins\nfrom rest_framework import generics\n\nclass SnippetList(mixins.ListModelMixin,\n                  mixins.CreateModelMixin,\n                  generics.GenericAPIView):\n    queryset = Snippet.objects.all()\n    serializer_class = SnippetSerializer\n\n    def get(self, request, *args, **kwargs):\n        return self.list(request, *args, **kwargs)\n\n    def post(self, request, *args, **kwargs):\n        return self.create(request, *args, **kwargs)\n```\n\n我们花点时间来仔细的研究一下这里边到底都发生了什么。我们使用GenericAPIView,添加进了ListModelMixin和CreateModelMixin。\n\n基类提供了核心的方法，mixin类提供了.list()和.create()行为。我们可以明确的绑定get和post方法在不同的行为上。非常简单，还够用。\n\n```python\nclass SnippetDetail(mixins.RetrieveModelMixin,\n                    mixins.UpdateModelMixin,\n                    mixins.DestroyModelMixin,\n                    generics.GenericAPIView):\n    queryset = Snippet.objects.all()\n    serializer_class = SnippetSerializer\n\n    def get(self, request, *args, **kwargs):\n        return self.retrieve(request, *args, **kwargs)\n\n    def put(self, request, *args, **kwargs):\n        return self.update(request, *args, **kwargs)\n\n    def delete(self, request, *args, **kwargs):\n        return self.destroy(request, *args, **kwargs)\n```\n\n很相似，我们再次用GenericAPIView类提供关键方法，minxins提供了.retrieve(),.update(),.destroy()操作。\n\n#### 使用基于generic class的视图\n\n使用基于mixins的视图已经帮我们减少了代码，还可以再省一点。REST framework提供了一整套mixed-in geric的视图。我们再次为views.py瘦身一下。\n\n```python\nfrom snippets.models import Snippet\nfrom snippets.serializers import SnippetSerializer\nfrom rest_framework import generics\n\n\nclass SnippetList(generics.ListCreateAPIView):\n    queryset = Snippet.objects.all()\n    serializer_class = SnippetSerializer\n\n\nclass SnippetDetail(generics.RetrieveUpdateDestroyAPIView):\n    queryset = Snippet.objects.all()\n    serializer_class = SnippetSerializer\n```\n\n哇塞，这也太简洁了。这很Django！","source":"_posts/DjangoRESTframework-class-based-view.md","raw":"---\ntitle: DjangoRESTframework-基于类的视图（class-based views）\ncategories:\n  - Program\ntags:\n  - djangorestframework\ndate: 2017-10-10 17:13:09\n---\n\n### DjangoRESTframework    基于类的视图（Class-based Views）\n\n我们也能够使用基于类的视图来替代基于方法的视图。让我们来看看这个强大的模式，让我们重用许多基本方法，帮助我们保持代码的DRY(Don't Repeat Yourself)。\n\n<!--more-->\n\n#### 利用基于类的视图重写我们的API\n\n我们将使用基于类的视图来重写咱们的视图，这个需要重构一下views.py了\n\n```python\nfrom snippets.models import Snippet\nfrom snippets.serializers import SnippetSerializer\nfrom django.http import Http404\nfrom rest_framework.views import APIView\nfrom rest_framework.response import Response\nfrom rest_framework import status\n\n\nclass SnippetList(APIView):\n    \"\"\"\n    List all snippets, or create a new snippet.\n    \"\"\"\n    def get(self, request, format=None):\n        snippets = Snippet.objects.all()\n        serializer = SnippetSerializer(snippets, many=True)\n        return Response(serializer.data)\n\n    def post(self, request, format=None):\n        serializer = SnippetSerializer(data=request.data)\n        if serializer.is_valid():\n            serializer.save()\n            return Response(serializer.data, status=status.HTTP_201_CREATED)\n        return Response(serializer.errors, status=status.HTTP_400_BAD_REQUEST)\n```\n\n到目前为止，它看起来和我们之前写的非常相似，但是我们已经很好的分离了不同的HTTP请求方法，继续改。\n\n```python\nclass SnippetDetail(APIView):\n    \"\"\"\n    Retrieve, update or delete a snippet instance.\n    \"\"\"\n    def get_object(self, pk):\n        try:\n            return Snippet.objects.get(pk=pk)\n        except Snippet.DoesNotExist:\n            raise Http404\n\n    def get(self, request, pk, format=None):\n        snippet = self.get_object(pk)\n        serializer = SnippetSerializer(snippet)\n        return Response(serializer.data)\n\n    def put(self, request, pk, format=None):\n        snippet = self.get_object(pk)\n        serializer = SnippetSerializer(snippet, data=request.data)\n        if serializer.is_valid():\n            serializer.save()\n            return Response(serializer.data)\n        return Response(serializer.errors, status=status.HTTP_400_BAD_REQUEST)\n\n    def delete(self, request, pk, format=None):\n        snippet = self.get_object(pk)\n        snippet.delete()\n        return Response(status=status.HTTP_204_NO_CONTENT)\n```\n\n这看起来很好嘛。但是看起来还是和之前差不太多，继续重构urls.py,更好的支持基于类的视图。\n\n```python\nfrom django.conf.urls import url\nfrom rest_framework.urlpatterns import format_suffix_patterns\nfrom snippets import views\n\nurlpatterns = [\n    url(r'^snippets/$', views.SnippetList.as_view()),\n    url(r'^snippets/(?P<pk>[0-9]+)/$', views.SnippetDetail.as_view()),\n]\n\nurlpatterns = format_suffix_patterns(urlpatterns)\n```\n\n哇，好了。打开开发服务器，一切都将和之前一样的运转。\n\n#### 使用mixins（Use mixins）\n\n使用基于类的视图的一大好处就是允许我们能够容易的组织可重用的行为。\n\ncreate/retrieve/updae/delete操作，在我们创建的支持模型的视图中都区别不大。这些行为都已经在REST framework中通过mixins很好的实现了。\n\n来看看使用mixin类如何组织我们的视图，同样是更改views.py\n\n```python\nfrom snippets.models import Snippet\nfrom snippets.serializers import SnippetSerializer\nfrom rest_framework import mixins\nfrom rest_framework import generics\n\nclass SnippetList(mixins.ListModelMixin,\n                  mixins.CreateModelMixin,\n                  generics.GenericAPIView):\n    queryset = Snippet.objects.all()\n    serializer_class = SnippetSerializer\n\n    def get(self, request, *args, **kwargs):\n        return self.list(request, *args, **kwargs)\n\n    def post(self, request, *args, **kwargs):\n        return self.create(request, *args, **kwargs)\n```\n\n我们花点时间来仔细的研究一下这里边到底都发生了什么。我们使用GenericAPIView,添加进了ListModelMixin和CreateModelMixin。\n\n基类提供了核心的方法，mixin类提供了.list()和.create()行为。我们可以明确的绑定get和post方法在不同的行为上。非常简单，还够用。\n\n```python\nclass SnippetDetail(mixins.RetrieveModelMixin,\n                    mixins.UpdateModelMixin,\n                    mixins.DestroyModelMixin,\n                    generics.GenericAPIView):\n    queryset = Snippet.objects.all()\n    serializer_class = SnippetSerializer\n\n    def get(self, request, *args, **kwargs):\n        return self.retrieve(request, *args, **kwargs)\n\n    def put(self, request, *args, **kwargs):\n        return self.update(request, *args, **kwargs)\n\n    def delete(self, request, *args, **kwargs):\n        return self.destroy(request, *args, **kwargs)\n```\n\n很相似，我们再次用GenericAPIView类提供关键方法，minxins提供了.retrieve(),.update(),.destroy()操作。\n\n#### 使用基于generic class的视图\n\n使用基于mixins的视图已经帮我们减少了代码，还可以再省一点。REST framework提供了一整套mixed-in geric的视图。我们再次为views.py瘦身一下。\n\n```python\nfrom snippets.models import Snippet\nfrom snippets.serializers import SnippetSerializer\nfrom rest_framework import generics\n\n\nclass SnippetList(generics.ListCreateAPIView):\n    queryset = Snippet.objects.all()\n    serializer_class = SnippetSerializer\n\n\nclass SnippetDetail(generics.RetrieveUpdateDestroyAPIView):\n    queryset = Snippet.objects.all()\n    serializer_class = SnippetSerializer\n```\n\n哇塞，这也太简洁了。这很Django！","slug":"DjangoRESTframework-class-based-view","published":1,"updated":"2017-12-04T07:27:28.754Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjeqig1la001glgqa9tpifqj3","content":"<h3 id=\"DjangoRESTframework-基于类的视图（Class-based-Views）\"><a href=\"#DjangoRESTframework-基于类的视图（Class-based-Views）\" class=\"headerlink\" title=\"DjangoRESTframework    基于类的视图（Class-based Views）\"></a>DjangoRESTframework    基于类的视图（Class-based Views）</h3><p>我们也能够使用基于类的视图来替代基于方法的视图。让我们来看看这个强大的模式，让我们重用许多基本方法，帮助我们保持代码的DRY(Don’t Repeat Yourself)。</p>\n<a id=\"more\"></a>\n<h4 id=\"利用基于类的视图重写我们的API\"><a href=\"#利用基于类的视图重写我们的API\" class=\"headerlink\" title=\"利用基于类的视图重写我们的API\"></a>利用基于类的视图重写我们的API</h4><p>我们将使用基于类的视图来重写咱们的视图，这个需要重构一下views.py了</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> snippets.models <span class=\"keyword\">import</span> Snippet</span><br><span class=\"line\"><span class=\"keyword\">from</span> snippets.serializers <span class=\"keyword\">import</span> SnippetSerializer</span><br><span class=\"line\"><span class=\"keyword\">from</span> django.http <span class=\"keyword\">import</span> Http404</span><br><span class=\"line\"><span class=\"keyword\">from</span> rest_framework.views <span class=\"keyword\">import</span> APIView</span><br><span class=\"line\"><span class=\"keyword\">from</span> rest_framework.response <span class=\"keyword\">import</span> Response</span><br><span class=\"line\"><span class=\"keyword\">from</span> rest_framework <span class=\"keyword\">import</span> status</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SnippetList</span><span class=\"params\">(APIView)</span>:</span></span><br><span class=\"line\">    <span class=\"string\">\"\"\"</span></span><br><span class=\"line\"><span class=\"string\">    List all snippets, or create a new snippet.</span></span><br><span class=\"line\"><span class=\"string\">    \"\"\"</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get</span><span class=\"params\">(self, request, format=None)</span>:</span></span><br><span class=\"line\">        snippets = Snippet.objects.all()</span><br><span class=\"line\">        serializer = SnippetSerializer(snippets, many=<span class=\"keyword\">True</span>)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> Response(serializer.data)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">post</span><span class=\"params\">(self, request, format=None)</span>:</span></span><br><span class=\"line\">        serializer = SnippetSerializer(data=request.data)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> serializer.is_valid():</span><br><span class=\"line\">            serializer.save()</span><br><span class=\"line\">            <span class=\"keyword\">return</span> Response(serializer.data, status=status.HTTP_201_CREATED)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> Response(serializer.errors, status=status.HTTP_400_BAD_REQUEST)</span><br></pre></td></tr></table></figure>\n<p>到目前为止，它看起来和我们之前写的非常相似，但是我们已经很好的分离了不同的HTTP请求方法，继续改。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SnippetDetail</span><span class=\"params\">(APIView)</span>:</span></span><br><span class=\"line\">    <span class=\"string\">\"\"\"</span></span><br><span class=\"line\"><span class=\"string\">    Retrieve, update or delete a snippet instance.</span></span><br><span class=\"line\"><span class=\"string\">    \"\"\"</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_object</span><span class=\"params\">(self, pk)</span>:</span></span><br><span class=\"line\">        <span class=\"keyword\">try</span>:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> Snippet.objects.get(pk=pk)</span><br><span class=\"line\">        <span class=\"keyword\">except</span> Snippet.DoesNotExist:</span><br><span class=\"line\">            <span class=\"keyword\">raise</span> Http404</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get</span><span class=\"params\">(self, request, pk, format=None)</span>:</span></span><br><span class=\"line\">        snippet = self.get_object(pk)</span><br><span class=\"line\">        serializer = SnippetSerializer(snippet)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> Response(serializer.data)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">put</span><span class=\"params\">(self, request, pk, format=None)</span>:</span></span><br><span class=\"line\">        snippet = self.get_object(pk)</span><br><span class=\"line\">        serializer = SnippetSerializer(snippet, data=request.data)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> serializer.is_valid():</span><br><span class=\"line\">            serializer.save()</span><br><span class=\"line\">            <span class=\"keyword\">return</span> Response(serializer.data)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> Response(serializer.errors, status=status.HTTP_400_BAD_REQUEST)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">delete</span><span class=\"params\">(self, request, pk, format=None)</span>:</span></span><br><span class=\"line\">        snippet = self.get_object(pk)</span><br><span class=\"line\">        snippet.delete()</span><br><span class=\"line\">        <span class=\"keyword\">return</span> Response(status=status.HTTP_204_NO_CONTENT)</span><br></pre></td></tr></table></figure>\n<p>这看起来很好嘛。但是看起来还是和之前差不太多，继续重构urls.py,更好的支持基于类的视图。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> django.conf.urls <span class=\"keyword\">import</span> url</span><br><span class=\"line\"><span class=\"keyword\">from</span> rest_framework.urlpatterns <span class=\"keyword\">import</span> format_suffix_patterns</span><br><span class=\"line\"><span class=\"keyword\">from</span> snippets <span class=\"keyword\">import</span> views</span><br><span class=\"line\"></span><br><span class=\"line\">urlpatterns = [</span><br><span class=\"line\">    url(<span class=\"string\">r'^snippets/$'</span>, views.SnippetList.as_view()),</span><br><span class=\"line\">    url(<span class=\"string\">r'^snippets/(?P&lt;pk&gt;[0-9]+)/$'</span>, views.SnippetDetail.as_view()),</span><br><span class=\"line\">]</span><br><span class=\"line\"></span><br><span class=\"line\">urlpatterns = format_suffix_patterns(urlpatterns)</span><br></pre></td></tr></table></figure>\n<p>哇，好了。打开开发服务器，一切都将和之前一样的运转。</p>\n<h4 id=\"使用mixins（Use-mixins）\"><a href=\"#使用mixins（Use-mixins）\" class=\"headerlink\" title=\"使用mixins（Use mixins）\"></a>使用mixins（Use mixins）</h4><p>使用基于类的视图的一大好处就是允许我们能够容易的组织可重用的行为。</p>\n<p>create/retrieve/updae/delete操作，在我们创建的支持模型的视图中都区别不大。这些行为都已经在REST framework中通过mixins很好的实现了。</p>\n<p>来看看使用mixin类如何组织我们的视图，同样是更改views.py</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> snippets.models <span class=\"keyword\">import</span> Snippet</span><br><span class=\"line\"><span class=\"keyword\">from</span> snippets.serializers <span class=\"keyword\">import</span> SnippetSerializer</span><br><span class=\"line\"><span class=\"keyword\">from</span> rest_framework <span class=\"keyword\">import</span> mixins</span><br><span class=\"line\"><span class=\"keyword\">from</span> rest_framework <span class=\"keyword\">import</span> generics</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SnippetList</span><span class=\"params\">(mixins.ListModelMixin,</span></span></span><br><span class=\"line\"><span class=\"class\"><span class=\"params\">                  mixins.CreateModelMixin,</span></span></span><br><span class=\"line\"><span class=\"class\"><span class=\"params\">                  generics.GenericAPIView)</span>:</span></span><br><span class=\"line\">    queryset = Snippet.objects.all()</span><br><span class=\"line\">    serializer_class = SnippetSerializer</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get</span><span class=\"params\">(self, request, *args, **kwargs)</span>:</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> self.list(request, *args, **kwargs)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">post</span><span class=\"params\">(self, request, *args, **kwargs)</span>:</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> self.create(request, *args, **kwargs)</span><br></pre></td></tr></table></figure>\n<p>我们花点时间来仔细的研究一下这里边到底都发生了什么。我们使用GenericAPIView,添加进了ListModelMixin和CreateModelMixin。</p>\n<p>基类提供了核心的方法，mixin类提供了.list()和.create()行为。我们可以明确的绑定get和post方法在不同的行为上。非常简单，还够用。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SnippetDetail</span><span class=\"params\">(mixins.RetrieveModelMixin,</span></span></span><br><span class=\"line\"><span class=\"class\"><span class=\"params\">                    mixins.UpdateModelMixin,</span></span></span><br><span class=\"line\"><span class=\"class\"><span class=\"params\">                    mixins.DestroyModelMixin,</span></span></span><br><span class=\"line\"><span class=\"class\"><span class=\"params\">                    generics.GenericAPIView)</span>:</span></span><br><span class=\"line\">    queryset = Snippet.objects.all()</span><br><span class=\"line\">    serializer_class = SnippetSerializer</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get</span><span class=\"params\">(self, request, *args, **kwargs)</span>:</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> self.retrieve(request, *args, **kwargs)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">put</span><span class=\"params\">(self, request, *args, **kwargs)</span>:</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> self.update(request, *args, **kwargs)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">delete</span><span class=\"params\">(self, request, *args, **kwargs)</span>:</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> self.destroy(request, *args, **kwargs)</span><br></pre></td></tr></table></figure>\n<p>很相似，我们再次用GenericAPIView类提供关键方法，minxins提供了.retrieve(),.update(),.destroy()操作。</p>\n<h4 id=\"使用基于generic-class的视图\"><a href=\"#使用基于generic-class的视图\" class=\"headerlink\" title=\"使用基于generic class的视图\"></a>使用基于generic class的视图</h4><p>使用基于mixins的视图已经帮我们减少了代码，还可以再省一点。REST framework提供了一整套mixed-in geric的视图。我们再次为views.py瘦身一下。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> snippets.models <span class=\"keyword\">import</span> Snippet</span><br><span class=\"line\"><span class=\"keyword\">from</span> snippets.serializers <span class=\"keyword\">import</span> SnippetSerializer</span><br><span class=\"line\"><span class=\"keyword\">from</span> rest_framework <span class=\"keyword\">import</span> generics</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SnippetList</span><span class=\"params\">(generics.ListCreateAPIView)</span>:</span></span><br><span class=\"line\">    queryset = Snippet.objects.all()</span><br><span class=\"line\">    serializer_class = SnippetSerializer</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SnippetDetail</span><span class=\"params\">(generics.RetrieveUpdateDestroyAPIView)</span>:</span></span><br><span class=\"line\">    queryset = Snippet.objects.all()</span><br><span class=\"line\">    serializer_class = SnippetSerializer</span><br></pre></td></tr></table></figure>\n<p>哇塞，这也太简洁了。这很Django！</p>\n","site":{"data":{}},"excerpt":"<h3 id=\"DjangoRESTframework-基于类的视图（Class-based-Views）\"><a href=\"#DjangoRESTframework-基于类的视图（Class-based-Views）\" class=\"headerlink\" title=\"DjangoRESTframework    基于类的视图（Class-based Views）\"></a>DjangoRESTframework    基于类的视图（Class-based Views）</h3><p>我们也能够使用基于类的视图来替代基于方法的视图。让我们来看看这个强大的模式，让我们重用许多基本方法，帮助我们保持代码的DRY(Don’t Repeat Yourself)。</p>","more":"<h4 id=\"利用基于类的视图重写我们的API\"><a href=\"#利用基于类的视图重写我们的API\" class=\"headerlink\" title=\"利用基于类的视图重写我们的API\"></a>利用基于类的视图重写我们的API</h4><p>我们将使用基于类的视图来重写咱们的视图，这个需要重构一下views.py了</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> snippets.models <span class=\"keyword\">import</span> Snippet</span><br><span class=\"line\"><span class=\"keyword\">from</span> snippets.serializers <span class=\"keyword\">import</span> SnippetSerializer</span><br><span class=\"line\"><span class=\"keyword\">from</span> django.http <span class=\"keyword\">import</span> Http404</span><br><span class=\"line\"><span class=\"keyword\">from</span> rest_framework.views <span class=\"keyword\">import</span> APIView</span><br><span class=\"line\"><span class=\"keyword\">from</span> rest_framework.response <span class=\"keyword\">import</span> Response</span><br><span class=\"line\"><span class=\"keyword\">from</span> rest_framework <span class=\"keyword\">import</span> status</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SnippetList</span><span class=\"params\">(APIView)</span>:</span></span><br><span class=\"line\">    <span class=\"string\">\"\"\"</span></span><br><span class=\"line\"><span class=\"string\">    List all snippets, or create a new snippet.</span></span><br><span class=\"line\"><span class=\"string\">    \"\"\"</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get</span><span class=\"params\">(self, request, format=None)</span>:</span></span><br><span class=\"line\">        snippets = Snippet.objects.all()</span><br><span class=\"line\">        serializer = SnippetSerializer(snippets, many=<span class=\"keyword\">True</span>)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> Response(serializer.data)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">post</span><span class=\"params\">(self, request, format=None)</span>:</span></span><br><span class=\"line\">        serializer = SnippetSerializer(data=request.data)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> serializer.is_valid():</span><br><span class=\"line\">            serializer.save()</span><br><span class=\"line\">            <span class=\"keyword\">return</span> Response(serializer.data, status=status.HTTP_201_CREATED)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> Response(serializer.errors, status=status.HTTP_400_BAD_REQUEST)</span><br></pre></td></tr></table></figure>\n<p>到目前为止，它看起来和我们之前写的非常相似，但是我们已经很好的分离了不同的HTTP请求方法，继续改。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SnippetDetail</span><span class=\"params\">(APIView)</span>:</span></span><br><span class=\"line\">    <span class=\"string\">\"\"\"</span></span><br><span class=\"line\"><span class=\"string\">    Retrieve, update or delete a snippet instance.</span></span><br><span class=\"line\"><span class=\"string\">    \"\"\"</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_object</span><span class=\"params\">(self, pk)</span>:</span></span><br><span class=\"line\">        <span class=\"keyword\">try</span>:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> Snippet.objects.get(pk=pk)</span><br><span class=\"line\">        <span class=\"keyword\">except</span> Snippet.DoesNotExist:</span><br><span class=\"line\">            <span class=\"keyword\">raise</span> Http404</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get</span><span class=\"params\">(self, request, pk, format=None)</span>:</span></span><br><span class=\"line\">        snippet = self.get_object(pk)</span><br><span class=\"line\">        serializer = SnippetSerializer(snippet)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> Response(serializer.data)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">put</span><span class=\"params\">(self, request, pk, format=None)</span>:</span></span><br><span class=\"line\">        snippet = self.get_object(pk)</span><br><span class=\"line\">        serializer = SnippetSerializer(snippet, data=request.data)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> serializer.is_valid():</span><br><span class=\"line\">            serializer.save()</span><br><span class=\"line\">            <span class=\"keyword\">return</span> Response(serializer.data)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> Response(serializer.errors, status=status.HTTP_400_BAD_REQUEST)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">delete</span><span class=\"params\">(self, request, pk, format=None)</span>:</span></span><br><span class=\"line\">        snippet = self.get_object(pk)</span><br><span class=\"line\">        snippet.delete()</span><br><span class=\"line\">        <span class=\"keyword\">return</span> Response(status=status.HTTP_204_NO_CONTENT)</span><br></pre></td></tr></table></figure>\n<p>这看起来很好嘛。但是看起来还是和之前差不太多，继续重构urls.py,更好的支持基于类的视图。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> django.conf.urls <span class=\"keyword\">import</span> url</span><br><span class=\"line\"><span class=\"keyword\">from</span> rest_framework.urlpatterns <span class=\"keyword\">import</span> format_suffix_patterns</span><br><span class=\"line\"><span class=\"keyword\">from</span> snippets <span class=\"keyword\">import</span> views</span><br><span class=\"line\"></span><br><span class=\"line\">urlpatterns = [</span><br><span class=\"line\">    url(<span class=\"string\">r'^snippets/$'</span>, views.SnippetList.as_view()),</span><br><span class=\"line\">    url(<span class=\"string\">r'^snippets/(?P&lt;pk&gt;[0-9]+)/$'</span>, views.SnippetDetail.as_view()),</span><br><span class=\"line\">]</span><br><span class=\"line\"></span><br><span class=\"line\">urlpatterns = format_suffix_patterns(urlpatterns)</span><br></pre></td></tr></table></figure>\n<p>哇，好了。打开开发服务器，一切都将和之前一样的运转。</p>\n<h4 id=\"使用mixins（Use-mixins）\"><a href=\"#使用mixins（Use-mixins）\" class=\"headerlink\" title=\"使用mixins（Use mixins）\"></a>使用mixins（Use mixins）</h4><p>使用基于类的视图的一大好处就是允许我们能够容易的组织可重用的行为。</p>\n<p>create/retrieve/updae/delete操作，在我们创建的支持模型的视图中都区别不大。这些行为都已经在REST framework中通过mixins很好的实现了。</p>\n<p>来看看使用mixin类如何组织我们的视图，同样是更改views.py</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> snippets.models <span class=\"keyword\">import</span> Snippet</span><br><span class=\"line\"><span class=\"keyword\">from</span> snippets.serializers <span class=\"keyword\">import</span> SnippetSerializer</span><br><span class=\"line\"><span class=\"keyword\">from</span> rest_framework <span class=\"keyword\">import</span> mixins</span><br><span class=\"line\"><span class=\"keyword\">from</span> rest_framework <span class=\"keyword\">import</span> generics</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SnippetList</span><span class=\"params\">(mixins.ListModelMixin,</span></span></span><br><span class=\"line\"><span class=\"class\"><span class=\"params\">                  mixins.CreateModelMixin,</span></span></span><br><span class=\"line\"><span class=\"class\"><span class=\"params\">                  generics.GenericAPIView)</span>:</span></span><br><span class=\"line\">    queryset = Snippet.objects.all()</span><br><span class=\"line\">    serializer_class = SnippetSerializer</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get</span><span class=\"params\">(self, request, *args, **kwargs)</span>:</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> self.list(request, *args, **kwargs)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">post</span><span class=\"params\">(self, request, *args, **kwargs)</span>:</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> self.create(request, *args, **kwargs)</span><br></pre></td></tr></table></figure>\n<p>我们花点时间来仔细的研究一下这里边到底都发生了什么。我们使用GenericAPIView,添加进了ListModelMixin和CreateModelMixin。</p>\n<p>基类提供了核心的方法，mixin类提供了.list()和.create()行为。我们可以明确的绑定get和post方法在不同的行为上。非常简单，还够用。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SnippetDetail</span><span class=\"params\">(mixins.RetrieveModelMixin,</span></span></span><br><span class=\"line\"><span class=\"class\"><span class=\"params\">                    mixins.UpdateModelMixin,</span></span></span><br><span class=\"line\"><span class=\"class\"><span class=\"params\">                    mixins.DestroyModelMixin,</span></span></span><br><span class=\"line\"><span class=\"class\"><span class=\"params\">                    generics.GenericAPIView)</span>:</span></span><br><span class=\"line\">    queryset = Snippet.objects.all()</span><br><span class=\"line\">    serializer_class = SnippetSerializer</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get</span><span class=\"params\">(self, request, *args, **kwargs)</span>:</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> self.retrieve(request, *args, **kwargs)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">put</span><span class=\"params\">(self, request, *args, **kwargs)</span>:</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> self.update(request, *args, **kwargs)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">delete</span><span class=\"params\">(self, request, *args, **kwargs)</span>:</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> self.destroy(request, *args, **kwargs)</span><br></pre></td></tr></table></figure>\n<p>很相似，我们再次用GenericAPIView类提供关键方法，minxins提供了.retrieve(),.update(),.destroy()操作。</p>\n<h4 id=\"使用基于generic-class的视图\"><a href=\"#使用基于generic-class的视图\" class=\"headerlink\" title=\"使用基于generic class的视图\"></a>使用基于generic class的视图</h4><p>使用基于mixins的视图已经帮我们减少了代码，还可以再省一点。REST framework提供了一整套mixed-in geric的视图。我们再次为views.py瘦身一下。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> snippets.models <span class=\"keyword\">import</span> Snippet</span><br><span class=\"line\"><span class=\"keyword\">from</span> snippets.serializers <span class=\"keyword\">import</span> SnippetSerializer</span><br><span class=\"line\"><span class=\"keyword\">from</span> rest_framework <span class=\"keyword\">import</span> generics</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SnippetList</span><span class=\"params\">(generics.ListCreateAPIView)</span>:</span></span><br><span class=\"line\">    queryset = Snippet.objects.all()</span><br><span class=\"line\">    serializer_class = SnippetSerializer</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SnippetDetail</span><span class=\"params\">(generics.RetrieveUpdateDestroyAPIView)</span>:</span></span><br><span class=\"line\">    queryset = Snippet.objects.all()</span><br><span class=\"line\">    serializer_class = SnippetSerializer</span><br></pre></td></tr></table></figure>\n<p>哇塞，这也太简洁了。这很Django！</p>"},{"title":"DjangoRESTframework-序列化（Serializetion）","date":"2017-10-10T06:55:21.000Z","_content":"\n### DjangoRESTframework --------序列化（Serializetion）\n\n#### 简介\n\n这个教程将建立一个简单的Web API代码片段。通过这个例子将想你介绍众多的REST framework的特性，以及让你深入理解每个组件是怎么组合在一起运行的。\n\n那就开始吧！\n\n<!--more-->\n\n#### 建立一个新的环境\n\n载我们开始干活之前我们需要使用virtualenv建立一个新的环境，它能够确保我们的包的配置能够很好的和我们正在开发的其他项目保持很好的隔离。\n\n```shell\nvirtualenv env\nsource env/bin/activeate  #windows:env/scripts/activate.bat\n```\n\n之后，我们进入到virtualenv环境，我们安装我们需要的package包。\n\n```shell\npip install django\npip install djangorestframework\npip install pygments #这个用来实现代码高亮\n```\n\n小纸条：如果需要退出virtualenv环境，只需要输入deactivate即可。\n\n#### 开始编码\n\n现在可以开始编码了，在开始工作之前，首先建立一个新的工程先。\n\n```shell\ncd ~\ndjango-admin startproject tutorial\ncd tutorial\n```\n\n工程建立好之后，我们就可以创建一个新的app，我们将使用这个app来建立所需的Web API。\n\n```shell\npython manage.py startapp snippets\n```\n\n我们需要添加新的的snippets app，将rest_framework注册到INSTALLED_APPS。这些操作需要编辑tutorial/settings.py这个文件：\n\n```python\nINSTALLED_APPS = (\n    ...\n    'rest_framework',\n    'snippets.apps.SnippetsConfig',\n)\n```\n\n请注意，如果你使用Django的版本小于1.9，你需要将snippets.app.SnippetsConfig替换为snippets。Let's go on.\n\n#### 创建一个下一步工作所需的model\n\n为了这个教程能够继续下去，我们需要创建一个简单的Snippet model，它用来存储snippets的代码。编辑文件snippets/models.py。注意：添加注释是一个良好的编程习惯。\n\n```python\nfrom django.db import models\nfrom pygments.lexers import get_all_lexers\nfrom pygments.styles import get_all_styles\n\nLEXERS = [item for item in get_all_lexers() if item[1]]\nLANGUAGE_CHOICES = sorted([(item[1][0], item[0]) for item in LEXERS])\nSTYLE_CHOICES = sorted((item, item) for item in get_all_styles())\n\n\nclass Snippet(models.Model):\n    created = models.DateTimeField(auto_now_add=True)\n    title = models.CharField(max_length=100, blank=True, default='')\n    code = models.TextField()\n    linenos = models.BooleanField(default=False)\n    language = models.CharField(choices=LANGUAGE_CHOICES, default='python', max_length=100)\n    style = models.CharField(choices=STYLE_CHOICES, default='friendly', max_length=100)\n\n    class Meta:\n        ordering = ('created',)\n```\n\n我们也需要创建一个用于初始化迁移我们的model，同时在第一次需要同步数据库。\n\n```python\npython manage.py makemigrations snippets\npython manage.py migrate\n```\n\n#### 创建Serializer类\n\n要实现我们的Web API，第一件需要做的事情是提供一个可以序列化和反序列化的snippets实例，比如用json来表示。我们可以定义serializers，它和Django的forms非常类似。在snippets目录中新建一个名为serializers.py的文件，文件内容如下：\n\n```python\nfrom rest_framework import serializers\nfrom snippets.models import Snippet, LANGUAGE_CHOICES, STYLE_CHOICES\n\n\nclass SnippetSerializer(serializers.Serializer):\n    id = serializers.IntegerField(read_only=True)\n    title = serializers.CharField(required=False, allow_blank=True, max_length=100)\n    code = serializers.CharField(style={'base_template': 'textarea.html'})\n    linenos = serializers.BooleanField(required=False)\n    language = serializers.ChoiceField(choices=LANGUAGE_CHOICES, default='python')\n    style = serializers.ChoiceField(choices=STYLE_CHOICES, default='friendly')\n\n    def create(self, validated_data):\n        \"\"\"\n        Create and return a new `Snippet` instance, given the validated data.\n        \"\"\"\n        return Snippet.objects.create(**validated_data)\n\n    def update(self, instance, validated_data):\n        \"\"\"\n        Update and return an existing `Snippet` instance, given the validated data.\n        \"\"\"\n        instance.title = validated_data.get('title', instance.title)\n        instance.code = validated_data.get('code', instance.code)\n        instance.linenos = validated_data.get('linenos', instance.linenos)\n        instance.language = validated_data.get('language', instance.language)\n        instance.style = validated_data.get('style', instance.style)\n        instance.save()\n        return instance\n```\n\nserializer类的第一部分定义了需要序列化和反序列化的成员变量，create()方法和update()方法定义了如何在调用serializer.save()方法时如何创建和修改实例。\n\nserializer类和Django的form类非常类似，都包含了类似的数据有效性验证机制和丰富的方法，比如required，max_length,default。\n\n数据域的标志能够控制serializer如何在特定的情况下显示，比如当在html页面中渲染{'base_template': ‘textarea.html’}，以上的标签等价于在Django的form类中的widget=widget.Textarea。这个在控制如何展示可视化API的过程中非常有用。接下来的的教程中我们将会体会到。\n\n实际上我们可以使用ModelSerializer来节约时间，这个之后会用到，当然我们需要确保我们的serializer的定义是明确的。\n\n#### 使用Serializers\n\n在继续接下来的工作之前，我们需要进入到Django shell中。\n\n```shell\npython manage.py shell\n```\n\n好了，我们需要引入一些内容，并创建一些代码片段去处理它。\n\n```python\nfrom snippets.models import Snippet\nfrom snippets.serializers import SnippetSerializer\nfrom rest_framework.renderers import JSONRenderer\nfrom rest_framework.parsers import JSONParser\n\nsnippet = Snippet(code='foo = \"bar\"\\n')\nsnippet.save()\n\nsnippet = Snippet(code='print \"hello, world\"\\n')\nsnippet.save()\n```\n\n我们已经有了一些snippets实例，让我们看看将它们序列化之后的样子吧。\n\n```python\nserializer = SnippetSerializer(snippet)\nserializer.data\n# {'id': 2, 'title': u'', 'code': u'print \"hello, world\"\\n', 'linenos': False, 'language': u'python', 'style': u'friendly'}\n```\n\n这里，我们已经将model实例转换成了Python的原生数据类型，为了最终序列化结果，我们将数据转换成json格式。\n\n```python\ncontent = JSONRenderer().render(serializer.data)\ncontent\n# '{\"id\": 2, \"title\": \"\", \"code\": \"print \\\\\"hello, world\\\\\"\\\\n\", \"linenos\": false, \"language\": \"python\", \"style\": \"friendly\"}'\n```\n\n反序列化也是类似的，首先我们将Python原生数据类型转换成一个stream\n\n```python\nfrom django.utils.six import BytesIO\n\nstream = BytesIO(content)\ndata = JSONParser().parse(stream)\n```\n\n然后我们将装换成原生数据类型的model实例重新序列化为一个Python object实例。\n\n```python\nserializer = SnippetSerializer(data=data)\nserializer.is_valid()\n# True\nserializer.validated_data\n# OrderedDict([('title', ''), ('code', 'print \"hello, world\"\\n'), ('linenos', False), ('language', 'python'), ('style', 'friendly')])\nserializer.save()\n# <Snippet: Snippet object>\n```\n\n注意：这个API和Django forms非常类似。它们的相似性在我们开始写视图的时候将变得更加明显。\n\n我们也可以序列化查询的数据集，只需要在序列化方法中添加many=True参数即可。\n\n```python\nserializer = SnippetSerializer(Snippet.objects.all(), many=True)\nserializer.data\n# [OrderedDict([('id', 1), ('title', u''), ('code', u'foo = \"bar\"\\n'), ('linenos', False), ('language', 'python'), ('style', 'friendly')]), OrderedDict([('id', 2), ('title', u''), ('code', u'print \"hello, world\"\\n'), ('linenos', False), ('language', 'python'), ('style', 'friendly')]), OrderedDict([('id', 3), ('title', u''), ('code', u'print \"hello, world\"'), ('linenos', False), ('language', 'python'), ('style', 'friendly')])]\n```\n\n#### 使用ModelSerializers\n\n我们的SnippetSerializer类已经包含了Snippet这个model中的非常多的信息。它能够让我们的代码显得更加的简洁。\n\n同样的，Django也提供了form类和ModelForm类，REST framework提供了Serializer类和ModelSerializer类。\n\n接下来让我们用ModelSerializer类来重构一下我们的API，打开文件snippets/serializers.py，将SnippetSerializer类替换成下面的样子：\n\n```python\nclass SnippetSerializer(serializers.ModelSerializer):\n    class Meta:\n        model = Snippet\n        fields = ('id', 'title', 'code', 'linenos', 'language', 'style')\n```\n\n一个好的serializer的特点就是你能够在serializer实例中检查所有的数据成员，如果要打印数据表现，使用Django shell  :python manage.py shell\n\n```python\nfrom snippets.serializers import SnippetSerializer\nserializer = SnippetSerializer()\nprint(repr(serializer))\n# SnippetSerializer():\n#    id = IntegerField(label='ID', read_only=True)\n#    title = CharField(allow_blank=True, max_length=100, required=False)\n#    code = CharField(style={'base_template': 'textarea.html'})\n#    linenos = BooleanField(required=False)\n#    language = ChoiceField(choices=[('Clipper', 'FoxPro'), ('Cucumber', 'Gherkin'), ('RobotFramework', 'RobotFramework'), ('abap', 'ABAP'), ('ada', 'Ada')...\n#    style = ChoiceField(choices=[('autumn', 'autumn'), ('borland', 'borland'), ('bw', 'bw'), ('colorful', 'colorful')...\n```\n\n使用ModelSerializer类需要记住的重要的一点就是不要做特别的操作，它知识简单的创建一个序列化类：\n\n- 自动识别字段\n\n- 简单的实现默认的create()方法和update()方法。\n\n#### 使用Serializer来编写Django views\n\n让我们来尝试用新的serializer类来写一些API视图。这里，我们不会使用任何REST framework的其他特性，我们仅仅写点views来作为传统的Django views。编辑文件snippets/views.py，文件内容如下：\n\n```python\nfrom django.http import HttpResponse, JsonResponse\nfrom django.views.decorators.csrf import csrf_exempt\nfrom rest_framework.renderers import JSONRenderer\nfrom rest_framework.parsers import JSONParser\nfrom snippets.models import Snippet\nfrom snippets.serializers import SnippetSerializer\n```\n\n访问我们的API的根路径能够列出当前存在的snippets或者创建一个新的snippets。\n\n```python\n@csrf_exempt\ndef snippet_list(request):\n    \"\"\"\n    List all code snippets, or create a new snippet.\n    \"\"\"\n    if request.method == 'GET':\n        snippets = Snippet.objects.all()\n        serializer = SnippetSerializer(snippets, many=True)\n        return JsonResponse(serializer.data, safe=False)\n\n    elif request.method == 'POST':\n        data = JSONParser().parse(request)\n        serializer = SnippetSerializer(data=data)\n        if serializer.is_valid():\n            serializer.save()\n            return JsonResponse(serializer.data, status=201)\n        return JsonResponse(serializer.errors, status=400)\n```\n\n注意，因为我们希望允许POST视图中的from表单，但是客户端不存在csrf token，我们需要添加注解csrf_exempt。这不是你平常需要做的，REST framework 的views能够控制敏感操作，这里的目的不是研究它。\n\n我们也需要一个view来确保snippet的独立性，并且用来获取、更新和删除snippet。\n\n```python\n@csrf_exempt\ndef snippet_detail(request, pk):\n    \"\"\"\n    Retrieve, update or delete a code snippet.\n    \"\"\"\n    try:\n        snippet = Snippet.objects.get(pk=pk)\n    except Snippet.DoesNotExist:\n        return HttpResponse(status=404)\n\n    if request.method == 'GET':\n        serializer = SnippetSerializer(snippet)\n        return JsonResponse(serializer.data)\n\n    elif request.method == 'PUT':\n        data = JSONParser().parse(request)\n        serializer = SnippetSerializer(snippet, data=data)\n        if serializer.is_valid():\n            serializer.save()\n            return JsonResponse(serializer.data)\n        return JsonResponse(serializer.errors, status=400)\n\n    elif request.method == 'DELETE':\n        snippet.delete()\n        return HttpResponse(status=204)\n```\n\n最后，我们需要将这些view展示出来，创建一个文件snippets/urls.py:\n\n```python\nfrom django.conf.urls import url\nfrom snippets import views\n\nurlpatterns = [\n    url(r'^snippets/$', views.snippet_list),\n    url(r'^snippets/(?P<pk>[0-9]+)/$', views.snippet_detail),\n]\n```\n\n我们还需要编辑应用根路径下的urls.py文件，用以配置app所需的url\n\n```python\nfrom django.conf.urls import url, include\n\nurlpatterns = [\n    url(r'^', include('snippets.urls')),\n]\n```\n\n需要注意的是，这里还有一些小问题我们没有进行处理。如果我们发送的是json格式的数据，或者请求没有被适当的view处理，服务器将会反悔500“server error”错误。\n\n#### 测试我们的第一个Web API\n\n首先要开启测试服务器，先退出Django shell\n\n```python\nquit()\n```\n\n开启测试服务器：\n\n```python\npython manage.py runserver\n\nValidating models...\n\n0 errors found\nDjango version 1.11, using settings 'tutorial.settings'\nDevelopment server is running at http://127.0.0.1:8000/\nQuit the server with CONTROL-C.\n```\n\n\n\n测试API我们可以使用curl或者httpie。httpie是使用python编写的工具，当然安装它也很简单：\n\n```shell\npip install httpie\n```\n\n如果pip安装不上的话，还可以上使用easy_intall尝试一下：\n\n```shell\neasy_install httpie\n```\n\n使用httppie测试结果如下：\n\n```python\nPS E:\\Study\\Serializer_tutorial\\tutorial> http http://127.0.0.1:8000/snippets/\nHTTP/1.0 200 OK\nContent-Length: 354\nContent-Type: application/json\nDate: Tue, 10 Oct 2017 06:46:43 GMT\nServer: WSGIServer/0.1 Python/2.7.13\nX-Frame-Options: SAMEORIGIN\n\n[\n    {\n        \"code\": \"foo = \\\"bar\\\"\\n\",\n        \"id\": 1,\n        \"language\": \"python\",\n        \"linenos\": false,\n        \"style\": \"friendly\",\n        \"title\": \"\"\n    },\n    {\n        \"code\": \"print \\\"hello, world\\n\\\"\",\n        \"id\": 2,\n        \"language\": \"python\",\n        \"linenos\": false,\n        \"style\": \"friendly\",\n        \"title\": \"\"\n    },\n    {\n        \"code\": \"print \\\"hello, world\\n\\\"\",\n        \"id\": 3,\n        \"language\": \"python\",\n        \"linenos\": false,\n        \"style\": \"friendly\",\n        \"title\": \"\"\n    }\n]\n\n```\n\n\n\n当然，使用浏览器直接查看这个API也是可以的。浏览器的效果：\n\n![image](/blogimg/rest-ser-1.png)\n![image](/blogimg/rest-ser-2.png)\n\n翻译自：http://www.django-rest-framework.org/tutorial/1-serialization/","source":"_posts/DjangoRESTframework-serializetion.md","raw":"---\ntitle: DjangoRESTframework-序列化（Serializetion）\ncategories:\n  - Program\ntags:\n  - Django djangorestframework\ndate: 2017-10-10 14:55:21\n---\n\n### DjangoRESTframework --------序列化（Serializetion）\n\n#### 简介\n\n这个教程将建立一个简单的Web API代码片段。通过这个例子将想你介绍众多的REST framework的特性，以及让你深入理解每个组件是怎么组合在一起运行的。\n\n那就开始吧！\n\n<!--more-->\n\n#### 建立一个新的环境\n\n载我们开始干活之前我们需要使用virtualenv建立一个新的环境，它能够确保我们的包的配置能够很好的和我们正在开发的其他项目保持很好的隔离。\n\n```shell\nvirtualenv env\nsource env/bin/activeate  #windows:env/scripts/activate.bat\n```\n\n之后，我们进入到virtualenv环境，我们安装我们需要的package包。\n\n```shell\npip install django\npip install djangorestframework\npip install pygments #这个用来实现代码高亮\n```\n\n小纸条：如果需要退出virtualenv环境，只需要输入deactivate即可。\n\n#### 开始编码\n\n现在可以开始编码了，在开始工作之前，首先建立一个新的工程先。\n\n```shell\ncd ~\ndjango-admin startproject tutorial\ncd tutorial\n```\n\n工程建立好之后，我们就可以创建一个新的app，我们将使用这个app来建立所需的Web API。\n\n```shell\npython manage.py startapp snippets\n```\n\n我们需要添加新的的snippets app，将rest_framework注册到INSTALLED_APPS。这些操作需要编辑tutorial/settings.py这个文件：\n\n```python\nINSTALLED_APPS = (\n    ...\n    'rest_framework',\n    'snippets.apps.SnippetsConfig',\n)\n```\n\n请注意，如果你使用Django的版本小于1.9，你需要将snippets.app.SnippetsConfig替换为snippets。Let's go on.\n\n#### 创建一个下一步工作所需的model\n\n为了这个教程能够继续下去，我们需要创建一个简单的Snippet model，它用来存储snippets的代码。编辑文件snippets/models.py。注意：添加注释是一个良好的编程习惯。\n\n```python\nfrom django.db import models\nfrom pygments.lexers import get_all_lexers\nfrom pygments.styles import get_all_styles\n\nLEXERS = [item for item in get_all_lexers() if item[1]]\nLANGUAGE_CHOICES = sorted([(item[1][0], item[0]) for item in LEXERS])\nSTYLE_CHOICES = sorted((item, item) for item in get_all_styles())\n\n\nclass Snippet(models.Model):\n    created = models.DateTimeField(auto_now_add=True)\n    title = models.CharField(max_length=100, blank=True, default='')\n    code = models.TextField()\n    linenos = models.BooleanField(default=False)\n    language = models.CharField(choices=LANGUAGE_CHOICES, default='python', max_length=100)\n    style = models.CharField(choices=STYLE_CHOICES, default='friendly', max_length=100)\n\n    class Meta:\n        ordering = ('created',)\n```\n\n我们也需要创建一个用于初始化迁移我们的model，同时在第一次需要同步数据库。\n\n```python\npython manage.py makemigrations snippets\npython manage.py migrate\n```\n\n#### 创建Serializer类\n\n要实现我们的Web API，第一件需要做的事情是提供一个可以序列化和反序列化的snippets实例，比如用json来表示。我们可以定义serializers，它和Django的forms非常类似。在snippets目录中新建一个名为serializers.py的文件，文件内容如下：\n\n```python\nfrom rest_framework import serializers\nfrom snippets.models import Snippet, LANGUAGE_CHOICES, STYLE_CHOICES\n\n\nclass SnippetSerializer(serializers.Serializer):\n    id = serializers.IntegerField(read_only=True)\n    title = serializers.CharField(required=False, allow_blank=True, max_length=100)\n    code = serializers.CharField(style={'base_template': 'textarea.html'})\n    linenos = serializers.BooleanField(required=False)\n    language = serializers.ChoiceField(choices=LANGUAGE_CHOICES, default='python')\n    style = serializers.ChoiceField(choices=STYLE_CHOICES, default='friendly')\n\n    def create(self, validated_data):\n        \"\"\"\n        Create and return a new `Snippet` instance, given the validated data.\n        \"\"\"\n        return Snippet.objects.create(**validated_data)\n\n    def update(self, instance, validated_data):\n        \"\"\"\n        Update and return an existing `Snippet` instance, given the validated data.\n        \"\"\"\n        instance.title = validated_data.get('title', instance.title)\n        instance.code = validated_data.get('code', instance.code)\n        instance.linenos = validated_data.get('linenos', instance.linenos)\n        instance.language = validated_data.get('language', instance.language)\n        instance.style = validated_data.get('style', instance.style)\n        instance.save()\n        return instance\n```\n\nserializer类的第一部分定义了需要序列化和反序列化的成员变量，create()方法和update()方法定义了如何在调用serializer.save()方法时如何创建和修改实例。\n\nserializer类和Django的form类非常类似，都包含了类似的数据有效性验证机制和丰富的方法，比如required，max_length,default。\n\n数据域的标志能够控制serializer如何在特定的情况下显示，比如当在html页面中渲染{'base_template': ‘textarea.html’}，以上的标签等价于在Django的form类中的widget=widget.Textarea。这个在控制如何展示可视化API的过程中非常有用。接下来的的教程中我们将会体会到。\n\n实际上我们可以使用ModelSerializer来节约时间，这个之后会用到，当然我们需要确保我们的serializer的定义是明确的。\n\n#### 使用Serializers\n\n在继续接下来的工作之前，我们需要进入到Django shell中。\n\n```shell\npython manage.py shell\n```\n\n好了，我们需要引入一些内容，并创建一些代码片段去处理它。\n\n```python\nfrom snippets.models import Snippet\nfrom snippets.serializers import SnippetSerializer\nfrom rest_framework.renderers import JSONRenderer\nfrom rest_framework.parsers import JSONParser\n\nsnippet = Snippet(code='foo = \"bar\"\\n')\nsnippet.save()\n\nsnippet = Snippet(code='print \"hello, world\"\\n')\nsnippet.save()\n```\n\n我们已经有了一些snippets实例，让我们看看将它们序列化之后的样子吧。\n\n```python\nserializer = SnippetSerializer(snippet)\nserializer.data\n# {'id': 2, 'title': u'', 'code': u'print \"hello, world\"\\n', 'linenos': False, 'language': u'python', 'style': u'friendly'}\n```\n\n这里，我们已经将model实例转换成了Python的原生数据类型，为了最终序列化结果，我们将数据转换成json格式。\n\n```python\ncontent = JSONRenderer().render(serializer.data)\ncontent\n# '{\"id\": 2, \"title\": \"\", \"code\": \"print \\\\\"hello, world\\\\\"\\\\n\", \"linenos\": false, \"language\": \"python\", \"style\": \"friendly\"}'\n```\n\n反序列化也是类似的，首先我们将Python原生数据类型转换成一个stream\n\n```python\nfrom django.utils.six import BytesIO\n\nstream = BytesIO(content)\ndata = JSONParser().parse(stream)\n```\n\n然后我们将装换成原生数据类型的model实例重新序列化为一个Python object实例。\n\n```python\nserializer = SnippetSerializer(data=data)\nserializer.is_valid()\n# True\nserializer.validated_data\n# OrderedDict([('title', ''), ('code', 'print \"hello, world\"\\n'), ('linenos', False), ('language', 'python'), ('style', 'friendly')])\nserializer.save()\n# <Snippet: Snippet object>\n```\n\n注意：这个API和Django forms非常类似。它们的相似性在我们开始写视图的时候将变得更加明显。\n\n我们也可以序列化查询的数据集，只需要在序列化方法中添加many=True参数即可。\n\n```python\nserializer = SnippetSerializer(Snippet.objects.all(), many=True)\nserializer.data\n# [OrderedDict([('id', 1), ('title', u''), ('code', u'foo = \"bar\"\\n'), ('linenos', False), ('language', 'python'), ('style', 'friendly')]), OrderedDict([('id', 2), ('title', u''), ('code', u'print \"hello, world\"\\n'), ('linenos', False), ('language', 'python'), ('style', 'friendly')]), OrderedDict([('id', 3), ('title', u''), ('code', u'print \"hello, world\"'), ('linenos', False), ('language', 'python'), ('style', 'friendly')])]\n```\n\n#### 使用ModelSerializers\n\n我们的SnippetSerializer类已经包含了Snippet这个model中的非常多的信息。它能够让我们的代码显得更加的简洁。\n\n同样的，Django也提供了form类和ModelForm类，REST framework提供了Serializer类和ModelSerializer类。\n\n接下来让我们用ModelSerializer类来重构一下我们的API，打开文件snippets/serializers.py，将SnippetSerializer类替换成下面的样子：\n\n```python\nclass SnippetSerializer(serializers.ModelSerializer):\n    class Meta:\n        model = Snippet\n        fields = ('id', 'title', 'code', 'linenos', 'language', 'style')\n```\n\n一个好的serializer的特点就是你能够在serializer实例中检查所有的数据成员，如果要打印数据表现，使用Django shell  :python manage.py shell\n\n```python\nfrom snippets.serializers import SnippetSerializer\nserializer = SnippetSerializer()\nprint(repr(serializer))\n# SnippetSerializer():\n#    id = IntegerField(label='ID', read_only=True)\n#    title = CharField(allow_blank=True, max_length=100, required=False)\n#    code = CharField(style={'base_template': 'textarea.html'})\n#    linenos = BooleanField(required=False)\n#    language = ChoiceField(choices=[('Clipper', 'FoxPro'), ('Cucumber', 'Gherkin'), ('RobotFramework', 'RobotFramework'), ('abap', 'ABAP'), ('ada', 'Ada')...\n#    style = ChoiceField(choices=[('autumn', 'autumn'), ('borland', 'borland'), ('bw', 'bw'), ('colorful', 'colorful')...\n```\n\n使用ModelSerializer类需要记住的重要的一点就是不要做特别的操作，它知识简单的创建一个序列化类：\n\n- 自动识别字段\n\n- 简单的实现默认的create()方法和update()方法。\n\n#### 使用Serializer来编写Django views\n\n让我们来尝试用新的serializer类来写一些API视图。这里，我们不会使用任何REST framework的其他特性，我们仅仅写点views来作为传统的Django views。编辑文件snippets/views.py，文件内容如下：\n\n```python\nfrom django.http import HttpResponse, JsonResponse\nfrom django.views.decorators.csrf import csrf_exempt\nfrom rest_framework.renderers import JSONRenderer\nfrom rest_framework.parsers import JSONParser\nfrom snippets.models import Snippet\nfrom snippets.serializers import SnippetSerializer\n```\n\n访问我们的API的根路径能够列出当前存在的snippets或者创建一个新的snippets。\n\n```python\n@csrf_exempt\ndef snippet_list(request):\n    \"\"\"\n    List all code snippets, or create a new snippet.\n    \"\"\"\n    if request.method == 'GET':\n        snippets = Snippet.objects.all()\n        serializer = SnippetSerializer(snippets, many=True)\n        return JsonResponse(serializer.data, safe=False)\n\n    elif request.method == 'POST':\n        data = JSONParser().parse(request)\n        serializer = SnippetSerializer(data=data)\n        if serializer.is_valid():\n            serializer.save()\n            return JsonResponse(serializer.data, status=201)\n        return JsonResponse(serializer.errors, status=400)\n```\n\n注意，因为我们希望允许POST视图中的from表单，但是客户端不存在csrf token，我们需要添加注解csrf_exempt。这不是你平常需要做的，REST framework 的views能够控制敏感操作，这里的目的不是研究它。\n\n我们也需要一个view来确保snippet的独立性，并且用来获取、更新和删除snippet。\n\n```python\n@csrf_exempt\ndef snippet_detail(request, pk):\n    \"\"\"\n    Retrieve, update or delete a code snippet.\n    \"\"\"\n    try:\n        snippet = Snippet.objects.get(pk=pk)\n    except Snippet.DoesNotExist:\n        return HttpResponse(status=404)\n\n    if request.method == 'GET':\n        serializer = SnippetSerializer(snippet)\n        return JsonResponse(serializer.data)\n\n    elif request.method == 'PUT':\n        data = JSONParser().parse(request)\n        serializer = SnippetSerializer(snippet, data=data)\n        if serializer.is_valid():\n            serializer.save()\n            return JsonResponse(serializer.data)\n        return JsonResponse(serializer.errors, status=400)\n\n    elif request.method == 'DELETE':\n        snippet.delete()\n        return HttpResponse(status=204)\n```\n\n最后，我们需要将这些view展示出来，创建一个文件snippets/urls.py:\n\n```python\nfrom django.conf.urls import url\nfrom snippets import views\n\nurlpatterns = [\n    url(r'^snippets/$', views.snippet_list),\n    url(r'^snippets/(?P<pk>[0-9]+)/$', views.snippet_detail),\n]\n```\n\n我们还需要编辑应用根路径下的urls.py文件，用以配置app所需的url\n\n```python\nfrom django.conf.urls import url, include\n\nurlpatterns = [\n    url(r'^', include('snippets.urls')),\n]\n```\n\n需要注意的是，这里还有一些小问题我们没有进行处理。如果我们发送的是json格式的数据，或者请求没有被适当的view处理，服务器将会反悔500“server error”错误。\n\n#### 测试我们的第一个Web API\n\n首先要开启测试服务器，先退出Django shell\n\n```python\nquit()\n```\n\n开启测试服务器：\n\n```python\npython manage.py runserver\n\nValidating models...\n\n0 errors found\nDjango version 1.11, using settings 'tutorial.settings'\nDevelopment server is running at http://127.0.0.1:8000/\nQuit the server with CONTROL-C.\n```\n\n\n\n测试API我们可以使用curl或者httpie。httpie是使用python编写的工具，当然安装它也很简单：\n\n```shell\npip install httpie\n```\n\n如果pip安装不上的话，还可以上使用easy_intall尝试一下：\n\n```shell\neasy_install httpie\n```\n\n使用httppie测试结果如下：\n\n```python\nPS E:\\Study\\Serializer_tutorial\\tutorial> http http://127.0.0.1:8000/snippets/\nHTTP/1.0 200 OK\nContent-Length: 354\nContent-Type: application/json\nDate: Tue, 10 Oct 2017 06:46:43 GMT\nServer: WSGIServer/0.1 Python/2.7.13\nX-Frame-Options: SAMEORIGIN\n\n[\n    {\n        \"code\": \"foo = \\\"bar\\\"\\n\",\n        \"id\": 1,\n        \"language\": \"python\",\n        \"linenos\": false,\n        \"style\": \"friendly\",\n        \"title\": \"\"\n    },\n    {\n        \"code\": \"print \\\"hello, world\\n\\\"\",\n        \"id\": 2,\n        \"language\": \"python\",\n        \"linenos\": false,\n        \"style\": \"friendly\",\n        \"title\": \"\"\n    },\n    {\n        \"code\": \"print \\\"hello, world\\n\\\"\",\n        \"id\": 3,\n        \"language\": \"python\",\n        \"linenos\": false,\n        \"style\": \"friendly\",\n        \"title\": \"\"\n    }\n]\n\n```\n\n\n\n当然，使用浏览器直接查看这个API也是可以的。浏览器的效果：\n\n![image](/blogimg/rest-ser-1.png)\n![image](/blogimg/rest-ser-2.png)\n\n翻译自：http://www.django-rest-framework.org/tutorial/1-serialization/","slug":"DjangoRESTframework-serializetion","published":1,"updated":"2017-12-04T07:27:28.755Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjeqig1ld001jlgqauht2h26i","content":"<h3 id=\"DjangoRESTframework-——–序列化（Serializetion）\"><a href=\"#DjangoRESTframework-——–序列化（Serializetion）\" class=\"headerlink\" title=\"DjangoRESTframework ——–序列化（Serializetion）\"></a>DjangoRESTframework ——–序列化（Serializetion）</h3><h4 id=\"简介\"><a href=\"#简介\" class=\"headerlink\" title=\"简介\"></a>简介</h4><p>这个教程将建立一个简单的Web API代码片段。通过这个例子将想你介绍众多的REST framework的特性，以及让你深入理解每个组件是怎么组合在一起运行的。</p>\n<p>那就开始吧！</p>\n<a id=\"more\"></a>\n<h4 id=\"建立一个新的环境\"><a href=\"#建立一个新的环境\" class=\"headerlink\" title=\"建立一个新的环境\"></a>建立一个新的环境</h4><p>载我们开始干活之前我们需要使用virtualenv建立一个新的环境，它能够确保我们的包的配置能够很好的和我们正在开发的其他项目保持很好的隔离。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">virtualenv env</span><br><span class=\"line\">source env/bin/activeate  #windows:env/scripts/activate.bat</span><br></pre></td></tr></table></figure>\n<p>之后，我们进入到virtualenv环境，我们安装我们需要的package包。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip install django</span><br><span class=\"line\">pip install djangorestframework</span><br><span class=\"line\">pip install pygments #这个用来实现代码高亮</span><br></pre></td></tr></table></figure>\n<p>小纸条：如果需要退出virtualenv环境，只需要输入deactivate即可。</p>\n<h4 id=\"开始编码\"><a href=\"#开始编码\" class=\"headerlink\" title=\"开始编码\"></a>开始编码</h4><p>现在可以开始编码了，在开始工作之前，首先建立一个新的工程先。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd ~</span><br><span class=\"line\">django-admin startproject tutorial</span><br><span class=\"line\">cd tutorial</span><br></pre></td></tr></table></figure>\n<p>工程建立好之后，我们就可以创建一个新的app，我们将使用这个app来建立所需的Web API。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">python manage.py startapp snippets</span><br></pre></td></tr></table></figure>\n<p>我们需要添加新的的snippets app，将rest_framework注册到INSTALLED_APPS。这些操作需要编辑tutorial/settings.py这个文件：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">INSTALLED_APPS = (</span><br><span class=\"line\">    ...</span><br><span class=\"line\">    <span class=\"string\">'rest_framework'</span>,</span><br><span class=\"line\">    <span class=\"string\">'snippets.apps.SnippetsConfig'</span>,</span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n<p>请注意，如果你使用Django的版本小于1.9，你需要将snippets.app.SnippetsConfig替换为snippets。Let’s go on.</p>\n<h4 id=\"创建一个下一步工作所需的model\"><a href=\"#创建一个下一步工作所需的model\" class=\"headerlink\" title=\"创建一个下一步工作所需的model\"></a>创建一个下一步工作所需的model</h4><p>为了这个教程能够继续下去，我们需要创建一个简单的Snippet model，它用来存储snippets的代码。编辑文件snippets/models.py。注意：添加注释是一个良好的编程习惯。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> django.db <span class=\"keyword\">import</span> models</span><br><span class=\"line\"><span class=\"keyword\">from</span> pygments.lexers <span class=\"keyword\">import</span> get_all_lexers</span><br><span class=\"line\"><span class=\"keyword\">from</span> pygments.styles <span class=\"keyword\">import</span> get_all_styles</span><br><span class=\"line\"></span><br><span class=\"line\">LEXERS = [item <span class=\"keyword\">for</span> item <span class=\"keyword\">in</span> get_all_lexers() <span class=\"keyword\">if</span> item[<span class=\"number\">1</span>]]</span><br><span class=\"line\">LANGUAGE_CHOICES = sorted([(item[<span class=\"number\">1</span>][<span class=\"number\">0</span>], item[<span class=\"number\">0</span>]) <span class=\"keyword\">for</span> item <span class=\"keyword\">in</span> LEXERS])</span><br><span class=\"line\">STYLE_CHOICES = sorted((item, item) <span class=\"keyword\">for</span> item <span class=\"keyword\">in</span> get_all_styles())</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Snippet</span><span class=\"params\">(models.Model)</span>:</span></span><br><span class=\"line\">    created = models.DateTimeField(auto_now_add=<span class=\"keyword\">True</span>)</span><br><span class=\"line\">    title = models.CharField(max_length=<span class=\"number\">100</span>, blank=<span class=\"keyword\">True</span>, default=<span class=\"string\">''</span>)</span><br><span class=\"line\">    code = models.TextField()</span><br><span class=\"line\">    linenos = models.BooleanField(default=<span class=\"keyword\">False</span>)</span><br><span class=\"line\">    language = models.CharField(choices=LANGUAGE_CHOICES, default=<span class=\"string\">'python'</span>, max_length=<span class=\"number\">100</span>)</span><br><span class=\"line\">    style = models.CharField(choices=STYLE_CHOICES, default=<span class=\"string\">'friendly'</span>, max_length=<span class=\"number\">100</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Meta</span>:</span></span><br><span class=\"line\">        ordering = (<span class=\"string\">'created'</span>,)</span><br></pre></td></tr></table></figure>\n<p>我们也需要创建一个用于初始化迁移我们的model，同时在第一次需要同步数据库。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">python manage.py makemigrations snippets</span><br><span class=\"line\">python manage.py migrate</span><br></pre></td></tr></table></figure>\n<h4 id=\"创建Serializer类\"><a href=\"#创建Serializer类\" class=\"headerlink\" title=\"创建Serializer类\"></a>创建Serializer类</h4><p>要实现我们的Web API，第一件需要做的事情是提供一个可以序列化和反序列化的snippets实例，比如用json来表示。我们可以定义serializers，它和Django的forms非常类似。在snippets目录中新建一个名为serializers.py的文件，文件内容如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> rest_framework <span class=\"keyword\">import</span> serializers</span><br><span class=\"line\"><span class=\"keyword\">from</span> snippets.models <span class=\"keyword\">import</span> Snippet, LANGUAGE_CHOICES, STYLE_CHOICES</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SnippetSerializer</span><span class=\"params\">(serializers.Serializer)</span>:</span></span><br><span class=\"line\">    id = serializers.IntegerField(read_only=<span class=\"keyword\">True</span>)</span><br><span class=\"line\">    title = serializers.CharField(required=<span class=\"keyword\">False</span>, allow_blank=<span class=\"keyword\">True</span>, max_length=<span class=\"number\">100</span>)</span><br><span class=\"line\">    code = serializers.CharField(style=&#123;<span class=\"string\">'base_template'</span>: <span class=\"string\">'textarea.html'</span>&#125;)</span><br><span class=\"line\">    linenos = serializers.BooleanField(required=<span class=\"keyword\">False</span>)</span><br><span class=\"line\">    language = serializers.ChoiceField(choices=LANGUAGE_CHOICES, default=<span class=\"string\">'python'</span>)</span><br><span class=\"line\">    style = serializers.ChoiceField(choices=STYLE_CHOICES, default=<span class=\"string\">'friendly'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">create</span><span class=\"params\">(self, validated_data)</span>:</span></span><br><span class=\"line\">        <span class=\"string\">\"\"\"</span></span><br><span class=\"line\"><span class=\"string\">        Create and return a new `Snippet` instance, given the validated data.</span></span><br><span class=\"line\"><span class=\"string\">        \"\"\"</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> Snippet.objects.create(**validated_data)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">update</span><span class=\"params\">(self, instance, validated_data)</span>:</span></span><br><span class=\"line\">        <span class=\"string\">\"\"\"</span></span><br><span class=\"line\"><span class=\"string\">        Update and return an existing `Snippet` instance, given the validated data.</span></span><br><span class=\"line\"><span class=\"string\">        \"\"\"</span></span><br><span class=\"line\">        instance.title = validated_data.get(<span class=\"string\">'title'</span>, instance.title)</span><br><span class=\"line\">        instance.code = validated_data.get(<span class=\"string\">'code'</span>, instance.code)</span><br><span class=\"line\">        instance.linenos = validated_data.get(<span class=\"string\">'linenos'</span>, instance.linenos)</span><br><span class=\"line\">        instance.language = validated_data.get(<span class=\"string\">'language'</span>, instance.language)</span><br><span class=\"line\">        instance.style = validated_data.get(<span class=\"string\">'style'</span>, instance.style)</span><br><span class=\"line\">        instance.save()</span><br><span class=\"line\">        <span class=\"keyword\">return</span> instance</span><br></pre></td></tr></table></figure>\n<p>serializer类的第一部分定义了需要序列化和反序列化的成员变量，create()方法和update()方法定义了如何在调用serializer.save()方法时如何创建和修改实例。</p>\n<p>serializer类和Django的form类非常类似，都包含了类似的数据有效性验证机制和丰富的方法，比如required，max_length,default。</p>\n<p>数据域的标志能够控制serializer如何在特定的情况下显示，比如当在html页面中渲染{‘base_template’: ‘textarea.html’}，以上的标签等价于在Django的form类中的widget=widget.Textarea。这个在控制如何展示可视化API的过程中非常有用。接下来的的教程中我们将会体会到。</p>\n<p>实际上我们可以使用ModelSerializer来节约时间，这个之后会用到，当然我们需要确保我们的serializer的定义是明确的。</p>\n<h4 id=\"使用Serializers\"><a href=\"#使用Serializers\" class=\"headerlink\" title=\"使用Serializers\"></a>使用Serializers</h4><p>在继续接下来的工作之前，我们需要进入到Django shell中。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">python manage.py shell</span><br></pre></td></tr></table></figure>\n<p>好了，我们需要引入一些内容，并创建一些代码片段去处理它。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> snippets.models <span class=\"keyword\">import</span> Snippet</span><br><span class=\"line\"><span class=\"keyword\">from</span> snippets.serializers <span class=\"keyword\">import</span> SnippetSerializer</span><br><span class=\"line\"><span class=\"keyword\">from</span> rest_framework.renderers <span class=\"keyword\">import</span> JSONRenderer</span><br><span class=\"line\"><span class=\"keyword\">from</span> rest_framework.parsers <span class=\"keyword\">import</span> JSONParser</span><br><span class=\"line\"></span><br><span class=\"line\">snippet = Snippet(code=<span class=\"string\">'foo = \"bar\"\\n'</span>)</span><br><span class=\"line\">snippet.save()</span><br><span class=\"line\"></span><br><span class=\"line\">snippet = Snippet(code=<span class=\"string\">'print \"hello, world\"\\n'</span>)</span><br><span class=\"line\">snippet.save()</span><br></pre></td></tr></table></figure>\n<p>我们已经有了一些snippets实例，让我们看看将它们序列化之后的样子吧。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">serializer = SnippetSerializer(snippet)</span><br><span class=\"line\">serializer.data</span><br><span class=\"line\"><span class=\"comment\"># &#123;'id': 2, 'title': u'', 'code': u'print \"hello, world\"\\n', 'linenos': False, 'language': u'python', 'style': u'friendly'&#125;</span></span><br></pre></td></tr></table></figure>\n<p>这里，我们已经将model实例转换成了Python的原生数据类型，为了最终序列化结果，我们将数据转换成json格式。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">content = JSONRenderer().render(serializer.data)</span><br><span class=\"line\">content</span><br><span class=\"line\"><span class=\"comment\"># '&#123;\"id\": 2, \"title\": \"\", \"code\": \"print \\\\\"hello, world\\\\\"\\\\n\", \"linenos\": false, \"language\": \"python\", \"style\": \"friendly\"&#125;'</span></span><br></pre></td></tr></table></figure>\n<p>反序列化也是类似的，首先我们将Python原生数据类型转换成一个stream</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> django.utils.six <span class=\"keyword\">import</span> BytesIO</span><br><span class=\"line\"></span><br><span class=\"line\">stream = BytesIO(content)</span><br><span class=\"line\">data = JSONParser().parse(stream)</span><br></pre></td></tr></table></figure>\n<p>然后我们将装换成原生数据类型的model实例重新序列化为一个Python object实例。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">serializer = SnippetSerializer(data=data)</span><br><span class=\"line\">serializer.is_valid()</span><br><span class=\"line\"><span class=\"comment\"># True</span></span><br><span class=\"line\">serializer.validated_data</span><br><span class=\"line\"><span class=\"comment\"># OrderedDict([('title', ''), ('code', 'print \"hello, world\"\\n'), ('linenos', False), ('language', 'python'), ('style', 'friendly')])</span></span><br><span class=\"line\">serializer.save()</span><br><span class=\"line\"><span class=\"comment\"># &lt;Snippet: Snippet object&gt;</span></span><br></pre></td></tr></table></figure>\n<p>注意：这个API和Django forms非常类似。它们的相似性在我们开始写视图的时候将变得更加明显。</p>\n<p>我们也可以序列化查询的数据集，只需要在序列化方法中添加many=True参数即可。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">serializer = SnippetSerializer(Snippet.objects.all(), many=<span class=\"keyword\">True</span>)</span><br><span class=\"line\">serializer.data</span><br><span class=\"line\"><span class=\"comment\"># [OrderedDict([('id', 1), ('title', u''), ('code', u'foo = \"bar\"\\n'), ('linenos', False), ('language', 'python'), ('style', 'friendly')]), OrderedDict([('id', 2), ('title', u''), ('code', u'print \"hello, world\"\\n'), ('linenos', False), ('language', 'python'), ('style', 'friendly')]), OrderedDict([('id', 3), ('title', u''), ('code', u'print \"hello, world\"'), ('linenos', False), ('language', 'python'), ('style', 'friendly')])]</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"使用ModelSerializers\"><a href=\"#使用ModelSerializers\" class=\"headerlink\" title=\"使用ModelSerializers\"></a>使用ModelSerializers</h4><p>我们的SnippetSerializer类已经包含了Snippet这个model中的非常多的信息。它能够让我们的代码显得更加的简洁。</p>\n<p>同样的，Django也提供了form类和ModelForm类，REST framework提供了Serializer类和ModelSerializer类。</p>\n<p>接下来让我们用ModelSerializer类来重构一下我们的API，打开文件snippets/serializers.py，将SnippetSerializer类替换成下面的样子：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SnippetSerializer</span><span class=\"params\">(serializers.ModelSerializer)</span>:</span></span><br><span class=\"line\">    <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Meta</span>:</span></span><br><span class=\"line\">        model = Snippet</span><br><span class=\"line\">        fields = (<span class=\"string\">'id'</span>, <span class=\"string\">'title'</span>, <span class=\"string\">'code'</span>, <span class=\"string\">'linenos'</span>, <span class=\"string\">'language'</span>, <span class=\"string\">'style'</span>)</span><br></pre></td></tr></table></figure>\n<p>一个好的serializer的特点就是你能够在serializer实例中检查所有的数据成员，如果要打印数据表现，使用Django shell  :python manage.py shell</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> snippets.serializers <span class=\"keyword\">import</span> SnippetSerializer</span><br><span class=\"line\">serializer = SnippetSerializer()</span><br><span class=\"line\">print(repr(serializer))</span><br><span class=\"line\"><span class=\"comment\"># SnippetSerializer():</span></span><br><span class=\"line\"><span class=\"comment\">#    id = IntegerField(label='ID', read_only=True)</span></span><br><span class=\"line\"><span class=\"comment\">#    title = CharField(allow_blank=True, max_length=100, required=False)</span></span><br><span class=\"line\"><span class=\"comment\">#    code = CharField(style=&#123;'base_template': 'textarea.html'&#125;)</span></span><br><span class=\"line\"><span class=\"comment\">#    linenos = BooleanField(required=False)</span></span><br><span class=\"line\"><span class=\"comment\">#    language = ChoiceField(choices=[('Clipper', 'FoxPro'), ('Cucumber', 'Gherkin'), ('RobotFramework', 'RobotFramework'), ('abap', 'ABAP'), ('ada', 'Ada')...</span></span><br><span class=\"line\"><span class=\"comment\">#    style = ChoiceField(choices=[('autumn', 'autumn'), ('borland', 'borland'), ('bw', 'bw'), ('colorful', 'colorful')...</span></span><br></pre></td></tr></table></figure>\n<p>使用ModelSerializer类需要记住的重要的一点就是不要做特别的操作，它知识简单的创建一个序列化类：</p>\n<ul>\n<li><p>自动识别字段</p>\n</li>\n<li><p>简单的实现默认的create()方法和update()方法。</p>\n</li>\n</ul>\n<h4 id=\"使用Serializer来编写Django-views\"><a href=\"#使用Serializer来编写Django-views\" class=\"headerlink\" title=\"使用Serializer来编写Django views\"></a>使用Serializer来编写Django views</h4><p>让我们来尝试用新的serializer类来写一些API视图。这里，我们不会使用任何REST framework的其他特性，我们仅仅写点views来作为传统的Django views。编辑文件snippets/views.py，文件内容如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> django.http <span class=\"keyword\">import</span> HttpResponse, JsonResponse</span><br><span class=\"line\"><span class=\"keyword\">from</span> django.views.decorators.csrf <span class=\"keyword\">import</span> csrf_exempt</span><br><span class=\"line\"><span class=\"keyword\">from</span> rest_framework.renderers <span class=\"keyword\">import</span> JSONRenderer</span><br><span class=\"line\"><span class=\"keyword\">from</span> rest_framework.parsers <span class=\"keyword\">import</span> JSONParser</span><br><span class=\"line\"><span class=\"keyword\">from</span> snippets.models <span class=\"keyword\">import</span> Snippet</span><br><span class=\"line\"><span class=\"keyword\">from</span> snippets.serializers <span class=\"keyword\">import</span> SnippetSerializer</span><br></pre></td></tr></table></figure>\n<p>访问我们的API的根路径能够列出当前存在的snippets或者创建一个新的snippets。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@csrf_exempt</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">snippet_list</span><span class=\"params\">(request)</span>:</span></span><br><span class=\"line\">    <span class=\"string\">\"\"\"</span></span><br><span class=\"line\"><span class=\"string\">    List all code snippets, or create a new snippet.</span></span><br><span class=\"line\"><span class=\"string\">    \"\"\"</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> request.method == <span class=\"string\">'GET'</span>:</span><br><span class=\"line\">        snippets = Snippet.objects.all()</span><br><span class=\"line\">        serializer = SnippetSerializer(snippets, many=<span class=\"keyword\">True</span>)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> JsonResponse(serializer.data, safe=<span class=\"keyword\">False</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">elif</span> request.method == <span class=\"string\">'POST'</span>:</span><br><span class=\"line\">        data = JSONParser().parse(request)</span><br><span class=\"line\">        serializer = SnippetSerializer(data=data)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> serializer.is_valid():</span><br><span class=\"line\">            serializer.save()</span><br><span class=\"line\">            <span class=\"keyword\">return</span> JsonResponse(serializer.data, status=<span class=\"number\">201</span>)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> JsonResponse(serializer.errors, status=<span class=\"number\">400</span>)</span><br></pre></td></tr></table></figure>\n<p>注意，因为我们希望允许POST视图中的from表单，但是客户端不存在csrf token，我们需要添加注解csrf_exempt。这不是你平常需要做的，REST framework 的views能够控制敏感操作，这里的目的不是研究它。</p>\n<p>我们也需要一个view来确保snippet的独立性，并且用来获取、更新和删除snippet。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@csrf_exempt</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">snippet_detail</span><span class=\"params\">(request, pk)</span>:</span></span><br><span class=\"line\">    <span class=\"string\">\"\"\"</span></span><br><span class=\"line\"><span class=\"string\">    Retrieve, update or delete a code snippet.</span></span><br><span class=\"line\"><span class=\"string\">    \"\"\"</span></span><br><span class=\"line\">    <span class=\"keyword\">try</span>:</span><br><span class=\"line\">        snippet = Snippet.objects.get(pk=pk)</span><br><span class=\"line\">    <span class=\"keyword\">except</span> Snippet.DoesNotExist:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> HttpResponse(status=<span class=\"number\">404</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> request.method == <span class=\"string\">'GET'</span>:</span><br><span class=\"line\">        serializer = SnippetSerializer(snippet)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> JsonResponse(serializer.data)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">elif</span> request.method == <span class=\"string\">'PUT'</span>:</span><br><span class=\"line\">        data = JSONParser().parse(request)</span><br><span class=\"line\">        serializer = SnippetSerializer(snippet, data=data)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> serializer.is_valid():</span><br><span class=\"line\">            serializer.save()</span><br><span class=\"line\">            <span class=\"keyword\">return</span> JsonResponse(serializer.data)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> JsonResponse(serializer.errors, status=<span class=\"number\">400</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">elif</span> request.method == <span class=\"string\">'DELETE'</span>:</span><br><span class=\"line\">        snippet.delete()</span><br><span class=\"line\">        <span class=\"keyword\">return</span> HttpResponse(status=<span class=\"number\">204</span>)</span><br></pre></td></tr></table></figure>\n<p>最后，我们需要将这些view展示出来，创建一个文件snippets/urls.py:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> django.conf.urls <span class=\"keyword\">import</span> url</span><br><span class=\"line\"><span class=\"keyword\">from</span> snippets <span class=\"keyword\">import</span> views</span><br><span class=\"line\"></span><br><span class=\"line\">urlpatterns = [</span><br><span class=\"line\">    url(<span class=\"string\">r'^snippets/$'</span>, views.snippet_list),</span><br><span class=\"line\">    url(<span class=\"string\">r'^snippets/(?P&lt;pk&gt;[0-9]+)/$'</span>, views.snippet_detail),</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n<p>我们还需要编辑应用根路径下的urls.py文件，用以配置app所需的url</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> django.conf.urls <span class=\"keyword\">import</span> url, include</span><br><span class=\"line\"></span><br><span class=\"line\">urlpatterns = [</span><br><span class=\"line\">    url(<span class=\"string\">r'^'</span>, include(<span class=\"string\">'snippets.urls'</span>)),</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n<p>需要注意的是，这里还有一些小问题我们没有进行处理。如果我们发送的是json格式的数据，或者请求没有被适当的view处理，服务器将会反悔500“server error”错误。</p>\n<h4 id=\"测试我们的第一个Web-API\"><a href=\"#测试我们的第一个Web-API\" class=\"headerlink\" title=\"测试我们的第一个Web API\"></a>测试我们的第一个Web API</h4><p>首先要开启测试服务器，先退出Django shell</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">quit()</span><br></pre></td></tr></table></figure>\n<p>开启测试服务器：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">python manage.py runserver</span><br><span class=\"line\"></span><br><span class=\"line\">Validating models...</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"number\">0</span> errors found</span><br><span class=\"line\">Django version <span class=\"number\">1.11</span>, using settings <span class=\"string\">'tutorial.settings'</span></span><br><span class=\"line\">Development server <span class=\"keyword\">is</span> running at http://<span class=\"number\">127.0</span><span class=\"number\">.0</span><span class=\"number\">.1</span>:<span class=\"number\">8000</span>/</span><br><span class=\"line\">Quit the server <span class=\"keyword\">with</span> CONTROL-C.</span><br></pre></td></tr></table></figure>\n<p>测试API我们可以使用curl或者httpie。httpie是使用python编写的工具，当然安装它也很简单：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip install httpie</span><br></pre></td></tr></table></figure>\n<p>如果pip安装不上的话，还可以上使用easy_intall尝试一下：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">easy_install httpie</span><br></pre></td></tr></table></figure>\n<p>使用httppie测试结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PS E:\\Study\\Serializer_tutorial\\tutorial&gt; http http://<span class=\"number\">127.0</span><span class=\"number\">.0</span><span class=\"number\">.1</span>:<span class=\"number\">8000</span>/snippets/</span><br><span class=\"line\">HTTP/<span class=\"number\">1.0</span> <span class=\"number\">200</span> OK</span><br><span class=\"line\">Content-Length: <span class=\"number\">354</span></span><br><span class=\"line\">Content-Type: application/json</span><br><span class=\"line\">Date: Tue, <span class=\"number\">10</span> Oct <span class=\"number\">2017</span> <span class=\"number\">06</span>:<span class=\"number\">46</span>:<span class=\"number\">43</span> GMT</span><br><span class=\"line\">Server: WSGIServer/<span class=\"number\">0.1</span> Python/<span class=\"number\">2.7</span><span class=\"number\">.13</span></span><br><span class=\"line\">X-Frame-Options: SAMEORIGIN</span><br><span class=\"line\"></span><br><span class=\"line\">[</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"string\">\"code\"</span>: <span class=\"string\">\"foo = \\\"bar\\\"\\n\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"id\"</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">        <span class=\"string\">\"language\"</span>: <span class=\"string\">\"python\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"linenos\"</span>: false,</span><br><span class=\"line\">        <span class=\"string\">\"style\"</span>: <span class=\"string\">\"friendly\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"title\"</span>: <span class=\"string\">\"\"</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"string\">\"code\"</span>: <span class=\"string\">\"print \\\"hello, world\\n\\\"\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"id\"</span>: <span class=\"number\">2</span>,</span><br><span class=\"line\">        <span class=\"string\">\"language\"</span>: <span class=\"string\">\"python\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"linenos\"</span>: false,</span><br><span class=\"line\">        <span class=\"string\">\"style\"</span>: <span class=\"string\">\"friendly\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"title\"</span>: <span class=\"string\">\"\"</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"string\">\"code\"</span>: <span class=\"string\">\"print \\\"hello, world\\n\\\"\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"id\"</span>: <span class=\"number\">3</span>,</span><br><span class=\"line\">        <span class=\"string\">\"language\"</span>: <span class=\"string\">\"python\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"linenos\"</span>: false,</span><br><span class=\"line\">        <span class=\"string\">\"style\"</span>: <span class=\"string\">\"friendly\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"title\"</span>: <span class=\"string\">\"\"</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n<p>当然，使用浏览器直接查看这个API也是可以的。浏览器的效果：</p>\n<p><img src=\"/blogimg/rest-ser-1.png\" alt=\"image\"><br><img src=\"/blogimg/rest-ser-2.png\" alt=\"image\"></p>\n<p>翻译自：<a href=\"http://www.django-rest-framework.org/tutorial/1-serialization/\" target=\"_blank\" rel=\"noopener\">http://www.django-rest-framework.org/tutorial/1-serialization/</a></p>\n","site":{"data":{}},"excerpt":"<h3 id=\"DjangoRESTframework-——–序列化（Serializetion）\"><a href=\"#DjangoRESTframework-——–序列化（Serializetion）\" class=\"headerlink\" title=\"DjangoRESTframework ——–序列化（Serializetion）\"></a>DjangoRESTframework ——–序列化（Serializetion）</h3><h4 id=\"简介\"><a href=\"#简介\" class=\"headerlink\" title=\"简介\"></a>简介</h4><p>这个教程将建立一个简单的Web API代码片段。通过这个例子将想你介绍众多的REST framework的特性，以及让你深入理解每个组件是怎么组合在一起运行的。</p>\n<p>那就开始吧！</p>","more":"<h4 id=\"建立一个新的环境\"><a href=\"#建立一个新的环境\" class=\"headerlink\" title=\"建立一个新的环境\"></a>建立一个新的环境</h4><p>载我们开始干活之前我们需要使用virtualenv建立一个新的环境，它能够确保我们的包的配置能够很好的和我们正在开发的其他项目保持很好的隔离。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">virtualenv env</span><br><span class=\"line\">source env/bin/activeate  #windows:env/scripts/activate.bat</span><br></pre></td></tr></table></figure>\n<p>之后，我们进入到virtualenv环境，我们安装我们需要的package包。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip install django</span><br><span class=\"line\">pip install djangorestframework</span><br><span class=\"line\">pip install pygments #这个用来实现代码高亮</span><br></pre></td></tr></table></figure>\n<p>小纸条：如果需要退出virtualenv环境，只需要输入deactivate即可。</p>\n<h4 id=\"开始编码\"><a href=\"#开始编码\" class=\"headerlink\" title=\"开始编码\"></a>开始编码</h4><p>现在可以开始编码了，在开始工作之前，首先建立一个新的工程先。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd ~</span><br><span class=\"line\">django-admin startproject tutorial</span><br><span class=\"line\">cd tutorial</span><br></pre></td></tr></table></figure>\n<p>工程建立好之后，我们就可以创建一个新的app，我们将使用这个app来建立所需的Web API。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">python manage.py startapp snippets</span><br></pre></td></tr></table></figure>\n<p>我们需要添加新的的snippets app，将rest_framework注册到INSTALLED_APPS。这些操作需要编辑tutorial/settings.py这个文件：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">INSTALLED_APPS = (</span><br><span class=\"line\">    ...</span><br><span class=\"line\">    <span class=\"string\">'rest_framework'</span>,</span><br><span class=\"line\">    <span class=\"string\">'snippets.apps.SnippetsConfig'</span>,</span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n<p>请注意，如果你使用Django的版本小于1.9，你需要将snippets.app.SnippetsConfig替换为snippets。Let’s go on.</p>\n<h4 id=\"创建一个下一步工作所需的model\"><a href=\"#创建一个下一步工作所需的model\" class=\"headerlink\" title=\"创建一个下一步工作所需的model\"></a>创建一个下一步工作所需的model</h4><p>为了这个教程能够继续下去，我们需要创建一个简单的Snippet model，它用来存储snippets的代码。编辑文件snippets/models.py。注意：添加注释是一个良好的编程习惯。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> django.db <span class=\"keyword\">import</span> models</span><br><span class=\"line\"><span class=\"keyword\">from</span> pygments.lexers <span class=\"keyword\">import</span> get_all_lexers</span><br><span class=\"line\"><span class=\"keyword\">from</span> pygments.styles <span class=\"keyword\">import</span> get_all_styles</span><br><span class=\"line\"></span><br><span class=\"line\">LEXERS = [item <span class=\"keyword\">for</span> item <span class=\"keyword\">in</span> get_all_lexers() <span class=\"keyword\">if</span> item[<span class=\"number\">1</span>]]</span><br><span class=\"line\">LANGUAGE_CHOICES = sorted([(item[<span class=\"number\">1</span>][<span class=\"number\">0</span>], item[<span class=\"number\">0</span>]) <span class=\"keyword\">for</span> item <span class=\"keyword\">in</span> LEXERS])</span><br><span class=\"line\">STYLE_CHOICES = sorted((item, item) <span class=\"keyword\">for</span> item <span class=\"keyword\">in</span> get_all_styles())</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Snippet</span><span class=\"params\">(models.Model)</span>:</span></span><br><span class=\"line\">    created = models.DateTimeField(auto_now_add=<span class=\"keyword\">True</span>)</span><br><span class=\"line\">    title = models.CharField(max_length=<span class=\"number\">100</span>, blank=<span class=\"keyword\">True</span>, default=<span class=\"string\">''</span>)</span><br><span class=\"line\">    code = models.TextField()</span><br><span class=\"line\">    linenos = models.BooleanField(default=<span class=\"keyword\">False</span>)</span><br><span class=\"line\">    language = models.CharField(choices=LANGUAGE_CHOICES, default=<span class=\"string\">'python'</span>, max_length=<span class=\"number\">100</span>)</span><br><span class=\"line\">    style = models.CharField(choices=STYLE_CHOICES, default=<span class=\"string\">'friendly'</span>, max_length=<span class=\"number\">100</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Meta</span>:</span></span><br><span class=\"line\">        ordering = (<span class=\"string\">'created'</span>,)</span><br></pre></td></tr></table></figure>\n<p>我们也需要创建一个用于初始化迁移我们的model，同时在第一次需要同步数据库。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">python manage.py makemigrations snippets</span><br><span class=\"line\">python manage.py migrate</span><br></pre></td></tr></table></figure>\n<h4 id=\"创建Serializer类\"><a href=\"#创建Serializer类\" class=\"headerlink\" title=\"创建Serializer类\"></a>创建Serializer类</h4><p>要实现我们的Web API，第一件需要做的事情是提供一个可以序列化和反序列化的snippets实例，比如用json来表示。我们可以定义serializers，它和Django的forms非常类似。在snippets目录中新建一个名为serializers.py的文件，文件内容如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> rest_framework <span class=\"keyword\">import</span> serializers</span><br><span class=\"line\"><span class=\"keyword\">from</span> snippets.models <span class=\"keyword\">import</span> Snippet, LANGUAGE_CHOICES, STYLE_CHOICES</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SnippetSerializer</span><span class=\"params\">(serializers.Serializer)</span>:</span></span><br><span class=\"line\">    id = serializers.IntegerField(read_only=<span class=\"keyword\">True</span>)</span><br><span class=\"line\">    title = serializers.CharField(required=<span class=\"keyword\">False</span>, allow_blank=<span class=\"keyword\">True</span>, max_length=<span class=\"number\">100</span>)</span><br><span class=\"line\">    code = serializers.CharField(style=&#123;<span class=\"string\">'base_template'</span>: <span class=\"string\">'textarea.html'</span>&#125;)</span><br><span class=\"line\">    linenos = serializers.BooleanField(required=<span class=\"keyword\">False</span>)</span><br><span class=\"line\">    language = serializers.ChoiceField(choices=LANGUAGE_CHOICES, default=<span class=\"string\">'python'</span>)</span><br><span class=\"line\">    style = serializers.ChoiceField(choices=STYLE_CHOICES, default=<span class=\"string\">'friendly'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">create</span><span class=\"params\">(self, validated_data)</span>:</span></span><br><span class=\"line\">        <span class=\"string\">\"\"\"</span></span><br><span class=\"line\"><span class=\"string\">        Create and return a new `Snippet` instance, given the validated data.</span></span><br><span class=\"line\"><span class=\"string\">        \"\"\"</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> Snippet.objects.create(**validated_data)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">update</span><span class=\"params\">(self, instance, validated_data)</span>:</span></span><br><span class=\"line\">        <span class=\"string\">\"\"\"</span></span><br><span class=\"line\"><span class=\"string\">        Update and return an existing `Snippet` instance, given the validated data.</span></span><br><span class=\"line\"><span class=\"string\">        \"\"\"</span></span><br><span class=\"line\">        instance.title = validated_data.get(<span class=\"string\">'title'</span>, instance.title)</span><br><span class=\"line\">        instance.code = validated_data.get(<span class=\"string\">'code'</span>, instance.code)</span><br><span class=\"line\">        instance.linenos = validated_data.get(<span class=\"string\">'linenos'</span>, instance.linenos)</span><br><span class=\"line\">        instance.language = validated_data.get(<span class=\"string\">'language'</span>, instance.language)</span><br><span class=\"line\">        instance.style = validated_data.get(<span class=\"string\">'style'</span>, instance.style)</span><br><span class=\"line\">        instance.save()</span><br><span class=\"line\">        <span class=\"keyword\">return</span> instance</span><br></pre></td></tr></table></figure>\n<p>serializer类的第一部分定义了需要序列化和反序列化的成员变量，create()方法和update()方法定义了如何在调用serializer.save()方法时如何创建和修改实例。</p>\n<p>serializer类和Django的form类非常类似，都包含了类似的数据有效性验证机制和丰富的方法，比如required，max_length,default。</p>\n<p>数据域的标志能够控制serializer如何在特定的情况下显示，比如当在html页面中渲染{‘base_template’: ‘textarea.html’}，以上的标签等价于在Django的form类中的widget=widget.Textarea。这个在控制如何展示可视化API的过程中非常有用。接下来的的教程中我们将会体会到。</p>\n<p>实际上我们可以使用ModelSerializer来节约时间，这个之后会用到，当然我们需要确保我们的serializer的定义是明确的。</p>\n<h4 id=\"使用Serializers\"><a href=\"#使用Serializers\" class=\"headerlink\" title=\"使用Serializers\"></a>使用Serializers</h4><p>在继续接下来的工作之前，我们需要进入到Django shell中。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">python manage.py shell</span><br></pre></td></tr></table></figure>\n<p>好了，我们需要引入一些内容，并创建一些代码片段去处理它。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> snippets.models <span class=\"keyword\">import</span> Snippet</span><br><span class=\"line\"><span class=\"keyword\">from</span> snippets.serializers <span class=\"keyword\">import</span> SnippetSerializer</span><br><span class=\"line\"><span class=\"keyword\">from</span> rest_framework.renderers <span class=\"keyword\">import</span> JSONRenderer</span><br><span class=\"line\"><span class=\"keyword\">from</span> rest_framework.parsers <span class=\"keyword\">import</span> JSONParser</span><br><span class=\"line\"></span><br><span class=\"line\">snippet = Snippet(code=<span class=\"string\">'foo = \"bar\"\\n'</span>)</span><br><span class=\"line\">snippet.save()</span><br><span class=\"line\"></span><br><span class=\"line\">snippet = Snippet(code=<span class=\"string\">'print \"hello, world\"\\n'</span>)</span><br><span class=\"line\">snippet.save()</span><br></pre></td></tr></table></figure>\n<p>我们已经有了一些snippets实例，让我们看看将它们序列化之后的样子吧。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">serializer = SnippetSerializer(snippet)</span><br><span class=\"line\">serializer.data</span><br><span class=\"line\"><span class=\"comment\"># &#123;'id': 2, 'title': u'', 'code': u'print \"hello, world\"\\n', 'linenos': False, 'language': u'python', 'style': u'friendly'&#125;</span></span><br></pre></td></tr></table></figure>\n<p>这里，我们已经将model实例转换成了Python的原生数据类型，为了最终序列化结果，我们将数据转换成json格式。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">content = JSONRenderer().render(serializer.data)</span><br><span class=\"line\">content</span><br><span class=\"line\"><span class=\"comment\"># '&#123;\"id\": 2, \"title\": \"\", \"code\": \"print \\\\\"hello, world\\\\\"\\\\n\", \"linenos\": false, \"language\": \"python\", \"style\": \"friendly\"&#125;'</span></span><br></pre></td></tr></table></figure>\n<p>反序列化也是类似的，首先我们将Python原生数据类型转换成一个stream</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> django.utils.six <span class=\"keyword\">import</span> BytesIO</span><br><span class=\"line\"></span><br><span class=\"line\">stream = BytesIO(content)</span><br><span class=\"line\">data = JSONParser().parse(stream)</span><br></pre></td></tr></table></figure>\n<p>然后我们将装换成原生数据类型的model实例重新序列化为一个Python object实例。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">serializer = SnippetSerializer(data=data)</span><br><span class=\"line\">serializer.is_valid()</span><br><span class=\"line\"><span class=\"comment\"># True</span></span><br><span class=\"line\">serializer.validated_data</span><br><span class=\"line\"><span class=\"comment\"># OrderedDict([('title', ''), ('code', 'print \"hello, world\"\\n'), ('linenos', False), ('language', 'python'), ('style', 'friendly')])</span></span><br><span class=\"line\">serializer.save()</span><br><span class=\"line\"><span class=\"comment\"># &lt;Snippet: Snippet object&gt;</span></span><br></pre></td></tr></table></figure>\n<p>注意：这个API和Django forms非常类似。它们的相似性在我们开始写视图的时候将变得更加明显。</p>\n<p>我们也可以序列化查询的数据集，只需要在序列化方法中添加many=True参数即可。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">serializer = SnippetSerializer(Snippet.objects.all(), many=<span class=\"keyword\">True</span>)</span><br><span class=\"line\">serializer.data</span><br><span class=\"line\"><span class=\"comment\"># [OrderedDict([('id', 1), ('title', u''), ('code', u'foo = \"bar\"\\n'), ('linenos', False), ('language', 'python'), ('style', 'friendly')]), OrderedDict([('id', 2), ('title', u''), ('code', u'print \"hello, world\"\\n'), ('linenos', False), ('language', 'python'), ('style', 'friendly')]), OrderedDict([('id', 3), ('title', u''), ('code', u'print \"hello, world\"'), ('linenos', False), ('language', 'python'), ('style', 'friendly')])]</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"使用ModelSerializers\"><a href=\"#使用ModelSerializers\" class=\"headerlink\" title=\"使用ModelSerializers\"></a>使用ModelSerializers</h4><p>我们的SnippetSerializer类已经包含了Snippet这个model中的非常多的信息。它能够让我们的代码显得更加的简洁。</p>\n<p>同样的，Django也提供了form类和ModelForm类，REST framework提供了Serializer类和ModelSerializer类。</p>\n<p>接下来让我们用ModelSerializer类来重构一下我们的API，打开文件snippets/serializers.py，将SnippetSerializer类替换成下面的样子：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SnippetSerializer</span><span class=\"params\">(serializers.ModelSerializer)</span>:</span></span><br><span class=\"line\">    <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Meta</span>:</span></span><br><span class=\"line\">        model = Snippet</span><br><span class=\"line\">        fields = (<span class=\"string\">'id'</span>, <span class=\"string\">'title'</span>, <span class=\"string\">'code'</span>, <span class=\"string\">'linenos'</span>, <span class=\"string\">'language'</span>, <span class=\"string\">'style'</span>)</span><br></pre></td></tr></table></figure>\n<p>一个好的serializer的特点就是你能够在serializer实例中检查所有的数据成员，如果要打印数据表现，使用Django shell  :python manage.py shell</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> snippets.serializers <span class=\"keyword\">import</span> SnippetSerializer</span><br><span class=\"line\">serializer = SnippetSerializer()</span><br><span class=\"line\">print(repr(serializer))</span><br><span class=\"line\"><span class=\"comment\"># SnippetSerializer():</span></span><br><span class=\"line\"><span class=\"comment\">#    id = IntegerField(label='ID', read_only=True)</span></span><br><span class=\"line\"><span class=\"comment\">#    title = CharField(allow_blank=True, max_length=100, required=False)</span></span><br><span class=\"line\"><span class=\"comment\">#    code = CharField(style=&#123;'base_template': 'textarea.html'&#125;)</span></span><br><span class=\"line\"><span class=\"comment\">#    linenos = BooleanField(required=False)</span></span><br><span class=\"line\"><span class=\"comment\">#    language = ChoiceField(choices=[('Clipper', 'FoxPro'), ('Cucumber', 'Gherkin'), ('RobotFramework', 'RobotFramework'), ('abap', 'ABAP'), ('ada', 'Ada')...</span></span><br><span class=\"line\"><span class=\"comment\">#    style = ChoiceField(choices=[('autumn', 'autumn'), ('borland', 'borland'), ('bw', 'bw'), ('colorful', 'colorful')...</span></span><br></pre></td></tr></table></figure>\n<p>使用ModelSerializer类需要记住的重要的一点就是不要做特别的操作，它知识简单的创建一个序列化类：</p>\n<ul>\n<li><p>自动识别字段</p>\n</li>\n<li><p>简单的实现默认的create()方法和update()方法。</p>\n</li>\n</ul>\n<h4 id=\"使用Serializer来编写Django-views\"><a href=\"#使用Serializer来编写Django-views\" class=\"headerlink\" title=\"使用Serializer来编写Django views\"></a>使用Serializer来编写Django views</h4><p>让我们来尝试用新的serializer类来写一些API视图。这里，我们不会使用任何REST framework的其他特性，我们仅仅写点views来作为传统的Django views。编辑文件snippets/views.py，文件内容如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> django.http <span class=\"keyword\">import</span> HttpResponse, JsonResponse</span><br><span class=\"line\"><span class=\"keyword\">from</span> django.views.decorators.csrf <span class=\"keyword\">import</span> csrf_exempt</span><br><span class=\"line\"><span class=\"keyword\">from</span> rest_framework.renderers <span class=\"keyword\">import</span> JSONRenderer</span><br><span class=\"line\"><span class=\"keyword\">from</span> rest_framework.parsers <span class=\"keyword\">import</span> JSONParser</span><br><span class=\"line\"><span class=\"keyword\">from</span> snippets.models <span class=\"keyword\">import</span> Snippet</span><br><span class=\"line\"><span class=\"keyword\">from</span> snippets.serializers <span class=\"keyword\">import</span> SnippetSerializer</span><br></pre></td></tr></table></figure>\n<p>访问我们的API的根路径能够列出当前存在的snippets或者创建一个新的snippets。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@csrf_exempt</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">snippet_list</span><span class=\"params\">(request)</span>:</span></span><br><span class=\"line\">    <span class=\"string\">\"\"\"</span></span><br><span class=\"line\"><span class=\"string\">    List all code snippets, or create a new snippet.</span></span><br><span class=\"line\"><span class=\"string\">    \"\"\"</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> request.method == <span class=\"string\">'GET'</span>:</span><br><span class=\"line\">        snippets = Snippet.objects.all()</span><br><span class=\"line\">        serializer = SnippetSerializer(snippets, many=<span class=\"keyword\">True</span>)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> JsonResponse(serializer.data, safe=<span class=\"keyword\">False</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">elif</span> request.method == <span class=\"string\">'POST'</span>:</span><br><span class=\"line\">        data = JSONParser().parse(request)</span><br><span class=\"line\">        serializer = SnippetSerializer(data=data)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> serializer.is_valid():</span><br><span class=\"line\">            serializer.save()</span><br><span class=\"line\">            <span class=\"keyword\">return</span> JsonResponse(serializer.data, status=<span class=\"number\">201</span>)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> JsonResponse(serializer.errors, status=<span class=\"number\">400</span>)</span><br></pre></td></tr></table></figure>\n<p>注意，因为我们希望允许POST视图中的from表单，但是客户端不存在csrf token，我们需要添加注解csrf_exempt。这不是你平常需要做的，REST framework 的views能够控制敏感操作，这里的目的不是研究它。</p>\n<p>我们也需要一个view来确保snippet的独立性，并且用来获取、更新和删除snippet。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@csrf_exempt</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">snippet_detail</span><span class=\"params\">(request, pk)</span>:</span></span><br><span class=\"line\">    <span class=\"string\">\"\"\"</span></span><br><span class=\"line\"><span class=\"string\">    Retrieve, update or delete a code snippet.</span></span><br><span class=\"line\"><span class=\"string\">    \"\"\"</span></span><br><span class=\"line\">    <span class=\"keyword\">try</span>:</span><br><span class=\"line\">        snippet = Snippet.objects.get(pk=pk)</span><br><span class=\"line\">    <span class=\"keyword\">except</span> Snippet.DoesNotExist:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> HttpResponse(status=<span class=\"number\">404</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> request.method == <span class=\"string\">'GET'</span>:</span><br><span class=\"line\">        serializer = SnippetSerializer(snippet)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> JsonResponse(serializer.data)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">elif</span> request.method == <span class=\"string\">'PUT'</span>:</span><br><span class=\"line\">        data = JSONParser().parse(request)</span><br><span class=\"line\">        serializer = SnippetSerializer(snippet, data=data)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> serializer.is_valid():</span><br><span class=\"line\">            serializer.save()</span><br><span class=\"line\">            <span class=\"keyword\">return</span> JsonResponse(serializer.data)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> JsonResponse(serializer.errors, status=<span class=\"number\">400</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">elif</span> request.method == <span class=\"string\">'DELETE'</span>:</span><br><span class=\"line\">        snippet.delete()</span><br><span class=\"line\">        <span class=\"keyword\">return</span> HttpResponse(status=<span class=\"number\">204</span>)</span><br></pre></td></tr></table></figure>\n<p>最后，我们需要将这些view展示出来，创建一个文件snippets/urls.py:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> django.conf.urls <span class=\"keyword\">import</span> url</span><br><span class=\"line\"><span class=\"keyword\">from</span> snippets <span class=\"keyword\">import</span> views</span><br><span class=\"line\"></span><br><span class=\"line\">urlpatterns = [</span><br><span class=\"line\">    url(<span class=\"string\">r'^snippets/$'</span>, views.snippet_list),</span><br><span class=\"line\">    url(<span class=\"string\">r'^snippets/(?P&lt;pk&gt;[0-9]+)/$'</span>, views.snippet_detail),</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n<p>我们还需要编辑应用根路径下的urls.py文件，用以配置app所需的url</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> django.conf.urls <span class=\"keyword\">import</span> url, include</span><br><span class=\"line\"></span><br><span class=\"line\">urlpatterns = [</span><br><span class=\"line\">    url(<span class=\"string\">r'^'</span>, include(<span class=\"string\">'snippets.urls'</span>)),</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n<p>需要注意的是，这里还有一些小问题我们没有进行处理。如果我们发送的是json格式的数据，或者请求没有被适当的view处理，服务器将会反悔500“server error”错误。</p>\n<h4 id=\"测试我们的第一个Web-API\"><a href=\"#测试我们的第一个Web-API\" class=\"headerlink\" title=\"测试我们的第一个Web API\"></a>测试我们的第一个Web API</h4><p>首先要开启测试服务器，先退出Django shell</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">quit()</span><br></pre></td></tr></table></figure>\n<p>开启测试服务器：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">python manage.py runserver</span><br><span class=\"line\"></span><br><span class=\"line\">Validating models...</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"number\">0</span> errors found</span><br><span class=\"line\">Django version <span class=\"number\">1.11</span>, using settings <span class=\"string\">'tutorial.settings'</span></span><br><span class=\"line\">Development server <span class=\"keyword\">is</span> running at http://<span class=\"number\">127.0</span><span class=\"number\">.0</span><span class=\"number\">.1</span>:<span class=\"number\">8000</span>/</span><br><span class=\"line\">Quit the server <span class=\"keyword\">with</span> CONTROL-C.</span><br></pre></td></tr></table></figure>\n<p>测试API我们可以使用curl或者httpie。httpie是使用python编写的工具，当然安装它也很简单：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip install httpie</span><br></pre></td></tr></table></figure>\n<p>如果pip安装不上的话，还可以上使用easy_intall尝试一下：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">easy_install httpie</span><br></pre></td></tr></table></figure>\n<p>使用httppie测试结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PS E:\\Study\\Serializer_tutorial\\tutorial&gt; http http://<span class=\"number\">127.0</span><span class=\"number\">.0</span><span class=\"number\">.1</span>:<span class=\"number\">8000</span>/snippets/</span><br><span class=\"line\">HTTP/<span class=\"number\">1.0</span> <span class=\"number\">200</span> OK</span><br><span class=\"line\">Content-Length: <span class=\"number\">354</span></span><br><span class=\"line\">Content-Type: application/json</span><br><span class=\"line\">Date: Tue, <span class=\"number\">10</span> Oct <span class=\"number\">2017</span> <span class=\"number\">06</span>:<span class=\"number\">46</span>:<span class=\"number\">43</span> GMT</span><br><span class=\"line\">Server: WSGIServer/<span class=\"number\">0.1</span> Python/<span class=\"number\">2.7</span><span class=\"number\">.13</span></span><br><span class=\"line\">X-Frame-Options: SAMEORIGIN</span><br><span class=\"line\"></span><br><span class=\"line\">[</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"string\">\"code\"</span>: <span class=\"string\">\"foo = \\\"bar\\\"\\n\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"id\"</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">        <span class=\"string\">\"language\"</span>: <span class=\"string\">\"python\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"linenos\"</span>: false,</span><br><span class=\"line\">        <span class=\"string\">\"style\"</span>: <span class=\"string\">\"friendly\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"title\"</span>: <span class=\"string\">\"\"</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"string\">\"code\"</span>: <span class=\"string\">\"print \\\"hello, world\\n\\\"\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"id\"</span>: <span class=\"number\">2</span>,</span><br><span class=\"line\">        <span class=\"string\">\"language\"</span>: <span class=\"string\">\"python\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"linenos\"</span>: false,</span><br><span class=\"line\">        <span class=\"string\">\"style\"</span>: <span class=\"string\">\"friendly\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"title\"</span>: <span class=\"string\">\"\"</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"string\">\"code\"</span>: <span class=\"string\">\"print \\\"hello, world\\n\\\"\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"id\"</span>: <span class=\"number\">3</span>,</span><br><span class=\"line\">        <span class=\"string\">\"language\"</span>: <span class=\"string\">\"python\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"linenos\"</span>: false,</span><br><span class=\"line\">        <span class=\"string\">\"style\"</span>: <span class=\"string\">\"friendly\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"title\"</span>: <span class=\"string\">\"\"</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n<p>当然，使用浏览器直接查看这个API也是可以的。浏览器的效果：</p>\n<p><img src=\"/blogimg/rest-ser-1.png\" alt=\"image\"><br><img src=\"/blogimg/rest-ser-2.png\" alt=\"image\"></p>\n<p>翻译自：<a href=\"http://www.django-rest-framework.org/tutorial/1-serialization/\" target=\"_blank\" rel=\"noopener\">http://www.django-rest-framework.org/tutorial/1-serialization/</a></p>"},{"title":"DjangoRESTframework-快速开始","date":"2017-10-10T03:28:45.000Z","_content":"\n### DjangoRESTframework  快速开始\n\n我们将开始建立一个简单的API，让admin用户去查看和编辑系统中用户和用户组。\n\n<!--more-->\n\n#### 建立工程\n\n```shell\n# 为工程建立存储目录\nmkdir tutorial\ncd tutorial\n\n# 创建一个virtualenv，便于隔离我们的包的本地依赖\nvirtualenv env\nsource env/bin/activate  # 在windows环境使用命令 `env\\Scripts\\activate`\n\n# 在virtualenv中安装django和djangorestframework框架\npip install django\npip install djangorestframework\n\n# 建立一个新的project和一个新的app\ndjango-admin.py startproject tutorial .  # 注意结尾的 '.' 号\ncd tutorial\ndjango-admin.py startapp quickstart\ncd ..\n```\n\n工程的目录结构应该如下：\n\n```shell\n$ pwd\n<some path>/tutorial\n$ find .\n.\n./manage.py\n./tutorial\n./tutorial/__init__.py\n./tutorial/quickstart\n./tutorial/quickstart/__init__.py\n./tutorial/quickstart/admin.py\n./tutorial/quickstart/apps.py\n./tutorial/quickstart/migrations\n./tutorial/quickstart/migrations/__init__.py\n./tutorial/quickstart/models.py\n./tutorial/quickstart/tests.py\n./tutorial/quickstart/views.py\n./tutorial/settings.py\n./tutorial/urls.py\n./tutorial/wsgi.py\n```\n\n在引用外部模块的时候使用工程的命名空间来避免名称的冲突。接下来可以首先同步你的数据库：\n\n```shell\npython manage.py migrate\n```\n\n同时我们也需要建立和初始化admin用户，并设置 admin用户的密码为password123。稍后我们将在我们的实例应用中认证其他用户。\n\n```shell\npython manage.py createsuperuser\n```\n\n当你同步好数据库并初始化用户之后，打开工程的app目录（这里是quickstart），开始编码吧。\n\n#### 序列化器（Serializers）\n\n首先，我们需要定义一些序列化器（serializers），让我们创建一个新的模块（module），路径是tutorial/quickstart/serializers.py，这个将用来作为数据展示。\n\n```python\nfrom django.contrib.auth.models import User, Group\nfrom rest_framework import serializers\n\n\nclass UserSerializer(serializers.HyperlinkedModelSerializer):\n    class Meta:\n        model = User\n        fields = ('url', 'username', 'email', 'groups')\n\n\nclass GroupSerializer(serializers.HyperlinkedModelSerializer):\n    class Meta:\n        model = Group\n        fields = ('url', 'name')\n```\n\n注意：这里我们继承关系的是HyperlinkedSerializers,你也可以使用主键或者其他众多的关系，但是hyperlinking是很好的RESTful设计。\n\n#### 视图（Views）\n\n我们最好再写点视图（views）吧，打开文件tutorial/quickstart/views.py，然后把下面的内容敲进去。\n\n```python\nfrom django.contrib.auth.models import User, Group\nfrom rest_framework import viewsets\nfrom tutorial.quickstart.serializers import UserSerializer, GroupSerializer\n\n\nclass UserViewSet(viewsets.ModelViewSet):\n    \"\"\"\n    API endpoint that allows users to be viewed or edited.\n    \"\"\"\n    queryset = User.objects.all().order_by('-date_joined')\n    serializer_class = UserSerializer\n\n\nclass GroupViewSet(viewsets.ModelViewSet):\n    \"\"\"\n    API endpoint that allows groups to be viewed or edited.\n    \"\"\"\n    queryset = Group.objects.all()\n    serializer_class = GroupSerializer\n```\n\n比起写非常多的视图，我们将所有视图的许多共同行为（common behavior）放进了ViewSets类中。如果有需要，我们可以非常容易的将他们拆成单独的视图，但是使用viewsets可以保持良好的视图逻辑和简洁的代码。\n\n#### URL配置（URLs)\n\n接下来我们可以定义API的url路径了，文件是tutorial/urls.py\n\n```python\nfrom django.conf.urls import url, include\nfrom rest_framework import routers\nfrom tutorial.quickstart import views\n\nrouter = routers.DefaultRouter()\nrouter.register(r'users', views.UserViewSet)\nrouter.register(r'groups', views.GroupViewSet)\n\n# Wire up our API using automatic URL routing.\n# Additionally, we include login URLs for the browsable API.\nurlpatterns = [\n    url(r'^', include(router.urls)),\n    url(r'^api-auth/', include('rest_framework.urls', namespace='rest_framework'))\n]\n```\n\n由于我们使用了viewsets代替了views，我们的API可以自动成成URL配置，只需要将viewsets注册到router class中即可。\n\n同样，如果我们需要对API的URL获得更多的控制，也可以使用传统的class-based视图，然后自己配置URL。\n\n最后，我们可以包含登录和登出视图来浏览我们的API。这是可选的，但是如果你的API需要登录认证和需要浏览API，这两个视图也非常有用。\n\n#### 设置（Settings）\n\n我们需要一点点全局设置，比如需要分页或者想让我们的API只能由admin用户使用，这些配置都需要在tutorial/settings.py中。\n\n```python\nINSTALLED_APPS = (\n    ...\n    'rest_framework',\n)\n\nREST_FRAMEWORK = {\n    'DEFAULT_PERMISSION_CLASSES': [\n        'rest_framework.permissions.IsAdminUser',\n    ],\n    'PAGE_SIZE': 10\n}\n```\n\n好了，代码我们就写完了。\n\n#### 测试我们的API\n\n首先把测试服务器打开，让应用跑起来。\n\n```shell\npython manage.py runserver\n```\n\n服务开启正常后，我们就可以使用curl或者浏览器来测试api了。\n\n```shell\nPS E:\\Study\\tutorial\\tutorial> http -a admin:password123 http://127.0.0.1:8000/users/\nHTTP/1.0 200 OK\nAllow: GET, POST, HEAD, OPTIONS\nContent-Length: 103\nContent-Type: application/json\nDate: Tue, 10 Oct 2017 03:05:10 GMT\nServer: WSGIServer/0.1 Python/2.7.13\nVary: Accept, Cookie\nX-Frame-Options: SAMEORIGIN\n\n[\n    {\n        \"email\": \"admin@star-chen.com\",\n        \"groups\": [],\n        \"url\": \"http://127.0.0.1:8000/users/1/\",\n        \"username\": \"admin\"\n    }\n]\n```\n\n浏览器中是这个画风，当然你得先登录。\n\n![image](/blogimg/quick_start.png)\n\nok,成功运行。","source":"_posts/DjangoRESTframework-quickstart.md","raw":"---\ntitle: DjangoRESTframework-快速开始\ncategories:\n  - Program\ntags:\n  - python djangorestframework\ndate: 2017-10-10 11:28:45\n---\n\n### DjangoRESTframework  快速开始\n\n我们将开始建立一个简单的API，让admin用户去查看和编辑系统中用户和用户组。\n\n<!--more-->\n\n#### 建立工程\n\n```shell\n# 为工程建立存储目录\nmkdir tutorial\ncd tutorial\n\n# 创建一个virtualenv，便于隔离我们的包的本地依赖\nvirtualenv env\nsource env/bin/activate  # 在windows环境使用命令 `env\\Scripts\\activate`\n\n# 在virtualenv中安装django和djangorestframework框架\npip install django\npip install djangorestframework\n\n# 建立一个新的project和一个新的app\ndjango-admin.py startproject tutorial .  # 注意结尾的 '.' 号\ncd tutorial\ndjango-admin.py startapp quickstart\ncd ..\n```\n\n工程的目录结构应该如下：\n\n```shell\n$ pwd\n<some path>/tutorial\n$ find .\n.\n./manage.py\n./tutorial\n./tutorial/__init__.py\n./tutorial/quickstart\n./tutorial/quickstart/__init__.py\n./tutorial/quickstart/admin.py\n./tutorial/quickstart/apps.py\n./tutorial/quickstart/migrations\n./tutorial/quickstart/migrations/__init__.py\n./tutorial/quickstart/models.py\n./tutorial/quickstart/tests.py\n./tutorial/quickstart/views.py\n./tutorial/settings.py\n./tutorial/urls.py\n./tutorial/wsgi.py\n```\n\n在引用外部模块的时候使用工程的命名空间来避免名称的冲突。接下来可以首先同步你的数据库：\n\n```shell\npython manage.py migrate\n```\n\n同时我们也需要建立和初始化admin用户，并设置 admin用户的密码为password123。稍后我们将在我们的实例应用中认证其他用户。\n\n```shell\npython manage.py createsuperuser\n```\n\n当你同步好数据库并初始化用户之后，打开工程的app目录（这里是quickstart），开始编码吧。\n\n#### 序列化器（Serializers）\n\n首先，我们需要定义一些序列化器（serializers），让我们创建一个新的模块（module），路径是tutorial/quickstart/serializers.py，这个将用来作为数据展示。\n\n```python\nfrom django.contrib.auth.models import User, Group\nfrom rest_framework import serializers\n\n\nclass UserSerializer(serializers.HyperlinkedModelSerializer):\n    class Meta:\n        model = User\n        fields = ('url', 'username', 'email', 'groups')\n\n\nclass GroupSerializer(serializers.HyperlinkedModelSerializer):\n    class Meta:\n        model = Group\n        fields = ('url', 'name')\n```\n\n注意：这里我们继承关系的是HyperlinkedSerializers,你也可以使用主键或者其他众多的关系，但是hyperlinking是很好的RESTful设计。\n\n#### 视图（Views）\n\n我们最好再写点视图（views）吧，打开文件tutorial/quickstart/views.py，然后把下面的内容敲进去。\n\n```python\nfrom django.contrib.auth.models import User, Group\nfrom rest_framework import viewsets\nfrom tutorial.quickstart.serializers import UserSerializer, GroupSerializer\n\n\nclass UserViewSet(viewsets.ModelViewSet):\n    \"\"\"\n    API endpoint that allows users to be viewed or edited.\n    \"\"\"\n    queryset = User.objects.all().order_by('-date_joined')\n    serializer_class = UserSerializer\n\n\nclass GroupViewSet(viewsets.ModelViewSet):\n    \"\"\"\n    API endpoint that allows groups to be viewed or edited.\n    \"\"\"\n    queryset = Group.objects.all()\n    serializer_class = GroupSerializer\n```\n\n比起写非常多的视图，我们将所有视图的许多共同行为（common behavior）放进了ViewSets类中。如果有需要，我们可以非常容易的将他们拆成单独的视图，但是使用viewsets可以保持良好的视图逻辑和简洁的代码。\n\n#### URL配置（URLs)\n\n接下来我们可以定义API的url路径了，文件是tutorial/urls.py\n\n```python\nfrom django.conf.urls import url, include\nfrom rest_framework import routers\nfrom tutorial.quickstart import views\n\nrouter = routers.DefaultRouter()\nrouter.register(r'users', views.UserViewSet)\nrouter.register(r'groups', views.GroupViewSet)\n\n# Wire up our API using automatic URL routing.\n# Additionally, we include login URLs for the browsable API.\nurlpatterns = [\n    url(r'^', include(router.urls)),\n    url(r'^api-auth/', include('rest_framework.urls', namespace='rest_framework'))\n]\n```\n\n由于我们使用了viewsets代替了views，我们的API可以自动成成URL配置，只需要将viewsets注册到router class中即可。\n\n同样，如果我们需要对API的URL获得更多的控制，也可以使用传统的class-based视图，然后自己配置URL。\n\n最后，我们可以包含登录和登出视图来浏览我们的API。这是可选的，但是如果你的API需要登录认证和需要浏览API，这两个视图也非常有用。\n\n#### 设置（Settings）\n\n我们需要一点点全局设置，比如需要分页或者想让我们的API只能由admin用户使用，这些配置都需要在tutorial/settings.py中。\n\n```python\nINSTALLED_APPS = (\n    ...\n    'rest_framework',\n)\n\nREST_FRAMEWORK = {\n    'DEFAULT_PERMISSION_CLASSES': [\n        'rest_framework.permissions.IsAdminUser',\n    ],\n    'PAGE_SIZE': 10\n}\n```\n\n好了，代码我们就写完了。\n\n#### 测试我们的API\n\n首先把测试服务器打开，让应用跑起来。\n\n```shell\npython manage.py runserver\n```\n\n服务开启正常后，我们就可以使用curl或者浏览器来测试api了。\n\n```shell\nPS E:\\Study\\tutorial\\tutorial> http -a admin:password123 http://127.0.0.1:8000/users/\nHTTP/1.0 200 OK\nAllow: GET, POST, HEAD, OPTIONS\nContent-Length: 103\nContent-Type: application/json\nDate: Tue, 10 Oct 2017 03:05:10 GMT\nServer: WSGIServer/0.1 Python/2.7.13\nVary: Accept, Cookie\nX-Frame-Options: SAMEORIGIN\n\n[\n    {\n        \"email\": \"admin@star-chen.com\",\n        \"groups\": [],\n        \"url\": \"http://127.0.0.1:8000/users/1/\",\n        \"username\": \"admin\"\n    }\n]\n```\n\n浏览器中是这个画风，当然你得先登录。\n\n![image](/blogimg/quick_start.png)\n\nok,成功运行。","slug":"DjangoRESTframework-quickstart","published":1,"updated":"2017-12-04T07:27:28.755Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjeqig1lg001mlgqajmhdrs7a","content":"<h3 id=\"DjangoRESTframework-快速开始\"><a href=\"#DjangoRESTframework-快速开始\" class=\"headerlink\" title=\"DjangoRESTframework  快速开始\"></a>DjangoRESTframework  快速开始</h3><p>我们将开始建立一个简单的API，让admin用户去查看和编辑系统中用户和用户组。</p>\n<a id=\"more\"></a>\n<h4 id=\"建立工程\"><a href=\"#建立工程\" class=\"headerlink\" title=\"建立工程\"></a>建立工程</h4><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 为工程建立存储目录</span></span><br><span class=\"line\">mkdir tutorial</span><br><span class=\"line\">cd tutorial</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 创建一个virtualenv，便于隔离我们的包的本地依赖</span></span><br><span class=\"line\">virtualenv env</span><br><span class=\"line\">source env/bin/activate  # 在windows环境使用命令 `env\\Scripts\\activate`</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 在virtualenv中安装django和djangorestframework框架</span></span><br><span class=\"line\">pip install django</span><br><span class=\"line\">pip install djangorestframework</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 建立一个新的project和一个新的app</span></span><br><span class=\"line\">django-admin.py startproject tutorial .  # 注意结尾的 '.' 号</span><br><span class=\"line\">cd tutorial</span><br><span class=\"line\">django-admin.py startapp quickstart</span><br><span class=\"line\">cd ..</span><br></pre></td></tr></table></figure>\n<p>工程的目录结构应该如下：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> <span class=\"built_in\">pwd</span></span></span><br><span class=\"line\">&lt;some path&gt;/tutorial</span><br><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> find .</span></span><br><span class=\"line\">.</span><br><span class=\"line\">./manage.py</span><br><span class=\"line\">./tutorial</span><br><span class=\"line\">./tutorial/__init__.py</span><br><span class=\"line\">./tutorial/quickstart</span><br><span class=\"line\">./tutorial/quickstart/__init__.py</span><br><span class=\"line\">./tutorial/quickstart/admin.py</span><br><span class=\"line\">./tutorial/quickstart/apps.py</span><br><span class=\"line\">./tutorial/quickstart/migrations</span><br><span class=\"line\">./tutorial/quickstart/migrations/__init__.py</span><br><span class=\"line\">./tutorial/quickstart/models.py</span><br><span class=\"line\">./tutorial/quickstart/tests.py</span><br><span class=\"line\">./tutorial/quickstart/views.py</span><br><span class=\"line\">./tutorial/settings.py</span><br><span class=\"line\">./tutorial/urls.py</span><br><span class=\"line\">./tutorial/wsgi.py</span><br></pre></td></tr></table></figure>\n<p>在引用外部模块的时候使用工程的命名空间来避免名称的冲突。接下来可以首先同步你的数据库：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">python manage.py migrate</span><br></pre></td></tr></table></figure>\n<p>同时我们也需要建立和初始化admin用户，并设置 admin用户的密码为password123。稍后我们将在我们的实例应用中认证其他用户。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">python manage.py createsuperuser</span><br></pre></td></tr></table></figure>\n<p>当你同步好数据库并初始化用户之后，打开工程的app目录（这里是quickstart），开始编码吧。</p>\n<h4 id=\"序列化器（Serializers）\"><a href=\"#序列化器（Serializers）\" class=\"headerlink\" title=\"序列化器（Serializers）\"></a>序列化器（Serializers）</h4><p>首先，我们需要定义一些序列化器（serializers），让我们创建一个新的模块（module），路径是tutorial/quickstart/serializers.py，这个将用来作为数据展示。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> django.contrib.auth.models <span class=\"keyword\">import</span> User, Group</span><br><span class=\"line\"><span class=\"keyword\">from</span> rest_framework <span class=\"keyword\">import</span> serializers</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">UserSerializer</span><span class=\"params\">(serializers.HyperlinkedModelSerializer)</span>:</span></span><br><span class=\"line\">    <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Meta</span>:</span></span><br><span class=\"line\">        model = User</span><br><span class=\"line\">        fields = (<span class=\"string\">'url'</span>, <span class=\"string\">'username'</span>, <span class=\"string\">'email'</span>, <span class=\"string\">'groups'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">GroupSerializer</span><span class=\"params\">(serializers.HyperlinkedModelSerializer)</span>:</span></span><br><span class=\"line\">    <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Meta</span>:</span></span><br><span class=\"line\">        model = Group</span><br><span class=\"line\">        fields = (<span class=\"string\">'url'</span>, <span class=\"string\">'name'</span>)</span><br></pre></td></tr></table></figure>\n<p>注意：这里我们继承关系的是HyperlinkedSerializers,你也可以使用主键或者其他众多的关系，但是hyperlinking是很好的RESTful设计。</p>\n<h4 id=\"视图（Views）\"><a href=\"#视图（Views）\" class=\"headerlink\" title=\"视图（Views）\"></a>视图（Views）</h4><p>我们最好再写点视图（views）吧，打开文件tutorial/quickstart/views.py，然后把下面的内容敲进去。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> django.contrib.auth.models <span class=\"keyword\">import</span> User, Group</span><br><span class=\"line\"><span class=\"keyword\">from</span> rest_framework <span class=\"keyword\">import</span> viewsets</span><br><span class=\"line\"><span class=\"keyword\">from</span> tutorial.quickstart.serializers <span class=\"keyword\">import</span> UserSerializer, GroupSerializer</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">UserViewSet</span><span class=\"params\">(viewsets.ModelViewSet)</span>:</span></span><br><span class=\"line\">    <span class=\"string\">\"\"\"</span></span><br><span class=\"line\"><span class=\"string\">    API endpoint that allows users to be viewed or edited.</span></span><br><span class=\"line\"><span class=\"string\">    \"\"\"</span></span><br><span class=\"line\">    queryset = User.objects.all().order_by(<span class=\"string\">'-date_joined'</span>)</span><br><span class=\"line\">    serializer_class = UserSerializer</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">GroupViewSet</span><span class=\"params\">(viewsets.ModelViewSet)</span>:</span></span><br><span class=\"line\">    <span class=\"string\">\"\"\"</span></span><br><span class=\"line\"><span class=\"string\">    API endpoint that allows groups to be viewed or edited.</span></span><br><span class=\"line\"><span class=\"string\">    \"\"\"</span></span><br><span class=\"line\">    queryset = Group.objects.all()</span><br><span class=\"line\">    serializer_class = GroupSerializer</span><br></pre></td></tr></table></figure>\n<p>比起写非常多的视图，我们将所有视图的许多共同行为（common behavior）放进了ViewSets类中。如果有需要，我们可以非常容易的将他们拆成单独的视图，但是使用viewsets可以保持良好的视图逻辑和简洁的代码。</p>\n<h4 id=\"URL配置（URLs\"><a href=\"#URL配置（URLs\" class=\"headerlink\" title=\"URL配置（URLs)\"></a>URL配置（URLs)</h4><p>接下来我们可以定义API的url路径了，文件是tutorial/urls.py</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> django.conf.urls <span class=\"keyword\">import</span> url, include</span><br><span class=\"line\"><span class=\"keyword\">from</span> rest_framework <span class=\"keyword\">import</span> routers</span><br><span class=\"line\"><span class=\"keyword\">from</span> tutorial.quickstart <span class=\"keyword\">import</span> views</span><br><span class=\"line\"></span><br><span class=\"line\">router = routers.DefaultRouter()</span><br><span class=\"line\">router.register(<span class=\"string\">r'users'</span>, views.UserViewSet)</span><br><span class=\"line\">router.register(<span class=\"string\">r'groups'</span>, views.GroupViewSet)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Wire up our API using automatic URL routing.</span></span><br><span class=\"line\"><span class=\"comment\"># Additionally, we include login URLs for the browsable API.</span></span><br><span class=\"line\">urlpatterns = [</span><br><span class=\"line\">    url(<span class=\"string\">r'^'</span>, include(router.urls)),</span><br><span class=\"line\">    url(<span class=\"string\">r'^api-auth/'</span>, include(<span class=\"string\">'rest_framework.urls'</span>, namespace=<span class=\"string\">'rest_framework'</span>))</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n<p>由于我们使用了viewsets代替了views，我们的API可以自动成成URL配置，只需要将viewsets注册到router class中即可。</p>\n<p>同样，如果我们需要对API的URL获得更多的控制，也可以使用传统的class-based视图，然后自己配置URL。</p>\n<p>最后，我们可以包含登录和登出视图来浏览我们的API。这是可选的，但是如果你的API需要登录认证和需要浏览API，这两个视图也非常有用。</p>\n<h4 id=\"设置（Settings）\"><a href=\"#设置（Settings）\" class=\"headerlink\" title=\"设置（Settings）\"></a>设置（Settings）</h4><p>我们需要一点点全局设置，比如需要分页或者想让我们的API只能由admin用户使用，这些配置都需要在tutorial/settings.py中。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">INSTALLED_APPS = (</span><br><span class=\"line\">    ...</span><br><span class=\"line\">    <span class=\"string\">'rest_framework'</span>,</span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\">REST_FRAMEWORK = &#123;</span><br><span class=\"line\">    <span class=\"string\">'DEFAULT_PERMISSION_CLASSES'</span>: [</span><br><span class=\"line\">        <span class=\"string\">'rest_framework.permissions.IsAdminUser'</span>,</span><br><span class=\"line\">    ],</span><br><span class=\"line\">    <span class=\"string\">'PAGE_SIZE'</span>: <span class=\"number\">10</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>好了，代码我们就写完了。</p>\n<h4 id=\"测试我们的API\"><a href=\"#测试我们的API\" class=\"headerlink\" title=\"测试我们的API\"></a>测试我们的API</h4><p>首先把测试服务器打开，让应用跑起来。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">python manage.py runserver</span><br></pre></td></tr></table></figure>\n<p>服务开启正常后，我们就可以使用curl或者浏览器来测试api了。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PS E:\\Study\\tutorial\\tutorial&gt; http -a admin:password123 http://127.0.0.1:8000/users/</span><br><span class=\"line\">HTTP/1.0 200 OK</span><br><span class=\"line\">Allow: GET, POST, HEAD, OPTIONS</span><br><span class=\"line\">Content-Length: 103</span><br><span class=\"line\">Content-Type: application/json</span><br><span class=\"line\">Date: Tue, 10 Oct 2017 03:05:10 GMT</span><br><span class=\"line\">Server: WSGIServer/0.1 Python/2.7.13</span><br><span class=\"line\">Vary: Accept, Cookie</span><br><span class=\"line\">X-Frame-Options: SAMEORIGIN</span><br><span class=\"line\"></span><br><span class=\"line\">[</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        \"email\": \"admin@star-chen.com\",</span><br><span class=\"line\">        \"groups\": [],</span><br><span class=\"line\">        \"url\": \"http://127.0.0.1:8000/users/1/\",</span><br><span class=\"line\">        \"username\": \"admin\"</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n<p>浏览器中是这个画风，当然你得先登录。</p>\n<p><img src=\"/blogimg/quick_start.png\" alt=\"image\"></p>\n<p>ok,成功运行。</p>\n","site":{"data":{}},"excerpt":"<h3 id=\"DjangoRESTframework-快速开始\"><a href=\"#DjangoRESTframework-快速开始\" class=\"headerlink\" title=\"DjangoRESTframework  快速开始\"></a>DjangoRESTframework  快速开始</h3><p>我们将开始建立一个简单的API，让admin用户去查看和编辑系统中用户和用户组。</p>","more":"<h4 id=\"建立工程\"><a href=\"#建立工程\" class=\"headerlink\" title=\"建立工程\"></a>建立工程</h4><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 为工程建立存储目录</span></span><br><span class=\"line\">mkdir tutorial</span><br><span class=\"line\">cd tutorial</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 创建一个virtualenv，便于隔离我们的包的本地依赖</span></span><br><span class=\"line\">virtualenv env</span><br><span class=\"line\">source env/bin/activate  # 在windows环境使用命令 `env\\Scripts\\activate`</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 在virtualenv中安装django和djangorestframework框架</span></span><br><span class=\"line\">pip install django</span><br><span class=\"line\">pip install djangorestframework</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 建立一个新的project和一个新的app</span></span><br><span class=\"line\">django-admin.py startproject tutorial .  # 注意结尾的 '.' 号</span><br><span class=\"line\">cd tutorial</span><br><span class=\"line\">django-admin.py startapp quickstart</span><br><span class=\"line\">cd ..</span><br></pre></td></tr></table></figure>\n<p>工程的目录结构应该如下：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> <span class=\"built_in\">pwd</span></span></span><br><span class=\"line\">&lt;some path&gt;/tutorial</span><br><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> find .</span></span><br><span class=\"line\">.</span><br><span class=\"line\">./manage.py</span><br><span class=\"line\">./tutorial</span><br><span class=\"line\">./tutorial/__init__.py</span><br><span class=\"line\">./tutorial/quickstart</span><br><span class=\"line\">./tutorial/quickstart/__init__.py</span><br><span class=\"line\">./tutorial/quickstart/admin.py</span><br><span class=\"line\">./tutorial/quickstart/apps.py</span><br><span class=\"line\">./tutorial/quickstart/migrations</span><br><span class=\"line\">./tutorial/quickstart/migrations/__init__.py</span><br><span class=\"line\">./tutorial/quickstart/models.py</span><br><span class=\"line\">./tutorial/quickstart/tests.py</span><br><span class=\"line\">./tutorial/quickstart/views.py</span><br><span class=\"line\">./tutorial/settings.py</span><br><span class=\"line\">./tutorial/urls.py</span><br><span class=\"line\">./tutorial/wsgi.py</span><br></pre></td></tr></table></figure>\n<p>在引用外部模块的时候使用工程的命名空间来避免名称的冲突。接下来可以首先同步你的数据库：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">python manage.py migrate</span><br></pre></td></tr></table></figure>\n<p>同时我们也需要建立和初始化admin用户，并设置 admin用户的密码为password123。稍后我们将在我们的实例应用中认证其他用户。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">python manage.py createsuperuser</span><br></pre></td></tr></table></figure>\n<p>当你同步好数据库并初始化用户之后，打开工程的app目录（这里是quickstart），开始编码吧。</p>\n<h4 id=\"序列化器（Serializers）\"><a href=\"#序列化器（Serializers）\" class=\"headerlink\" title=\"序列化器（Serializers）\"></a>序列化器（Serializers）</h4><p>首先，我们需要定义一些序列化器（serializers），让我们创建一个新的模块（module），路径是tutorial/quickstart/serializers.py，这个将用来作为数据展示。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> django.contrib.auth.models <span class=\"keyword\">import</span> User, Group</span><br><span class=\"line\"><span class=\"keyword\">from</span> rest_framework <span class=\"keyword\">import</span> serializers</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">UserSerializer</span><span class=\"params\">(serializers.HyperlinkedModelSerializer)</span>:</span></span><br><span class=\"line\">    <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Meta</span>:</span></span><br><span class=\"line\">        model = User</span><br><span class=\"line\">        fields = (<span class=\"string\">'url'</span>, <span class=\"string\">'username'</span>, <span class=\"string\">'email'</span>, <span class=\"string\">'groups'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">GroupSerializer</span><span class=\"params\">(serializers.HyperlinkedModelSerializer)</span>:</span></span><br><span class=\"line\">    <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Meta</span>:</span></span><br><span class=\"line\">        model = Group</span><br><span class=\"line\">        fields = (<span class=\"string\">'url'</span>, <span class=\"string\">'name'</span>)</span><br></pre></td></tr></table></figure>\n<p>注意：这里我们继承关系的是HyperlinkedSerializers,你也可以使用主键或者其他众多的关系，但是hyperlinking是很好的RESTful设计。</p>\n<h4 id=\"视图（Views）\"><a href=\"#视图（Views）\" class=\"headerlink\" title=\"视图（Views）\"></a>视图（Views）</h4><p>我们最好再写点视图（views）吧，打开文件tutorial/quickstart/views.py，然后把下面的内容敲进去。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> django.contrib.auth.models <span class=\"keyword\">import</span> User, Group</span><br><span class=\"line\"><span class=\"keyword\">from</span> rest_framework <span class=\"keyword\">import</span> viewsets</span><br><span class=\"line\"><span class=\"keyword\">from</span> tutorial.quickstart.serializers <span class=\"keyword\">import</span> UserSerializer, GroupSerializer</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">UserViewSet</span><span class=\"params\">(viewsets.ModelViewSet)</span>:</span></span><br><span class=\"line\">    <span class=\"string\">\"\"\"</span></span><br><span class=\"line\"><span class=\"string\">    API endpoint that allows users to be viewed or edited.</span></span><br><span class=\"line\"><span class=\"string\">    \"\"\"</span></span><br><span class=\"line\">    queryset = User.objects.all().order_by(<span class=\"string\">'-date_joined'</span>)</span><br><span class=\"line\">    serializer_class = UserSerializer</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">GroupViewSet</span><span class=\"params\">(viewsets.ModelViewSet)</span>:</span></span><br><span class=\"line\">    <span class=\"string\">\"\"\"</span></span><br><span class=\"line\"><span class=\"string\">    API endpoint that allows groups to be viewed or edited.</span></span><br><span class=\"line\"><span class=\"string\">    \"\"\"</span></span><br><span class=\"line\">    queryset = Group.objects.all()</span><br><span class=\"line\">    serializer_class = GroupSerializer</span><br></pre></td></tr></table></figure>\n<p>比起写非常多的视图，我们将所有视图的许多共同行为（common behavior）放进了ViewSets类中。如果有需要，我们可以非常容易的将他们拆成单独的视图，但是使用viewsets可以保持良好的视图逻辑和简洁的代码。</p>\n<h4 id=\"URL配置（URLs\"><a href=\"#URL配置（URLs\" class=\"headerlink\" title=\"URL配置（URLs)\"></a>URL配置（URLs)</h4><p>接下来我们可以定义API的url路径了，文件是tutorial/urls.py</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> django.conf.urls <span class=\"keyword\">import</span> url, include</span><br><span class=\"line\"><span class=\"keyword\">from</span> rest_framework <span class=\"keyword\">import</span> routers</span><br><span class=\"line\"><span class=\"keyword\">from</span> tutorial.quickstart <span class=\"keyword\">import</span> views</span><br><span class=\"line\"></span><br><span class=\"line\">router = routers.DefaultRouter()</span><br><span class=\"line\">router.register(<span class=\"string\">r'users'</span>, views.UserViewSet)</span><br><span class=\"line\">router.register(<span class=\"string\">r'groups'</span>, views.GroupViewSet)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Wire up our API using automatic URL routing.</span></span><br><span class=\"line\"><span class=\"comment\"># Additionally, we include login URLs for the browsable API.</span></span><br><span class=\"line\">urlpatterns = [</span><br><span class=\"line\">    url(<span class=\"string\">r'^'</span>, include(router.urls)),</span><br><span class=\"line\">    url(<span class=\"string\">r'^api-auth/'</span>, include(<span class=\"string\">'rest_framework.urls'</span>, namespace=<span class=\"string\">'rest_framework'</span>))</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n<p>由于我们使用了viewsets代替了views，我们的API可以自动成成URL配置，只需要将viewsets注册到router class中即可。</p>\n<p>同样，如果我们需要对API的URL获得更多的控制，也可以使用传统的class-based视图，然后自己配置URL。</p>\n<p>最后，我们可以包含登录和登出视图来浏览我们的API。这是可选的，但是如果你的API需要登录认证和需要浏览API，这两个视图也非常有用。</p>\n<h4 id=\"设置（Settings）\"><a href=\"#设置（Settings）\" class=\"headerlink\" title=\"设置（Settings）\"></a>设置（Settings）</h4><p>我们需要一点点全局设置，比如需要分页或者想让我们的API只能由admin用户使用，这些配置都需要在tutorial/settings.py中。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">INSTALLED_APPS = (</span><br><span class=\"line\">    ...</span><br><span class=\"line\">    <span class=\"string\">'rest_framework'</span>,</span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\">REST_FRAMEWORK = &#123;</span><br><span class=\"line\">    <span class=\"string\">'DEFAULT_PERMISSION_CLASSES'</span>: [</span><br><span class=\"line\">        <span class=\"string\">'rest_framework.permissions.IsAdminUser'</span>,</span><br><span class=\"line\">    ],</span><br><span class=\"line\">    <span class=\"string\">'PAGE_SIZE'</span>: <span class=\"number\">10</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>好了，代码我们就写完了。</p>\n<h4 id=\"测试我们的API\"><a href=\"#测试我们的API\" class=\"headerlink\" title=\"测试我们的API\"></a>测试我们的API</h4><p>首先把测试服务器打开，让应用跑起来。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">python manage.py runserver</span><br></pre></td></tr></table></figure>\n<p>服务开启正常后，我们就可以使用curl或者浏览器来测试api了。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PS E:\\Study\\tutorial\\tutorial&gt; http -a admin:password123 http://127.0.0.1:8000/users/</span><br><span class=\"line\">HTTP/1.0 200 OK</span><br><span class=\"line\">Allow: GET, POST, HEAD, OPTIONS</span><br><span class=\"line\">Content-Length: 103</span><br><span class=\"line\">Content-Type: application/json</span><br><span class=\"line\">Date: Tue, 10 Oct 2017 03:05:10 GMT</span><br><span class=\"line\">Server: WSGIServer/0.1 Python/2.7.13</span><br><span class=\"line\">Vary: Accept, Cookie</span><br><span class=\"line\">X-Frame-Options: SAMEORIGIN</span><br><span class=\"line\"></span><br><span class=\"line\">[</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        \"email\": \"admin@star-chen.com\",</span><br><span class=\"line\">        \"groups\": [],</span><br><span class=\"line\">        \"url\": \"http://127.0.0.1:8000/users/1/\",</span><br><span class=\"line\">        \"username\": \"admin\"</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n<p>浏览器中是这个画风，当然你得先登录。</p>\n<p><img src=\"/blogimg/quick_start.png\" alt=\"image\"></p>\n<p>ok,成功运行。</p>"},{"title":"动手学Docker系列---在操作系统上安装Docker","date":"2017-06-02T10:48:13.000Z","_content":"\n### What is Docker?\n\n  Docker是当前相当流行的一种应用容器引擎，通过Docker容器，可以让开发者打包他们的应用以及依赖包到一个轻量级、可移植的容器中，然后发布到任何流行的Linux机器上，也可以实现虚拟化。Docker容器完全使用沙箱机制，相互之间不会有任何的接口，可以让应用得到高等级的隔离，相比于虚拟机，Docker容器更加轻量级，性能开销更低。\n\n### Docker的一些应用场景\n\n- web应用的自动化打包和发布；\n- 自动化测试和持续集成、发布；\n- 在服务性环境中部署和调整数据库或其他的后台应用；\n- 从头编译或者扩展现有的OpenShift或cloud Foundry平台来搭建自己的PaaS环境；\n\n### Docker所解决的问题\n\n- 更有序的组织\n- 更高的可移植性\n- 保护你的机器，提高安全性\n\n既然Docker容器有这么多的优点，那怎么才能使用上它呢？这篇文章就来记录一下怎么去安装Docker。\n\n<!-- more -->\n\n### 安装Docker\n\n我所使用的操作系统是Ubuntu 14.04 LTS\n\nDocker官方的安装说明地址： https://docs.docker.com/engine/installation/linux/ubuntu/  先仔细阅读一下官方的安装说明。\n\n> Recommended extra packages for Trusty 14.04\n>  Unless you have a strong reason not to, install the `linux-image-extra-*` packages, which allow Docker to use the `aufs` storage drivers.\n>\n\n看起来我使用的14.04还需要安装一下内核扩展，那安装一下先\n\n```bash\nxing@ubuntu-compile:~$ sudo apt-get install linux-image-extra-$(uname -r) linux-image-extra-virtual\n正在读取软件包列表... 完成\n正在分析软件包的依赖关系树       \n正在读取状态信息... 完成       \nlinux-image-extra-3.19.0-33-generic 已经是最新的版本了。\nlinux-image-extra-3.19.0-33-generic 被设置为手动安装。\n下列软件包是自动安装的并且现在不需要了：\n  linux-headers-3.19.0-25 linux-headers-3.19.0-25-generic\n  linux-image-3.19.0-25-generic linux-image-extra-3.19.0-25-generic\nUse 'apt-get autoremove' to remove them.\n将会安装下列额外的软件包：\n  linux-image-3.13.0-119-generic linux-image-extra-3.13.0-119-generic\n  linux-image-generic\n建议安装的软件包：\n  fdutils linux-doc-3.13.0 linux-source-3.13.0 linux-tools\n  linux-headers-3.13.0-119-generic\n下列【新】软件包将被安装：\n  linux-image-3.13.0-119-generic linux-image-extra-3.13.0-119-generic\n  linux-image-extra-virtual linux-image-generic\n升级了 0 个软件包，新安装了 4 个软件包，要卸载 0 个软件包，有 89 个软件包未被升级。\n需要下载 52.0 MB 的软件包。\n解压缩后会消耗掉 195 MB 的额外空间。\n您希望继续执行吗？ [Y/n] \n```\n\n官方网站上介绍了两种安装方式，一是从软件仓库安装，而是下载deb安装包，手动安装。\n\n- 从软件仓库安装\n\n```bash\n$ sudo apt-get install \\\n    apt-transport-https \\\n    ca-certificates \\\n    curl \\\n    software-properties-common\n```\n\n```bash\n$ curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -\n```\n\n```bash\n$ sudo apt-key fingerprint 0EBFCD88\n\npub   4096R/0EBFCD88 2017-02-22\n      Key fingerprint = 9DC8 5822 9FC7 DD38 854A  E2D8 8D81 803C 0EBF CD88\nuid                  Docker Release (CE deb) <docker@docker.com>\nsub   4096R/F273FCD8 2017-02-22\n```\n\n```bash\n$ sudo add-apt-repository \\\n   \"deb [arch=amd64] https://download.docker.com/linux/ubuntu \\\n   $(lsb_release -cs) \\\n   stable\"\n```\n\n```bash\n$ sudo apt-get update\n$ sudo apt-get install docker-ce\n```\n\n\n\n- 下载deb包，手动安装\n\n浏览器打开  [https://download.docker.com/linux/ubuntu/dists/](https://download.docker.com/linux/ubuntu/dists/)  选择适合系统版本的deb包下载。\n\n我选择手动下载deb包进行安装。\n\n```bash\nxing@ubuntu-compile:~$ wget https://download.docker.com/linux/ubuntu/dists/trusty/pool/stable/amd64/docker-ce_17.03.1~ce-0~ubuntu-trusty_amd64.deb\n```\n\n吐槽一句，下载的速度这是太慢了------------终于下载好了\n\n```bash\nxing@ubuntu-compile:~$ sudo dpkg -i docker-ce_17.03.1~ce-0~ubuntu-trusty_amd64.deb \n[sudo] password for xing: \n正在选中未选择的软件包 docker-ce。\n(正在读取数据库 ... 系统当前共安装有 144928 个文件和目录。)\n正准备解包 docker-ce_17.03.1~ce-0~ubuntu-trusty_amd64.deb  ...\n正在解包 docker-ce (17.03.1~ce-0~ubuntu-trusty) ...\ndpkg: 依赖关系问题使得 docker-ce 的配置工作不能继续：\n docker-ce 依赖于 libltdl7 (>= 2.4.2)；然而：\n  未安装软件包 libltdl7。\n docker-ce 依赖于 libsystemd-journal0 (>= 201)；然而：\n  未安装软件包 libsystemd-journal0。\n\ndpkg: 处理软件包 docker-ce (--install)时出错：\n 依赖关系问题 - 仍未被配置\n正在处理用于 man-db (2.6.7.1-1ubuntu1) 的触发器 ...\n正在处理用于 ureadahead (0.100.0-16) 的触发器 ...\n在处理时有错误发生：\n docker-ce\n\n```\n\n好像出了点问题，需要依赖，那么安装一下依赖吧。\n\n```bash\nxing@ubuntu-compile:~$ sudo apt-get -f install\nxing@ubuntu-compile:~$ sudo dpkg -i docker-ce_17.03.1~ce-0~ubuntu-trusty_amd64.deb \n(正在读取数据库 ... 系统当前共安装有 145148 个文件和目录。)\n正准备解包 docker-ce_17.03.1~ce-0~ubuntu-trusty_amd64.deb  ...\ndocker stop/waiting\n正在将 docker-ce (17.03.1~ce-0~ubuntu-trusty) 解包到 (17.03.1~ce-0~ubuntu-trusty) 上 ...\n正在设置 docker-ce (17.03.1~ce-0~ubuntu-trusty) ...\ndocker start/running, process 2629\n正在处理用于 man-db (2.6.7.1-1ubuntu1) 的触发器 ...\n正在处理用于 ureadahead (0.100.0-16) 的触发器 ...\n\n```\n\n这些安装好了！！加载一个Hello World镜像尝试一下\n\n### Docker Hello World\n\n```bash\nxing@ubuntu-compile:~$ sudo docker run dockerinaction/hello_world\nUnable to find image 'dockerinaction/hello_world:latest' locally\nlatest: Pulling from dockerinaction/hello_world\na3ed95caeb02: Pull complete \n1db09adb5ddd: Pull complete \nDigest: sha256:cfebf86139a3b21797765a3960e13dee000bcf332be0be529858fca840c00d7f\nStatus: Downloaded newer image for dockerinaction/hello_world:latest\nhello world\n\n```\n\n可以看到，docker是先检查本地是否有hello_world镜像，发现不存在，再去镜像市场拉取到本地，再进行运行的。最后已经打印出了hello world，说明我们的docker已经安装成功了！\n\n再来运行hello_world看看有什么不一样\n\n```bash\nxing@ubuntu-compile:~$ sudo docker run dockerinaction/hello_world\nhello world\n\n```\n\n直接打印出了hello world ，说明镜像已经存在，docker直接是运行的本地的镜像。\n\n-----------安装篇完\n\n参考资料：\n\n https://docs.docker.com/engine/installation/linux\n\n《Docker实战》\n\nhttp://www.runoob.com/docker/ubuntu-docker-install.html\n\nhttp://www.docker.org.cn/book/docker/what-is-docker-16.html","source":"_posts/DokerStudy-install.md","raw":"---\ntitle: 动手学Docker系列---在操作系统上安装Docker\ncategories:\n  - Linux\ntags:\n  - docker\ndate: 2017-06-02 18:48:13\n---\n\n### What is Docker?\n\n  Docker是当前相当流行的一种应用容器引擎，通过Docker容器，可以让开发者打包他们的应用以及依赖包到一个轻量级、可移植的容器中，然后发布到任何流行的Linux机器上，也可以实现虚拟化。Docker容器完全使用沙箱机制，相互之间不会有任何的接口，可以让应用得到高等级的隔离，相比于虚拟机，Docker容器更加轻量级，性能开销更低。\n\n### Docker的一些应用场景\n\n- web应用的自动化打包和发布；\n- 自动化测试和持续集成、发布；\n- 在服务性环境中部署和调整数据库或其他的后台应用；\n- 从头编译或者扩展现有的OpenShift或cloud Foundry平台来搭建自己的PaaS环境；\n\n### Docker所解决的问题\n\n- 更有序的组织\n- 更高的可移植性\n- 保护你的机器，提高安全性\n\n既然Docker容器有这么多的优点，那怎么才能使用上它呢？这篇文章就来记录一下怎么去安装Docker。\n\n<!-- more -->\n\n### 安装Docker\n\n我所使用的操作系统是Ubuntu 14.04 LTS\n\nDocker官方的安装说明地址： https://docs.docker.com/engine/installation/linux/ubuntu/  先仔细阅读一下官方的安装说明。\n\n> Recommended extra packages for Trusty 14.04\n>  Unless you have a strong reason not to, install the `linux-image-extra-*` packages, which allow Docker to use the `aufs` storage drivers.\n>\n\n看起来我使用的14.04还需要安装一下内核扩展，那安装一下先\n\n```bash\nxing@ubuntu-compile:~$ sudo apt-get install linux-image-extra-$(uname -r) linux-image-extra-virtual\n正在读取软件包列表... 完成\n正在分析软件包的依赖关系树       \n正在读取状态信息... 完成       \nlinux-image-extra-3.19.0-33-generic 已经是最新的版本了。\nlinux-image-extra-3.19.0-33-generic 被设置为手动安装。\n下列软件包是自动安装的并且现在不需要了：\n  linux-headers-3.19.0-25 linux-headers-3.19.0-25-generic\n  linux-image-3.19.0-25-generic linux-image-extra-3.19.0-25-generic\nUse 'apt-get autoremove' to remove them.\n将会安装下列额外的软件包：\n  linux-image-3.13.0-119-generic linux-image-extra-3.13.0-119-generic\n  linux-image-generic\n建议安装的软件包：\n  fdutils linux-doc-3.13.0 linux-source-3.13.0 linux-tools\n  linux-headers-3.13.0-119-generic\n下列【新】软件包将被安装：\n  linux-image-3.13.0-119-generic linux-image-extra-3.13.0-119-generic\n  linux-image-extra-virtual linux-image-generic\n升级了 0 个软件包，新安装了 4 个软件包，要卸载 0 个软件包，有 89 个软件包未被升级。\n需要下载 52.0 MB 的软件包。\n解压缩后会消耗掉 195 MB 的额外空间。\n您希望继续执行吗？ [Y/n] \n```\n\n官方网站上介绍了两种安装方式，一是从软件仓库安装，而是下载deb安装包，手动安装。\n\n- 从软件仓库安装\n\n```bash\n$ sudo apt-get install \\\n    apt-transport-https \\\n    ca-certificates \\\n    curl \\\n    software-properties-common\n```\n\n```bash\n$ curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -\n```\n\n```bash\n$ sudo apt-key fingerprint 0EBFCD88\n\npub   4096R/0EBFCD88 2017-02-22\n      Key fingerprint = 9DC8 5822 9FC7 DD38 854A  E2D8 8D81 803C 0EBF CD88\nuid                  Docker Release (CE deb) <docker@docker.com>\nsub   4096R/F273FCD8 2017-02-22\n```\n\n```bash\n$ sudo add-apt-repository \\\n   \"deb [arch=amd64] https://download.docker.com/linux/ubuntu \\\n   $(lsb_release -cs) \\\n   stable\"\n```\n\n```bash\n$ sudo apt-get update\n$ sudo apt-get install docker-ce\n```\n\n\n\n- 下载deb包，手动安装\n\n浏览器打开  [https://download.docker.com/linux/ubuntu/dists/](https://download.docker.com/linux/ubuntu/dists/)  选择适合系统版本的deb包下载。\n\n我选择手动下载deb包进行安装。\n\n```bash\nxing@ubuntu-compile:~$ wget https://download.docker.com/linux/ubuntu/dists/trusty/pool/stable/amd64/docker-ce_17.03.1~ce-0~ubuntu-trusty_amd64.deb\n```\n\n吐槽一句，下载的速度这是太慢了------------终于下载好了\n\n```bash\nxing@ubuntu-compile:~$ sudo dpkg -i docker-ce_17.03.1~ce-0~ubuntu-trusty_amd64.deb \n[sudo] password for xing: \n正在选中未选择的软件包 docker-ce。\n(正在读取数据库 ... 系统当前共安装有 144928 个文件和目录。)\n正准备解包 docker-ce_17.03.1~ce-0~ubuntu-trusty_amd64.deb  ...\n正在解包 docker-ce (17.03.1~ce-0~ubuntu-trusty) ...\ndpkg: 依赖关系问题使得 docker-ce 的配置工作不能继续：\n docker-ce 依赖于 libltdl7 (>= 2.4.2)；然而：\n  未安装软件包 libltdl7。\n docker-ce 依赖于 libsystemd-journal0 (>= 201)；然而：\n  未安装软件包 libsystemd-journal0。\n\ndpkg: 处理软件包 docker-ce (--install)时出错：\n 依赖关系问题 - 仍未被配置\n正在处理用于 man-db (2.6.7.1-1ubuntu1) 的触发器 ...\n正在处理用于 ureadahead (0.100.0-16) 的触发器 ...\n在处理时有错误发生：\n docker-ce\n\n```\n\n好像出了点问题，需要依赖，那么安装一下依赖吧。\n\n```bash\nxing@ubuntu-compile:~$ sudo apt-get -f install\nxing@ubuntu-compile:~$ sudo dpkg -i docker-ce_17.03.1~ce-0~ubuntu-trusty_amd64.deb \n(正在读取数据库 ... 系统当前共安装有 145148 个文件和目录。)\n正准备解包 docker-ce_17.03.1~ce-0~ubuntu-trusty_amd64.deb  ...\ndocker stop/waiting\n正在将 docker-ce (17.03.1~ce-0~ubuntu-trusty) 解包到 (17.03.1~ce-0~ubuntu-trusty) 上 ...\n正在设置 docker-ce (17.03.1~ce-0~ubuntu-trusty) ...\ndocker start/running, process 2629\n正在处理用于 man-db (2.6.7.1-1ubuntu1) 的触发器 ...\n正在处理用于 ureadahead (0.100.0-16) 的触发器 ...\n\n```\n\n这些安装好了！！加载一个Hello World镜像尝试一下\n\n### Docker Hello World\n\n```bash\nxing@ubuntu-compile:~$ sudo docker run dockerinaction/hello_world\nUnable to find image 'dockerinaction/hello_world:latest' locally\nlatest: Pulling from dockerinaction/hello_world\na3ed95caeb02: Pull complete \n1db09adb5ddd: Pull complete \nDigest: sha256:cfebf86139a3b21797765a3960e13dee000bcf332be0be529858fca840c00d7f\nStatus: Downloaded newer image for dockerinaction/hello_world:latest\nhello world\n\n```\n\n可以看到，docker是先检查本地是否有hello_world镜像，发现不存在，再去镜像市场拉取到本地，再进行运行的。最后已经打印出了hello world，说明我们的docker已经安装成功了！\n\n再来运行hello_world看看有什么不一样\n\n```bash\nxing@ubuntu-compile:~$ sudo docker run dockerinaction/hello_world\nhello world\n\n```\n\n直接打印出了hello world ，说明镜像已经存在，docker直接是运行的本地的镜像。\n\n-----------安装篇完\n\n参考资料：\n\n https://docs.docker.com/engine/installation/linux\n\n《Docker实战》\n\nhttp://www.runoob.com/docker/ubuntu-docker-install.html\n\nhttp://www.docker.org.cn/book/docker/what-is-docker-16.html","slug":"DokerStudy-install","published":1,"updated":"2017-12-04T07:27:28.756Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjeqig1lk001plgqadckgmezn","content":"<h3 id=\"What-is-Docker\"><a href=\"#What-is-Docker\" class=\"headerlink\" title=\"What is Docker?\"></a>What is Docker?</h3><p>  Docker是当前相当流行的一种应用容器引擎，通过Docker容器，可以让开发者打包他们的应用以及依赖包到一个轻量级、可移植的容器中，然后发布到任何流行的Linux机器上，也可以实现虚拟化。Docker容器完全使用沙箱机制，相互之间不会有任何的接口，可以让应用得到高等级的隔离，相比于虚拟机，Docker容器更加轻量级，性能开销更低。</p>\n<h3 id=\"Docker的一些应用场景\"><a href=\"#Docker的一些应用场景\" class=\"headerlink\" title=\"Docker的一些应用场景\"></a>Docker的一些应用场景</h3><ul>\n<li>web应用的自动化打包和发布；</li>\n<li>自动化测试和持续集成、发布；</li>\n<li>在服务性环境中部署和调整数据库或其他的后台应用；</li>\n<li>从头编译或者扩展现有的OpenShift或cloud Foundry平台来搭建自己的PaaS环境；</li>\n</ul>\n<h3 id=\"Docker所解决的问题\"><a href=\"#Docker所解决的问题\" class=\"headerlink\" title=\"Docker所解决的问题\"></a>Docker所解决的问题</h3><ul>\n<li>更有序的组织</li>\n<li>更高的可移植性</li>\n<li>保护你的机器，提高安全性</li>\n</ul>\n<p>既然Docker容器有这么多的优点，那怎么才能使用上它呢？这篇文章就来记录一下怎么去安装Docker。</p>\n<a id=\"more\"></a>\n<h3 id=\"安装Docker\"><a href=\"#安装Docker\" class=\"headerlink\" title=\"安装Docker\"></a>安装Docker</h3><p>我所使用的操作系统是Ubuntu 14.04 LTS</p>\n<p>Docker官方的安装说明地址： <a href=\"https://docs.docker.com/engine/installation/linux/ubuntu/\" target=\"_blank\" rel=\"noopener\">https://docs.docker.com/engine/installation/linux/ubuntu/</a>  先仔细阅读一下官方的安装说明。</p>\n<blockquote>\n<p>Recommended extra packages for Trusty 14.04<br> Unless you have a strong reason not to, install the <code>linux-image-extra-*</code> packages, which allow Docker to use the <code>aufs</code> storage drivers.</p>\n</blockquote>\n<p>看起来我使用的14.04还需要安装一下内核扩展，那安装一下先</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">xing@ubuntu-compile:~$ sudo apt-get install linux-image-extra-$(uname -r) linux-image-extra-virtual</span><br><span class=\"line\">正在读取软件包列表... 完成</span><br><span class=\"line\">正在分析软件包的依赖关系树       </span><br><span class=\"line\">正在读取状态信息... 完成       </span><br><span class=\"line\">linux-image-extra-3.19.0-33-generic 已经是最新的版本了。</span><br><span class=\"line\">linux-image-extra-3.19.0-33-generic 被设置为手动安装。</span><br><span class=\"line\">下列软件包是自动安装的并且现在不需要了：</span><br><span class=\"line\">  linux-headers-3.19.0-25 linux-headers-3.19.0-25-generic</span><br><span class=\"line\">  linux-image-3.19.0-25-generic linux-image-extra-3.19.0-25-generic</span><br><span class=\"line\">Use <span class=\"string\">'apt-get autoremove'</span> to remove them.</span><br><span class=\"line\">将会安装下列额外的软件包：</span><br><span class=\"line\">  linux-image-3.13.0-119-generic linux-image-extra-3.13.0-119-generic</span><br><span class=\"line\">  linux-image-generic</span><br><span class=\"line\">建议安装的软件包：</span><br><span class=\"line\">  fdutils linux-doc-3.13.0 linux-source-3.13.0 linux-tools</span><br><span class=\"line\">  linux-headers-3.13.0-119-generic</span><br><span class=\"line\">下列【新】软件包将被安装：</span><br><span class=\"line\">  linux-image-3.13.0-119-generic linux-image-extra-3.13.0-119-generic</span><br><span class=\"line\">  linux-image-extra-virtual linux-image-generic</span><br><span class=\"line\">升级了 0 个软件包，新安装了 4 个软件包，要卸载 0 个软件包，有 89 个软件包未被升级。</span><br><span class=\"line\">需要下载 52.0 MB 的软件包。</span><br><span class=\"line\">解压缩后会消耗掉 195 MB 的额外空间。</span><br><span class=\"line\">您希望继续执行吗？ [Y/n]</span><br></pre></td></tr></table></figure>\n<p>官方网站上介绍了两种安装方式，一是从软件仓库安装，而是下载deb安装包，手动安装。</p>\n<ul>\n<li>从软件仓库安装</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo apt-get install \\</span><br><span class=\"line\">    apt-transport-https \\</span><br><span class=\"line\">    ca-certificates \\</span><br><span class=\"line\">    curl \\</span><br><span class=\"line\">    software-properties-common</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo apt-key fingerprint 0EBFCD88</span><br><span class=\"line\"></span><br><span class=\"line\">pub   4096R/0EBFCD88 2017-02-22</span><br><span class=\"line\">      Key fingerprint = 9DC8 5822 9FC7 DD38 854A  E2D8 8D81 803C 0EBF CD88</span><br><span class=\"line\">uid                  Docker Release (CE deb) &lt;docker@docker.com&gt;</span><br><span class=\"line\">sub   4096R/F273FCD8 2017-02-22</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo add-apt-repository \\</span><br><span class=\"line\">   <span class=\"string\">\"deb [arch=amd64] https://download.docker.com/linux/ubuntu \\</span></span><br><span class=\"line\"><span class=\"string\">   <span class=\"variable\">$(lsb_release -cs)</span> \\</span></span><br><span class=\"line\"><span class=\"string\">   stable\"</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo apt-get update</span><br><span class=\"line\">$ sudo apt-get install docker-ce</span><br></pre></td></tr></table></figure>\n<ul>\n<li>下载deb包，手动安装</li>\n</ul>\n<p>浏览器打开  <a href=\"https://download.docker.com/linux/ubuntu/dists/\" target=\"_blank\" rel=\"noopener\">https://download.docker.com/linux/ubuntu/dists/</a>  选择适合系统版本的deb包下载。</p>\n<p>我选择手动下载deb包进行安装。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">xing@ubuntu-compile:~$ wget https://download.docker.com/linux/ubuntu/dists/trusty/pool/stable/amd64/docker-ce_17.03.1~ce-0~ubuntu-trusty_amd64.deb</span><br></pre></td></tr></table></figure>\n<p>吐槽一句，下载的速度这是太慢了————终于下载好了</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">xing@ubuntu-compile:~$ sudo dpkg -i docker-ce_17.03.1~ce-0~ubuntu-trusty_amd64.deb </span><br><span class=\"line\">[sudo] password <span class=\"keyword\">for</span> xing: </span><br><span class=\"line\">正在选中未选择的软件包 docker-ce。</span><br><span class=\"line\">(正在读取数据库 ... 系统当前共安装有 144928 个文件和目录。)</span><br><span class=\"line\">正准备解包 docker-ce_17.03.1~ce-0~ubuntu-trusty_amd64.deb  ...</span><br><span class=\"line\">正在解包 docker-ce (17.03.1~ce-0~ubuntu-trusty) ...</span><br><span class=\"line\">dpkg: 依赖关系问题使得 docker-ce 的配置工作不能继续：</span><br><span class=\"line\"> docker-ce 依赖于 libltdl7 (&gt;= 2.4.2)；然而：</span><br><span class=\"line\">  未安装软件包 libltdl7。</span><br><span class=\"line\"> docker-ce 依赖于 libsystemd-journal0 (&gt;= 201)；然而：</span><br><span class=\"line\">  未安装软件包 libsystemd-journal0。</span><br><span class=\"line\"></span><br><span class=\"line\">dpkg: 处理软件包 docker-ce (--install)时出错：</span><br><span class=\"line\"> 依赖关系问题 - 仍未被配置</span><br><span class=\"line\">正在处理用于 man-db (2.6.7.1-1ubuntu1) 的触发器 ...</span><br><span class=\"line\">正在处理用于 ureadahead (0.100.0-16) 的触发器 ...</span><br><span class=\"line\">在处理时有错误发生：</span><br><span class=\"line\"> docker-ce</span><br></pre></td></tr></table></figure>\n<p>好像出了点问题，需要依赖，那么安装一下依赖吧。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">xing@ubuntu-compile:~$ sudo apt-get -f install</span><br><span class=\"line\">xing@ubuntu-compile:~$ sudo dpkg -i docker-ce_17.03.1~ce-0~ubuntu-trusty_amd64.deb </span><br><span class=\"line\">(正在读取数据库 ... 系统当前共安装有 145148 个文件和目录。)</span><br><span class=\"line\">正准备解包 docker-ce_17.03.1~ce-0~ubuntu-trusty_amd64.deb  ...</span><br><span class=\"line\">docker stop/waiting</span><br><span class=\"line\">正在将 docker-ce (17.03.1~ce-0~ubuntu-trusty) 解包到 (17.03.1~ce-0~ubuntu-trusty) 上 ...</span><br><span class=\"line\">正在设置 docker-ce (17.03.1~ce-0~ubuntu-trusty) ...</span><br><span class=\"line\">docker start/running, process 2629</span><br><span class=\"line\">正在处理用于 man-db (2.6.7.1-1ubuntu1) 的触发器 ...</span><br><span class=\"line\">正在处理用于 ureadahead (0.100.0-16) 的触发器 ...</span><br></pre></td></tr></table></figure>\n<p>这些安装好了！！加载一个Hello World镜像尝试一下</p>\n<h3 id=\"Docker-Hello-World\"><a href=\"#Docker-Hello-World\" class=\"headerlink\" title=\"Docker Hello World\"></a>Docker Hello World</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">xing@ubuntu-compile:~$ sudo docker run dockerinaction/hello_world</span><br><span class=\"line\">Unable to find image <span class=\"string\">'dockerinaction/hello_world:latest'</span> locally</span><br><span class=\"line\">latest: Pulling from dockerinaction/hello_world</span><br><span class=\"line\">a3ed95caeb02: Pull complete </span><br><span class=\"line\">1db09adb5ddd: Pull complete </span><br><span class=\"line\">Digest: sha256:cfebf86139a3b21797765a3960e13dee000bcf332be0be529858fca840c00d7f</span><br><span class=\"line\">Status: Downloaded newer image <span class=\"keyword\">for</span> dockerinaction/hello_world:latest</span><br><span class=\"line\">hello world</span><br></pre></td></tr></table></figure>\n<p>可以看到，docker是先检查本地是否有hello_world镜像，发现不存在，再去镜像市场拉取到本地，再进行运行的。最后已经打印出了hello world，说明我们的docker已经安装成功了！</p>\n<p>再来运行hello_world看看有什么不一样</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">xing@ubuntu-compile:~$ sudo docker run dockerinaction/hello_world</span><br><span class=\"line\">hello world</span><br></pre></td></tr></table></figure>\n<p>直接打印出了hello world ，说明镜像已经存在，docker直接是运行的本地的镜像。</p>\n<p>———–安装篇完</p>\n<p>参考资料：</p>\n<p> <a href=\"https://docs.docker.com/engine/installation/linux\" target=\"_blank\" rel=\"noopener\">https://docs.docker.com/engine/installation/linux</a></p>\n<p>《Docker实战》</p>\n<p><a href=\"http://www.runoob.com/docker/ubuntu-docker-install.html\" target=\"_blank\" rel=\"noopener\">http://www.runoob.com/docker/ubuntu-docker-install.html</a></p>\n<p><a href=\"http://www.docker.org.cn/book/docker/what-is-docker-16.html\" target=\"_blank\" rel=\"noopener\">http://www.docker.org.cn/book/docker/what-is-docker-16.html</a></p>\n","site":{"data":{}},"excerpt":"<h3 id=\"What-is-Docker\"><a href=\"#What-is-Docker\" class=\"headerlink\" title=\"What is Docker?\"></a>What is Docker?</h3><p>  Docker是当前相当流行的一种应用容器引擎，通过Docker容器，可以让开发者打包他们的应用以及依赖包到一个轻量级、可移植的容器中，然后发布到任何流行的Linux机器上，也可以实现虚拟化。Docker容器完全使用沙箱机制，相互之间不会有任何的接口，可以让应用得到高等级的隔离，相比于虚拟机，Docker容器更加轻量级，性能开销更低。</p>\n<h3 id=\"Docker的一些应用场景\"><a href=\"#Docker的一些应用场景\" class=\"headerlink\" title=\"Docker的一些应用场景\"></a>Docker的一些应用场景</h3><ul>\n<li>web应用的自动化打包和发布；</li>\n<li>自动化测试和持续集成、发布；</li>\n<li>在服务性环境中部署和调整数据库或其他的后台应用；</li>\n<li>从头编译或者扩展现有的OpenShift或cloud Foundry平台来搭建自己的PaaS环境；</li>\n</ul>\n<h3 id=\"Docker所解决的问题\"><a href=\"#Docker所解决的问题\" class=\"headerlink\" title=\"Docker所解决的问题\"></a>Docker所解决的问题</h3><ul>\n<li>更有序的组织</li>\n<li>更高的可移植性</li>\n<li>保护你的机器，提高安全性</li>\n</ul>\n<p>既然Docker容器有这么多的优点，那怎么才能使用上它呢？这篇文章就来记录一下怎么去安装Docker。</p>","more":"<h3 id=\"安装Docker\"><a href=\"#安装Docker\" class=\"headerlink\" title=\"安装Docker\"></a>安装Docker</h3><p>我所使用的操作系统是Ubuntu 14.04 LTS</p>\n<p>Docker官方的安装说明地址： <a href=\"https://docs.docker.com/engine/installation/linux/ubuntu/\" target=\"_blank\" rel=\"noopener\">https://docs.docker.com/engine/installation/linux/ubuntu/</a>  先仔细阅读一下官方的安装说明。</p>\n<blockquote>\n<p>Recommended extra packages for Trusty 14.04<br> Unless you have a strong reason not to, install the <code>linux-image-extra-*</code> packages, which allow Docker to use the <code>aufs</code> storage drivers.</p>\n</blockquote>\n<p>看起来我使用的14.04还需要安装一下内核扩展，那安装一下先</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">xing@ubuntu-compile:~$ sudo apt-get install linux-image-extra-$(uname -r) linux-image-extra-virtual</span><br><span class=\"line\">正在读取软件包列表... 完成</span><br><span class=\"line\">正在分析软件包的依赖关系树       </span><br><span class=\"line\">正在读取状态信息... 完成       </span><br><span class=\"line\">linux-image-extra-3.19.0-33-generic 已经是最新的版本了。</span><br><span class=\"line\">linux-image-extra-3.19.0-33-generic 被设置为手动安装。</span><br><span class=\"line\">下列软件包是自动安装的并且现在不需要了：</span><br><span class=\"line\">  linux-headers-3.19.0-25 linux-headers-3.19.0-25-generic</span><br><span class=\"line\">  linux-image-3.19.0-25-generic linux-image-extra-3.19.0-25-generic</span><br><span class=\"line\">Use <span class=\"string\">'apt-get autoremove'</span> to remove them.</span><br><span class=\"line\">将会安装下列额外的软件包：</span><br><span class=\"line\">  linux-image-3.13.0-119-generic linux-image-extra-3.13.0-119-generic</span><br><span class=\"line\">  linux-image-generic</span><br><span class=\"line\">建议安装的软件包：</span><br><span class=\"line\">  fdutils linux-doc-3.13.0 linux-source-3.13.0 linux-tools</span><br><span class=\"line\">  linux-headers-3.13.0-119-generic</span><br><span class=\"line\">下列【新】软件包将被安装：</span><br><span class=\"line\">  linux-image-3.13.0-119-generic linux-image-extra-3.13.0-119-generic</span><br><span class=\"line\">  linux-image-extra-virtual linux-image-generic</span><br><span class=\"line\">升级了 0 个软件包，新安装了 4 个软件包，要卸载 0 个软件包，有 89 个软件包未被升级。</span><br><span class=\"line\">需要下载 52.0 MB 的软件包。</span><br><span class=\"line\">解压缩后会消耗掉 195 MB 的额外空间。</span><br><span class=\"line\">您希望继续执行吗？ [Y/n]</span><br></pre></td></tr></table></figure>\n<p>官方网站上介绍了两种安装方式，一是从软件仓库安装，而是下载deb安装包，手动安装。</p>\n<ul>\n<li>从软件仓库安装</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo apt-get install \\</span><br><span class=\"line\">    apt-transport-https \\</span><br><span class=\"line\">    ca-certificates \\</span><br><span class=\"line\">    curl \\</span><br><span class=\"line\">    software-properties-common</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo apt-key fingerprint 0EBFCD88</span><br><span class=\"line\"></span><br><span class=\"line\">pub   4096R/0EBFCD88 2017-02-22</span><br><span class=\"line\">      Key fingerprint = 9DC8 5822 9FC7 DD38 854A  E2D8 8D81 803C 0EBF CD88</span><br><span class=\"line\">uid                  Docker Release (CE deb) &lt;docker@docker.com&gt;</span><br><span class=\"line\">sub   4096R/F273FCD8 2017-02-22</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo add-apt-repository \\</span><br><span class=\"line\">   <span class=\"string\">\"deb [arch=amd64] https://download.docker.com/linux/ubuntu \\</span></span><br><span class=\"line\"><span class=\"string\">   <span class=\"variable\">$(lsb_release -cs)</span> \\</span></span><br><span class=\"line\"><span class=\"string\">   stable\"</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo apt-get update</span><br><span class=\"line\">$ sudo apt-get install docker-ce</span><br></pre></td></tr></table></figure>\n<ul>\n<li>下载deb包，手动安装</li>\n</ul>\n<p>浏览器打开  <a href=\"https://download.docker.com/linux/ubuntu/dists/\" target=\"_blank\" rel=\"noopener\">https://download.docker.com/linux/ubuntu/dists/</a>  选择适合系统版本的deb包下载。</p>\n<p>我选择手动下载deb包进行安装。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">xing@ubuntu-compile:~$ wget https://download.docker.com/linux/ubuntu/dists/trusty/pool/stable/amd64/docker-ce_17.03.1~ce-0~ubuntu-trusty_amd64.deb</span><br></pre></td></tr></table></figure>\n<p>吐槽一句，下载的速度这是太慢了————终于下载好了</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">xing@ubuntu-compile:~$ sudo dpkg -i docker-ce_17.03.1~ce-0~ubuntu-trusty_amd64.deb </span><br><span class=\"line\">[sudo] password <span class=\"keyword\">for</span> xing: </span><br><span class=\"line\">正在选中未选择的软件包 docker-ce。</span><br><span class=\"line\">(正在读取数据库 ... 系统当前共安装有 144928 个文件和目录。)</span><br><span class=\"line\">正准备解包 docker-ce_17.03.1~ce-0~ubuntu-trusty_amd64.deb  ...</span><br><span class=\"line\">正在解包 docker-ce (17.03.1~ce-0~ubuntu-trusty) ...</span><br><span class=\"line\">dpkg: 依赖关系问题使得 docker-ce 的配置工作不能继续：</span><br><span class=\"line\"> docker-ce 依赖于 libltdl7 (&gt;= 2.4.2)；然而：</span><br><span class=\"line\">  未安装软件包 libltdl7。</span><br><span class=\"line\"> docker-ce 依赖于 libsystemd-journal0 (&gt;= 201)；然而：</span><br><span class=\"line\">  未安装软件包 libsystemd-journal0。</span><br><span class=\"line\"></span><br><span class=\"line\">dpkg: 处理软件包 docker-ce (--install)时出错：</span><br><span class=\"line\"> 依赖关系问题 - 仍未被配置</span><br><span class=\"line\">正在处理用于 man-db (2.6.7.1-1ubuntu1) 的触发器 ...</span><br><span class=\"line\">正在处理用于 ureadahead (0.100.0-16) 的触发器 ...</span><br><span class=\"line\">在处理时有错误发生：</span><br><span class=\"line\"> docker-ce</span><br></pre></td></tr></table></figure>\n<p>好像出了点问题，需要依赖，那么安装一下依赖吧。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">xing@ubuntu-compile:~$ sudo apt-get -f install</span><br><span class=\"line\">xing@ubuntu-compile:~$ sudo dpkg -i docker-ce_17.03.1~ce-0~ubuntu-trusty_amd64.deb </span><br><span class=\"line\">(正在读取数据库 ... 系统当前共安装有 145148 个文件和目录。)</span><br><span class=\"line\">正准备解包 docker-ce_17.03.1~ce-0~ubuntu-trusty_amd64.deb  ...</span><br><span class=\"line\">docker stop/waiting</span><br><span class=\"line\">正在将 docker-ce (17.03.1~ce-0~ubuntu-trusty) 解包到 (17.03.1~ce-0~ubuntu-trusty) 上 ...</span><br><span class=\"line\">正在设置 docker-ce (17.03.1~ce-0~ubuntu-trusty) ...</span><br><span class=\"line\">docker start/running, process 2629</span><br><span class=\"line\">正在处理用于 man-db (2.6.7.1-1ubuntu1) 的触发器 ...</span><br><span class=\"line\">正在处理用于 ureadahead (0.100.0-16) 的触发器 ...</span><br></pre></td></tr></table></figure>\n<p>这些安装好了！！加载一个Hello World镜像尝试一下</p>\n<h3 id=\"Docker-Hello-World\"><a href=\"#Docker-Hello-World\" class=\"headerlink\" title=\"Docker Hello World\"></a>Docker Hello World</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">xing@ubuntu-compile:~$ sudo docker run dockerinaction/hello_world</span><br><span class=\"line\">Unable to find image <span class=\"string\">'dockerinaction/hello_world:latest'</span> locally</span><br><span class=\"line\">latest: Pulling from dockerinaction/hello_world</span><br><span class=\"line\">a3ed95caeb02: Pull complete </span><br><span class=\"line\">1db09adb5ddd: Pull complete </span><br><span class=\"line\">Digest: sha256:cfebf86139a3b21797765a3960e13dee000bcf332be0be529858fca840c00d7f</span><br><span class=\"line\">Status: Downloaded newer image <span class=\"keyword\">for</span> dockerinaction/hello_world:latest</span><br><span class=\"line\">hello world</span><br></pre></td></tr></table></figure>\n<p>可以看到，docker是先检查本地是否有hello_world镜像，发现不存在，再去镜像市场拉取到本地，再进行运行的。最后已经打印出了hello world，说明我们的docker已经安装成功了！</p>\n<p>再来运行hello_world看看有什么不一样</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">xing@ubuntu-compile:~$ sudo docker run dockerinaction/hello_world</span><br><span class=\"line\">hello world</span><br></pre></td></tr></table></figure>\n<p>直接打印出了hello world ，说明镜像已经存在，docker直接是运行的本地的镜像。</p>\n<p>———–安装篇完</p>\n<p>参考资料：</p>\n<p> <a href=\"https://docs.docker.com/engine/installation/linux\" target=\"_blank\" rel=\"noopener\">https://docs.docker.com/engine/installation/linux</a></p>\n<p>《Docker实战》</p>\n<p><a href=\"http://www.runoob.com/docker/ubuntu-docker-install.html\" target=\"_blank\" rel=\"noopener\">http://www.runoob.com/docker/ubuntu-docker-install.html</a></p>\n<p><a href=\"http://www.docker.org.cn/book/docker/what-is-docker-16.html\" target=\"_blank\" rel=\"noopener\">http://www.docker.org.cn/book/docker/what-is-docker-16.html</a></p>"},{"title":"在Django中使用PosetgreSQL数据库","date":"2017-10-12T06:40:50.000Z","_content":"\n### 在Django中使用PosetgreSQL数据库\n\nPostgres的安装过程就略过了，在Django中使用PostgreSQL只需要改一下settings.py中的数据库连接字符串就好了。\n\n<!--more-->\n\n```python\nDATABASES = {\n    'default': {\n        'ENGINE': 'django.db.backends.postgresql_psycopg2',\n        'NAME': 'testdb',\n        'USER': 'db_test',\n        'PASSWORD': 'db_test',\n        'HOST': '',\n        'PORT': '',\n    }\n}\n\n```\n\n可以用Django shell测试一下：\n\n```shell\nxing@ubuntu-server:~/pstest$ python manage.py shell\nPython 2.7.13 (default, Jan 19 2017, 14:48:08) \n[GCC 6.3.0 20170118] on linux2\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n(InteractiveConsole)\n>>> from django.db import connection\n>>> cusor = connection.cursor\n```\n\n如果没有报错的话，说明已经配置成功了。","source":"_posts/DjangowithPostgres.md","raw":"---\ntitle: 在Django中使用PosetgreSQL数据库\ncategories:\n  - Program\ntags:\n  - django\ndate: 2017-10-12 14:40:50\n---\n\n### 在Django中使用PosetgreSQL数据库\n\nPostgres的安装过程就略过了，在Django中使用PostgreSQL只需要改一下settings.py中的数据库连接字符串就好了。\n\n<!--more-->\n\n```python\nDATABASES = {\n    'default': {\n        'ENGINE': 'django.db.backends.postgresql_psycopg2',\n        'NAME': 'testdb',\n        'USER': 'db_test',\n        'PASSWORD': 'db_test',\n        'HOST': '',\n        'PORT': '',\n    }\n}\n\n```\n\n可以用Django shell测试一下：\n\n```shell\nxing@ubuntu-server:~/pstest$ python manage.py shell\nPython 2.7.13 (default, Jan 19 2017, 14:48:08) \n[GCC 6.3.0 20170118] on linux2\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n(InteractiveConsole)\n>>> from django.db import connection\n>>> cusor = connection.cursor\n```\n\n如果没有报错的话，说明已经配置成功了。","slug":"DjangowithPostgres","published":1,"updated":"2017-12-04T07:27:28.755Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjeqig1lq001slgqaagd6us92","content":"<h3 id=\"在Django中使用PosetgreSQL数据库\"><a href=\"#在Django中使用PosetgreSQL数据库\" class=\"headerlink\" title=\"在Django中使用PosetgreSQL数据库\"></a>在Django中使用PosetgreSQL数据库</h3><p>Postgres的安装过程就略过了，在Django中使用PostgreSQL只需要改一下settings.py中的数据库连接字符串就好了。</p>\n<a id=\"more\"></a>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">DATABASES = &#123;</span><br><span class=\"line\">    <span class=\"string\">'default'</span>: &#123;</span><br><span class=\"line\">        <span class=\"string\">'ENGINE'</span>: <span class=\"string\">'django.db.backends.postgresql_psycopg2'</span>,</span><br><span class=\"line\">        <span class=\"string\">'NAME'</span>: <span class=\"string\">'testdb'</span>,</span><br><span class=\"line\">        <span class=\"string\">'USER'</span>: <span class=\"string\">'db_test'</span>,</span><br><span class=\"line\">        <span class=\"string\">'PASSWORD'</span>: <span class=\"string\">'db_test'</span>,</span><br><span class=\"line\">        <span class=\"string\">'HOST'</span>: <span class=\"string\">''</span>,</span><br><span class=\"line\">        <span class=\"string\">'PORT'</span>: <span class=\"string\">''</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>可以用Django shell测试一下：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">xing@ubuntu-server:~/pstest$ python manage.py shell</span><br><span class=\"line\">Python 2.7.13 (default, Jan 19 2017, 14:48:08) </span><br><span class=\"line\">[GCC 6.3.0 20170118] on linux2</span><br><span class=\"line\">Type \"help\", \"copyright\", \"credits\" or \"license\" for more information.</span><br><span class=\"line\">(InteractiveConsole)</span><br><span class=\"line\"><span class=\"meta\">&gt;</span><span class=\"bash\">&gt;&gt; from django.db import connection</span></span><br><span class=\"line\"><span class=\"meta\">&gt;</span><span class=\"bash\">&gt;&gt; cusor = connection.cursor</span></span><br></pre></td></tr></table></figure>\n<p>如果没有报错的话，说明已经配置成功了。</p>\n","site":{"data":{}},"excerpt":"<h3 id=\"在Django中使用PosetgreSQL数据库\"><a href=\"#在Django中使用PosetgreSQL数据库\" class=\"headerlink\" title=\"在Django中使用PosetgreSQL数据库\"></a>在Django中使用PosetgreSQL数据库</h3><p>Postgres的安装过程就略过了，在Django中使用PostgreSQL只需要改一下settings.py中的数据库连接字符串就好了。</p>","more":"<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">DATABASES = &#123;</span><br><span class=\"line\">    <span class=\"string\">'default'</span>: &#123;</span><br><span class=\"line\">        <span class=\"string\">'ENGINE'</span>: <span class=\"string\">'django.db.backends.postgresql_psycopg2'</span>,</span><br><span class=\"line\">        <span class=\"string\">'NAME'</span>: <span class=\"string\">'testdb'</span>,</span><br><span class=\"line\">        <span class=\"string\">'USER'</span>: <span class=\"string\">'db_test'</span>,</span><br><span class=\"line\">        <span class=\"string\">'PASSWORD'</span>: <span class=\"string\">'db_test'</span>,</span><br><span class=\"line\">        <span class=\"string\">'HOST'</span>: <span class=\"string\">''</span>,</span><br><span class=\"line\">        <span class=\"string\">'PORT'</span>: <span class=\"string\">''</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>可以用Django shell测试一下：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">xing@ubuntu-server:~/pstest$ python manage.py shell</span><br><span class=\"line\">Python 2.7.13 (default, Jan 19 2017, 14:48:08) </span><br><span class=\"line\">[GCC 6.3.0 20170118] on linux2</span><br><span class=\"line\">Type \"help\", \"copyright\", \"credits\" or \"license\" for more information.</span><br><span class=\"line\">(InteractiveConsole)</span><br><span class=\"line\"><span class=\"meta\">&gt;</span><span class=\"bash\">&gt;&gt; from django.db import connection</span></span><br><span class=\"line\"><span class=\"meta\">&gt;</span><span class=\"bash\">&gt;&gt; cusor = connection.cursor</span></span><br></pre></td></tr></table></figure>\n<p>如果没有报错的话，说明已经配置成功了。</p>"},{"title":"设计模式学习之工厂模式","date":"2017-05-12T06:28:16.000Z","_content":"\n继续设计模式的学习，接下来是工厂模式。\n\n### 工厂模式所要解决的问题\n\n如果实例化一个对象需要根据繁杂的条件来创建不同类型的对象，那么随着系统的复杂化，创建对象的过程也会变得十分复杂，每次有新的需求都需要去加上判断条件，造成了设计的复杂，也不方便其他方法调用，所以可以将创建对象的过程放到专门的工厂来创建。工厂类扮演了对象生产者的角色。\n\n### 工厂模式的分类\n\n1. 简单工厂\n\n2. 工厂方法模式\n\n3. 抽象工厂模式\n\n<!-- more -->\n\n接下来分别说明工厂模式的以上三种的类型的内容和它们之间的区别。\n\n#### 简单工厂\n\n最开始我们要实例化一个对象的时候是根据需要直接去new一个来用就行了，例如我要购买小米手机:\n\n```java\npublic class XiaoMi2s{\n  \n  public XiaoMi2s{\n    System.out.println(\"create Xiaomi 2s\");\n  }\n  \n  public void sell(){\n        System.out.println(\"MI2s selled You need pay 1999￥\");\n  }\n}\npublic class XiaoMi5s{\n  \n  public XiaoMi5s{\n    System.out.println(\"create Xiaomi 5s\");\n  }\n  public void sell(){\n        System.out.println(\"MI5s selled 1999￥\");\n  }\n}\n\npublic class PhoneShop{\n  Phone phone;\n  public static void main(String[] args){\n    \n    buyPhone(\"Mi2s\");\n    \n  }\n  public void buyPhone(String model){\n    if(model.equals(\"MI2s\")){\n      phone = new new XiaoMi2s();\n      phone.sell();\n    }\n    if(model.equals(\"MI5s\")){\n      phone = new new XiaoMi5s();\n      phone.sell();\n    }\n    \n  }\n}\n\n```\n\n可以看到，如果我要购买不同型号的手机，手机店需要进行很多次的判断才能拿到我想要的手机并卖给我。这项就显得十分繁琐了。\n\n简单工厂模式可以解决这个问题，把创建对象的过程放到专门的工厂中去做，像这样：\n\n```java\npublic class SimplePhoneFactory{\n  public Phone createPhone(String model){\n    \n    Phone phone = null;\n    if(model.equals(\"MI2s\")){\n      phone = new new XiaoMi2s();\n      phone.sell();\n    }\n    if(model.equals(\"MI5s\")){\n      phone = new new XiaoMi5s();\n      phone.sell();\n    }\n    return phone;\n    \n  }\n}\n```\n\n简单工厂其实并不算是一种设计模式，反而比较像是一种编程习惯。这个简单工厂为需要的对象创建不同的“产品”。简单工厂也可以被定义为一个静态的方法，这样就不需要使用创建对象的方法来实例化对象，但是这样就不能通过继承来改变创建方法的行为。\n\n","source":"_posts/Factory-Notes.md","raw":"---\ntitle: 设计模式学习之工厂模式\n\ndate: 2017-5-12 14:28:16\ncategories:\n- Program\ntags:\n- java\n- 设计模式\n- 工厂模式\n---\n\n继续设计模式的学习，接下来是工厂模式。\n\n### 工厂模式所要解决的问题\n\n如果实例化一个对象需要根据繁杂的条件来创建不同类型的对象，那么随着系统的复杂化，创建对象的过程也会变得十分复杂，每次有新的需求都需要去加上判断条件，造成了设计的复杂，也不方便其他方法调用，所以可以将创建对象的过程放到专门的工厂来创建。工厂类扮演了对象生产者的角色。\n\n### 工厂模式的分类\n\n1. 简单工厂\n\n2. 工厂方法模式\n\n3. 抽象工厂模式\n\n<!-- more -->\n\n接下来分别说明工厂模式的以上三种的类型的内容和它们之间的区别。\n\n#### 简单工厂\n\n最开始我们要实例化一个对象的时候是根据需要直接去new一个来用就行了，例如我要购买小米手机:\n\n```java\npublic class XiaoMi2s{\n  \n  public XiaoMi2s{\n    System.out.println(\"create Xiaomi 2s\");\n  }\n  \n  public void sell(){\n        System.out.println(\"MI2s selled You need pay 1999￥\");\n  }\n}\npublic class XiaoMi5s{\n  \n  public XiaoMi5s{\n    System.out.println(\"create Xiaomi 5s\");\n  }\n  public void sell(){\n        System.out.println(\"MI5s selled 1999￥\");\n  }\n}\n\npublic class PhoneShop{\n  Phone phone;\n  public static void main(String[] args){\n    \n    buyPhone(\"Mi2s\");\n    \n  }\n  public void buyPhone(String model){\n    if(model.equals(\"MI2s\")){\n      phone = new new XiaoMi2s();\n      phone.sell();\n    }\n    if(model.equals(\"MI5s\")){\n      phone = new new XiaoMi5s();\n      phone.sell();\n    }\n    \n  }\n}\n\n```\n\n可以看到，如果我要购买不同型号的手机，手机店需要进行很多次的判断才能拿到我想要的手机并卖给我。这项就显得十分繁琐了。\n\n简单工厂模式可以解决这个问题，把创建对象的过程放到专门的工厂中去做，像这样：\n\n```java\npublic class SimplePhoneFactory{\n  public Phone createPhone(String model){\n    \n    Phone phone = null;\n    if(model.equals(\"MI2s\")){\n      phone = new new XiaoMi2s();\n      phone.sell();\n    }\n    if(model.equals(\"MI5s\")){\n      phone = new new XiaoMi5s();\n      phone.sell();\n    }\n    return phone;\n    \n  }\n}\n```\n\n简单工厂其实并不算是一种设计模式，反而比较像是一种编程习惯。这个简单工厂为需要的对象创建不同的“产品”。简单工厂也可以被定义为一个静态的方法，这样就不需要使用创建对象的方法来实例化对象，但是这样就不能通过继承来改变创建方法的行为。\n\n","slug":"Factory-Notes","published":1,"updated":"2017-12-04T07:27:28.756Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjeqig1lu001ulgqa3vsdxcop","content":"<p>继续设计模式的学习，接下来是工厂模式。</p>\n<h3 id=\"工厂模式所要解决的问题\"><a href=\"#工厂模式所要解决的问题\" class=\"headerlink\" title=\"工厂模式所要解决的问题\"></a>工厂模式所要解决的问题</h3><p>如果实例化一个对象需要根据繁杂的条件来创建不同类型的对象，那么随着系统的复杂化，创建对象的过程也会变得十分复杂，每次有新的需求都需要去加上判断条件，造成了设计的复杂，也不方便其他方法调用，所以可以将创建对象的过程放到专门的工厂来创建。工厂类扮演了对象生产者的角色。</p>\n<h3 id=\"工厂模式的分类\"><a href=\"#工厂模式的分类\" class=\"headerlink\" title=\"工厂模式的分类\"></a>工厂模式的分类</h3><ol>\n<li><p>简单工厂</p>\n</li>\n<li><p>工厂方法模式</p>\n</li>\n<li><p>抽象工厂模式</p>\n</li>\n</ol>\n<a id=\"more\"></a>\n<p>接下来分别说明工厂模式的以上三种的类型的内容和它们之间的区别。</p>\n<h4 id=\"简单工厂\"><a href=\"#简单工厂\" class=\"headerlink\" title=\"简单工厂\"></a>简单工厂</h4><p>最开始我们要实例化一个对象的时候是根据需要直接去new一个来用就行了，例如我要购买小米手机:</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">XiaoMi2s</span></span>&#123;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"keyword\">public</span> XiaoMi2s&#123;</span><br><span class=\"line\">    System.out.println(<span class=\"string\">\"create Xiaomi 2s\"</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">sell</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"MI2s selled You need pay 1999￥\"</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">XiaoMi5s</span></span>&#123;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"keyword\">public</span> XiaoMi5s&#123;</span><br><span class=\"line\">    System.out.println(<span class=\"string\">\"create Xiaomi 5s\"</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">sell</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"MI5s selled 1999￥\"</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">PhoneShop</span></span>&#123;</span><br><span class=\"line\">  Phone phone;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span></span>&#123;</span><br><span class=\"line\">    </span><br><span class=\"line\">    buyPhone(<span class=\"string\">\"Mi2s\"</span>);</span><br><span class=\"line\">    </span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">buyPhone</span><span class=\"params\">(String model)</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(model.equals(<span class=\"string\">\"MI2s\"</span>))&#123;</span><br><span class=\"line\">      phone = <span class=\"keyword\">new</span> <span class=\"keyword\">new</span> XiaoMi2s();</span><br><span class=\"line\">      phone.sell();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(model.equals(<span class=\"string\">\"MI5s\"</span>))&#123;</span><br><span class=\"line\">      phone = <span class=\"keyword\">new</span> <span class=\"keyword\">new</span> XiaoMi5s();</span><br><span class=\"line\">      phone.sell();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>可以看到，如果我要购买不同型号的手机，手机店需要进行很多次的判断才能拿到我想要的手机并卖给我。这项就显得十分繁琐了。</p>\n<p>简单工厂模式可以解决这个问题，把创建对象的过程放到专门的工厂中去做，像这样：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SimplePhoneFactory</span></span>&#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> Phone <span class=\"title\">createPhone</span><span class=\"params\">(String model)</span></span>&#123;</span><br><span class=\"line\">    </span><br><span class=\"line\">    Phone phone = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(model.equals(<span class=\"string\">\"MI2s\"</span>))&#123;</span><br><span class=\"line\">      phone = <span class=\"keyword\">new</span> <span class=\"keyword\">new</span> XiaoMi2s();</span><br><span class=\"line\">      phone.sell();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(model.equals(<span class=\"string\">\"MI5s\"</span>))&#123;</span><br><span class=\"line\">      phone = <span class=\"keyword\">new</span> <span class=\"keyword\">new</span> XiaoMi5s();</span><br><span class=\"line\">      phone.sell();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> phone;</span><br><span class=\"line\">    </span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>简单工厂其实并不算是一种设计模式，反而比较像是一种编程习惯。这个简单工厂为需要的对象创建不同的“产品”。简单工厂也可以被定义为一个静态的方法，这样就不需要使用创建对象的方法来实例化对象，但是这样就不能通过继承来改变创建方法的行为。</p>\n","site":{"data":{}},"excerpt":"<p>继续设计模式的学习，接下来是工厂模式。</p>\n<h3 id=\"工厂模式所要解决的问题\"><a href=\"#工厂模式所要解决的问题\" class=\"headerlink\" title=\"工厂模式所要解决的问题\"></a>工厂模式所要解决的问题</h3><p>如果实例化一个对象需要根据繁杂的条件来创建不同类型的对象，那么随着系统的复杂化，创建对象的过程也会变得十分复杂，每次有新的需求都需要去加上判断条件，造成了设计的复杂，也不方便其他方法调用，所以可以将创建对象的过程放到专门的工厂来创建。工厂类扮演了对象生产者的角色。</p>\n<h3 id=\"工厂模式的分类\"><a href=\"#工厂模式的分类\" class=\"headerlink\" title=\"工厂模式的分类\"></a>工厂模式的分类</h3><ol>\n<li><p>简单工厂</p>\n</li>\n<li><p>工厂方法模式</p>\n</li>\n<li><p>抽象工厂模式</p>\n</li>\n</ol>","more":"<p>接下来分别说明工厂模式的以上三种的类型的内容和它们之间的区别。</p>\n<h4 id=\"简单工厂\"><a href=\"#简单工厂\" class=\"headerlink\" title=\"简单工厂\"></a>简单工厂</h4><p>最开始我们要实例化一个对象的时候是根据需要直接去new一个来用就行了，例如我要购买小米手机:</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">XiaoMi2s</span></span>&#123;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"keyword\">public</span> XiaoMi2s&#123;</span><br><span class=\"line\">    System.out.println(<span class=\"string\">\"create Xiaomi 2s\"</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">sell</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"MI2s selled You need pay 1999￥\"</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">XiaoMi5s</span></span>&#123;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"keyword\">public</span> XiaoMi5s&#123;</span><br><span class=\"line\">    System.out.println(<span class=\"string\">\"create Xiaomi 5s\"</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">sell</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"MI5s selled 1999￥\"</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">PhoneShop</span></span>&#123;</span><br><span class=\"line\">  Phone phone;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span></span>&#123;</span><br><span class=\"line\">    </span><br><span class=\"line\">    buyPhone(<span class=\"string\">\"Mi2s\"</span>);</span><br><span class=\"line\">    </span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">buyPhone</span><span class=\"params\">(String model)</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(model.equals(<span class=\"string\">\"MI2s\"</span>))&#123;</span><br><span class=\"line\">      phone = <span class=\"keyword\">new</span> <span class=\"keyword\">new</span> XiaoMi2s();</span><br><span class=\"line\">      phone.sell();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(model.equals(<span class=\"string\">\"MI5s\"</span>))&#123;</span><br><span class=\"line\">      phone = <span class=\"keyword\">new</span> <span class=\"keyword\">new</span> XiaoMi5s();</span><br><span class=\"line\">      phone.sell();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>可以看到，如果我要购买不同型号的手机，手机店需要进行很多次的判断才能拿到我想要的手机并卖给我。这项就显得十分繁琐了。</p>\n<p>简单工厂模式可以解决这个问题，把创建对象的过程放到专门的工厂中去做，像这样：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SimplePhoneFactory</span></span>&#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> Phone <span class=\"title\">createPhone</span><span class=\"params\">(String model)</span></span>&#123;</span><br><span class=\"line\">    </span><br><span class=\"line\">    Phone phone = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(model.equals(<span class=\"string\">\"MI2s\"</span>))&#123;</span><br><span class=\"line\">      phone = <span class=\"keyword\">new</span> <span class=\"keyword\">new</span> XiaoMi2s();</span><br><span class=\"line\">      phone.sell();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(model.equals(<span class=\"string\">\"MI5s\"</span>))&#123;</span><br><span class=\"line\">      phone = <span class=\"keyword\">new</span> <span class=\"keyword\">new</span> XiaoMi5s();</span><br><span class=\"line\">      phone.sell();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> phone;</span><br><span class=\"line\">    </span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>简单工厂其实并不算是一种设计模式，反而比较像是一种编程习惯。这个简单工厂为需要的对象创建不同的“产品”。简单工厂也可以被定义为一个静态的方法，这样就不需要使用创建对象的方法来实例化对象，但是这样就不能通过继承来改变创建方法的行为。</p>"},{"title":"在Ubuntu16.04上配置peda","date":"2016-11-20T11:25:18.000Z","_content":"# 在Ubuntu16.04上配置peda\n\n\n#### 0x1.peda是什么？\n从github上摘抄一段关于peda的介绍如下:\n``` \npeda\nPEDA - Python Exploit Development Assistance for GDB\nKey Features:\n\n    Enhance the display of gdb: colorize and display disassembly codes, registers, memory information during debugging.\n    Add commands to support debugging and exploit development (for a full list of commands use peda help):\n        aslr -- Show/set ASLR setting of GDB\n        checksec -- Check for various security options of binary\n        dumpargs -- Display arguments passed to a function when stopped at a call instruction\n        dumprop -- Dump all ROP gadgets in specific memory range\n        elfheader -- Get headers information from debugged ELF file\n        elfsymbol -- Get non-debugging symbol information from an ELF file\n        lookup -- Search for all addresses/references to addresses which belong to a memory range\n        patch -- Patch memory start at an address with string/hexstring/int\n        pattern -- Generate, search, or write a cyclic pattern to memory\n        procinfo -- Display various info from /proc/pid/\n        pshow -- Show various PEDA options and other settings\n        pset -- Set various PEDA options and other settings\n        readelf -- Get headers information from an ELF file\n        ropgadget -- Get common ROP gadgets of binary or library\n        ropsearch -- Search for ROP gadgets in memory\n        searchmem|find -- Search for a pattern in memory; support regex search\n        shellcode -- Generate or download common shellcodes.\n        skeleton -- Generate python exploit code template\n        vmmap -- Get virtual mapping address ranges of section(s) in debugged process\n        xormem -- XOR a memory region with a key\n```\n<!-- more -->\n#### 0x2. 安装方法\n```\n    git clone https://github.com/longld/peda.git ~/peda\necho \"source ~/peda/peda.py\" >> ~/.gdbinit\necho \"DONE! debug your program with gdb and enjoy\"\n```\n\n#### 0x3. 尝试安装peda\n```\nstar-chen@starchen-vb:~$ cat peda_install.sh \ngit clone https://github.com/longld/peda.git ~/peda\necho \"source ~/peda/peda.py\" >> ~/.gdbinit\necho \"DONE! debug your program with gdb and enjoy\"\n\nstar-chen@starchen-vb:~$ sudo sh peda_install.sh \n正克隆到 '/home/star-chen/peda'...\nremote: Counting objects: 304, done.\nremote: Total 304 (delta 0), reused 0 (delta 0), pack-reused 304\n接收对象中: 100% (304/304), 197.98 KiB | 45.00 KiB/s, 完成.\n处理 delta 中: 100% (192/192), 完成.\n检查连接... 完成。\nDONE! debug your program with gdb and enjoy\nstar-chen@starchen-vb:~$ gdb\nGNU gdb (Ubuntu 7.11.1-0ubuntu1~16.04) 7.11.1\nCopyright (C) 2016 Free Software Foundation, Inc.\nLicense GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>\nThis is free software: you are free to change and redistribute it.\nThere is NO WARRANTY, to the extent permitted by law.  Type \"show copying\"\nand \"show warranty\" for details.\nThis GDB was configured as \"x86_64-linux-gnu\".\nType \"show configuration\" for configuration details.\nFor bug reporting instructions, please see:\n<http://www.gnu.org/software/gdb/bugs/>.\nFind the GDB manual and other documentation resources online at:\n<http://www.gnu.org/software/gdb/documentation/>.\nFor help, type \"help\".\nType \"apropos word\" to search for commands related to \"word\".\ngdb-peda$ \n\n```\n安装完成。\n   \n   ","source":"_posts/GDB-peda.md","raw":"---\ntitle: 在Ubuntu16.04上配置peda\ndate: 2016-11-20 19:25:18\ncategories: Linux\ntags:\n- GDB\n- Linux\n- Debugger\n- peda\n---\n# 在Ubuntu16.04上配置peda\n\n\n#### 0x1.peda是什么？\n从github上摘抄一段关于peda的介绍如下:\n``` \npeda\nPEDA - Python Exploit Development Assistance for GDB\nKey Features:\n\n    Enhance the display of gdb: colorize and display disassembly codes, registers, memory information during debugging.\n    Add commands to support debugging and exploit development (for a full list of commands use peda help):\n        aslr -- Show/set ASLR setting of GDB\n        checksec -- Check for various security options of binary\n        dumpargs -- Display arguments passed to a function when stopped at a call instruction\n        dumprop -- Dump all ROP gadgets in specific memory range\n        elfheader -- Get headers information from debugged ELF file\n        elfsymbol -- Get non-debugging symbol information from an ELF file\n        lookup -- Search for all addresses/references to addresses which belong to a memory range\n        patch -- Patch memory start at an address with string/hexstring/int\n        pattern -- Generate, search, or write a cyclic pattern to memory\n        procinfo -- Display various info from /proc/pid/\n        pshow -- Show various PEDA options and other settings\n        pset -- Set various PEDA options and other settings\n        readelf -- Get headers information from an ELF file\n        ropgadget -- Get common ROP gadgets of binary or library\n        ropsearch -- Search for ROP gadgets in memory\n        searchmem|find -- Search for a pattern in memory; support regex search\n        shellcode -- Generate or download common shellcodes.\n        skeleton -- Generate python exploit code template\n        vmmap -- Get virtual mapping address ranges of section(s) in debugged process\n        xormem -- XOR a memory region with a key\n```\n<!-- more -->\n#### 0x2. 安装方法\n```\n    git clone https://github.com/longld/peda.git ~/peda\necho \"source ~/peda/peda.py\" >> ~/.gdbinit\necho \"DONE! debug your program with gdb and enjoy\"\n```\n\n#### 0x3. 尝试安装peda\n```\nstar-chen@starchen-vb:~$ cat peda_install.sh \ngit clone https://github.com/longld/peda.git ~/peda\necho \"source ~/peda/peda.py\" >> ~/.gdbinit\necho \"DONE! debug your program with gdb and enjoy\"\n\nstar-chen@starchen-vb:~$ sudo sh peda_install.sh \n正克隆到 '/home/star-chen/peda'...\nremote: Counting objects: 304, done.\nremote: Total 304 (delta 0), reused 0 (delta 0), pack-reused 304\n接收对象中: 100% (304/304), 197.98 KiB | 45.00 KiB/s, 完成.\n处理 delta 中: 100% (192/192), 完成.\n检查连接... 完成。\nDONE! debug your program with gdb and enjoy\nstar-chen@starchen-vb:~$ gdb\nGNU gdb (Ubuntu 7.11.1-0ubuntu1~16.04) 7.11.1\nCopyright (C) 2016 Free Software Foundation, Inc.\nLicense GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>\nThis is free software: you are free to change and redistribute it.\nThere is NO WARRANTY, to the extent permitted by law.  Type \"show copying\"\nand \"show warranty\" for details.\nThis GDB was configured as \"x86_64-linux-gnu\".\nType \"show configuration\" for configuration details.\nFor bug reporting instructions, please see:\n<http://www.gnu.org/software/gdb/bugs/>.\nFind the GDB manual and other documentation resources online at:\n<http://www.gnu.org/software/gdb/documentation/>.\nFor help, type \"help\".\nType \"apropos word\" to search for commands related to \"word\".\ngdb-peda$ \n\n```\n安装完成。\n   \n   ","slug":"GDB-peda","published":1,"updated":"2017-12-04T07:27:28.756Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjeqig1m0001xlgqacyz9cwah","content":"<h1 id=\"在Ubuntu16-04上配置peda\"><a href=\"#在Ubuntu16-04上配置peda\" class=\"headerlink\" title=\"在Ubuntu16.04上配置peda\"></a>在Ubuntu16.04上配置peda</h1><h4 id=\"0x1-peda是什么？\"><a href=\"#0x1-peda是什么？\" class=\"headerlink\" title=\"0x1.peda是什么？\"></a>0x1.peda是什么？</h4><p>从github上摘抄一段关于peda的介绍如下:<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">peda</span><br><span class=\"line\">PEDA - Python Exploit Development Assistance for GDB</span><br><span class=\"line\">Key Features:</span><br><span class=\"line\"></span><br><span class=\"line\">    Enhance the display of gdb: colorize and display disassembly codes, registers, memory information during debugging.</span><br><span class=\"line\">    Add commands to support debugging and exploit development (for a full list of commands use peda help):</span><br><span class=\"line\">        aslr -- Show/set ASLR setting of GDB</span><br><span class=\"line\">        checksec -- Check for various security options of binary</span><br><span class=\"line\">        dumpargs -- Display arguments passed to a function when stopped at a call instruction</span><br><span class=\"line\">        dumprop -- Dump all ROP gadgets in specific memory range</span><br><span class=\"line\">        elfheader -- Get headers information from debugged ELF file</span><br><span class=\"line\">        elfsymbol -- Get non-debugging symbol information from an ELF file</span><br><span class=\"line\">        lookup -- Search for all addresses/references to addresses which belong to a memory range</span><br><span class=\"line\">        patch -- Patch memory start at an address with string/hexstring/int</span><br><span class=\"line\">        pattern -- Generate, search, or write a cyclic pattern to memory</span><br><span class=\"line\">        procinfo -- Display various info from /proc/pid/</span><br><span class=\"line\">        pshow -- Show various PEDA options and other settings</span><br><span class=\"line\">        pset -- Set various PEDA options and other settings</span><br><span class=\"line\">        readelf -- Get headers information from an ELF file</span><br><span class=\"line\">        ropgadget -- Get common ROP gadgets of binary or library</span><br><span class=\"line\">        ropsearch -- Search for ROP gadgets in memory</span><br><span class=\"line\">        searchmem|find -- Search for a pattern in memory; support regex search</span><br><span class=\"line\">        shellcode -- Generate or download common shellcodes.</span><br><span class=\"line\">        skeleton -- Generate python exploit code template</span><br><span class=\"line\">        vmmap -- Get virtual mapping address ranges of section(s) in debugged process</span><br><span class=\"line\">        xormem -- XOR a memory region with a key</span><br></pre></td></tr></table></figure></p>\n<a id=\"more\"></a>\n<h4 id=\"0x2-安装方法\"><a href=\"#0x2-安装方法\" class=\"headerlink\" title=\"0x2. 安装方法\"></a>0x2. 安装方法</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">    git clone https://github.com/longld/peda.git ~/peda</span><br><span class=\"line\">echo &quot;source ~/peda/peda.py&quot; &gt;&gt; ~/.gdbinit</span><br><span class=\"line\">echo &quot;DONE! debug your program with gdb and enjoy&quot;</span><br></pre></td></tr></table></figure>\n<h4 id=\"0x3-尝试安装peda\"><a href=\"#0x3-尝试安装peda\" class=\"headerlink\" title=\"0x3. 尝试安装peda\"></a>0x3. 尝试安装peda</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">star-chen@starchen-vb:~$ cat peda_install.sh </span><br><span class=\"line\">git clone https://github.com/longld/peda.git ~/peda</span><br><span class=\"line\">echo &quot;source ~/peda/peda.py&quot; &gt;&gt; ~/.gdbinit</span><br><span class=\"line\">echo &quot;DONE! debug your program with gdb and enjoy&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">star-chen@starchen-vb:~$ sudo sh peda_install.sh </span><br><span class=\"line\">正克隆到 &apos;/home/star-chen/peda&apos;...</span><br><span class=\"line\">remote: Counting objects: 304, done.</span><br><span class=\"line\">remote: Total 304 (delta 0), reused 0 (delta 0), pack-reused 304</span><br><span class=\"line\">接收对象中: 100% (304/304), 197.98 KiB | 45.00 KiB/s, 完成.</span><br><span class=\"line\">处理 delta 中: 100% (192/192), 完成.</span><br><span class=\"line\">检查连接... 完成。</span><br><span class=\"line\">DONE! debug your program with gdb and enjoy</span><br><span class=\"line\">star-chen@starchen-vb:~$ gdb</span><br><span class=\"line\">GNU gdb (Ubuntu 7.11.1-0ubuntu1~16.04) 7.11.1</span><br><span class=\"line\">Copyright (C) 2016 Free Software Foundation, Inc.</span><br><span class=\"line\">License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;</span><br><span class=\"line\">This is free software: you are free to change and redistribute it.</span><br><span class=\"line\">There is NO WARRANTY, to the extent permitted by law.  Type &quot;show copying&quot;</span><br><span class=\"line\">and &quot;show warranty&quot; for details.</span><br><span class=\"line\">This GDB was configured as &quot;x86_64-linux-gnu&quot;.</span><br><span class=\"line\">Type &quot;show configuration&quot; for configuration details.</span><br><span class=\"line\">For bug reporting instructions, please see:</span><br><span class=\"line\">&lt;http://www.gnu.org/software/gdb/bugs/&gt;.</span><br><span class=\"line\">Find the GDB manual and other documentation resources online at:</span><br><span class=\"line\">&lt;http://www.gnu.org/software/gdb/documentation/&gt;.</span><br><span class=\"line\">For help, type &quot;help&quot;.</span><br><span class=\"line\">Type &quot;apropos word&quot; to search for commands related to &quot;word&quot;.</span><br><span class=\"line\">gdb-peda$</span><br></pre></td></tr></table></figure>\n<p>安装完成。</p>\n","site":{"data":{}},"excerpt":"<h1 id=\"在Ubuntu16-04上配置peda\"><a href=\"#在Ubuntu16-04上配置peda\" class=\"headerlink\" title=\"在Ubuntu16.04上配置peda\"></a>在Ubuntu16.04上配置peda</h1><h4 id=\"0x1-peda是什么？\"><a href=\"#0x1-peda是什么？\" class=\"headerlink\" title=\"0x1.peda是什么？\"></a>0x1.peda是什么？</h4><p>从github上摘抄一段关于peda的介绍如下:<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">peda</span><br><span class=\"line\">PEDA - Python Exploit Development Assistance for GDB</span><br><span class=\"line\">Key Features:</span><br><span class=\"line\"></span><br><span class=\"line\">    Enhance the display of gdb: colorize and display disassembly codes, registers, memory information during debugging.</span><br><span class=\"line\">    Add commands to support debugging and exploit development (for a full list of commands use peda help):</span><br><span class=\"line\">        aslr -- Show/set ASLR setting of GDB</span><br><span class=\"line\">        checksec -- Check for various security options of binary</span><br><span class=\"line\">        dumpargs -- Display arguments passed to a function when stopped at a call instruction</span><br><span class=\"line\">        dumprop -- Dump all ROP gadgets in specific memory range</span><br><span class=\"line\">        elfheader -- Get headers information from debugged ELF file</span><br><span class=\"line\">        elfsymbol -- Get non-debugging symbol information from an ELF file</span><br><span class=\"line\">        lookup -- Search for all addresses/references to addresses which belong to a memory range</span><br><span class=\"line\">        patch -- Patch memory start at an address with string/hexstring/int</span><br><span class=\"line\">        pattern -- Generate, search, or write a cyclic pattern to memory</span><br><span class=\"line\">        procinfo -- Display various info from /proc/pid/</span><br><span class=\"line\">        pshow -- Show various PEDA options and other settings</span><br><span class=\"line\">        pset -- Set various PEDA options and other settings</span><br><span class=\"line\">        readelf -- Get headers information from an ELF file</span><br><span class=\"line\">        ropgadget -- Get common ROP gadgets of binary or library</span><br><span class=\"line\">        ropsearch -- Search for ROP gadgets in memory</span><br><span class=\"line\">        searchmem|find -- Search for a pattern in memory; support regex search</span><br><span class=\"line\">        shellcode -- Generate or download common shellcodes.</span><br><span class=\"line\">        skeleton -- Generate python exploit code template</span><br><span class=\"line\">        vmmap -- Get virtual mapping address ranges of section(s) in debugged process</span><br><span class=\"line\">        xormem -- XOR a memory region with a key</span><br></pre></td></tr></table></figure></p>","more":"<h4 id=\"0x2-安装方法\"><a href=\"#0x2-安装方法\" class=\"headerlink\" title=\"0x2. 安装方法\"></a>0x2. 安装方法</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">    git clone https://github.com/longld/peda.git ~/peda</span><br><span class=\"line\">echo &quot;source ~/peda/peda.py&quot; &gt;&gt; ~/.gdbinit</span><br><span class=\"line\">echo &quot;DONE! debug your program with gdb and enjoy&quot;</span><br></pre></td></tr></table></figure>\n<h4 id=\"0x3-尝试安装peda\"><a href=\"#0x3-尝试安装peda\" class=\"headerlink\" title=\"0x3. 尝试安装peda\"></a>0x3. 尝试安装peda</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">star-chen@starchen-vb:~$ cat peda_install.sh </span><br><span class=\"line\">git clone https://github.com/longld/peda.git ~/peda</span><br><span class=\"line\">echo &quot;source ~/peda/peda.py&quot; &gt;&gt; ~/.gdbinit</span><br><span class=\"line\">echo &quot;DONE! debug your program with gdb and enjoy&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">star-chen@starchen-vb:~$ sudo sh peda_install.sh </span><br><span class=\"line\">正克隆到 &apos;/home/star-chen/peda&apos;...</span><br><span class=\"line\">remote: Counting objects: 304, done.</span><br><span class=\"line\">remote: Total 304 (delta 0), reused 0 (delta 0), pack-reused 304</span><br><span class=\"line\">接收对象中: 100% (304/304), 197.98 KiB | 45.00 KiB/s, 完成.</span><br><span class=\"line\">处理 delta 中: 100% (192/192), 完成.</span><br><span class=\"line\">检查连接... 完成。</span><br><span class=\"line\">DONE! debug your program with gdb and enjoy</span><br><span class=\"line\">star-chen@starchen-vb:~$ gdb</span><br><span class=\"line\">GNU gdb (Ubuntu 7.11.1-0ubuntu1~16.04) 7.11.1</span><br><span class=\"line\">Copyright (C) 2016 Free Software Foundation, Inc.</span><br><span class=\"line\">License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;</span><br><span class=\"line\">This is free software: you are free to change and redistribute it.</span><br><span class=\"line\">There is NO WARRANTY, to the extent permitted by law.  Type &quot;show copying&quot;</span><br><span class=\"line\">and &quot;show warranty&quot; for details.</span><br><span class=\"line\">This GDB was configured as &quot;x86_64-linux-gnu&quot;.</span><br><span class=\"line\">Type &quot;show configuration&quot; for configuration details.</span><br><span class=\"line\">For bug reporting instructions, please see:</span><br><span class=\"line\">&lt;http://www.gnu.org/software/gdb/bugs/&gt;.</span><br><span class=\"line\">Find the GDB manual and other documentation resources online at:</span><br><span class=\"line\">&lt;http://www.gnu.org/software/gdb/documentation/&gt;.</span><br><span class=\"line\">For help, type &quot;help&quot;.</span><br><span class=\"line\">Type &quot;apropos word&quot; to search for commands related to &quot;word&quot;.</span><br><span class=\"line\">gdb-peda$</span><br></pre></td></tr></table></figure>\n<p>安装完成。</p>"},{"title":"利用Github的webhook和tornado实现代码自动部署","date":"2016-12-04T02:39:31.000Z","toc":"true 文章目录","author":null,"comments":1,"original":null,"_content":"\n### 0x1:需求来源  \n\n本博客使用的hexo生成的静态页面，整个博客代码是托管在github上的。这样可以方便我在不同的设备上随时同步位于github上的博客代码，并撰写新的内容。写博文的问题得到了解决，但是每次更新服务器上的内容时却要登录服务器去拉取github上的内容，很是繁琐。github提供了webhook功能，用户对仓库操作引起的事件，例如push，pull等可以触发github利用webhook向远程服务器发起链接，并携带一定的参数，这样的话，在远程服务器监听来自webhook的请求就可以执行代码更新操作了哇。  \n<!-- more -->\n### 0x2:服务端代码\n\n服务端代码的思路很清晰。 \n\n1. 监听来自webhook的消息，并验证是否合法  \n2. 拉取git仓库的内容至本地临时仓库\n3. 拷贝代码至web根目录，并删除web部署目录中的.git目录，防止代码泄露  \n\n正好最近在学习python，就利用python的tornado框架写几句话完成服务端的工作吧。\n\n```python\nimport tornado.ioloop\nimport tornado.web\nimport json\nimport sys\nimport os\n\n#pull my blog from github\ndef PullBlog():\n\tos.system(\"cd ~/blog/My_Blog&&git pull https://github.com/007xiaoxingxing/My_Blog.git&&cp -r public/* /var/blog/\")\n\tprint \"pull blog\"\n\nclass MainHandler(tornado.web.RequestHandler):\n\tdef get(self):\n\t\tself.write(\"Hello Guys!\");\n\tdef post(self):\n\t\tjson_str=self.request.body\n\t\tdata=json.loads(json_str)\n        #这里的内容需要根据github的post数据自行进行判断，我这里一切从简了\n\t\ttarget= data[\"repository\"][\"name\"]\n\t\tif target == \"My_Blog\":\n\t\t\tPullBlog()\n\t\t\tprint \"ooo\"\n\t\tif target == \"photo_manage\":\n\t\t\tPullPhoto()\napplication = tornado.web.Application([\n\t(r\"/\",MainHandler),\n])\n\nif __name__ == \"__main__\":\n\tapplication.listen(8888)\n\ttornado.ioloop.IOLoop.instance().start()\n\n```\n\n这段代码是不是很眼熟？Yes，它就是tornado的Hello World，我在其中增添了获取post内容，并把接收到的json字符串解析成python对象，如果符合要求就进行代码更新操作。\n\n### 0x3:Github代码仓库相关设置\n\n在github代码仓库需要设置webhook的远程服务器地址，post的数据格式和密钥。\n\n![image](/blogimg/githook.png)\n\n设置好webhook的url，并点击Add webhook按钮后，github的服务器会第一次发送数据到你设置的url地址上，我们来看一下它都发送了些什么数据。\n\n```json\n{\n  \"ref\": \"refs/heads/master\",\n  \"before\": \"2db041797c019dd3f04b45203ba4ad09ffef2654\",\n  \"after\": \"454cc4e6bfce259cd29fbc112c9b3714e0750ab7\",\n  \"created\": false,\n  \"deleted\": false,\n  \"forced\": false,\n  \"base_ref\": null,\n  \"compare\": \"https://github.com/007xiaoxingxing/My_Blog/compare/2db041797c01...454cc4e6bfce\",\n  \"commits\": [\n    {\n      \"id\": \"454cc4e6bfce259cd29fbc112c9b3714e0750ab7\",\n      \"tree_id\": \"09538c4e1f362018d9e230d4de2225ca469fb32a\",\n      \"distinct\": true,\n      \"message\": \"PIL grab\",\n      \"timestamp\": \"2016-12-04T10:38:02+08:00\",\n      \"url\": \"https://github.com/007xiaoxingxing/My_Blog/commit/454cc4e6bfce259cd29fbc112c9b3714e0750ab7\",\n      \"author\": {\n        \"name\": \"007xiaoxing\",\n        \"email\": \"chanxing9@gmail.com\",\n        \"username\": \"007xiaoxingxing\"\n      },\n      \"committer\": {\n        \"name\": \"007xiaoxing\",\n        \"email\": \"chanxing9@gmail.com\",\n        \"username\": \"007xiaoxingxing\"\n      },\n      \"added\": [\n        \"public/2016/12/04/PIL-Grab/index.html\",\n        \"public/archives/2016/12/index.html\",\n        \"public/tags/PIL/index.html\",\n        \"public/tags/python/index.html\",\n        \"source/_posts/PIL-Grab.md\"\n      ],\n      \"removed\": [\n\n      ],\n      \"modified\": [\n        \"db.json\",\n        略去一万字.....\n      ]\n    }\n  ],\n  \"head_commit\": {\n    \"id\": \"454cc4e6bfce259cd29fbc112c9b3714e0750ab7\",\n    \"tree_id\": \"09538c4e1f362018d9e230d4de2225ca469fb32a\",\n    \"distinct\": true,\n    \"message\": \"PIL grab\",\n    \"timestamp\": \"2016-12-04T10:38:02+08:00\",\n    \"url\": \"https://github.com/007xiaoxingxing/My_Blog/commit/454cc4e6bfce259cd29fbc112c9b3714e0750ab7\",\n    \"author\": {\n      \"name\": \"007xiaoxing\",\n      \"email\": \"chanxing9@gmail.com\",\n      \"username\": \"007xiaoxingxing\"\n    },\n    \"committer\": {\n      \"name\": \"007xiaoxing\",\n      \"email\": \"chanxing9@gmail.com\",\n      \"username\": \"007xiaoxingxing\"\n    },\n    \"added\": [\n      \"public/2016/12/04/PIL-Grab/index.html\",\n      \"public/archives/2016/12/index.html\",\n      \"public/tags/PIL/index.html\",\n      \"public/tags/python/index.html\",\n      \"source/_posts/PIL-Grab.md\"\n    ],\n    \"removed\": [\n\n    ],\n    \"modified\": [\n      \"db.json\",\n      这都不重要，略.....\n      \"public/tags/萌新第一次/index.html\"\n    ]\n  },\n  \"repository\": {\n    \"id\": 64537807,\n    \"name\": \"My_Blog\",\n    \"full_name\": \"007xiaoxingxing/My_Blog\",\n    \"owner\": {\n      \"name\": \"007xiaoxingxing\",\n      \"email\": \"994983825@qq.com\"\n    },\n    \"private\": false,\n    \"html_url\": \"https://github.com/007xiaoxingxing/My_Blog\",\n    鬼知道这中间少了些什么？滑稽 - -！\n    \"site_admin\": false\n  }\n}\n```\n\n数据内容十分丰富，包括了你对仓库的操作，仓库改变等等......  \n\n这些数据都可以在服务端进行获取，验证等，然后自定义操作即可。\n\n### 0x4:服务的运行\n\n最后只需要将自动部署的服务端跑起来即可。我选择使用nohub将服务挂起来在后台运行。\n\n```bash\n$nobub python git_deploy.py &\n```\n\nnohub会把后台运行的标准输出重定向到当前目录的nohub.dat中，在这之中我们可以查看相关操作日志。Ok，大功告成，以后就可以直接提交代码的github代码仓库，服务器就能够自动的更新博客文章了。","source":"_posts/Github-Webhook.md","raw":"---\ntitle: 利用Github的webhook和tornado实现代码自动部署\ndate: 2016-12-04 10:39:31\ncategories:\n- Program\ntags:\n- Github\n- Webhook\n- 自动部署\n- code deploy\ntoc: true 文章目录\nauthor:\ncomments:\noriginal:\npermalink:\n---\n\n### 0x1:需求来源  \n\n本博客使用的hexo生成的静态页面，整个博客代码是托管在github上的。这样可以方便我在不同的设备上随时同步位于github上的博客代码，并撰写新的内容。写博文的问题得到了解决，但是每次更新服务器上的内容时却要登录服务器去拉取github上的内容，很是繁琐。github提供了webhook功能，用户对仓库操作引起的事件，例如push，pull等可以触发github利用webhook向远程服务器发起链接，并携带一定的参数，这样的话，在远程服务器监听来自webhook的请求就可以执行代码更新操作了哇。  \n<!-- more -->\n### 0x2:服务端代码\n\n服务端代码的思路很清晰。 \n\n1. 监听来自webhook的消息，并验证是否合法  \n2. 拉取git仓库的内容至本地临时仓库\n3. 拷贝代码至web根目录，并删除web部署目录中的.git目录，防止代码泄露  \n\n正好最近在学习python，就利用python的tornado框架写几句话完成服务端的工作吧。\n\n```python\nimport tornado.ioloop\nimport tornado.web\nimport json\nimport sys\nimport os\n\n#pull my blog from github\ndef PullBlog():\n\tos.system(\"cd ~/blog/My_Blog&&git pull https://github.com/007xiaoxingxing/My_Blog.git&&cp -r public/* /var/blog/\")\n\tprint \"pull blog\"\n\nclass MainHandler(tornado.web.RequestHandler):\n\tdef get(self):\n\t\tself.write(\"Hello Guys!\");\n\tdef post(self):\n\t\tjson_str=self.request.body\n\t\tdata=json.loads(json_str)\n        #这里的内容需要根据github的post数据自行进行判断，我这里一切从简了\n\t\ttarget= data[\"repository\"][\"name\"]\n\t\tif target == \"My_Blog\":\n\t\t\tPullBlog()\n\t\t\tprint \"ooo\"\n\t\tif target == \"photo_manage\":\n\t\t\tPullPhoto()\napplication = tornado.web.Application([\n\t(r\"/\",MainHandler),\n])\n\nif __name__ == \"__main__\":\n\tapplication.listen(8888)\n\ttornado.ioloop.IOLoop.instance().start()\n\n```\n\n这段代码是不是很眼熟？Yes，它就是tornado的Hello World，我在其中增添了获取post内容，并把接收到的json字符串解析成python对象，如果符合要求就进行代码更新操作。\n\n### 0x3:Github代码仓库相关设置\n\n在github代码仓库需要设置webhook的远程服务器地址，post的数据格式和密钥。\n\n![image](/blogimg/githook.png)\n\n设置好webhook的url，并点击Add webhook按钮后，github的服务器会第一次发送数据到你设置的url地址上，我们来看一下它都发送了些什么数据。\n\n```json\n{\n  \"ref\": \"refs/heads/master\",\n  \"before\": \"2db041797c019dd3f04b45203ba4ad09ffef2654\",\n  \"after\": \"454cc4e6bfce259cd29fbc112c9b3714e0750ab7\",\n  \"created\": false,\n  \"deleted\": false,\n  \"forced\": false,\n  \"base_ref\": null,\n  \"compare\": \"https://github.com/007xiaoxingxing/My_Blog/compare/2db041797c01...454cc4e6bfce\",\n  \"commits\": [\n    {\n      \"id\": \"454cc4e6bfce259cd29fbc112c9b3714e0750ab7\",\n      \"tree_id\": \"09538c4e1f362018d9e230d4de2225ca469fb32a\",\n      \"distinct\": true,\n      \"message\": \"PIL grab\",\n      \"timestamp\": \"2016-12-04T10:38:02+08:00\",\n      \"url\": \"https://github.com/007xiaoxingxing/My_Blog/commit/454cc4e6bfce259cd29fbc112c9b3714e0750ab7\",\n      \"author\": {\n        \"name\": \"007xiaoxing\",\n        \"email\": \"chanxing9@gmail.com\",\n        \"username\": \"007xiaoxingxing\"\n      },\n      \"committer\": {\n        \"name\": \"007xiaoxing\",\n        \"email\": \"chanxing9@gmail.com\",\n        \"username\": \"007xiaoxingxing\"\n      },\n      \"added\": [\n        \"public/2016/12/04/PIL-Grab/index.html\",\n        \"public/archives/2016/12/index.html\",\n        \"public/tags/PIL/index.html\",\n        \"public/tags/python/index.html\",\n        \"source/_posts/PIL-Grab.md\"\n      ],\n      \"removed\": [\n\n      ],\n      \"modified\": [\n        \"db.json\",\n        略去一万字.....\n      ]\n    }\n  ],\n  \"head_commit\": {\n    \"id\": \"454cc4e6bfce259cd29fbc112c9b3714e0750ab7\",\n    \"tree_id\": \"09538c4e1f362018d9e230d4de2225ca469fb32a\",\n    \"distinct\": true,\n    \"message\": \"PIL grab\",\n    \"timestamp\": \"2016-12-04T10:38:02+08:00\",\n    \"url\": \"https://github.com/007xiaoxingxing/My_Blog/commit/454cc4e6bfce259cd29fbc112c9b3714e0750ab7\",\n    \"author\": {\n      \"name\": \"007xiaoxing\",\n      \"email\": \"chanxing9@gmail.com\",\n      \"username\": \"007xiaoxingxing\"\n    },\n    \"committer\": {\n      \"name\": \"007xiaoxing\",\n      \"email\": \"chanxing9@gmail.com\",\n      \"username\": \"007xiaoxingxing\"\n    },\n    \"added\": [\n      \"public/2016/12/04/PIL-Grab/index.html\",\n      \"public/archives/2016/12/index.html\",\n      \"public/tags/PIL/index.html\",\n      \"public/tags/python/index.html\",\n      \"source/_posts/PIL-Grab.md\"\n    ],\n    \"removed\": [\n\n    ],\n    \"modified\": [\n      \"db.json\",\n      这都不重要，略.....\n      \"public/tags/萌新第一次/index.html\"\n    ]\n  },\n  \"repository\": {\n    \"id\": 64537807,\n    \"name\": \"My_Blog\",\n    \"full_name\": \"007xiaoxingxing/My_Blog\",\n    \"owner\": {\n      \"name\": \"007xiaoxingxing\",\n      \"email\": \"994983825@qq.com\"\n    },\n    \"private\": false,\n    \"html_url\": \"https://github.com/007xiaoxingxing/My_Blog\",\n    鬼知道这中间少了些什么？滑稽 - -！\n    \"site_admin\": false\n  }\n}\n```\n\n数据内容十分丰富，包括了你对仓库的操作，仓库改变等等......  \n\n这些数据都可以在服务端进行获取，验证等，然后自定义操作即可。\n\n### 0x4:服务的运行\n\n最后只需要将自动部署的服务端跑起来即可。我选择使用nohub将服务挂起来在后台运行。\n\n```bash\n$nobub python git_deploy.py &\n```\n\nnohub会把后台运行的标准输出重定向到当前目录的nohub.dat中，在这之中我们可以查看相关操作日志。Ok，大功告成，以后就可以直接提交代码的github代码仓库，服务器就能够自动的更新博客文章了。","slug":"Github-Webhook","published":1,"updated":"2017-12-04T07:27:28.757Z","layout":"post","photos":[],"link":"","_id":"cjeqig1m3001zlgqah357866r","content":"<h3 id=\"0x1-需求来源\"><a href=\"#0x1-需求来源\" class=\"headerlink\" title=\"0x1:需求来源\"></a>0x1:需求来源</h3><p>本博客使用的hexo生成的静态页面，整个博客代码是托管在github上的。这样可以方便我在不同的设备上随时同步位于github上的博客代码，并撰写新的内容。写博文的问题得到了解决，但是每次更新服务器上的内容时却要登录服务器去拉取github上的内容，很是繁琐。github提供了webhook功能，用户对仓库操作引起的事件，例如push，pull等可以触发github利用webhook向远程服务器发起链接，并携带一定的参数，这样的话，在远程服务器监听来自webhook的请求就可以执行代码更新操作了哇。<br><a id=\"more\"></a></p>\n<h3 id=\"0x2-服务端代码\"><a href=\"#0x2-服务端代码\" class=\"headerlink\" title=\"0x2:服务端代码\"></a>0x2:服务端代码</h3><p>服务端代码的思路很清晰。 </p>\n<ol>\n<li>监听来自webhook的消息，并验证是否合法  </li>\n<li>拉取git仓库的内容至本地临时仓库</li>\n<li>拷贝代码至web根目录，并删除web部署目录中的.git目录，防止代码泄露  </li>\n</ol>\n<p>正好最近在学习python，就利用python的tornado框架写几句话完成服务端的工作吧。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> tornado.ioloop</span><br><span class=\"line\"><span class=\"keyword\">import</span> tornado.web</span><br><span class=\"line\"><span class=\"keyword\">import</span> json</span><br><span class=\"line\"><span class=\"keyword\">import</span> sys</span><br><span class=\"line\"><span class=\"keyword\">import</span> os</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#pull my blog from github</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">PullBlog</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">\tos.system(<span class=\"string\">\"cd ~/blog/My_Blog&amp;&amp;git pull https://github.com/007xiaoxingxing/My_Blog.git&amp;&amp;cp -r public/* /var/blog/\"</span>)</span><br><span class=\"line\">\t<span class=\"keyword\">print</span> <span class=\"string\">\"pull blog\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MainHandler</span><span class=\"params\">(tornado.web.RequestHandler)</span>:</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get</span><span class=\"params\">(self)</span>:</span></span><br><span class=\"line\">\t\tself.write(<span class=\"string\">\"Hello Guys!\"</span>);</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">post</span><span class=\"params\">(self)</span>:</span></span><br><span class=\"line\">\t\tjson_str=self.request.body</span><br><span class=\"line\">\t\tdata=json.loads(json_str)</span><br><span class=\"line\">        <span class=\"comment\">#这里的内容需要根据github的post数据自行进行判断，我这里一切从简了</span></span><br><span class=\"line\">\t\ttarget= data[<span class=\"string\">\"repository\"</span>][<span class=\"string\">\"name\"</span>]</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> target == <span class=\"string\">\"My_Blog\"</span>:</span><br><span class=\"line\">\t\t\tPullBlog()</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">print</span> <span class=\"string\">\"ooo\"</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> target == <span class=\"string\">\"photo_manage\"</span>:</span><br><span class=\"line\">\t\t\tPullPhoto()</span><br><span class=\"line\">application = tornado.web.Application([</span><br><span class=\"line\">\t(<span class=\"string\">r\"/\"</span>,MainHandler),</span><br><span class=\"line\">])</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">\"__main__\"</span>:</span><br><span class=\"line\">\tapplication.listen(<span class=\"number\">8888</span>)</span><br><span class=\"line\">\ttornado.ioloop.IOLoop.instance().start()</span><br></pre></td></tr></table></figure>\n<p>这段代码是不是很眼熟？Yes，它就是tornado的Hello World，我在其中增添了获取post内容，并把接收到的json字符串解析成python对象，如果符合要求就进行代码更新操作。</p>\n<h3 id=\"0x3-Github代码仓库相关设置\"><a href=\"#0x3-Github代码仓库相关设置\" class=\"headerlink\" title=\"0x3:Github代码仓库相关设置\"></a>0x3:Github代码仓库相关设置</h3><p>在github代码仓库需要设置webhook的远程服务器地址，post的数据格式和密钥。</p>\n<p><img src=\"/blogimg/githook.png\" alt=\"image\"></p>\n<p>设置好webhook的url，并点击Add webhook按钮后，github的服务器会第一次发送数据到你设置的url地址上，我们来看一下它都发送了些什么数据。</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"ref\"</span>: <span class=\"string\">\"refs/heads/master\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"before\"</span>: <span class=\"string\">\"2db041797c019dd3f04b45203ba4ad09ffef2654\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"after\"</span>: <span class=\"string\">\"454cc4e6bfce259cd29fbc112c9b3714e0750ab7\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"created\"</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"deleted\"</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"forced\"</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"base_ref\"</span>: <span class=\"literal\">null</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"compare\"</span>: <span class=\"string\">\"https://github.com/007xiaoxingxing/My_Blog/compare/2db041797c01...454cc4e6bfce\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"commits\"</span>: [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"id\"</span>: <span class=\"string\">\"454cc4e6bfce259cd29fbc112c9b3714e0750ab7\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"tree_id\"</span>: <span class=\"string\">\"09538c4e1f362018d9e230d4de2225ca469fb32a\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"distinct\"</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"message\"</span>: <span class=\"string\">\"PIL grab\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"timestamp\"</span>: <span class=\"string\">\"2016-12-04T10:38:02+08:00\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"url\"</span>: <span class=\"string\">\"https://github.com/007xiaoxingxing/My_Blog/commit/454cc4e6bfce259cd29fbc112c9b3714e0750ab7\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"author\"</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"007xiaoxing\"</span>,</span><br><span class=\"line\">        <span class=\"attr\">\"email\"</span>: <span class=\"string\">\"chanxing9@gmail.com\"</span>,</span><br><span class=\"line\">        <span class=\"attr\">\"username\"</span>: <span class=\"string\">\"007xiaoxingxing\"</span></span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      <span class=\"attr\">\"committer\"</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"007xiaoxing\"</span>,</span><br><span class=\"line\">        <span class=\"attr\">\"email\"</span>: <span class=\"string\">\"chanxing9@gmail.com\"</span>,</span><br><span class=\"line\">        <span class=\"attr\">\"username\"</span>: <span class=\"string\">\"007xiaoxingxing\"</span></span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      <span class=\"attr\">\"added\"</span>: [</span><br><span class=\"line\">        <span class=\"string\">\"public/2016/12/04/PIL-Grab/index.html\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"public/archives/2016/12/index.html\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"public/tags/PIL/index.html\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"public/tags/python/index.html\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"source/_posts/PIL-Grab.md\"</span></span><br><span class=\"line\">      ],</span><br><span class=\"line\">      <span class=\"attr\">\"removed\"</span>: [</span><br><span class=\"line\"></span><br><span class=\"line\">      ],</span><br><span class=\"line\">      <span class=\"attr\">\"modified\"</span>: [</span><br><span class=\"line\">        <span class=\"string\">\"db.json\"</span>,</span><br><span class=\"line\">        略去一万字.....</span><br><span class=\"line\">      ]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ],</span><br><span class=\"line\">  <span class=\"attr\">\"head_commit\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">\"id\"</span>: <span class=\"string\">\"454cc4e6bfce259cd29fbc112c9b3714e0750ab7\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"tree_id\"</span>: <span class=\"string\">\"09538c4e1f362018d9e230d4de2225ca469fb32a\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"distinct\"</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"message\"</span>: <span class=\"string\">\"PIL grab\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"timestamp\"</span>: <span class=\"string\">\"2016-12-04T10:38:02+08:00\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"url\"</span>: <span class=\"string\">\"https://github.com/007xiaoxingxing/My_Blog/commit/454cc4e6bfce259cd29fbc112c9b3714e0750ab7\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"author\"</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"007xiaoxing\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"email\"</span>: <span class=\"string\">\"chanxing9@gmail.com\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"username\"</span>: <span class=\"string\">\"007xiaoxingxing\"</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"attr\">\"committer\"</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"007xiaoxing\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"email\"</span>: <span class=\"string\">\"chanxing9@gmail.com\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"username\"</span>: <span class=\"string\">\"007xiaoxingxing\"</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"attr\">\"added\"</span>: [</span><br><span class=\"line\">      <span class=\"string\">\"public/2016/12/04/PIL-Grab/index.html\"</span>,</span><br><span class=\"line\">      <span class=\"string\">\"public/archives/2016/12/index.html\"</span>,</span><br><span class=\"line\">      <span class=\"string\">\"public/tags/PIL/index.html\"</span>,</span><br><span class=\"line\">      <span class=\"string\">\"public/tags/python/index.html\"</span>,</span><br><span class=\"line\">      <span class=\"string\">\"source/_posts/PIL-Grab.md\"</span></span><br><span class=\"line\">    ],</span><br><span class=\"line\">    <span class=\"attr\">\"removed\"</span>: [</span><br><span class=\"line\"></span><br><span class=\"line\">    ],</span><br><span class=\"line\">    <span class=\"attr\">\"modified\"</span>: [</span><br><span class=\"line\">      <span class=\"string\">\"db.json\"</span>,</span><br><span class=\"line\">      这都不重要，略.....</span><br><span class=\"line\">      <span class=\"string\">\"public/tags/萌新第一次/index.html\"</span></span><br><span class=\"line\">    ]</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"attr\">\"repository\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">\"id\"</span>: <span class=\"number\">64537807</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"My_Blog\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"full_name\"</span>: <span class=\"string\">\"007xiaoxingxing/My_Blog\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"owner\"</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"007xiaoxingxing\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"email\"</span>: <span class=\"string\">\"994983825@qq.com\"</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"attr\">\"private\"</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"html_url\"</span>: <span class=\"string\">\"https://github.com/007xiaoxingxing/My_Blog\"</span>,</span><br><span class=\"line\">    鬼知道这中间少了些什么？滑稽 - -！</span><br><span class=\"line\">    \"site_admin\": false</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>数据内容十分丰富，包括了你对仓库的操作，仓库改变等等……  </p>\n<p>这些数据都可以在服务端进行获取，验证等，然后自定义操作即可。</p>\n<h3 id=\"0x4-服务的运行\"><a href=\"#0x4-服务的运行\" class=\"headerlink\" title=\"0x4:服务的运行\"></a>0x4:服务的运行</h3><p>最后只需要将自动部署的服务端跑起来即可。我选择使用nohub将服务挂起来在后台运行。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$nobub</span> python git_deploy.py &amp;</span><br></pre></td></tr></table></figure>\n<p>nohub会把后台运行的标准输出重定向到当前目录的nohub.dat中，在这之中我们可以查看相关操作日志。Ok，大功告成，以后就可以直接提交代码的github代码仓库，服务器就能够自动的更新博客文章了。</p>\n","site":{"data":{}},"excerpt":"<h3 id=\"0x1-需求来源\"><a href=\"#0x1-需求来源\" class=\"headerlink\" title=\"0x1:需求来源\"></a>0x1:需求来源</h3><p>本博客使用的hexo生成的静态页面，整个博客代码是托管在github上的。这样可以方便我在不同的设备上随时同步位于github上的博客代码，并撰写新的内容。写博文的问题得到了解决，但是每次更新服务器上的内容时却要登录服务器去拉取github上的内容，很是繁琐。github提供了webhook功能，用户对仓库操作引起的事件，例如push，pull等可以触发github利用webhook向远程服务器发起链接，并携带一定的参数，这样的话，在远程服务器监听来自webhook的请求就可以执行代码更新操作了哇。<br>","more":"</p>\n<h3 id=\"0x2-服务端代码\"><a href=\"#0x2-服务端代码\" class=\"headerlink\" title=\"0x2:服务端代码\"></a>0x2:服务端代码</h3><p>服务端代码的思路很清晰。 </p>\n<ol>\n<li>监听来自webhook的消息，并验证是否合法  </li>\n<li>拉取git仓库的内容至本地临时仓库</li>\n<li>拷贝代码至web根目录，并删除web部署目录中的.git目录，防止代码泄露  </li>\n</ol>\n<p>正好最近在学习python，就利用python的tornado框架写几句话完成服务端的工作吧。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> tornado.ioloop</span><br><span class=\"line\"><span class=\"keyword\">import</span> tornado.web</span><br><span class=\"line\"><span class=\"keyword\">import</span> json</span><br><span class=\"line\"><span class=\"keyword\">import</span> sys</span><br><span class=\"line\"><span class=\"keyword\">import</span> os</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#pull my blog from github</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">PullBlog</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">\tos.system(<span class=\"string\">\"cd ~/blog/My_Blog&amp;&amp;git pull https://github.com/007xiaoxingxing/My_Blog.git&amp;&amp;cp -r public/* /var/blog/\"</span>)</span><br><span class=\"line\">\t<span class=\"keyword\">print</span> <span class=\"string\">\"pull blog\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MainHandler</span><span class=\"params\">(tornado.web.RequestHandler)</span>:</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get</span><span class=\"params\">(self)</span>:</span></span><br><span class=\"line\">\t\tself.write(<span class=\"string\">\"Hello Guys!\"</span>);</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">post</span><span class=\"params\">(self)</span>:</span></span><br><span class=\"line\">\t\tjson_str=self.request.body</span><br><span class=\"line\">\t\tdata=json.loads(json_str)</span><br><span class=\"line\">        <span class=\"comment\">#这里的内容需要根据github的post数据自行进行判断，我这里一切从简了</span></span><br><span class=\"line\">\t\ttarget= data[<span class=\"string\">\"repository\"</span>][<span class=\"string\">\"name\"</span>]</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> target == <span class=\"string\">\"My_Blog\"</span>:</span><br><span class=\"line\">\t\t\tPullBlog()</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">print</span> <span class=\"string\">\"ooo\"</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> target == <span class=\"string\">\"photo_manage\"</span>:</span><br><span class=\"line\">\t\t\tPullPhoto()</span><br><span class=\"line\">application = tornado.web.Application([</span><br><span class=\"line\">\t(<span class=\"string\">r\"/\"</span>,MainHandler),</span><br><span class=\"line\">])</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">\"__main__\"</span>:</span><br><span class=\"line\">\tapplication.listen(<span class=\"number\">8888</span>)</span><br><span class=\"line\">\ttornado.ioloop.IOLoop.instance().start()</span><br></pre></td></tr></table></figure>\n<p>这段代码是不是很眼熟？Yes，它就是tornado的Hello World，我在其中增添了获取post内容，并把接收到的json字符串解析成python对象，如果符合要求就进行代码更新操作。</p>\n<h3 id=\"0x3-Github代码仓库相关设置\"><a href=\"#0x3-Github代码仓库相关设置\" class=\"headerlink\" title=\"0x3:Github代码仓库相关设置\"></a>0x3:Github代码仓库相关设置</h3><p>在github代码仓库需要设置webhook的远程服务器地址，post的数据格式和密钥。</p>\n<p><img src=\"/blogimg/githook.png\" alt=\"image\"></p>\n<p>设置好webhook的url，并点击Add webhook按钮后，github的服务器会第一次发送数据到你设置的url地址上，我们来看一下它都发送了些什么数据。</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"ref\"</span>: <span class=\"string\">\"refs/heads/master\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"before\"</span>: <span class=\"string\">\"2db041797c019dd3f04b45203ba4ad09ffef2654\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"after\"</span>: <span class=\"string\">\"454cc4e6bfce259cd29fbc112c9b3714e0750ab7\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"created\"</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"deleted\"</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"forced\"</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"base_ref\"</span>: <span class=\"literal\">null</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"compare\"</span>: <span class=\"string\">\"https://github.com/007xiaoxingxing/My_Blog/compare/2db041797c01...454cc4e6bfce\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"commits\"</span>: [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"id\"</span>: <span class=\"string\">\"454cc4e6bfce259cd29fbc112c9b3714e0750ab7\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"tree_id\"</span>: <span class=\"string\">\"09538c4e1f362018d9e230d4de2225ca469fb32a\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"distinct\"</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"message\"</span>: <span class=\"string\">\"PIL grab\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"timestamp\"</span>: <span class=\"string\">\"2016-12-04T10:38:02+08:00\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"url\"</span>: <span class=\"string\">\"https://github.com/007xiaoxingxing/My_Blog/commit/454cc4e6bfce259cd29fbc112c9b3714e0750ab7\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"author\"</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"007xiaoxing\"</span>,</span><br><span class=\"line\">        <span class=\"attr\">\"email\"</span>: <span class=\"string\">\"chanxing9@gmail.com\"</span>,</span><br><span class=\"line\">        <span class=\"attr\">\"username\"</span>: <span class=\"string\">\"007xiaoxingxing\"</span></span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      <span class=\"attr\">\"committer\"</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"007xiaoxing\"</span>,</span><br><span class=\"line\">        <span class=\"attr\">\"email\"</span>: <span class=\"string\">\"chanxing9@gmail.com\"</span>,</span><br><span class=\"line\">        <span class=\"attr\">\"username\"</span>: <span class=\"string\">\"007xiaoxingxing\"</span></span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      <span class=\"attr\">\"added\"</span>: [</span><br><span class=\"line\">        <span class=\"string\">\"public/2016/12/04/PIL-Grab/index.html\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"public/archives/2016/12/index.html\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"public/tags/PIL/index.html\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"public/tags/python/index.html\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"source/_posts/PIL-Grab.md\"</span></span><br><span class=\"line\">      ],</span><br><span class=\"line\">      <span class=\"attr\">\"removed\"</span>: [</span><br><span class=\"line\"></span><br><span class=\"line\">      ],</span><br><span class=\"line\">      <span class=\"attr\">\"modified\"</span>: [</span><br><span class=\"line\">        <span class=\"string\">\"db.json\"</span>,</span><br><span class=\"line\">        略去一万字.....</span><br><span class=\"line\">      ]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ],</span><br><span class=\"line\">  <span class=\"attr\">\"head_commit\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">\"id\"</span>: <span class=\"string\">\"454cc4e6bfce259cd29fbc112c9b3714e0750ab7\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"tree_id\"</span>: <span class=\"string\">\"09538c4e1f362018d9e230d4de2225ca469fb32a\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"distinct\"</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"message\"</span>: <span class=\"string\">\"PIL grab\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"timestamp\"</span>: <span class=\"string\">\"2016-12-04T10:38:02+08:00\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"url\"</span>: <span class=\"string\">\"https://github.com/007xiaoxingxing/My_Blog/commit/454cc4e6bfce259cd29fbc112c9b3714e0750ab7\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"author\"</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"007xiaoxing\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"email\"</span>: <span class=\"string\">\"chanxing9@gmail.com\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"username\"</span>: <span class=\"string\">\"007xiaoxingxing\"</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"attr\">\"committer\"</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"007xiaoxing\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"email\"</span>: <span class=\"string\">\"chanxing9@gmail.com\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"username\"</span>: <span class=\"string\">\"007xiaoxingxing\"</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"attr\">\"added\"</span>: [</span><br><span class=\"line\">      <span class=\"string\">\"public/2016/12/04/PIL-Grab/index.html\"</span>,</span><br><span class=\"line\">      <span class=\"string\">\"public/archives/2016/12/index.html\"</span>,</span><br><span class=\"line\">      <span class=\"string\">\"public/tags/PIL/index.html\"</span>,</span><br><span class=\"line\">      <span class=\"string\">\"public/tags/python/index.html\"</span>,</span><br><span class=\"line\">      <span class=\"string\">\"source/_posts/PIL-Grab.md\"</span></span><br><span class=\"line\">    ],</span><br><span class=\"line\">    <span class=\"attr\">\"removed\"</span>: [</span><br><span class=\"line\"></span><br><span class=\"line\">    ],</span><br><span class=\"line\">    <span class=\"attr\">\"modified\"</span>: [</span><br><span class=\"line\">      <span class=\"string\">\"db.json\"</span>,</span><br><span class=\"line\">      这都不重要，略.....</span><br><span class=\"line\">      <span class=\"string\">\"public/tags/萌新第一次/index.html\"</span></span><br><span class=\"line\">    ]</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"attr\">\"repository\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">\"id\"</span>: <span class=\"number\">64537807</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"My_Blog\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"full_name\"</span>: <span class=\"string\">\"007xiaoxingxing/My_Blog\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"owner\"</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"007xiaoxingxing\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"email\"</span>: <span class=\"string\">\"994983825@qq.com\"</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"attr\">\"private\"</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"html_url\"</span>: <span class=\"string\">\"https://github.com/007xiaoxingxing/My_Blog\"</span>,</span><br><span class=\"line\">    鬼知道这中间少了些什么？滑稽 - -！</span><br><span class=\"line\">    \"site_admin\": false</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>数据内容十分丰富，包括了你对仓库的操作，仓库改变等等……  </p>\n<p>这些数据都可以在服务端进行获取，验证等，然后自定义操作即可。</p>\n<h3 id=\"0x4-服务的运行\"><a href=\"#0x4-服务的运行\" class=\"headerlink\" title=\"0x4:服务的运行\"></a>0x4:服务的运行</h3><p>最后只需要将自动部署的服务端跑起来即可。我选择使用nohub将服务挂起来在后台运行。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$nobub</span> python git_deploy.py &amp;</span><br></pre></td></tr></table></figure>\n<p>nohub会把后台运行的标准输出重定向到当前目录的nohub.dat中，在这之中我们可以查看相关操作日志。Ok，大功告成，以后就可以直接提交代码的github代码仓库，服务器就能够自动的更新博客文章了。</p>"},{"title":"github配置ssh key","date":"2016-11-30T02:43:18.000Z","_content":"### 配置ssh key，免密码提交代码至github  \n0x01:在本机生成ssh所需的公钥和私钥  \n```bash\nuser@user MINGW64 ~\n$ cd ~\n\nuser@user MINGW64 ~\n$ ssh-keygen -t rsa -C \"hahaha9@gmail.com\" -f ~/.ssh/PCWIN10（-f参数指定生成的密钥名称，也可以不指定，默认为id_rsa）\nGenerating public/private rsa key pair.\nEnter passphrase (empty for no passphrase):(这里需要输入密码，如果为空，提交的时候就不需要输入密码)\nEnter same passphrase again:（重复刚刚的密码）\nYour identification has been saved in PCWIN10.（生成的私钥）\nYour public key has been saved in PCWIN10.pub.（生成的公钥，需要把这个文件中的内容提交到github上）\nThe key fingerprint is:\nSHA256:IIhHNNc8fLREgPg1N+YEuQyUudsTHrtzY7f1yMMYjCM hahaha9@gmail.com\nThe key's randomart image is:\n+---[RSA 2048]----+\n| .+ooBo*+        |\n| o.+= O.*.       |\n|. o..=.X..       |\n| .  o.=..        |\n|     + +So       |\n|    . E o o      |\n|       + . +.    |\n|      o + oooo   |\n|       + o..o..  |\n+----[SHA256]-----+\n\n```\n<!-- more -->\n0x2:添加ssh key至github网站\n![image](/blogimg/gitsshkey.png)\n\n0x3:将私钥添加到本地gitbash  \n```bash\n$ ssh-agent bash --login -i\n$ ssh-add ~/.ssh/PCWIN10(你自己的私钥的路径)\n\n```\n\n0x4:本地测试是否已经正常\n```bash\n$ ssh -T git@github.com\nHi xxxx! You've successfully authenticated, but GitHub does not provide shell access.\n\n```\n已经认证成功。\n\n0x4:将https提交类型的remote设置为ssh类型  \n查看当前本地仓库的远程仓库链接，发现是https类型的，提交代码的时候会要求输入github的帐号和密码，比较麻烦，我们将它改成ssh类型的，加上之前设置的ssh key，就可以实现免密码提交代码了。Let's do it！\n```bash\n$ git remote -v\norigin  https://github.com/yourname/My_Blog.git (fetch)\norigin  https://github.com/yourname/My_Blog.git (push)\n\n```\n0x5:更改远程仓库链接为ssh类型\n```bash\n$ git remote set-url origin git@github.com:你的github用户名/你的远程仓库名.git\n```\n再次查看远程仓库链接\n```bash\n$ git remote -v\norigin  git@github.com:yourname/xxx.git (fetch)\norigin  git@github.com:xxxx/xxx.git (push)\n\n```\n0x6:在\"~/.ssh\"下新建一个名为config的配置文件，内容如下:\n```bash\n$ cat ~/.ssh/config\nHost github.com\n        HostName github.com\n        PreferredAuthentications publickey\n        IdentityFile ~/.ssh/PCWIN10\n\n```\n0x7: 使用密钥来登录github进行操作，免除输入帐号，密码的麻烦。\n```bash\n$ ssh -T git@github.com\nHi xxxx! You've successfully authenticated, but GitHub does not provide shell access.(测试通过，说明咱们已经成功利用ssh密钥登录了)\n\n$ git push（提交一下本地的代码）\n\n```\nps: ssh-agent\n>ssh-agent是一种控制用来保存公钥身份验证所使用的私钥的程序，ssh-agent其实就是一个密钥管理器，运行ssh-agent以后，使用ssh-add将私钥交给ssh-agent保管，其他程序需要身份验证的时候可以将验证申请交给ssh-agent来完成整个认证过程。\n","source":"_posts/Github-Add-SSHKEY.md","raw":"---\ntitle: github配置ssh key\ndate: 2016-11-30 10:43:18\ncategories: Program\ntags:\n- github\n- ssh key\n---\n### 配置ssh key，免密码提交代码至github  \n0x01:在本机生成ssh所需的公钥和私钥  \n```bash\nuser@user MINGW64 ~\n$ cd ~\n\nuser@user MINGW64 ~\n$ ssh-keygen -t rsa -C \"hahaha9@gmail.com\" -f ~/.ssh/PCWIN10（-f参数指定生成的密钥名称，也可以不指定，默认为id_rsa）\nGenerating public/private rsa key pair.\nEnter passphrase (empty for no passphrase):(这里需要输入密码，如果为空，提交的时候就不需要输入密码)\nEnter same passphrase again:（重复刚刚的密码）\nYour identification has been saved in PCWIN10.（生成的私钥）\nYour public key has been saved in PCWIN10.pub.（生成的公钥，需要把这个文件中的内容提交到github上）\nThe key fingerprint is:\nSHA256:IIhHNNc8fLREgPg1N+YEuQyUudsTHrtzY7f1yMMYjCM hahaha9@gmail.com\nThe key's randomart image is:\n+---[RSA 2048]----+\n| .+ooBo*+        |\n| o.+= O.*.       |\n|. o..=.X..       |\n| .  o.=..        |\n|     + +So       |\n|    . E o o      |\n|       + . +.    |\n|      o + oooo   |\n|       + o..o..  |\n+----[SHA256]-----+\n\n```\n<!-- more -->\n0x2:添加ssh key至github网站\n![image](/blogimg/gitsshkey.png)\n\n0x3:将私钥添加到本地gitbash  \n```bash\n$ ssh-agent bash --login -i\n$ ssh-add ~/.ssh/PCWIN10(你自己的私钥的路径)\n\n```\n\n0x4:本地测试是否已经正常\n```bash\n$ ssh -T git@github.com\nHi xxxx! You've successfully authenticated, but GitHub does not provide shell access.\n\n```\n已经认证成功。\n\n0x4:将https提交类型的remote设置为ssh类型  \n查看当前本地仓库的远程仓库链接，发现是https类型的，提交代码的时候会要求输入github的帐号和密码，比较麻烦，我们将它改成ssh类型的，加上之前设置的ssh key，就可以实现免密码提交代码了。Let's do it！\n```bash\n$ git remote -v\norigin  https://github.com/yourname/My_Blog.git (fetch)\norigin  https://github.com/yourname/My_Blog.git (push)\n\n```\n0x5:更改远程仓库链接为ssh类型\n```bash\n$ git remote set-url origin git@github.com:你的github用户名/你的远程仓库名.git\n```\n再次查看远程仓库链接\n```bash\n$ git remote -v\norigin  git@github.com:yourname/xxx.git (fetch)\norigin  git@github.com:xxxx/xxx.git (push)\n\n```\n0x6:在\"~/.ssh\"下新建一个名为config的配置文件，内容如下:\n```bash\n$ cat ~/.ssh/config\nHost github.com\n        HostName github.com\n        PreferredAuthentications publickey\n        IdentityFile ~/.ssh/PCWIN10\n\n```\n0x7: 使用密钥来登录github进行操作，免除输入帐号，密码的麻烦。\n```bash\n$ ssh -T git@github.com\nHi xxxx! You've successfully authenticated, but GitHub does not provide shell access.(测试通过，说明咱们已经成功利用ssh密钥登录了)\n\n$ git push（提交一下本地的代码）\n\n```\nps: ssh-agent\n>ssh-agent是一种控制用来保存公钥身份验证所使用的私钥的程序，ssh-agent其实就是一个密钥管理器，运行ssh-agent以后，使用ssh-add将私钥交给ssh-agent保管，其他程序需要身份验证的时候可以将验证申请交给ssh-agent来完成整个认证过程。\n","slug":"Github-Add-SSHKEY","published":1,"updated":"2017-12-04T07:27:28.756Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjeqig1m70022lgqaipdky0xx","content":"<h3 id=\"配置ssh-key，免密码提交代码至github\"><a href=\"#配置ssh-key，免密码提交代码至github\" class=\"headerlink\" title=\"配置ssh key，免密码提交代码至github\"></a>配置ssh key，免密码提交代码至github</h3><p>0x01:在本机生成ssh所需的公钥和私钥<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">user@user MINGW64 ~</span><br><span class=\"line\">$ <span class=\"built_in\">cd</span> ~</span><br><span class=\"line\"></span><br><span class=\"line\">user@user MINGW64 ~</span><br><span class=\"line\">$ ssh-keygen -t rsa -C <span class=\"string\">\"hahaha9@gmail.com\"</span> -f ~/.ssh/PCWIN10（-f参数指定生成的密钥名称，也可以不指定，默认为id_rsa）</span><br><span class=\"line\">Generating public/private rsa key pair.</span><br><span class=\"line\">Enter passphrase (empty <span class=\"keyword\">for</span> no passphrase):(这里需要输入密码，如果为空，提交的时候就不需要输入密码)</span><br><span class=\"line\">Enter same passphrase again:（重复刚刚的密码）</span><br><span class=\"line\">Your identification has been saved <span class=\"keyword\">in</span> PCWIN10.（生成的私钥）</span><br><span class=\"line\">Your public key has been saved <span class=\"keyword\">in</span> PCWIN10.pub.（生成的公钥，需要把这个文件中的内容提交到github上）</span><br><span class=\"line\">The key fingerprint is:</span><br><span class=\"line\">SHA256:IIhHNNc8fLREgPg1N+YEuQyUudsTHrtzY7f1yMMYjCM hahaha9@gmail.com</span><br><span class=\"line\">The key<span class=\"string\">'s randomart image is:</span></span><br><span class=\"line\"><span class=\"string\">+---[RSA 2048]----+</span></span><br><span class=\"line\"><span class=\"string\">| .+ooBo*+        |</span></span><br><span class=\"line\"><span class=\"string\">| o.+= O.*.       |</span></span><br><span class=\"line\"><span class=\"string\">|. o..=.X..       |</span></span><br><span class=\"line\"><span class=\"string\">| .  o.=..        |</span></span><br><span class=\"line\"><span class=\"string\">|     + +So       |</span></span><br><span class=\"line\"><span class=\"string\">|    . E o o      |</span></span><br><span class=\"line\"><span class=\"string\">|       + . +.    |</span></span><br><span class=\"line\"><span class=\"string\">|      o + oooo   |</span></span><br><span class=\"line\"><span class=\"string\">|       + o..o..  |</span></span><br><span class=\"line\"><span class=\"string\">+----[SHA256]-----+</span></span><br></pre></td></tr></table></figure></p>\n<a id=\"more\"></a>\n<p>0x2:添加ssh key至github网站<br><img src=\"/blogimg/gitsshkey.png\" alt=\"image\"></p>\n<p>0x3:将私钥添加到本地gitbash<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ ssh-agent bash --login -i</span><br><span class=\"line\">$ ssh-add ~/.ssh/PCWIN10(你自己的私钥的路径)</span><br></pre></td></tr></table></figure></p>\n<p>0x4:本地测试是否已经正常<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ ssh -T git@github.com</span><br><span class=\"line\">Hi xxxx! You<span class=\"string\">'ve successfully authenticated, but GitHub does not provide shell access.</span></span><br></pre></td></tr></table></figure></p>\n<p>已经认证成功。</p>\n<p>0x4:将https提交类型的remote设置为ssh类型<br>查看当前本地仓库的远程仓库链接，发现是https类型的，提交代码的时候会要求输入github的帐号和密码，比较麻烦，我们将它改成ssh类型的，加上之前设置的ssh key，就可以实现免密码提交代码了。Let’s do it！<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git remote -v</span><br><span class=\"line\">origin  https://github.com/yourname/My_Blog.git (fetch)</span><br><span class=\"line\">origin  https://github.com/yourname/My_Blog.git (push)</span><br></pre></td></tr></table></figure></p>\n<p>0x5:更改远程仓库链接为ssh类型<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git remote <span class=\"built_in\">set</span>-url origin git@github.com:你的github用户名/你的远程仓库名.git</span><br></pre></td></tr></table></figure></p>\n<p>再次查看远程仓库链接<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git remote -v</span><br><span class=\"line\">origin  git@github.com:yourname/xxx.git (fetch)</span><br><span class=\"line\">origin  git@github.com:xxxx/xxx.git (push)</span><br></pre></td></tr></table></figure></p>\n<p>0x6:在”~/.ssh”下新建一个名为config的配置文件，内容如下:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ cat ~/.ssh/config</span><br><span class=\"line\">Host github.com</span><br><span class=\"line\">        HostName github.com</span><br><span class=\"line\">        PreferredAuthentications publickey</span><br><span class=\"line\">        IdentityFile ~/.ssh/PCWIN10</span><br></pre></td></tr></table></figure></p>\n<p>0x7: 使用密钥来登录github进行操作，免除输入帐号，密码的麻烦。<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ ssh -T git@github.com</span><br><span class=\"line\">Hi xxxx! You<span class=\"string\">'ve successfully authenticated, but GitHub does not provide shell access.(测试通过，说明咱们已经成功利用ssh密钥登录了)</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">$ git push（提交一下本地的代码）</span></span><br></pre></td></tr></table></figure></p>\n<p>ps: ssh-agent</p>\n<blockquote>\n<p>ssh-agent是一种控制用来保存公钥身份验证所使用的私钥的程序，ssh-agent其实就是一个密钥管理器，运行ssh-agent以后，使用ssh-add将私钥交给ssh-agent保管，其他程序需要身份验证的时候可以将验证申请交给ssh-agent来完成整个认证过程。</p>\n</blockquote>\n","site":{"data":{}},"excerpt":"<h3 id=\"配置ssh-key，免密码提交代码至github\"><a href=\"#配置ssh-key，免密码提交代码至github\" class=\"headerlink\" title=\"配置ssh key，免密码提交代码至github\"></a>配置ssh key，免密码提交代码至github</h3><p>0x01:在本机生成ssh所需的公钥和私钥<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">user@user MINGW64 ~</span><br><span class=\"line\">$ <span class=\"built_in\">cd</span> ~</span><br><span class=\"line\"></span><br><span class=\"line\">user@user MINGW64 ~</span><br><span class=\"line\">$ ssh-keygen -t rsa -C <span class=\"string\">\"hahaha9@gmail.com\"</span> -f ~/.ssh/PCWIN10（-f参数指定生成的密钥名称，也可以不指定，默认为id_rsa）</span><br><span class=\"line\">Generating public/private rsa key pair.</span><br><span class=\"line\">Enter passphrase (empty <span class=\"keyword\">for</span> no passphrase):(这里需要输入密码，如果为空，提交的时候就不需要输入密码)</span><br><span class=\"line\">Enter same passphrase again:（重复刚刚的密码）</span><br><span class=\"line\">Your identification has been saved <span class=\"keyword\">in</span> PCWIN10.（生成的私钥）</span><br><span class=\"line\">Your public key has been saved <span class=\"keyword\">in</span> PCWIN10.pub.（生成的公钥，需要把这个文件中的内容提交到github上）</span><br><span class=\"line\">The key fingerprint is:</span><br><span class=\"line\">SHA256:IIhHNNc8fLREgPg1N+YEuQyUudsTHrtzY7f1yMMYjCM hahaha9@gmail.com</span><br><span class=\"line\">The key<span class=\"string\">'s randomart image is:</span></span><br><span class=\"line\"><span class=\"string\">+---[RSA 2048]----+</span></span><br><span class=\"line\"><span class=\"string\">| .+ooBo*+        |</span></span><br><span class=\"line\"><span class=\"string\">| o.+= O.*.       |</span></span><br><span class=\"line\"><span class=\"string\">|. o..=.X..       |</span></span><br><span class=\"line\"><span class=\"string\">| .  o.=..        |</span></span><br><span class=\"line\"><span class=\"string\">|     + +So       |</span></span><br><span class=\"line\"><span class=\"string\">|    . E o o      |</span></span><br><span class=\"line\"><span class=\"string\">|       + . +.    |</span></span><br><span class=\"line\"><span class=\"string\">|      o + oooo   |</span></span><br><span class=\"line\"><span class=\"string\">|       + o..o..  |</span></span><br><span class=\"line\"><span class=\"string\">+----[SHA256]-----+</span></span><br></pre></td></tr></table></figure></p>","more":"<p>0x2:添加ssh key至github网站<br><img src=\"/blogimg/gitsshkey.png\" alt=\"image\"></p>\n<p>0x3:将私钥添加到本地gitbash<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ ssh-agent bash --login -i</span><br><span class=\"line\">$ ssh-add ~/.ssh/PCWIN10(你自己的私钥的路径)</span><br></pre></td></tr></table></figure></p>\n<p>0x4:本地测试是否已经正常<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ ssh -T git@github.com</span><br><span class=\"line\">Hi xxxx! You<span class=\"string\">'ve successfully authenticated, but GitHub does not provide shell access.</span></span><br></pre></td></tr></table></figure></p>\n<p>已经认证成功。</p>\n<p>0x4:将https提交类型的remote设置为ssh类型<br>查看当前本地仓库的远程仓库链接，发现是https类型的，提交代码的时候会要求输入github的帐号和密码，比较麻烦，我们将它改成ssh类型的，加上之前设置的ssh key，就可以实现免密码提交代码了。Let’s do it！<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git remote -v</span><br><span class=\"line\">origin  https://github.com/yourname/My_Blog.git (fetch)</span><br><span class=\"line\">origin  https://github.com/yourname/My_Blog.git (push)</span><br></pre></td></tr></table></figure></p>\n<p>0x5:更改远程仓库链接为ssh类型<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git remote <span class=\"built_in\">set</span>-url origin git@github.com:你的github用户名/你的远程仓库名.git</span><br></pre></td></tr></table></figure></p>\n<p>再次查看远程仓库链接<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git remote -v</span><br><span class=\"line\">origin  git@github.com:yourname/xxx.git (fetch)</span><br><span class=\"line\">origin  git@github.com:xxxx/xxx.git (push)</span><br></pre></td></tr></table></figure></p>\n<p>0x6:在”~/.ssh”下新建一个名为config的配置文件，内容如下:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ cat ~/.ssh/config</span><br><span class=\"line\">Host github.com</span><br><span class=\"line\">        HostName github.com</span><br><span class=\"line\">        PreferredAuthentications publickey</span><br><span class=\"line\">        IdentityFile ~/.ssh/PCWIN10</span><br></pre></td></tr></table></figure></p>\n<p>0x7: 使用密钥来登录github进行操作，免除输入帐号，密码的麻烦。<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ ssh -T git@github.com</span><br><span class=\"line\">Hi xxxx! You<span class=\"string\">'ve successfully authenticated, but GitHub does not provide shell access.(测试通过，说明咱们已经成功利用ssh密钥登录了)</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">$ git push（提交一下本地的代码）</span></span><br></pre></td></tr></table></figure></p>\n<p>ps: ssh-agent</p>\n<blockquote>\n<p>ssh-agent是一种控制用来保存公钥身份验证所使用的私钥的程序，ssh-agent其实就是一个密钥管理器，运行ssh-agent以后，使用ssh-add将私钥交给ssh-agent保管，其他程序需要身份验证的时候可以将验证申请交给ssh-agent来完成整个认证过程。</p>\n</blockquote>"},{"title":"Learn VIM","date":"2016-11-29T11:25:18.000Z","_content":"###  动手学VIM编辑器\n0x1:What is VIM editor?\n> vi编辑器通常被简称为vi，而vi又是visual editor的简称  。它在Linux上的地位就像Edit程序在DOS上一样。它可以执行输出、删除、查找、替换、块操作等众多文本操作，而且用户可以根据自己的需要对其进行定制，这是其他编辑程序所没有的。\nvi 编辑器并不是一个排版程序，它不像Word或WPS那样可以对字体、格式、段落等其他属性进行编排，它只是一个文本编辑程序。没有菜单，只有命令，且命令繁多。vi有3种基本工作模式：命令行模式、文本输入模式和末行模式。\nVim是vi的加强版，比vi更容易使用。vi的命令几乎全部都可以在vim上使用。\n\n---摘自百度百科  \n<!-- more -->\n0x2:命令模式情形下的一些命令  \n进入命令模式的方法：ESC\n  \n    \n    \n#查看VIM编辑器的帮助信息。\n>:help\n\n![image](/blogimg/vim-help.png)\n\n#正常退出退出编辑器\n>:q  \n\n#保存并退出编辑器\n>:wq\n\n#保存退出编辑器，并将文件存储为filename\n>:wq filename\n\n#强制退出，不保存\n>:q!\n\n#打开某文件(需保存当前文件，否则会报错)\n>:e /root/file\n\n#强制打开某文件\n>:e! /root/file\n\n#读取某文件，追加到当前文件末尾\n>:r /root/file\n\n#保存文件\n>:w (文件路径)\n\n0x3:插入模式的一些快捷按键操作\n\n#进入插入模式，将光标放在当前光标之后\n>a\n\n#进入插入模式，将光标放在当前光标所在的行尾\n>A\n\n#在当前光标的下一行插入新行，并将光标放在新行的行首\n>o\n\n#在光标的前一行插入一行，并将光标放在行首\n>O\n\n#在光标所在位置进入插入模式,貌似这个用得最多了\n>i\n\n0x4 移动光标\n在进行编辑的时候，可能需要移动光标位置，进行修改或者输入新的内容，除了使用方向键之外，在命令模式下，使用hmjkl也能够快速的移动光标。\n>k:向上移动光标  \n\n>j:向下移动光标  \n\n>h:向前移动光标  \n\n>l:向右移动光标  \n\n这种感觉有点像玩FPS游戏的wasd方式，不过是把操作放在了右手上而已。用起来感觉还蛮不错的。\n\n0x5 删除文本  \n使用退格键或者delete键可以删除当前光标前或所在处的字符，然而在VIM中还可以使用命令来删除我们想删除的内容哦。  \n\n>x :删除当前光标所在处的字符，如果想删除多个字符，连续着按。 \n\n>dd  :删除当前光标所在行，如果想删除多行，可以用ndd的方式，n为你想删除的行数。  \n\n>dw :删除光标处的单词，包括词尾的空格。  \n\n>de :删除当前光标所在处的单词，和dw的区别在于保留了单词词尾的空格。  \n\n>d^ :删除当前光标所在位置到行首的所有字符。  \n\n>d$ :删除当前光标到行尾的所有字符。  \n\n>J :将当前光标所在行和下一行合并（删除行尾的换行符）\n\n0x6 撤销和恢复  \n\n>u :撤销上一步操作，可多次使用。  \n\n>Ctrl+r :放弃上一次撤销操作，可使用多次。\n\n0x7 快速移动光标  \n\n>b :将光标移动到当前光标所在单词的前一个单词的首字母，可以使nb，即移动n个单词的位置。  \n\n>w :将光标移动到当前光标的后一个单词的首字母，可以使nw，即移动到n个单词后的首字母。  \n\n>e :移动到后一个单词的尾字母，可以使ne，效果与之前的效果类似。  \n\n>ge :与e的作用相反，移动光标至前一个单词的尾字母，也可是是nge，n表示需要跨过的单词数目。  \n\n>^ :快速移动光标到行首，Home键，0键也可以移动光标的行首。  \n\n>$ :快速移动光标到行尾，End键也可以移动光标到行尾。n$,可以将光标移动到当前行之后n-1行的末尾。  \n\n>g :跳到当前文本的第一行，也可以使用1G。  \n\n>G :跳到当前文本的最后一行。  \n\n>nG :跳转到第n行，其中n为一个正整数。\n\n当然，咱们的鼠标也是可以定位光标的，哪里需要点哪里！\n\n0x8 查找功能  \n在命令模式下，正向查找的命令为“/”\n>/pattern :pattern为需要查找的字符串，可以是正则表达式。  \n\n在正向查找状态下\n\n>n :跳转到下一条匹配的内容。  \n>N :跳转到上一条匹配的内容。\n\n反向查找的命令为“?”  \n\n>?pattern  \n\n在反向查找状态下\n>n :跳转到上一条匹配的内容。  \n>N :跳转到下一条匹配的内容。\n\n0x9 替换功能  \n替换使用的命令是s，基本格式如下：  \n\n>: s/pattern1/pattern2/  \n\npattern1表示要查找的文本，pattern2为替换后的文本，“/”为分隔符，分隔符也可以是“：”。\n\n谨慎的查找替换  \n\n>:%s/pattern1/pattern2/gc  \n\n执行这条命令之后，VIM会查找到所有匹配pattern1的字符串，并提示用户是否需要进行替换。\n\n\n以上是VIM编辑器的一些基础的使用方法，其功能还很强大，待之后用到了再补充吧。\n\n\n\n\n\n\n参考书：《Linux 命令、编辑器与SHELL编程》 王刚等著\n","source":"_posts/Learn_VIM.md","raw":"---\ntitle: Learn VIM\ndate: 2016-11-29 19:25:18\ncategories: Linux\ntags:\n- VIM\n- Linux\n- Edtor\n---\n###  动手学VIM编辑器\n0x1:What is VIM editor?\n> vi编辑器通常被简称为vi，而vi又是visual editor的简称  。它在Linux上的地位就像Edit程序在DOS上一样。它可以执行输出、删除、查找、替换、块操作等众多文本操作，而且用户可以根据自己的需要对其进行定制，这是其他编辑程序所没有的。\nvi 编辑器并不是一个排版程序，它不像Word或WPS那样可以对字体、格式、段落等其他属性进行编排，它只是一个文本编辑程序。没有菜单，只有命令，且命令繁多。vi有3种基本工作模式：命令行模式、文本输入模式和末行模式。\nVim是vi的加强版，比vi更容易使用。vi的命令几乎全部都可以在vim上使用。\n\n---摘自百度百科  \n<!-- more -->\n0x2:命令模式情形下的一些命令  \n进入命令模式的方法：ESC\n  \n    \n    \n#查看VIM编辑器的帮助信息。\n>:help\n\n![image](/blogimg/vim-help.png)\n\n#正常退出退出编辑器\n>:q  \n\n#保存并退出编辑器\n>:wq\n\n#保存退出编辑器，并将文件存储为filename\n>:wq filename\n\n#强制退出，不保存\n>:q!\n\n#打开某文件(需保存当前文件，否则会报错)\n>:e /root/file\n\n#强制打开某文件\n>:e! /root/file\n\n#读取某文件，追加到当前文件末尾\n>:r /root/file\n\n#保存文件\n>:w (文件路径)\n\n0x3:插入模式的一些快捷按键操作\n\n#进入插入模式，将光标放在当前光标之后\n>a\n\n#进入插入模式，将光标放在当前光标所在的行尾\n>A\n\n#在当前光标的下一行插入新行，并将光标放在新行的行首\n>o\n\n#在光标的前一行插入一行，并将光标放在行首\n>O\n\n#在光标所在位置进入插入模式,貌似这个用得最多了\n>i\n\n0x4 移动光标\n在进行编辑的时候，可能需要移动光标位置，进行修改或者输入新的内容，除了使用方向键之外，在命令模式下，使用hmjkl也能够快速的移动光标。\n>k:向上移动光标  \n\n>j:向下移动光标  \n\n>h:向前移动光标  \n\n>l:向右移动光标  \n\n这种感觉有点像玩FPS游戏的wasd方式，不过是把操作放在了右手上而已。用起来感觉还蛮不错的。\n\n0x5 删除文本  \n使用退格键或者delete键可以删除当前光标前或所在处的字符，然而在VIM中还可以使用命令来删除我们想删除的内容哦。  \n\n>x :删除当前光标所在处的字符，如果想删除多个字符，连续着按。 \n\n>dd  :删除当前光标所在行，如果想删除多行，可以用ndd的方式，n为你想删除的行数。  \n\n>dw :删除光标处的单词，包括词尾的空格。  \n\n>de :删除当前光标所在处的单词，和dw的区别在于保留了单词词尾的空格。  \n\n>d^ :删除当前光标所在位置到行首的所有字符。  \n\n>d$ :删除当前光标到行尾的所有字符。  \n\n>J :将当前光标所在行和下一行合并（删除行尾的换行符）\n\n0x6 撤销和恢复  \n\n>u :撤销上一步操作，可多次使用。  \n\n>Ctrl+r :放弃上一次撤销操作，可使用多次。\n\n0x7 快速移动光标  \n\n>b :将光标移动到当前光标所在单词的前一个单词的首字母，可以使nb，即移动n个单词的位置。  \n\n>w :将光标移动到当前光标的后一个单词的首字母，可以使nw，即移动到n个单词后的首字母。  \n\n>e :移动到后一个单词的尾字母，可以使ne，效果与之前的效果类似。  \n\n>ge :与e的作用相反，移动光标至前一个单词的尾字母，也可是是nge，n表示需要跨过的单词数目。  \n\n>^ :快速移动光标到行首，Home键，0键也可以移动光标的行首。  \n\n>$ :快速移动光标到行尾，End键也可以移动光标到行尾。n$,可以将光标移动到当前行之后n-1行的末尾。  \n\n>g :跳到当前文本的第一行，也可以使用1G。  \n\n>G :跳到当前文本的最后一行。  \n\n>nG :跳转到第n行，其中n为一个正整数。\n\n当然，咱们的鼠标也是可以定位光标的，哪里需要点哪里！\n\n0x8 查找功能  \n在命令模式下，正向查找的命令为“/”\n>/pattern :pattern为需要查找的字符串，可以是正则表达式。  \n\n在正向查找状态下\n\n>n :跳转到下一条匹配的内容。  \n>N :跳转到上一条匹配的内容。\n\n反向查找的命令为“?”  \n\n>?pattern  \n\n在反向查找状态下\n>n :跳转到上一条匹配的内容。  \n>N :跳转到下一条匹配的内容。\n\n0x9 替换功能  \n替换使用的命令是s，基本格式如下：  \n\n>: s/pattern1/pattern2/  \n\npattern1表示要查找的文本，pattern2为替换后的文本，“/”为分隔符，分隔符也可以是“：”。\n\n谨慎的查找替换  \n\n>:%s/pattern1/pattern2/gc  \n\n执行这条命令之后，VIM会查找到所有匹配pattern1的字符串，并提示用户是否需要进行替换。\n\n\n以上是VIM编辑器的一些基础的使用方法，其功能还很强大，待之后用到了再补充吧。\n\n\n\n\n\n\n参考书：《Linux 命令、编辑器与SHELL编程》 王刚等著\n","slug":"Learn_VIM","published":1,"updated":"2017-12-04T07:27:28.758Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjeqig1mc0024lgqagk790jyf","content":"<h3 id=\"动手学VIM编辑器\"><a href=\"#动手学VIM编辑器\" class=\"headerlink\" title=\"动手学VIM编辑器\"></a>动手学VIM编辑器</h3><p>0x1:What is VIM editor?</p>\n<blockquote>\n<p>vi编辑器通常被简称为vi，而vi又是visual editor的简称  。它在Linux上的地位就像Edit程序在DOS上一样。它可以执行输出、删除、查找、替换、块操作等众多文本操作，而且用户可以根据自己的需要对其进行定制，这是其他编辑程序所没有的。<br>vi 编辑器并不是一个排版程序，它不像Word或WPS那样可以对字体、格式、段落等其他属性进行编排，它只是一个文本编辑程序。没有菜单，只有命令，且命令繁多。vi有3种基本工作模式：命令行模式、文本输入模式和末行模式。<br>Vim是vi的加强版，比vi更容易使用。vi的命令几乎全部都可以在vim上使用。</p>\n</blockquote>\n<p>—摘自百度百科<br><a id=\"more\"></a><br>0x2:命令模式情形下的一些命令<br>进入命令模式的方法：ESC</p>\n<p>#查看VIM编辑器的帮助信息。</p>\n<blockquote>\n<p>:help</p>\n</blockquote>\n<p><img src=\"/blogimg/vim-help.png\" alt=\"image\"></p>\n<p>#正常退出退出编辑器</p>\n<blockquote>\n<p>:q  </p>\n</blockquote>\n<p>#保存并退出编辑器</p>\n<blockquote>\n<p>:wq</p>\n</blockquote>\n<p>#保存退出编辑器，并将文件存储为filename</p>\n<blockquote>\n<p>:wq filename</p>\n</blockquote>\n<p>#强制退出，不保存</p>\n<blockquote>\n<p>:q!</p>\n</blockquote>\n<p>#打开某文件(需保存当前文件，否则会报错)</p>\n<blockquote>\n<p>:e /root/file</p>\n</blockquote>\n<p>#强制打开某文件</p>\n<blockquote>\n<p>:e! /root/file</p>\n</blockquote>\n<p>#读取某文件，追加到当前文件末尾</p>\n<blockquote>\n<p>:r /root/file</p>\n</blockquote>\n<p>#保存文件</p>\n<blockquote>\n<p>:w (文件路径)</p>\n</blockquote>\n<p>0x3:插入模式的一些快捷按键操作</p>\n<p>#进入插入模式，将光标放在当前光标之后</p>\n<blockquote>\n<p>a</p>\n</blockquote>\n<p>#进入插入模式，将光标放在当前光标所在的行尾</p>\n<blockquote>\n<p>A</p>\n</blockquote>\n<p>#在当前光标的下一行插入新行，并将光标放在新行的行首</p>\n<blockquote>\n<p>o</p>\n</blockquote>\n<p>#在光标的前一行插入一行，并将光标放在行首</p>\n<blockquote>\n<p>O</p>\n</blockquote>\n<p>#在光标所在位置进入插入模式,貌似这个用得最多了</p>\n<blockquote>\n<p>i</p>\n</blockquote>\n<p>0x4 移动光标<br>在进行编辑的时候，可能需要移动光标位置，进行修改或者输入新的内容，除了使用方向键之外，在命令模式下，使用hmjkl也能够快速的移动光标。</p>\n<blockquote>\n<p>k:向上移动光标  </p>\n<p>j:向下移动光标  </p>\n<p>h:向前移动光标  </p>\n<p>l:向右移动光标  </p>\n</blockquote>\n<p>这种感觉有点像玩FPS游戏的wasd方式，不过是把操作放在了右手上而已。用起来感觉还蛮不错的。</p>\n<p>0x5 删除文本<br>使用退格键或者delete键可以删除当前光标前或所在处的字符，然而在VIM中还可以使用命令来删除我们想删除的内容哦。  </p>\n<blockquote>\n<p>x :删除当前光标所在处的字符，如果想删除多个字符，连续着按。 </p>\n<p>dd  :删除当前光标所在行，如果想删除多行，可以用ndd的方式，n为你想删除的行数。  </p>\n<p>dw :删除光标处的单词，包括词尾的空格。  </p>\n<p>de :删除当前光标所在处的单词，和dw的区别在于保留了单词词尾的空格。  </p>\n<p>d^ :删除当前光标所在位置到行首的所有字符。  </p>\n<p>d$ :删除当前光标到行尾的所有字符。  </p>\n<p>J :将当前光标所在行和下一行合并（删除行尾的换行符）</p>\n</blockquote>\n<p>0x6 撤销和恢复  </p>\n<blockquote>\n<p>u :撤销上一步操作，可多次使用。  </p>\n<p>Ctrl+r :放弃上一次撤销操作，可使用多次。</p>\n</blockquote>\n<p>0x7 快速移动光标  </p>\n<blockquote>\n<p>b :将光标移动到当前光标所在单词的前一个单词的首字母，可以使nb，即移动n个单词的位置。  </p>\n<p>w :将光标移动到当前光标的后一个单词的首字母，可以使nw，即移动到n个单词后的首字母。  </p>\n<p>e :移动到后一个单词的尾字母，可以使ne，效果与之前的效果类似。  </p>\n<p>ge :与e的作用相反，移动光标至前一个单词的尾字母，也可是是nge，n表示需要跨过的单词数目。  </p>\n<p>^ :快速移动光标到行首，Home键，0键也可以移动光标的行首。  </p>\n<p>$ :快速移动光标到行尾，End键也可以移动光标到行尾。n$,可以将光标移动到当前行之后n-1行的末尾。  </p>\n<p>g :跳到当前文本的第一行，也可以使用1G。  </p>\n<p>G :跳到当前文本的最后一行。  </p>\n<p>nG :跳转到第n行，其中n为一个正整数。</p>\n</blockquote>\n<p>当然，咱们的鼠标也是可以定位光标的，哪里需要点哪里！</p>\n<p>0x8 查找功能<br>在命令模式下，正向查找的命令为“/”</p>\n<blockquote>\n<p>/pattern :pattern为需要查找的字符串，可以是正则表达式。  </p>\n</blockquote>\n<p>在正向查找状态下</p>\n<blockquote>\n<p>n :跳转到下一条匹配的内容。<br>N :跳转到上一条匹配的内容。</p>\n</blockquote>\n<p>反向查找的命令为“?”  </p>\n<blockquote>\n<p>?pattern  </p>\n</blockquote>\n<p>在反向查找状态下</p>\n<blockquote>\n<p>n :跳转到上一条匹配的内容。<br>N :跳转到下一条匹配的内容。</p>\n</blockquote>\n<p>0x9 替换功能<br>替换使用的命令是s，基本格式如下：  </p>\n<blockquote>\n<p>: s/pattern1/pattern2/  </p>\n</blockquote>\n<p>pattern1表示要查找的文本，pattern2为替换后的文本，“/”为分隔符，分隔符也可以是“：”。</p>\n<p>谨慎的查找替换  </p>\n<blockquote>\n<p>:%s/pattern1/pattern2/gc  </p>\n</blockquote>\n<p>执行这条命令之后，VIM会查找到所有匹配pattern1的字符串，并提示用户是否需要进行替换。</p>\n<p>以上是VIM编辑器的一些基础的使用方法，其功能还很强大，待之后用到了再补充吧。</p>\n<p>参考书：《Linux 命令、编辑器与SHELL编程》 王刚等著</p>\n","site":{"data":{}},"excerpt":"<h3 id=\"动手学VIM编辑器\"><a href=\"#动手学VIM编辑器\" class=\"headerlink\" title=\"动手学VIM编辑器\"></a>动手学VIM编辑器</h3><p>0x1:What is VIM editor?</p>\n<blockquote>\n<p>vi编辑器通常被简称为vi，而vi又是visual editor的简称  。它在Linux上的地位就像Edit程序在DOS上一样。它可以执行输出、删除、查找、替换、块操作等众多文本操作，而且用户可以根据自己的需要对其进行定制，这是其他编辑程序所没有的。<br>vi 编辑器并不是一个排版程序，它不像Word或WPS那样可以对字体、格式、段落等其他属性进行编排，它只是一个文本编辑程序。没有菜单，只有命令，且命令繁多。vi有3种基本工作模式：命令行模式、文本输入模式和末行模式。<br>Vim是vi的加强版，比vi更容易使用。vi的命令几乎全部都可以在vim上使用。</p>\n</blockquote>\n<p>—摘自百度百科<br>","more":"<br>0x2:命令模式情形下的一些命令<br>进入命令模式的方法：ESC</p>\n<p>#查看VIM编辑器的帮助信息。</p>\n<blockquote>\n<p>:help</p>\n</blockquote>\n<p><img src=\"/blogimg/vim-help.png\" alt=\"image\"></p>\n<p>#正常退出退出编辑器</p>\n<blockquote>\n<p>:q  </p>\n</blockquote>\n<p>#保存并退出编辑器</p>\n<blockquote>\n<p>:wq</p>\n</blockquote>\n<p>#保存退出编辑器，并将文件存储为filename</p>\n<blockquote>\n<p>:wq filename</p>\n</blockquote>\n<p>#强制退出，不保存</p>\n<blockquote>\n<p>:q!</p>\n</blockquote>\n<p>#打开某文件(需保存当前文件，否则会报错)</p>\n<blockquote>\n<p>:e /root/file</p>\n</blockquote>\n<p>#强制打开某文件</p>\n<blockquote>\n<p>:e! /root/file</p>\n</blockquote>\n<p>#读取某文件，追加到当前文件末尾</p>\n<blockquote>\n<p>:r /root/file</p>\n</blockquote>\n<p>#保存文件</p>\n<blockquote>\n<p>:w (文件路径)</p>\n</blockquote>\n<p>0x3:插入模式的一些快捷按键操作</p>\n<p>#进入插入模式，将光标放在当前光标之后</p>\n<blockquote>\n<p>a</p>\n</blockquote>\n<p>#进入插入模式，将光标放在当前光标所在的行尾</p>\n<blockquote>\n<p>A</p>\n</blockquote>\n<p>#在当前光标的下一行插入新行，并将光标放在新行的行首</p>\n<blockquote>\n<p>o</p>\n</blockquote>\n<p>#在光标的前一行插入一行，并将光标放在行首</p>\n<blockquote>\n<p>O</p>\n</blockquote>\n<p>#在光标所在位置进入插入模式,貌似这个用得最多了</p>\n<blockquote>\n<p>i</p>\n</blockquote>\n<p>0x4 移动光标<br>在进行编辑的时候，可能需要移动光标位置，进行修改或者输入新的内容，除了使用方向键之外，在命令模式下，使用hmjkl也能够快速的移动光标。</p>\n<blockquote>\n<p>k:向上移动光标  </p>\n<p>j:向下移动光标  </p>\n<p>h:向前移动光标  </p>\n<p>l:向右移动光标  </p>\n</blockquote>\n<p>这种感觉有点像玩FPS游戏的wasd方式，不过是把操作放在了右手上而已。用起来感觉还蛮不错的。</p>\n<p>0x5 删除文本<br>使用退格键或者delete键可以删除当前光标前或所在处的字符，然而在VIM中还可以使用命令来删除我们想删除的内容哦。  </p>\n<blockquote>\n<p>x :删除当前光标所在处的字符，如果想删除多个字符，连续着按。 </p>\n<p>dd  :删除当前光标所在行，如果想删除多行，可以用ndd的方式，n为你想删除的行数。  </p>\n<p>dw :删除光标处的单词，包括词尾的空格。  </p>\n<p>de :删除当前光标所在处的单词，和dw的区别在于保留了单词词尾的空格。  </p>\n<p>d^ :删除当前光标所在位置到行首的所有字符。  </p>\n<p>d$ :删除当前光标到行尾的所有字符。  </p>\n<p>J :将当前光标所在行和下一行合并（删除行尾的换行符）</p>\n</blockquote>\n<p>0x6 撤销和恢复  </p>\n<blockquote>\n<p>u :撤销上一步操作，可多次使用。  </p>\n<p>Ctrl+r :放弃上一次撤销操作，可使用多次。</p>\n</blockquote>\n<p>0x7 快速移动光标  </p>\n<blockquote>\n<p>b :将光标移动到当前光标所在单词的前一个单词的首字母，可以使nb，即移动n个单词的位置。  </p>\n<p>w :将光标移动到当前光标的后一个单词的首字母，可以使nw，即移动到n个单词后的首字母。  </p>\n<p>e :移动到后一个单词的尾字母，可以使ne，效果与之前的效果类似。  </p>\n<p>ge :与e的作用相反，移动光标至前一个单词的尾字母，也可是是nge，n表示需要跨过的单词数目。  </p>\n<p>^ :快速移动光标到行首，Home键，0键也可以移动光标的行首。  </p>\n<p>$ :快速移动光标到行尾，End键也可以移动光标到行尾。n$,可以将光标移动到当前行之后n-1行的末尾。  </p>\n<p>g :跳到当前文本的第一行，也可以使用1G。  </p>\n<p>G :跳到当前文本的最后一行。  </p>\n<p>nG :跳转到第n行，其中n为一个正整数。</p>\n</blockquote>\n<p>当然，咱们的鼠标也是可以定位光标的，哪里需要点哪里！</p>\n<p>0x8 查找功能<br>在命令模式下，正向查找的命令为“/”</p>\n<blockquote>\n<p>/pattern :pattern为需要查找的字符串，可以是正则表达式。  </p>\n</blockquote>\n<p>在正向查找状态下</p>\n<blockquote>\n<p>n :跳转到下一条匹配的内容。<br>N :跳转到上一条匹配的内容。</p>\n</blockquote>\n<p>反向查找的命令为“?”  </p>\n<blockquote>\n<p>?pattern  </p>\n</blockquote>\n<p>在反向查找状态下</p>\n<blockquote>\n<p>n :跳转到上一条匹配的内容。<br>N :跳转到下一条匹配的内容。</p>\n</blockquote>\n<p>0x9 替换功能<br>替换使用的命令是s，基本格式如下：  </p>\n<blockquote>\n<p>: s/pattern1/pattern2/  </p>\n</blockquote>\n<p>pattern1表示要查找的文本，pattern2为替换后的文本，“/”为分隔符，分隔符也可以是“：”。</p>\n<p>谨慎的查找替换  </p>\n<blockquote>\n<p>:%s/pattern1/pattern2/gc  </p>\n</blockquote>\n<p>执行这条命令之后，VIM会查找到所有匹配pattern1的字符串，并提示用户是否需要进行替换。</p>\n<p>以上是VIM编辑器的一些基础的使用方法，其功能还很强大，待之后用到了再补充吧。</p>\n<p>参考书：《Linux 命令、编辑器与SHELL编程》 王刚等著</p>"},{"title":"Learn Markdown","date":"2016-07-22T14:29:18.000Z","_content":"# 一级标题哦\n`# 一级标题哦`\n<!-- more -->\n# 列表哦\n- 无序列表1\n- 无序列表2\n\n`- 列表`\n  1. 有序列表1\n  2. 有序列表2\n`1.空格 列表名称`\n***\n# 引用\n引用操作即在引用内容之前加`>`即可\n例如：\n> 这是引用内容哦，亲\n\n# 图片与链接\n链接用`[]()`表示，例如：`[Google](https://www.google.com)`\n[百度](https://www.baidu.com)\n\n# kkk\n``` java\npublic class animal{\n\n  private void(){\n\n      System.out.println(\"Hello World\");\n\n  }\n}\n\n  ```\n# hello python\n\n``` python\n#-*coding=utf-8-*\nimport urllib2\nimport base64\nimport pwn\ndef welcome():\n  print \"Hello python\"\n\n```\n# hello cpp\n``` cpp\n\n#include <stdio.h>\nint mian(){\n\n  cout<<\"hello world!\";\n\n  return 0;\n}  \n ```\n","source":"_posts/Learn-Markdown.md","raw":"---\ntitle: Learn Markdown\ndate: 2016-07-22 22:29:18\ntags:\n- markdown\n- 入坑\n---\n# 一级标题哦\n`# 一级标题哦`\n<!-- more -->\n# 列表哦\n- 无序列表1\n- 无序列表2\n\n`- 列表`\n  1. 有序列表1\n  2. 有序列表2\n`1.空格 列表名称`\n***\n# 引用\n引用操作即在引用内容之前加`>`即可\n例如：\n> 这是引用内容哦，亲\n\n# 图片与链接\n链接用`[]()`表示，例如：`[Google](https://www.google.com)`\n[百度](https://www.baidu.com)\n\n# kkk\n``` java\npublic class animal{\n\n  private void(){\n\n      System.out.println(\"Hello World\");\n\n  }\n}\n\n  ```\n# hello python\n\n``` python\n#-*coding=utf-8-*\nimport urllib2\nimport base64\nimport pwn\ndef welcome():\n  print \"Hello python\"\n\n```\n# hello cpp\n``` cpp\n\n#include <stdio.h>\nint mian(){\n\n  cout<<\"hello world!\";\n\n  return 0;\n}  \n ```\n","slug":"Learn-Markdown","published":1,"updated":"2017-12-04T07:27:28.757Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjeqig1mf0027lgqaokxr5edw","content":"<h1 id=\"一级标题哦\"><a href=\"#一级标题哦\" class=\"headerlink\" title=\"一级标题哦\"></a>一级标题哦</h1><p><code># 一级标题哦</code><br><a id=\"more\"></a></p>\n<h1 id=\"列表哦\"><a href=\"#列表哦\" class=\"headerlink\" title=\"列表哦\"></a>列表哦</h1><ul>\n<li>无序列表1</li>\n<li>无序列表2</li>\n</ul>\n<p><code>- 列表</code></p>\n<ol>\n<li>有序列表1</li>\n<li>有序列表2<br><code>1.空格 列表名称</code></li>\n</ol>\n<hr>\n<h1 id=\"引用\"><a href=\"#引用\" class=\"headerlink\" title=\"引用\"></a>引用</h1><p>引用操作即在引用内容之前加<code>&gt;</code>即可<br>例如：</p>\n<blockquote>\n<p>这是引用内容哦，亲</p>\n</blockquote>\n<h1 id=\"图片与链接\"><a href=\"#图片与链接\" class=\"headerlink\" title=\"图片与链接\"></a>图片与链接</h1><p>链接用<code>[]()</code>表示，例如：<code>[Google](https://www.google.com)</code><br><a href=\"https://www.baidu.com\" target=\"_blank\" rel=\"noopener\">百度</a></p>\n<h1 id=\"kkk\"><a href=\"#kkk\" class=\"headerlink\" title=\"kkk\"></a>kkk</h1><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">animal</span></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"title\">void</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">      System.out.println(<span class=\"string\">\"Hello World\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h1 id=\"hello-python\"><a href=\"#hello-python\" class=\"headerlink\" title=\"hello python\"></a>hello python</h1><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#-*coding=utf-8-*</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> urllib2</span><br><span class=\"line\"><span class=\"keyword\">import</span> base64</span><br><span class=\"line\"><span class=\"keyword\">import</span> pwn</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">welcome</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">  <span class=\"keyword\">print</span> <span class=\"string\">\"Hello python\"</span></span><br></pre></td></tr></table></figure>\n<h1 id=\"hello-cpp\"><a href=\"#hello-cpp\" class=\"headerlink\" title=\"hello cpp\"></a>hello cpp</h1><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;stdio.h&gt;</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">mian</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"built_in\">cout</span>&lt;&lt;<span class=\"string\">\"hello world!\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"<h1 id=\"一级标题哦\"><a href=\"#一级标题哦\" class=\"headerlink\" title=\"一级标题哦\"></a>一级标题哦</h1><p><code># 一级标题哦</code><br>","more":"</p>\n<h1 id=\"列表哦\"><a href=\"#列表哦\" class=\"headerlink\" title=\"列表哦\"></a>列表哦</h1><ul>\n<li>无序列表1</li>\n<li>无序列表2</li>\n</ul>\n<p><code>- 列表</code></p>\n<ol>\n<li>有序列表1</li>\n<li>有序列表2<br><code>1.空格 列表名称</code></li>\n</ol>\n<hr>\n<h1 id=\"引用\"><a href=\"#引用\" class=\"headerlink\" title=\"引用\"></a>引用</h1><p>引用操作即在引用内容之前加<code>&gt;</code>即可<br>例如：</p>\n<blockquote>\n<p>这是引用内容哦，亲</p>\n</blockquote>\n<h1 id=\"图片与链接\"><a href=\"#图片与链接\" class=\"headerlink\" title=\"图片与链接\"></a>图片与链接</h1><p>链接用<code>[]()</code>表示，例如：<code>[Google](https://www.google.com)</code><br><a href=\"https://www.baidu.com\" target=\"_blank\" rel=\"noopener\">百度</a></p>\n<h1 id=\"kkk\"><a href=\"#kkk\" class=\"headerlink\" title=\"kkk\"></a>kkk</h1><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">animal</span></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"title\">void</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">      System.out.println(<span class=\"string\">\"Hello World\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h1 id=\"hello-python\"><a href=\"#hello-python\" class=\"headerlink\" title=\"hello python\"></a>hello python</h1><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#-*coding=utf-8-*</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> urllib2</span><br><span class=\"line\"><span class=\"keyword\">import</span> base64</span><br><span class=\"line\"><span class=\"keyword\">import</span> pwn</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">welcome</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">  <span class=\"keyword\">print</span> <span class=\"string\">\"Hello python\"</span></span><br></pre></td></tr></table></figure>\n<h1 id=\"hello-cpp\"><a href=\"#hello-cpp\" class=\"headerlink\" title=\"hello cpp\"></a>hello cpp</h1><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;stdio.h&gt;</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">mian</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"built_in\">cout</span>&lt;&lt;<span class=\"string\">\"hello world!\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>"},{"title":"常见排序算法之插入排序","date":"2017-05-17T15:41:35.000Z","_content":"\n由这篇博文开始，来回顾一下常见的排序算法。算法实现主要以Python语言为主。\n\n插入排序，对于少量的元素排序，它是一个有效的算法。插入排序的方式有点类似于打扑克牌的时候抓牌后，然后根据牌的大小插入到合适的位置。\n\n<!-- more -->\n\n### 插入排序的基本思想:\n\n每步将一个待排序的对象,按其排序码大小,插入到前面已经排好序的一组对象的适当位置上,直到对象全部插入为止。\n\n### 插入排序的工作过程的伪代码表示\n\n```python\nINSERTION-SORT(A)\n\tfor j = 2 to A.length\n\t\t#取当前位置元素作为待比较元素\n\t \tkey = A[j]\n\t\t#获取到需要比较的元素的下标\n\t\ti = j -1\n\t\t#进行比较，如果待比较元素比当前元素大，则将待比较元素和当前元素进行交换（从当前元素开始，逐个向后移动一个位置，为待比较元素腾出个位置来）\n\t\twhile i > 0 and A[i] > key\n\t\t\tA[i+1] = A[i]\n\t\t\ti = i -1\n\t\t\t#腾位置结束\n\t\t#将待比较的元素赋值给腾出来的位置，然后继续下一次循环，直到排序完成\n\t\tA[i+1] = key\n```\n\n### 插入排序的Python代码实现\n\n```python\n# -*- coding:utf-8 -*-\n\nA = [5,2,4,6,1,3]\n\ndef insert_sort(Array_A):\n    for j in range(1,len(Array_A)):\n        key = Array_A[j]\n        i = j - 1\n        while i >= 0 and Array_A[i] > key:\n            Array_A[i+1] = Array_A[i]\n            i = i -1\n        Array_A[i+1] = key\n        print '第%s次插入：' % (j),Array_A\n        \ninsert_sort(A)\nprint '插入排序结果：',A\n```\n\n运行结果：\n\n```python\n第1次插入： [2, 5, 4, 6, 1, 3]\n第2次插入： [2, 4, 5, 6, 1, 3]\n第3次插入： [2, 4, 5, 6, 1, 3]\n第4次插入： [1, 2, 4, 5, 6, 3]\n第5次插入： [1, 2, 3, 4, 5, 6]\n插入排序结果： [1, 2, 3, 4, 5, 6]\n```\n\n通过结果可以很清楚的看到每次排序过程。\n\n### 插入排序算法的分析\n\n1. 最好的情况下，排序前对象已经按照要求有序。比较次数：n-1;移动次数:0。对应的时间复杂度为O(n)\n2. 最坏的情况下，排序前对象为要求的顺序的反序。第i趟时第i各对象必须与前面i个对象都做排序码比较，并且每做一侧比较就要做一次数据移动。时间复杂度为O(n2)\n3. 如果记录是随机的，时间复杂度为O(n2)\n\n### 插入排序算法的特点\n\n1. 它是稳定排序，不改变相同元素原来的顺序\n2. 它是in-place排序，只需要O(1)的额外内存空间\n3. 它是在线排序，可以边接收数据边排序\n4. 它跟我们排扑克牌的方式相似\n5. 对小数据集是有效的","source":"_posts/InsertSort.md","raw":"---\ntitle: 常见排序算法之插入排序\ndate: 2017-05-17 23:41:35\ncategories:\n- Program\ntags:\n- 算法\n- 排序\n- 插入排序\n---\n\n由这篇博文开始，来回顾一下常见的排序算法。算法实现主要以Python语言为主。\n\n插入排序，对于少量的元素排序，它是一个有效的算法。插入排序的方式有点类似于打扑克牌的时候抓牌后，然后根据牌的大小插入到合适的位置。\n\n<!-- more -->\n\n### 插入排序的基本思想:\n\n每步将一个待排序的对象,按其排序码大小,插入到前面已经排好序的一组对象的适当位置上,直到对象全部插入为止。\n\n### 插入排序的工作过程的伪代码表示\n\n```python\nINSERTION-SORT(A)\n\tfor j = 2 to A.length\n\t\t#取当前位置元素作为待比较元素\n\t \tkey = A[j]\n\t\t#获取到需要比较的元素的下标\n\t\ti = j -1\n\t\t#进行比较，如果待比较元素比当前元素大，则将待比较元素和当前元素进行交换（从当前元素开始，逐个向后移动一个位置，为待比较元素腾出个位置来）\n\t\twhile i > 0 and A[i] > key\n\t\t\tA[i+1] = A[i]\n\t\t\ti = i -1\n\t\t\t#腾位置结束\n\t\t#将待比较的元素赋值给腾出来的位置，然后继续下一次循环，直到排序完成\n\t\tA[i+1] = key\n```\n\n### 插入排序的Python代码实现\n\n```python\n# -*- coding:utf-8 -*-\n\nA = [5,2,4,6,1,3]\n\ndef insert_sort(Array_A):\n    for j in range(1,len(Array_A)):\n        key = Array_A[j]\n        i = j - 1\n        while i >= 0 and Array_A[i] > key:\n            Array_A[i+1] = Array_A[i]\n            i = i -1\n        Array_A[i+1] = key\n        print '第%s次插入：' % (j),Array_A\n        \ninsert_sort(A)\nprint '插入排序结果：',A\n```\n\n运行结果：\n\n```python\n第1次插入： [2, 5, 4, 6, 1, 3]\n第2次插入： [2, 4, 5, 6, 1, 3]\n第3次插入： [2, 4, 5, 6, 1, 3]\n第4次插入： [1, 2, 4, 5, 6, 3]\n第5次插入： [1, 2, 3, 4, 5, 6]\n插入排序结果： [1, 2, 3, 4, 5, 6]\n```\n\n通过结果可以很清楚的看到每次排序过程。\n\n### 插入排序算法的分析\n\n1. 最好的情况下，排序前对象已经按照要求有序。比较次数：n-1;移动次数:0。对应的时间复杂度为O(n)\n2. 最坏的情况下，排序前对象为要求的顺序的反序。第i趟时第i各对象必须与前面i个对象都做排序码比较，并且每做一侧比较就要做一次数据移动。时间复杂度为O(n2)\n3. 如果记录是随机的，时间复杂度为O(n2)\n\n### 插入排序算法的特点\n\n1. 它是稳定排序，不改变相同元素原来的顺序\n2. 它是in-place排序，只需要O(1)的额外内存空间\n3. 它是在线排序，可以边接收数据边排序\n4. 它跟我们排扑克牌的方式相似\n5. 对小数据集是有效的","slug":"InsertSort","published":1,"updated":"2017-12-04T07:27:28.757Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjeqig1mj0029lgqa8gap6wv3","content":"<p>由这篇博文开始，来回顾一下常见的排序算法。算法实现主要以Python语言为主。</p>\n<p>插入排序，对于少量的元素排序，它是一个有效的算法。插入排序的方式有点类似于打扑克牌的时候抓牌后，然后根据牌的大小插入到合适的位置。</p>\n<a id=\"more\"></a>\n<h3 id=\"插入排序的基本思想\"><a href=\"#插入排序的基本思想\" class=\"headerlink\" title=\"插入排序的基本思想:\"></a>插入排序的基本思想:</h3><p>每步将一个待排序的对象,按其排序码大小,插入到前面已经排好序的一组对象的适当位置上,直到对象全部插入为止。</p>\n<h3 id=\"插入排序的工作过程的伪代码表示\"><a href=\"#插入排序的工作过程的伪代码表示\" class=\"headerlink\" title=\"插入排序的工作过程的伪代码表示\"></a>插入排序的工作过程的伪代码表示</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">INSERTION-SORT(A)</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> j = <span class=\"number\">2</span> to A.length</span><br><span class=\"line\">\t\t<span class=\"comment\">#取当前位置元素作为待比较元素</span></span><br><span class=\"line\">\t \tkey = A[j]</span><br><span class=\"line\">\t\t<span class=\"comment\">#获取到需要比较的元素的下标</span></span><br><span class=\"line\">\t\ti = j <span class=\"number\">-1</span></span><br><span class=\"line\">\t\t<span class=\"comment\">#进行比较，如果待比较元素比当前元素大，则将待比较元素和当前元素进行交换（从当前元素开始，逐个向后移动一个位置，为待比较元素腾出个位置来）</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">while</span> i &gt; <span class=\"number\">0</span> <span class=\"keyword\">and</span> A[i] &gt; key</span><br><span class=\"line\">\t\t\tA[i+<span class=\"number\">1</span>] = A[i]</span><br><span class=\"line\">\t\t\ti = i <span class=\"number\">-1</span></span><br><span class=\"line\">\t\t\t<span class=\"comment\">#腾位置结束</span></span><br><span class=\"line\">\t\t<span class=\"comment\">#将待比较的元素赋值给腾出来的位置，然后继续下一次循环，直到排序完成</span></span><br><span class=\"line\">\t\tA[i+<span class=\"number\">1</span>] = key</span><br></pre></td></tr></table></figure>\n<h3 id=\"插入排序的Python代码实现\"><a href=\"#插入排序的Python代码实现\" class=\"headerlink\" title=\"插入排序的Python代码实现\"></a>插入排序的Python代码实现</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># -*- coding:utf-8 -*-</span></span><br><span class=\"line\"></span><br><span class=\"line\">A = [<span class=\"number\">5</span>,<span class=\"number\">2</span>,<span class=\"number\">4</span>,<span class=\"number\">6</span>,<span class=\"number\">1</span>,<span class=\"number\">3</span>]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">insert_sort</span><span class=\"params\">(Array_A)</span>:</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> j <span class=\"keyword\">in</span> range(<span class=\"number\">1</span>,len(Array_A)):</span><br><span class=\"line\">        key = Array_A[j]</span><br><span class=\"line\">        i = j - <span class=\"number\">1</span></span><br><span class=\"line\">        <span class=\"keyword\">while</span> i &gt;= <span class=\"number\">0</span> <span class=\"keyword\">and</span> Array_A[i] &gt; key:</span><br><span class=\"line\">            Array_A[i+<span class=\"number\">1</span>] = Array_A[i]</span><br><span class=\"line\">            i = i <span class=\"number\">-1</span></span><br><span class=\"line\">        Array_A[i+<span class=\"number\">1</span>] = key</span><br><span class=\"line\">        <span class=\"keyword\">print</span> <span class=\"string\">'第%s次插入：'</span> % (j),Array_A</span><br><span class=\"line\">        </span><br><span class=\"line\">insert_sort(A)</span><br><span class=\"line\"><span class=\"keyword\">print</span> <span class=\"string\">'插入排序结果：'</span>,A</span><br></pre></td></tr></table></figure>\n<p>运行结果：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">第<span class=\"number\">1</span>次插入： [<span class=\"number\">2</span>, <span class=\"number\">5</span>, <span class=\"number\">4</span>, <span class=\"number\">6</span>, <span class=\"number\">1</span>, <span class=\"number\">3</span>]</span><br><span class=\"line\">第<span class=\"number\">2</span>次插入： [<span class=\"number\">2</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>, <span class=\"number\">6</span>, <span class=\"number\">1</span>, <span class=\"number\">3</span>]</span><br><span class=\"line\">第<span class=\"number\">3</span>次插入： [<span class=\"number\">2</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>, <span class=\"number\">6</span>, <span class=\"number\">1</span>, <span class=\"number\">3</span>]</span><br><span class=\"line\">第<span class=\"number\">4</span>次插入： [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>, <span class=\"number\">6</span>, <span class=\"number\">3</span>]</span><br><span class=\"line\">第<span class=\"number\">5</span>次插入： [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>, <span class=\"number\">6</span>]</span><br><span class=\"line\">插入排序结果： [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>, <span class=\"number\">6</span>]</span><br></pre></td></tr></table></figure>\n<p>通过结果可以很清楚的看到每次排序过程。</p>\n<h3 id=\"插入排序算法的分析\"><a href=\"#插入排序算法的分析\" class=\"headerlink\" title=\"插入排序算法的分析\"></a>插入排序算法的分析</h3><ol>\n<li>最好的情况下，排序前对象已经按照要求有序。比较次数：n-1;移动次数:0。对应的时间复杂度为O(n)</li>\n<li>最坏的情况下，排序前对象为要求的顺序的反序。第i趟时第i各对象必须与前面i个对象都做排序码比较，并且每做一侧比较就要做一次数据移动。时间复杂度为O(n2)</li>\n<li>如果记录是随机的，时间复杂度为O(n2)</li>\n</ol>\n<h3 id=\"插入排序算法的特点\"><a href=\"#插入排序算法的特点\" class=\"headerlink\" title=\"插入排序算法的特点\"></a>插入排序算法的特点</h3><ol>\n<li>它是稳定排序，不改变相同元素原来的顺序</li>\n<li>它是in-place排序，只需要O(1)的额外内存空间</li>\n<li>它是在线排序，可以边接收数据边排序</li>\n<li>它跟我们排扑克牌的方式相似</li>\n<li>对小数据集是有效的</li>\n</ol>\n","site":{"data":{}},"excerpt":"<p>由这篇博文开始，来回顾一下常见的排序算法。算法实现主要以Python语言为主。</p>\n<p>插入排序，对于少量的元素排序，它是一个有效的算法。插入排序的方式有点类似于打扑克牌的时候抓牌后，然后根据牌的大小插入到合适的位置。</p>","more":"<h3 id=\"插入排序的基本思想\"><a href=\"#插入排序的基本思想\" class=\"headerlink\" title=\"插入排序的基本思想:\"></a>插入排序的基本思想:</h3><p>每步将一个待排序的对象,按其排序码大小,插入到前面已经排好序的一组对象的适当位置上,直到对象全部插入为止。</p>\n<h3 id=\"插入排序的工作过程的伪代码表示\"><a href=\"#插入排序的工作过程的伪代码表示\" class=\"headerlink\" title=\"插入排序的工作过程的伪代码表示\"></a>插入排序的工作过程的伪代码表示</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">INSERTION-SORT(A)</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> j = <span class=\"number\">2</span> to A.length</span><br><span class=\"line\">\t\t<span class=\"comment\">#取当前位置元素作为待比较元素</span></span><br><span class=\"line\">\t \tkey = A[j]</span><br><span class=\"line\">\t\t<span class=\"comment\">#获取到需要比较的元素的下标</span></span><br><span class=\"line\">\t\ti = j <span class=\"number\">-1</span></span><br><span class=\"line\">\t\t<span class=\"comment\">#进行比较，如果待比较元素比当前元素大，则将待比较元素和当前元素进行交换（从当前元素开始，逐个向后移动一个位置，为待比较元素腾出个位置来）</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">while</span> i &gt; <span class=\"number\">0</span> <span class=\"keyword\">and</span> A[i] &gt; key</span><br><span class=\"line\">\t\t\tA[i+<span class=\"number\">1</span>] = A[i]</span><br><span class=\"line\">\t\t\ti = i <span class=\"number\">-1</span></span><br><span class=\"line\">\t\t\t<span class=\"comment\">#腾位置结束</span></span><br><span class=\"line\">\t\t<span class=\"comment\">#将待比较的元素赋值给腾出来的位置，然后继续下一次循环，直到排序完成</span></span><br><span class=\"line\">\t\tA[i+<span class=\"number\">1</span>] = key</span><br></pre></td></tr></table></figure>\n<h3 id=\"插入排序的Python代码实现\"><a href=\"#插入排序的Python代码实现\" class=\"headerlink\" title=\"插入排序的Python代码实现\"></a>插入排序的Python代码实现</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># -*- coding:utf-8 -*-</span></span><br><span class=\"line\"></span><br><span class=\"line\">A = [<span class=\"number\">5</span>,<span class=\"number\">2</span>,<span class=\"number\">4</span>,<span class=\"number\">6</span>,<span class=\"number\">1</span>,<span class=\"number\">3</span>]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">insert_sort</span><span class=\"params\">(Array_A)</span>:</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> j <span class=\"keyword\">in</span> range(<span class=\"number\">1</span>,len(Array_A)):</span><br><span class=\"line\">        key = Array_A[j]</span><br><span class=\"line\">        i = j - <span class=\"number\">1</span></span><br><span class=\"line\">        <span class=\"keyword\">while</span> i &gt;= <span class=\"number\">0</span> <span class=\"keyword\">and</span> Array_A[i] &gt; key:</span><br><span class=\"line\">            Array_A[i+<span class=\"number\">1</span>] = Array_A[i]</span><br><span class=\"line\">            i = i <span class=\"number\">-1</span></span><br><span class=\"line\">        Array_A[i+<span class=\"number\">1</span>] = key</span><br><span class=\"line\">        <span class=\"keyword\">print</span> <span class=\"string\">'第%s次插入：'</span> % (j),Array_A</span><br><span class=\"line\">        </span><br><span class=\"line\">insert_sort(A)</span><br><span class=\"line\"><span class=\"keyword\">print</span> <span class=\"string\">'插入排序结果：'</span>,A</span><br></pre></td></tr></table></figure>\n<p>运行结果：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">第<span class=\"number\">1</span>次插入： [<span class=\"number\">2</span>, <span class=\"number\">5</span>, <span class=\"number\">4</span>, <span class=\"number\">6</span>, <span class=\"number\">1</span>, <span class=\"number\">3</span>]</span><br><span class=\"line\">第<span class=\"number\">2</span>次插入： [<span class=\"number\">2</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>, <span class=\"number\">6</span>, <span class=\"number\">1</span>, <span class=\"number\">3</span>]</span><br><span class=\"line\">第<span class=\"number\">3</span>次插入： [<span class=\"number\">2</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>, <span class=\"number\">6</span>, <span class=\"number\">1</span>, <span class=\"number\">3</span>]</span><br><span class=\"line\">第<span class=\"number\">4</span>次插入： [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>, <span class=\"number\">6</span>, <span class=\"number\">3</span>]</span><br><span class=\"line\">第<span class=\"number\">5</span>次插入： [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>, <span class=\"number\">6</span>]</span><br><span class=\"line\">插入排序结果： [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>, <span class=\"number\">6</span>]</span><br></pre></td></tr></table></figure>\n<p>通过结果可以很清楚的看到每次排序过程。</p>\n<h3 id=\"插入排序算法的分析\"><a href=\"#插入排序算法的分析\" class=\"headerlink\" title=\"插入排序算法的分析\"></a>插入排序算法的分析</h3><ol>\n<li>最好的情况下，排序前对象已经按照要求有序。比较次数：n-1;移动次数:0。对应的时间复杂度为O(n)</li>\n<li>最坏的情况下，排序前对象为要求的顺序的反序。第i趟时第i各对象必须与前面i个对象都做排序码比较，并且每做一侧比较就要做一次数据移动。时间复杂度为O(n2)</li>\n<li>如果记录是随机的，时间复杂度为O(n2)</li>\n</ol>\n<h3 id=\"插入排序算法的特点\"><a href=\"#插入排序算法的特点\" class=\"headerlink\" title=\"插入排序算法的特点\"></a>插入排序算法的特点</h3><ol>\n<li>它是稳定排序，不改变相同元素原来的顺序</li>\n<li>它是in-place排序，只需要O(1)的额外内存空间</li>\n<li>它是在线排序，可以边接收数据边排序</li>\n<li>它跟我们排扑克牌的方式相似</li>\n<li>对小数据集是有效的</li>\n</ol>"},{"title":"Let's Encrypt && Nginx配置证书，实现https访问","date":"2016-12-15T07:01:36.000Z","_content":"\n### 0x1:Why?\n\n在聊HTTPS之前，先来了解一下被广泛使用的HTTP协议\n\n> HTTP函数作为请求-响应于协议的客户端-服务器计算模型。一个网络浏览器，例如，可以是*客户机*和一个计算机上运行的应用托管一个网站可以是*服务器*。该客户机提交一个HTTP *请求*消息发送到服务器。服务器，它提供*的资源*如HTML文件和其他内容，或代表客户机的执行其它功能，返回一个*响应*消息给客户端。响应包含关于请求完成状态信息，并且还可以含有在其消息主体请求的内容。\n>\n> 网络浏览器是一个的例子*的用户代理*（UA）。其他类型的用户代理包括由搜索服务提供商（使用的索引软件网络爬虫，语音浏览器，移动应用程序和其他软件访问，消费，或显示网页内容。\n>\n> 的HTTP被设计成允许中间网络元件，以改善或允许客户端和服务器之间的通信。高流量的网站往往受益于Web缓存的代表提供的内容服务器上游服务器以提高响应时间。Web浏览器的缓存以前访问网络资源并尽可能减少网络流量重用他们。HTTP代理服务器的专用网络边界可以方便为客户的沟通没有一个全球可路由的地址，通过与外部服务器中继消息。\n>\n> HTTP是一个应用层协议的框架内，设计的因特网协议套件。它的定义假定底层和可靠的传输层的协议，和传输控制协议（TCP）是常用的。然而HTTP可以适于使用不可靠的协议，如用户数据报协议（UDP），例如在HTTPU和简单服务发现协议（SSDP）。\n>\n> HTTP资源得到确认和位于网络通[统一资源定位器（URL）的，使用统一资源标识符（URI的）计划，*HTTP*和*HTTPS*。URI和超链接的HTML文档形成相互关联的超文本文档。\n>\n> HTTP / 1.1是原来的HTTP（HTTP / 1.0）的修订。在HTTP / 1.0的单独连接到同一台服务器为每个资源的要求而作出。HTTP / 1.1可以重复使用的连接多次下载图像，脚本，样式表，*等等*页面已交付之后。因此，HTTP / 1.1的通信经验少的延迟为建立TCP连接的呈现相当大的开销。\n\n-------引自wikipedia [维基百科.HTTP词条]( https://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol)\n\n<!-- more -->\n\n但是HTTP协议本身不具备加密功能，所有的通讯数据都是在网络上裸奔。所以HTTP链接很容易被“中间人攻击“，HTTP链接网络环节中的中间人（浏览器、路由器、ISP.....）可以对数据进行嗅探，欺骗，劫持，阻挡等等。明文传输的用户数据还容易泄露。\n\n那什么又是HTTPS呢？  \n\n> HTTPS（全称：Hyper Text Transfer Protocol over Secure Socket Layer），是以安全为目标的[HTTP](http://baike.baidu.com/view/9472.htm)通道，简单讲是HTTP的安全版。即HTTP下加入SSL层，HTTPS的安全基础是SSL，因此加密的详细内容就需要SSL。 它是一个URI scheme（抽象标识符体系），句法类同http:体系。用于安全的HTTP数据传输。https:URL表明它使用了HTTP，但HTTPS存在不同于HTTP的默认端口及一个加密/身份验证层（在HTTP与TCP之间）。这个系统的最初研发由网景公司(Netscape)进行，并内置于其浏览器Netscape Navigator中，提供了身份验证与加密通讯方法。现在它被广泛用于万维网上安全敏感的通讯，例如交易支付方面。  \n\n------引自百度百科 [百度百科.HTTPS词条](http://baike.baidu.com/link?url=ZSi0Ny56ylfHKJ4PEny2ogN3HkMf8QClbf_TulpLkRcei0-Z2w4SnxLVBnJPX5qkHHZOgKgQl78yBX60xdorUa)\n\n相比较于HTTP协议，HTTPS在HTTP的基础上增加了SSL（安全套接字层）。SSL的引入为连接的建立和数据的传输都进行了加密，在密钥足够健壮的情形下，是比较安全的。相较于HTTP，HTTPS提供了以下三个强大的功能：\n\n1. 内容加密。浏览器到百度服务器的内容都是以加密形式传输，中间者无法直接查看原始内容。\n2. 身份认证。保证用户访问的是百度服务，即使被 DNS 劫持到了第三方站点，也会提醒用户没有访问百度服务，有可能被劫持\n3. 数据完整性。防止内容被第三方冒充或者篡改。\n\n###  0x2:How?\n\n要进行HTTPS加密，我们首先需要向证书颁发机构（CA）申请加密证书。免费的证书颁发机构有Startssl [Start ssl](https://www.startssl.com/)、Let's Encrypt [Let's Encrypt](https://letsencrypt.org/)等。我用的是Let's Encrypt颁发的证书，它操作起来比较简单。它的官方网站上有介绍具体的申请步骤。[申请Let's encrypt证书](https://letsencrypt.org/getting-started/) 下面是我参考网上一哥们一篇博文[Jerry Qu 申请Let's Encrypt](https://imququ.com/post/letsencrypt-certificate.html)实际申请证书的具体过程如下：\n\n1. 创建帐号\n\n创建一个目录，例如 *ssl*，用来存放各种临时文件和最红生成的证书文件。首先创建一个私钥文件\n\n```bash\n#openssl genrsa 4096 > account.key\n```\n\n2. 创建CSR文件\n\n生成CSR（Certificate Signing Request，证书签名请求）文件。需要准备一个域名私钥，这里我选择RSA私钥。\n\n```bash\n#openssl genrsa 4096 > domain.key\n#openssl req -new -sha256 -key domain.key -out domain.csr //手动生成csr文件，根据提示进行操作即可\n```\n\n3. 配置验证服务\n\nCA在颁发证书时，需要验证域名的所有权，证明你对该域名所在的服务器有操作的权限。Let's Encrypt采用的是服务器上生成一个随机验证文件，再访问CSR中填写的域名，如果访问成功，则证明你对该域名有所有权。为了偷懒，我就不像那位博主一样建立单独的目录了，而是直接在我的web根目录建立一个隐藏目录，用来存放之后生成的随机验证文件。\n\n```bash\n#mkdir -p /var/blog/.well-known/acme-challenge //建立验证文件存放目录\n```\n\n4. 获取HTTPS证书\n\n先下载一个acme-tiny的脚本，保存在*ssl*目录：\n\n```bash\n#wget https://raw.githubusercontent.com/diafygi/acme-tiny/master/acme_tiny.py\n```\n\n指定账户私钥、CSR、验证目录，然后执行脚本：\n\n```bash\npython acme_tiny.py --account-key ./account.key --csr ./domain.csr --acme-dir /var/blog/ > ./signed.crt\n\n```\n\n如果执行成功，在当前目录下会生成一个signed.crt文件，这就是申请号的证书文件。\n\n下载Let's Encrypt的中间证书，并和网站证书合并在一起:\n\n```bash\n#wget -O - https://letsencrypt.org/certs/lets-encrypt-x3-cross-signed.pem > intermediate.pem\n#cat signed.crt intermediate.pem > chained.pem\n```\n\n再把根证书和中间证书合并在一起：\n\n```bash\n#wget -O - https://letsencrypt.org/certs/isrgrootx1.pem > root.pem\n#cat intermediate.pem root.pem > full_chained.pem\n```\n\n5. 配置Nginx，开启https\n\n   ```bash\n   ssl_certificate     ~/ssl/chained.pem;\n   ssl_certificate_key ~/ssl/domain.key;\n   ```\n\n   ​\n\n   因为Let's Encrypt签发的证书的有效期只有90天，需要定时使用脚本进行更新。就是把上面的获取过程写进一个脚本，设置crontab，让其自动执行更新即可。我也不确定这台服务器我会续费到多久，暂时先用着吧。  \n\n   ----后续，续期证书的脚本\n\n   ```bash\n   #!/bin/bash\n   openssl genrsa 4096 > account.key\n   openssl genrsa 4096 > domain,key\n   openssl req -new -sha256 -key domain.key -out domain.csr\n   python acme_tiny.py --account-key ./account.key --csr ./domain.csr --acme-dir /var/www/blog/.well-known/acme-challenge/ > ./signed.crt\n   wget -O - https://letsencrypt.org/certs/lets-encrypt-x3-cross-signed.pem > intermediate.pem\n   cat signed.crt intermediate.pem > chained.pem\n   wget -O - https://letsencrypt.org/certs/isrgrootx1.pem > root.pem\n   cat intermediate.pem root.pem > full_chained.pem\n\n   ```\n\n   ​\n\n### 0x3 That's All\n\n经过一番折腾，在我的域名前，终于看到了浏览器地址栏我的域名前有了一把绿色的小锁，*It's Encrypt!*  \n\n最后还是感谢一下Jerry Qu撰写的博客文章， [Jerry Qu](https://imququ.com/)","source":"_posts/Let-s-Encrypt.md","raw":"---\ntitle: Let's Encrypt && Nginx配置证书，实现https访问\ndate: 2016-12-15 15:01:36\ncategories:\n- Linux\ntags:\n- https\n- nginx\n---\n\n### 0x1:Why?\n\n在聊HTTPS之前，先来了解一下被广泛使用的HTTP协议\n\n> HTTP函数作为请求-响应于协议的客户端-服务器计算模型。一个网络浏览器，例如，可以是*客户机*和一个计算机上运行的应用托管一个网站可以是*服务器*。该客户机提交一个HTTP *请求*消息发送到服务器。服务器，它提供*的资源*如HTML文件和其他内容，或代表客户机的执行其它功能，返回一个*响应*消息给客户端。响应包含关于请求完成状态信息，并且还可以含有在其消息主体请求的内容。\n>\n> 网络浏览器是一个的例子*的用户代理*（UA）。其他类型的用户代理包括由搜索服务提供商（使用的索引软件网络爬虫，语音浏览器，移动应用程序和其他软件访问，消费，或显示网页内容。\n>\n> 的HTTP被设计成允许中间网络元件，以改善或允许客户端和服务器之间的通信。高流量的网站往往受益于Web缓存的代表提供的内容服务器上游服务器以提高响应时间。Web浏览器的缓存以前访问网络资源并尽可能减少网络流量重用他们。HTTP代理服务器的专用网络边界可以方便为客户的沟通没有一个全球可路由的地址，通过与外部服务器中继消息。\n>\n> HTTP是一个应用层协议的框架内，设计的因特网协议套件。它的定义假定底层和可靠的传输层的协议，和传输控制协议（TCP）是常用的。然而HTTP可以适于使用不可靠的协议，如用户数据报协议（UDP），例如在HTTPU和简单服务发现协议（SSDP）。\n>\n> HTTP资源得到确认和位于网络通[统一资源定位器（URL）的，使用统一资源标识符（URI的）计划，*HTTP*和*HTTPS*。URI和超链接的HTML文档形成相互关联的超文本文档。\n>\n> HTTP / 1.1是原来的HTTP（HTTP / 1.0）的修订。在HTTP / 1.0的单独连接到同一台服务器为每个资源的要求而作出。HTTP / 1.1可以重复使用的连接多次下载图像，脚本，样式表，*等等*页面已交付之后。因此，HTTP / 1.1的通信经验少的延迟为建立TCP连接的呈现相当大的开销。\n\n-------引自wikipedia [维基百科.HTTP词条]( https://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol)\n\n<!-- more -->\n\n但是HTTP协议本身不具备加密功能，所有的通讯数据都是在网络上裸奔。所以HTTP链接很容易被“中间人攻击“，HTTP链接网络环节中的中间人（浏览器、路由器、ISP.....）可以对数据进行嗅探，欺骗，劫持，阻挡等等。明文传输的用户数据还容易泄露。\n\n那什么又是HTTPS呢？  \n\n> HTTPS（全称：Hyper Text Transfer Protocol over Secure Socket Layer），是以安全为目标的[HTTP](http://baike.baidu.com/view/9472.htm)通道，简单讲是HTTP的安全版。即HTTP下加入SSL层，HTTPS的安全基础是SSL，因此加密的详细内容就需要SSL。 它是一个URI scheme（抽象标识符体系），句法类同http:体系。用于安全的HTTP数据传输。https:URL表明它使用了HTTP，但HTTPS存在不同于HTTP的默认端口及一个加密/身份验证层（在HTTP与TCP之间）。这个系统的最初研发由网景公司(Netscape)进行，并内置于其浏览器Netscape Navigator中，提供了身份验证与加密通讯方法。现在它被广泛用于万维网上安全敏感的通讯，例如交易支付方面。  \n\n------引自百度百科 [百度百科.HTTPS词条](http://baike.baidu.com/link?url=ZSi0Ny56ylfHKJ4PEny2ogN3HkMf8QClbf_TulpLkRcei0-Z2w4SnxLVBnJPX5qkHHZOgKgQl78yBX60xdorUa)\n\n相比较于HTTP协议，HTTPS在HTTP的基础上增加了SSL（安全套接字层）。SSL的引入为连接的建立和数据的传输都进行了加密，在密钥足够健壮的情形下，是比较安全的。相较于HTTP，HTTPS提供了以下三个强大的功能：\n\n1. 内容加密。浏览器到百度服务器的内容都是以加密形式传输，中间者无法直接查看原始内容。\n2. 身份认证。保证用户访问的是百度服务，即使被 DNS 劫持到了第三方站点，也会提醒用户没有访问百度服务，有可能被劫持\n3. 数据完整性。防止内容被第三方冒充或者篡改。\n\n###  0x2:How?\n\n要进行HTTPS加密，我们首先需要向证书颁发机构（CA）申请加密证书。免费的证书颁发机构有Startssl [Start ssl](https://www.startssl.com/)、Let's Encrypt [Let's Encrypt](https://letsencrypt.org/)等。我用的是Let's Encrypt颁发的证书，它操作起来比较简单。它的官方网站上有介绍具体的申请步骤。[申请Let's encrypt证书](https://letsencrypt.org/getting-started/) 下面是我参考网上一哥们一篇博文[Jerry Qu 申请Let's Encrypt](https://imququ.com/post/letsencrypt-certificate.html)实际申请证书的具体过程如下：\n\n1. 创建帐号\n\n创建一个目录，例如 *ssl*，用来存放各种临时文件和最红生成的证书文件。首先创建一个私钥文件\n\n```bash\n#openssl genrsa 4096 > account.key\n```\n\n2. 创建CSR文件\n\n生成CSR（Certificate Signing Request，证书签名请求）文件。需要准备一个域名私钥，这里我选择RSA私钥。\n\n```bash\n#openssl genrsa 4096 > domain.key\n#openssl req -new -sha256 -key domain.key -out domain.csr //手动生成csr文件，根据提示进行操作即可\n```\n\n3. 配置验证服务\n\nCA在颁发证书时，需要验证域名的所有权，证明你对该域名所在的服务器有操作的权限。Let's Encrypt采用的是服务器上生成一个随机验证文件，再访问CSR中填写的域名，如果访问成功，则证明你对该域名有所有权。为了偷懒，我就不像那位博主一样建立单独的目录了，而是直接在我的web根目录建立一个隐藏目录，用来存放之后生成的随机验证文件。\n\n```bash\n#mkdir -p /var/blog/.well-known/acme-challenge //建立验证文件存放目录\n```\n\n4. 获取HTTPS证书\n\n先下载一个acme-tiny的脚本，保存在*ssl*目录：\n\n```bash\n#wget https://raw.githubusercontent.com/diafygi/acme-tiny/master/acme_tiny.py\n```\n\n指定账户私钥、CSR、验证目录，然后执行脚本：\n\n```bash\npython acme_tiny.py --account-key ./account.key --csr ./domain.csr --acme-dir /var/blog/ > ./signed.crt\n\n```\n\n如果执行成功，在当前目录下会生成一个signed.crt文件，这就是申请号的证书文件。\n\n下载Let's Encrypt的中间证书，并和网站证书合并在一起:\n\n```bash\n#wget -O - https://letsencrypt.org/certs/lets-encrypt-x3-cross-signed.pem > intermediate.pem\n#cat signed.crt intermediate.pem > chained.pem\n```\n\n再把根证书和中间证书合并在一起：\n\n```bash\n#wget -O - https://letsencrypt.org/certs/isrgrootx1.pem > root.pem\n#cat intermediate.pem root.pem > full_chained.pem\n```\n\n5. 配置Nginx，开启https\n\n   ```bash\n   ssl_certificate     ~/ssl/chained.pem;\n   ssl_certificate_key ~/ssl/domain.key;\n   ```\n\n   ​\n\n   因为Let's Encrypt签发的证书的有效期只有90天，需要定时使用脚本进行更新。就是把上面的获取过程写进一个脚本，设置crontab，让其自动执行更新即可。我也不确定这台服务器我会续费到多久，暂时先用着吧。  \n\n   ----后续，续期证书的脚本\n\n   ```bash\n   #!/bin/bash\n   openssl genrsa 4096 > account.key\n   openssl genrsa 4096 > domain,key\n   openssl req -new -sha256 -key domain.key -out domain.csr\n   python acme_tiny.py --account-key ./account.key --csr ./domain.csr --acme-dir /var/www/blog/.well-known/acme-challenge/ > ./signed.crt\n   wget -O - https://letsencrypt.org/certs/lets-encrypt-x3-cross-signed.pem > intermediate.pem\n   cat signed.crt intermediate.pem > chained.pem\n   wget -O - https://letsencrypt.org/certs/isrgrootx1.pem > root.pem\n   cat intermediate.pem root.pem > full_chained.pem\n\n   ```\n\n   ​\n\n### 0x3 That's All\n\n经过一番折腾，在我的域名前，终于看到了浏览器地址栏我的域名前有了一把绿色的小锁，*It's Encrypt!*  \n\n最后还是感谢一下Jerry Qu撰写的博客文章， [Jerry Qu](https://imququ.com/)","slug":"Let-s-Encrypt","published":1,"updated":"2017-12-04T07:27:28.758Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjeqig1mq002blgqa6ffhdrtb","content":"<h3 id=\"0x1-Why\"><a href=\"#0x1-Why\" class=\"headerlink\" title=\"0x1:Why?\"></a>0x1:Why?</h3><p>在聊HTTPS之前，先来了解一下被广泛使用的HTTP协议</p>\n<blockquote>\n<p>HTTP函数作为请求-响应于协议的客户端-服务器计算模型。一个网络浏览器，例如，可以是<em>客户机</em>和一个计算机上运行的应用托管一个网站可以是<em>服务器</em>。该客户机提交一个HTTP <em>请求</em>消息发送到服务器。服务器，它提供<em>的资源</em>如HTML文件和其他内容，或代表客户机的执行其它功能，返回一个<em>响应</em>消息给客户端。响应包含关于请求完成状态信息，并且还可以含有在其消息主体请求的内容。</p>\n<p>网络浏览器是一个的例子<em>的用户代理</em>（UA）。其他类型的用户代理包括由搜索服务提供商（使用的索引软件网络爬虫，语音浏览器，移动应用程序和其他软件访问，消费，或显示网页内容。</p>\n<p>的HTTP被设计成允许中间网络元件，以改善或允许客户端和服务器之间的通信。高流量的网站往往受益于Web缓存的代表提供的内容服务器上游服务器以提高响应时间。Web浏览器的缓存以前访问网络资源并尽可能减少网络流量重用他们。HTTP代理服务器的专用网络边界可以方便为客户的沟通没有一个全球可路由的地址，通过与外部服务器中继消息。</p>\n<p>HTTP是一个应用层协议的框架内，设计的因特网协议套件。它的定义假定底层和可靠的传输层的协议，和传输控制协议（TCP）是常用的。然而HTTP可以适于使用不可靠的协议，如用户数据报协议（UDP），例如在HTTPU和简单服务发现协议（SSDP）。</p>\n<p>HTTP资源得到确认和位于网络通[统一资源定位器（URL）的，使用统一资源标识符（URI的）计划，<em>HTTP</em>和<em>HTTPS</em>。URI和超链接的HTML文档形成相互关联的超文本文档。</p>\n<p>HTTP / 1.1是原来的HTTP（HTTP / 1.0）的修订。在HTTP / 1.0的单独连接到同一台服务器为每个资源的要求而作出。HTTP / 1.1可以重复使用的连接多次下载图像，脚本，样式表，<em>等等</em>页面已交付之后。因此，HTTP / 1.1的通信经验少的延迟为建立TCP连接的呈现相当大的开销。</p>\n</blockquote>\n<p>——-引自wikipedia <a href=\"https://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol\" target=\"_blank\" rel=\"noopener\">维基百科.HTTP词条</a></p>\n<a id=\"more\"></a>\n<p>但是HTTP协议本身不具备加密功能，所有的通讯数据都是在网络上裸奔。所以HTTP链接很容易被“中间人攻击“，HTTP链接网络环节中的中间人（浏览器、路由器、ISP…..）可以对数据进行嗅探，欺骗，劫持，阻挡等等。明文传输的用户数据还容易泄露。</p>\n<p>那什么又是HTTPS呢？  </p>\n<blockquote>\n<p>HTTPS（全称：Hyper Text Transfer Protocol over Secure Socket Layer），是以安全为目标的<a href=\"http://baike.baidu.com/view/9472.htm\" target=\"_blank\" rel=\"noopener\">HTTP</a>通道，简单讲是HTTP的安全版。即HTTP下加入SSL层，HTTPS的安全基础是SSL，因此加密的详细内容就需要SSL。 它是一个URI scheme（抽象标识符体系），句法类同http:体系。用于安全的HTTP数据传输。https:URL表明它使用了HTTP，但HTTPS存在不同于HTTP的默认端口及一个加密/身份验证层（在HTTP与TCP之间）。这个系统的最初研发由网景公司(Netscape)进行，并内置于其浏览器Netscape Navigator中，提供了身份验证与加密通讯方法。现在它被广泛用于万维网上安全敏感的通讯，例如交易支付方面。  </p>\n</blockquote>\n<p>——引自百度百科 <a href=\"http://baike.baidu.com/link?url=ZSi0Ny56ylfHKJ4PEny2ogN3HkMf8QClbf_TulpLkRcei0-Z2w4SnxLVBnJPX5qkHHZOgKgQl78yBX60xdorUa\" target=\"_blank\" rel=\"noopener\">百度百科.HTTPS词条</a></p>\n<p>相比较于HTTP协议，HTTPS在HTTP的基础上增加了SSL（安全套接字层）。SSL的引入为连接的建立和数据的传输都进行了加密，在密钥足够健壮的情形下，是比较安全的。相较于HTTP，HTTPS提供了以下三个强大的功能：</p>\n<ol>\n<li>内容加密。浏览器到百度服务器的内容都是以加密形式传输，中间者无法直接查看原始内容。</li>\n<li>身份认证。保证用户访问的是百度服务，即使被 DNS 劫持到了第三方站点，也会提醒用户没有访问百度服务，有可能被劫持</li>\n<li>数据完整性。防止内容被第三方冒充或者篡改。</li>\n</ol>\n<h3 id=\"0x2-How\"><a href=\"#0x2-How\" class=\"headerlink\" title=\"0x2:How?\"></a>0x2:How?</h3><p>要进行HTTPS加密，我们首先需要向证书颁发机构（CA）申请加密证书。免费的证书颁发机构有Startssl <a href=\"https://www.startssl.com/\" target=\"_blank\" rel=\"noopener\">Start ssl</a>、Let’s Encrypt <a href=\"https://letsencrypt.org/\" target=\"_blank\" rel=\"noopener\">Let’s Encrypt</a>等。我用的是Let’s Encrypt颁发的证书，它操作起来比较简单。它的官方网站上有介绍具体的申请步骤。<a href=\"https://letsencrypt.org/getting-started/\" target=\"_blank\" rel=\"noopener\">申请Let’s encrypt证书</a> 下面是我参考网上一哥们一篇博文<a href=\"https://imququ.com/post/letsencrypt-certificate.html\" target=\"_blank\" rel=\"noopener\">Jerry Qu 申请Let’s Encrypt</a>实际申请证书的具体过程如下：</p>\n<ol>\n<li>创建帐号</li>\n</ol>\n<p>创建一个目录，例如 <em>ssl</em>，用来存放各种临时文件和最红生成的证书文件。首先创建一个私钥文件</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#openssl genrsa 4096 &gt; account.key</span></span><br></pre></td></tr></table></figure>\n<ol>\n<li>创建CSR文件</li>\n</ol>\n<p>生成CSR（Certificate Signing Request，证书签名请求）文件。需要准备一个域名私钥，这里我选择RSA私钥。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#openssl genrsa 4096 &gt; domain.key</span></span><br><span class=\"line\"><span class=\"comment\">#openssl req -new -sha256 -key domain.key -out domain.csr //手动生成csr文件，根据提示进行操作即可</span></span><br></pre></td></tr></table></figure>\n<ol>\n<li>配置验证服务</li>\n</ol>\n<p>CA在颁发证书时，需要验证域名的所有权，证明你对该域名所在的服务器有操作的权限。Let’s Encrypt采用的是服务器上生成一个随机验证文件，再访问CSR中填写的域名，如果访问成功，则证明你对该域名有所有权。为了偷懒，我就不像那位博主一样建立单独的目录了，而是直接在我的web根目录建立一个隐藏目录，用来存放之后生成的随机验证文件。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#mkdir -p /var/blog/.well-known/acme-challenge //建立验证文件存放目录</span></span><br></pre></td></tr></table></figure>\n<ol>\n<li>获取HTTPS证书</li>\n</ol>\n<p>先下载一个acme-tiny的脚本，保存在<em>ssl</em>目录：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#wget https://raw.githubusercontent.com/diafygi/acme-tiny/master/acme_tiny.py</span></span><br></pre></td></tr></table></figure>\n<p>指定账户私钥、CSR、验证目录，然后执行脚本：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">python acme_tiny.py --account-key ./account.key --csr ./domain.csr --acme-dir /var/blog/ &gt; ./signed.crt</span><br></pre></td></tr></table></figure>\n<p>如果执行成功，在当前目录下会生成一个signed.crt文件，这就是申请号的证书文件。</p>\n<p>下载Let’s Encrypt的中间证书，并和网站证书合并在一起:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#wget -O - https://letsencrypt.org/certs/lets-encrypt-x3-cross-signed.pem &gt; intermediate.pem</span></span><br><span class=\"line\"><span class=\"comment\">#cat signed.crt intermediate.pem &gt; chained.pem</span></span><br></pre></td></tr></table></figure>\n<p>再把根证书和中间证书合并在一起：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#wget -O - https://letsencrypt.org/certs/isrgrootx1.pem &gt; root.pem</span></span><br><span class=\"line\"><span class=\"comment\">#cat intermediate.pem root.pem &gt; full_chained.pem</span></span><br></pre></td></tr></table></figure>\n<ol>\n<li><p>配置Nginx，开启https</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ssl_certificate     ~/ssl/chained.pem;</span><br><span class=\"line\">ssl_certificate_key ~/ssl/domain.key;</span><br></pre></td></tr></table></figure>\n<p>​</p>\n<p>因为Let’s Encrypt签发的证书的有效期只有90天，需要定时使用脚本进行更新。就是把上面的获取过程写进一个脚本，设置crontab，让其自动执行更新即可。我也不确定这台服务器我会续费到多久，暂时先用着吧。  </p>\n<p>—-后续，续期证书的脚本</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bin/bash</span></span><br><span class=\"line\">openssl genrsa 4096 &gt; account.key</span><br><span class=\"line\">openssl genrsa 4096 &gt; domain,key</span><br><span class=\"line\">openssl req -new -sha256 -key domain.key -out domain.csr</span><br><span class=\"line\">python acme_tiny.py --account-key ./account.key --csr ./domain.csr --acme-dir /var/www/blog/.well-known/acme-challenge/ &gt; ./signed.crt</span><br><span class=\"line\">wget -O - https://letsencrypt.org/certs/lets-encrypt-x3-cross-signed.pem &gt; intermediate.pem</span><br><span class=\"line\">cat signed.crt intermediate.pem &gt; chained.pem</span><br><span class=\"line\">wget -O - https://letsencrypt.org/certs/isrgrootx1.pem &gt; root.pem</span><br><span class=\"line\">cat intermediate.pem root.pem &gt; full_chained.pem</span><br></pre></td></tr></table></figure>\n<p>​</p>\n</li>\n</ol>\n<h3 id=\"0x3-That’s-All\"><a href=\"#0x3-That’s-All\" class=\"headerlink\" title=\"0x3 That’s All\"></a>0x3 That’s All</h3><p>经过一番折腾，在我的域名前，终于看到了浏览器地址栏我的域名前有了一把绿色的小锁，<em>It’s Encrypt!</em>  </p>\n<p>最后还是感谢一下Jerry Qu撰写的博客文章， <a href=\"https://imququ.com/\" target=\"_blank\" rel=\"noopener\">Jerry Qu</a></p>\n","site":{"data":{}},"excerpt":"<h3 id=\"0x1-Why\"><a href=\"#0x1-Why\" class=\"headerlink\" title=\"0x1:Why?\"></a>0x1:Why?</h3><p>在聊HTTPS之前，先来了解一下被广泛使用的HTTP协议</p>\n<blockquote>\n<p>HTTP函数作为请求-响应于协议的客户端-服务器计算模型。一个网络浏览器，例如，可以是<em>客户机</em>和一个计算机上运行的应用托管一个网站可以是<em>服务器</em>。该客户机提交一个HTTP <em>请求</em>消息发送到服务器。服务器，它提供<em>的资源</em>如HTML文件和其他内容，或代表客户机的执行其它功能，返回一个<em>响应</em>消息给客户端。响应包含关于请求完成状态信息，并且还可以含有在其消息主体请求的内容。</p>\n<p>网络浏览器是一个的例子<em>的用户代理</em>（UA）。其他类型的用户代理包括由搜索服务提供商（使用的索引软件网络爬虫，语音浏览器，移动应用程序和其他软件访问，消费，或显示网页内容。</p>\n<p>的HTTP被设计成允许中间网络元件，以改善或允许客户端和服务器之间的通信。高流量的网站往往受益于Web缓存的代表提供的内容服务器上游服务器以提高响应时间。Web浏览器的缓存以前访问网络资源并尽可能减少网络流量重用他们。HTTP代理服务器的专用网络边界可以方便为客户的沟通没有一个全球可路由的地址，通过与外部服务器中继消息。</p>\n<p>HTTP是一个应用层协议的框架内，设计的因特网协议套件。它的定义假定底层和可靠的传输层的协议，和传输控制协议（TCP）是常用的。然而HTTP可以适于使用不可靠的协议，如用户数据报协议（UDP），例如在HTTPU和简单服务发现协议（SSDP）。</p>\n<p>HTTP资源得到确认和位于网络通[统一资源定位器（URL）的，使用统一资源标识符（URI的）计划，<em>HTTP</em>和<em>HTTPS</em>。URI和超链接的HTML文档形成相互关联的超文本文档。</p>\n<p>HTTP / 1.1是原来的HTTP（HTTP / 1.0）的修订。在HTTP / 1.0的单独连接到同一台服务器为每个资源的要求而作出。HTTP / 1.1可以重复使用的连接多次下载图像，脚本，样式表，<em>等等</em>页面已交付之后。因此，HTTP / 1.1的通信经验少的延迟为建立TCP连接的呈现相当大的开销。</p>\n</blockquote>\n<p>——-引自wikipedia <a href=\"https://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol\" target=\"_blank\" rel=\"noopener\">维基百科.HTTP词条</a></p>","more":"<p>但是HTTP协议本身不具备加密功能，所有的通讯数据都是在网络上裸奔。所以HTTP链接很容易被“中间人攻击“，HTTP链接网络环节中的中间人（浏览器、路由器、ISP…..）可以对数据进行嗅探，欺骗，劫持，阻挡等等。明文传输的用户数据还容易泄露。</p>\n<p>那什么又是HTTPS呢？  </p>\n<blockquote>\n<p>HTTPS（全称：Hyper Text Transfer Protocol over Secure Socket Layer），是以安全为目标的<a href=\"http://baike.baidu.com/view/9472.htm\" target=\"_blank\" rel=\"noopener\">HTTP</a>通道，简单讲是HTTP的安全版。即HTTP下加入SSL层，HTTPS的安全基础是SSL，因此加密的详细内容就需要SSL。 它是一个URI scheme（抽象标识符体系），句法类同http:体系。用于安全的HTTP数据传输。https:URL表明它使用了HTTP，但HTTPS存在不同于HTTP的默认端口及一个加密/身份验证层（在HTTP与TCP之间）。这个系统的最初研发由网景公司(Netscape)进行，并内置于其浏览器Netscape Navigator中，提供了身份验证与加密通讯方法。现在它被广泛用于万维网上安全敏感的通讯，例如交易支付方面。  </p>\n</blockquote>\n<p>——引自百度百科 <a href=\"http://baike.baidu.com/link?url=ZSi0Ny56ylfHKJ4PEny2ogN3HkMf8QClbf_TulpLkRcei0-Z2w4SnxLVBnJPX5qkHHZOgKgQl78yBX60xdorUa\" target=\"_blank\" rel=\"noopener\">百度百科.HTTPS词条</a></p>\n<p>相比较于HTTP协议，HTTPS在HTTP的基础上增加了SSL（安全套接字层）。SSL的引入为连接的建立和数据的传输都进行了加密，在密钥足够健壮的情形下，是比较安全的。相较于HTTP，HTTPS提供了以下三个强大的功能：</p>\n<ol>\n<li>内容加密。浏览器到百度服务器的内容都是以加密形式传输，中间者无法直接查看原始内容。</li>\n<li>身份认证。保证用户访问的是百度服务，即使被 DNS 劫持到了第三方站点，也会提醒用户没有访问百度服务，有可能被劫持</li>\n<li>数据完整性。防止内容被第三方冒充或者篡改。</li>\n</ol>\n<h3 id=\"0x2-How\"><a href=\"#0x2-How\" class=\"headerlink\" title=\"0x2:How?\"></a>0x2:How?</h3><p>要进行HTTPS加密，我们首先需要向证书颁发机构（CA）申请加密证书。免费的证书颁发机构有Startssl <a href=\"https://www.startssl.com/\" target=\"_blank\" rel=\"noopener\">Start ssl</a>、Let’s Encrypt <a href=\"https://letsencrypt.org/\" target=\"_blank\" rel=\"noopener\">Let’s Encrypt</a>等。我用的是Let’s Encrypt颁发的证书，它操作起来比较简单。它的官方网站上有介绍具体的申请步骤。<a href=\"https://letsencrypt.org/getting-started/\" target=\"_blank\" rel=\"noopener\">申请Let’s encrypt证书</a> 下面是我参考网上一哥们一篇博文<a href=\"https://imququ.com/post/letsencrypt-certificate.html\" target=\"_blank\" rel=\"noopener\">Jerry Qu 申请Let’s Encrypt</a>实际申请证书的具体过程如下：</p>\n<ol>\n<li>创建帐号</li>\n</ol>\n<p>创建一个目录，例如 <em>ssl</em>，用来存放各种临时文件和最红生成的证书文件。首先创建一个私钥文件</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#openssl genrsa 4096 &gt; account.key</span></span><br></pre></td></tr></table></figure>\n<ol>\n<li>创建CSR文件</li>\n</ol>\n<p>生成CSR（Certificate Signing Request，证书签名请求）文件。需要准备一个域名私钥，这里我选择RSA私钥。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#openssl genrsa 4096 &gt; domain.key</span></span><br><span class=\"line\"><span class=\"comment\">#openssl req -new -sha256 -key domain.key -out domain.csr //手动生成csr文件，根据提示进行操作即可</span></span><br></pre></td></tr></table></figure>\n<ol>\n<li>配置验证服务</li>\n</ol>\n<p>CA在颁发证书时，需要验证域名的所有权，证明你对该域名所在的服务器有操作的权限。Let’s Encrypt采用的是服务器上生成一个随机验证文件，再访问CSR中填写的域名，如果访问成功，则证明你对该域名有所有权。为了偷懒，我就不像那位博主一样建立单独的目录了，而是直接在我的web根目录建立一个隐藏目录，用来存放之后生成的随机验证文件。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#mkdir -p /var/blog/.well-known/acme-challenge //建立验证文件存放目录</span></span><br></pre></td></tr></table></figure>\n<ol>\n<li>获取HTTPS证书</li>\n</ol>\n<p>先下载一个acme-tiny的脚本，保存在<em>ssl</em>目录：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#wget https://raw.githubusercontent.com/diafygi/acme-tiny/master/acme_tiny.py</span></span><br></pre></td></tr></table></figure>\n<p>指定账户私钥、CSR、验证目录，然后执行脚本：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">python acme_tiny.py --account-key ./account.key --csr ./domain.csr --acme-dir /var/blog/ &gt; ./signed.crt</span><br></pre></td></tr></table></figure>\n<p>如果执行成功，在当前目录下会生成一个signed.crt文件，这就是申请号的证书文件。</p>\n<p>下载Let’s Encrypt的中间证书，并和网站证书合并在一起:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#wget -O - https://letsencrypt.org/certs/lets-encrypt-x3-cross-signed.pem &gt; intermediate.pem</span></span><br><span class=\"line\"><span class=\"comment\">#cat signed.crt intermediate.pem &gt; chained.pem</span></span><br></pre></td></tr></table></figure>\n<p>再把根证书和中间证书合并在一起：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#wget -O - https://letsencrypt.org/certs/isrgrootx1.pem &gt; root.pem</span></span><br><span class=\"line\"><span class=\"comment\">#cat intermediate.pem root.pem &gt; full_chained.pem</span></span><br></pre></td></tr></table></figure>\n<ol>\n<li><p>配置Nginx，开启https</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ssl_certificate     ~/ssl/chained.pem;</span><br><span class=\"line\">ssl_certificate_key ~/ssl/domain.key;</span><br></pre></td></tr></table></figure>\n<p>​</p>\n<p>因为Let’s Encrypt签发的证书的有效期只有90天，需要定时使用脚本进行更新。就是把上面的获取过程写进一个脚本，设置crontab，让其自动执行更新即可。我也不确定这台服务器我会续费到多久，暂时先用着吧。  </p>\n<p>—-后续，续期证书的脚本</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bin/bash</span></span><br><span class=\"line\">openssl genrsa 4096 &gt; account.key</span><br><span class=\"line\">openssl genrsa 4096 &gt; domain,key</span><br><span class=\"line\">openssl req -new -sha256 -key domain.key -out domain.csr</span><br><span class=\"line\">python acme_tiny.py --account-key ./account.key --csr ./domain.csr --acme-dir /var/www/blog/.well-known/acme-challenge/ &gt; ./signed.crt</span><br><span class=\"line\">wget -O - https://letsencrypt.org/certs/lets-encrypt-x3-cross-signed.pem &gt; intermediate.pem</span><br><span class=\"line\">cat signed.crt intermediate.pem &gt; chained.pem</span><br><span class=\"line\">wget -O - https://letsencrypt.org/certs/isrgrootx1.pem &gt; root.pem</span><br><span class=\"line\">cat intermediate.pem root.pem &gt; full_chained.pem</span><br></pre></td></tr></table></figure>\n<p>​</p>\n</li>\n</ol>\n<h3 id=\"0x3-That’s-All\"><a href=\"#0x3-That’s-All\" class=\"headerlink\" title=\"0x3 That’s All\"></a>0x3 That’s All</h3><p>经过一番折腾，在我的域名前，终于看到了浏览器地址栏我的域名前有了一把绿色的小锁，<em>It’s Encrypt!</em>  </p>\n<p>最后还是感谢一下Jerry Qu撰写的博客文章， <a href=\"https://imququ.com/\" target=\"_blank\" rel=\"noopener\">Jerry Qu</a></p>"},{"title":"Linux学习笔记之添加SWAP分区","date":"2017-05-23T14:53:19.000Z","_content":"\n这台博客所在的服务器只有740M内存，云服务器默认也是没有给SWAP分区的。刚刚我想更新一下服务器的软件包，但是报了这么一个错：\n\n```bash\n\nError downloading packages:\n  php70w-xml-7.0.19-1.w7.x86_64: [Errno 5] [Errno 12] Cannot allocate memory\n  libmount-2.23.2-33.el7_3.2.x86_64: [Errno 5] [Errno 12] Cannot allocate memory\n  grubby-8.28-21.el7_3.x86_64: [Errno 5] [Errno 12] Cannot allocate memory\n  httpd-tools-2.4.6-45.el7.centos.4.x86_64: [Errno 5] [Errno 12] Cannot allocate memory\n  libtool-ltdl-2.4.2-22.el7_3.x86_64: [Errno 5] [Errno 12] Cannot allocate memory\n  php70w-intl-7.0.19-1.w7.x86_64: [Errno 5] [Errno 12] Cannot allocate memory\n  1:NetworkManager-team-1.4.0-19.el7_3.x86_64: [Errno 5] [Errno 12] Cannot allocate memory\n  util-linux-2.23.2-33.el7_3.2.x86_64: [Errno 5] [Errno 12] Cannot allocate memory\n  php70w-7.0.19-1.w7.x86_64: [Errno 5] [Errno 12] Cannot allocate memory\n  httpd-2.4.6-45.el7.centos.4.x86_64: [Errno 5] [Errno 12] Cannot allocate memory\n  kernel-tools-3.10.0-514.16.1.el7.x86_64: [Errno 5] [Errno 12] Cannot allocate memory\n  1:NetworkManager-libnm-1.4.0-19.el7_3.x86_64: [Errno 5] [Errno 12] Cannot allocate memory\n  php70w-pdo-7.0.19-1.w7.x86_64: [Errno 5] [Errno 12] Cannot allocate memory\n  php70w-pecl-apcu-5.1.8-1.w7.x86_64: [Errno 5] [Errno 12] Cannot allocate memory\n  ntp-4.2.6p5-25.el7.centos.2.x86_64: [Errno 5] [Errno 12] Cannot allocate memory\n  7:device-mapper-libs-1.02.135-1.el7_3.4.x86_64: [Errno 5] [Errno 12] Cannot allocate memory\n\n```\n\n<!-- more -->\n\n看来是内存不够了，看一下内存占用情况呢：\n\n```bash\n[root@vultr ~]# free -m\n              total        used        free      shared  buff/cache   available\nMem:            740         454         146          37         139         130\nSwap:             0           0           0\n```\n\n唉，空间确实不太充裕了，那就给它加个swap分区，让一些内存交换到硬盘上吧。\n\n#### dd分配出一块空间\n\n```bash\n[root@vultr ~]# dd if=/dev/zero of=/opt/swap bs=1024 count=1048576\n1048576+0 records in\n1048576+0 records out\n1073741824 bytes (1.1 GB) copied, 2.27196 s, 473 MB/s\n```\n\nbs=块的大小，单位bit,我这里给的1KB\n\ncount=块的数量，我这里给了1024*1024个，总计就是1G\n\n#### 将分配的空间格式化为SWAP格式\n\n```bash\n[root@vultr ~]# mkswap /opt/swap \nSetting up swapspace version 1, size = 1048572 KiB\nno label, UUID=f42645fc-5a4b-4cfd-99c5-caf6fa6070f7\n```\n\n可以看到已经为它分配了UUID。\n\n#### 将格式化好的空间挂载上\n\n```bash\n[root@vultr ~]# swapon /opt/swap \nswapon: /opt/swap: insecure permissions 0644, 0600 suggested.\n```\n\n咦，它提示说权限不太安全，那就chmod成0600吧。\n\n#### 开机自动挂载SWAP分区\n\n开机自动挂载的话，需要在/etc/fstab中添加挂载选项。\n\n```bash\n echo \"/opt/swap swap swap defaults  0 0\" >> /etc/fstab\n```\n\n好了，这样给服务器成功地加上了个SWAP分区了。再检查一下\n\n```bash\n[root@vultr ~]# free -m\n              total        used        free      shared  buff/cache   available\nMem:            740         454          62          37         222         117\nSwap:          1023           0        1023 \n```\n\nSwap分区已经不为0了，确认已经分配完成。","source":"_posts/Linux-Add-Swap.md","raw":"---\ntitle: Linux学习笔记之添加SWAP分区\ncategories:\n  - Linux\ntags:\n  - Linux\n  - SWAP\ndate: 2017-05-23 22:53:19\n---\n\n这台博客所在的服务器只有740M内存，云服务器默认也是没有给SWAP分区的。刚刚我想更新一下服务器的软件包，但是报了这么一个错：\n\n```bash\n\nError downloading packages:\n  php70w-xml-7.0.19-1.w7.x86_64: [Errno 5] [Errno 12] Cannot allocate memory\n  libmount-2.23.2-33.el7_3.2.x86_64: [Errno 5] [Errno 12] Cannot allocate memory\n  grubby-8.28-21.el7_3.x86_64: [Errno 5] [Errno 12] Cannot allocate memory\n  httpd-tools-2.4.6-45.el7.centos.4.x86_64: [Errno 5] [Errno 12] Cannot allocate memory\n  libtool-ltdl-2.4.2-22.el7_3.x86_64: [Errno 5] [Errno 12] Cannot allocate memory\n  php70w-intl-7.0.19-1.w7.x86_64: [Errno 5] [Errno 12] Cannot allocate memory\n  1:NetworkManager-team-1.4.0-19.el7_3.x86_64: [Errno 5] [Errno 12] Cannot allocate memory\n  util-linux-2.23.2-33.el7_3.2.x86_64: [Errno 5] [Errno 12] Cannot allocate memory\n  php70w-7.0.19-1.w7.x86_64: [Errno 5] [Errno 12] Cannot allocate memory\n  httpd-2.4.6-45.el7.centos.4.x86_64: [Errno 5] [Errno 12] Cannot allocate memory\n  kernel-tools-3.10.0-514.16.1.el7.x86_64: [Errno 5] [Errno 12] Cannot allocate memory\n  1:NetworkManager-libnm-1.4.0-19.el7_3.x86_64: [Errno 5] [Errno 12] Cannot allocate memory\n  php70w-pdo-7.0.19-1.w7.x86_64: [Errno 5] [Errno 12] Cannot allocate memory\n  php70w-pecl-apcu-5.1.8-1.w7.x86_64: [Errno 5] [Errno 12] Cannot allocate memory\n  ntp-4.2.6p5-25.el7.centos.2.x86_64: [Errno 5] [Errno 12] Cannot allocate memory\n  7:device-mapper-libs-1.02.135-1.el7_3.4.x86_64: [Errno 5] [Errno 12] Cannot allocate memory\n\n```\n\n<!-- more -->\n\n看来是内存不够了，看一下内存占用情况呢：\n\n```bash\n[root@vultr ~]# free -m\n              total        used        free      shared  buff/cache   available\nMem:            740         454         146          37         139         130\nSwap:             0           0           0\n```\n\n唉，空间确实不太充裕了，那就给它加个swap分区，让一些内存交换到硬盘上吧。\n\n#### dd分配出一块空间\n\n```bash\n[root@vultr ~]# dd if=/dev/zero of=/opt/swap bs=1024 count=1048576\n1048576+0 records in\n1048576+0 records out\n1073741824 bytes (1.1 GB) copied, 2.27196 s, 473 MB/s\n```\n\nbs=块的大小，单位bit,我这里给的1KB\n\ncount=块的数量，我这里给了1024*1024个，总计就是1G\n\n#### 将分配的空间格式化为SWAP格式\n\n```bash\n[root@vultr ~]# mkswap /opt/swap \nSetting up swapspace version 1, size = 1048572 KiB\nno label, UUID=f42645fc-5a4b-4cfd-99c5-caf6fa6070f7\n```\n\n可以看到已经为它分配了UUID。\n\n#### 将格式化好的空间挂载上\n\n```bash\n[root@vultr ~]# swapon /opt/swap \nswapon: /opt/swap: insecure permissions 0644, 0600 suggested.\n```\n\n咦，它提示说权限不太安全，那就chmod成0600吧。\n\n#### 开机自动挂载SWAP分区\n\n开机自动挂载的话，需要在/etc/fstab中添加挂载选项。\n\n```bash\n echo \"/opt/swap swap swap defaults  0 0\" >> /etc/fstab\n```\n\n好了，这样给服务器成功地加上了个SWAP分区了。再检查一下\n\n```bash\n[root@vultr ~]# free -m\n              total        used        free      shared  buff/cache   available\nMem:            740         454          62          37         222         117\nSwap:          1023           0        1023 \n```\n\nSwap分区已经不为0了，确认已经分配完成。","slug":"Linux-Add-Swap","published":1,"updated":"2017-12-04T07:27:28.758Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjeqig1mu002flgqa6za6i8r0","content":"<p>这台博客所在的服务器只有740M内存，云服务器默认也是没有给SWAP分区的。刚刚我想更新一下服务器的软件包，但是报了这么一个错：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">Error downloading packages:</span><br><span class=\"line\">  php70w-xml-7.0.19-1.w7.x86_64: [Errno 5] [Errno 12] Cannot allocate memory</span><br><span class=\"line\">  libmount-2.23.2-33.el7_3.2.x86_64: [Errno 5] [Errno 12] Cannot allocate memory</span><br><span class=\"line\">  grubby-8.28-21.el7_3.x86_64: [Errno 5] [Errno 12] Cannot allocate memory</span><br><span class=\"line\">  httpd-tools-2.4.6-45.el7.centos.4.x86_64: [Errno 5] [Errno 12] Cannot allocate memory</span><br><span class=\"line\">  libtool-ltdl-2.4.2-22.el7_3.x86_64: [Errno 5] [Errno 12] Cannot allocate memory</span><br><span class=\"line\">  php70w-intl-7.0.19-1.w7.x86_64: [Errno 5] [Errno 12] Cannot allocate memory</span><br><span class=\"line\">  1:NetworkManager-team-1.4.0-19.el7_3.x86_64: [Errno 5] [Errno 12] Cannot allocate memory</span><br><span class=\"line\">  util-linux-2.23.2-33.el7_3.2.x86_64: [Errno 5] [Errno 12] Cannot allocate memory</span><br><span class=\"line\">  php70w-7.0.19-1.w7.x86_64: [Errno 5] [Errno 12] Cannot allocate memory</span><br><span class=\"line\">  httpd-2.4.6-45.el7.centos.4.x86_64: [Errno 5] [Errno 12] Cannot allocate memory</span><br><span class=\"line\">  kernel-tools-3.10.0-514.16.1.el7.x86_64: [Errno 5] [Errno 12] Cannot allocate memory</span><br><span class=\"line\">  1:NetworkManager-libnm-1.4.0-19.el7_3.x86_64: [Errno 5] [Errno 12] Cannot allocate memory</span><br><span class=\"line\">  php70w-pdo-7.0.19-1.w7.x86_64: [Errno 5] [Errno 12] Cannot allocate memory</span><br><span class=\"line\">  php70w-pecl-apcu-5.1.8-1.w7.x86_64: [Errno 5] [Errno 12] Cannot allocate memory</span><br><span class=\"line\">  ntp-4.2.6p5-25.el7.centos.2.x86_64: [Errno 5] [Errno 12] Cannot allocate memory</span><br><span class=\"line\">  7:device-mapper-libs-1.02.135-1.el7_3.4.x86_64: [Errno 5] [Errno 12] Cannot allocate memory</span><br></pre></td></tr></table></figure>\n<a id=\"more\"></a>\n<p>看来是内存不够了，看一下内存占用情况呢：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@vultr ~]<span class=\"comment\"># free -m</span></span><br><span class=\"line\">              total        used        free      shared  buff/cache   available</span><br><span class=\"line\">Mem:            740         454         146          37         139         130</span><br><span class=\"line\">Swap:             0           0           0</span><br></pre></td></tr></table></figure>\n<p>唉，空间确实不太充裕了，那就给它加个swap分区，让一些内存交换到硬盘上吧。</p>\n<h4 id=\"dd分配出一块空间\"><a href=\"#dd分配出一块空间\" class=\"headerlink\" title=\"dd分配出一块空间\"></a>dd分配出一块空间</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@vultr ~]<span class=\"comment\"># dd if=/dev/zero of=/opt/swap bs=1024 count=1048576</span></span><br><span class=\"line\">1048576+0 records <span class=\"keyword\">in</span></span><br><span class=\"line\">1048576+0 records out</span><br><span class=\"line\">1073741824 bytes (1.1 GB) copied, 2.27196 s, 473 MB/s</span><br></pre></td></tr></table></figure>\n<p>bs=块的大小，单位bit,我这里给的1KB</p>\n<p>count=块的数量，我这里给了1024*1024个，总计就是1G</p>\n<h4 id=\"将分配的空间格式化为SWAP格式\"><a href=\"#将分配的空间格式化为SWAP格式\" class=\"headerlink\" title=\"将分配的空间格式化为SWAP格式\"></a>将分配的空间格式化为SWAP格式</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@vultr ~]<span class=\"comment\"># mkswap /opt/swap </span></span><br><span class=\"line\">Setting up swapspace version 1, size = 1048572 KiB</span><br><span class=\"line\">no label, UUID=f42645fc-5a4b-4cfd-99c5-caf6fa6070f7</span><br></pre></td></tr></table></figure>\n<p>可以看到已经为它分配了UUID。</p>\n<h4 id=\"将格式化好的空间挂载上\"><a href=\"#将格式化好的空间挂载上\" class=\"headerlink\" title=\"将格式化好的空间挂载上\"></a>将格式化好的空间挂载上</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@vultr ~]<span class=\"comment\"># swapon /opt/swap </span></span><br><span class=\"line\">swapon: /opt/swap: insecure permissions 0644, 0600 suggested.</span><br></pre></td></tr></table></figure>\n<p>咦，它提示说权限不太安全，那就chmod成0600吧。</p>\n<h4 id=\"开机自动挂载SWAP分区\"><a href=\"#开机自动挂载SWAP分区\" class=\"headerlink\" title=\"开机自动挂载SWAP分区\"></a>开机自动挂载SWAP分区</h4><p>开机自动挂载的话，需要在/etc/fstab中添加挂载选项。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"/opt/swap swap swap defaults  0 0\"</span> &gt;&gt; /etc/fstab</span><br></pre></td></tr></table></figure>\n<p>好了，这样给服务器成功地加上了个SWAP分区了。再检查一下</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@vultr ~]<span class=\"comment\"># free -m</span></span><br><span class=\"line\">              total        used        free      shared  buff/cache   available</span><br><span class=\"line\">Mem:            740         454          62          37         222         117</span><br><span class=\"line\">Swap:          1023           0        1023</span><br></pre></td></tr></table></figure>\n<p>Swap分区已经不为0了，确认已经分配完成。</p>\n","site":{"data":{}},"excerpt":"<p>这台博客所在的服务器只有740M内存，云服务器默认也是没有给SWAP分区的。刚刚我想更新一下服务器的软件包，但是报了这么一个错：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">Error downloading packages:</span><br><span class=\"line\">  php70w-xml-7.0.19-1.w7.x86_64: [Errno 5] [Errno 12] Cannot allocate memory</span><br><span class=\"line\">  libmount-2.23.2-33.el7_3.2.x86_64: [Errno 5] [Errno 12] Cannot allocate memory</span><br><span class=\"line\">  grubby-8.28-21.el7_3.x86_64: [Errno 5] [Errno 12] Cannot allocate memory</span><br><span class=\"line\">  httpd-tools-2.4.6-45.el7.centos.4.x86_64: [Errno 5] [Errno 12] Cannot allocate memory</span><br><span class=\"line\">  libtool-ltdl-2.4.2-22.el7_3.x86_64: [Errno 5] [Errno 12] Cannot allocate memory</span><br><span class=\"line\">  php70w-intl-7.0.19-1.w7.x86_64: [Errno 5] [Errno 12] Cannot allocate memory</span><br><span class=\"line\">  1:NetworkManager-team-1.4.0-19.el7_3.x86_64: [Errno 5] [Errno 12] Cannot allocate memory</span><br><span class=\"line\">  util-linux-2.23.2-33.el7_3.2.x86_64: [Errno 5] [Errno 12] Cannot allocate memory</span><br><span class=\"line\">  php70w-7.0.19-1.w7.x86_64: [Errno 5] [Errno 12] Cannot allocate memory</span><br><span class=\"line\">  httpd-2.4.6-45.el7.centos.4.x86_64: [Errno 5] [Errno 12] Cannot allocate memory</span><br><span class=\"line\">  kernel-tools-3.10.0-514.16.1.el7.x86_64: [Errno 5] [Errno 12] Cannot allocate memory</span><br><span class=\"line\">  1:NetworkManager-libnm-1.4.0-19.el7_3.x86_64: [Errno 5] [Errno 12] Cannot allocate memory</span><br><span class=\"line\">  php70w-pdo-7.0.19-1.w7.x86_64: [Errno 5] [Errno 12] Cannot allocate memory</span><br><span class=\"line\">  php70w-pecl-apcu-5.1.8-1.w7.x86_64: [Errno 5] [Errno 12] Cannot allocate memory</span><br><span class=\"line\">  ntp-4.2.6p5-25.el7.centos.2.x86_64: [Errno 5] [Errno 12] Cannot allocate memory</span><br><span class=\"line\">  7:device-mapper-libs-1.02.135-1.el7_3.4.x86_64: [Errno 5] [Errno 12] Cannot allocate memory</span><br></pre></td></tr></table></figure>","more":"<p>看来是内存不够了，看一下内存占用情况呢：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@vultr ~]<span class=\"comment\"># free -m</span></span><br><span class=\"line\">              total        used        free      shared  buff/cache   available</span><br><span class=\"line\">Mem:            740         454         146          37         139         130</span><br><span class=\"line\">Swap:             0           0           0</span><br></pre></td></tr></table></figure>\n<p>唉，空间确实不太充裕了，那就给它加个swap分区，让一些内存交换到硬盘上吧。</p>\n<h4 id=\"dd分配出一块空间\"><a href=\"#dd分配出一块空间\" class=\"headerlink\" title=\"dd分配出一块空间\"></a>dd分配出一块空间</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@vultr ~]<span class=\"comment\"># dd if=/dev/zero of=/opt/swap bs=1024 count=1048576</span></span><br><span class=\"line\">1048576+0 records <span class=\"keyword\">in</span></span><br><span class=\"line\">1048576+0 records out</span><br><span class=\"line\">1073741824 bytes (1.1 GB) copied, 2.27196 s, 473 MB/s</span><br></pre></td></tr></table></figure>\n<p>bs=块的大小，单位bit,我这里给的1KB</p>\n<p>count=块的数量，我这里给了1024*1024个，总计就是1G</p>\n<h4 id=\"将分配的空间格式化为SWAP格式\"><a href=\"#将分配的空间格式化为SWAP格式\" class=\"headerlink\" title=\"将分配的空间格式化为SWAP格式\"></a>将分配的空间格式化为SWAP格式</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@vultr ~]<span class=\"comment\"># mkswap /opt/swap </span></span><br><span class=\"line\">Setting up swapspace version 1, size = 1048572 KiB</span><br><span class=\"line\">no label, UUID=f42645fc-5a4b-4cfd-99c5-caf6fa6070f7</span><br></pre></td></tr></table></figure>\n<p>可以看到已经为它分配了UUID。</p>\n<h4 id=\"将格式化好的空间挂载上\"><a href=\"#将格式化好的空间挂载上\" class=\"headerlink\" title=\"将格式化好的空间挂载上\"></a>将格式化好的空间挂载上</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@vultr ~]<span class=\"comment\"># swapon /opt/swap </span></span><br><span class=\"line\">swapon: /opt/swap: insecure permissions 0644, 0600 suggested.</span><br></pre></td></tr></table></figure>\n<p>咦，它提示说权限不太安全，那就chmod成0600吧。</p>\n<h4 id=\"开机自动挂载SWAP分区\"><a href=\"#开机自动挂载SWAP分区\" class=\"headerlink\" title=\"开机自动挂载SWAP分区\"></a>开机自动挂载SWAP分区</h4><p>开机自动挂载的话，需要在/etc/fstab中添加挂载选项。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"/opt/swap swap swap defaults  0 0\"</span> &gt;&gt; /etc/fstab</span><br></pre></td></tr></table></figure>\n<p>好了，这样给服务器成功地加上了个SWAP分区了。再检查一下</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@vultr ~]<span class=\"comment\"># free -m</span></span><br><span class=\"line\">              total        used        free      shared  buff/cache   available</span><br><span class=\"line\">Mem:            740         454          62          37         222         117</span><br><span class=\"line\">Swap:          1023           0        1023</span><br></pre></td></tr></table></figure>\n<p>Swap分区已经不为0了，确认已经分配完成。</p>"},{"title":"Linux学习笔记之文件权限","date":"2017-05-23T09:32:43.000Z","_content":"\n在Linux系统中，一切皆为文件。当然文件权限的管理也相对复杂一些了。 Linux继续沿用了Unix管理文件权限的办法，其允许用户和组基于每个文件和目录的一组安全性设置来访问文件。但是对于使用“ls”命令查看Linux系统上的文件、目录和设备的权限时，输出的信息也没有弄得十分清楚，特地又重新学习了一下，免得遗忘，还是做下笔记。\n\n<!-- more -->\n\n### 理解ls命令的输出\n\n```bash\n[root@vultr etc]# ls -la\ntotal 1660\ndrwxr-xr-x 85 root  root   4096 May 22 07:14 .\ndr-xr-xr-x 18 root  root   4096 Dec 16 14:24 ..\n-rw-r--r--  1 root  root     16 Nov 14  2016 adjtime\n-rw-r--r--  1 root  root   1518 Jun  7  2013 aliases\n-rw-r--r--  1 root  root  12288 Dec 27 09:14 aliases.db\ndrwxr-xr-x  2 root  root   4096 Mar 11 04:11 alternatives\n-rw-r--r--  1 root  root     55 Nov  4  2016 asound.conf\ndrwxr-xr-x  2 root  root   4096 Dec 16 14:26 avahi\ndrwxr-xr-x  2 root  root   4096 May 22 07:31 bash_completion.d\n-rw-r--r--  1 root  root   2853 Nov  5  2016 bashrc\ndrwxr-xr-x  2 root  root   4096 Mar  3 03:23 binfmt.d\n-rw-r--r--  1 root  root     38 Nov 29 18:12 centos-release\n-rw-r--r--  1 root  root     51 Nov 29 18:12 centos-release-upstream\n```\n\n上面是我查看/etc目录下的文件时的部分输出。其输出结果有七个字段，下面来具体解释一下具体含义：\n\n#### 第一个字段：drwxr-xr-x，这个字段描述的是文件和目录权限码。\n\n这个字段的第一个字符代表的含义有以下几种情况：\n\n- -代表文件；例子：-rw-r--r--  1 root  root   2853 Nov  5  2016 bashrc，表示bashrc是一个文件\n- d代表目录；例子：drwxr-xr-x  2 root  root   4096 Mar  3 03:23 binfmt.d，表示binfmt.d是一个目录\n- l代表链接；例子：lrwxrwxrwx  1 root root          25 Jan  7 13:32 initctl -> /run/systemd/initctl/fifo，表示inictl是一个链接到/run/systemd/initctl/fifo的链接\n- c代表字符设备；例子：crw--w----  1 root tty       4,   6 Jan  7 13:32 tty6，表示tty6是一个字符设备\n- b代表块设备；例子：brw-rw----   1 root disk    253,   0 4月  13 19:25 vda，表示vda是一个块设备，它其实这台云服务器的硬盘。\n- s代表socket文件；例子：srwxrwxrwx   1 mysql mysql        0 4月  13 19:25 mysql.sock，mysql.sock就是一个socket文件。\n- p代表管道文件；\n\n之后的3组三字符的编码：rwxr-xr-x，表示了该文件的三重访问权限\n\n- r代表对象是可读的；\n- w代表对象是可写的；\n- x代表对象是可执行的;\n\n如果没有某种权限，在该权限的位置会出现单破折线。这3组权限分别对应3个安全级别：\n\n- 对象的属主，也就是文件的所有者；\n- 对象的属组，也就是文件所有者所在的用户组；\n- 系统其他用户；\n\n理论上就是这样子了，我们去找个实际的例子来分析一下：\n\n> 例子：drwxr-xr-x  2 root  root   4096 Mar 11 04:11 alternatives\n\n![image](/blogimg/ls_detail.png)\n\n但是有时候我们更改文件权限是由三位数字来表示的，例如\"chmod 755 file\"，这又是怎么回事呢？这里有一张表可以参考一下：\n\n![image](/blogimg/linux_umask.png)\n\n把权限类型弄明白了，然后学习一下怎么更改Linux的文件权限的命令吧。\n\nchmod:用于改变文件的权限，SUID,SGID,SBIT等等\n\n1. chmod命令的格式\n\n   > chmod options mode file\n\n   mode参数后边可以跟上八进制模式或符号模式来设置文件权限\n\n   ```bash\n   [root@VM_0_49_centos ~]# ls -la file_test #原本file_test的权限为644\n   -rw-r--r-- 1 root apache 0 5月  23 21:55 file_test\n   [root@VM_0_49_centos ~]# chmod 760 file_test \n   [root@VM_0_49_centos ~]# ls -la file_test #更改后为760\n   -rwxrw---- 1 root apache 0 5月  23 21:55 file_test\n   ```\n\nchmod还有另外一种表示方式，较为复杂一些，命令格式如下：\n> chmod [ugoa...][+-=][rwxXstugo...]\n\n这样虽然复杂一些，但是更容易理解不是吗？\n- u  代表用户\n- g  代表组\n- o  代表拥有者\n- a  代表上述所有\n\n接下来的符号表示你是想在现有权限的基础上增加权限（+），还是移除权限（-），还是将权限设置为后面的值（=）\n\n最后的符号代表你想赋予的权限。详细的有：\n\n- X  如果对象是目录或者它已经有执行权限，则赋予执行权限\n- s  运行时重新设置UID或GID\n- t  保留文件或目录\n- u  将权限设置为属主一样\n- g  将权限设置为跟属组一样\n- o  将权限设置为跟其他用户一样\n\n举个栗子：\n\n```bash\n$ chmod o+r newfile #给文件所有者加上读权限\n```\n\n#### 第二个字段表示该文件的链接数，包括硬链接和软链接\n\n创建软链接：ln -s\n\n创建硬链接：ln\n\n#### 第三个字段表示该文件的所有者\n\n文件所有者可以通过chown命令来更改。命令格式：\n\n```bash\n$  chown [OPTION]... [OWNER][:[GROUP]] FILE...\n```\n\n当然，chown也可以同时更改文件所属的组。-R参数可以递归的更改子目录和文件的所属关系，-h参数可以改变文件的所有符号链接文件的所属关系。\n\n#### 第四个字段表示该文件所在的用户组\n\n文件所属的用户组可通过chgrp来进行更改。命令格式：\n\n```bash\n$   chgrp [OPTION]... GROUP FILE...\n```\n\n#### 第五个字段表示该文件的文件大小，单位字节\n\n#### 第六个字段表示文件的修改时间\n\n#### 第七个字段表示文件名\n\n","source":"_posts/Linux-File-Priveleges.md","raw":"---\ntitle: Linux学习笔记之文件权限\ncategories:\n  - Linux\ntags:\n  - 文件权限\n  - 学习笔记\ndate: 2017-05-23 17:32:43\n---\n\n在Linux系统中，一切皆为文件。当然文件权限的管理也相对复杂一些了。 Linux继续沿用了Unix管理文件权限的办法，其允许用户和组基于每个文件和目录的一组安全性设置来访问文件。但是对于使用“ls”命令查看Linux系统上的文件、目录和设备的权限时，输出的信息也没有弄得十分清楚，特地又重新学习了一下，免得遗忘，还是做下笔记。\n\n<!-- more -->\n\n### 理解ls命令的输出\n\n```bash\n[root@vultr etc]# ls -la\ntotal 1660\ndrwxr-xr-x 85 root  root   4096 May 22 07:14 .\ndr-xr-xr-x 18 root  root   4096 Dec 16 14:24 ..\n-rw-r--r--  1 root  root     16 Nov 14  2016 adjtime\n-rw-r--r--  1 root  root   1518 Jun  7  2013 aliases\n-rw-r--r--  1 root  root  12288 Dec 27 09:14 aliases.db\ndrwxr-xr-x  2 root  root   4096 Mar 11 04:11 alternatives\n-rw-r--r--  1 root  root     55 Nov  4  2016 asound.conf\ndrwxr-xr-x  2 root  root   4096 Dec 16 14:26 avahi\ndrwxr-xr-x  2 root  root   4096 May 22 07:31 bash_completion.d\n-rw-r--r--  1 root  root   2853 Nov  5  2016 bashrc\ndrwxr-xr-x  2 root  root   4096 Mar  3 03:23 binfmt.d\n-rw-r--r--  1 root  root     38 Nov 29 18:12 centos-release\n-rw-r--r--  1 root  root     51 Nov 29 18:12 centos-release-upstream\n```\n\n上面是我查看/etc目录下的文件时的部分输出。其输出结果有七个字段，下面来具体解释一下具体含义：\n\n#### 第一个字段：drwxr-xr-x，这个字段描述的是文件和目录权限码。\n\n这个字段的第一个字符代表的含义有以下几种情况：\n\n- -代表文件；例子：-rw-r--r--  1 root  root   2853 Nov  5  2016 bashrc，表示bashrc是一个文件\n- d代表目录；例子：drwxr-xr-x  2 root  root   4096 Mar  3 03:23 binfmt.d，表示binfmt.d是一个目录\n- l代表链接；例子：lrwxrwxrwx  1 root root          25 Jan  7 13:32 initctl -> /run/systemd/initctl/fifo，表示inictl是一个链接到/run/systemd/initctl/fifo的链接\n- c代表字符设备；例子：crw--w----  1 root tty       4,   6 Jan  7 13:32 tty6，表示tty6是一个字符设备\n- b代表块设备；例子：brw-rw----   1 root disk    253,   0 4月  13 19:25 vda，表示vda是一个块设备，它其实这台云服务器的硬盘。\n- s代表socket文件；例子：srwxrwxrwx   1 mysql mysql        0 4月  13 19:25 mysql.sock，mysql.sock就是一个socket文件。\n- p代表管道文件；\n\n之后的3组三字符的编码：rwxr-xr-x，表示了该文件的三重访问权限\n\n- r代表对象是可读的；\n- w代表对象是可写的；\n- x代表对象是可执行的;\n\n如果没有某种权限，在该权限的位置会出现单破折线。这3组权限分别对应3个安全级别：\n\n- 对象的属主，也就是文件的所有者；\n- 对象的属组，也就是文件所有者所在的用户组；\n- 系统其他用户；\n\n理论上就是这样子了，我们去找个实际的例子来分析一下：\n\n> 例子：drwxr-xr-x  2 root  root   4096 Mar 11 04:11 alternatives\n\n![image](/blogimg/ls_detail.png)\n\n但是有时候我们更改文件权限是由三位数字来表示的，例如\"chmod 755 file\"，这又是怎么回事呢？这里有一张表可以参考一下：\n\n![image](/blogimg/linux_umask.png)\n\n把权限类型弄明白了，然后学习一下怎么更改Linux的文件权限的命令吧。\n\nchmod:用于改变文件的权限，SUID,SGID,SBIT等等\n\n1. chmod命令的格式\n\n   > chmod options mode file\n\n   mode参数后边可以跟上八进制模式或符号模式来设置文件权限\n\n   ```bash\n   [root@VM_0_49_centos ~]# ls -la file_test #原本file_test的权限为644\n   -rw-r--r-- 1 root apache 0 5月  23 21:55 file_test\n   [root@VM_0_49_centos ~]# chmod 760 file_test \n   [root@VM_0_49_centos ~]# ls -la file_test #更改后为760\n   -rwxrw---- 1 root apache 0 5月  23 21:55 file_test\n   ```\n\nchmod还有另外一种表示方式，较为复杂一些，命令格式如下：\n> chmod [ugoa...][+-=][rwxXstugo...]\n\n这样虽然复杂一些，但是更容易理解不是吗？\n- u  代表用户\n- g  代表组\n- o  代表拥有者\n- a  代表上述所有\n\n接下来的符号表示你是想在现有权限的基础上增加权限（+），还是移除权限（-），还是将权限设置为后面的值（=）\n\n最后的符号代表你想赋予的权限。详细的有：\n\n- X  如果对象是目录或者它已经有执行权限，则赋予执行权限\n- s  运行时重新设置UID或GID\n- t  保留文件或目录\n- u  将权限设置为属主一样\n- g  将权限设置为跟属组一样\n- o  将权限设置为跟其他用户一样\n\n举个栗子：\n\n```bash\n$ chmod o+r newfile #给文件所有者加上读权限\n```\n\n#### 第二个字段表示该文件的链接数，包括硬链接和软链接\n\n创建软链接：ln -s\n\n创建硬链接：ln\n\n#### 第三个字段表示该文件的所有者\n\n文件所有者可以通过chown命令来更改。命令格式：\n\n```bash\n$  chown [OPTION]... [OWNER][:[GROUP]] FILE...\n```\n\n当然，chown也可以同时更改文件所属的组。-R参数可以递归的更改子目录和文件的所属关系，-h参数可以改变文件的所有符号链接文件的所属关系。\n\n#### 第四个字段表示该文件所在的用户组\n\n文件所属的用户组可通过chgrp来进行更改。命令格式：\n\n```bash\n$   chgrp [OPTION]... GROUP FILE...\n```\n\n#### 第五个字段表示该文件的文件大小，单位字节\n\n#### 第六个字段表示文件的修改时间\n\n#### 第七个字段表示文件名\n\n","slug":"Linux-File-Priveleges","published":1,"updated":"2017-12-04T07:27:28.759Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjeqig1mx002ilgqa8r0rqthg","content":"<p>在Linux系统中，一切皆为文件。当然文件权限的管理也相对复杂一些了。 Linux继续沿用了Unix管理文件权限的办法，其允许用户和组基于每个文件和目录的一组安全性设置来访问文件。但是对于使用“ls”命令查看Linux系统上的文件、目录和设备的权限时，输出的信息也没有弄得十分清楚，特地又重新学习了一下，免得遗忘，还是做下笔记。</p>\n<a id=\"more\"></a>\n<h3 id=\"理解ls命令的输出\"><a href=\"#理解ls命令的输出\" class=\"headerlink\" title=\"理解ls命令的输出\"></a>理解ls命令的输出</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@vultr etc]<span class=\"comment\"># ls -la</span></span><br><span class=\"line\">total 1660</span><br><span class=\"line\">drwxr-xr-x 85 root  root   4096 May 22 07:14 .</span><br><span class=\"line\">dr-xr-xr-x 18 root  root   4096 Dec 16 14:24 ..</span><br><span class=\"line\">-rw-r--r--  1 root  root     16 Nov 14  2016 adjtime</span><br><span class=\"line\">-rw-r--r--  1 root  root   1518 Jun  7  2013 aliases</span><br><span class=\"line\">-rw-r--r--  1 root  root  12288 Dec 27 09:14 aliases.db</span><br><span class=\"line\">drwxr-xr-x  2 root  root   4096 Mar 11 04:11 alternatives</span><br><span class=\"line\">-rw-r--r--  1 root  root     55 Nov  4  2016 asound.conf</span><br><span class=\"line\">drwxr-xr-x  2 root  root   4096 Dec 16 14:26 avahi</span><br><span class=\"line\">drwxr-xr-x  2 root  root   4096 May 22 07:31 bash_completion.d</span><br><span class=\"line\">-rw-r--r--  1 root  root   2853 Nov  5  2016 bashrc</span><br><span class=\"line\">drwxr-xr-x  2 root  root   4096 Mar  3 03:23 binfmt.d</span><br><span class=\"line\">-rw-r--r--  1 root  root     38 Nov 29 18:12 centos-release</span><br><span class=\"line\">-rw-r--r--  1 root  root     51 Nov 29 18:12 centos-release-upstream</span><br></pre></td></tr></table></figure>\n<p>上面是我查看/etc目录下的文件时的部分输出。其输出结果有七个字段，下面来具体解释一下具体含义：</p>\n<h4 id=\"第一个字段：drwxr-xr-x，这个字段描述的是文件和目录权限码。\"><a href=\"#第一个字段：drwxr-xr-x，这个字段描述的是文件和目录权限码。\" class=\"headerlink\" title=\"第一个字段：drwxr-xr-x，这个字段描述的是文件和目录权限码。\"></a>第一个字段：drwxr-xr-x，这个字段描述的是文件和目录权限码。</h4><p>这个字段的第一个字符代表的含义有以下几种情况：</p>\n<ul>\n<li>-代表文件；例子：-rw-r–r–  1 root  root   2853 Nov  5  2016 bashrc，表示bashrc是一个文件</li>\n<li>d代表目录；例子：drwxr-xr-x  2 root  root   4096 Mar  3 03:23 binfmt.d，表示binfmt.d是一个目录</li>\n<li>l代表链接；例子：lrwxrwxrwx  1 root root          25 Jan  7 13:32 initctl -&gt; /run/systemd/initctl/fifo，表示inictl是一个链接到/run/systemd/initctl/fifo的链接</li>\n<li>c代表字符设备；例子：crw–w—-  1 root tty       4,   6 Jan  7 13:32 tty6，表示tty6是一个字符设备</li>\n<li>b代表块设备；例子：brw-rw—-   1 root disk    253,   0 4月  13 19:25 vda，表示vda是一个块设备，它其实这台云服务器的硬盘。</li>\n<li>s代表socket文件；例子：srwxrwxrwx   1 mysql mysql        0 4月  13 19:25 mysql.sock，mysql.sock就是一个socket文件。</li>\n<li>p代表管道文件；</li>\n</ul>\n<p>之后的3组三字符的编码：rwxr-xr-x，表示了该文件的三重访问权限</p>\n<ul>\n<li>r代表对象是可读的；</li>\n<li>w代表对象是可写的；</li>\n<li>x代表对象是可执行的;</li>\n</ul>\n<p>如果没有某种权限，在该权限的位置会出现单破折线。这3组权限分别对应3个安全级别：</p>\n<ul>\n<li>对象的属主，也就是文件的所有者；</li>\n<li>对象的属组，也就是文件所有者所在的用户组；</li>\n<li>系统其他用户；</li>\n</ul>\n<p>理论上就是这样子了，我们去找个实际的例子来分析一下：</p>\n<blockquote>\n<p>例子：drwxr-xr-x  2 root  root   4096 Mar 11 04:11 alternatives</p>\n</blockquote>\n<p><img src=\"/blogimg/ls_detail.png\" alt=\"image\"></p>\n<p>但是有时候我们更改文件权限是由三位数字来表示的，例如”chmod 755 file”，这又是怎么回事呢？这里有一张表可以参考一下：</p>\n<p><img src=\"/blogimg/linux_umask.png\" alt=\"image\"></p>\n<p>把权限类型弄明白了，然后学习一下怎么更改Linux的文件权限的命令吧。</p>\n<p>chmod:用于改变文件的权限，SUID,SGID,SBIT等等</p>\n<ol>\n<li><p>chmod命令的格式</p>\n<blockquote>\n<p>chmod options mode file</p>\n</blockquote>\n<p>mode参数后边可以跟上八进制模式或符号模式来设置文件权限</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@VM_0_49_centos ~]<span class=\"comment\"># ls -la file_test #原本file_test的权限为644</span></span><br><span class=\"line\">-rw-r--r-- 1 root apache 0 5月  23 21:55 file_test</span><br><span class=\"line\">[root@VM_0_49_centos ~]<span class=\"comment\"># chmod 760 file_test </span></span><br><span class=\"line\">[root@VM_0_49_centos ~]<span class=\"comment\"># ls -la file_test #更改后为760</span></span><br><span class=\"line\">-rwxrw---- 1 root apache 0 5月  23 21:55 file_test</span><br></pre></td></tr></table></figure>\n</li>\n</ol>\n<p>chmod还有另外一种表示方式，较为复杂一些，命令格式如下：</p>\n<blockquote>\n<p>chmod [ugoa…][+-=][rwxXstugo…]</p>\n</blockquote>\n<p>这样虽然复杂一些，但是更容易理解不是吗？</p>\n<ul>\n<li>u  代表用户</li>\n<li>g  代表组</li>\n<li>o  代表拥有者</li>\n<li>a  代表上述所有</li>\n</ul>\n<p>接下来的符号表示你是想在现有权限的基础上增加权限（+），还是移除权限（-），还是将权限设置为后面的值（=）</p>\n<p>最后的符号代表你想赋予的权限。详细的有：</p>\n<ul>\n<li>X  如果对象是目录或者它已经有执行权限，则赋予执行权限</li>\n<li>s  运行时重新设置UID或GID</li>\n<li>t  保留文件或目录</li>\n<li>u  将权限设置为属主一样</li>\n<li>g  将权限设置为跟属组一样</li>\n<li>o  将权限设置为跟其他用户一样</li>\n</ul>\n<p>举个栗子：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ chmod o+r newfile <span class=\"comment\">#给文件所有者加上读权限</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"第二个字段表示该文件的链接数，包括硬链接和软链接\"><a href=\"#第二个字段表示该文件的链接数，包括硬链接和软链接\" class=\"headerlink\" title=\"第二个字段表示该文件的链接数，包括硬链接和软链接\"></a>第二个字段表示该文件的链接数，包括硬链接和软链接</h4><p>创建软链接：ln -s</p>\n<p>创建硬链接：ln</p>\n<h4 id=\"第三个字段表示该文件的所有者\"><a href=\"#第三个字段表示该文件的所有者\" class=\"headerlink\" title=\"第三个字段表示该文件的所有者\"></a>第三个字段表示该文件的所有者</h4><p>文件所有者可以通过chown命令来更改。命令格式：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$  chown [OPTION]... [OWNER][:[GROUP]] FILE...</span><br></pre></td></tr></table></figure>\n<p>当然，chown也可以同时更改文件所属的组。-R参数可以递归的更改子目录和文件的所属关系，-h参数可以改变文件的所有符号链接文件的所属关系。</p>\n<h4 id=\"第四个字段表示该文件所在的用户组\"><a href=\"#第四个字段表示该文件所在的用户组\" class=\"headerlink\" title=\"第四个字段表示该文件所在的用户组\"></a>第四个字段表示该文件所在的用户组</h4><p>文件所属的用户组可通过chgrp来进行更改。命令格式：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$   chgrp [OPTION]... GROUP FILE...</span><br></pre></td></tr></table></figure>\n<h4 id=\"第五个字段表示该文件的文件大小，单位字节\"><a href=\"#第五个字段表示该文件的文件大小，单位字节\" class=\"headerlink\" title=\"第五个字段表示该文件的文件大小，单位字节\"></a>第五个字段表示该文件的文件大小，单位字节</h4><h4 id=\"第六个字段表示文件的修改时间\"><a href=\"#第六个字段表示文件的修改时间\" class=\"headerlink\" title=\"第六个字段表示文件的修改时间\"></a>第六个字段表示文件的修改时间</h4><h4 id=\"第七个字段表示文件名\"><a href=\"#第七个字段表示文件名\" class=\"headerlink\" title=\"第七个字段表示文件名\"></a>第七个字段表示文件名</h4>","site":{"data":{}},"excerpt":"<p>在Linux系统中，一切皆为文件。当然文件权限的管理也相对复杂一些了。 Linux继续沿用了Unix管理文件权限的办法，其允许用户和组基于每个文件和目录的一组安全性设置来访问文件。但是对于使用“ls”命令查看Linux系统上的文件、目录和设备的权限时，输出的信息也没有弄得十分清楚，特地又重新学习了一下，免得遗忘，还是做下笔记。</p>","more":"<h3 id=\"理解ls命令的输出\"><a href=\"#理解ls命令的输出\" class=\"headerlink\" title=\"理解ls命令的输出\"></a>理解ls命令的输出</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@vultr etc]<span class=\"comment\"># ls -la</span></span><br><span class=\"line\">total 1660</span><br><span class=\"line\">drwxr-xr-x 85 root  root   4096 May 22 07:14 .</span><br><span class=\"line\">dr-xr-xr-x 18 root  root   4096 Dec 16 14:24 ..</span><br><span class=\"line\">-rw-r--r--  1 root  root     16 Nov 14  2016 adjtime</span><br><span class=\"line\">-rw-r--r--  1 root  root   1518 Jun  7  2013 aliases</span><br><span class=\"line\">-rw-r--r--  1 root  root  12288 Dec 27 09:14 aliases.db</span><br><span class=\"line\">drwxr-xr-x  2 root  root   4096 Mar 11 04:11 alternatives</span><br><span class=\"line\">-rw-r--r--  1 root  root     55 Nov  4  2016 asound.conf</span><br><span class=\"line\">drwxr-xr-x  2 root  root   4096 Dec 16 14:26 avahi</span><br><span class=\"line\">drwxr-xr-x  2 root  root   4096 May 22 07:31 bash_completion.d</span><br><span class=\"line\">-rw-r--r--  1 root  root   2853 Nov  5  2016 bashrc</span><br><span class=\"line\">drwxr-xr-x  2 root  root   4096 Mar  3 03:23 binfmt.d</span><br><span class=\"line\">-rw-r--r--  1 root  root     38 Nov 29 18:12 centos-release</span><br><span class=\"line\">-rw-r--r--  1 root  root     51 Nov 29 18:12 centos-release-upstream</span><br></pre></td></tr></table></figure>\n<p>上面是我查看/etc目录下的文件时的部分输出。其输出结果有七个字段，下面来具体解释一下具体含义：</p>\n<h4 id=\"第一个字段：drwxr-xr-x，这个字段描述的是文件和目录权限码。\"><a href=\"#第一个字段：drwxr-xr-x，这个字段描述的是文件和目录权限码。\" class=\"headerlink\" title=\"第一个字段：drwxr-xr-x，这个字段描述的是文件和目录权限码。\"></a>第一个字段：drwxr-xr-x，这个字段描述的是文件和目录权限码。</h4><p>这个字段的第一个字符代表的含义有以下几种情况：</p>\n<ul>\n<li>-代表文件；例子：-rw-r–r–  1 root  root   2853 Nov  5  2016 bashrc，表示bashrc是一个文件</li>\n<li>d代表目录；例子：drwxr-xr-x  2 root  root   4096 Mar  3 03:23 binfmt.d，表示binfmt.d是一个目录</li>\n<li>l代表链接；例子：lrwxrwxrwx  1 root root          25 Jan  7 13:32 initctl -&gt; /run/systemd/initctl/fifo，表示inictl是一个链接到/run/systemd/initctl/fifo的链接</li>\n<li>c代表字符设备；例子：crw–w—-  1 root tty       4,   6 Jan  7 13:32 tty6，表示tty6是一个字符设备</li>\n<li>b代表块设备；例子：brw-rw—-   1 root disk    253,   0 4月  13 19:25 vda，表示vda是一个块设备，它其实这台云服务器的硬盘。</li>\n<li>s代表socket文件；例子：srwxrwxrwx   1 mysql mysql        0 4月  13 19:25 mysql.sock，mysql.sock就是一个socket文件。</li>\n<li>p代表管道文件；</li>\n</ul>\n<p>之后的3组三字符的编码：rwxr-xr-x，表示了该文件的三重访问权限</p>\n<ul>\n<li>r代表对象是可读的；</li>\n<li>w代表对象是可写的；</li>\n<li>x代表对象是可执行的;</li>\n</ul>\n<p>如果没有某种权限，在该权限的位置会出现单破折线。这3组权限分别对应3个安全级别：</p>\n<ul>\n<li>对象的属主，也就是文件的所有者；</li>\n<li>对象的属组，也就是文件所有者所在的用户组；</li>\n<li>系统其他用户；</li>\n</ul>\n<p>理论上就是这样子了，我们去找个实际的例子来分析一下：</p>\n<blockquote>\n<p>例子：drwxr-xr-x  2 root  root   4096 Mar 11 04:11 alternatives</p>\n</blockquote>\n<p><img src=\"/blogimg/ls_detail.png\" alt=\"image\"></p>\n<p>但是有时候我们更改文件权限是由三位数字来表示的，例如”chmod 755 file”，这又是怎么回事呢？这里有一张表可以参考一下：</p>\n<p><img src=\"/blogimg/linux_umask.png\" alt=\"image\"></p>\n<p>把权限类型弄明白了，然后学习一下怎么更改Linux的文件权限的命令吧。</p>\n<p>chmod:用于改变文件的权限，SUID,SGID,SBIT等等</p>\n<ol>\n<li><p>chmod命令的格式</p>\n<blockquote>\n<p>chmod options mode file</p>\n</blockquote>\n<p>mode参数后边可以跟上八进制模式或符号模式来设置文件权限</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@VM_0_49_centos ~]<span class=\"comment\"># ls -la file_test #原本file_test的权限为644</span></span><br><span class=\"line\">-rw-r--r-- 1 root apache 0 5月  23 21:55 file_test</span><br><span class=\"line\">[root@VM_0_49_centos ~]<span class=\"comment\"># chmod 760 file_test </span></span><br><span class=\"line\">[root@VM_0_49_centos ~]<span class=\"comment\"># ls -la file_test #更改后为760</span></span><br><span class=\"line\">-rwxrw---- 1 root apache 0 5月  23 21:55 file_test</span><br></pre></td></tr></table></figure>\n</li>\n</ol>\n<p>chmod还有另外一种表示方式，较为复杂一些，命令格式如下：</p>\n<blockquote>\n<p>chmod [ugoa…][+-=][rwxXstugo…]</p>\n</blockquote>\n<p>这样虽然复杂一些，但是更容易理解不是吗？</p>\n<ul>\n<li>u  代表用户</li>\n<li>g  代表组</li>\n<li>o  代表拥有者</li>\n<li>a  代表上述所有</li>\n</ul>\n<p>接下来的符号表示你是想在现有权限的基础上增加权限（+），还是移除权限（-），还是将权限设置为后面的值（=）</p>\n<p>最后的符号代表你想赋予的权限。详细的有：</p>\n<ul>\n<li>X  如果对象是目录或者它已经有执行权限，则赋予执行权限</li>\n<li>s  运行时重新设置UID或GID</li>\n<li>t  保留文件或目录</li>\n<li>u  将权限设置为属主一样</li>\n<li>g  将权限设置为跟属组一样</li>\n<li>o  将权限设置为跟其他用户一样</li>\n</ul>\n<p>举个栗子：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ chmod o+r newfile <span class=\"comment\">#给文件所有者加上读权限</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"第二个字段表示该文件的链接数，包括硬链接和软链接\"><a href=\"#第二个字段表示该文件的链接数，包括硬链接和软链接\" class=\"headerlink\" title=\"第二个字段表示该文件的链接数，包括硬链接和软链接\"></a>第二个字段表示该文件的链接数，包括硬链接和软链接</h4><p>创建软链接：ln -s</p>\n<p>创建硬链接：ln</p>\n<h4 id=\"第三个字段表示该文件的所有者\"><a href=\"#第三个字段表示该文件的所有者\" class=\"headerlink\" title=\"第三个字段表示该文件的所有者\"></a>第三个字段表示该文件的所有者</h4><p>文件所有者可以通过chown命令来更改。命令格式：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$  chown [OPTION]... [OWNER][:[GROUP]] FILE...</span><br></pre></td></tr></table></figure>\n<p>当然，chown也可以同时更改文件所属的组。-R参数可以递归的更改子目录和文件的所属关系，-h参数可以改变文件的所有符号链接文件的所属关系。</p>\n<h4 id=\"第四个字段表示该文件所在的用户组\"><a href=\"#第四个字段表示该文件所在的用户组\" class=\"headerlink\" title=\"第四个字段表示该文件所在的用户组\"></a>第四个字段表示该文件所在的用户组</h4><p>文件所属的用户组可通过chgrp来进行更改。命令格式：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$   chgrp [OPTION]... GROUP FILE...</span><br></pre></td></tr></table></figure>\n<h4 id=\"第五个字段表示该文件的文件大小，单位字节\"><a href=\"#第五个字段表示该文件的文件大小，单位字节\" class=\"headerlink\" title=\"第五个字段表示该文件的文件大小，单位字节\"></a>第五个字段表示该文件的文件大小，单位字节</h4><h4 id=\"第六个字段表示文件的修改时间\"><a href=\"#第六个字段表示文件的修改时间\" class=\"headerlink\" title=\"第六个字段表示文件的修改时间\"></a>第六个字段表示文件的修改时间</h4><h4 id=\"第七个字段表示文件名\"><a href=\"#第七个字段表示文件名\" class=\"headerlink\" title=\"第七个字段表示文件名\"></a>第七个字段表示文件名</h4>"},{"title":"TPLINK系列路由器新版UI登录算法","date":"2017-06-02T08:18:32.000Z","_content":"\n因为某些原因需要用程序来向路由器提交宽带帐号和密码，进行拨号等操作。原本的TP系的路由器使用的是Basic认证，只要在http请求头中加上个Authtication头就可以通过认证了，某些型号也最多要求个Referer或者cookie，但是新版的UI登录的过程需要在浏览器端把密码加密后再发送到路由以获得一个token来通过认证。下面记录一下我的分析过程。\n\n<!-- more -->\n\n经过寻找，加密算法存在与jquery.js这个文件中（一直以为只是引用了jquery库，谁曾想关键代码都在这里边）。\n\n```javascript\n securityEncode: function(a, b, c) {\n            var e = \"\",\n            f, g, h, k, l = 187,\n            n = 187;\n            g = a.length;\n            h = b.length;\n            k = c.length;\n            f = g > h ? g: h;\n            for (var p = 0; p < f; p++) n = l = 187,\n            p >= g ? n = b.charCodeAt(p) : p >= h ? l = a.charCodeAt(p) : (l = a.charCodeAt(p), n = b.charCodeAt(p)),\n            e += c.charAt((l ^ n) % k);\n            return e\n        },\n        orgAuthPwd: function(a) {\n            return $.securityEncode(\"RDpbLfCPsJZ7fiv\", a, \"yLwVl0zKqws7LgKPRQ84Mdt708T1qQ3Ha7xv3H7NyU84p21BriUWBU43odz3iP4rBL3cD02KZciXTysVXiV8ngg6vL48rPJyAUw0HurW20xqxv9aYb4M9wK1Ae0wlro510qXeU07kV57fQMc8L6aLgMLwygtc0F10a0Dg70TOoouyFhdysuRMO51yY5ZlOZZLEal1h0t9YQW0Ko7oBwmCAHoic4HYbUyVeU3sfQ1xtXcPcf1aT303wAQhv66qzW\")\n        },\n```\n\n关键的加密过程的算法都在这里了。\n\n然后用C#重写一下：\n\n```c#\npublic  string securityEncode(string a, string b, string c)\n        {\n            string e = \"\";\n            int f, g, h, k, l = 187, n = 187;\n            g = a.Length;//短验证码的长度(固定为15)  \n            h = b.Length;//密码长度  \n            k = c.Length;//长验证码的长度(固定为255)  \n            if (g > h)//将短验证码字符串和密码字符串的长度进行比较  \n            {\n                f = g;\n            }\n            else\n            {\n                f = h;\n            }\n            //f取长的那个字符串的长度  \n            for (int p = 0; p < f; p++)\n            {\n                n = l = 187;\n                if (p >= g)\n                {\n                    n = b.Substring(p, 1).ToCharArray()[0];//n取密码中的以0开始的第p位字符  \n                }\n                else\n                {\n                    if (p >= h)\n                    {\n                        l = a.Substring(p, 1).ToCharArray()[0];//l取短验证码中的以0开始的第p位字符  \n                    }\n                    else\n                    {\n                        l = a.Substring(p, 1).ToCharArray()[0];//l取短验证码中的以0开始的第p位字符  \n                        n = b.Substring(p, 1).ToCharArray()[0];//n取密码中的以0开始的第p位字符  \n                    }\n                }\n                //每次计算出l和n的值之后对其取异或然后除以k(也就是除以255),  \n                //取长验证码中以0开始的第(l^n)%k位，然后拼接到字符串e的后面  \n                e += c.Substring((l ^ n) % k, 1);\n            }\n\n            return e;//返回加密后的密码  \n        }\n```\n\n利用C#模拟登录路由器：\n\n```c#\n public string Login886(string data,string url) {\n\n            string post_data = \"{\\\"method\\\":\\\"do\\\",\\\"login\\\":{\\\"password\\\":\\\"\"+data+\"\\\"}}\";\n            byte[] encode_data = System.Text.Encoding.UTF8.GetBytes(post_data);\n            \n\n            HttpWebRequest request = (HttpWebRequest)WebRequest.Create(url);\n            request.Method = \"POST\";\n            request.ContentLength = encode_data.Length;\n            request.Headers.Add(\"Origin\", url);\n            request.UserAgent = \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.96 Safari/537.36\";\n            request.ContentType = \"application/json; charset=UTF-8\";\n            request.Accept = \"application/json, text/javascript, */*; q=0.01\";\n            request.Headers.Add(\"X-Requested-With\", \"XMLHttpRequest\");\n            request.Referer = url;\n            request.Headers.Add(\"Accept-Encoding\", \"gzip, deflate\");\n            request.Headers.Add(\"Accept-Language\", \"zh-CN, zh; q=0.8,en; q=0.6,ja; q=0.4\");\n\n            //这句代码一定要加上，不然路由器不会响应登录请求\n            request.ServicePoint.Expect100Continue = false;\n            \n            Stream myRequestStream = request.GetRequestStream();\n           \n            myRequestStream.Write(encode_data, 0, encode_data.Length);\n            myRequestStream.Close();\n\n            HttpWebResponse response = (HttpWebResponse)request.GetResponse();\n\n            Stream myResponseStream = response.GetResponseStream();\n            StreamReader myStreamReader = new StreamReader(myResponseStream, Encoding.GetEncoding(\"utf-8\"));\n            string retString = myStreamReader.ReadToEnd();\n            myStreamReader.Close();\n            myResponseStream.Close();\n\n            return retString;\n           \n\n        }\n```\n\n完\n\n\n\n参考资料： http://blog.csdn.net/dev_here/article/details/51235324","source":"_posts/LoginNewTP.md","raw":"---\ntitle: TPLINK系列路由器新版UI登录算法\ncategories:\n  - Program\ntags:\n  - router\ndate: 2017-06-02 16:18:32\n---\n\n因为某些原因需要用程序来向路由器提交宽带帐号和密码，进行拨号等操作。原本的TP系的路由器使用的是Basic认证，只要在http请求头中加上个Authtication头就可以通过认证了，某些型号也最多要求个Referer或者cookie，但是新版的UI登录的过程需要在浏览器端把密码加密后再发送到路由以获得一个token来通过认证。下面记录一下我的分析过程。\n\n<!-- more -->\n\n经过寻找，加密算法存在与jquery.js这个文件中（一直以为只是引用了jquery库，谁曾想关键代码都在这里边）。\n\n```javascript\n securityEncode: function(a, b, c) {\n            var e = \"\",\n            f, g, h, k, l = 187,\n            n = 187;\n            g = a.length;\n            h = b.length;\n            k = c.length;\n            f = g > h ? g: h;\n            for (var p = 0; p < f; p++) n = l = 187,\n            p >= g ? n = b.charCodeAt(p) : p >= h ? l = a.charCodeAt(p) : (l = a.charCodeAt(p), n = b.charCodeAt(p)),\n            e += c.charAt((l ^ n) % k);\n            return e\n        },\n        orgAuthPwd: function(a) {\n            return $.securityEncode(\"RDpbLfCPsJZ7fiv\", a, \"yLwVl0zKqws7LgKPRQ84Mdt708T1qQ3Ha7xv3H7NyU84p21BriUWBU43odz3iP4rBL3cD02KZciXTysVXiV8ngg6vL48rPJyAUw0HurW20xqxv9aYb4M9wK1Ae0wlro510qXeU07kV57fQMc8L6aLgMLwygtc0F10a0Dg70TOoouyFhdysuRMO51yY5ZlOZZLEal1h0t9YQW0Ko7oBwmCAHoic4HYbUyVeU3sfQ1xtXcPcf1aT303wAQhv66qzW\")\n        },\n```\n\n关键的加密过程的算法都在这里了。\n\n然后用C#重写一下：\n\n```c#\npublic  string securityEncode(string a, string b, string c)\n        {\n            string e = \"\";\n            int f, g, h, k, l = 187, n = 187;\n            g = a.Length;//短验证码的长度(固定为15)  \n            h = b.Length;//密码长度  \n            k = c.Length;//长验证码的长度(固定为255)  \n            if (g > h)//将短验证码字符串和密码字符串的长度进行比较  \n            {\n                f = g;\n            }\n            else\n            {\n                f = h;\n            }\n            //f取长的那个字符串的长度  \n            for (int p = 0; p < f; p++)\n            {\n                n = l = 187;\n                if (p >= g)\n                {\n                    n = b.Substring(p, 1).ToCharArray()[0];//n取密码中的以0开始的第p位字符  \n                }\n                else\n                {\n                    if (p >= h)\n                    {\n                        l = a.Substring(p, 1).ToCharArray()[0];//l取短验证码中的以0开始的第p位字符  \n                    }\n                    else\n                    {\n                        l = a.Substring(p, 1).ToCharArray()[0];//l取短验证码中的以0开始的第p位字符  \n                        n = b.Substring(p, 1).ToCharArray()[0];//n取密码中的以0开始的第p位字符  \n                    }\n                }\n                //每次计算出l和n的值之后对其取异或然后除以k(也就是除以255),  \n                //取长验证码中以0开始的第(l^n)%k位，然后拼接到字符串e的后面  \n                e += c.Substring((l ^ n) % k, 1);\n            }\n\n            return e;//返回加密后的密码  \n        }\n```\n\n利用C#模拟登录路由器：\n\n```c#\n public string Login886(string data,string url) {\n\n            string post_data = \"{\\\"method\\\":\\\"do\\\",\\\"login\\\":{\\\"password\\\":\\\"\"+data+\"\\\"}}\";\n            byte[] encode_data = System.Text.Encoding.UTF8.GetBytes(post_data);\n            \n\n            HttpWebRequest request = (HttpWebRequest)WebRequest.Create(url);\n            request.Method = \"POST\";\n            request.ContentLength = encode_data.Length;\n            request.Headers.Add(\"Origin\", url);\n            request.UserAgent = \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.96 Safari/537.36\";\n            request.ContentType = \"application/json; charset=UTF-8\";\n            request.Accept = \"application/json, text/javascript, */*; q=0.01\";\n            request.Headers.Add(\"X-Requested-With\", \"XMLHttpRequest\");\n            request.Referer = url;\n            request.Headers.Add(\"Accept-Encoding\", \"gzip, deflate\");\n            request.Headers.Add(\"Accept-Language\", \"zh-CN, zh; q=0.8,en; q=0.6,ja; q=0.4\");\n\n            //这句代码一定要加上，不然路由器不会响应登录请求\n            request.ServicePoint.Expect100Continue = false;\n            \n            Stream myRequestStream = request.GetRequestStream();\n           \n            myRequestStream.Write(encode_data, 0, encode_data.Length);\n            myRequestStream.Close();\n\n            HttpWebResponse response = (HttpWebResponse)request.GetResponse();\n\n            Stream myResponseStream = response.GetResponseStream();\n            StreamReader myStreamReader = new StreamReader(myResponseStream, Encoding.GetEncoding(\"utf-8\"));\n            string retString = myStreamReader.ReadToEnd();\n            myStreamReader.Close();\n            myResponseStream.Close();\n\n            return retString;\n           \n\n        }\n```\n\n完\n\n\n\n参考资料： http://blog.csdn.net/dev_here/article/details/51235324","slug":"LoginNewTP","published":1,"updated":"2017-12-04T07:27:28.759Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjeqig1n0002mlgqadba7buz7","content":"<p>因为某些原因需要用程序来向路由器提交宽带帐号和密码，进行拨号等操作。原本的TP系的路由器使用的是Basic认证，只要在http请求头中加上个Authtication头就可以通过认证了，某些型号也最多要求个Referer或者cookie，但是新版的UI登录的过程需要在浏览器端把密码加密后再发送到路由以获得一个token来通过认证。下面记录一下我的分析过程。</p>\n<a id=\"more\"></a>\n<p>经过寻找，加密算法存在与jquery.js这个文件中（一直以为只是引用了jquery库，谁曾想关键代码都在这里边）。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">securityEncode: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">a, b, c</span>) </span>&#123;</span><br><span class=\"line\">           <span class=\"keyword\">var</span> e = <span class=\"string\">\"\"</span>,</span><br><span class=\"line\">           f, g, h, k, l = <span class=\"number\">187</span>,</span><br><span class=\"line\">           n = <span class=\"number\">187</span>;</span><br><span class=\"line\">           g = a.length;</span><br><span class=\"line\">           h = b.length;</span><br><span class=\"line\">           k = c.length;</span><br><span class=\"line\">           f = g &gt; h ? g: h;</span><br><span class=\"line\">           <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> p = <span class=\"number\">0</span>; p &lt; f; p++) n = l = <span class=\"number\">187</span>,</span><br><span class=\"line\">           p &gt;= g ? n = b.charCodeAt(p) : p &gt;= h ? l = a.charCodeAt(p) : (l = a.charCodeAt(p), n = b.charCodeAt(p)),</span><br><span class=\"line\">           e += c.charAt((l ^ n) % k);</span><br><span class=\"line\">           <span class=\"keyword\">return</span> e</span><br><span class=\"line\">       &#125;,</span><br><span class=\"line\">       orgAuthPwd: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">a</span>) </span>&#123;</span><br><span class=\"line\">           <span class=\"keyword\">return</span> $.securityEncode(<span class=\"string\">\"RDpbLfCPsJZ7fiv\"</span>, a, <span class=\"string\">\"yLwVl0zKqws7LgKPRQ84Mdt708T1qQ3Ha7xv3H7NyU84p21BriUWBU43odz3iP4rBL3cD02KZciXTysVXiV8ngg6vL48rPJyAUw0HurW20xqxv9aYb4M9wK1Ae0wlro510qXeU07kV57fQMc8L6aLgMLwygtc0F10a0Dg70TOoouyFhdysuRMO51yY5ZlOZZLEal1h0t9YQW0Ko7oBwmCAHoic4HYbUyVeU3sfQ1xtXcPcf1aT303wAQhv66qzW\"</span>)</span><br><span class=\"line\">       &#125;,</span><br></pre></td></tr></table></figure>\n<p>关键的加密过程的算法都在这里了。</p>\n<p>然后用C#重写一下：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public  string securityEncode(string a, string b, string c)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            string e = &quot;&quot;;</span><br><span class=\"line\">            int f, g, h, k, l = 187, n = 187;</span><br><span class=\"line\">            g = a.Length;//短验证码的长度(固定为15)  </span><br><span class=\"line\">            h = b.Length;//密码长度  </span><br><span class=\"line\">            k = c.Length;//长验证码的长度(固定为255)  </span><br><span class=\"line\">            if (g &gt; h)//将短验证码字符串和密码字符串的长度进行比较  </span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                f = g;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            else</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                f = h;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            //f取长的那个字符串的长度  </span><br><span class=\"line\">            for (int p = 0; p &lt; f; p++)</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                n = l = 187;</span><br><span class=\"line\">                if (p &gt;= g)</span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    n = b.Substring(p, 1).ToCharArray()[0];//n取密码中的以0开始的第p位字符  </span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                else</span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    if (p &gt;= h)</span><br><span class=\"line\">                    &#123;</span><br><span class=\"line\">                        l = a.Substring(p, 1).ToCharArray()[0];//l取短验证码中的以0开始的第p位字符  </span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                    else</span><br><span class=\"line\">                    &#123;</span><br><span class=\"line\">                        l = a.Substring(p, 1).ToCharArray()[0];//l取短验证码中的以0开始的第p位字符  </span><br><span class=\"line\">                        n = b.Substring(p, 1).ToCharArray()[0];//n取密码中的以0开始的第p位字符  </span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                //每次计算出l和n的值之后对其取异或然后除以k(也就是除以255),  </span><br><span class=\"line\">                //取长验证码中以0开始的第(l^n)%k位，然后拼接到字符串e的后面  </span><br><span class=\"line\">                e += c.Substring((l ^ n) % k, 1);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            return e;//返回加密后的密码  </span><br><span class=\"line\">        &#125;</span><br></pre></td></tr></table></figure>\n<p>利用C#模拟登录路由器：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public string Login886(string data,string url) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">           string post_data = &quot;&#123;\\&quot;method\\&quot;:\\&quot;do\\&quot;,\\&quot;login\\&quot;:&#123;\\&quot;password\\&quot;:\\&quot;&quot;+data+&quot;\\&quot;&#125;&#125;&quot;;</span><br><span class=\"line\">           byte[] encode_data = System.Text.Encoding.UTF8.GetBytes(post_data);</span><br><span class=\"line\">           </span><br><span class=\"line\"></span><br><span class=\"line\">           HttpWebRequest request = (HttpWebRequest)WebRequest.Create(url);</span><br><span class=\"line\">           request.Method = &quot;POST&quot;;</span><br><span class=\"line\">           request.ContentLength = encode_data.Length;</span><br><span class=\"line\">           request.Headers.Add(&quot;Origin&quot;, url);</span><br><span class=\"line\">           request.UserAgent = &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.96 Safari/537.36&quot;;</span><br><span class=\"line\">           request.ContentType = &quot;application/json; charset=UTF-8&quot;;</span><br><span class=\"line\">           request.Accept = &quot;application/json, text/javascript, */*; q=0.01&quot;;</span><br><span class=\"line\">           request.Headers.Add(&quot;X-Requested-With&quot;, &quot;XMLHttpRequest&quot;);</span><br><span class=\"line\">           request.Referer = url;</span><br><span class=\"line\">           request.Headers.Add(&quot;Accept-Encoding&quot;, &quot;gzip, deflate&quot;);</span><br><span class=\"line\">           request.Headers.Add(&quot;Accept-Language&quot;, &quot;zh-CN, zh; q=0.8,en; q=0.6,ja; q=0.4&quot;);</span><br><span class=\"line\"></span><br><span class=\"line\">           //这句代码一定要加上，不然路由器不会响应登录请求</span><br><span class=\"line\">           request.ServicePoint.Expect100Continue = false;</span><br><span class=\"line\">           </span><br><span class=\"line\">           Stream myRequestStream = request.GetRequestStream();</span><br><span class=\"line\">          </span><br><span class=\"line\">           myRequestStream.Write(encode_data, 0, encode_data.Length);</span><br><span class=\"line\">           myRequestStream.Close();</span><br><span class=\"line\"></span><br><span class=\"line\">           HttpWebResponse response = (HttpWebResponse)request.GetResponse();</span><br><span class=\"line\"></span><br><span class=\"line\">           Stream myResponseStream = response.GetResponseStream();</span><br><span class=\"line\">           StreamReader myStreamReader = new StreamReader(myResponseStream, Encoding.GetEncoding(&quot;utf-8&quot;));</span><br><span class=\"line\">           string retString = myStreamReader.ReadToEnd();</span><br><span class=\"line\">           myStreamReader.Close();</span><br><span class=\"line\">           myResponseStream.Close();</span><br><span class=\"line\"></span><br><span class=\"line\">           return retString;</span><br><span class=\"line\">          </span><br><span class=\"line\"></span><br><span class=\"line\">       &#125;</span><br></pre></td></tr></table></figure>\n<p>完</p>\n<p>参考资料： <a href=\"http://blog.csdn.net/dev_here/article/details/51235324\" target=\"_blank\" rel=\"noopener\">http://blog.csdn.net/dev_here/article/details/51235324</a></p>\n","site":{"data":{}},"excerpt":"<p>因为某些原因需要用程序来向路由器提交宽带帐号和密码，进行拨号等操作。原本的TP系的路由器使用的是Basic认证，只要在http请求头中加上个Authtication头就可以通过认证了，某些型号也最多要求个Referer或者cookie，但是新版的UI登录的过程需要在浏览器端把密码加密后再发送到路由以获得一个token来通过认证。下面记录一下我的分析过程。</p>","more":"<p>经过寻找，加密算法存在与jquery.js这个文件中（一直以为只是引用了jquery库，谁曾想关键代码都在这里边）。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">securityEncode: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">a, b, c</span>) </span>&#123;</span><br><span class=\"line\">           <span class=\"keyword\">var</span> e = <span class=\"string\">\"\"</span>,</span><br><span class=\"line\">           f, g, h, k, l = <span class=\"number\">187</span>,</span><br><span class=\"line\">           n = <span class=\"number\">187</span>;</span><br><span class=\"line\">           g = a.length;</span><br><span class=\"line\">           h = b.length;</span><br><span class=\"line\">           k = c.length;</span><br><span class=\"line\">           f = g &gt; h ? g: h;</span><br><span class=\"line\">           <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> p = <span class=\"number\">0</span>; p &lt; f; p++) n = l = <span class=\"number\">187</span>,</span><br><span class=\"line\">           p &gt;= g ? n = b.charCodeAt(p) : p &gt;= h ? l = a.charCodeAt(p) : (l = a.charCodeAt(p), n = b.charCodeAt(p)),</span><br><span class=\"line\">           e += c.charAt((l ^ n) % k);</span><br><span class=\"line\">           <span class=\"keyword\">return</span> e</span><br><span class=\"line\">       &#125;,</span><br><span class=\"line\">       orgAuthPwd: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">a</span>) </span>&#123;</span><br><span class=\"line\">           <span class=\"keyword\">return</span> $.securityEncode(<span class=\"string\">\"RDpbLfCPsJZ7fiv\"</span>, a, <span class=\"string\">\"yLwVl0zKqws7LgKPRQ84Mdt708T1qQ3Ha7xv3H7NyU84p21BriUWBU43odz3iP4rBL3cD02KZciXTysVXiV8ngg6vL48rPJyAUw0HurW20xqxv9aYb4M9wK1Ae0wlro510qXeU07kV57fQMc8L6aLgMLwygtc0F10a0Dg70TOoouyFhdysuRMO51yY5ZlOZZLEal1h0t9YQW0Ko7oBwmCAHoic4HYbUyVeU3sfQ1xtXcPcf1aT303wAQhv66qzW\"</span>)</span><br><span class=\"line\">       &#125;,</span><br></pre></td></tr></table></figure>\n<p>关键的加密过程的算法都在这里了。</p>\n<p>然后用C#重写一下：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public  string securityEncode(string a, string b, string c)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            string e = &quot;&quot;;</span><br><span class=\"line\">            int f, g, h, k, l = 187, n = 187;</span><br><span class=\"line\">            g = a.Length;//短验证码的长度(固定为15)  </span><br><span class=\"line\">            h = b.Length;//密码长度  </span><br><span class=\"line\">            k = c.Length;//长验证码的长度(固定为255)  </span><br><span class=\"line\">            if (g &gt; h)//将短验证码字符串和密码字符串的长度进行比较  </span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                f = g;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            else</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                f = h;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            //f取长的那个字符串的长度  </span><br><span class=\"line\">            for (int p = 0; p &lt; f; p++)</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                n = l = 187;</span><br><span class=\"line\">                if (p &gt;= g)</span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    n = b.Substring(p, 1).ToCharArray()[0];//n取密码中的以0开始的第p位字符  </span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                else</span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    if (p &gt;= h)</span><br><span class=\"line\">                    &#123;</span><br><span class=\"line\">                        l = a.Substring(p, 1).ToCharArray()[0];//l取短验证码中的以0开始的第p位字符  </span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                    else</span><br><span class=\"line\">                    &#123;</span><br><span class=\"line\">                        l = a.Substring(p, 1).ToCharArray()[0];//l取短验证码中的以0开始的第p位字符  </span><br><span class=\"line\">                        n = b.Substring(p, 1).ToCharArray()[0];//n取密码中的以0开始的第p位字符  </span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                //每次计算出l和n的值之后对其取异或然后除以k(也就是除以255),  </span><br><span class=\"line\">                //取长验证码中以0开始的第(l^n)%k位，然后拼接到字符串e的后面  </span><br><span class=\"line\">                e += c.Substring((l ^ n) % k, 1);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            return e;//返回加密后的密码  </span><br><span class=\"line\">        &#125;</span><br></pre></td></tr></table></figure>\n<p>利用C#模拟登录路由器：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public string Login886(string data,string url) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">           string post_data = &quot;&#123;\\&quot;method\\&quot;:\\&quot;do\\&quot;,\\&quot;login\\&quot;:&#123;\\&quot;password\\&quot;:\\&quot;&quot;+data+&quot;\\&quot;&#125;&#125;&quot;;</span><br><span class=\"line\">           byte[] encode_data = System.Text.Encoding.UTF8.GetBytes(post_data);</span><br><span class=\"line\">           </span><br><span class=\"line\"></span><br><span class=\"line\">           HttpWebRequest request = (HttpWebRequest)WebRequest.Create(url);</span><br><span class=\"line\">           request.Method = &quot;POST&quot;;</span><br><span class=\"line\">           request.ContentLength = encode_data.Length;</span><br><span class=\"line\">           request.Headers.Add(&quot;Origin&quot;, url);</span><br><span class=\"line\">           request.UserAgent = &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.96 Safari/537.36&quot;;</span><br><span class=\"line\">           request.ContentType = &quot;application/json; charset=UTF-8&quot;;</span><br><span class=\"line\">           request.Accept = &quot;application/json, text/javascript, */*; q=0.01&quot;;</span><br><span class=\"line\">           request.Headers.Add(&quot;X-Requested-With&quot;, &quot;XMLHttpRequest&quot;);</span><br><span class=\"line\">           request.Referer = url;</span><br><span class=\"line\">           request.Headers.Add(&quot;Accept-Encoding&quot;, &quot;gzip, deflate&quot;);</span><br><span class=\"line\">           request.Headers.Add(&quot;Accept-Language&quot;, &quot;zh-CN, zh; q=0.8,en; q=0.6,ja; q=0.4&quot;);</span><br><span class=\"line\"></span><br><span class=\"line\">           //这句代码一定要加上，不然路由器不会响应登录请求</span><br><span class=\"line\">           request.ServicePoint.Expect100Continue = false;</span><br><span class=\"line\">           </span><br><span class=\"line\">           Stream myRequestStream = request.GetRequestStream();</span><br><span class=\"line\">          </span><br><span class=\"line\">           myRequestStream.Write(encode_data, 0, encode_data.Length);</span><br><span class=\"line\">           myRequestStream.Close();</span><br><span class=\"line\"></span><br><span class=\"line\">           HttpWebResponse response = (HttpWebResponse)request.GetResponse();</span><br><span class=\"line\"></span><br><span class=\"line\">           Stream myResponseStream = response.GetResponseStream();</span><br><span class=\"line\">           StreamReader myStreamReader = new StreamReader(myResponseStream, Encoding.GetEncoding(&quot;utf-8&quot;));</span><br><span class=\"line\">           string retString = myStreamReader.ReadToEnd();</span><br><span class=\"line\">           myStreamReader.Close();</span><br><span class=\"line\">           myResponseStream.Close();</span><br><span class=\"line\"></span><br><span class=\"line\">           return retString;</span><br><span class=\"line\">          </span><br><span class=\"line\"></span><br><span class=\"line\">       &#125;</span><br></pre></td></tr></table></figure>\n<p>完</p>\n<p>参考资料： <a href=\"http://blog.csdn.net/dev_here/article/details/51235324\" target=\"_blank\" rel=\"noopener\">http://blog.csdn.net/dev_here/article/details/51235324</a></p>"},{"title":"设计模式学习之观察者模式","date":"2016-12-16T07:57:06.000Z","_content":"\n之前在学习java的过程中，总提到总会遇到“设计模式”，诸如工厂模式了，观察者模式了，单例模式了....看起来云里雾里的。趁最近空闲时间多了些，来把这些设计模式都熟悉一下。我看的书的《Head First 设计模式 》，这个系列的书看起来还蛮有意思的。不闲扯了，这篇博文是我学习“观察者模式”的笔记。\n\n<!-- more -->\n\n观察者模式有时也被称作“发布-订阅”模式。这种模式有点像我们去订阅报纸，我们是订阅者，报社是发布者，每当报社出版了新的报纸，我们就能够收到最新的报纸了。  在GUI编程中，控件的事件监听算是观察者模式的具体应用了吧。  \n\n> 观察者模式定义了对象之间的一对多依赖，这样一来，当一个对象发生改变时，它的所有依赖者都会收到通知并自动更新。\n\n-----摘自《Head First设计模式》  \n\n那么我们具体来实现一种观察者模式的应用，这样看起来就更加直观了。\n\n观察者模式的最基本的类图如下：  \n\n![image](/blogimg/ObserverUML.bmp)\n\n> Subject接口：定义的主题接口，对象使用此接口注册为观察者，或者把自己从观察者之中删除\n\n> Observer接口：所有潜在的观察者必须实现观察者接口，这个接口只有update方法，当主题状态改变时调用\n\n> ConcreteSubject类：一个具体的主题，实现了Subject接口，除了注册和撤销方法，该主题还实现了notifyObserver()方法，用来在状态改变时，通知所有的观察者\n\n> ConcreteObserver类：具体的观察者，它实现了Observer接口，观察者必须注册具体的Subject，才能够就收到更新事件的通知\n\n  接着来具体实现一下书上提供的气象站的例子：\n\n  Subject.java\n\n```java\n  public interface Subject{\n      public void registerObserver(Observer o); //注册观察者\n      public void removeObserver(Observer o); //移除观察者\n      public void notifyObservers(); //当有更新事件发生时，通知观察者\n  }\n```\n\n  Observer.java\n\n```java\n  public interface Observer{\n      public void update(float temp, float humidity, float pressure);\n      //所有的观察者都必须实现update()方法，以实现观察者接口\n  }\n```\n\n  WetherData.java\n\n```java\n  public class WetherData implements Subject { //需要实现Subject接口\n\n      private ArrayList observers; //用于存放注册的所有观察者对象\n      private float tempature;\n      private float humidity;\n      private float pressure;\n\n      public WetherData(){\n          observers = new ArrayList();\n      }\n      @Override\n      public void registerObserver(Observer o) {\n          this.observers.add(o);\n      }\n\n      @Override\n      public void removeObserver(Observer o) {\n              int i = observers.indexOf(o);\n              if(i > 0){\n                  observers.remove(i);\n              }\n      }\n\n      @Override\n      public void notifyObservers() {\n        /*当有更新事件发生时，调用此方法。在这里，它会去挨个通知注册的观察者，让他们执行update()方法更新数据*/\n          for(int i = 0; i < observers.size(); i++){\n              Observer observer=(Observer)observers.get(i);\n              observer.update(tempature, humidity, pressure);\n          }\n      }\n\n      public void measurementsChanged(){\n        //接收更新事件通知，然后告诉所有的注册的观察者\n          notifyObservers();\n      }\n\n      public void setMeasurements(float tempature, float humidity, float pressure){\n  \t\t//当有的气象观测数据到来，调用此方法\n          this.tempature = tempature;\n          this.humidity = humidity;\n          this.pressure = pressure;\n       \n          measurementsChanged(); //发出通知\n      }\n  }\n\n```\n\n  CurrentConditionDisplay.java\n\n```java\n  //这是气象数据显示的公告板，它实现了Observer接口，成为了观察者\n  public class CurrentConditionDisplay implements Observer, DisplayElement {\n\n      private float temprature;\n      private float humidity;\n      private Subject weatherData;\n\n      public CurrentConditionDisplay(Subject weatherData){\n\n          this.weatherData = weatherData;\n        //注册成为wetherData的观察者，随时准备接收新数据\n          weatherData.registerObserver(this);\n      }\n      @Override\n      public void update(float temp, float humidity, float pressure) {\n  \t\t\t//取得来自Subject的数据，并暂存起来用于稍后的显示\n              this.temprature = temp;\n              this.humidity = humidity;\n              display();\n      }\n\n      @Override\n      public void display() {\n        //显示数据\n          System.out.println(\"Current conditions:\" + temprature + \"F degree and\" + humidity + \"% humidity\");\n      }\n  }\n\n```\n\n  DisplayElement.java\n\n```java\n  public interface DisplayElement{\n      public void display();\n  }\n```\n\n  ObserverMain.java\n\n```java\n  public class ObserverMain {\n\n     public static void main(String[] args){\n\n         WetherData wetherData = new WetherData();\n\n  \tCurrentConditionDisplay currentConditionDisplay = new currentConditionDisplay(wetherData);\n\n         wetherData.setMeasurements(80,65,30.1f);\n         wetherData.setMeasurements(40,30,10.9f);\n         wetherData.setMeasurements(10,20,28.3f);\n\n     }\n\n  }\n```\n\n  编译，执行看下结果呢。\n\n  ```\n  F:/java ObserverMain\n  Current conditions:80.0F degree and65.0% humidity\n  Current conditions:40.0F degree and30.0% humidity\n  Current conditions:10.0F degree and20.0% humidity\n  ```\n\n  Nice，咱们的气象站一收到新的数据，公告板就及时的将数据显示了出来。\n\n","source":"_posts/Observer-Notes.md","raw":"---\ntitle: 设计模式学习之观察者模式\ndate: 2016-12-16 15:57:06\ncategories:\n- Program\ntags:\n- java\n- 设计模式\n- 观察者模式\n---\n\n之前在学习java的过程中，总提到总会遇到“设计模式”，诸如工厂模式了，观察者模式了，单例模式了....看起来云里雾里的。趁最近空闲时间多了些，来把这些设计模式都熟悉一下。我看的书的《Head First 设计模式 》，这个系列的书看起来还蛮有意思的。不闲扯了，这篇博文是我学习“观察者模式”的笔记。\n\n<!-- more -->\n\n观察者模式有时也被称作“发布-订阅”模式。这种模式有点像我们去订阅报纸，我们是订阅者，报社是发布者，每当报社出版了新的报纸，我们就能够收到最新的报纸了。  在GUI编程中，控件的事件监听算是观察者模式的具体应用了吧。  \n\n> 观察者模式定义了对象之间的一对多依赖，这样一来，当一个对象发生改变时，它的所有依赖者都会收到通知并自动更新。\n\n-----摘自《Head First设计模式》  \n\n那么我们具体来实现一种观察者模式的应用，这样看起来就更加直观了。\n\n观察者模式的最基本的类图如下：  \n\n![image](/blogimg/ObserverUML.bmp)\n\n> Subject接口：定义的主题接口，对象使用此接口注册为观察者，或者把自己从观察者之中删除\n\n> Observer接口：所有潜在的观察者必须实现观察者接口，这个接口只有update方法，当主题状态改变时调用\n\n> ConcreteSubject类：一个具体的主题，实现了Subject接口，除了注册和撤销方法，该主题还实现了notifyObserver()方法，用来在状态改变时，通知所有的观察者\n\n> ConcreteObserver类：具体的观察者，它实现了Observer接口，观察者必须注册具体的Subject，才能够就收到更新事件的通知\n\n  接着来具体实现一下书上提供的气象站的例子：\n\n  Subject.java\n\n```java\n  public interface Subject{\n      public void registerObserver(Observer o); //注册观察者\n      public void removeObserver(Observer o); //移除观察者\n      public void notifyObservers(); //当有更新事件发生时，通知观察者\n  }\n```\n\n  Observer.java\n\n```java\n  public interface Observer{\n      public void update(float temp, float humidity, float pressure);\n      //所有的观察者都必须实现update()方法，以实现观察者接口\n  }\n```\n\n  WetherData.java\n\n```java\n  public class WetherData implements Subject { //需要实现Subject接口\n\n      private ArrayList observers; //用于存放注册的所有观察者对象\n      private float tempature;\n      private float humidity;\n      private float pressure;\n\n      public WetherData(){\n          observers = new ArrayList();\n      }\n      @Override\n      public void registerObserver(Observer o) {\n          this.observers.add(o);\n      }\n\n      @Override\n      public void removeObserver(Observer o) {\n              int i = observers.indexOf(o);\n              if(i > 0){\n                  observers.remove(i);\n              }\n      }\n\n      @Override\n      public void notifyObservers() {\n        /*当有更新事件发生时，调用此方法。在这里，它会去挨个通知注册的观察者，让他们执行update()方法更新数据*/\n          for(int i = 0; i < observers.size(); i++){\n              Observer observer=(Observer)observers.get(i);\n              observer.update(tempature, humidity, pressure);\n          }\n      }\n\n      public void measurementsChanged(){\n        //接收更新事件通知，然后告诉所有的注册的观察者\n          notifyObservers();\n      }\n\n      public void setMeasurements(float tempature, float humidity, float pressure){\n  \t\t//当有的气象观测数据到来，调用此方法\n          this.tempature = tempature;\n          this.humidity = humidity;\n          this.pressure = pressure;\n       \n          measurementsChanged(); //发出通知\n      }\n  }\n\n```\n\n  CurrentConditionDisplay.java\n\n```java\n  //这是气象数据显示的公告板，它实现了Observer接口，成为了观察者\n  public class CurrentConditionDisplay implements Observer, DisplayElement {\n\n      private float temprature;\n      private float humidity;\n      private Subject weatherData;\n\n      public CurrentConditionDisplay(Subject weatherData){\n\n          this.weatherData = weatherData;\n        //注册成为wetherData的观察者，随时准备接收新数据\n          weatherData.registerObserver(this);\n      }\n      @Override\n      public void update(float temp, float humidity, float pressure) {\n  \t\t\t//取得来自Subject的数据，并暂存起来用于稍后的显示\n              this.temprature = temp;\n              this.humidity = humidity;\n              display();\n      }\n\n      @Override\n      public void display() {\n        //显示数据\n          System.out.println(\"Current conditions:\" + temprature + \"F degree and\" + humidity + \"% humidity\");\n      }\n  }\n\n```\n\n  DisplayElement.java\n\n```java\n  public interface DisplayElement{\n      public void display();\n  }\n```\n\n  ObserverMain.java\n\n```java\n  public class ObserverMain {\n\n     public static void main(String[] args){\n\n         WetherData wetherData = new WetherData();\n\n  \tCurrentConditionDisplay currentConditionDisplay = new currentConditionDisplay(wetherData);\n\n         wetherData.setMeasurements(80,65,30.1f);\n         wetherData.setMeasurements(40,30,10.9f);\n         wetherData.setMeasurements(10,20,28.3f);\n\n     }\n\n  }\n```\n\n  编译，执行看下结果呢。\n\n  ```\n  F:/java ObserverMain\n  Current conditions:80.0F degree and65.0% humidity\n  Current conditions:40.0F degree and30.0% humidity\n  Current conditions:10.0F degree and20.0% humidity\n  ```\n\n  Nice，咱们的气象站一收到新的数据，公告板就及时的将数据显示了出来。\n\n","slug":"Observer-Notes","published":1,"updated":"2017-12-04T07:27:28.759Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjeqig1n3002plgqazuwwfzqq","content":"<p>之前在学习java的过程中，总提到总会遇到“设计模式”，诸如工厂模式了，观察者模式了，单例模式了….看起来云里雾里的。趁最近空闲时间多了些，来把这些设计模式都熟悉一下。我看的书的《Head First 设计模式 》，这个系列的书看起来还蛮有意思的。不闲扯了，这篇博文是我学习“观察者模式”的笔记。</p>\n<a id=\"more\"></a>\n<p>观察者模式有时也被称作“发布-订阅”模式。这种模式有点像我们去订阅报纸，我们是订阅者，报社是发布者，每当报社出版了新的报纸，我们就能够收到最新的报纸了。  在GUI编程中，控件的事件监听算是观察者模式的具体应用了吧。  </p>\n<blockquote>\n<p>观察者模式定义了对象之间的一对多依赖，这样一来，当一个对象发生改变时，它的所有依赖者都会收到通知并自动更新。</p>\n</blockquote>\n<p>—–摘自《Head First设计模式》  </p>\n<p>那么我们具体来实现一种观察者模式的应用，这样看起来就更加直观了。</p>\n<p>观察者模式的最基本的类图如下：  </p>\n<p><img src=\"/blogimg/ObserverUML.bmp\" alt=\"image\"></p>\n<blockquote>\n<p>Subject接口：定义的主题接口，对象使用此接口注册为观察者，或者把自己从观察者之中删除</p>\n<p>Observer接口：所有潜在的观察者必须实现观察者接口，这个接口只有update方法，当主题状态改变时调用</p>\n<p>ConcreteSubject类：一个具体的主题，实现了Subject接口，除了注册和撤销方法，该主题还实现了notifyObserver()方法，用来在状态改变时，通知所有的观察者</p>\n<p>ConcreteObserver类：具体的观察者，它实现了Observer接口，观察者必须注册具体的Subject，才能够就收到更新事件的通知</p>\n</blockquote>\n<p>  接着来具体实现一下书上提供的气象站的例子：</p>\n<p>  Subject.java</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">Subject</span></span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">registerObserver</span><span class=\"params\">(Observer o)</span></span>; <span class=\"comment\">//注册观察者</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">removeObserver</span><span class=\"params\">(Observer o)</span></span>; <span class=\"comment\">//移除观察者</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">notifyObservers</span><span class=\"params\">()</span></span>; <span class=\"comment\">//当有更新事件发生时，通知观察者</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>  Observer.java</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">Observer</span></span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">update</span><span class=\"params\">(<span class=\"keyword\">float</span> temp, <span class=\"keyword\">float</span> humidity, <span class=\"keyword\">float</span> pressure)</span></span>;</span><br><span class=\"line\">    <span class=\"comment\">//所有的观察者都必须实现update()方法，以实现观察者接口</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>  WetherData.java</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">WetherData</span> <span class=\"keyword\">implements</span> <span class=\"title\">Subject</span> </span>&#123; <span class=\"comment\">//需要实现Subject接口</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ArrayList observers; <span class=\"comment\">//用于存放注册的所有观察者对象</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">float</span> tempature;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">float</span> humidity;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">float</span> pressure;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">WetherData</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        observers = <span class=\"keyword\">new</span> ArrayList();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">registerObserver</span><span class=\"params\">(Observer o)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.observers.add(o);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">removeObserver</span><span class=\"params\">(Observer o)</span> </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">int</span> i = observers.indexOf(o);</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(i &gt; <span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">                observers.remove(i);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">notifyObservers</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">      <span class=\"comment\">/*当有更新事件发生时，调用此方法。在这里，它会去挨个通知注册的观察者，让他们执行update()方法更新数据*/</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; observers.size(); i++)&#123;</span><br><span class=\"line\">            Observer observer=(Observer)observers.get(i);</span><br><span class=\"line\">            observer.update(tempature, humidity, pressure);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">measurementsChanged</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">      <span class=\"comment\">//接收更新事件通知，然后告诉所有的注册的观察者</span></span><br><span class=\"line\">        notifyObservers();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setMeasurements</span><span class=\"params\">(<span class=\"keyword\">float</span> tempature, <span class=\"keyword\">float</span> humidity, <span class=\"keyword\">float</span> pressure)</span></span>&#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">//当有的气象观测数据到来，调用此方法</span></span><br><span class=\"line\">        <span class=\"keyword\">this</span>.tempature = tempature;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.humidity = humidity;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.pressure = pressure;</span><br><span class=\"line\">     </span><br><span class=\"line\">        measurementsChanged(); <span class=\"comment\">//发出通知</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>  CurrentConditionDisplay.java</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//这是气象数据显示的公告板，它实现了Observer接口，成为了观察者</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CurrentConditionDisplay</span> <span class=\"keyword\">implements</span> <span class=\"title\">Observer</span>, <span class=\"title\">DisplayElement</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">float</span> temprature;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">float</span> humidity;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> Subject weatherData;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">CurrentConditionDisplay</span><span class=\"params\">(Subject weatherData)</span></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">this</span>.weatherData = weatherData;</span><br><span class=\"line\">      <span class=\"comment\">//注册成为wetherData的观察者，随时准备接收新数据</span></span><br><span class=\"line\">        weatherData.registerObserver(<span class=\"keyword\">this</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">update</span><span class=\"params\">(<span class=\"keyword\">float</span> temp, <span class=\"keyword\">float</span> humidity, <span class=\"keyword\">float</span> pressure)</span> </span>&#123;</span><br><span class=\"line\">\t\t\t<span class=\"comment\">//取得来自Subject的数据，并暂存起来用于稍后的显示</span></span><br><span class=\"line\">            <span class=\"keyword\">this</span>.temprature = temp;</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.humidity = humidity;</span><br><span class=\"line\">            display();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">display</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">      <span class=\"comment\">//显示数据</span></span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"Current conditions:\"</span> + temprature + <span class=\"string\">\"F degree and\"</span> + humidity + <span class=\"string\">\"% humidity\"</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>  DisplayElement.java</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">DisplayElement</span></span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">display</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>  ObserverMain.java</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ObserverMain</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">       WetherData wetherData = <span class=\"keyword\">new</span> WetherData();</span><br><span class=\"line\"></span><br><span class=\"line\">\tCurrentConditionDisplay currentConditionDisplay = <span class=\"keyword\">new</span> currentConditionDisplay(wetherData);</span><br><span class=\"line\"></span><br><span class=\"line\">       wetherData.setMeasurements(<span class=\"number\">80</span>,<span class=\"number\">65</span>,<span class=\"number\">30.1f</span>);</span><br><span class=\"line\">       wetherData.setMeasurements(<span class=\"number\">40</span>,<span class=\"number\">30</span>,<span class=\"number\">10.9f</span>);</span><br><span class=\"line\">       wetherData.setMeasurements(<span class=\"number\">10</span>,<span class=\"number\">20</span>,<span class=\"number\">28.3f</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">   &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>  编译，执行看下结果呢。</p>\n  <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">F:/java ObserverMain</span><br><span class=\"line\">Current conditions:80.0F degree and65.0% humidity</span><br><span class=\"line\">Current conditions:40.0F degree and30.0% humidity</span><br><span class=\"line\">Current conditions:10.0F degree and20.0% humidity</span><br></pre></td></tr></table></figure>\n<p>  Nice，咱们的气象站一收到新的数据，公告板就及时的将数据显示了出来。</p>\n","site":{"data":{}},"excerpt":"<p>之前在学习java的过程中，总提到总会遇到“设计模式”，诸如工厂模式了，观察者模式了，单例模式了….看起来云里雾里的。趁最近空闲时间多了些，来把这些设计模式都熟悉一下。我看的书的《Head First 设计模式 》，这个系列的书看起来还蛮有意思的。不闲扯了，这篇博文是我学习“观察者模式”的笔记。</p>","more":"<p>观察者模式有时也被称作“发布-订阅”模式。这种模式有点像我们去订阅报纸，我们是订阅者，报社是发布者，每当报社出版了新的报纸，我们就能够收到最新的报纸了。  在GUI编程中，控件的事件监听算是观察者模式的具体应用了吧。  </p>\n<blockquote>\n<p>观察者模式定义了对象之间的一对多依赖，这样一来，当一个对象发生改变时，它的所有依赖者都会收到通知并自动更新。</p>\n</blockquote>\n<p>—–摘自《Head First设计模式》  </p>\n<p>那么我们具体来实现一种观察者模式的应用，这样看起来就更加直观了。</p>\n<p>观察者模式的最基本的类图如下：  </p>\n<p><img src=\"/blogimg/ObserverUML.bmp\" alt=\"image\"></p>\n<blockquote>\n<p>Subject接口：定义的主题接口，对象使用此接口注册为观察者，或者把自己从观察者之中删除</p>\n<p>Observer接口：所有潜在的观察者必须实现观察者接口，这个接口只有update方法，当主题状态改变时调用</p>\n<p>ConcreteSubject类：一个具体的主题，实现了Subject接口，除了注册和撤销方法，该主题还实现了notifyObserver()方法，用来在状态改变时，通知所有的观察者</p>\n<p>ConcreteObserver类：具体的观察者，它实现了Observer接口，观察者必须注册具体的Subject，才能够就收到更新事件的通知</p>\n</blockquote>\n<p>  接着来具体实现一下书上提供的气象站的例子：</p>\n<p>  Subject.java</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">Subject</span></span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">registerObserver</span><span class=\"params\">(Observer o)</span></span>; <span class=\"comment\">//注册观察者</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">removeObserver</span><span class=\"params\">(Observer o)</span></span>; <span class=\"comment\">//移除观察者</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">notifyObservers</span><span class=\"params\">()</span></span>; <span class=\"comment\">//当有更新事件发生时，通知观察者</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>  Observer.java</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">Observer</span></span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">update</span><span class=\"params\">(<span class=\"keyword\">float</span> temp, <span class=\"keyword\">float</span> humidity, <span class=\"keyword\">float</span> pressure)</span></span>;</span><br><span class=\"line\">    <span class=\"comment\">//所有的观察者都必须实现update()方法，以实现观察者接口</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>  WetherData.java</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">WetherData</span> <span class=\"keyword\">implements</span> <span class=\"title\">Subject</span> </span>&#123; <span class=\"comment\">//需要实现Subject接口</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ArrayList observers; <span class=\"comment\">//用于存放注册的所有观察者对象</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">float</span> tempature;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">float</span> humidity;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">float</span> pressure;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">WetherData</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        observers = <span class=\"keyword\">new</span> ArrayList();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">registerObserver</span><span class=\"params\">(Observer o)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.observers.add(o);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">removeObserver</span><span class=\"params\">(Observer o)</span> </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">int</span> i = observers.indexOf(o);</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(i &gt; <span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">                observers.remove(i);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">notifyObservers</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">      <span class=\"comment\">/*当有更新事件发生时，调用此方法。在这里，它会去挨个通知注册的观察者，让他们执行update()方法更新数据*/</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; observers.size(); i++)&#123;</span><br><span class=\"line\">            Observer observer=(Observer)observers.get(i);</span><br><span class=\"line\">            observer.update(tempature, humidity, pressure);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">measurementsChanged</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">      <span class=\"comment\">//接收更新事件通知，然后告诉所有的注册的观察者</span></span><br><span class=\"line\">        notifyObservers();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setMeasurements</span><span class=\"params\">(<span class=\"keyword\">float</span> tempature, <span class=\"keyword\">float</span> humidity, <span class=\"keyword\">float</span> pressure)</span></span>&#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">//当有的气象观测数据到来，调用此方法</span></span><br><span class=\"line\">        <span class=\"keyword\">this</span>.tempature = tempature;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.humidity = humidity;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.pressure = pressure;</span><br><span class=\"line\">     </span><br><span class=\"line\">        measurementsChanged(); <span class=\"comment\">//发出通知</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>  CurrentConditionDisplay.java</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//这是气象数据显示的公告板，它实现了Observer接口，成为了观察者</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CurrentConditionDisplay</span> <span class=\"keyword\">implements</span> <span class=\"title\">Observer</span>, <span class=\"title\">DisplayElement</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">float</span> temprature;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">float</span> humidity;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> Subject weatherData;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">CurrentConditionDisplay</span><span class=\"params\">(Subject weatherData)</span></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">this</span>.weatherData = weatherData;</span><br><span class=\"line\">      <span class=\"comment\">//注册成为wetherData的观察者，随时准备接收新数据</span></span><br><span class=\"line\">        weatherData.registerObserver(<span class=\"keyword\">this</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">update</span><span class=\"params\">(<span class=\"keyword\">float</span> temp, <span class=\"keyword\">float</span> humidity, <span class=\"keyword\">float</span> pressure)</span> </span>&#123;</span><br><span class=\"line\">\t\t\t<span class=\"comment\">//取得来自Subject的数据，并暂存起来用于稍后的显示</span></span><br><span class=\"line\">            <span class=\"keyword\">this</span>.temprature = temp;</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.humidity = humidity;</span><br><span class=\"line\">            display();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">display</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">      <span class=\"comment\">//显示数据</span></span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"Current conditions:\"</span> + temprature + <span class=\"string\">\"F degree and\"</span> + humidity + <span class=\"string\">\"% humidity\"</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>  DisplayElement.java</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">DisplayElement</span></span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">display</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>  ObserverMain.java</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ObserverMain</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">       WetherData wetherData = <span class=\"keyword\">new</span> WetherData();</span><br><span class=\"line\"></span><br><span class=\"line\">\tCurrentConditionDisplay currentConditionDisplay = <span class=\"keyword\">new</span> currentConditionDisplay(wetherData);</span><br><span class=\"line\"></span><br><span class=\"line\">       wetherData.setMeasurements(<span class=\"number\">80</span>,<span class=\"number\">65</span>,<span class=\"number\">30.1f</span>);</span><br><span class=\"line\">       wetherData.setMeasurements(<span class=\"number\">40</span>,<span class=\"number\">30</span>,<span class=\"number\">10.9f</span>);</span><br><span class=\"line\">       wetherData.setMeasurements(<span class=\"number\">10</span>,<span class=\"number\">20</span>,<span class=\"number\">28.3f</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">   &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>  编译，执行看下结果呢。</p>\n  <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">F:/java ObserverMain</span><br><span class=\"line\">Current conditions:80.0F degree and65.0% humidity</span><br><span class=\"line\">Current conditions:40.0F degree and30.0% humidity</span><br><span class=\"line\">Current conditions:10.0F degree and20.0% humidity</span><br></pre></td></tr></table></figure>\n<p>  Nice，咱们的气象站一收到新的数据，公告板就及时的将数据显示了出来。</p>"},{"title":"MariaDB创建新用户、新数据库并允许特定用户远程访问","date":"2017-03-11T05:43:00.000Z","_content":"\n### 创建新的可远程访问的数据库用户\n```bash\nMariaDB [(none)]> create user 'user'@'%' identified by 'pass';\n```\n### 创建新的数据库\n```bash\nMariaDB [(none)]> create database newdb;\n\n```\n### 把新创建的数据库授权给新创建的用户\n```bash\nMariaDB [(none)]> grant all privileges on newdb.* to 'user'@'%';\nMariaDB [(none)]> flush privileges;\n```\n","source":"_posts/MariaDB-Create-Remote.md","raw":"---\ntitle: MariaDB创建新用户、新数据库并允许特定用户远程访问\ndate: 2017.3.11 13:43\ncategories: Linux\ntags:\n- MariaDB\n- New DB\n- Remote\n---\n\n### 创建新的可远程访问的数据库用户\n```bash\nMariaDB [(none)]> create user 'user'@'%' identified by 'pass';\n```\n### 创建新的数据库\n```bash\nMariaDB [(none)]> create database newdb;\n\n```\n### 把新创建的数据库授权给新创建的用户\n```bash\nMariaDB [(none)]> grant all privileges on newdb.* to 'user'@'%';\nMariaDB [(none)]> flush privileges;\n```\n","slug":"MariaDB-Create-Remote","published":1,"updated":"2017-12-04T07:27:28.759Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjeqig1n6002tlgqatcx9n3l3","content":"<h3 id=\"创建新的可远程访问的数据库用户\"><a href=\"#创建新的可远程访问的数据库用户\" class=\"headerlink\" title=\"创建新的可远程访问的数据库用户\"></a>创建新的可远程访问的数据库用户</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">MariaDB [(none)]&gt; create user <span class=\"string\">'user'</span>@<span class=\"string\">'%'</span> identified by <span class=\"string\">'pass'</span>;</span><br></pre></td></tr></table></figure>\n<h3 id=\"创建新的数据库\"><a href=\"#创建新的数据库\" class=\"headerlink\" title=\"创建新的数据库\"></a>创建新的数据库</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">MariaDB [(none)]&gt; create database newdb;</span><br></pre></td></tr></table></figure>\n<h3 id=\"把新创建的数据库授权给新创建的用户\"><a href=\"#把新创建的数据库授权给新创建的用户\" class=\"headerlink\" title=\"把新创建的数据库授权给新创建的用户\"></a>把新创建的数据库授权给新创建的用户</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">MariaDB [(none)]&gt; grant all privileges on newdb.* to <span class=\"string\">'user'</span>@<span class=\"string\">'%'</span>;</span><br><span class=\"line\">MariaDB [(none)]&gt; flush privileges;</span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"","more":"<h3 id=\"创建新的可远程访问的数据库用户\"><a href=\"#创建新的可远程访问的数据库用户\" class=\"headerlink\" title=\"创建新的可远程访问的数据库用户\"></a>创建新的可远程访问的数据库用户</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">MariaDB [(none)]&gt; create user <span class=\"string\">'user'</span>@<span class=\"string\">'%'</span> identified by <span class=\"string\">'pass'</span>;</span><br></pre></td></tr></table></figure>\n<h3 id=\"创建新的数据库\"><a href=\"#创建新的数据库\" class=\"headerlink\" title=\"创建新的数据库\"></a>创建新的数据库</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">MariaDB [(none)]&gt; create database newdb;</span><br></pre></td></tr></table></figure>\n<h3 id=\"把新创建的数据库授权给新创建的用户\"><a href=\"#把新创建的数据库授权给新创建的用户\" class=\"headerlink\" title=\"把新创建的数据库授权给新创建的用户\"></a>把新创建的数据库授权给新创建的用户</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">MariaDB [(none)]&gt; grant all privileges on newdb.* to <span class=\"string\">'user'</span>@<span class=\"string\">'%'</span>;</span><br><span class=\"line\">MariaDB [(none)]&gt; flush privileges;</span><br></pre></td></tr></table></figure>\n"},{"title":"搭建OpenWRT编译开发环境","date":"2016-11-28T11:25:18.000Z","_content":"本次搭建编译环境所需的准备工作：\n1. 操作系统：物理机或者虚拟机安装----Ubuntu 16.10\n2. 预备知识：了解一点点Linux终端的基本操作\n<!-- more -->\nLet's go!  \n首先还是更新一下系统：\n\n``` bash\n\n  star-chen@starchen-op:~$ sudo apt-get update && apt-get dist-upgrade \n\n```\n接下来参考OpenWRT官方网站给出的搭建编译环境所需要进行的软件包的安装步骤进行安装，官网步骤网址：[OpenWRT官方步骤](https://wiki.openwrt.org/doc/howto/buildroot.exigence)\n由于我使用的是Ubuntu16.10 64bit系统，所以需要执行的安装命令为：\n``` bash\n\nstar-chen@starchen-op:~$ sudo apt-get install git-core mercurial build-essential subversion libncurses5-dev zlib1g-dev gawk gcc-multilib flex git-core gettext libssl-dev\n\n```\n软件包安装完毕之后，测试一下git命令是否可用：\n``` bash\nstar-chen@starchen-op:~$ git\nusage: git [--version] [--help] [-C <path>] [-c name=value]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           <command> [<args>]\n           此处省略一万字.......\n\n```\n\n经测试，git命令可用，接下来创建一个新的目录用来存放OpenWRT源码：\n``` bash\nstar-chen@starchen-op:~$ mkdir OP1505\n\n```\n进入OP1505目录并从git仓库克隆OpenWRT 15.05(chaos_calmer)分支：\n``` bash\nstar-chen@starchen-op:~$ cd OP1505/\nstar-chen@starchen-op:~$ git clone -b chaos_calmer git://github.com/openwrt/openwrt.git\n\n```\n更新并安装软件包：\n``` bash\n cd openwrt\n./scripts/feeds update -a\n./scripts/feeds install -a\n\n```\n根据自己的需要设置编译条件，生成makefile（另一篇专门讲讲这部分）：\n``` bash\nmake menuconfig\n\n```\nOK,make menuconfig通过，接下来咱们编译一个x86的固件来爽爽：\n\n![image](/blogimg/op-makemenu.png)\n\n就以默认参数吧,我给虚拟机分了四个核，4GB内存，这里用两个线程来跑吧。\n``` bash\n\nmake j=2 V=99\n\n```\n编译过程中可能需要下载很多文件，所以挂个代理什么的很有必要，不然很多依赖无法下载，造成编译失败，耐心等待吧。编译完成之后，固件将会在openwrt/bin目录下躺好了。","source":"_posts/OpenWRT-BuildEnvironMent.md","raw":"---\ntitle:  搭建OpenWRT编译开发环境 \ndate: 2016-11-28 19:25:18\ncategories: Linux\ntags:\n- Linux\n- openwrt\n- enviroment\n---\n本次搭建编译环境所需的准备工作：\n1. 操作系统：物理机或者虚拟机安装----Ubuntu 16.10\n2. 预备知识：了解一点点Linux终端的基本操作\n<!-- more -->\nLet's go!  \n首先还是更新一下系统：\n\n``` bash\n\n  star-chen@starchen-op:~$ sudo apt-get update && apt-get dist-upgrade \n\n```\n接下来参考OpenWRT官方网站给出的搭建编译环境所需要进行的软件包的安装步骤进行安装，官网步骤网址：[OpenWRT官方步骤](https://wiki.openwrt.org/doc/howto/buildroot.exigence)\n由于我使用的是Ubuntu16.10 64bit系统，所以需要执行的安装命令为：\n``` bash\n\nstar-chen@starchen-op:~$ sudo apt-get install git-core mercurial build-essential subversion libncurses5-dev zlib1g-dev gawk gcc-multilib flex git-core gettext libssl-dev\n\n```\n软件包安装完毕之后，测试一下git命令是否可用：\n``` bash\nstar-chen@starchen-op:~$ git\nusage: git [--version] [--help] [-C <path>] [-c name=value]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           <command> [<args>]\n           此处省略一万字.......\n\n```\n\n经测试，git命令可用，接下来创建一个新的目录用来存放OpenWRT源码：\n``` bash\nstar-chen@starchen-op:~$ mkdir OP1505\n\n```\n进入OP1505目录并从git仓库克隆OpenWRT 15.05(chaos_calmer)分支：\n``` bash\nstar-chen@starchen-op:~$ cd OP1505/\nstar-chen@starchen-op:~$ git clone -b chaos_calmer git://github.com/openwrt/openwrt.git\n\n```\n更新并安装软件包：\n``` bash\n cd openwrt\n./scripts/feeds update -a\n./scripts/feeds install -a\n\n```\n根据自己的需要设置编译条件，生成makefile（另一篇专门讲讲这部分）：\n``` bash\nmake menuconfig\n\n```\nOK,make menuconfig通过，接下来咱们编译一个x86的固件来爽爽：\n\n![image](/blogimg/op-makemenu.png)\n\n就以默认参数吧,我给虚拟机分了四个核，4GB内存，这里用两个线程来跑吧。\n``` bash\n\nmake j=2 V=99\n\n```\n编译过程中可能需要下载很多文件，所以挂个代理什么的很有必要，不然很多依赖无法下载，造成编译失败，耐心等待吧。编译完成之后，固件将会在openwrt/bin目录下躺好了。","slug":"OpenWRT-BuildEnvironMent","published":1,"updated":"2017-12-04T07:27:28.760Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjeqig1n8002wlgqai216eyll","content":"<p>本次搭建编译环境所需的准备工作：</p>\n<ol>\n<li>操作系统：物理机或者虚拟机安装—-Ubuntu 16.10</li>\n<li>预备知识：了解一点点Linux终端的基本操作<a id=\"more\"></a>\nLet’s go!<br>首先还是更新一下系统：</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">star-chen@starchen-op:~$ sudo apt-get update &amp;&amp; apt-get dist-upgrade</span><br></pre></td></tr></table></figure>\n<p>接下来参考OpenWRT官方网站给出的搭建编译环境所需要进行的软件包的安装步骤进行安装，官网步骤网址：<a href=\"https://wiki.openwrt.org/doc/howto/buildroot.exigence\" target=\"_blank\" rel=\"noopener\">OpenWRT官方步骤</a><br>由于我使用的是Ubuntu16.10 64bit系统，所以需要执行的安装命令为：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">star-chen@starchen-op:~$ sudo apt-get install git-core mercurial build-essential subversion libncurses5-dev zlib1g-dev gawk gcc-multilib flex git-core gettext libssl-dev</span><br></pre></td></tr></table></figure></p>\n<p>软件包安装完毕之后，测试一下git命令是否可用：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">star-chen@starchen-op:~$ git</span><br><span class=\"line\">usage: git [--version] [--<span class=\"built_in\">help</span>] [-C &lt;path&gt;] [-c name=value]</span><br><span class=\"line\">           [--<span class=\"built_in\">exec</span>-path[=&lt;path&gt;]] [--html-path] [--man-path] [--info-path]</span><br><span class=\"line\">           [-p | --paginate | --no-pager] [--no-replace-objects] [--bare]</span><br><span class=\"line\">           [--git-dir=&lt;path&gt;] [--work-tree=&lt;path&gt;] [--namespace=&lt;name&gt;]</span><br><span class=\"line\">           &lt;<span class=\"built_in\">command</span>&gt; [&lt;args&gt;]</span><br><span class=\"line\">           此处省略一万字.......</span><br></pre></td></tr></table></figure></p>\n<p>经测试，git命令可用，接下来创建一个新的目录用来存放OpenWRT源码：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">star-chen@starchen-op:~$ mkdir OP1505</span><br></pre></td></tr></table></figure></p>\n<p>进入OP1505目录并从git仓库克隆OpenWRT 15.05(chaos_calmer)分支：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">star-chen@starchen-op:~$ <span class=\"built_in\">cd</span> OP1505/</span><br><span class=\"line\">star-chen@starchen-op:~$ git <span class=\"built_in\">clone</span> -b chaos_calmer git://github.com/openwrt/openwrt.git</span><br></pre></td></tr></table></figure></p>\n<p>更新并安装软件包：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> <span class=\"built_in\">cd</span> openwrt</span><br><span class=\"line\">./scripts/feeds update -a</span><br><span class=\"line\">./scripts/feeds install -a</span><br></pre></td></tr></table></figure></p>\n<p>根据自己的需要设置编译条件，生成makefile（另一篇专门讲讲这部分）：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">make menuconfig</span><br></pre></td></tr></table></figure></p>\n<p>OK,make menuconfig通过，接下来咱们编译一个x86的固件来爽爽：</p>\n<p><img src=\"/blogimg/op-makemenu.png\" alt=\"image\"></p>\n<p>就以默认参数吧,我给虚拟机分了四个核，4GB内存，这里用两个线程来跑吧。<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">make j=2 V=99</span><br></pre></td></tr></table></figure></p>\n<p>编译过程中可能需要下载很多文件，所以挂个代理什么的很有必要，不然很多依赖无法下载，造成编译失败，耐心等待吧。编译完成之后，固件将会在openwrt/bin目录下躺好了。</p>\n","site":{"data":{}},"excerpt":"<p>本次搭建编译环境所需的准备工作：</p>\n<ol>\n<li>操作系统：物理机或者虚拟机安装—-Ubuntu 16.10</li>\n<li>预备知识：了解一点点Linux终端的基本操作","more":"Let’s go!<br>首先还是更新一下系统：</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">star-chen@starchen-op:~$ sudo apt-get update &amp;&amp; apt-get dist-upgrade</span><br></pre></td></tr></table></figure>\n<p>接下来参考OpenWRT官方网站给出的搭建编译环境所需要进行的软件包的安装步骤进行安装，官网步骤网址：<a href=\"https://wiki.openwrt.org/doc/howto/buildroot.exigence\" target=\"_blank\" rel=\"noopener\">OpenWRT官方步骤</a><br>由于我使用的是Ubuntu16.10 64bit系统，所以需要执行的安装命令为：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">star-chen@starchen-op:~$ sudo apt-get install git-core mercurial build-essential subversion libncurses5-dev zlib1g-dev gawk gcc-multilib flex git-core gettext libssl-dev</span><br></pre></td></tr></table></figure></p>\n<p>软件包安装完毕之后，测试一下git命令是否可用：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">star-chen@starchen-op:~$ git</span><br><span class=\"line\">usage: git [--version] [--<span class=\"built_in\">help</span>] [-C &lt;path&gt;] [-c name=value]</span><br><span class=\"line\">           [--<span class=\"built_in\">exec</span>-path[=&lt;path&gt;]] [--html-path] [--man-path] [--info-path]</span><br><span class=\"line\">           [-p | --paginate | --no-pager] [--no-replace-objects] [--bare]</span><br><span class=\"line\">           [--git-dir=&lt;path&gt;] [--work-tree=&lt;path&gt;] [--namespace=&lt;name&gt;]</span><br><span class=\"line\">           &lt;<span class=\"built_in\">command</span>&gt; [&lt;args&gt;]</span><br><span class=\"line\">           此处省略一万字.......</span><br></pre></td></tr></table></figure></p>\n<p>经测试，git命令可用，接下来创建一个新的目录用来存放OpenWRT源码：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">star-chen@starchen-op:~$ mkdir OP1505</span><br></pre></td></tr></table></figure></p>\n<p>进入OP1505目录并从git仓库克隆OpenWRT 15.05(chaos_calmer)分支：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">star-chen@starchen-op:~$ <span class=\"built_in\">cd</span> OP1505/</span><br><span class=\"line\">star-chen@starchen-op:~$ git <span class=\"built_in\">clone</span> -b chaos_calmer git://github.com/openwrt/openwrt.git</span><br></pre></td></tr></table></figure></p>\n<p>更新并安装软件包：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> <span class=\"built_in\">cd</span> openwrt</span><br><span class=\"line\">./scripts/feeds update -a</span><br><span class=\"line\">./scripts/feeds install -a</span><br></pre></td></tr></table></figure></p>\n<p>根据自己的需要设置编译条件，生成makefile（另一篇专门讲讲这部分）：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">make menuconfig</span><br></pre></td></tr></table></figure></p>\n<p>OK,make menuconfig通过，接下来咱们编译一个x86的固件来爽爽：</p>\n<p><img src=\"/blogimg/op-makemenu.png\" alt=\"image\"></p>\n<p>就以默认参数吧,我给虚拟机分了四个核，4GB内存，这里用两个线程来跑吧。<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">make j=2 V=99</span><br></pre></td></tr></table></figure></p>\n<p>编译过程中可能需要下载很多文件，所以挂个代理什么的很有必要，不然很多依赖无法下载，造成编译失败，耐心等待吧。编译完成之后，固件将会在openwrt/bin目录下躺好了。</p>"},{"title":"利用iTextSharp向pdf文件中添加图片水印","date":"2017-09-10T03:18:30.000Z","_content":"\n由于某些需要，我需要向pdf文件中插入图片水印，经过往上搜索发现iTextSharp这个文件操作库就可以实现我的需求。其实向pdf文件中插入水印就是重新读取pdf文件，再朝文件中写入新增的图片。\n\n<!--more-->\n\n怎么加载iTextSharp库就不啰嗦了，这里贴一下添加图片水印的代码，以防忘记。\n\n```c#\n\t\t\tString srcPdf = \"I:\\\\文档文件\\\\xxx.pdf\";\n            String dstPdf = \"C:\\\\Users\\\\xiaoxing\\\\Desktop\\\\xxxxx.pdf\";\n            String imagepath = \"C:\\\\Users\\\\xiaoxing\\\\Desktop\\\\xxxx\\\\qrcode.jpg\";\n            iTextSharp.text.Image img = Image.GetInstance(imagepath);\n            PdfReader reader = new PdfReader(srcPdf);\n            PdfStamper stamp = new PdfStamper(reader, new FileStream(dstPdf, FileMode.Create));\n\n            PdfContentByte page;\n            float width = reader.GetPageSize(1).Width;\n            float height = reader.GetPageSize(1).Height;\n            int num = reader.NumberOfPages;\n            int margin = 100;\n            img.ScalePercent(20);\n            \n            for (int i = 1; i <= num; ++i)\n            {\n                page = stamp.GetOverContent(i);\n\n                img.SetAbsolutePosition(width-img.ScaledWidth-10,10);//设置图片插入的位置，左下角为坐标系（0，0）位置\n                page.AddImage(img);\n            }\n\n            stamp.Close();\n            reader.Close();\n```\n\n","source":"_posts/PDF-watermask.md","raw":"---\ntitle: 利用iTextSharp向pdf文件中添加图片水印\ncategories:\n  - Program\ntags:\n  - C# pdf\ndate: 2017-09-10 11:18:30\n---\n\n由于某些需要，我需要向pdf文件中插入图片水印，经过往上搜索发现iTextSharp这个文件操作库就可以实现我的需求。其实向pdf文件中插入水印就是重新读取pdf文件，再朝文件中写入新增的图片。\n\n<!--more-->\n\n怎么加载iTextSharp库就不啰嗦了，这里贴一下添加图片水印的代码，以防忘记。\n\n```c#\n\t\t\tString srcPdf = \"I:\\\\文档文件\\\\xxx.pdf\";\n            String dstPdf = \"C:\\\\Users\\\\xiaoxing\\\\Desktop\\\\xxxxx.pdf\";\n            String imagepath = \"C:\\\\Users\\\\xiaoxing\\\\Desktop\\\\xxxx\\\\qrcode.jpg\";\n            iTextSharp.text.Image img = Image.GetInstance(imagepath);\n            PdfReader reader = new PdfReader(srcPdf);\n            PdfStamper stamp = new PdfStamper(reader, new FileStream(dstPdf, FileMode.Create));\n\n            PdfContentByte page;\n            float width = reader.GetPageSize(1).Width;\n            float height = reader.GetPageSize(1).Height;\n            int num = reader.NumberOfPages;\n            int margin = 100;\n            img.ScalePercent(20);\n            \n            for (int i = 1; i <= num; ++i)\n            {\n                page = stamp.GetOverContent(i);\n\n                img.SetAbsolutePosition(width-img.ScaledWidth-10,10);//设置图片插入的位置，左下角为坐标系（0，0）位置\n                page.AddImage(img);\n            }\n\n            stamp.Close();\n            reader.Close();\n```\n\n","slug":"PDF-watermask","published":1,"updated":"2017-12-04T07:27:28.760Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjeqig1nd0030lgqauoc0rxbo","content":"<p>由于某些需要，我需要向pdf文件中插入图片水印，经过往上搜索发现iTextSharp这个文件操作库就可以实现我的需求。其实向pdf文件中插入水印就是重新读取pdf文件，再朝文件中写入新增的图片。</p>\n<a id=\"more\"></a>\n<p>怎么加载iTextSharp库就不啰嗦了，这里贴一下添加图片水印的代码，以防忘记。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">String srcPdf = &quot;I:\\\\文档文件\\\\xxx.pdf&quot;;</span><br><span class=\"line\">         String dstPdf = &quot;C:\\\\Users\\\\xiaoxing\\\\Desktop\\\\xxxxx.pdf&quot;;</span><br><span class=\"line\">         String imagepath = &quot;C:\\\\Users\\\\xiaoxing\\\\Desktop\\\\xxxx\\\\qrcode.jpg&quot;;</span><br><span class=\"line\">         iTextSharp.text.Image img = Image.GetInstance(imagepath);</span><br><span class=\"line\">         PdfReader reader = new PdfReader(srcPdf);</span><br><span class=\"line\">         PdfStamper stamp = new PdfStamper(reader, new FileStream(dstPdf, FileMode.Create));</span><br><span class=\"line\"></span><br><span class=\"line\">         PdfContentByte page;</span><br><span class=\"line\">         float width = reader.GetPageSize(1).Width;</span><br><span class=\"line\">         float height = reader.GetPageSize(1).Height;</span><br><span class=\"line\">         int num = reader.NumberOfPages;</span><br><span class=\"line\">         int margin = 100;</span><br><span class=\"line\">         img.ScalePercent(20);</span><br><span class=\"line\">         </span><br><span class=\"line\">         for (int i = 1; i &lt;= num; ++i)</span><br><span class=\"line\">         &#123;</span><br><span class=\"line\">             page = stamp.GetOverContent(i);</span><br><span class=\"line\"></span><br><span class=\"line\">             img.SetAbsolutePosition(width-img.ScaledWidth-10,10);//设置图片插入的位置，左下角为坐标系（0，0）位置</span><br><span class=\"line\">             page.AddImage(img);</span><br><span class=\"line\">         &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">         stamp.Close();</span><br><span class=\"line\">         reader.Close();</span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"<p>由于某些需要，我需要向pdf文件中插入图片水印，经过往上搜索发现iTextSharp这个文件操作库就可以实现我的需求。其实向pdf文件中插入水印就是重新读取pdf文件，再朝文件中写入新增的图片。</p>","more":"<p>怎么加载iTextSharp库就不啰嗦了，这里贴一下添加图片水印的代码，以防忘记。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">String srcPdf = &quot;I:\\\\文档文件\\\\xxx.pdf&quot;;</span><br><span class=\"line\">         String dstPdf = &quot;C:\\\\Users\\\\xiaoxing\\\\Desktop\\\\xxxxx.pdf&quot;;</span><br><span class=\"line\">         String imagepath = &quot;C:\\\\Users\\\\xiaoxing\\\\Desktop\\\\xxxx\\\\qrcode.jpg&quot;;</span><br><span class=\"line\">         iTextSharp.text.Image img = Image.GetInstance(imagepath);</span><br><span class=\"line\">         PdfReader reader = new PdfReader(srcPdf);</span><br><span class=\"line\">         PdfStamper stamp = new PdfStamper(reader, new FileStream(dstPdf, FileMode.Create));</span><br><span class=\"line\"></span><br><span class=\"line\">         PdfContentByte page;</span><br><span class=\"line\">         float width = reader.GetPageSize(1).Width;</span><br><span class=\"line\">         float height = reader.GetPageSize(1).Height;</span><br><span class=\"line\">         int num = reader.NumberOfPages;</span><br><span class=\"line\">         int margin = 100;</span><br><span class=\"line\">         img.ScalePercent(20);</span><br><span class=\"line\">         </span><br><span class=\"line\">         for (int i = 1; i &lt;= num; ++i)</span><br><span class=\"line\">         &#123;</span><br><span class=\"line\">             page = stamp.GetOverContent(i);</span><br><span class=\"line\"></span><br><span class=\"line\">             img.SetAbsolutePosition(width-img.ScaledWidth-10,10);//设置图片插入的位置，左下角为坐标系（0，0）位置</span><br><span class=\"line\">             page.AddImage(img);</span><br><span class=\"line\">         &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">         stamp.Close();</span><br><span class=\"line\">         reader.Close();</span><br></pre></td></tr></table></figure>"},{"title":"利用Python的PIL截屏","date":"2016-12-04T02:23:02.000Z","_content":"\n### 0x1：在Windows 64位系统上安装python的PIL库\n\nPillow的官方网站上默认只提供32位版本的安装程序，所以我们需要到第三方网站去下载64位版本的Pillow安装包。[Win 64 PIL下载地址](http://www.lfd.uci.edu/~gohlke/pythonlibs/) 下载下来会发现是.whl扩展名。其安装方法：  \n\n```cmd\npip install Pillow-3.4.2-cp27-cp27m-win_amd64.whl\n```\n\n### 0x2:利用PIL截屏\n\n```python\nfrom PIL import ImageGrab\nimage=ImageGrab.grab()\nimage.save(\"E:/grab.jpg\",\"jpeg\")\n\n```\n\n仅仅需要简单的两行代码就可以实现截取整个屏幕并保存为文件，很方便。grab方法还可以指定参数，截取屏幕某坐标范围内的内容。","source":"_posts/PIL-Grab.md","raw":"---\ntitle: 利用Python的PIL截屏\ndate: 2016-12-04 10:23:02\ncategories: Program\ntags:\n- python\n- PIL\n---\n\n### 0x1：在Windows 64位系统上安装python的PIL库\n\nPillow的官方网站上默认只提供32位版本的安装程序，所以我们需要到第三方网站去下载64位版本的Pillow安装包。[Win 64 PIL下载地址](http://www.lfd.uci.edu/~gohlke/pythonlibs/) 下载下来会发现是.whl扩展名。其安装方法：  \n\n```cmd\npip install Pillow-3.4.2-cp27-cp27m-win_amd64.whl\n```\n\n### 0x2:利用PIL截屏\n\n```python\nfrom PIL import ImageGrab\nimage=ImageGrab.grab()\nimage.save(\"E:/grab.jpg\",\"jpeg\")\n\n```\n\n仅仅需要简单的两行代码就可以实现截取整个屏幕并保存为文件，很方便。grab方法还可以指定参数，截取屏幕某坐标范围内的内容。","slug":"PIL-Grab","published":1,"updated":"2017-12-04T07:27:28.761Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjeqig1ng0032lgqaaw61cjps","content":"<h3 id=\"0x1：在Windows-64位系统上安装python的PIL库\"><a href=\"#0x1：在Windows-64位系统上安装python的PIL库\" class=\"headerlink\" title=\"0x1：在Windows 64位系统上安装python的PIL库\"></a>0x1：在Windows 64位系统上安装python的PIL库</h3><p>Pillow的官方网站上默认只提供32位版本的安装程序，所以我们需要到第三方网站去下载64位版本的Pillow安装包。<a href=\"http://www.lfd.uci.edu/~gohlke/pythonlibs/\" target=\"_blank\" rel=\"noopener\">Win 64 PIL下载地址</a> 下载下来会发现是.whl扩展名。其安装方法：  </p>\n<figure class=\"highlight cmd\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip install Pillow-<span class=\"number\">3</span>.<span class=\"number\">4</span>.<span class=\"number\">2</span>-cp27-cp27m-win_amd64.whl</span><br></pre></td></tr></table></figure>\n<h3 id=\"0x2-利用PIL截屏\"><a href=\"#0x2-利用PIL截屏\" class=\"headerlink\" title=\"0x2:利用PIL截屏\"></a>0x2:利用PIL截屏</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> PIL <span class=\"keyword\">import</span> ImageGrab</span><br><span class=\"line\">image=ImageGrab.grab()</span><br><span class=\"line\">image.save(<span class=\"string\">\"E:/grab.jpg\"</span>,<span class=\"string\">\"jpeg\"</span>)</span><br></pre></td></tr></table></figure>\n<p>仅仅需要简单的两行代码就可以实现截取整个屏幕并保存为文件，很方便。grab方法还可以指定参数，截取屏幕某坐标范围内的内容。</p>\n","site":{"data":{}},"excerpt":"","more":"<h3 id=\"0x1：在Windows-64位系统上安装python的PIL库\"><a href=\"#0x1：在Windows-64位系统上安装python的PIL库\" class=\"headerlink\" title=\"0x1：在Windows 64位系统上安装python的PIL库\"></a>0x1：在Windows 64位系统上安装python的PIL库</h3><p>Pillow的官方网站上默认只提供32位版本的安装程序，所以我们需要到第三方网站去下载64位版本的Pillow安装包。<a href=\"http://www.lfd.uci.edu/~gohlke/pythonlibs/\" target=\"_blank\" rel=\"noopener\">Win 64 PIL下载地址</a> 下载下来会发现是.whl扩展名。其安装方法：  </p>\n<figure class=\"highlight cmd\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip install Pillow-<span class=\"number\">3</span>.<span class=\"number\">4</span>.<span class=\"number\">2</span>-cp27-cp27m-win_amd64.whl</span><br></pre></td></tr></table></figure>\n<h3 id=\"0x2-利用PIL截屏\"><a href=\"#0x2-利用PIL截屏\" class=\"headerlink\" title=\"0x2:利用PIL截屏\"></a>0x2:利用PIL截屏</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> PIL <span class=\"keyword\">import</span> ImageGrab</span><br><span class=\"line\">image=ImageGrab.grab()</span><br><span class=\"line\">image.save(<span class=\"string\">\"E:/grab.jpg\"</span>,<span class=\"string\">\"jpeg\"</span>)</span><br></pre></td></tr></table></figure>\n<p>仅仅需要简单的两行代码就可以实现截取整个屏幕并保存为文件，很方便。grab方法还可以指定参数，截取屏幕某坐标范围内的内容。</p>\n"},{"title":"OpenWrt软件开发-----软件包HelloWorld的构建","date":"2017-09-09T07:24:56.000Z","_content":"\nOpenWrt提供了方便的机制来让用用户可以l扩充和实现自己所需的功能。这篇博文就说明一下怎么构建一个能够安装在OpenWrt上ipk包的过程。\n\n<!--more-->\n\n1.文件目录\n\n\n\thelloworld/\n\t├── Makefile  #Makefile 必不可少\n\t└── src #源码目录\n\t\t├── Hello.c #程序源码\n\t\t└── Makefile #编译源码的Makefile\n\n2.文件内容\n\nsrc/Hello.c\n\n```c\n#include <stdio.h>\n#include <unistd.h>\nint main(void)\n{\n     printf(\"Hell! Dear OpenWrt!\\n\\n\");\n     return 0;\n}\n```\n\nsrc/Makefile\n\n```makefile\n# build Hello executable when user executes \"make\"\nHello:Hello.o\n\t$(CC) $(LDFLAGS) Hello.o -o Hello\nHello.o:Hello.c\n\t$(CC) $(CFLAGS) -c Hello.c\n#remove object files and executable when user executes \"make clean\"\nclean:\n\trm *.o Hello\n\n```\n\n构建OpenWrt软件包最主要的内容都包括在Makefile中了，首先看一下Makefile的内容。\n\nMakefile\n\n```makefile\n##############################################\n# OpenWrtMakefile for HelloWorld program\n#\n#\n# Most ofthe variables used here are defined in\n# theinclude directives below. We just need to\n# specifya basic description of the package,\n# whereto build our program, where to find\n# thesource files, and where to install the\n# compiled program on the router.\n#\n# Be verycareful of spacing in this file.\n# Indentsshould be tabs, not spaces, and\n# thereshould be no trailing whitespace in\n# linesthat are not commented.\n#\n##############################################\ninclude $(TOPDIR)/rules.mk \n# Nameand release number of this package\nPKG_NAME:=Hello #软件包的名称，编译的时候可以看到，安装，卸载所用到的名称\nPKG_RELEASE:=1 #软件包的版本\n# Thisspecifies the directory where we're going to build the program.\n# Theroot build directory, $(BUILD_DIR), is by default the build_mipsel\n#directory in your OpenWrt SDK directory\nPKG_BUILD_DIR:= $(BUILD_DIR)/$(PKG_NAME)  #源码所在的目录\ninclude $(INCLUDE_DIR)/package.mk\n# Specifypackage information for this program.\n# Thevariables defined here should be self explanatory.\n# If youare running Kamikaze, delete the DESCRIPTION\n#variable below and uncomment the Kamikaze define\n# directivefor the description below\ndefine Package/$(PKG_NAME)  #这里是定义在make menuconfig的时候，该软件包出现的位置\n\tSECTION:=utils\n\tCATEGORY:=Utilities\n\tTITLE:=HelloOpenwrt-- Start to build software on your router!\nendef\n# Specifywhat needs to be done to prepare for building the package.\n# In ourcase, we need to copy the source files to the build directory.\n# This isNOT the default. The default uses thePKG_SOURCE_URL and the\n#PKG_SOURCE which is not defined here to download the source from the web.\n# Inorder to just build a simple program that we have just written, it is\n# mucheasier to do it this way.\ndefine Build/Prepare\n\tmkdir -p $(PKG_BUILD_DIR)\n\t$(CP) ./src/* $(PKG_BUILD_DIR)/\nendef\n# We donot need to define Build/Configure or Build/Compile directives\n# Thedefaults are appropriate for compiling a simple program such as this one\n# Specifywhere and how to install the program. Since we only have one file,\n# thehelloworld executable, install it by copying it to the /bin directory on\n# therouter. The $(1) variable represents the root directory on the router running\n#OpenWrt. The $(INSTALL_DIR) variable contains a command to prepare the install\n#directory if it does not already exist. Likewise $(INSTALL_BIN) contains the\n# commandto copy the binary file from its current location (in our case the build\n#directory) to the install directory.\ndefine Package/$(PKG_NAME)/install  #定义软件包安装行为\n\t$(INSTALL_DIR) $(1)/bin #需要安装的目录，这里必须先指定，不然编译的会报找不到目录的错误\n\t$(INSTALL_BIN) $(PKG_BUILD_DIR)/Hello $(1)/bin/\nendef\n# Thisline executes the necessary commands to compile our program.\n# Theabove define directives specify all the information needed, but this\n# linecalls BuildPackage which in turn actually uses this information to\n# build apackage.\n\n$(eval $(call BuildPackage,$(PKG_NAME))) #正式开始执行编译\n\n```\n\n代码编写完成后，就可以把软件包放到OpenWrt源码的Package目录或者OpenWrt SDk的Package目录中去，执行make，就可以生成ipk软件包了。","source":"_posts/OpenWrt-HelloWorl.md","raw":"---\ntitle: OpenWrt软件开发-----软件包HelloWorld的构建\ncategories:\n  - Linux\ntags:\n  - OpenWrt\ndate: 2017-09-09 15:24:56\n---\n\nOpenWrt提供了方便的机制来让用用户可以l扩充和实现自己所需的功能。这篇博文就说明一下怎么构建一个能够安装在OpenWrt上ipk包的过程。\n\n<!--more-->\n\n1.文件目录\n\n\n\thelloworld/\n\t├── Makefile  #Makefile 必不可少\n\t└── src #源码目录\n\t\t├── Hello.c #程序源码\n\t\t└── Makefile #编译源码的Makefile\n\n2.文件内容\n\nsrc/Hello.c\n\n```c\n#include <stdio.h>\n#include <unistd.h>\nint main(void)\n{\n     printf(\"Hell! Dear OpenWrt!\\n\\n\");\n     return 0;\n}\n```\n\nsrc/Makefile\n\n```makefile\n# build Hello executable when user executes \"make\"\nHello:Hello.o\n\t$(CC) $(LDFLAGS) Hello.o -o Hello\nHello.o:Hello.c\n\t$(CC) $(CFLAGS) -c Hello.c\n#remove object files and executable when user executes \"make clean\"\nclean:\n\trm *.o Hello\n\n```\n\n构建OpenWrt软件包最主要的内容都包括在Makefile中了，首先看一下Makefile的内容。\n\nMakefile\n\n```makefile\n##############################################\n# OpenWrtMakefile for HelloWorld program\n#\n#\n# Most ofthe variables used here are defined in\n# theinclude directives below. We just need to\n# specifya basic description of the package,\n# whereto build our program, where to find\n# thesource files, and where to install the\n# compiled program on the router.\n#\n# Be verycareful of spacing in this file.\n# Indentsshould be tabs, not spaces, and\n# thereshould be no trailing whitespace in\n# linesthat are not commented.\n#\n##############################################\ninclude $(TOPDIR)/rules.mk \n# Nameand release number of this package\nPKG_NAME:=Hello #软件包的名称，编译的时候可以看到，安装，卸载所用到的名称\nPKG_RELEASE:=1 #软件包的版本\n# Thisspecifies the directory where we're going to build the program.\n# Theroot build directory, $(BUILD_DIR), is by default the build_mipsel\n#directory in your OpenWrt SDK directory\nPKG_BUILD_DIR:= $(BUILD_DIR)/$(PKG_NAME)  #源码所在的目录\ninclude $(INCLUDE_DIR)/package.mk\n# Specifypackage information for this program.\n# Thevariables defined here should be self explanatory.\n# If youare running Kamikaze, delete the DESCRIPTION\n#variable below and uncomment the Kamikaze define\n# directivefor the description below\ndefine Package/$(PKG_NAME)  #这里是定义在make menuconfig的时候，该软件包出现的位置\n\tSECTION:=utils\n\tCATEGORY:=Utilities\n\tTITLE:=HelloOpenwrt-- Start to build software on your router!\nendef\n# Specifywhat needs to be done to prepare for building the package.\n# In ourcase, we need to copy the source files to the build directory.\n# This isNOT the default. The default uses thePKG_SOURCE_URL and the\n#PKG_SOURCE which is not defined here to download the source from the web.\n# Inorder to just build a simple program that we have just written, it is\n# mucheasier to do it this way.\ndefine Build/Prepare\n\tmkdir -p $(PKG_BUILD_DIR)\n\t$(CP) ./src/* $(PKG_BUILD_DIR)/\nendef\n# We donot need to define Build/Configure or Build/Compile directives\n# Thedefaults are appropriate for compiling a simple program such as this one\n# Specifywhere and how to install the program. Since we only have one file,\n# thehelloworld executable, install it by copying it to the /bin directory on\n# therouter. The $(1) variable represents the root directory on the router running\n#OpenWrt. The $(INSTALL_DIR) variable contains a command to prepare the install\n#directory if it does not already exist. Likewise $(INSTALL_BIN) contains the\n# commandto copy the binary file from its current location (in our case the build\n#directory) to the install directory.\ndefine Package/$(PKG_NAME)/install  #定义软件包安装行为\n\t$(INSTALL_DIR) $(1)/bin #需要安装的目录，这里必须先指定，不然编译的会报找不到目录的错误\n\t$(INSTALL_BIN) $(PKG_BUILD_DIR)/Hello $(1)/bin/\nendef\n# Thisline executes the necessary commands to compile our program.\n# Theabove define directives specify all the information needed, but this\n# linecalls BuildPackage which in turn actually uses this information to\n# build apackage.\n\n$(eval $(call BuildPackage,$(PKG_NAME))) #正式开始执行编译\n\n```\n\n代码编写完成后，就可以把软件包放到OpenWrt源码的Package目录或者OpenWrt SDk的Package目录中去，执行make，就可以生成ipk软件包了。","slug":"OpenWrt-HelloWorl","published":1,"updated":"2017-12-04T07:27:28.760Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjeqig1ni0034lgqacj46dp2x","content":"<p>OpenWrt提供了方便的机制来让用用户可以l扩充和实现自己所需的功能。这篇博文就说明一下怎么构建一个能够安装在OpenWrt上ipk包的过程。</p>\n<a id=\"more\"></a>\n<p>1.文件目录</p>\n<pre><code>helloworld/\n├── Makefile  #Makefile 必不可少\n└── src #源码目录\n    ├── Hello.c #程序源码\n    └── Makefile #编译源码的Makefile\n</code></pre><p>2.文件内容</p>\n<p>src/Hello.c</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;stdio.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;unistd.h&gt;</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">(<span class=\"keyword\">void</span>)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">     <span class=\"built_in\">printf</span>(<span class=\"string\">\"Hell! Dear OpenWrt!\\n\\n\"</span>);</span><br><span class=\"line\">     <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>src/Makefile</p>\n<figure class=\"highlight makefile\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># build Hello executable when user executes \"make\"</span></span><br><span class=\"line\"><span class=\"section\">Hello:Hello.o</span></span><br><span class=\"line\">\t<span class=\"variable\">$(CC)</span> <span class=\"variable\">$(LDFLAGS)</span> Hello.o -o Hello</span><br><span class=\"line\"><span class=\"section\">Hello.o:Hello.c</span></span><br><span class=\"line\">\t<span class=\"variable\">$(CC)</span> <span class=\"variable\">$(CFLAGS)</span> -c Hello.c</span><br><span class=\"line\"><span class=\"comment\">#remove object files and executable when user executes \"make clean\"</span></span><br><span class=\"line\"><span class=\"section\">clean:</span></span><br><span class=\"line\">\trm *.o Hello</span><br></pre></td></tr></table></figure>\n<p>构建OpenWrt软件包最主要的内容都包括在Makefile中了，首先看一下Makefile的内容。</p>\n<p>Makefile</p>\n<figure class=\"highlight makefile\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">##############################################</span></span><br><span class=\"line\"><span class=\"comment\"># OpenWrtMakefile for HelloWorld program</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># Most ofthe variables used here are defined in</span></span><br><span class=\"line\"><span class=\"comment\"># theinclude directives below. We just need to</span></span><br><span class=\"line\"><span class=\"comment\"># specifya basic description of the package,</span></span><br><span class=\"line\"><span class=\"comment\"># whereto build our program, where to find</span></span><br><span class=\"line\"><span class=\"comment\"># thesource files, and where to install the</span></span><br><span class=\"line\"><span class=\"comment\"># compiled program on the router.</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># Be verycareful of spacing in this file.</span></span><br><span class=\"line\"><span class=\"comment\"># Indentsshould be tabs, not spaces, and</span></span><br><span class=\"line\"><span class=\"comment\"># thereshould be no trailing whitespace in</span></span><br><span class=\"line\"><span class=\"comment\"># linesthat are not commented.</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\">##############################################</span></span><br><span class=\"line\"><span class=\"keyword\">include</span> <span class=\"variable\">$(TOPDIR)</span>/rules.mk </span><br><span class=\"line\"><span class=\"comment\"># Nameand release number of this package</span></span><br><span class=\"line\">PKG_NAME:=Hello <span class=\"comment\">#软件包的名称，编译的时候可以看到，安装，卸载所用到的名称</span></span><br><span class=\"line\">PKG_RELEASE:=1 <span class=\"comment\">#软件包的版本</span></span><br><span class=\"line\"><span class=\"comment\"># Thisspecifies the directory where we're going to build the program.</span></span><br><span class=\"line\"><span class=\"comment\"># Theroot build directory, $(BUILD_DIR), is by default the build_mipsel</span></span><br><span class=\"line\"><span class=\"comment\">#directory in your OpenWrt SDK directory</span></span><br><span class=\"line\">PKG_BUILD_DIR:= <span class=\"variable\">$(BUILD_DIR)</span>/<span class=\"variable\">$(PKG_NAME)</span>  <span class=\"comment\">#源码所在的目录</span></span><br><span class=\"line\"><span class=\"keyword\">include</span> <span class=\"variable\">$(INCLUDE_DIR)</span>/package.mk</span><br><span class=\"line\"><span class=\"comment\"># Specifypackage information for this program.</span></span><br><span class=\"line\"><span class=\"comment\"># Thevariables defined here should be self explanatory.</span></span><br><span class=\"line\"><span class=\"comment\"># If youare running Kamikaze, delete the DESCRIPTION</span></span><br><span class=\"line\"><span class=\"comment\">#variable below and uncomment the Kamikaze define</span></span><br><span class=\"line\"><span class=\"comment\"># directivefor the description below</span></span><br><span class=\"line\"><span class=\"keyword\">define</span> Package/<span class=\"variable\">$(PKG_NAME)</span>  <span class=\"comment\">#这里是定义在make menuconfig的时候，该软件包出现的位置</span></span><br><span class=\"line\">\tSECTION:=utils</span><br><span class=\"line\">\tCATEGORY:=Utilities</span><br><span class=\"line\">\tTITLE:=HelloOpenwrt-- Start to build software on your router!</span><br><span class=\"line\"><span class=\"keyword\">endef</span></span><br><span class=\"line\"><span class=\"comment\"># Specifywhat needs to be done to prepare for building the package.</span></span><br><span class=\"line\"><span class=\"comment\"># In ourcase, we need to copy the source files to the build directory.</span></span><br><span class=\"line\"><span class=\"comment\"># This isNOT the default. The default uses thePKG_SOURCE_URL and the</span></span><br><span class=\"line\"><span class=\"comment\">#PKG_SOURCE which is not defined here to download the source from the web.</span></span><br><span class=\"line\"><span class=\"comment\"># Inorder to just build a simple program that we have just written, it is</span></span><br><span class=\"line\"><span class=\"comment\"># mucheasier to do it this way.</span></span><br><span class=\"line\"><span class=\"keyword\">define</span> Build/Prepare</span><br><span class=\"line\">\tmkdir -p <span class=\"variable\">$(PKG_BUILD_DIR)</span></span><br><span class=\"line\">\t<span class=\"variable\">$(CP)</span> ./src/* <span class=\"variable\">$(PKG_BUILD_DIR)</span>/</span><br><span class=\"line\"><span class=\"keyword\">endef</span></span><br><span class=\"line\"><span class=\"comment\"># We donot need to define Build/Configure or Build/Compile directives</span></span><br><span class=\"line\"><span class=\"comment\"># Thedefaults are appropriate for compiling a simple program such as this one</span></span><br><span class=\"line\"><span class=\"comment\"># Specifywhere and how to install the program. Since we only have one file,</span></span><br><span class=\"line\"><span class=\"comment\"># thehelloworld executable, install it by copying it to the /bin directory on</span></span><br><span class=\"line\"><span class=\"comment\"># therouter. The $(1) variable represents the root directory on the router running</span></span><br><span class=\"line\"><span class=\"comment\">#OpenWrt. The $(INSTALL_DIR) variable contains a command to prepare the install</span></span><br><span class=\"line\"><span class=\"comment\">#directory if it does not already exist. Likewise $(INSTALL_BIN) contains the</span></span><br><span class=\"line\"><span class=\"comment\"># commandto copy the binary file from its current location (in our case the build</span></span><br><span class=\"line\"><span class=\"comment\">#directory) to the install directory.</span></span><br><span class=\"line\"><span class=\"keyword\">define</span> Package/<span class=\"variable\">$(PKG_NAME)</span>/install  <span class=\"comment\">#定义软件包安装行为</span></span><br><span class=\"line\">\t<span class=\"variable\">$(INSTALL_DIR)</span> $(1)/bin <span class=\"comment\">#需要安装的目录，这里必须先指定，不然编译的会报找不到目录的错误</span></span><br><span class=\"line\">\t<span class=\"variable\">$(INSTALL_BIN)</span> <span class=\"variable\">$(PKG_BUILD_DIR)</span>/Hello $(1)/bin/</span><br><span class=\"line\"><span class=\"keyword\">endef</span></span><br><span class=\"line\"><span class=\"comment\"># Thisline executes the necessary commands to compile our program.</span></span><br><span class=\"line\"><span class=\"comment\"># Theabove define directives specify all the information needed, but this</span></span><br><span class=\"line\"><span class=\"comment\"># linecalls BuildPackage which in turn actually uses this information to</span></span><br><span class=\"line\"><span class=\"comment\"># build apackage.</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$(<span class=\"built_in\">eval</span> $(<span class=\"built_in\">call</span> BuildPackage,<span class=\"variable\">$(PKG_NAME)</span>)</span>) <span class=\"comment\">#正式开始执行编译</span></span><br></pre></td></tr></table></figure>\n<p>代码编写完成后，就可以把软件包放到OpenWrt源码的Package目录或者OpenWrt SDk的Package目录中去，执行make，就可以生成ipk软件包了。</p>\n","site":{"data":{}},"excerpt":"<p>OpenWrt提供了方便的机制来让用用户可以l扩充和实现自己所需的功能。这篇博文就说明一下怎么构建一个能够安装在OpenWrt上ipk包的过程。</p>","more":"<p>1.文件目录</p>\n<pre><code>helloworld/\n├── Makefile  #Makefile 必不可少\n└── src #源码目录\n    ├── Hello.c #程序源码\n    └── Makefile #编译源码的Makefile\n</code></pre><p>2.文件内容</p>\n<p>src/Hello.c</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;stdio.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;unistd.h&gt;</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">(<span class=\"keyword\">void</span>)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">     <span class=\"built_in\">printf</span>(<span class=\"string\">\"Hell! Dear OpenWrt!\\n\\n\"</span>);</span><br><span class=\"line\">     <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>src/Makefile</p>\n<figure class=\"highlight makefile\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># build Hello executable when user executes \"make\"</span></span><br><span class=\"line\"><span class=\"section\">Hello:Hello.o</span></span><br><span class=\"line\">\t<span class=\"variable\">$(CC)</span> <span class=\"variable\">$(LDFLAGS)</span> Hello.o -o Hello</span><br><span class=\"line\"><span class=\"section\">Hello.o:Hello.c</span></span><br><span class=\"line\">\t<span class=\"variable\">$(CC)</span> <span class=\"variable\">$(CFLAGS)</span> -c Hello.c</span><br><span class=\"line\"><span class=\"comment\">#remove object files and executable when user executes \"make clean\"</span></span><br><span class=\"line\"><span class=\"section\">clean:</span></span><br><span class=\"line\">\trm *.o Hello</span><br></pre></td></tr></table></figure>\n<p>构建OpenWrt软件包最主要的内容都包括在Makefile中了，首先看一下Makefile的内容。</p>\n<p>Makefile</p>\n<figure class=\"highlight makefile\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">##############################################</span></span><br><span class=\"line\"><span class=\"comment\"># OpenWrtMakefile for HelloWorld program</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># Most ofthe variables used here are defined in</span></span><br><span class=\"line\"><span class=\"comment\"># theinclude directives below. We just need to</span></span><br><span class=\"line\"><span class=\"comment\"># specifya basic description of the package,</span></span><br><span class=\"line\"><span class=\"comment\"># whereto build our program, where to find</span></span><br><span class=\"line\"><span class=\"comment\"># thesource files, and where to install the</span></span><br><span class=\"line\"><span class=\"comment\"># compiled program on the router.</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># Be verycareful of spacing in this file.</span></span><br><span class=\"line\"><span class=\"comment\"># Indentsshould be tabs, not spaces, and</span></span><br><span class=\"line\"><span class=\"comment\"># thereshould be no trailing whitespace in</span></span><br><span class=\"line\"><span class=\"comment\"># linesthat are not commented.</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\">##############################################</span></span><br><span class=\"line\"><span class=\"keyword\">include</span> <span class=\"variable\">$(TOPDIR)</span>/rules.mk </span><br><span class=\"line\"><span class=\"comment\"># Nameand release number of this package</span></span><br><span class=\"line\">PKG_NAME:=Hello <span class=\"comment\">#软件包的名称，编译的时候可以看到，安装，卸载所用到的名称</span></span><br><span class=\"line\">PKG_RELEASE:=1 <span class=\"comment\">#软件包的版本</span></span><br><span class=\"line\"><span class=\"comment\"># Thisspecifies the directory where we're going to build the program.</span></span><br><span class=\"line\"><span class=\"comment\"># Theroot build directory, $(BUILD_DIR), is by default the build_mipsel</span></span><br><span class=\"line\"><span class=\"comment\">#directory in your OpenWrt SDK directory</span></span><br><span class=\"line\">PKG_BUILD_DIR:= <span class=\"variable\">$(BUILD_DIR)</span>/<span class=\"variable\">$(PKG_NAME)</span>  <span class=\"comment\">#源码所在的目录</span></span><br><span class=\"line\"><span class=\"keyword\">include</span> <span class=\"variable\">$(INCLUDE_DIR)</span>/package.mk</span><br><span class=\"line\"><span class=\"comment\"># Specifypackage information for this program.</span></span><br><span class=\"line\"><span class=\"comment\"># Thevariables defined here should be self explanatory.</span></span><br><span class=\"line\"><span class=\"comment\"># If youare running Kamikaze, delete the DESCRIPTION</span></span><br><span class=\"line\"><span class=\"comment\">#variable below and uncomment the Kamikaze define</span></span><br><span class=\"line\"><span class=\"comment\"># directivefor the description below</span></span><br><span class=\"line\"><span class=\"keyword\">define</span> Package/<span class=\"variable\">$(PKG_NAME)</span>  <span class=\"comment\">#这里是定义在make menuconfig的时候，该软件包出现的位置</span></span><br><span class=\"line\">\tSECTION:=utils</span><br><span class=\"line\">\tCATEGORY:=Utilities</span><br><span class=\"line\">\tTITLE:=HelloOpenwrt-- Start to build software on your router!</span><br><span class=\"line\"><span class=\"keyword\">endef</span></span><br><span class=\"line\"><span class=\"comment\"># Specifywhat needs to be done to prepare for building the package.</span></span><br><span class=\"line\"><span class=\"comment\"># In ourcase, we need to copy the source files to the build directory.</span></span><br><span class=\"line\"><span class=\"comment\"># This isNOT the default. The default uses thePKG_SOURCE_URL and the</span></span><br><span class=\"line\"><span class=\"comment\">#PKG_SOURCE which is not defined here to download the source from the web.</span></span><br><span class=\"line\"><span class=\"comment\"># Inorder to just build a simple program that we have just written, it is</span></span><br><span class=\"line\"><span class=\"comment\"># mucheasier to do it this way.</span></span><br><span class=\"line\"><span class=\"keyword\">define</span> Build/Prepare</span><br><span class=\"line\">\tmkdir -p <span class=\"variable\">$(PKG_BUILD_DIR)</span></span><br><span class=\"line\">\t<span class=\"variable\">$(CP)</span> ./src/* <span class=\"variable\">$(PKG_BUILD_DIR)</span>/</span><br><span class=\"line\"><span class=\"keyword\">endef</span></span><br><span class=\"line\"><span class=\"comment\"># We donot need to define Build/Configure or Build/Compile directives</span></span><br><span class=\"line\"><span class=\"comment\"># Thedefaults are appropriate for compiling a simple program such as this one</span></span><br><span class=\"line\"><span class=\"comment\"># Specifywhere and how to install the program. Since we only have one file,</span></span><br><span class=\"line\"><span class=\"comment\"># thehelloworld executable, install it by copying it to the /bin directory on</span></span><br><span class=\"line\"><span class=\"comment\"># therouter. The $(1) variable represents the root directory on the router running</span></span><br><span class=\"line\"><span class=\"comment\">#OpenWrt. The $(INSTALL_DIR) variable contains a command to prepare the install</span></span><br><span class=\"line\"><span class=\"comment\">#directory if it does not already exist. Likewise $(INSTALL_BIN) contains the</span></span><br><span class=\"line\"><span class=\"comment\"># commandto copy the binary file from its current location (in our case the build</span></span><br><span class=\"line\"><span class=\"comment\">#directory) to the install directory.</span></span><br><span class=\"line\"><span class=\"keyword\">define</span> Package/<span class=\"variable\">$(PKG_NAME)</span>/install  <span class=\"comment\">#定义软件包安装行为</span></span><br><span class=\"line\">\t<span class=\"variable\">$(INSTALL_DIR)</span> $(1)/bin <span class=\"comment\">#需要安装的目录，这里必须先指定，不然编译的会报找不到目录的错误</span></span><br><span class=\"line\">\t<span class=\"variable\">$(INSTALL_BIN)</span> <span class=\"variable\">$(PKG_BUILD_DIR)</span>/Hello $(1)/bin/</span><br><span class=\"line\"><span class=\"keyword\">endef</span></span><br><span class=\"line\"><span class=\"comment\"># Thisline executes the necessary commands to compile our program.</span></span><br><span class=\"line\"><span class=\"comment\"># Theabove define directives specify all the information needed, but this</span></span><br><span class=\"line\"><span class=\"comment\"># linecalls BuildPackage which in turn actually uses this information to</span></span><br><span class=\"line\"><span class=\"comment\"># build apackage.</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$(<span class=\"built_in\">eval</span> $(<span class=\"built_in\">call</span> BuildPackage,<span class=\"variable\">$(PKG_NAME)</span>)</span>) <span class=\"comment\">#正式开始执行编译</span></span><br></pre></td></tr></table></figure>\n<p>代码编写完成后，就可以把软件包放到OpenWrt源码的Package目录或者OpenWrt SDk的Package目录中去，执行make，就可以生成ipk软件包了。</p>"},{"title":"pwnable练习之fd","date":"2016-11-27T11:25:18.000Z","_content":"fd.c的代码如下：\n```\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\nchar buf[32];\nint main(int argc, char* argv[], char* envp[]){\n\tif(argc<2){\n\t\tprintf(\"pass argv[1] a number\\n\");\n\t\treturn 0;\n\t}\n\tint fd = atoi( argv[1] ) - 0x1234;\n\tint len = 0;\n\tlen = read(fd, buf, 32);\n\tif(!strcmp(\"LETMEWIN\\n\", buf)){\n\t\tprintf(\"good job :)\\n\");\n\t\tsystem(\"/bin/cat flag\");\n\t\texit(0);\n\t}\n\tprintf(\"learn about Linux file IO\\n\");\n\treturn 0;\n\n}\n\n```\n代码逻辑比较清楚，需要输入一个数字，然后减去0x1234，所得的值作为read函数的第一个参数，然后调用read函数读取输入，然后将读取的值和“LETMEWIN\\n”比较，若相等则cat输出flag文件中的值。  \n接下来我们看一下read函数的函数描述:\n<!-- more -->\n```c\nNAME\n       read - read from a file descriptor\n\nSYNOPSIS\n       #include <unistd.h>\n\n       ssize_t read(int fd, void *buf, size_t count);\n\n```\n可以看到第一个参数为文件描述符。在Linux系统中存在三个比较特殊的文件描述符：  \n\n| 文件描述符  |  用途  | POISX名称   |  stdio流  |\n| ------------|-------:| -----------:| ---------:|\n|0            |标准输入|STDIN_FILENO |  stdin    |\n|1            |标准输出|STDOUT_FILENO|  stdout   |\n|2            |标准错误|STDERR_FILENO|  stderr   |\n这里我们可以让read参数的第一个参数为0（从标准输入读取），然后输入“LETMEWIN”即可让程序执行cat flag操作。\n```\nfd@ubuntu:~$ ./fd 4660\nLETMEWIN\ngood job :)\nmommy! I think I know what a file descriptor is!!\n\n```\n注：fd,file decriptor 文件描述符\n\n","source":"_posts/Pwnable-fd.md","raw":"---\ntitle:  pwnable练习之fd \ndate: 2016-11-27 19:25:18\ncategories: CTF\ntags:\n- CTF\n- Linux\n- PWN\n- pwnable\n---\nfd.c的代码如下：\n```\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\nchar buf[32];\nint main(int argc, char* argv[], char* envp[]){\n\tif(argc<2){\n\t\tprintf(\"pass argv[1] a number\\n\");\n\t\treturn 0;\n\t}\n\tint fd = atoi( argv[1] ) - 0x1234;\n\tint len = 0;\n\tlen = read(fd, buf, 32);\n\tif(!strcmp(\"LETMEWIN\\n\", buf)){\n\t\tprintf(\"good job :)\\n\");\n\t\tsystem(\"/bin/cat flag\");\n\t\texit(0);\n\t}\n\tprintf(\"learn about Linux file IO\\n\");\n\treturn 0;\n\n}\n\n```\n代码逻辑比较清楚，需要输入一个数字，然后减去0x1234，所得的值作为read函数的第一个参数，然后调用read函数读取输入，然后将读取的值和“LETMEWIN\\n”比较，若相等则cat输出flag文件中的值。  \n接下来我们看一下read函数的函数描述:\n<!-- more -->\n```c\nNAME\n       read - read from a file descriptor\n\nSYNOPSIS\n       #include <unistd.h>\n\n       ssize_t read(int fd, void *buf, size_t count);\n\n```\n可以看到第一个参数为文件描述符。在Linux系统中存在三个比较特殊的文件描述符：  \n\n| 文件描述符  |  用途  | POISX名称   |  stdio流  |\n| ------------|-------:| -----------:| ---------:|\n|0            |标准输入|STDIN_FILENO |  stdin    |\n|1            |标准输出|STDOUT_FILENO|  stdout   |\n|2            |标准错误|STDERR_FILENO|  stderr   |\n这里我们可以让read参数的第一个参数为0（从标准输入读取），然后输入“LETMEWIN”即可让程序执行cat flag操作。\n```\nfd@ubuntu:~$ ./fd 4660\nLETMEWIN\ngood job :)\nmommy! I think I know what a file descriptor is!!\n\n```\n注：fd,file decriptor 文件描述符\n\n","slug":"Pwnable-fd","published":1,"updated":"2017-12-04T07:27:28.761Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjeqig1nl0037lgqasz7at99s","content":"<p>fd.c的代码如下：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#include &lt;stdio.h&gt;</span><br><span class=\"line\">#include &lt;stdlib.h&gt;</span><br><span class=\"line\">#include &lt;string.h&gt;</span><br><span class=\"line\">char buf[32];</span><br><span class=\"line\">int main(int argc, char* argv[], char* envp[])&#123;</span><br><span class=\"line\">\tif(argc&lt;2)&#123;</span><br><span class=\"line\">\t\tprintf(&quot;pass argv[1] a number\\n&quot;);</span><br><span class=\"line\">\t\treturn 0;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tint fd = atoi( argv[1] ) - 0x1234;</span><br><span class=\"line\">\tint len = 0;</span><br><span class=\"line\">\tlen = read(fd, buf, 32);</span><br><span class=\"line\">\tif(!strcmp(&quot;LETMEWIN\\n&quot;, buf))&#123;</span><br><span class=\"line\">\t\tprintf(&quot;good job :)\\n&quot;);</span><br><span class=\"line\">\t\tsystem(&quot;/bin/cat flag&quot;);</span><br><span class=\"line\">\t\texit(0);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tprintf(&quot;learn about Linux file IO\\n&quot;);</span><br><span class=\"line\">\treturn 0;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>代码逻辑比较清楚，需要输入一个数字，然后减去0x1234，所得的值作为read函数的第一个参数，然后调用read函数读取输入，然后将读取的值和“LETMEWIN\\n”比较，若相等则cat输出flag文件中的值。<br>接下来我们看一下read函数的函数描述:<br><a id=\"more\"></a><br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">NAME</span><br><span class=\"line\">       read - read from a file descriptor</span><br><span class=\"line\"></span><br><span class=\"line\">SYNOPSIS</span><br><span class=\"line\">       <span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;unistd.h&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">       <span class=\"keyword\">ssize_t</span> read(<span class=\"keyword\">int</span> fd, <span class=\"keyword\">void</span> *buf, <span class=\"keyword\">size_t</span> count);</span><br></pre></td></tr></table></figure></p>\n<p>可以看到第一个参数为文件描述符。在Linux系统中存在三个比较特殊的文件描述符：  </p>\n<table>\n<thead>\n<tr>\n<th>文件描述符</th>\n<th style=\"text-align:right\">用途</th>\n<th style=\"text-align:right\">POISX名称</th>\n<th style=\"text-align:right\">stdio流</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>0</td>\n<td style=\"text-align:right\">标准输入</td>\n<td style=\"text-align:right\">STDIN_FILENO</td>\n<td style=\"text-align:right\">stdin</td>\n</tr>\n<tr>\n<td>1</td>\n<td style=\"text-align:right\">标准输出</td>\n<td style=\"text-align:right\">STDOUT_FILENO</td>\n<td style=\"text-align:right\">stdout</td>\n</tr>\n<tr>\n<td>2</td>\n<td style=\"text-align:right\">标准错误</td>\n<td style=\"text-align:right\">STDERR_FILENO</td>\n<td style=\"text-align:right\">stderr</td>\n</tr>\n</tbody>\n</table>\n<p>这里我们可以让read参数的第一个参数为0（从标准输入读取），然后输入“LETMEWIN”即可让程序执行cat flag操作。<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">fd@ubuntu:~$ ./fd 4660</span><br><span class=\"line\">LETMEWIN</span><br><span class=\"line\">good job :)</span><br><span class=\"line\">mommy! I think I know what a file descriptor is!!</span><br></pre></td></tr></table></figure></p>\n<p>注：fd,file decriptor 文件描述符</p>\n","site":{"data":{}},"excerpt":"<p>fd.c的代码如下：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#include &lt;stdio.h&gt;</span><br><span class=\"line\">#include &lt;stdlib.h&gt;</span><br><span class=\"line\">#include &lt;string.h&gt;</span><br><span class=\"line\">char buf[32];</span><br><span class=\"line\">int main(int argc, char* argv[], char* envp[])&#123;</span><br><span class=\"line\">\tif(argc&lt;2)&#123;</span><br><span class=\"line\">\t\tprintf(&quot;pass argv[1] a number\\n&quot;);</span><br><span class=\"line\">\t\treturn 0;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tint fd = atoi( argv[1] ) - 0x1234;</span><br><span class=\"line\">\tint len = 0;</span><br><span class=\"line\">\tlen = read(fd, buf, 32);</span><br><span class=\"line\">\tif(!strcmp(&quot;LETMEWIN\\n&quot;, buf))&#123;</span><br><span class=\"line\">\t\tprintf(&quot;good job :)\\n&quot;);</span><br><span class=\"line\">\t\tsystem(&quot;/bin/cat flag&quot;);</span><br><span class=\"line\">\t\texit(0);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tprintf(&quot;learn about Linux file IO\\n&quot;);</span><br><span class=\"line\">\treturn 0;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>代码逻辑比较清楚，需要输入一个数字，然后减去0x1234，所得的值作为read函数的第一个参数，然后调用read函数读取输入，然后将读取的值和“LETMEWIN\\n”比较，若相等则cat输出flag文件中的值。<br>接下来我们看一下read函数的函数描述:<br>","more":"<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">NAME</span><br><span class=\"line\">       read - read from a file descriptor</span><br><span class=\"line\"></span><br><span class=\"line\">SYNOPSIS</span><br><span class=\"line\">       <span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;unistd.h&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">       <span class=\"keyword\">ssize_t</span> read(<span class=\"keyword\">int</span> fd, <span class=\"keyword\">void</span> *buf, <span class=\"keyword\">size_t</span> count);</span><br></pre></td></tr></table></figure></p>\n<p>可以看到第一个参数为文件描述符。在Linux系统中存在三个比较特殊的文件描述符：  </p>\n<table>\n<thead>\n<tr>\n<th>文件描述符</th>\n<th style=\"text-align:right\">用途</th>\n<th style=\"text-align:right\">POISX名称</th>\n<th style=\"text-align:right\">stdio流</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>0</td>\n<td style=\"text-align:right\">标准输入</td>\n<td style=\"text-align:right\">STDIN_FILENO</td>\n<td style=\"text-align:right\">stdin</td>\n</tr>\n<tr>\n<td>1</td>\n<td style=\"text-align:right\">标准输出</td>\n<td style=\"text-align:right\">STDOUT_FILENO</td>\n<td style=\"text-align:right\">stdout</td>\n</tr>\n<tr>\n<td>2</td>\n<td style=\"text-align:right\">标准错误</td>\n<td style=\"text-align:right\">STDERR_FILENO</td>\n<td style=\"text-align:right\">stderr</td>\n</tr>\n</tbody>\n</table>\n<p>这里我们可以让read参数的第一个参数为0（从标准输入读取），然后输入“LETMEWIN”即可让程序执行cat flag操作。<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">fd@ubuntu:~$ ./fd 4660</span><br><span class=\"line\">LETMEWIN</span><br><span class=\"line\">good job :)</span><br><span class=\"line\">mommy! I think I know what a file descriptor is!!</span><br></pre></td></tr></table></figure></p>\n<p>注：fd,file decriptor 文件描述符</p>"},{"title":"pwnable练习之collision","date":"2016-11-28T11:25:18.000Z","_content":"col.c代码如下：\n```c\n#include <stdio.h>\n#include <string.h>\nunsigned long hashcode = 0x21DD09EC;\nunsigned long check_password(const char* p){\n\tint* ip = (int*)p;\n\tint i;\n\tint res=0;\n\tfor(i=0; i<5; i++){\n\t\tres += ip[i];\n\t}\n\treturn res;\n}\n\nint main(int argc, char* argv[]){\n\tif(argc<2){\n\t\tprintf(\"usage : %s [passcode]\\n\", argv[0]);\n\t\treturn 0;\n\t}\n\tif(strlen(argv[1]) != 20){\n\t\tprintf(\"passcode length should be 20 bytes\\n\");\n\t\treturn 0;\n\t}\n\n\tif(hashcode == check_password( argv[1] )){\n\t\tsystem(\"/bin/cat flag\");\n\t\treturn 0;\n\t}\n\telse\n\t\tprintf(\"wrong passcode.\\n\");\n\treturn 0;\n}\n\n```\n观察代码，可知代码逻辑过程是：  \n1.先输入一个不少于20字节长度的值  \n2.对输入的前五位整数求和(int类型，一个int等于4字节，5位int类型，恰好20字节)  \n3.求得的和与0x21DD09EC比较，若相等则通过  \n<!-- more -->\n重点1：\n```c\nint* ip = (int*)p;\n```\n这里将输入的char类型的指针强制转换为了int指针，从而ip指针一次能够指向4个字节大小的内存区域。画个图模拟一下内存布局：  \n![image](/blogimg/collision.png)\n\n思路1：将0x21DD09EC除以5变为4字节为一组，分别输入，最后以4字节为一组进行求和即可。  \n比如：\n```python\n>>> 0x21DD09EC/5\n113626824\n>>> hex(0x21DD09EC/5)\n'0x6c5cec8'\n```\n哦，稍等。好像不能被5整除哦。换个方式：4 x 0x01010101 + 0x1dd905e8\n```python\n>>> hex(0x21DD09EC-4*0x01010101)\n'0x1dd905e8'\n>>>\n```\n接下我们把刚刚的值输入：\n```bash\ncol@ubuntu:~$ ./col `python -c \"print 16*'\\x01'+'\\xe8\\x05\\xd9\\x1d'\"`\ndaddy! I just managed to create a hash collision :)\ncol@ubuntu:~$ \n\n```\nYES,GET FLAG!\n\n\n","source":"_posts/Pwnable-collision.md","raw":"---\ntitle:  pwnable练习之collision \ndate: 2016-11-28 19:25:18\ncategories: CTF\ntags:\n- CTF\n- Linux\n- PWN\n- pwnable\n---\ncol.c代码如下：\n```c\n#include <stdio.h>\n#include <string.h>\nunsigned long hashcode = 0x21DD09EC;\nunsigned long check_password(const char* p){\n\tint* ip = (int*)p;\n\tint i;\n\tint res=0;\n\tfor(i=0; i<5; i++){\n\t\tres += ip[i];\n\t}\n\treturn res;\n}\n\nint main(int argc, char* argv[]){\n\tif(argc<2){\n\t\tprintf(\"usage : %s [passcode]\\n\", argv[0]);\n\t\treturn 0;\n\t}\n\tif(strlen(argv[1]) != 20){\n\t\tprintf(\"passcode length should be 20 bytes\\n\");\n\t\treturn 0;\n\t}\n\n\tif(hashcode == check_password( argv[1] )){\n\t\tsystem(\"/bin/cat flag\");\n\t\treturn 0;\n\t}\n\telse\n\t\tprintf(\"wrong passcode.\\n\");\n\treturn 0;\n}\n\n```\n观察代码，可知代码逻辑过程是：  \n1.先输入一个不少于20字节长度的值  \n2.对输入的前五位整数求和(int类型，一个int等于4字节，5位int类型，恰好20字节)  \n3.求得的和与0x21DD09EC比较，若相等则通过  \n<!-- more -->\n重点1：\n```c\nint* ip = (int*)p;\n```\n这里将输入的char类型的指针强制转换为了int指针，从而ip指针一次能够指向4个字节大小的内存区域。画个图模拟一下内存布局：  \n![image](/blogimg/collision.png)\n\n思路1：将0x21DD09EC除以5变为4字节为一组，分别输入，最后以4字节为一组进行求和即可。  \n比如：\n```python\n>>> 0x21DD09EC/5\n113626824\n>>> hex(0x21DD09EC/5)\n'0x6c5cec8'\n```\n哦，稍等。好像不能被5整除哦。换个方式：4 x 0x01010101 + 0x1dd905e8\n```python\n>>> hex(0x21DD09EC-4*0x01010101)\n'0x1dd905e8'\n>>>\n```\n接下我们把刚刚的值输入：\n```bash\ncol@ubuntu:~$ ./col `python -c \"print 16*'\\x01'+'\\xe8\\x05\\xd9\\x1d'\"`\ndaddy! I just managed to create a hash collision :)\ncol@ubuntu:~$ \n\n```\nYES,GET FLAG!\n\n\n","slug":"Pwnable-collision","published":1,"updated":"2017-12-04T07:27:28.761Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjeqig1no0039lgqafgjubjwr","content":"<p>col.c代码如下：<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;stdio.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;string.h&gt;</span></span></span><br><span class=\"line\"><span class=\"keyword\">unsigned</span> <span class=\"keyword\">long</span> hashcode = <span class=\"number\">0x21DD09EC</span>;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">unsigned</span> <span class=\"keyword\">long</span> <span class=\"title\">check_password</span><span class=\"params\">(<span class=\"keyword\">const</span> <span class=\"keyword\">char</span>* p)</span></span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">int</span>* ip = (<span class=\"keyword\">int</span>*)p;</span><br><span class=\"line\">\t<span class=\"keyword\">int</span> i;</span><br><span class=\"line\">\t<span class=\"keyword\">int</span> res=<span class=\"number\">0</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">for</span>(i=<span class=\"number\">0</span>; i&lt;<span class=\"number\">5</span>; i++)&#123;</span><br><span class=\"line\">\t\tres += ip[i];</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> res;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">(<span class=\"keyword\">int</span> argc, <span class=\"keyword\">char</span>* argv[])</span></span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span>(argc&lt;<span class=\"number\">2</span>)&#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">\"usage : %s [passcode]\\n\"</span>, argv[<span class=\"number\">0</span>]);</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span>(<span class=\"built_in\">strlen</span>(argv[<span class=\"number\">1</span>]) != <span class=\"number\">20</span>)&#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">\"passcode length should be 20 bytes\\n\"</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">if</span>(hashcode == check_password( argv[<span class=\"number\">1</span>] ))&#123;</span><br><span class=\"line\">\t\tsystem(<span class=\"string\">\"/bin/cat flag\"</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">\"wrong passcode.\\n\"</span>);</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>观察代码，可知代码逻辑过程是：<br>1.先输入一个不少于20字节长度的值<br>2.对输入的前五位整数求和(int类型，一个int等于4字节，5位int类型，恰好20字节)<br>3.求得的和与0x21DD09EC比较，若相等则通过<br><a id=\"more\"></a><br>重点1：<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">int</span>* ip = (<span class=\"keyword\">int</span>*)p;</span><br></pre></td></tr></table></figure></p>\n<p>这里将输入的char类型的指针强制转换为了int指针，从而ip指针一次能够指向4个字节大小的内存区域。画个图模拟一下内存布局：<br><img src=\"/blogimg/collision.png\" alt=\"image\"></p>\n<p>思路1：将0x21DD09EC除以5变为4字节为一组，分别输入，最后以4字节为一组进行求和即可。<br>比如：<br><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span><span class=\"number\">0x21DD09EC</span>/<span class=\"number\">5</span></span><br><span class=\"line\"><span class=\"number\">113626824</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>hex(<span class=\"number\">0x21DD09EC</span>/<span class=\"number\">5</span>)</span><br><span class=\"line\"><span class=\"string\">'0x6c5cec8'</span></span><br></pre></td></tr></table></figure></p>\n<p>哦，稍等。好像不能被5整除哦。换个方式：4 x 0x01010101 + 0x1dd905e8<br><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>hex(<span class=\"number\">0x21DD09EC</span><span class=\"number\">-4</span>*<span class=\"number\">0x01010101</span>)</span><br><span class=\"line\"><span class=\"string\">'0x1dd905e8'</span></span><br><span class=\"line\">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure></p>\n<p>接下我们把刚刚的值输入：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">col@ubuntu:~$ ./col `python -c <span class=\"string\">\"print 16*'\\x01'+'\\xe8\\x05\\xd9\\x1d'\"</span>`</span><br><span class=\"line\">daddy! I just managed to create a <span class=\"built_in\">hash</span> collision :)</span><br><span class=\"line\">col@ubuntu:~$</span><br></pre></td></tr></table></figure></p>\n<p>YES,GET FLAG!</p>\n","site":{"data":{}},"excerpt":"<p>col.c代码如下：<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;stdio.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;string.h&gt;</span></span></span><br><span class=\"line\"><span class=\"keyword\">unsigned</span> <span class=\"keyword\">long</span> hashcode = <span class=\"number\">0x21DD09EC</span>;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">unsigned</span> <span class=\"keyword\">long</span> <span class=\"title\">check_password</span><span class=\"params\">(<span class=\"keyword\">const</span> <span class=\"keyword\">char</span>* p)</span></span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">int</span>* ip = (<span class=\"keyword\">int</span>*)p;</span><br><span class=\"line\">\t<span class=\"keyword\">int</span> i;</span><br><span class=\"line\">\t<span class=\"keyword\">int</span> res=<span class=\"number\">0</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">for</span>(i=<span class=\"number\">0</span>; i&lt;<span class=\"number\">5</span>; i++)&#123;</span><br><span class=\"line\">\t\tres += ip[i];</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> res;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">(<span class=\"keyword\">int</span> argc, <span class=\"keyword\">char</span>* argv[])</span></span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span>(argc&lt;<span class=\"number\">2</span>)&#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">\"usage : %s [passcode]\\n\"</span>, argv[<span class=\"number\">0</span>]);</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span>(<span class=\"built_in\">strlen</span>(argv[<span class=\"number\">1</span>]) != <span class=\"number\">20</span>)&#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">\"passcode length should be 20 bytes\\n\"</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">if</span>(hashcode == check_password( argv[<span class=\"number\">1</span>] ))&#123;</span><br><span class=\"line\">\t\tsystem(<span class=\"string\">\"/bin/cat flag\"</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">\"wrong passcode.\\n\"</span>);</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>观察代码，可知代码逻辑过程是：<br>1.先输入一个不少于20字节长度的值<br>2.对输入的前五位整数求和(int类型，一个int等于4字节，5位int类型，恰好20字节)<br>3.求得的和与0x21DD09EC比较，若相等则通过<br>","more":"<br>重点1：<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">int</span>* ip = (<span class=\"keyword\">int</span>*)p;</span><br></pre></td></tr></table></figure></p>\n<p>这里将输入的char类型的指针强制转换为了int指针，从而ip指针一次能够指向4个字节大小的内存区域。画个图模拟一下内存布局：<br><img src=\"/blogimg/collision.png\" alt=\"image\"></p>\n<p>思路1：将0x21DD09EC除以5变为4字节为一组，分别输入，最后以4字节为一组进行求和即可。<br>比如：<br><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span><span class=\"number\">0x21DD09EC</span>/<span class=\"number\">5</span></span><br><span class=\"line\"><span class=\"number\">113626824</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>hex(<span class=\"number\">0x21DD09EC</span>/<span class=\"number\">5</span>)</span><br><span class=\"line\"><span class=\"string\">'0x6c5cec8'</span></span><br></pre></td></tr></table></figure></p>\n<p>哦，稍等。好像不能被5整除哦。换个方式：4 x 0x01010101 + 0x1dd905e8<br><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>hex(<span class=\"number\">0x21DD09EC</span><span class=\"number\">-4</span>*<span class=\"number\">0x01010101</span>)</span><br><span class=\"line\"><span class=\"string\">'0x1dd905e8'</span></span><br><span class=\"line\">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure></p>\n<p>接下我们把刚刚的值输入：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">col@ubuntu:~$ ./col `python -c <span class=\"string\">\"print 16*'\\x01'+'\\xe8\\x05\\xd9\\x1d'\"</span>`</span><br><span class=\"line\">daddy! I just managed to create a <span class=\"built_in\">hash</span> collision :)</span><br><span class=\"line\">col@ubuntu:~$</span><br></pre></td></tr></table></figure></p>\n<p>YES,GET FLAG!</p>"},{"title":"在python中使用epoll实现非阻塞io","date":"2017-10-19T07:08:41.000Z","_content":"\n#### 0x1 啥是epoll？\n\nepoll - I/O event notification facility---事件驱动的io。\n\n​\t在传统的网络编程中，listen，send，recv函数都是阻塞的。在一个过程中你只能乖乖的等着数据的到来才能进行下一步操作，这就非常影响效率了。为了解决阻塞的问题，先后有了select和poll方式来轮询io事件，这两种方式虽然已经提高了效率，但是他们是无差别轮询，还是浪费了一点时间。所以有了epoll，它只将发生变化的io事件通知我们，大大提高了性能，广泛应用于高并发的请求的程序中。\n\n<!--more-->\n\n#### 0x2 在python中咋用\n\n​\tpython中的select模块提供epoll的操作接口，那么先介绍一下使用epoll的基本步骤：\n\n​\t\t1.创建一个epoll对象\n\n​\t\t2.将需要监听的socket注册到epoll对象上\n\n​\t\t3.询问epoll对象，在某个时间段内是否发生了指定的io事件\n\n​\t\t4.得到发生了io事件的socket，对这些socket进行读写或者其他操作\n\n​\t\t5.告诉epoll对象，是否需要修改socket对象的状态或事件，继续进行监控\n\n​\t\t6.重复3-5，直到完成\n\n​\t\t7.销毁epoll对象\n\n​\tepoll对象的一些方法：\n\n```python\nimport select 导入select模块\n\nepoll = select.epoll() 创建一个epoll对象\n\nepoll.register(文件句柄,事件类型) 注册要监控的文件句柄和事件\n\n事件类型:\n\n　　select.EPOLLIN    可读事件\n\n　　select.EPOLLOUT   可写事件\n\n　　select.EPOLLERR   错误事件\n\n　　select.EPOLLHUP   客户端断开事件\n\nepoll.unregister(文件句柄)   销毁文件句柄\n\nepoll.poll(timeout)  当文件句柄发生变化，则会以列表的形式主动报告给用户进程,timeout\n\n                     为超时时间，默认为-1，即一直等待直到文件句柄发生变化，如果指定为1\n\n                     那么epoll每1秒汇报一次当前文件句柄的变化情况，如果无变化则返回空\n\nepoll.fileno() 返回epoll的控制文件描述符(Return the epoll control file descriptor)\n\nepoll.modfiy(fineno,event) fineno为文件描述符 event为事件类型  作用是修改文件描述符所对应的事件\n\nepoll.fromfd(fileno) 从1个指定的文件描述符创建1个epoll对象\n\nepoll.close()   关闭epoll对象的控制文件描述符\n```\n\n​\tepoll的一个基于状态触发（level-triggered）的例子：\n\n```python\n#!/usr/bin/env python\n# -*- coding:utf-8 -*-\n\n\nimport socket\nimport select\n\n\nEOL1 = b'\\n\\n'\nEOL2 = b'\\n\\r\\n'\nresponse = b'HTTP/1.0 200 OK\\r\\nDate: Mon, 1 Jan 2017 10:10:10 GMT\\r\\n'\nresponse += b'Content-Type: text/plain\\r\\nContent-Length: 13\\r\\n\\r\\n'\nresponse += b'Hello, World!'\n\n#创建一个tcp套接字\nserversocket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)\n#设置端口复用\nserversocket.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)\nserversocket.bind(('0.0.0.0', 8080))\nserversocket.listen(5)\nserversocket.setblocking(0)\n#创建epoll对象\nepoll = select.epoll()\n#将服务器的套接注册到epoll对象中，由epoll对象监听有关事件\nepoll.register(serversocket.fileno(), select.EPOLLIN)\n\n\ntry:\n\tconnections = {}\n\trequests = {}\n\tresponses = {}\n\twhile True:\n        #从epoll对象中查询近1s时间内的I/O事件\n\t\tevents = epoll.poll(1)\n\t\tfor fileno, event in events:\n            #如果发生事件的是服务器套接字，表示有客户端连接\n\t\t\tif fileno == serversocket.fileno():\n\t\t\t\tconnection, address = serversocket.accept()\n                #将接收到的套接字设置为非阻塞\n\t\t\t\tconnection.setblocking(0)\n                #向epoll对象中注册客户端连接，监听客户端是否发送数据\n\t\t\t\tepoll.register(connection.fileno(), select.EPOLLIN)\n\t\t\t\tconnections[connection.fileno()] = connection\n\t\t\t\trequests[connection.fileno()] = b''\n\t\t\t\tresponses[connection.fileno()] = response\n                #epoll对象监听到有客户端发送数据的事件\n\t\t\telif event & select.EPOLLIN:\n                #尝试接收客户端的数据\n\t\t\t\trequests[fileno] += connections[fileno].recv(1024)\n\t\t\t\tif EOL1 in requests[fileno] or EOL2 in requests[fileno]:\n\t\t\t\t\tepoll.modify(fileno, select.EPOLLOUT)\n\t\t\t\t\tprint '-'*40 + '\\n' + requests[fileno].decode()[:-2]\n            #epoll对象监听到有准备就绪的可发送数据的连接\n\t\t\telif event & select.EPOLLOUT:\n                #向客户端发送数据\n\t\t\t\tbyteswritten = connections[fileno].send(responses[fileno])\n\t\t\t\tresponses[fileno] = responses[fileno][byteswritten:]\n\t\t\t\tif len(responses[fileno]) == 0:\n\t\t\t\t\tepoll.modify(fileno, 0)\n\t\t\t\t\tconnections[fileno].shutdown(socket.SHUT_RDWR)\n            #epoll监听到终止连接的事件\n\t\t\telif event & select.EPOLLHUP:\n\t\t\t\tepoll.unregister(fileno)\n\t\t\t\tconnections[fileno].close()\n\t\t\t\tdel connections[fileno]\n\t\n\nfinally:\n\tepoll.unregister(serversocket.fileno())\n\tepoll.close()\n\tserversocket.close()\n```\n\n运行结果：\n\n```shell\n//服务端\nxing@xing:~/pypractice$ python epoll_demo1.py \n----------------------------------------\nGET / HTTP/1.1\nHost: 10.70.27.36:8080\nConnection: keep-alive\nCache-Control: max-age=0\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/62.0.3202.62 Safari/537.36\nUpgrade-Insecure-Requests: 1\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8\nAccept-Encoding: gzip, deflate\nAccept-Language: zh-CN,zh;q=0.9\n\n//客户端：\nPS C:\\Users\\STAR_CHEN> http 10.70.27.36:8080\nHTTP/1.0 200 OK\nContent-Length: 13\nContent-Type: text/plain\nDate: Mon, 1 Jan 2017 10:10:10 GMT\n\nHello, World!\n```\n\nepoll基于边沿触发（edge-triggered）的一个例子：\n\n```python\n#!/usr/bin/env python\n# -*- coding:utf-8 -*-\n\n\nimport socket\nimport select\n\n\nEOL1 = b'\\n\\n'\nEOL2 = b'\\n\\r\\n'\nresponse = b'HTTP/1.0 200 OK\\r\\nDate: Mon, 1 Jan 2017 10:10:10 GMT\\r\\n'\nresponse += b'Content-Type: text/plain\\r\\nContent-Length: 13\\r\\n\\r\\n'\nresponse += b'Hello, World!'\n\n\nserversocket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)\nserversocket.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)\nserversocket.bind(('0.0.0.0', 8080))\nserversocket.listen(5)\nserversocket.setblocking(0)\n\nepoll = select.epoll()\n#同时注册可读和可写的掩码\nepoll.register(serversocket.fileno(), select.EPOLLIN | select.EPOLLOUT)\n\n\ntry:\n\tconnections = {}\n\trequests = {}\n\tresponses = {}\n\twhile True:\n\t\tevents = epoll.poll(1)\n\t\tfor fileno, event in events:\n\t\t\tif fileno == serversocket.fileno():\n\t\t\t\ttry:\n                  #自己进行循环，处理io事件\n\t\t\t\t\twhile True:\n\t\t\t\t\t\tconnection, address = serversocket.accept()\n\t\t\t\t\t\tconnection.setblocking(0)\n                        #同时注册可读和可写的掩码\n\t\t\t\t\t\tepoll.register(connection.fileno(), select.EPOLLIN | select.EPOLLET)\n\t\t\t\t\t\tconnections[connection.fileno()] = connection\n\t\t\t\t\t\trequests[connection.fileno()] = b''\n\t\t\t\t\t\tresponses[connection.fileno()] = response\n\t\t\t\texcept socket.error:\n\t\t\t\t\tpass\n\t\t\telif event & select.EPOLLIN:\n\t\t\t\ttry:\n\t\t\t\t\twhile True:\n\t\t\t\t\t\trequests[fileno] += connections[fileno].recv(1024)\n\t\t\t\texcept socket.error:\n\t\t\t\t\tpass\n\t\t\t\tif EOL1 in requests[fileno] or EOL2 in requests[fileno]:\n\t\t\t\t\tepoll.modify(fileno, select.EPOLLOUT | select.EPOLLET)\n\t\t\t\t\tprint '-'*40 + '\\n' + requests[fileno].decode()[:-2]\n\t\t\telif event & select.EPOLLOUT:\n\t\t\t\ttry:\n\t\t\t\t\twhile len(response[fileno]) > 0:\n\t\t\t\t\t\tbyteswritten = connections[fileno].send(responses[fileno])\n\t\t\t\t\t\tresponses[fileno] = responses[fileno][byteswritten:]\n\t\t\t\texcept socket.error:\n\t\t\t\t\tpass\n\t\t\t\tif len(responses[fileno]) == 0:\n\t\t\t\t\tepoll.modify(fileno, 0)\n\t\t\t\t\tconnections[fileno].shutdown(socket.SHUT_RDWR)\n\t\t\telif event & select.EPOLLHUP:\n\t\t\t\tepoll.unregister(fileno)\n\t\t\t\tconnections[fileno].close()\n\t\t\t\tdel connections[fileno]\n\t\n\nfinally:\n\tepoll.unregister(serversocket.fileno())\n\tepoll.close()\n\tserversocket.close()\n```\n\n#### 0x3 总结\n\n采用边沿触发的特点：\n\n​\t当被监控的文件描述符上有可读写事件发生时，epoll_wait()会通知处理程序去读写。如果这次没有把数据全部读写完(如读写缓冲区太小)，那么下次调用epoll_wait()时，它不会通知你，也就是它只会通知你一次，直到该文件描述符上出现第二次可读写事件才会通知你！！！这种模式比水平触发效率高，系统不会充斥大量你不关心的就绪文件描述符！！！\n\n​\t使用边沿触发需要注意，将连接设置为非阻塞，并且一次性将数据读取完。\n\n水平触发的特点：\n\n​\t当被监控的文件描述符上有可读写事件发生时，epoll_wait()会通知处理程序去读写。如果这次没有把数据一次性全部读写完(如读写缓冲区太小)，那么下次调用 epoll_wait()时，它还会通知你在上没读写完的文件描述符上继续读写，当然如果你一直不去读写，它会一直通知你！！！如果系统中有大量你不需要读写的就绪文件描述符，而它们每次都会返回，这样会大大降低处理程序检索自己关心的就绪文件描述符的效率！！！\n\n\n\n参考链接：\n\nhttp://www.cnblogs.com/yuuyuu/p/5103744.html\n\n http://blog.csdn.net/hehe123456zxc/article/details/52526670\n\n http://blog.csdn.net/voidccc/article/details/8619632\n\n http://blog.csdn.net/q576709166/article/details/8649911  EPOLL中有关事件意义\n\n","source":"_posts/PythonEpoll.md","raw":"---\ntitle: 在python中使用epoll实现非阻塞io\ncategories:\n  - Program\ntags:\n  - python\ndate: 2017-10-19 15:08:41\n---\n\n#### 0x1 啥是epoll？\n\nepoll - I/O event notification facility---事件驱动的io。\n\n​\t在传统的网络编程中，listen，send，recv函数都是阻塞的。在一个过程中你只能乖乖的等着数据的到来才能进行下一步操作，这就非常影响效率了。为了解决阻塞的问题，先后有了select和poll方式来轮询io事件，这两种方式虽然已经提高了效率，但是他们是无差别轮询，还是浪费了一点时间。所以有了epoll，它只将发生变化的io事件通知我们，大大提高了性能，广泛应用于高并发的请求的程序中。\n\n<!--more-->\n\n#### 0x2 在python中咋用\n\n​\tpython中的select模块提供epoll的操作接口，那么先介绍一下使用epoll的基本步骤：\n\n​\t\t1.创建一个epoll对象\n\n​\t\t2.将需要监听的socket注册到epoll对象上\n\n​\t\t3.询问epoll对象，在某个时间段内是否发生了指定的io事件\n\n​\t\t4.得到发生了io事件的socket，对这些socket进行读写或者其他操作\n\n​\t\t5.告诉epoll对象，是否需要修改socket对象的状态或事件，继续进行监控\n\n​\t\t6.重复3-5，直到完成\n\n​\t\t7.销毁epoll对象\n\n​\tepoll对象的一些方法：\n\n```python\nimport select 导入select模块\n\nepoll = select.epoll() 创建一个epoll对象\n\nepoll.register(文件句柄,事件类型) 注册要监控的文件句柄和事件\n\n事件类型:\n\n　　select.EPOLLIN    可读事件\n\n　　select.EPOLLOUT   可写事件\n\n　　select.EPOLLERR   错误事件\n\n　　select.EPOLLHUP   客户端断开事件\n\nepoll.unregister(文件句柄)   销毁文件句柄\n\nepoll.poll(timeout)  当文件句柄发生变化，则会以列表的形式主动报告给用户进程,timeout\n\n                     为超时时间，默认为-1，即一直等待直到文件句柄发生变化，如果指定为1\n\n                     那么epoll每1秒汇报一次当前文件句柄的变化情况，如果无变化则返回空\n\nepoll.fileno() 返回epoll的控制文件描述符(Return the epoll control file descriptor)\n\nepoll.modfiy(fineno,event) fineno为文件描述符 event为事件类型  作用是修改文件描述符所对应的事件\n\nepoll.fromfd(fileno) 从1个指定的文件描述符创建1个epoll对象\n\nepoll.close()   关闭epoll对象的控制文件描述符\n```\n\n​\tepoll的一个基于状态触发（level-triggered）的例子：\n\n```python\n#!/usr/bin/env python\n# -*- coding:utf-8 -*-\n\n\nimport socket\nimport select\n\n\nEOL1 = b'\\n\\n'\nEOL2 = b'\\n\\r\\n'\nresponse = b'HTTP/1.0 200 OK\\r\\nDate: Mon, 1 Jan 2017 10:10:10 GMT\\r\\n'\nresponse += b'Content-Type: text/plain\\r\\nContent-Length: 13\\r\\n\\r\\n'\nresponse += b'Hello, World!'\n\n#创建一个tcp套接字\nserversocket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)\n#设置端口复用\nserversocket.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)\nserversocket.bind(('0.0.0.0', 8080))\nserversocket.listen(5)\nserversocket.setblocking(0)\n#创建epoll对象\nepoll = select.epoll()\n#将服务器的套接注册到epoll对象中，由epoll对象监听有关事件\nepoll.register(serversocket.fileno(), select.EPOLLIN)\n\n\ntry:\n\tconnections = {}\n\trequests = {}\n\tresponses = {}\n\twhile True:\n        #从epoll对象中查询近1s时间内的I/O事件\n\t\tevents = epoll.poll(1)\n\t\tfor fileno, event in events:\n            #如果发生事件的是服务器套接字，表示有客户端连接\n\t\t\tif fileno == serversocket.fileno():\n\t\t\t\tconnection, address = serversocket.accept()\n                #将接收到的套接字设置为非阻塞\n\t\t\t\tconnection.setblocking(0)\n                #向epoll对象中注册客户端连接，监听客户端是否发送数据\n\t\t\t\tepoll.register(connection.fileno(), select.EPOLLIN)\n\t\t\t\tconnections[connection.fileno()] = connection\n\t\t\t\trequests[connection.fileno()] = b''\n\t\t\t\tresponses[connection.fileno()] = response\n                #epoll对象监听到有客户端发送数据的事件\n\t\t\telif event & select.EPOLLIN:\n                #尝试接收客户端的数据\n\t\t\t\trequests[fileno] += connections[fileno].recv(1024)\n\t\t\t\tif EOL1 in requests[fileno] or EOL2 in requests[fileno]:\n\t\t\t\t\tepoll.modify(fileno, select.EPOLLOUT)\n\t\t\t\t\tprint '-'*40 + '\\n' + requests[fileno].decode()[:-2]\n            #epoll对象监听到有准备就绪的可发送数据的连接\n\t\t\telif event & select.EPOLLOUT:\n                #向客户端发送数据\n\t\t\t\tbyteswritten = connections[fileno].send(responses[fileno])\n\t\t\t\tresponses[fileno] = responses[fileno][byteswritten:]\n\t\t\t\tif len(responses[fileno]) == 0:\n\t\t\t\t\tepoll.modify(fileno, 0)\n\t\t\t\t\tconnections[fileno].shutdown(socket.SHUT_RDWR)\n            #epoll监听到终止连接的事件\n\t\t\telif event & select.EPOLLHUP:\n\t\t\t\tepoll.unregister(fileno)\n\t\t\t\tconnections[fileno].close()\n\t\t\t\tdel connections[fileno]\n\t\n\nfinally:\n\tepoll.unregister(serversocket.fileno())\n\tepoll.close()\n\tserversocket.close()\n```\n\n运行结果：\n\n```shell\n//服务端\nxing@xing:~/pypractice$ python epoll_demo1.py \n----------------------------------------\nGET / HTTP/1.1\nHost: 10.70.27.36:8080\nConnection: keep-alive\nCache-Control: max-age=0\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/62.0.3202.62 Safari/537.36\nUpgrade-Insecure-Requests: 1\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8\nAccept-Encoding: gzip, deflate\nAccept-Language: zh-CN,zh;q=0.9\n\n//客户端：\nPS C:\\Users\\STAR_CHEN> http 10.70.27.36:8080\nHTTP/1.0 200 OK\nContent-Length: 13\nContent-Type: text/plain\nDate: Mon, 1 Jan 2017 10:10:10 GMT\n\nHello, World!\n```\n\nepoll基于边沿触发（edge-triggered）的一个例子：\n\n```python\n#!/usr/bin/env python\n# -*- coding:utf-8 -*-\n\n\nimport socket\nimport select\n\n\nEOL1 = b'\\n\\n'\nEOL2 = b'\\n\\r\\n'\nresponse = b'HTTP/1.0 200 OK\\r\\nDate: Mon, 1 Jan 2017 10:10:10 GMT\\r\\n'\nresponse += b'Content-Type: text/plain\\r\\nContent-Length: 13\\r\\n\\r\\n'\nresponse += b'Hello, World!'\n\n\nserversocket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)\nserversocket.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)\nserversocket.bind(('0.0.0.0', 8080))\nserversocket.listen(5)\nserversocket.setblocking(0)\n\nepoll = select.epoll()\n#同时注册可读和可写的掩码\nepoll.register(serversocket.fileno(), select.EPOLLIN | select.EPOLLOUT)\n\n\ntry:\n\tconnections = {}\n\trequests = {}\n\tresponses = {}\n\twhile True:\n\t\tevents = epoll.poll(1)\n\t\tfor fileno, event in events:\n\t\t\tif fileno == serversocket.fileno():\n\t\t\t\ttry:\n                  #自己进行循环，处理io事件\n\t\t\t\t\twhile True:\n\t\t\t\t\t\tconnection, address = serversocket.accept()\n\t\t\t\t\t\tconnection.setblocking(0)\n                        #同时注册可读和可写的掩码\n\t\t\t\t\t\tepoll.register(connection.fileno(), select.EPOLLIN | select.EPOLLET)\n\t\t\t\t\t\tconnections[connection.fileno()] = connection\n\t\t\t\t\t\trequests[connection.fileno()] = b''\n\t\t\t\t\t\tresponses[connection.fileno()] = response\n\t\t\t\texcept socket.error:\n\t\t\t\t\tpass\n\t\t\telif event & select.EPOLLIN:\n\t\t\t\ttry:\n\t\t\t\t\twhile True:\n\t\t\t\t\t\trequests[fileno] += connections[fileno].recv(1024)\n\t\t\t\texcept socket.error:\n\t\t\t\t\tpass\n\t\t\t\tif EOL1 in requests[fileno] or EOL2 in requests[fileno]:\n\t\t\t\t\tepoll.modify(fileno, select.EPOLLOUT | select.EPOLLET)\n\t\t\t\t\tprint '-'*40 + '\\n' + requests[fileno].decode()[:-2]\n\t\t\telif event & select.EPOLLOUT:\n\t\t\t\ttry:\n\t\t\t\t\twhile len(response[fileno]) > 0:\n\t\t\t\t\t\tbyteswritten = connections[fileno].send(responses[fileno])\n\t\t\t\t\t\tresponses[fileno] = responses[fileno][byteswritten:]\n\t\t\t\texcept socket.error:\n\t\t\t\t\tpass\n\t\t\t\tif len(responses[fileno]) == 0:\n\t\t\t\t\tepoll.modify(fileno, 0)\n\t\t\t\t\tconnections[fileno].shutdown(socket.SHUT_RDWR)\n\t\t\telif event & select.EPOLLHUP:\n\t\t\t\tepoll.unregister(fileno)\n\t\t\t\tconnections[fileno].close()\n\t\t\t\tdel connections[fileno]\n\t\n\nfinally:\n\tepoll.unregister(serversocket.fileno())\n\tepoll.close()\n\tserversocket.close()\n```\n\n#### 0x3 总结\n\n采用边沿触发的特点：\n\n​\t当被监控的文件描述符上有可读写事件发生时，epoll_wait()会通知处理程序去读写。如果这次没有把数据全部读写完(如读写缓冲区太小)，那么下次调用epoll_wait()时，它不会通知你，也就是它只会通知你一次，直到该文件描述符上出现第二次可读写事件才会通知你！！！这种模式比水平触发效率高，系统不会充斥大量你不关心的就绪文件描述符！！！\n\n​\t使用边沿触发需要注意，将连接设置为非阻塞，并且一次性将数据读取完。\n\n水平触发的特点：\n\n​\t当被监控的文件描述符上有可读写事件发生时，epoll_wait()会通知处理程序去读写。如果这次没有把数据一次性全部读写完(如读写缓冲区太小)，那么下次调用 epoll_wait()时，它还会通知你在上没读写完的文件描述符上继续读写，当然如果你一直不去读写，它会一直通知你！！！如果系统中有大量你不需要读写的就绪文件描述符，而它们每次都会返回，这样会大大降低处理程序检索自己关心的就绪文件描述符的效率！！！\n\n\n\n参考链接：\n\nhttp://www.cnblogs.com/yuuyuu/p/5103744.html\n\n http://blog.csdn.net/hehe123456zxc/article/details/52526670\n\n http://blog.csdn.net/voidccc/article/details/8619632\n\n http://blog.csdn.net/q576709166/article/details/8649911  EPOLL中有关事件意义\n\n","slug":"PythonEpoll","published":1,"updated":"2017-12-04T07:27:28.761Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjeqig1nt003clgqayebaubiy","content":"<h4 id=\"0x1-啥是epoll？\"><a href=\"#0x1-啥是epoll？\" class=\"headerlink\" title=\"0x1 啥是epoll？\"></a>0x1 啥是epoll？</h4><p>epoll - I/O event notification facility—事件驱动的io。</p>\n<p>​    在传统的网络编程中，listen，send，recv函数都是阻塞的。在一个过程中你只能乖乖的等着数据的到来才能进行下一步操作，这就非常影响效率了。为了解决阻塞的问题，先后有了select和poll方式来轮询io事件，这两种方式虽然已经提高了效率，但是他们是无差别轮询，还是浪费了一点时间。所以有了epoll，它只将发生变化的io事件通知我们，大大提高了性能，广泛应用于高并发的请求的程序中。</p>\n<a id=\"more\"></a>\n<h4 id=\"0x2-在python中咋用\"><a href=\"#0x2-在python中咋用\" class=\"headerlink\" title=\"0x2 在python中咋用\"></a>0x2 在python中咋用</h4><p>​    python中的select模块提供epoll的操作接口，那么先介绍一下使用epoll的基本步骤：</p>\n<p>​        1.创建一个epoll对象</p>\n<p>​        2.将需要监听的socket注册到epoll对象上</p>\n<p>​        3.询问epoll对象，在某个时间段内是否发生了指定的io事件</p>\n<p>​        4.得到发生了io事件的socket，对这些socket进行读写或者其他操作</p>\n<p>​        5.告诉epoll对象，是否需要修改socket对象的状态或事件，继续进行监控</p>\n<p>​        6.重复3-5，直到完成</p>\n<p>​        7.销毁epoll对象</p>\n<p>​    epoll对象的一些方法：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> select 导入select模块</span><br><span class=\"line\"></span><br><span class=\"line\">epoll = select.epoll() 创建一个epoll对象</span><br><span class=\"line\"></span><br><span class=\"line\">epoll.register(文件句柄,事件类型) 注册要监控的文件句柄和事件</span><br><span class=\"line\"></span><br><span class=\"line\">事件类型:</span><br><span class=\"line\"></span><br><span class=\"line\">　　select.EPOLLIN    可读事件</span><br><span class=\"line\"></span><br><span class=\"line\">　　select.EPOLLOUT   可写事件</span><br><span class=\"line\"></span><br><span class=\"line\">　　select.EPOLLERR   错误事件</span><br><span class=\"line\"></span><br><span class=\"line\">　　select.EPOLLHUP   客户端断开事件</span><br><span class=\"line\"></span><br><span class=\"line\">epoll.unregister(文件句柄)   销毁文件句柄</span><br><span class=\"line\"></span><br><span class=\"line\">epoll.poll(timeout)  当文件句柄发生变化，则会以列表的形式主动报告给用户进程,timeout</span><br><span class=\"line\"></span><br><span class=\"line\">                     为超时时间，默认为<span class=\"number\">-1</span>，即一直等待直到文件句柄发生变化，如果指定为<span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\">                     那么epoll每<span class=\"number\">1</span>秒汇报一次当前文件句柄的变化情况，如果无变化则返回空</span><br><span class=\"line\"></span><br><span class=\"line\">epoll.fileno() 返回epoll的控制文件描述符(Return the epoll control file descriptor)</span><br><span class=\"line\"></span><br><span class=\"line\">epoll.modfiy(fineno,event) fineno为文件描述符 event为事件类型  作用是修改文件描述符所对应的事件</span><br><span class=\"line\"></span><br><span class=\"line\">epoll.fromfd(fileno) 从<span class=\"number\">1</span>个指定的文件描述符创建<span class=\"number\">1</span>个epoll对象</span><br><span class=\"line\"></span><br><span class=\"line\">epoll.close()   关闭epoll对象的控制文件描述符</span><br></pre></td></tr></table></figure>\n<p>​    epoll的一个基于状态触发（level-triggered）的例子：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/usr/bin/env python</span></span><br><span class=\"line\"><span class=\"comment\"># -*- coding:utf-8 -*-</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> socket</span><br><span class=\"line\"><span class=\"keyword\">import</span> select</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">EOL1 = <span class=\"string\">b'\\n\\n'</span></span><br><span class=\"line\">EOL2 = <span class=\"string\">b'\\n\\r\\n'</span></span><br><span class=\"line\">response = <span class=\"string\">b'HTTP/1.0 200 OK\\r\\nDate: Mon, 1 Jan 2017 10:10:10 GMT\\r\\n'</span></span><br><span class=\"line\">response += <span class=\"string\">b'Content-Type: text/plain\\r\\nContent-Length: 13\\r\\n\\r\\n'</span></span><br><span class=\"line\">response += <span class=\"string\">b'Hello, World!'</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#创建一个tcp套接字</span></span><br><span class=\"line\">serversocket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class=\"line\"><span class=\"comment\">#设置端口复用</span></span><br><span class=\"line\">serversocket.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, <span class=\"number\">1</span>)</span><br><span class=\"line\">serversocket.bind((<span class=\"string\">'0.0.0.0'</span>, <span class=\"number\">8080</span>))</span><br><span class=\"line\">serversocket.listen(<span class=\"number\">5</span>)</span><br><span class=\"line\">serversocket.setblocking(<span class=\"number\">0</span>)</span><br><span class=\"line\"><span class=\"comment\">#创建epoll对象</span></span><br><span class=\"line\">epoll = select.epoll()</span><br><span class=\"line\"><span class=\"comment\">#将服务器的套接注册到epoll对象中，由epoll对象监听有关事件</span></span><br><span class=\"line\">epoll.register(serversocket.fileno(), select.EPOLLIN)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">try</span>:</span><br><span class=\"line\">\tconnections = &#123;&#125;</span><br><span class=\"line\">\trequests = &#123;&#125;</span><br><span class=\"line\">\tresponses = &#123;&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">while</span> <span class=\"keyword\">True</span>:</span><br><span class=\"line\">        <span class=\"comment\">#从epoll对象中查询近1s时间内的I/O事件</span></span><br><span class=\"line\">\t\tevents = epoll.poll(<span class=\"number\">1</span>)</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> fileno, event <span class=\"keyword\">in</span> events:</span><br><span class=\"line\">            <span class=\"comment\">#如果发生事件的是服务器套接字，表示有客户端连接</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> fileno == serversocket.fileno():</span><br><span class=\"line\">\t\t\t\tconnection, address = serversocket.accept()</span><br><span class=\"line\">                <span class=\"comment\">#将接收到的套接字设置为非阻塞</span></span><br><span class=\"line\">\t\t\t\tconnection.setblocking(<span class=\"number\">0</span>)</span><br><span class=\"line\">                <span class=\"comment\">#向epoll对象中注册客户端连接，监听客户端是否发送数据</span></span><br><span class=\"line\">\t\t\t\tepoll.register(connection.fileno(), select.EPOLLIN)</span><br><span class=\"line\">\t\t\t\tconnections[connection.fileno()] = connection</span><br><span class=\"line\">\t\t\t\trequests[connection.fileno()] = <span class=\"string\">b''</span></span><br><span class=\"line\">\t\t\t\tresponses[connection.fileno()] = response</span><br><span class=\"line\">                <span class=\"comment\">#epoll对象监听到有客户端发送数据的事件</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">elif</span> event &amp; select.EPOLLIN:</span><br><span class=\"line\">                <span class=\"comment\">#尝试接收客户端的数据</span></span><br><span class=\"line\">\t\t\t\trequests[fileno] += connections[fileno].recv(<span class=\"number\">1024</span>)</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> EOL1 <span class=\"keyword\">in</span> requests[fileno] <span class=\"keyword\">or</span> EOL2 <span class=\"keyword\">in</span> requests[fileno]:</span><br><span class=\"line\">\t\t\t\t\tepoll.modify(fileno, select.EPOLLOUT)</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">print</span> <span class=\"string\">'-'</span>*<span class=\"number\">40</span> + <span class=\"string\">'\\n'</span> + requests[fileno].decode()[:<span class=\"number\">-2</span>]</span><br><span class=\"line\">            <span class=\"comment\">#epoll对象监听到有准备就绪的可发送数据的连接</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">elif</span> event &amp; select.EPOLLOUT:</span><br><span class=\"line\">                <span class=\"comment\">#向客户端发送数据</span></span><br><span class=\"line\">\t\t\t\tbyteswritten = connections[fileno].send(responses[fileno])</span><br><span class=\"line\">\t\t\t\tresponses[fileno] = responses[fileno][byteswritten:]</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> len(responses[fileno]) == <span class=\"number\">0</span>:</span><br><span class=\"line\">\t\t\t\t\tepoll.modify(fileno, <span class=\"number\">0</span>)</span><br><span class=\"line\">\t\t\t\t\tconnections[fileno].shutdown(socket.SHUT_RDWR)</span><br><span class=\"line\">            <span class=\"comment\">#epoll监听到终止连接的事件</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">elif</span> event &amp; select.EPOLLHUP:</span><br><span class=\"line\">\t\t\t\tepoll.unregister(fileno)</span><br><span class=\"line\">\t\t\t\tconnections[fileno].close()</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">del</span> connections[fileno]</span><br><span class=\"line\">\t</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">finally</span>:</span><br><span class=\"line\">\tepoll.unregister(serversocket.fileno())</span><br><span class=\"line\">\tepoll.close()</span><br><span class=\"line\">\tserversocket.close()</span><br></pre></td></tr></table></figure>\n<p>运行结果：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//服务端</span><br><span class=\"line\">xing@xing:~/pypractice$ python epoll_demo1.py </span><br><span class=\"line\">----------------------------------------</span><br><span class=\"line\">GET / HTTP/1.1</span><br><span class=\"line\">Host: 10.70.27.36:8080</span><br><span class=\"line\">Connection: keep-alive</span><br><span class=\"line\">Cache-Control: max-age=0</span><br><span class=\"line\">User-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/62.0.3202.62 Safari/537.36</span><br><span class=\"line\">Upgrade-Insecure-Requests: 1</span><br><span class=\"line\">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8</span><br><span class=\"line\">Accept-Encoding: gzip, deflate</span><br><span class=\"line\">Accept-Language: zh-CN,zh;q=0.9</span><br><span class=\"line\"></span><br><span class=\"line\">//客户端：</span><br><span class=\"line\">PS C:\\Users\\STAR_CHEN&gt; http 10.70.27.36:8080</span><br><span class=\"line\">HTTP/1.0 200 OK</span><br><span class=\"line\">Content-Length: 13</span><br><span class=\"line\">Content-Type: text/plain</span><br><span class=\"line\">Date: Mon, 1 Jan 2017 10:10:10 GMT</span><br><span class=\"line\"></span><br><span class=\"line\">Hello, World!</span><br></pre></td></tr></table></figure>\n<p>epoll基于边沿触发（edge-triggered）的一个例子：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/usr/bin/env python</span></span><br><span class=\"line\"><span class=\"comment\"># -*- coding:utf-8 -*-</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> socket</span><br><span class=\"line\"><span class=\"keyword\">import</span> select</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">EOL1 = <span class=\"string\">b'\\n\\n'</span></span><br><span class=\"line\">EOL2 = <span class=\"string\">b'\\n\\r\\n'</span></span><br><span class=\"line\">response = <span class=\"string\">b'HTTP/1.0 200 OK\\r\\nDate: Mon, 1 Jan 2017 10:10:10 GMT\\r\\n'</span></span><br><span class=\"line\">response += <span class=\"string\">b'Content-Type: text/plain\\r\\nContent-Length: 13\\r\\n\\r\\n'</span></span><br><span class=\"line\">response += <span class=\"string\">b'Hello, World!'</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">serversocket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class=\"line\">serversocket.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, <span class=\"number\">1</span>)</span><br><span class=\"line\">serversocket.bind((<span class=\"string\">'0.0.0.0'</span>, <span class=\"number\">8080</span>))</span><br><span class=\"line\">serversocket.listen(<span class=\"number\">5</span>)</span><br><span class=\"line\">serversocket.setblocking(<span class=\"number\">0</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">epoll = select.epoll()</span><br><span class=\"line\"><span class=\"comment\">#同时注册可读和可写的掩码</span></span><br><span class=\"line\">epoll.register(serversocket.fileno(), select.EPOLLIN | select.EPOLLOUT)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">try</span>:</span><br><span class=\"line\">\tconnections = &#123;&#125;</span><br><span class=\"line\">\trequests = &#123;&#125;</span><br><span class=\"line\">\tresponses = &#123;&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">while</span> <span class=\"keyword\">True</span>:</span><br><span class=\"line\">\t\tevents = epoll.poll(<span class=\"number\">1</span>)</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> fileno, event <span class=\"keyword\">in</span> events:</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> fileno == serversocket.fileno():</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">try</span>:</span><br><span class=\"line\">                  <span class=\"comment\">#自己进行循环，处理io事件</span></span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">while</span> <span class=\"keyword\">True</span>:</span><br><span class=\"line\">\t\t\t\t\t\tconnection, address = serversocket.accept()</span><br><span class=\"line\">\t\t\t\t\t\tconnection.setblocking(<span class=\"number\">0</span>)</span><br><span class=\"line\">                        <span class=\"comment\">#同时注册可读和可写的掩码</span></span><br><span class=\"line\">\t\t\t\t\t\tepoll.register(connection.fileno(), select.EPOLLIN | select.EPOLLET)</span><br><span class=\"line\">\t\t\t\t\t\tconnections[connection.fileno()] = connection</span><br><span class=\"line\">\t\t\t\t\t\trequests[connection.fileno()] = <span class=\"string\">b''</span></span><br><span class=\"line\">\t\t\t\t\t\tresponses[connection.fileno()] = response</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">except</span> socket.error:</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">pass</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">elif</span> event &amp; select.EPOLLIN:</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">try</span>:</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">while</span> <span class=\"keyword\">True</span>:</span><br><span class=\"line\">\t\t\t\t\t\trequests[fileno] += connections[fileno].recv(<span class=\"number\">1024</span>)</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">except</span> socket.error:</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">pass</span></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> EOL1 <span class=\"keyword\">in</span> requests[fileno] <span class=\"keyword\">or</span> EOL2 <span class=\"keyword\">in</span> requests[fileno]:</span><br><span class=\"line\">\t\t\t\t\tepoll.modify(fileno, select.EPOLLOUT | select.EPOLLET)</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">print</span> <span class=\"string\">'-'</span>*<span class=\"number\">40</span> + <span class=\"string\">'\\n'</span> + requests[fileno].decode()[:<span class=\"number\">-2</span>]</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">elif</span> event &amp; select.EPOLLOUT:</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">try</span>:</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">while</span> len(response[fileno]) &gt; <span class=\"number\">0</span>:</span><br><span class=\"line\">\t\t\t\t\t\tbyteswritten = connections[fileno].send(responses[fileno])</span><br><span class=\"line\">\t\t\t\t\t\tresponses[fileno] = responses[fileno][byteswritten:]</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">except</span> socket.error:</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">pass</span></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> len(responses[fileno]) == <span class=\"number\">0</span>:</span><br><span class=\"line\">\t\t\t\t\tepoll.modify(fileno, <span class=\"number\">0</span>)</span><br><span class=\"line\">\t\t\t\t\tconnections[fileno].shutdown(socket.SHUT_RDWR)</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">elif</span> event &amp; select.EPOLLHUP:</span><br><span class=\"line\">\t\t\t\tepoll.unregister(fileno)</span><br><span class=\"line\">\t\t\t\tconnections[fileno].close()</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">del</span> connections[fileno]</span><br><span class=\"line\">\t</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">finally</span>:</span><br><span class=\"line\">\tepoll.unregister(serversocket.fileno())</span><br><span class=\"line\">\tepoll.close()</span><br><span class=\"line\">\tserversocket.close()</span><br></pre></td></tr></table></figure>\n<h4 id=\"0x3-总结\"><a href=\"#0x3-总结\" class=\"headerlink\" title=\"0x3 总结\"></a>0x3 总结</h4><p>采用边沿触发的特点：</p>\n<p>​    当被监控的文件描述符上有可读写事件发生时，epoll_wait()会通知处理程序去读写。如果这次没有把数据全部读写完(如读写缓冲区太小)，那么下次调用epoll_wait()时，它不会通知你，也就是它只会通知你一次，直到该文件描述符上出现第二次可读写事件才会通知你！！！这种模式比水平触发效率高，系统不会充斥大量你不关心的就绪文件描述符！！！</p>\n<p>​    使用边沿触发需要注意，将连接设置为非阻塞，并且一次性将数据读取完。</p>\n<p>水平触发的特点：</p>\n<p>​    当被监控的文件描述符上有可读写事件发生时，epoll_wait()会通知处理程序去读写。如果这次没有把数据一次性全部读写完(如读写缓冲区太小)，那么下次调用 epoll_wait()时，它还会通知你在上没读写完的文件描述符上继续读写，当然如果你一直不去读写，它会一直通知你！！！如果系统中有大量你不需要读写的就绪文件描述符，而它们每次都会返回，这样会大大降低处理程序检索自己关心的就绪文件描述符的效率！！！</p>\n<p>参考链接：</p>\n<p><a href=\"http://www.cnblogs.com/yuuyuu/p/5103744.html\" target=\"_blank\" rel=\"noopener\">http://www.cnblogs.com/yuuyuu/p/5103744.html</a></p>\n<p> <a href=\"http://blog.csdn.net/hehe123456zxc/article/details/52526670\" target=\"_blank\" rel=\"noopener\">http://blog.csdn.net/hehe123456zxc/article/details/52526670</a></p>\n<p> <a href=\"http://blog.csdn.net/voidccc/article/details/8619632\" target=\"_blank\" rel=\"noopener\">http://blog.csdn.net/voidccc/article/details/8619632</a></p>\n<p> <a href=\"http://blog.csdn.net/q576709166/article/details/8649911\" target=\"_blank\" rel=\"noopener\">http://blog.csdn.net/q576709166/article/details/8649911</a>  EPOLL中有关事件意义</p>\n","site":{"data":{}},"excerpt":"<h4 id=\"0x1-啥是epoll？\"><a href=\"#0x1-啥是epoll？\" class=\"headerlink\" title=\"0x1 啥是epoll？\"></a>0x1 啥是epoll？</h4><p>epoll - I/O event notification facility—事件驱动的io。</p>\n<p>​    在传统的网络编程中，listen，send，recv函数都是阻塞的。在一个过程中你只能乖乖的等着数据的到来才能进行下一步操作，这就非常影响效率了。为了解决阻塞的问题，先后有了select和poll方式来轮询io事件，这两种方式虽然已经提高了效率，但是他们是无差别轮询，还是浪费了一点时间。所以有了epoll，它只将发生变化的io事件通知我们，大大提高了性能，广泛应用于高并发的请求的程序中。</p>","more":"<h4 id=\"0x2-在python中咋用\"><a href=\"#0x2-在python中咋用\" class=\"headerlink\" title=\"0x2 在python中咋用\"></a>0x2 在python中咋用</h4><p>​    python中的select模块提供epoll的操作接口，那么先介绍一下使用epoll的基本步骤：</p>\n<p>​        1.创建一个epoll对象</p>\n<p>​        2.将需要监听的socket注册到epoll对象上</p>\n<p>​        3.询问epoll对象，在某个时间段内是否发生了指定的io事件</p>\n<p>​        4.得到发生了io事件的socket，对这些socket进行读写或者其他操作</p>\n<p>​        5.告诉epoll对象，是否需要修改socket对象的状态或事件，继续进行监控</p>\n<p>​        6.重复3-5，直到完成</p>\n<p>​        7.销毁epoll对象</p>\n<p>​    epoll对象的一些方法：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> select 导入select模块</span><br><span class=\"line\"></span><br><span class=\"line\">epoll = select.epoll() 创建一个epoll对象</span><br><span class=\"line\"></span><br><span class=\"line\">epoll.register(文件句柄,事件类型) 注册要监控的文件句柄和事件</span><br><span class=\"line\"></span><br><span class=\"line\">事件类型:</span><br><span class=\"line\"></span><br><span class=\"line\">　　select.EPOLLIN    可读事件</span><br><span class=\"line\"></span><br><span class=\"line\">　　select.EPOLLOUT   可写事件</span><br><span class=\"line\"></span><br><span class=\"line\">　　select.EPOLLERR   错误事件</span><br><span class=\"line\"></span><br><span class=\"line\">　　select.EPOLLHUP   客户端断开事件</span><br><span class=\"line\"></span><br><span class=\"line\">epoll.unregister(文件句柄)   销毁文件句柄</span><br><span class=\"line\"></span><br><span class=\"line\">epoll.poll(timeout)  当文件句柄发生变化，则会以列表的形式主动报告给用户进程,timeout</span><br><span class=\"line\"></span><br><span class=\"line\">                     为超时时间，默认为<span class=\"number\">-1</span>，即一直等待直到文件句柄发生变化，如果指定为<span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\">                     那么epoll每<span class=\"number\">1</span>秒汇报一次当前文件句柄的变化情况，如果无变化则返回空</span><br><span class=\"line\"></span><br><span class=\"line\">epoll.fileno() 返回epoll的控制文件描述符(Return the epoll control file descriptor)</span><br><span class=\"line\"></span><br><span class=\"line\">epoll.modfiy(fineno,event) fineno为文件描述符 event为事件类型  作用是修改文件描述符所对应的事件</span><br><span class=\"line\"></span><br><span class=\"line\">epoll.fromfd(fileno) 从<span class=\"number\">1</span>个指定的文件描述符创建<span class=\"number\">1</span>个epoll对象</span><br><span class=\"line\"></span><br><span class=\"line\">epoll.close()   关闭epoll对象的控制文件描述符</span><br></pre></td></tr></table></figure>\n<p>​    epoll的一个基于状态触发（level-triggered）的例子：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/usr/bin/env python</span></span><br><span class=\"line\"><span class=\"comment\"># -*- coding:utf-8 -*-</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> socket</span><br><span class=\"line\"><span class=\"keyword\">import</span> select</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">EOL1 = <span class=\"string\">b'\\n\\n'</span></span><br><span class=\"line\">EOL2 = <span class=\"string\">b'\\n\\r\\n'</span></span><br><span class=\"line\">response = <span class=\"string\">b'HTTP/1.0 200 OK\\r\\nDate: Mon, 1 Jan 2017 10:10:10 GMT\\r\\n'</span></span><br><span class=\"line\">response += <span class=\"string\">b'Content-Type: text/plain\\r\\nContent-Length: 13\\r\\n\\r\\n'</span></span><br><span class=\"line\">response += <span class=\"string\">b'Hello, World!'</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#创建一个tcp套接字</span></span><br><span class=\"line\">serversocket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class=\"line\"><span class=\"comment\">#设置端口复用</span></span><br><span class=\"line\">serversocket.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, <span class=\"number\">1</span>)</span><br><span class=\"line\">serversocket.bind((<span class=\"string\">'0.0.0.0'</span>, <span class=\"number\">8080</span>))</span><br><span class=\"line\">serversocket.listen(<span class=\"number\">5</span>)</span><br><span class=\"line\">serversocket.setblocking(<span class=\"number\">0</span>)</span><br><span class=\"line\"><span class=\"comment\">#创建epoll对象</span></span><br><span class=\"line\">epoll = select.epoll()</span><br><span class=\"line\"><span class=\"comment\">#将服务器的套接注册到epoll对象中，由epoll对象监听有关事件</span></span><br><span class=\"line\">epoll.register(serversocket.fileno(), select.EPOLLIN)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">try</span>:</span><br><span class=\"line\">\tconnections = &#123;&#125;</span><br><span class=\"line\">\trequests = &#123;&#125;</span><br><span class=\"line\">\tresponses = &#123;&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">while</span> <span class=\"keyword\">True</span>:</span><br><span class=\"line\">        <span class=\"comment\">#从epoll对象中查询近1s时间内的I/O事件</span></span><br><span class=\"line\">\t\tevents = epoll.poll(<span class=\"number\">1</span>)</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> fileno, event <span class=\"keyword\">in</span> events:</span><br><span class=\"line\">            <span class=\"comment\">#如果发生事件的是服务器套接字，表示有客户端连接</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> fileno == serversocket.fileno():</span><br><span class=\"line\">\t\t\t\tconnection, address = serversocket.accept()</span><br><span class=\"line\">                <span class=\"comment\">#将接收到的套接字设置为非阻塞</span></span><br><span class=\"line\">\t\t\t\tconnection.setblocking(<span class=\"number\">0</span>)</span><br><span class=\"line\">                <span class=\"comment\">#向epoll对象中注册客户端连接，监听客户端是否发送数据</span></span><br><span class=\"line\">\t\t\t\tepoll.register(connection.fileno(), select.EPOLLIN)</span><br><span class=\"line\">\t\t\t\tconnections[connection.fileno()] = connection</span><br><span class=\"line\">\t\t\t\trequests[connection.fileno()] = <span class=\"string\">b''</span></span><br><span class=\"line\">\t\t\t\tresponses[connection.fileno()] = response</span><br><span class=\"line\">                <span class=\"comment\">#epoll对象监听到有客户端发送数据的事件</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">elif</span> event &amp; select.EPOLLIN:</span><br><span class=\"line\">                <span class=\"comment\">#尝试接收客户端的数据</span></span><br><span class=\"line\">\t\t\t\trequests[fileno] += connections[fileno].recv(<span class=\"number\">1024</span>)</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> EOL1 <span class=\"keyword\">in</span> requests[fileno] <span class=\"keyword\">or</span> EOL2 <span class=\"keyword\">in</span> requests[fileno]:</span><br><span class=\"line\">\t\t\t\t\tepoll.modify(fileno, select.EPOLLOUT)</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">print</span> <span class=\"string\">'-'</span>*<span class=\"number\">40</span> + <span class=\"string\">'\\n'</span> + requests[fileno].decode()[:<span class=\"number\">-2</span>]</span><br><span class=\"line\">            <span class=\"comment\">#epoll对象监听到有准备就绪的可发送数据的连接</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">elif</span> event &amp; select.EPOLLOUT:</span><br><span class=\"line\">                <span class=\"comment\">#向客户端发送数据</span></span><br><span class=\"line\">\t\t\t\tbyteswritten = connections[fileno].send(responses[fileno])</span><br><span class=\"line\">\t\t\t\tresponses[fileno] = responses[fileno][byteswritten:]</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> len(responses[fileno]) == <span class=\"number\">0</span>:</span><br><span class=\"line\">\t\t\t\t\tepoll.modify(fileno, <span class=\"number\">0</span>)</span><br><span class=\"line\">\t\t\t\t\tconnections[fileno].shutdown(socket.SHUT_RDWR)</span><br><span class=\"line\">            <span class=\"comment\">#epoll监听到终止连接的事件</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">elif</span> event &amp; select.EPOLLHUP:</span><br><span class=\"line\">\t\t\t\tepoll.unregister(fileno)</span><br><span class=\"line\">\t\t\t\tconnections[fileno].close()</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">del</span> connections[fileno]</span><br><span class=\"line\">\t</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">finally</span>:</span><br><span class=\"line\">\tepoll.unregister(serversocket.fileno())</span><br><span class=\"line\">\tepoll.close()</span><br><span class=\"line\">\tserversocket.close()</span><br></pre></td></tr></table></figure>\n<p>运行结果：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//服务端</span><br><span class=\"line\">xing@xing:~/pypractice$ python epoll_demo1.py </span><br><span class=\"line\">----------------------------------------</span><br><span class=\"line\">GET / HTTP/1.1</span><br><span class=\"line\">Host: 10.70.27.36:8080</span><br><span class=\"line\">Connection: keep-alive</span><br><span class=\"line\">Cache-Control: max-age=0</span><br><span class=\"line\">User-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/62.0.3202.62 Safari/537.36</span><br><span class=\"line\">Upgrade-Insecure-Requests: 1</span><br><span class=\"line\">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8</span><br><span class=\"line\">Accept-Encoding: gzip, deflate</span><br><span class=\"line\">Accept-Language: zh-CN,zh;q=0.9</span><br><span class=\"line\"></span><br><span class=\"line\">//客户端：</span><br><span class=\"line\">PS C:\\Users\\STAR_CHEN&gt; http 10.70.27.36:8080</span><br><span class=\"line\">HTTP/1.0 200 OK</span><br><span class=\"line\">Content-Length: 13</span><br><span class=\"line\">Content-Type: text/plain</span><br><span class=\"line\">Date: Mon, 1 Jan 2017 10:10:10 GMT</span><br><span class=\"line\"></span><br><span class=\"line\">Hello, World!</span><br></pre></td></tr></table></figure>\n<p>epoll基于边沿触发（edge-triggered）的一个例子：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/usr/bin/env python</span></span><br><span class=\"line\"><span class=\"comment\"># -*- coding:utf-8 -*-</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> socket</span><br><span class=\"line\"><span class=\"keyword\">import</span> select</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">EOL1 = <span class=\"string\">b'\\n\\n'</span></span><br><span class=\"line\">EOL2 = <span class=\"string\">b'\\n\\r\\n'</span></span><br><span class=\"line\">response = <span class=\"string\">b'HTTP/1.0 200 OK\\r\\nDate: Mon, 1 Jan 2017 10:10:10 GMT\\r\\n'</span></span><br><span class=\"line\">response += <span class=\"string\">b'Content-Type: text/plain\\r\\nContent-Length: 13\\r\\n\\r\\n'</span></span><br><span class=\"line\">response += <span class=\"string\">b'Hello, World!'</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">serversocket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class=\"line\">serversocket.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, <span class=\"number\">1</span>)</span><br><span class=\"line\">serversocket.bind((<span class=\"string\">'0.0.0.0'</span>, <span class=\"number\">8080</span>))</span><br><span class=\"line\">serversocket.listen(<span class=\"number\">5</span>)</span><br><span class=\"line\">serversocket.setblocking(<span class=\"number\">0</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">epoll = select.epoll()</span><br><span class=\"line\"><span class=\"comment\">#同时注册可读和可写的掩码</span></span><br><span class=\"line\">epoll.register(serversocket.fileno(), select.EPOLLIN | select.EPOLLOUT)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">try</span>:</span><br><span class=\"line\">\tconnections = &#123;&#125;</span><br><span class=\"line\">\trequests = &#123;&#125;</span><br><span class=\"line\">\tresponses = &#123;&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">while</span> <span class=\"keyword\">True</span>:</span><br><span class=\"line\">\t\tevents = epoll.poll(<span class=\"number\">1</span>)</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> fileno, event <span class=\"keyword\">in</span> events:</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> fileno == serversocket.fileno():</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">try</span>:</span><br><span class=\"line\">                  <span class=\"comment\">#自己进行循环，处理io事件</span></span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">while</span> <span class=\"keyword\">True</span>:</span><br><span class=\"line\">\t\t\t\t\t\tconnection, address = serversocket.accept()</span><br><span class=\"line\">\t\t\t\t\t\tconnection.setblocking(<span class=\"number\">0</span>)</span><br><span class=\"line\">                        <span class=\"comment\">#同时注册可读和可写的掩码</span></span><br><span class=\"line\">\t\t\t\t\t\tepoll.register(connection.fileno(), select.EPOLLIN | select.EPOLLET)</span><br><span class=\"line\">\t\t\t\t\t\tconnections[connection.fileno()] = connection</span><br><span class=\"line\">\t\t\t\t\t\trequests[connection.fileno()] = <span class=\"string\">b''</span></span><br><span class=\"line\">\t\t\t\t\t\tresponses[connection.fileno()] = response</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">except</span> socket.error:</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">pass</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">elif</span> event &amp; select.EPOLLIN:</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">try</span>:</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">while</span> <span class=\"keyword\">True</span>:</span><br><span class=\"line\">\t\t\t\t\t\trequests[fileno] += connections[fileno].recv(<span class=\"number\">1024</span>)</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">except</span> socket.error:</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">pass</span></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> EOL1 <span class=\"keyword\">in</span> requests[fileno] <span class=\"keyword\">or</span> EOL2 <span class=\"keyword\">in</span> requests[fileno]:</span><br><span class=\"line\">\t\t\t\t\tepoll.modify(fileno, select.EPOLLOUT | select.EPOLLET)</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">print</span> <span class=\"string\">'-'</span>*<span class=\"number\">40</span> + <span class=\"string\">'\\n'</span> + requests[fileno].decode()[:<span class=\"number\">-2</span>]</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">elif</span> event &amp; select.EPOLLOUT:</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">try</span>:</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">while</span> len(response[fileno]) &gt; <span class=\"number\">0</span>:</span><br><span class=\"line\">\t\t\t\t\t\tbyteswritten = connections[fileno].send(responses[fileno])</span><br><span class=\"line\">\t\t\t\t\t\tresponses[fileno] = responses[fileno][byteswritten:]</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">except</span> socket.error:</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">pass</span></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> len(responses[fileno]) == <span class=\"number\">0</span>:</span><br><span class=\"line\">\t\t\t\t\tepoll.modify(fileno, <span class=\"number\">0</span>)</span><br><span class=\"line\">\t\t\t\t\tconnections[fileno].shutdown(socket.SHUT_RDWR)</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">elif</span> event &amp; select.EPOLLHUP:</span><br><span class=\"line\">\t\t\t\tepoll.unregister(fileno)</span><br><span class=\"line\">\t\t\t\tconnections[fileno].close()</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">del</span> connections[fileno]</span><br><span class=\"line\">\t</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">finally</span>:</span><br><span class=\"line\">\tepoll.unregister(serversocket.fileno())</span><br><span class=\"line\">\tepoll.close()</span><br><span class=\"line\">\tserversocket.close()</span><br></pre></td></tr></table></figure>\n<h4 id=\"0x3-总结\"><a href=\"#0x3-总结\" class=\"headerlink\" title=\"0x3 总结\"></a>0x3 总结</h4><p>采用边沿触发的特点：</p>\n<p>​    当被监控的文件描述符上有可读写事件发生时，epoll_wait()会通知处理程序去读写。如果这次没有把数据全部读写完(如读写缓冲区太小)，那么下次调用epoll_wait()时，它不会通知你，也就是它只会通知你一次，直到该文件描述符上出现第二次可读写事件才会通知你！！！这种模式比水平触发效率高，系统不会充斥大量你不关心的就绪文件描述符！！！</p>\n<p>​    使用边沿触发需要注意，将连接设置为非阻塞，并且一次性将数据读取完。</p>\n<p>水平触发的特点：</p>\n<p>​    当被监控的文件描述符上有可读写事件发生时，epoll_wait()会通知处理程序去读写。如果这次没有把数据一次性全部读写完(如读写缓冲区太小)，那么下次调用 epoll_wait()时，它还会通知你在上没读写完的文件描述符上继续读写，当然如果你一直不去读写，它会一直通知你！！！如果系统中有大量你不需要读写的就绪文件描述符，而它们每次都会返回，这样会大大降低处理程序检索自己关心的就绪文件描述符的效率！！！</p>\n<p>参考链接：</p>\n<p><a href=\"http://www.cnblogs.com/yuuyuu/p/5103744.html\" target=\"_blank\" rel=\"noopener\">http://www.cnblogs.com/yuuyuu/p/5103744.html</a></p>\n<p> <a href=\"http://blog.csdn.net/hehe123456zxc/article/details/52526670\" target=\"_blank\" rel=\"noopener\">http://blog.csdn.net/hehe123456zxc/article/details/52526670</a></p>\n<p> <a href=\"http://blog.csdn.net/voidccc/article/details/8619632\" target=\"_blank\" rel=\"noopener\">http://blog.csdn.net/voidccc/article/details/8619632</a></p>\n<p> <a href=\"http://blog.csdn.net/q576709166/article/details/8649911\" target=\"_blank\" rel=\"noopener\">http://blog.csdn.net/q576709166/article/details/8649911</a>  EPOLL中有关事件意义</p>"},{"title":"修改OpenSSH源码，记录爆破SSH端口的密码","date":"2017-05-22T06:56:04.000Z","_content":"\n### 起因\n\n自从用上了VPS,爆破ssh端口的小黑们就一刻也没挺过，虽然我仍然使用的密码登录，自认为自己设置的密码还是足够的强健，但是还是想记录一下他们爆破所用的字典。搜索了几种方式，例如可以使用蜜罐，更改openssh源码等方式来记录爆破字典。为了省事，我采用了修改源码的方式来进行记录。\n\n<!-- more -->\n\n### 步骤1  搭建编译环境\n\n我所使用的环境是CentOS 7,需要安装openssl-devel和pam-devel\n\n```bash\nroot@vultr:yum install openssl-devel pam-devel\n```\n\n卸载原有系统自带的openssh-server\n\n```bash\n#查看系统中安装的所有openssh有关的软件包\n[root@vultr]# rpm -qa | grep openssh\nopenssh-clients-6.6.1p1-33.el7_3.x86_64\nopenssh-6.6.1p1-33.el7_3.x86_64\nopenssh-server-6.6.1p1-33.el7_3.x86_64\n#卸载openssh和openssh-server\n[root@vultr openssh-6.6p1]# yum remove openssh-server openssh\n#删除原有的ssh配置文件\n[root@vultr openssh-6.6p1]# rm -f /etc/ssh/*\n```\n\nOK,执行上以上操作后，准备工作就算完成了。\n\n### 步骤2 下载openssh的源码，并解压\n\n```bash\nroot@vultr#wget https://mirrors.evowise.com/pub/OpenBSD/OpenSSH/portable/openssh-6.6p1.tar.gz\nroot@vultr#tar -zxvf openssh-6.6p1.tar.gz\n```\n\n### 步骤3 修改源码，使之能记录登录密码\n\n需要修改的源码文件为  \n> auth2-passwd.c\n> 修改后的源码内容如下：\n```c\n#include \"hostfile.h\"\n#include \"auth.h\"\n#include \"buffer.h\"\n#ifdef GSSAPI\n#include \"ssh-gss.h\"\n#endif\n#include \"monitor_wrap.h\"\n#include \"servconf.h\"\n\n/* import */\nextern ServerOptions options;\n\nstatic int\nuserauth_passwd(Authctxt *authctxt)\n{\n\n\n\n\tchar *password, *newpass;\n\tint authenticated = 0;\n\tint change;\n\tu_int len, newlen;\n\n\tchange = packet_get_char();\n\tpassword = packet_get_string(&len);\n  \n\t//加上这行，就可以将登录用户名，密码添加到日志中\n\tlogit(\"user=%s,pass=%s\",authctxt->user,password);\n\t\n\tif (change) {\n\t\t/* discard new password from packet */\n\t\tnewpass = packet_get_string(&newlen);\n\t\texplicit_bzero(newpass, newlen);\n\t\tfree(newpass);\n\t}\n\tpacket_check_eom();\n\n\tif (change)\n\t\tlogit(\"password change not supported\");\n\telse if (PRIVSEP(auth_password(authctxt, password)) == 1)\n\t\tauthenticated = 1;\n\texplicit_bzero(password, len);\n\tfree(password);\n\treturn authenticated;\n}\n\nAuthmethod method_passwd = {\n\t\"password\",\n\tuserauth_passwd,\n\t&options.password_authentication\n};\n```\n\n\n\n### 步骤3 设置编译参数，并进行编译安装\n\n```bash\n#运行configure,并生成makefile\n[root@vultr openssh-6.6p1]#./configure --prefix=/usr --sysconfdir=/etc/ssh --with-pam --with-md5-passwords\n#编译并安装\n[root@vultr openssh-6.6p1]# make && make install\n\n```\n\n### 步骤4 添加服务，设置开机启动\n\n```bash\n#将启动脚本复制到/etc/init.d\n[root@vultr openssh-6.6p1]# cp contrib/redhat/sshd.init /etc/init.d/sshd\n#使ssh开机启动\n[root@vultr openssh-6.6p1]# systemctl enable sshd\nsshd.service is not a native service, redirecting to /sbin/chkconfig.\nExecuting /sbin/chkconfig sshd on\n\n```\n\n之后把服务器重启一下，记录到的日志内容在：\n\n> /var/log/messages\n\n中。把日志处理一下，就可以搜集一波黑客的爆破字典拉。我们来看看效果如何\n\n![image](/blogimg/openssh-code.png)\n\n可以从日志中已经有黑客的爆破密码记录了。嗯，自己送上门来的字典，为什么不收着呢？\n\n2017.5.23  新增\n\n为了提取出日志中的用户名和密码，顺手写了个python脚本来进行处理：\n\n```python\n# -*- coding:utf-8 -*-\nimport re\n\npattern = re.compile(r'user=(.*),pass=(.*) ')\n\nf = open(\"m.data\")\ndic_file = open(\"ssh_dic.txt\",\"w+\")\ntmp= f.readline()\nwhile tmp:\n    match = re.findall(pattern,tmp)\n    if match:\n        user = match[0][0]\n        passwd = match[0][1]\n        #print user,passwd\n        dic_file.writelines(\"%s %s\\r\\n\"%(user,passwd))\n        \n    tmp = f.readline()\n    \nf.close()\ndic_file.close()\n\n```\n\n记录了一天，获得的一小部分成果：\n\n```tex\nroot 1291\nroot tomcat14\nroot mamo\nroot jocelyn\nroot jobs123\nroot joachim\nroot adminka\nroot d1gital\nroot barramundi\nroot dammit\nroot lubis\nroot i81b4u81\nroot jmi@123\nroot jira321\nroot jira123\nroot nokia\nroot damas\nroot liltunechi\nadmin admin\nadmin default\nadmin letmein\nroot hoffmann\nroot technotron\nroot tartaro\nroot jingyun\nroot jillian\nroot jignesh\nroot merengue\nroot lucas\nroot miguel\nroot eurotrade\nroot yudi\nroot merovingian\nroot bazin\nroot spider\nroot royal\nroot jiayuan\nroot jiamima\nroot jhon123\nroot 1597534682\nroot cintakamu\nroot derparol\nroot all4you\nroot sun126\nroot lennartz\nroot jhon!@#\nroot jhengyu\nroot jessica\nroot abcd123$\nroot qq2008\nroot 0003\nroot zzic\nroot surya22\nroot aze123\nroot carota\nroot millcreek\nroot mecate\nroot jenkins\nroot jenk1ns\nroot jenifer\nroot rushed\nroot laliaku\nroot moneytalk\nroot lawless\n.\n.\n.\n```\n\n","source":"_posts/SSH-LOG-USER.md","raw":"---\ntitle: 修改OpenSSH源码，记录爆破SSH端口的密码\ncategories:\n  - Linux\ntags:\n  - ssh\n  - 暴力破解\n  - 记录  \ndate: 2017-05-22 14:56:04\n---\n\n### 起因\n\n自从用上了VPS,爆破ssh端口的小黑们就一刻也没挺过，虽然我仍然使用的密码登录，自认为自己设置的密码还是足够的强健，但是还是想记录一下他们爆破所用的字典。搜索了几种方式，例如可以使用蜜罐，更改openssh源码等方式来记录爆破字典。为了省事，我采用了修改源码的方式来进行记录。\n\n<!-- more -->\n\n### 步骤1  搭建编译环境\n\n我所使用的环境是CentOS 7,需要安装openssl-devel和pam-devel\n\n```bash\nroot@vultr:yum install openssl-devel pam-devel\n```\n\n卸载原有系统自带的openssh-server\n\n```bash\n#查看系统中安装的所有openssh有关的软件包\n[root@vultr]# rpm -qa | grep openssh\nopenssh-clients-6.6.1p1-33.el7_3.x86_64\nopenssh-6.6.1p1-33.el7_3.x86_64\nopenssh-server-6.6.1p1-33.el7_3.x86_64\n#卸载openssh和openssh-server\n[root@vultr openssh-6.6p1]# yum remove openssh-server openssh\n#删除原有的ssh配置文件\n[root@vultr openssh-6.6p1]# rm -f /etc/ssh/*\n```\n\nOK,执行上以上操作后，准备工作就算完成了。\n\n### 步骤2 下载openssh的源码，并解压\n\n```bash\nroot@vultr#wget https://mirrors.evowise.com/pub/OpenBSD/OpenSSH/portable/openssh-6.6p1.tar.gz\nroot@vultr#tar -zxvf openssh-6.6p1.tar.gz\n```\n\n### 步骤3 修改源码，使之能记录登录密码\n\n需要修改的源码文件为  \n> auth2-passwd.c\n> 修改后的源码内容如下：\n```c\n#include \"hostfile.h\"\n#include \"auth.h\"\n#include \"buffer.h\"\n#ifdef GSSAPI\n#include \"ssh-gss.h\"\n#endif\n#include \"monitor_wrap.h\"\n#include \"servconf.h\"\n\n/* import */\nextern ServerOptions options;\n\nstatic int\nuserauth_passwd(Authctxt *authctxt)\n{\n\n\n\n\tchar *password, *newpass;\n\tint authenticated = 0;\n\tint change;\n\tu_int len, newlen;\n\n\tchange = packet_get_char();\n\tpassword = packet_get_string(&len);\n  \n\t//加上这行，就可以将登录用户名，密码添加到日志中\n\tlogit(\"user=%s,pass=%s\",authctxt->user,password);\n\t\n\tif (change) {\n\t\t/* discard new password from packet */\n\t\tnewpass = packet_get_string(&newlen);\n\t\texplicit_bzero(newpass, newlen);\n\t\tfree(newpass);\n\t}\n\tpacket_check_eom();\n\n\tif (change)\n\t\tlogit(\"password change not supported\");\n\telse if (PRIVSEP(auth_password(authctxt, password)) == 1)\n\t\tauthenticated = 1;\n\texplicit_bzero(password, len);\n\tfree(password);\n\treturn authenticated;\n}\n\nAuthmethod method_passwd = {\n\t\"password\",\n\tuserauth_passwd,\n\t&options.password_authentication\n};\n```\n\n\n\n### 步骤3 设置编译参数，并进行编译安装\n\n```bash\n#运行configure,并生成makefile\n[root@vultr openssh-6.6p1]#./configure --prefix=/usr --sysconfdir=/etc/ssh --with-pam --with-md5-passwords\n#编译并安装\n[root@vultr openssh-6.6p1]# make && make install\n\n```\n\n### 步骤4 添加服务，设置开机启动\n\n```bash\n#将启动脚本复制到/etc/init.d\n[root@vultr openssh-6.6p1]# cp contrib/redhat/sshd.init /etc/init.d/sshd\n#使ssh开机启动\n[root@vultr openssh-6.6p1]# systemctl enable sshd\nsshd.service is not a native service, redirecting to /sbin/chkconfig.\nExecuting /sbin/chkconfig sshd on\n\n```\n\n之后把服务器重启一下，记录到的日志内容在：\n\n> /var/log/messages\n\n中。把日志处理一下，就可以搜集一波黑客的爆破字典拉。我们来看看效果如何\n\n![image](/blogimg/openssh-code.png)\n\n可以从日志中已经有黑客的爆破密码记录了。嗯，自己送上门来的字典，为什么不收着呢？\n\n2017.5.23  新增\n\n为了提取出日志中的用户名和密码，顺手写了个python脚本来进行处理：\n\n```python\n# -*- coding:utf-8 -*-\nimport re\n\npattern = re.compile(r'user=(.*),pass=(.*) ')\n\nf = open(\"m.data\")\ndic_file = open(\"ssh_dic.txt\",\"w+\")\ntmp= f.readline()\nwhile tmp:\n    match = re.findall(pattern,tmp)\n    if match:\n        user = match[0][0]\n        passwd = match[0][1]\n        #print user,passwd\n        dic_file.writelines(\"%s %s\\r\\n\"%(user,passwd))\n        \n    tmp = f.readline()\n    \nf.close()\ndic_file.close()\n\n```\n\n记录了一天，获得的一小部分成果：\n\n```tex\nroot 1291\nroot tomcat14\nroot mamo\nroot jocelyn\nroot jobs123\nroot joachim\nroot adminka\nroot d1gital\nroot barramundi\nroot dammit\nroot lubis\nroot i81b4u81\nroot jmi@123\nroot jira321\nroot jira123\nroot nokia\nroot damas\nroot liltunechi\nadmin admin\nadmin default\nadmin letmein\nroot hoffmann\nroot technotron\nroot tartaro\nroot jingyun\nroot jillian\nroot jignesh\nroot merengue\nroot lucas\nroot miguel\nroot eurotrade\nroot yudi\nroot merovingian\nroot bazin\nroot spider\nroot royal\nroot jiayuan\nroot jiamima\nroot jhon123\nroot 1597534682\nroot cintakamu\nroot derparol\nroot all4you\nroot sun126\nroot lennartz\nroot jhon!@#\nroot jhengyu\nroot jessica\nroot abcd123$\nroot qq2008\nroot 0003\nroot zzic\nroot surya22\nroot aze123\nroot carota\nroot millcreek\nroot mecate\nroot jenkins\nroot jenk1ns\nroot jenifer\nroot rushed\nroot laliaku\nroot moneytalk\nroot lawless\n.\n.\n.\n```\n\n","slug":"SSH-LOG-USER","published":1,"updated":"2017-12-04T07:27:28.762Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjeqig1ny003flgqay2quysz8","content":"<h3 id=\"起因\"><a href=\"#起因\" class=\"headerlink\" title=\"起因\"></a>起因</h3><p>自从用上了VPS,爆破ssh端口的小黑们就一刻也没挺过，虽然我仍然使用的密码登录，自认为自己设置的密码还是足够的强健，但是还是想记录一下他们爆破所用的字典。搜索了几种方式，例如可以使用蜜罐，更改openssh源码等方式来记录爆破字典。为了省事，我采用了修改源码的方式来进行记录。</p>\n<a id=\"more\"></a>\n<h3 id=\"步骤1-搭建编译环境\"><a href=\"#步骤1-搭建编译环境\" class=\"headerlink\" title=\"步骤1  搭建编译环境\"></a>步骤1  搭建编译环境</h3><p>我所使用的环境是CentOS 7,需要安装openssl-devel和pam-devel</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">root@vultr:yum install openssl-devel pam-devel</span><br></pre></td></tr></table></figure>\n<p>卸载原有系统自带的openssh-server</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#查看系统中安装的所有openssh有关的软件包</span></span><br><span class=\"line\">[root@vultr]<span class=\"comment\"># rpm -qa | grep openssh</span></span><br><span class=\"line\">openssh-clients-6.6.1p1-33.el7_3.x86_64</span><br><span class=\"line\">openssh-6.6.1p1-33.el7_3.x86_64</span><br><span class=\"line\">openssh-server-6.6.1p1-33.el7_3.x86_64</span><br><span class=\"line\"><span class=\"comment\">#卸载openssh和openssh-server</span></span><br><span class=\"line\">[root@vultr openssh-6.6p1]<span class=\"comment\"># yum remove openssh-server openssh</span></span><br><span class=\"line\"><span class=\"comment\">#删除原有的ssh配置文件</span></span><br><span class=\"line\">[root@vultr openssh-6.6p1]<span class=\"comment\"># rm -f /etc/ssh/*</span></span><br></pre></td></tr></table></figure>\n<p>OK,执行上以上操作后，准备工作就算完成了。</p>\n<h3 id=\"步骤2-下载openssh的源码，并解压\"><a href=\"#步骤2-下载openssh的源码，并解压\" class=\"headerlink\" title=\"步骤2 下载openssh的源码，并解压\"></a>步骤2 下载openssh的源码，并解压</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">root@vultr<span class=\"comment\">#wget https://mirrors.evowise.com/pub/OpenBSD/OpenSSH/portable/openssh-6.6p1.tar.gz</span></span><br><span class=\"line\">root@vultr<span class=\"comment\">#tar -zxvf openssh-6.6p1.tar.gz</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"步骤3-修改源码，使之能记录登录密码\"><a href=\"#步骤3-修改源码，使之能记录登录密码\" class=\"headerlink\" title=\"步骤3 修改源码，使之能记录登录密码\"></a>步骤3 修改源码，使之能记录登录密码</h3><p>需要修改的源码文件为  </p>\n<blockquote>\n<p>auth2-passwd.c<br>修改后的源码内容如下：<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">\"hostfile.h\"</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">\"auth.h\"</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">\"buffer.h\"</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">ifdef</span> GSSAPI</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">\"ssh-gss.h\"</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">endif</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">\"monitor_wrap.h\"</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">\"servconf.h\"</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* import */</span></span><br><span class=\"line\"><span class=\"keyword\">extern</span> ServerOptions options;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"keyword\">int</span></span><br><span class=\"line\">userauth_passwd(Authctxt *authctxt)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">char</span> *password, *newpass;</span><br><span class=\"line\">\t<span class=\"keyword\">int</span> authenticated = <span class=\"number\">0</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">int</span> change;</span><br><span class=\"line\">\tu_int len, newlen;</span><br><span class=\"line\"></span><br><span class=\"line\">\tchange = packet_get_char();</span><br><span class=\"line\">\tpassword = packet_get_string(&amp;len);</span><br><span class=\"line\">  </span><br><span class=\"line\">\t<span class=\"comment\">//加上这行，就可以将登录用户名，密码添加到日志中</span></span><br><span class=\"line\">\tlogit(<span class=\"string\">\"user=%s,pass=%s\"</span>,authctxt-&gt;user,password);</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (change) &#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">/* discard new password from packet */</span></span><br><span class=\"line\">\t\tnewpass = packet_get_string(&amp;newlen);</span><br><span class=\"line\">\t\texplicit_bzero(newpass, newlen);</span><br><span class=\"line\">\t\t<span class=\"built_in\">free</span>(newpass);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tpacket_check_eom();</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (change)</span><br><span class=\"line\">\t\tlogit(<span class=\"string\">\"password change not supported\"</span>);</span><br><span class=\"line\">\t<span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (PRIVSEP(auth_password(authctxt, password)) == <span class=\"number\">1</span>)</span><br><span class=\"line\">\t\tauthenticated = <span class=\"number\">1</span>;</span><br><span class=\"line\">\texplicit_bzero(password, len);</span><br><span class=\"line\">\t<span class=\"built_in\">free</span>(password);</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> authenticated;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">Authmethod method_passwd = &#123;</span><br><span class=\"line\">\t<span class=\"string\">\"password\"</span>,</span><br><span class=\"line\">\tuserauth_passwd,</span><br><span class=\"line\">\t&amp;options.password_authentication</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure></p>\n</blockquote>\n<h3 id=\"步骤3-设置编译参数，并进行编译安装\"><a href=\"#步骤3-设置编译参数，并进行编译安装\" class=\"headerlink\" title=\"步骤3 设置编译参数，并进行编译安装\"></a>步骤3 设置编译参数，并进行编译安装</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#运行configure,并生成makefile</span></span><br><span class=\"line\">[root@vultr openssh-6.6p1]<span class=\"comment\">#./configure --prefix=/usr --sysconfdir=/etc/ssh --with-pam --with-md5-passwords</span></span><br><span class=\"line\"><span class=\"comment\">#编译并安装</span></span><br><span class=\"line\">[root@vultr openssh-6.6p1]<span class=\"comment\"># make &amp;&amp; make install</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"步骤4-添加服务，设置开机启动\"><a href=\"#步骤4-添加服务，设置开机启动\" class=\"headerlink\" title=\"步骤4 添加服务，设置开机启动\"></a>步骤4 添加服务，设置开机启动</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#将启动脚本复制到/etc/init.d</span></span><br><span class=\"line\">[root@vultr openssh-6.6p1]<span class=\"comment\"># cp contrib/redhat/sshd.init /etc/init.d/sshd</span></span><br><span class=\"line\"><span class=\"comment\">#使ssh开机启动</span></span><br><span class=\"line\">[root@vultr openssh-6.6p1]<span class=\"comment\"># systemctl enable sshd</span></span><br><span class=\"line\">sshd.service is not a native service, redirecting to /sbin/chkconfig.</span><br><span class=\"line\">Executing /sbin/chkconfig sshd on</span><br></pre></td></tr></table></figure>\n<p>之后把服务器重启一下，记录到的日志内容在：</p>\n<blockquote>\n<p>/var/log/messages</p>\n</blockquote>\n<p>中。把日志处理一下，就可以搜集一波黑客的爆破字典拉。我们来看看效果如何</p>\n<p><img src=\"/blogimg/openssh-code.png\" alt=\"image\"></p>\n<p>可以从日志中已经有黑客的爆破密码记录了。嗯，自己送上门来的字典，为什么不收着呢？</p>\n<p>2017.5.23  新增</p>\n<p>为了提取出日志中的用户名和密码，顺手写了个python脚本来进行处理：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># -*- coding:utf-8 -*-</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> re</span><br><span class=\"line\"></span><br><span class=\"line\">pattern = re.compile(<span class=\"string\">r'user=(.*),pass=(.*) '</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">f = open(<span class=\"string\">\"m.data\"</span>)</span><br><span class=\"line\">dic_file = open(<span class=\"string\">\"ssh_dic.txt\"</span>,<span class=\"string\">\"w+\"</span>)</span><br><span class=\"line\">tmp= f.readline()</span><br><span class=\"line\"><span class=\"keyword\">while</span> tmp:</span><br><span class=\"line\">    match = re.findall(pattern,tmp)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> match:</span><br><span class=\"line\">        user = match[<span class=\"number\">0</span>][<span class=\"number\">0</span>]</span><br><span class=\"line\">        passwd = match[<span class=\"number\">0</span>][<span class=\"number\">1</span>]</span><br><span class=\"line\">        <span class=\"comment\">#print user,passwd</span></span><br><span class=\"line\">        dic_file.writelines(<span class=\"string\">\"%s %s\\r\\n\"</span>%(user,passwd))</span><br><span class=\"line\">        </span><br><span class=\"line\">    tmp = f.readline()</span><br><span class=\"line\">    </span><br><span class=\"line\">f.close()</span><br><span class=\"line\">dic_file.close()</span><br></pre></td></tr></table></figure>\n<p>记录了一天，获得的一小部分成果：</p>\n<figure class=\"highlight tex\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">root 1291</span><br><span class=\"line\">root tomcat14</span><br><span class=\"line\">root mamo</span><br><span class=\"line\">root jocelyn</span><br><span class=\"line\">root jobs123</span><br><span class=\"line\">root joachim</span><br><span class=\"line\">root adminka</span><br><span class=\"line\">root d1gital</span><br><span class=\"line\">root barramundi</span><br><span class=\"line\">root dammit</span><br><span class=\"line\">root lubis</span><br><span class=\"line\">root i81b4u81</span><br><span class=\"line\">root jmi@123</span><br><span class=\"line\">root jira321</span><br><span class=\"line\">root jira123</span><br><span class=\"line\">root nokia</span><br><span class=\"line\">root damas</span><br><span class=\"line\">root liltunechi</span><br><span class=\"line\">admin admin</span><br><span class=\"line\">admin default</span><br><span class=\"line\">admin letmein</span><br><span class=\"line\">root hoffmann</span><br><span class=\"line\">root technotron</span><br><span class=\"line\">root tartaro</span><br><span class=\"line\">root jingyun</span><br><span class=\"line\">root jillian</span><br><span class=\"line\">root jignesh</span><br><span class=\"line\">root merengue</span><br><span class=\"line\">root lucas</span><br><span class=\"line\">root miguel</span><br><span class=\"line\">root eurotrade</span><br><span class=\"line\">root yudi</span><br><span class=\"line\">root merovingian</span><br><span class=\"line\">root bazin</span><br><span class=\"line\">root spider</span><br><span class=\"line\">root royal</span><br><span class=\"line\">root jiayuan</span><br><span class=\"line\">root jiamima</span><br><span class=\"line\">root jhon123</span><br><span class=\"line\">root 1597534682</span><br><span class=\"line\">root cintakamu</span><br><span class=\"line\">root derparol</span><br><span class=\"line\">root all4you</span><br><span class=\"line\">root sun126</span><br><span class=\"line\">root lennartz</span><br><span class=\"line\">root jhon!@#</span><br><span class=\"line\">root jhengyu</span><br><span class=\"line\">root jessica</span><br><span class=\"line\">root abcd123<span class=\"formula\">$</span></span><br><span class=\"line\"><span class=\"formula\">root qq2008</span></span><br><span class=\"line\"><span class=\"formula\">root 0003</span></span><br><span class=\"line\"><span class=\"formula\">root zzic</span></span><br><span class=\"line\"><span class=\"formula\">root surya22</span></span><br><span class=\"line\"><span class=\"formula\">root aze123</span></span><br><span class=\"line\"><span class=\"formula\">root carota</span></span><br><span class=\"line\"><span class=\"formula\">root millcreek</span></span><br><span class=\"line\"><span class=\"formula\">root mecate</span></span><br><span class=\"line\"><span class=\"formula\">root jenkins</span></span><br><span class=\"line\"><span class=\"formula\">root jenk1ns</span></span><br><span class=\"line\"><span class=\"formula\">root jenifer</span></span><br><span class=\"line\"><span class=\"formula\">root rushed</span></span><br><span class=\"line\"><span class=\"formula\">root laliaku</span></span><br><span class=\"line\"><span class=\"formula\">root moneytalk</span></span><br><span class=\"line\"><span class=\"formula\">root lawless</span></span><br><span class=\"line\"><span class=\"formula\">.</span></span><br><span class=\"line\"><span class=\"formula\">.</span></span><br><span class=\"line\"><span class=\"formula\">.</span></span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"<h3 id=\"起因\"><a href=\"#起因\" class=\"headerlink\" title=\"起因\"></a>起因</h3><p>自从用上了VPS,爆破ssh端口的小黑们就一刻也没挺过，虽然我仍然使用的密码登录，自认为自己设置的密码还是足够的强健，但是还是想记录一下他们爆破所用的字典。搜索了几种方式，例如可以使用蜜罐，更改openssh源码等方式来记录爆破字典。为了省事，我采用了修改源码的方式来进行记录。</p>","more":"<h3 id=\"步骤1-搭建编译环境\"><a href=\"#步骤1-搭建编译环境\" class=\"headerlink\" title=\"步骤1  搭建编译环境\"></a>步骤1  搭建编译环境</h3><p>我所使用的环境是CentOS 7,需要安装openssl-devel和pam-devel</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">root@vultr:yum install openssl-devel pam-devel</span><br></pre></td></tr></table></figure>\n<p>卸载原有系统自带的openssh-server</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#查看系统中安装的所有openssh有关的软件包</span></span><br><span class=\"line\">[root@vultr]<span class=\"comment\"># rpm -qa | grep openssh</span></span><br><span class=\"line\">openssh-clients-6.6.1p1-33.el7_3.x86_64</span><br><span class=\"line\">openssh-6.6.1p1-33.el7_3.x86_64</span><br><span class=\"line\">openssh-server-6.6.1p1-33.el7_3.x86_64</span><br><span class=\"line\"><span class=\"comment\">#卸载openssh和openssh-server</span></span><br><span class=\"line\">[root@vultr openssh-6.6p1]<span class=\"comment\"># yum remove openssh-server openssh</span></span><br><span class=\"line\"><span class=\"comment\">#删除原有的ssh配置文件</span></span><br><span class=\"line\">[root@vultr openssh-6.6p1]<span class=\"comment\"># rm -f /etc/ssh/*</span></span><br></pre></td></tr></table></figure>\n<p>OK,执行上以上操作后，准备工作就算完成了。</p>\n<h3 id=\"步骤2-下载openssh的源码，并解压\"><a href=\"#步骤2-下载openssh的源码，并解压\" class=\"headerlink\" title=\"步骤2 下载openssh的源码，并解压\"></a>步骤2 下载openssh的源码，并解压</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">root@vultr<span class=\"comment\">#wget https://mirrors.evowise.com/pub/OpenBSD/OpenSSH/portable/openssh-6.6p1.tar.gz</span></span><br><span class=\"line\">root@vultr<span class=\"comment\">#tar -zxvf openssh-6.6p1.tar.gz</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"步骤3-修改源码，使之能记录登录密码\"><a href=\"#步骤3-修改源码，使之能记录登录密码\" class=\"headerlink\" title=\"步骤3 修改源码，使之能记录登录密码\"></a>步骤3 修改源码，使之能记录登录密码</h3><p>需要修改的源码文件为  </p>\n<blockquote>\n<p>auth2-passwd.c<br>修改后的源码内容如下：<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">\"hostfile.h\"</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">\"auth.h\"</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">\"buffer.h\"</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">ifdef</span> GSSAPI</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">\"ssh-gss.h\"</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">endif</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">\"monitor_wrap.h\"</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">\"servconf.h\"</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* import */</span></span><br><span class=\"line\"><span class=\"keyword\">extern</span> ServerOptions options;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"keyword\">int</span></span><br><span class=\"line\">userauth_passwd(Authctxt *authctxt)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">char</span> *password, *newpass;</span><br><span class=\"line\">\t<span class=\"keyword\">int</span> authenticated = <span class=\"number\">0</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">int</span> change;</span><br><span class=\"line\">\tu_int len, newlen;</span><br><span class=\"line\"></span><br><span class=\"line\">\tchange = packet_get_char();</span><br><span class=\"line\">\tpassword = packet_get_string(&amp;len);</span><br><span class=\"line\">  </span><br><span class=\"line\">\t<span class=\"comment\">//加上这行，就可以将登录用户名，密码添加到日志中</span></span><br><span class=\"line\">\tlogit(<span class=\"string\">\"user=%s,pass=%s\"</span>,authctxt-&gt;user,password);</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (change) &#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">/* discard new password from packet */</span></span><br><span class=\"line\">\t\tnewpass = packet_get_string(&amp;newlen);</span><br><span class=\"line\">\t\texplicit_bzero(newpass, newlen);</span><br><span class=\"line\">\t\t<span class=\"built_in\">free</span>(newpass);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tpacket_check_eom();</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (change)</span><br><span class=\"line\">\t\tlogit(<span class=\"string\">\"password change not supported\"</span>);</span><br><span class=\"line\">\t<span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (PRIVSEP(auth_password(authctxt, password)) == <span class=\"number\">1</span>)</span><br><span class=\"line\">\t\tauthenticated = <span class=\"number\">1</span>;</span><br><span class=\"line\">\texplicit_bzero(password, len);</span><br><span class=\"line\">\t<span class=\"built_in\">free</span>(password);</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> authenticated;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">Authmethod method_passwd = &#123;</span><br><span class=\"line\">\t<span class=\"string\">\"password\"</span>,</span><br><span class=\"line\">\tuserauth_passwd,</span><br><span class=\"line\">\t&amp;options.password_authentication</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure></p>\n</blockquote>\n<h3 id=\"步骤3-设置编译参数，并进行编译安装\"><a href=\"#步骤3-设置编译参数，并进行编译安装\" class=\"headerlink\" title=\"步骤3 设置编译参数，并进行编译安装\"></a>步骤3 设置编译参数，并进行编译安装</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#运行configure,并生成makefile</span></span><br><span class=\"line\">[root@vultr openssh-6.6p1]<span class=\"comment\">#./configure --prefix=/usr --sysconfdir=/etc/ssh --with-pam --with-md5-passwords</span></span><br><span class=\"line\"><span class=\"comment\">#编译并安装</span></span><br><span class=\"line\">[root@vultr openssh-6.6p1]<span class=\"comment\"># make &amp;&amp; make install</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"步骤4-添加服务，设置开机启动\"><a href=\"#步骤4-添加服务，设置开机启动\" class=\"headerlink\" title=\"步骤4 添加服务，设置开机启动\"></a>步骤4 添加服务，设置开机启动</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#将启动脚本复制到/etc/init.d</span></span><br><span class=\"line\">[root@vultr openssh-6.6p1]<span class=\"comment\"># cp contrib/redhat/sshd.init /etc/init.d/sshd</span></span><br><span class=\"line\"><span class=\"comment\">#使ssh开机启动</span></span><br><span class=\"line\">[root@vultr openssh-6.6p1]<span class=\"comment\"># systemctl enable sshd</span></span><br><span class=\"line\">sshd.service is not a native service, redirecting to /sbin/chkconfig.</span><br><span class=\"line\">Executing /sbin/chkconfig sshd on</span><br></pre></td></tr></table></figure>\n<p>之后把服务器重启一下，记录到的日志内容在：</p>\n<blockquote>\n<p>/var/log/messages</p>\n</blockquote>\n<p>中。把日志处理一下，就可以搜集一波黑客的爆破字典拉。我们来看看效果如何</p>\n<p><img src=\"/blogimg/openssh-code.png\" alt=\"image\"></p>\n<p>可以从日志中已经有黑客的爆破密码记录了。嗯，自己送上门来的字典，为什么不收着呢？</p>\n<p>2017.5.23  新增</p>\n<p>为了提取出日志中的用户名和密码，顺手写了个python脚本来进行处理：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># -*- coding:utf-8 -*-</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> re</span><br><span class=\"line\"></span><br><span class=\"line\">pattern = re.compile(<span class=\"string\">r'user=(.*),pass=(.*) '</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">f = open(<span class=\"string\">\"m.data\"</span>)</span><br><span class=\"line\">dic_file = open(<span class=\"string\">\"ssh_dic.txt\"</span>,<span class=\"string\">\"w+\"</span>)</span><br><span class=\"line\">tmp= f.readline()</span><br><span class=\"line\"><span class=\"keyword\">while</span> tmp:</span><br><span class=\"line\">    match = re.findall(pattern,tmp)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> match:</span><br><span class=\"line\">        user = match[<span class=\"number\">0</span>][<span class=\"number\">0</span>]</span><br><span class=\"line\">        passwd = match[<span class=\"number\">0</span>][<span class=\"number\">1</span>]</span><br><span class=\"line\">        <span class=\"comment\">#print user,passwd</span></span><br><span class=\"line\">        dic_file.writelines(<span class=\"string\">\"%s %s\\r\\n\"</span>%(user,passwd))</span><br><span class=\"line\">        </span><br><span class=\"line\">    tmp = f.readline()</span><br><span class=\"line\">    </span><br><span class=\"line\">f.close()</span><br><span class=\"line\">dic_file.close()</span><br></pre></td></tr></table></figure>\n<p>记录了一天，获得的一小部分成果：</p>\n<figure class=\"highlight tex\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">root 1291</span><br><span class=\"line\">root tomcat14</span><br><span class=\"line\">root mamo</span><br><span class=\"line\">root jocelyn</span><br><span class=\"line\">root jobs123</span><br><span class=\"line\">root joachim</span><br><span class=\"line\">root adminka</span><br><span class=\"line\">root d1gital</span><br><span class=\"line\">root barramundi</span><br><span class=\"line\">root dammit</span><br><span class=\"line\">root lubis</span><br><span class=\"line\">root i81b4u81</span><br><span class=\"line\">root jmi@123</span><br><span class=\"line\">root jira321</span><br><span class=\"line\">root jira123</span><br><span class=\"line\">root nokia</span><br><span class=\"line\">root damas</span><br><span class=\"line\">root liltunechi</span><br><span class=\"line\">admin admin</span><br><span class=\"line\">admin default</span><br><span class=\"line\">admin letmein</span><br><span class=\"line\">root hoffmann</span><br><span class=\"line\">root technotron</span><br><span class=\"line\">root tartaro</span><br><span class=\"line\">root jingyun</span><br><span class=\"line\">root jillian</span><br><span class=\"line\">root jignesh</span><br><span class=\"line\">root merengue</span><br><span class=\"line\">root lucas</span><br><span class=\"line\">root miguel</span><br><span class=\"line\">root eurotrade</span><br><span class=\"line\">root yudi</span><br><span class=\"line\">root merovingian</span><br><span class=\"line\">root bazin</span><br><span class=\"line\">root spider</span><br><span class=\"line\">root royal</span><br><span class=\"line\">root jiayuan</span><br><span class=\"line\">root jiamima</span><br><span class=\"line\">root jhon123</span><br><span class=\"line\">root 1597534682</span><br><span class=\"line\">root cintakamu</span><br><span class=\"line\">root derparol</span><br><span class=\"line\">root all4you</span><br><span class=\"line\">root sun126</span><br><span class=\"line\">root lennartz</span><br><span class=\"line\">root jhon!@#</span><br><span class=\"line\">root jhengyu</span><br><span class=\"line\">root jessica</span><br><span class=\"line\">root abcd123<span class=\"formula\">$</span></span><br><span class=\"line\"><span class=\"formula\">root qq2008</span></span><br><span class=\"line\"><span class=\"formula\">root 0003</span></span><br><span class=\"line\"><span class=\"formula\">root zzic</span></span><br><span class=\"line\"><span class=\"formula\">root surya22</span></span><br><span class=\"line\"><span class=\"formula\">root aze123</span></span><br><span class=\"line\"><span class=\"formula\">root carota</span></span><br><span class=\"line\"><span class=\"formula\">root millcreek</span></span><br><span class=\"line\"><span class=\"formula\">root mecate</span></span><br><span class=\"line\"><span class=\"formula\">root jenkins</span></span><br><span class=\"line\"><span class=\"formula\">root jenk1ns</span></span><br><span class=\"line\"><span class=\"formula\">root jenifer</span></span><br><span class=\"line\"><span class=\"formula\">root rushed</span></span><br><span class=\"line\"><span class=\"formula\">root laliaku</span></span><br><span class=\"line\"><span class=\"formula\">root moneytalk</span></span><br><span class=\"line\"><span class=\"formula\">root lawless</span></span><br><span class=\"line\"><span class=\"formula\">.</span></span><br><span class=\"line\"><span class=\"formula\">.</span></span><br><span class=\"line\"><span class=\"formula\">.</span></span><br></pre></td></tr></table></figure>"},{"title":"Python中实现单例模式","date":"2017-10-19T08:33:44.000Z","_content":"\n#### 0x1 何谓单例模式？\n\n单例模式简单来讲就是一个类只能存在一个对象实例。\n\n那么在python中如何实现单例模式呢？\n\n<!--more-->\n\n#### 0x2 在python中实现单例模式\n\n1.使用装饰器\n\n```python\n# -*- coding:utf-8 -*-\n\n\ndef singleton(cls, *args, **kwargs):\n    instances = {}\n    def _singleton():\n        if cls  not in instances:\n            instances[cls] = cls(*args, **kwargs)\n        return instances[cls]\n    return _singleton\n\n@singleton\nclass MyClass(object):\n    a = 1\n    def __init__(self, x=0):\n        self.x = x\n\nc1 = MyClass()\nc2 = MyClass()\nprint id(c1)\nprint id(c2)\n\n#运行结果\n>>> \n============= RESTART: E:\\Study\\PythonPractice\\Singleton_demo.py =============\n57740032\n57740032\n```\n\n2.使用\\_\\_metaclass\\_\\_ 来实现\n\n```python\nclass Singleton2(type):\n    _instance = {}\n    def __init__(cls, name, bases, dict):\n        super(Singleton2, cls).__init__(name, bases, dict)\n        cls._instance = None\n    def __call__(cls, *args, **kwargs):\n        if cls._instance is None:\n            cls._instance = super(Singleton2, cls).__call__(*args, **kwargs)\n\nclass MyClass2(object):\n    __metaclass__ = Singleton2\n\n\nc3 = MyClass2()\nc4 = MyClass2()\n\n\n\nprint id(c3)\nprint id(c4)\n```\n\n以上就是python中实现单例模式的两种常用方法。\n\n另外还有一种方式：\n\n```python\nclass Singleton(object):\n    def __new__(cls, *args, **kwargs):\n        if not hasattr(cls, '_instance'):\n            cls._instance = super(Singleton, cls).__new__(cls, *args, **kwargs)\n        return cls._instance\n \nclass Foo(Singleton): #单例类\n    a = 1\n```\n\n参考链接:\n\nhttp://python.jobbole.com/87514/?repeat=w3tc\n\nhttp://blog.csdn.net/karldoenitz/article/details/23467221\n\nhttp://www.cnblogs.com/kakaliush/p/5228165.html\n\n","source":"_posts/PythonSingleton.md","raw":"---\ntitle: Python中实现单例模式\ncategories:\n  - Program\ntags:\n  - python\ndate: 2017-10-19 16:33:44\n---\n\n#### 0x1 何谓单例模式？\n\n单例模式简单来讲就是一个类只能存在一个对象实例。\n\n那么在python中如何实现单例模式呢？\n\n<!--more-->\n\n#### 0x2 在python中实现单例模式\n\n1.使用装饰器\n\n```python\n# -*- coding:utf-8 -*-\n\n\ndef singleton(cls, *args, **kwargs):\n    instances = {}\n    def _singleton():\n        if cls  not in instances:\n            instances[cls] = cls(*args, **kwargs)\n        return instances[cls]\n    return _singleton\n\n@singleton\nclass MyClass(object):\n    a = 1\n    def __init__(self, x=0):\n        self.x = x\n\nc1 = MyClass()\nc2 = MyClass()\nprint id(c1)\nprint id(c2)\n\n#运行结果\n>>> \n============= RESTART: E:\\Study\\PythonPractice\\Singleton_demo.py =============\n57740032\n57740032\n```\n\n2.使用\\_\\_metaclass\\_\\_ 来实现\n\n```python\nclass Singleton2(type):\n    _instance = {}\n    def __init__(cls, name, bases, dict):\n        super(Singleton2, cls).__init__(name, bases, dict)\n        cls._instance = None\n    def __call__(cls, *args, **kwargs):\n        if cls._instance is None:\n            cls._instance = super(Singleton2, cls).__call__(*args, **kwargs)\n\nclass MyClass2(object):\n    __metaclass__ = Singleton2\n\n\nc3 = MyClass2()\nc4 = MyClass2()\n\n\n\nprint id(c3)\nprint id(c4)\n```\n\n以上就是python中实现单例模式的两种常用方法。\n\n另外还有一种方式：\n\n```python\nclass Singleton(object):\n    def __new__(cls, *args, **kwargs):\n        if not hasattr(cls, '_instance'):\n            cls._instance = super(Singleton, cls).__new__(cls, *args, **kwargs)\n        return cls._instance\n \nclass Foo(Singleton): #单例类\n    a = 1\n```\n\n参考链接:\n\nhttp://python.jobbole.com/87514/?repeat=w3tc\n\nhttp://blog.csdn.net/karldoenitz/article/details/23467221\n\nhttp://www.cnblogs.com/kakaliush/p/5228165.html\n\n","slug":"PythonSingleton","published":1,"updated":"2017-12-04T07:27:28.762Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjeqig1o4003jlgqaxv3x1hd1","content":"<h4 id=\"0x1-何谓单例模式？\"><a href=\"#0x1-何谓单例模式？\" class=\"headerlink\" title=\"0x1 何谓单例模式？\"></a>0x1 何谓单例模式？</h4><p>单例模式简单来讲就是一个类只能存在一个对象实例。</p>\n<p>那么在python中如何实现单例模式呢？</p>\n<a id=\"more\"></a>\n<h4 id=\"0x2-在python中实现单例模式\"><a href=\"#0x2-在python中实现单例模式\" class=\"headerlink\" title=\"0x2 在python中实现单例模式\"></a>0x2 在python中实现单例模式</h4><p>1.使用装饰器</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># -*- coding:utf-8 -*-</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">singleton</span><span class=\"params\">(cls, *args, **kwargs)</span>:</span></span><br><span class=\"line\">    instances = &#123;&#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">_singleton</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> cls  <span class=\"keyword\">not</span> <span class=\"keyword\">in</span> instances:</span><br><span class=\"line\">            instances[cls] = cls(*args, **kwargs)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> instances[cls]</span><br><span class=\"line\">    <span class=\"keyword\">return</span> _singleton</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@singleton</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyClass</span><span class=\"params\">(object)</span>:</span></span><br><span class=\"line\">    a = <span class=\"number\">1</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span><span class=\"params\">(self, x=<span class=\"number\">0</span>)</span>:</span></span><br><span class=\"line\">        self.x = x</span><br><span class=\"line\"></span><br><span class=\"line\">c1 = MyClass()</span><br><span class=\"line\">c2 = MyClass()</span><br><span class=\"line\"><span class=\"keyword\">print</span> id(c1)</span><br><span class=\"line\"><span class=\"keyword\">print</span> id(c2)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#运行结果</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span></span><br><span class=\"line\">============= RESTART: E:\\Study\\PythonPractice\\Singleton_demo.py =============</span><br><span class=\"line\"><span class=\"number\">57740032</span></span><br><span class=\"line\"><span class=\"number\">57740032</span></span><br></pre></td></tr></table></figure>\n<p>2.使用__metaclass__ 来实现</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Singleton2</span><span class=\"params\">(type)</span>:</span></span><br><span class=\"line\">    _instance = &#123;&#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span><span class=\"params\">(cls, name, bases, dict)</span>:</span></span><br><span class=\"line\">        super(Singleton2, cls).__init__(name, bases, dict)</span><br><span class=\"line\">        cls._instance = <span class=\"keyword\">None</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__call__</span><span class=\"params\">(cls, *args, **kwargs)</span>:</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> cls._instance <span class=\"keyword\">is</span> <span class=\"keyword\">None</span>:</span><br><span class=\"line\">            cls._instance = super(Singleton2, cls).__call__(*args, **kwargs)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyClass2</span><span class=\"params\">(object)</span>:</span></span><br><span class=\"line\">    __metaclass__ = Singleton2</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">c3 = MyClass2()</span><br><span class=\"line\">c4 = MyClass2()</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">print</span> id(c3)</span><br><span class=\"line\"><span class=\"keyword\">print</span> id(c4)</span><br></pre></td></tr></table></figure>\n<p>以上就是python中实现单例模式的两种常用方法。</p>\n<p>另外还有一种方式：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Singleton</span><span class=\"params\">(object)</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__new__</span><span class=\"params\">(cls, *args, **kwargs)</span>:</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> hasattr(cls, <span class=\"string\">'_instance'</span>):</span><br><span class=\"line\">            cls._instance = super(Singleton, cls).__new__(cls, *args, **kwargs)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> cls._instance</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Foo</span><span class=\"params\">(Singleton)</span>:</span> <span class=\"comment\">#单例类</span></span><br><span class=\"line\">    a = <span class=\"number\">1</span></span><br></pre></td></tr></table></figure>\n<p>参考链接:</p>\n<p><a href=\"http://python.jobbole.com/87514/?repeat=w3tc\" target=\"_blank\" rel=\"noopener\">http://python.jobbole.com/87514/?repeat=w3tc</a></p>\n<p><a href=\"http://blog.csdn.net/karldoenitz/article/details/23467221\" target=\"_blank\" rel=\"noopener\">http://blog.csdn.net/karldoenitz/article/details/23467221</a></p>\n<p><a href=\"http://www.cnblogs.com/kakaliush/p/5228165.html\" target=\"_blank\" rel=\"noopener\">http://www.cnblogs.com/kakaliush/p/5228165.html</a></p>\n","site":{"data":{}},"excerpt":"<h4 id=\"0x1-何谓单例模式？\"><a href=\"#0x1-何谓单例模式？\" class=\"headerlink\" title=\"0x1 何谓单例模式？\"></a>0x1 何谓单例模式？</h4><p>单例模式简单来讲就是一个类只能存在一个对象实例。</p>\n<p>那么在python中如何实现单例模式呢？</p>","more":"<h4 id=\"0x2-在python中实现单例模式\"><a href=\"#0x2-在python中实现单例模式\" class=\"headerlink\" title=\"0x2 在python中实现单例模式\"></a>0x2 在python中实现单例模式</h4><p>1.使用装饰器</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># -*- coding:utf-8 -*-</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">singleton</span><span class=\"params\">(cls, *args, **kwargs)</span>:</span></span><br><span class=\"line\">    instances = &#123;&#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">_singleton</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> cls  <span class=\"keyword\">not</span> <span class=\"keyword\">in</span> instances:</span><br><span class=\"line\">            instances[cls] = cls(*args, **kwargs)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> instances[cls]</span><br><span class=\"line\">    <span class=\"keyword\">return</span> _singleton</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@singleton</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyClass</span><span class=\"params\">(object)</span>:</span></span><br><span class=\"line\">    a = <span class=\"number\">1</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span><span class=\"params\">(self, x=<span class=\"number\">0</span>)</span>:</span></span><br><span class=\"line\">        self.x = x</span><br><span class=\"line\"></span><br><span class=\"line\">c1 = MyClass()</span><br><span class=\"line\">c2 = MyClass()</span><br><span class=\"line\"><span class=\"keyword\">print</span> id(c1)</span><br><span class=\"line\"><span class=\"keyword\">print</span> id(c2)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#运行结果</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span></span><br><span class=\"line\">============= RESTART: E:\\Study\\PythonPractice\\Singleton_demo.py =============</span><br><span class=\"line\"><span class=\"number\">57740032</span></span><br><span class=\"line\"><span class=\"number\">57740032</span></span><br></pre></td></tr></table></figure>\n<p>2.使用__metaclass__ 来实现</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Singleton2</span><span class=\"params\">(type)</span>:</span></span><br><span class=\"line\">    _instance = &#123;&#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span><span class=\"params\">(cls, name, bases, dict)</span>:</span></span><br><span class=\"line\">        super(Singleton2, cls).__init__(name, bases, dict)</span><br><span class=\"line\">        cls._instance = <span class=\"keyword\">None</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__call__</span><span class=\"params\">(cls, *args, **kwargs)</span>:</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> cls._instance <span class=\"keyword\">is</span> <span class=\"keyword\">None</span>:</span><br><span class=\"line\">            cls._instance = super(Singleton2, cls).__call__(*args, **kwargs)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyClass2</span><span class=\"params\">(object)</span>:</span></span><br><span class=\"line\">    __metaclass__ = Singleton2</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">c3 = MyClass2()</span><br><span class=\"line\">c4 = MyClass2()</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">print</span> id(c3)</span><br><span class=\"line\"><span class=\"keyword\">print</span> id(c4)</span><br></pre></td></tr></table></figure>\n<p>以上就是python中实现单例模式的两种常用方法。</p>\n<p>另外还有一种方式：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Singleton</span><span class=\"params\">(object)</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__new__</span><span class=\"params\">(cls, *args, **kwargs)</span>:</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> hasattr(cls, <span class=\"string\">'_instance'</span>):</span><br><span class=\"line\">            cls._instance = super(Singleton, cls).__new__(cls, *args, **kwargs)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> cls._instance</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Foo</span><span class=\"params\">(Singleton)</span>:</span> <span class=\"comment\">#单例类</span></span><br><span class=\"line\">    a = <span class=\"number\">1</span></span><br></pre></td></tr></table></figure>\n<p>参考链接:</p>\n<p><a href=\"http://python.jobbole.com/87514/?repeat=w3tc\" target=\"_blank\" rel=\"noopener\">http://python.jobbole.com/87514/?repeat=w3tc</a></p>\n<p><a href=\"http://blog.csdn.net/karldoenitz/article/details/23467221\" target=\"_blank\" rel=\"noopener\">http://blog.csdn.net/karldoenitz/article/details/23467221</a></p>\n<p><a href=\"http://www.cnblogs.com/kakaliush/p/5228165.html\" target=\"_blank\" rel=\"noopener\">http://www.cnblogs.com/kakaliush/p/5228165.html</a></p>"},{"title":"Python学习笔记之-----闭包","date":"2017-11-23T06:50:44.000Z","_content":"在函数式编程中，经常听到闭包。那么闭包到底是什么呢？使用闭包有什么好处？在python中又应该怎么使用呢？这里用几个小例子记录一下我了解到的python闭包。\n<!--more-->\n#### 什么是闭包\n闭包（Closure）是词法闭包（Lexical Closure）的简称，是引用了自由变量的函数。这个被引用的自由变量将和这个函数一同存在，即使已经离开了创始它的环境也不例外。所以，闭包是函数和与其相关的引用环境组合而形成的实体。\n#### 一个闭包的例子\n\n```python\nfrom urllib import urlopen\ndef page(url):\n  def get():\n    return urlopen(url).read()\n  return get\n\nbaidu_page = page(\"http://www.baidu.com\")\nprint baidu_page\nprint baidu_page()\n```\n在这个例子中，在page函数中，其内部的get函数作为返回值给返回了，在执行get()函数的时候，它会使用原来提供给page（）函数的url去调用urlopen（url）。\n如果想查看闭包中的变量内容，可以这样：\n```shell\n>>>baidu_page.__closure__  #可以看到其closure属性是一个元组\n>>>baidu_page.__closure__[0].cell_contents #查看元组的内容，即传入的url\n```\n#### 使用闭包需要注意的地方\n闭包中是不能修改外部作用域的局部变量的\n```python\ndef foo():\n  m = 0\n  def foo1():\n    m = 1\n    print m\n  print m\n  foo1()\n  print m\n\n>>>foo()\n```\n错误的使用局部变量\n```python\ndef foo():\n  a = 1\n  def bar():\n    a = a + 1\n    return a\n  return bar\n>>>c = foo()\n>>>print c()\n```\n这样在调用的时候会产生错误，因为在bar内部，a在=号之前，被认为是bar的局部变量，等待赋值，而稍后去取a的值，而此时a是未被初始化的，所以会报一个a未定义的错误。解决这个问题的话，可以将a定义为一个可变变量，例如list\n\n#### 闭包的应用例子\n在有的函数中，如果想让函数调用保持某个状态，那么使用闭包是一种非常有效的方式。\n另外一个就是常用的装饰器了。\n闭包有效的减少了函数所需定义的参数数目，便于用于并行计算。\n\n#### 参考链接\nhttp://python.jobbole.com/82624/\nhttps://www.cnblogs.com/ma6174/archive/2013/04/15/3022548.html\nhttps://www.cnblogs.com/ChrisChen3121/p/3208119.html\nhttp://python.jobbole.com/82296/\n《python参考手册》\n","source":"_posts/Python-Closure.md","raw":"---\ntitle: Python学习笔记之-----闭包\ncategories:\n  - Program\ntags:\n  - python\ndate: 2017-11-23 14:50:44\n---\n在函数式编程中，经常听到闭包。那么闭包到底是什么呢？使用闭包有什么好处？在python中又应该怎么使用呢？这里用几个小例子记录一下我了解到的python闭包。\n<!--more-->\n#### 什么是闭包\n闭包（Closure）是词法闭包（Lexical Closure）的简称，是引用了自由变量的函数。这个被引用的自由变量将和这个函数一同存在，即使已经离开了创始它的环境也不例外。所以，闭包是函数和与其相关的引用环境组合而形成的实体。\n#### 一个闭包的例子\n\n```python\nfrom urllib import urlopen\ndef page(url):\n  def get():\n    return urlopen(url).read()\n  return get\n\nbaidu_page = page(\"http://www.baidu.com\")\nprint baidu_page\nprint baidu_page()\n```\n在这个例子中，在page函数中，其内部的get函数作为返回值给返回了，在执行get()函数的时候，它会使用原来提供给page（）函数的url去调用urlopen（url）。\n如果想查看闭包中的变量内容，可以这样：\n```shell\n>>>baidu_page.__closure__  #可以看到其closure属性是一个元组\n>>>baidu_page.__closure__[0].cell_contents #查看元组的内容，即传入的url\n```\n#### 使用闭包需要注意的地方\n闭包中是不能修改外部作用域的局部变量的\n```python\ndef foo():\n  m = 0\n  def foo1():\n    m = 1\n    print m\n  print m\n  foo1()\n  print m\n\n>>>foo()\n```\n错误的使用局部变量\n```python\ndef foo():\n  a = 1\n  def bar():\n    a = a + 1\n    return a\n  return bar\n>>>c = foo()\n>>>print c()\n```\n这样在调用的时候会产生错误，因为在bar内部，a在=号之前，被认为是bar的局部变量，等待赋值，而稍后去取a的值，而此时a是未被初始化的，所以会报一个a未定义的错误。解决这个问题的话，可以将a定义为一个可变变量，例如list\n\n#### 闭包的应用例子\n在有的函数中，如果想让函数调用保持某个状态，那么使用闭包是一种非常有效的方式。\n另外一个就是常用的装饰器了。\n闭包有效的减少了函数所需定义的参数数目，便于用于并行计算。\n\n#### 参考链接\nhttp://python.jobbole.com/82624/\nhttps://www.cnblogs.com/ma6174/archive/2013/04/15/3022548.html\nhttps://www.cnblogs.com/ChrisChen3121/p/3208119.html\nhttp://python.jobbole.com/82296/\n《python参考手册》\n","slug":"Python-Closure","published":1,"updated":"2017-12-04T07:27:28.761Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjeqig1o7003mlgqa6iajcxfi","content":"<p>在函数式编程中，经常听到闭包。那么闭包到底是什么呢？使用闭包有什么好处？在python中又应该怎么使用呢？这里用几个小例子记录一下我了解到的python闭包。<br><a id=\"more\"></a></p>\n<h4 id=\"什么是闭包\"><a href=\"#什么是闭包\" class=\"headerlink\" title=\"什么是闭包\"></a>什么是闭包</h4><p>闭包（Closure）是词法闭包（Lexical Closure）的简称，是引用了自由变量的函数。这个被引用的自由变量将和这个函数一同存在，即使已经离开了创始它的环境也不例外。所以，闭包是函数和与其相关的引用环境组合而形成的实体。</p>\n<h4 id=\"一个闭包的例子\"><a href=\"#一个闭包的例子\" class=\"headerlink\" title=\"一个闭包的例子\"></a>一个闭包的例子</h4><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> urllib <span class=\"keyword\">import</span> urlopen</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">page</span><span class=\"params\">(url)</span>:</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> urlopen(url).read()</span><br><span class=\"line\">  <span class=\"keyword\">return</span> get</span><br><span class=\"line\"></span><br><span class=\"line\">baidu_page = page(<span class=\"string\">\"http://www.baidu.com\"</span>)</span><br><span class=\"line\"><span class=\"keyword\">print</span> baidu_page</span><br><span class=\"line\"><span class=\"keyword\">print</span> baidu_page()</span><br></pre></td></tr></table></figure>\n<p>在这个例子中，在page函数中，其内部的get函数作为返回值给返回了，在执行get()函数的时候，它会使用原来提供给page（）函数的url去调用urlopen（url）。<br>如果想查看闭包中的变量内容，可以这样：<br><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;</span><span class=\"bash\">&gt;&gt;baidu_page.__closure__  <span class=\"comment\">#可以看到其closure属性是一个元组</span></span></span><br><span class=\"line\"><span class=\"meta\">&gt;</span><span class=\"bash\">&gt;&gt;baidu_page.__closure__[0].cell_contents <span class=\"comment\">#查看元组的内容，即传入的url</span></span></span><br></pre></td></tr></table></figure></p>\n<h4 id=\"使用闭包需要注意的地方\"><a href=\"#使用闭包需要注意的地方\" class=\"headerlink\" title=\"使用闭包需要注意的地方\"></a>使用闭包需要注意的地方</h4><p>闭包中是不能修改外部作用域的局部变量的<br><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">foo</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">  m = <span class=\"number\">0</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">foo1</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    m = <span class=\"number\">1</span></span><br><span class=\"line\">    <span class=\"keyword\">print</span> m</span><br><span class=\"line\">  <span class=\"keyword\">print</span> m</span><br><span class=\"line\">  foo1()</span><br><span class=\"line\">  <span class=\"keyword\">print</span> m</span><br><span class=\"line\"></span><br><span class=\"line\">&gt;&gt;&gt;foo()</span><br></pre></td></tr></table></figure></p>\n<p>错误的使用局部变量<br><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">foo</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">  a = <span class=\"number\">1</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">bar</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    a = a + <span class=\"number\">1</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> a</span><br><span class=\"line\">  <span class=\"keyword\">return</span> bar</span><br><span class=\"line\">&gt;&gt;&gt;c = foo()</span><br><span class=\"line\">&gt;&gt;&gt;<span class=\"keyword\">print</span> c()</span><br></pre></td></tr></table></figure></p>\n<p>这样在调用的时候会产生错误，因为在bar内部，a在=号之前，被认为是bar的局部变量，等待赋值，而稍后去取a的值，而此时a是未被初始化的，所以会报一个a未定义的错误。解决这个问题的话，可以将a定义为一个可变变量，例如list</p>\n<h4 id=\"闭包的应用例子\"><a href=\"#闭包的应用例子\" class=\"headerlink\" title=\"闭包的应用例子\"></a>闭包的应用例子</h4><p>在有的函数中，如果想让函数调用保持某个状态，那么使用闭包是一种非常有效的方式。<br>另外一个就是常用的装饰器了。<br>闭包有效的减少了函数所需定义的参数数目，便于用于并行计算。</p>\n<h4 id=\"参考链接\"><a href=\"#参考链接\" class=\"headerlink\" title=\"参考链接\"></a>参考链接</h4><p><a href=\"http://python.jobbole.com/82624/\" target=\"_blank\" rel=\"noopener\">http://python.jobbole.com/82624/</a><br><a href=\"https://www.cnblogs.com/ma6174/archive/2013/04/15/3022548.html\" target=\"_blank\" rel=\"noopener\">https://www.cnblogs.com/ma6174/archive/2013/04/15/3022548.html</a><br><a href=\"https://www.cnblogs.com/ChrisChen3121/p/3208119.html\" target=\"_blank\" rel=\"noopener\">https://www.cnblogs.com/ChrisChen3121/p/3208119.html</a><br><a href=\"http://python.jobbole.com/82296/\" target=\"_blank\" rel=\"noopener\">http://python.jobbole.com/82296/</a><br>《python参考手册》</p>\n","site":{"data":{}},"excerpt":"<p>在函数式编程中，经常听到闭包。那么闭包到底是什么呢？使用闭包有什么好处？在python中又应该怎么使用呢？这里用几个小例子记录一下我了解到的python闭包。<br>","more":"</p>\n<h4 id=\"什么是闭包\"><a href=\"#什么是闭包\" class=\"headerlink\" title=\"什么是闭包\"></a>什么是闭包</h4><p>闭包（Closure）是词法闭包（Lexical Closure）的简称，是引用了自由变量的函数。这个被引用的自由变量将和这个函数一同存在，即使已经离开了创始它的环境也不例外。所以，闭包是函数和与其相关的引用环境组合而形成的实体。</p>\n<h4 id=\"一个闭包的例子\"><a href=\"#一个闭包的例子\" class=\"headerlink\" title=\"一个闭包的例子\"></a>一个闭包的例子</h4><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> urllib <span class=\"keyword\">import</span> urlopen</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">page</span><span class=\"params\">(url)</span>:</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> urlopen(url).read()</span><br><span class=\"line\">  <span class=\"keyword\">return</span> get</span><br><span class=\"line\"></span><br><span class=\"line\">baidu_page = page(<span class=\"string\">\"http://www.baidu.com\"</span>)</span><br><span class=\"line\"><span class=\"keyword\">print</span> baidu_page</span><br><span class=\"line\"><span class=\"keyword\">print</span> baidu_page()</span><br></pre></td></tr></table></figure>\n<p>在这个例子中，在page函数中，其内部的get函数作为返回值给返回了，在执行get()函数的时候，它会使用原来提供给page（）函数的url去调用urlopen（url）。<br>如果想查看闭包中的变量内容，可以这样：<br><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;</span><span class=\"bash\">&gt;&gt;baidu_page.__closure__  <span class=\"comment\">#可以看到其closure属性是一个元组</span></span></span><br><span class=\"line\"><span class=\"meta\">&gt;</span><span class=\"bash\">&gt;&gt;baidu_page.__closure__[0].cell_contents <span class=\"comment\">#查看元组的内容，即传入的url</span></span></span><br></pre></td></tr></table></figure></p>\n<h4 id=\"使用闭包需要注意的地方\"><a href=\"#使用闭包需要注意的地方\" class=\"headerlink\" title=\"使用闭包需要注意的地方\"></a>使用闭包需要注意的地方</h4><p>闭包中是不能修改外部作用域的局部变量的<br><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">foo</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">  m = <span class=\"number\">0</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">foo1</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    m = <span class=\"number\">1</span></span><br><span class=\"line\">    <span class=\"keyword\">print</span> m</span><br><span class=\"line\">  <span class=\"keyword\">print</span> m</span><br><span class=\"line\">  foo1()</span><br><span class=\"line\">  <span class=\"keyword\">print</span> m</span><br><span class=\"line\"></span><br><span class=\"line\">&gt;&gt;&gt;foo()</span><br></pre></td></tr></table></figure></p>\n<p>错误的使用局部变量<br><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">foo</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">  a = <span class=\"number\">1</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">bar</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    a = a + <span class=\"number\">1</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> a</span><br><span class=\"line\">  <span class=\"keyword\">return</span> bar</span><br><span class=\"line\">&gt;&gt;&gt;c = foo()</span><br><span class=\"line\">&gt;&gt;&gt;<span class=\"keyword\">print</span> c()</span><br></pre></td></tr></table></figure></p>\n<p>这样在调用的时候会产生错误，因为在bar内部，a在=号之前，被认为是bar的局部变量，等待赋值，而稍后去取a的值，而此时a是未被初始化的，所以会报一个a未定义的错误。解决这个问题的话，可以将a定义为一个可变变量，例如list</p>\n<h4 id=\"闭包的应用例子\"><a href=\"#闭包的应用例子\" class=\"headerlink\" title=\"闭包的应用例子\"></a>闭包的应用例子</h4><p>在有的函数中，如果想让函数调用保持某个状态，那么使用闭包是一种非常有效的方式。<br>另外一个就是常用的装饰器了。<br>闭包有效的减少了函数所需定义的参数数目，便于用于并行计算。</p>\n<h4 id=\"参考链接\"><a href=\"#参考链接\" class=\"headerlink\" title=\"参考链接\"></a>参考链接</h4><p><a href=\"http://python.jobbole.com/82624/\" target=\"_blank\" rel=\"noopener\">http://python.jobbole.com/82624/</a><br><a href=\"https://www.cnblogs.com/ma6174/archive/2013/04/15/3022548.html\" target=\"_blank\" rel=\"noopener\">https://www.cnblogs.com/ma6174/archive/2013/04/15/3022548.html</a><br><a href=\"https://www.cnblogs.com/ChrisChen3121/p/3208119.html\" target=\"_blank\" rel=\"noopener\">https://www.cnblogs.com/ChrisChen3121/p/3208119.html</a><br><a href=\"http://python.jobbole.com/82296/\" target=\"_blank\" rel=\"noopener\">http://python.jobbole.com/82296/</a><br>《python参考手册》</p>"},{"title":"Ubuntu 17.04 安装PostgreSQL","date":"2017-10-12T05:44:11.000Z","_content":"\n### 在Ubuntu17.04 Server中安装PostgreSQL与基本使用方法\n\nPostgreSQL是自由的对象-关系型数据库服务器（数据库管理系统），在灵活的BSD-风格许可证下发行。它在其他开放源代码数据库系统（比如MySQL和Firebird），和专有系统比如Oracle、Sybase、IBM的DB2和Microsoft SQL Server之外，为用户又提供了一种选择。\n\n<!--more-->\n\n#### 安装\n\n在ubuntu的软件仓库中已经包含了Postgre软件包 ，使用apt可以很方便的安装。\n\n```shell\nxing@ubuntu-server:~$ sudo apt-get install postgresql postgresql-contrib\n```\n\n然后坐等安装完成。安装完成之后，会在系统中创建一个名为postgres的用户，查看/etc/passwd可以看到：\n\n```shell\npostgres:x:113:119:PostgreSQL administrator,,,:/var/lib/postgresql:/bin/bash\n```\n\n这个Linux用户默认和Postgres管理员身份进行了关联，接下来我们就可以使用这个用户来对Postgres进行管理\n\n#### 使用Postgre角色和创建数据库\n\n\n\n首先切换到postgres用户:\n\n```shell\nxing@ubuntu-server:~$ sudo -i -u postgres \n#出现这个提示符表示已经切换到了postgres用户\npostgres@ubuntu-server:~$ \n```\n\n使用psql命令登录PostgreSQL控制台：\n\n```shell\npostgres@ubuntu-server:~$ psql\npsql (9.6.5)\nType \"help\" for help.\n\npostgres=# \n```\n\n然后可以在PostgreSQL控制台为postgres用户先设置给密码：\n\n```shell\npostgres=# \\password postgres\n```\n\n再创建一个名为db_test数据库用户，并设置它的密码为db_test：\n\n```shell\npostgres=# create user db_test with password 'db_test';\n```\n\n创建数据库并将数据库的权限的所有者指定为db_test用户:\n\n```shell\npostgres=# create database testdb owner db_test;\n```\n\n然后再把testdb的权限给db_test用户：\n\n```shell\npostgres=# grant all privileges on database testdb to db_test;\n```\n\n退出psql控制台的方法是:\n\n```shell\npostgres=# \\q\n```\n\n除了使用psql控制台管理数据库，还可以使用shell命令行来进行配置:\n\n在postgres用户的命令提示符下创建数据库用户：\n\n```shell\npostgres@ubuntu-server:~$ createuser --interactive\n```\n\n在其他用户的命令终端下可以这样:\n\n```shell\nxing@ubuntu-server:~$ sudo -u postgres createuser --interactive\n```\n\n在命令终端创建数据库：\n\n​\t在postgres用户的终端：\n\n```shell\npostgres@ubuntu-server:~$ createdb testdb\n```\n\n​\t在其他用户的终端；\n\n```shell\nsudo -u postgres createdb testdb\n```\n\n#### 登录数据库\n\n添加了新的用户和数据库之后，就可以使用新的用户登录到数据库了：\n\n```shell\nxing@ubuntu-server:~$ psql -U db_test -d testdb -h localhost -p 5432\nPassword for user db_test: \npsql (9.6.5)\nSSL connection (protocol: TLSv1.2, cipher: ECDHE-RSA-AES256-GCM-SHA384, bits: 256, compression: off)\nType \"help\" for help.\n\ntestdb=> \n```\n\n#### psql控制台的一些命令\n\n- \\h：查看SQL命令的解释，比如\\h select。\n- \\?：查看psql命令列表。\n- \\l：列出所有数据库。\n- \\c [database_name]：连接其他数据库。\n- \\d：列出当前数据库的所有表格。\n- \\d [table_name]：列出某一张表格的结构。\n- \\du：列出所有用户。\n- \\e：打开文本编辑器。\n- \\conninfo：列出当前数据库和连接的信息。\n\n参考资料:\n\nhttp://www.ruanyifeng.com/blog/2013/12/getting_started_with_postgresql.html\n\nhttps://www.digitalocean.com/community/tutorials/how-to-install-and-use-postgresql-on-ubuntu-16-04","source":"_posts/Ubuntu-install-Postgres.md","raw":"---\ntitle: Ubuntu 17.04 安装PostgreSQL\ncategories:\n  - Linux\ntags:\n  - postgres\ndate: 2017-10-12 13:44:11\n---\n\n### 在Ubuntu17.04 Server中安装PostgreSQL与基本使用方法\n\nPostgreSQL是自由的对象-关系型数据库服务器（数据库管理系统），在灵活的BSD-风格许可证下发行。它在其他开放源代码数据库系统（比如MySQL和Firebird），和专有系统比如Oracle、Sybase、IBM的DB2和Microsoft SQL Server之外，为用户又提供了一种选择。\n\n<!--more-->\n\n#### 安装\n\n在ubuntu的软件仓库中已经包含了Postgre软件包 ，使用apt可以很方便的安装。\n\n```shell\nxing@ubuntu-server:~$ sudo apt-get install postgresql postgresql-contrib\n```\n\n然后坐等安装完成。安装完成之后，会在系统中创建一个名为postgres的用户，查看/etc/passwd可以看到：\n\n```shell\npostgres:x:113:119:PostgreSQL administrator,,,:/var/lib/postgresql:/bin/bash\n```\n\n这个Linux用户默认和Postgres管理员身份进行了关联，接下来我们就可以使用这个用户来对Postgres进行管理\n\n#### 使用Postgre角色和创建数据库\n\n\n\n首先切换到postgres用户:\n\n```shell\nxing@ubuntu-server:~$ sudo -i -u postgres \n#出现这个提示符表示已经切换到了postgres用户\npostgres@ubuntu-server:~$ \n```\n\n使用psql命令登录PostgreSQL控制台：\n\n```shell\npostgres@ubuntu-server:~$ psql\npsql (9.6.5)\nType \"help\" for help.\n\npostgres=# \n```\n\n然后可以在PostgreSQL控制台为postgres用户先设置给密码：\n\n```shell\npostgres=# \\password postgres\n```\n\n再创建一个名为db_test数据库用户，并设置它的密码为db_test：\n\n```shell\npostgres=# create user db_test with password 'db_test';\n```\n\n创建数据库并将数据库的权限的所有者指定为db_test用户:\n\n```shell\npostgres=# create database testdb owner db_test;\n```\n\n然后再把testdb的权限给db_test用户：\n\n```shell\npostgres=# grant all privileges on database testdb to db_test;\n```\n\n退出psql控制台的方法是:\n\n```shell\npostgres=# \\q\n```\n\n除了使用psql控制台管理数据库，还可以使用shell命令行来进行配置:\n\n在postgres用户的命令提示符下创建数据库用户：\n\n```shell\npostgres@ubuntu-server:~$ createuser --interactive\n```\n\n在其他用户的命令终端下可以这样:\n\n```shell\nxing@ubuntu-server:~$ sudo -u postgres createuser --interactive\n```\n\n在命令终端创建数据库：\n\n​\t在postgres用户的终端：\n\n```shell\npostgres@ubuntu-server:~$ createdb testdb\n```\n\n​\t在其他用户的终端；\n\n```shell\nsudo -u postgres createdb testdb\n```\n\n#### 登录数据库\n\n添加了新的用户和数据库之后，就可以使用新的用户登录到数据库了：\n\n```shell\nxing@ubuntu-server:~$ psql -U db_test -d testdb -h localhost -p 5432\nPassword for user db_test: \npsql (9.6.5)\nSSL connection (protocol: TLSv1.2, cipher: ECDHE-RSA-AES256-GCM-SHA384, bits: 256, compression: off)\nType \"help\" for help.\n\ntestdb=> \n```\n\n#### psql控制台的一些命令\n\n- \\h：查看SQL命令的解释，比如\\h select。\n- \\?：查看psql命令列表。\n- \\l：列出所有数据库。\n- \\c [database_name]：连接其他数据库。\n- \\d：列出当前数据库的所有表格。\n- \\d [table_name]：列出某一张表格的结构。\n- \\du：列出所有用户。\n- \\e：打开文本编辑器。\n- \\conninfo：列出当前数据库和连接的信息。\n\n参考资料:\n\nhttp://www.ruanyifeng.com/blog/2013/12/getting_started_with_postgresql.html\n\nhttps://www.digitalocean.com/community/tutorials/how-to-install-and-use-postgresql-on-ubuntu-16-04","slug":"Ubuntu-install-Postgres","published":1,"updated":"2017-12-04T07:27:28.763Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjeqig1oc003qlgqawk9wcfon","content":"<h3 id=\"在Ubuntu17-04-Server中安装PostgreSQL与基本使用方法\"><a href=\"#在Ubuntu17-04-Server中安装PostgreSQL与基本使用方法\" class=\"headerlink\" title=\"在Ubuntu17.04 Server中安装PostgreSQL与基本使用方法\"></a>在Ubuntu17.04 Server中安装PostgreSQL与基本使用方法</h3><p>PostgreSQL是自由的对象-关系型数据库服务器（数据库管理系统），在灵活的BSD-风格许可证下发行。它在其他开放源代码数据库系统（比如MySQL和Firebird），和专有系统比如Oracle、Sybase、IBM的DB2和Microsoft SQL Server之外，为用户又提供了一种选择。</p>\n<a id=\"more\"></a>\n<h4 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h4><p>在ubuntu的软件仓库中已经包含了Postgre软件包 ，使用apt可以很方便的安装。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">xing@ubuntu-server:~$ sudo apt-get install postgresql postgresql-contrib</span><br></pre></td></tr></table></figure>\n<p>然后坐等安装完成。安装完成之后，会在系统中创建一个名为postgres的用户，查看/etc/passwd可以看到：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">postgres:x:113:119:PostgreSQL administrator,,,:/var/lib/postgresql:/bin/bash</span><br></pre></td></tr></table></figure>\n<p>这个Linux用户默认和Postgres管理员身份进行了关联，接下来我们就可以使用这个用户来对Postgres进行管理</p>\n<h4 id=\"使用Postgre角色和创建数据库\"><a href=\"#使用Postgre角色和创建数据库\" class=\"headerlink\" title=\"使用Postgre角色和创建数据库\"></a>使用Postgre角色和创建数据库</h4><p>首先切换到postgres用户:</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">xing@ubuntu-server:~$ sudo -i -u postgres </span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">出现这个提示符表示已经切换到了postgres用户</span></span><br><span class=\"line\">postgres@ubuntu-server:~$</span><br></pre></td></tr></table></figure>\n<p>使用psql命令登录PostgreSQL控制台：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">postgres@ubuntu-server:~$ psql</span><br><span class=\"line\">psql (9.6.5)</span><br><span class=\"line\">Type \"help\" for help.</span><br><span class=\"line\"></span><br><span class=\"line\">postgres=#</span><br></pre></td></tr></table></figure>\n<p>然后可以在PostgreSQL控制台为postgres用户先设置给密码：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">postgres=# \\password postgres</span><br></pre></td></tr></table></figure>\n<p>再创建一个名为db_test数据库用户，并设置它的密码为db_test：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">postgres=# create user db_test with password 'db_test';</span><br></pre></td></tr></table></figure>\n<p>创建数据库并将数据库的权限的所有者指定为db_test用户:</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">postgres=# create database testdb owner db_test;</span><br></pre></td></tr></table></figure>\n<p>然后再把testdb的权限给db_test用户：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">postgres=# grant all privileges on database testdb to db_test;</span><br></pre></td></tr></table></figure>\n<p>退出psql控制台的方法是:</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">postgres=# \\q</span><br></pre></td></tr></table></figure>\n<p>除了使用psql控制台管理数据库，还可以使用shell命令行来进行配置:</p>\n<p>在postgres用户的命令提示符下创建数据库用户：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">postgres@ubuntu-server:~$ createuser --interactive</span><br></pre></td></tr></table></figure>\n<p>在其他用户的命令终端下可以这样:</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">xing@ubuntu-server:~$ sudo -u postgres createuser --interactive</span><br></pre></td></tr></table></figure>\n<p>在命令终端创建数据库：</p>\n<p>​    在postgres用户的终端：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">postgres@ubuntu-server:~$ createdb testdb</span><br></pre></td></tr></table></figure>\n<p>​    在其他用户的终端；</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo -u postgres createdb testdb</span><br></pre></td></tr></table></figure>\n<h4 id=\"登录数据库\"><a href=\"#登录数据库\" class=\"headerlink\" title=\"登录数据库\"></a>登录数据库</h4><p>添加了新的用户和数据库之后，就可以使用新的用户登录到数据库了：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">xing@ubuntu-server:~$ psql -U db_test -d testdb -h localhost -p 5432</span><br><span class=\"line\">Password for user db_test: </span><br><span class=\"line\">psql (9.6.5)</span><br><span class=\"line\">SSL connection (protocol: TLSv1.2, cipher: ECDHE-RSA-AES256-GCM-SHA384, bits: 256, compression: off)</span><br><span class=\"line\">Type \"help\" for help.</span><br><span class=\"line\"></span><br><span class=\"line\">testdb=&gt;</span><br></pre></td></tr></table></figure>\n<h4 id=\"psql控制台的一些命令\"><a href=\"#psql控制台的一些命令\" class=\"headerlink\" title=\"psql控制台的一些命令\"></a>psql控制台的一些命令</h4><ul>\n<li>\\h：查看SQL命令的解释，比如\\h select。</li>\n<li>\\?：查看psql命令列表。</li>\n<li>\\l：列出所有数据库。</li>\n<li>\\c [database_name]：连接其他数据库。</li>\n<li>\\d：列出当前数据库的所有表格。</li>\n<li>\\d [table_name]：列出某一张表格的结构。</li>\n<li>\\du：列出所有用户。</li>\n<li>\\e：打开文本编辑器。</li>\n<li>\\conninfo：列出当前数据库和连接的信息。</li>\n</ul>\n<p>参考资料:</p>\n<p><a href=\"http://www.ruanyifeng.com/blog/2013/12/getting_started_with_postgresql.html\" target=\"_blank\" rel=\"noopener\">http://www.ruanyifeng.com/blog/2013/12/getting_started_with_postgresql.html</a></p>\n<p><a href=\"https://www.digitalocean.com/community/tutorials/how-to-install-and-use-postgresql-on-ubuntu-16-04\" target=\"_blank\" rel=\"noopener\">https://www.digitalocean.com/community/tutorials/how-to-install-and-use-postgresql-on-ubuntu-16-04</a></p>\n","site":{"data":{}},"excerpt":"<h3 id=\"在Ubuntu17-04-Server中安装PostgreSQL与基本使用方法\"><a href=\"#在Ubuntu17-04-Server中安装PostgreSQL与基本使用方法\" class=\"headerlink\" title=\"在Ubuntu17.04 Server中安装PostgreSQL与基本使用方法\"></a>在Ubuntu17.04 Server中安装PostgreSQL与基本使用方法</h3><p>PostgreSQL是自由的对象-关系型数据库服务器（数据库管理系统），在灵活的BSD-风格许可证下发行。它在其他开放源代码数据库系统（比如MySQL和Firebird），和专有系统比如Oracle、Sybase、IBM的DB2和Microsoft SQL Server之外，为用户又提供了一种选择。</p>","more":"<h4 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h4><p>在ubuntu的软件仓库中已经包含了Postgre软件包 ，使用apt可以很方便的安装。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">xing@ubuntu-server:~$ sudo apt-get install postgresql postgresql-contrib</span><br></pre></td></tr></table></figure>\n<p>然后坐等安装完成。安装完成之后，会在系统中创建一个名为postgres的用户，查看/etc/passwd可以看到：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">postgres:x:113:119:PostgreSQL administrator,,,:/var/lib/postgresql:/bin/bash</span><br></pre></td></tr></table></figure>\n<p>这个Linux用户默认和Postgres管理员身份进行了关联，接下来我们就可以使用这个用户来对Postgres进行管理</p>\n<h4 id=\"使用Postgre角色和创建数据库\"><a href=\"#使用Postgre角色和创建数据库\" class=\"headerlink\" title=\"使用Postgre角色和创建数据库\"></a>使用Postgre角色和创建数据库</h4><p>首先切换到postgres用户:</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">xing@ubuntu-server:~$ sudo -i -u postgres </span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">出现这个提示符表示已经切换到了postgres用户</span></span><br><span class=\"line\">postgres@ubuntu-server:~$</span><br></pre></td></tr></table></figure>\n<p>使用psql命令登录PostgreSQL控制台：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">postgres@ubuntu-server:~$ psql</span><br><span class=\"line\">psql (9.6.5)</span><br><span class=\"line\">Type \"help\" for help.</span><br><span class=\"line\"></span><br><span class=\"line\">postgres=#</span><br></pre></td></tr></table></figure>\n<p>然后可以在PostgreSQL控制台为postgres用户先设置给密码：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">postgres=# \\password postgres</span><br></pre></td></tr></table></figure>\n<p>再创建一个名为db_test数据库用户，并设置它的密码为db_test：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">postgres=# create user db_test with password 'db_test';</span><br></pre></td></tr></table></figure>\n<p>创建数据库并将数据库的权限的所有者指定为db_test用户:</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">postgres=# create database testdb owner db_test;</span><br></pre></td></tr></table></figure>\n<p>然后再把testdb的权限给db_test用户：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">postgres=# grant all privileges on database testdb to db_test;</span><br></pre></td></tr></table></figure>\n<p>退出psql控制台的方法是:</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">postgres=# \\q</span><br></pre></td></tr></table></figure>\n<p>除了使用psql控制台管理数据库，还可以使用shell命令行来进行配置:</p>\n<p>在postgres用户的命令提示符下创建数据库用户：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">postgres@ubuntu-server:~$ createuser --interactive</span><br></pre></td></tr></table></figure>\n<p>在其他用户的命令终端下可以这样:</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">xing@ubuntu-server:~$ sudo -u postgres createuser --interactive</span><br></pre></td></tr></table></figure>\n<p>在命令终端创建数据库：</p>\n<p>​    在postgres用户的终端：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">postgres@ubuntu-server:~$ createdb testdb</span><br></pre></td></tr></table></figure>\n<p>​    在其他用户的终端；</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo -u postgres createdb testdb</span><br></pre></td></tr></table></figure>\n<h4 id=\"登录数据库\"><a href=\"#登录数据库\" class=\"headerlink\" title=\"登录数据库\"></a>登录数据库</h4><p>添加了新的用户和数据库之后，就可以使用新的用户登录到数据库了：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">xing@ubuntu-server:~$ psql -U db_test -d testdb -h localhost -p 5432</span><br><span class=\"line\">Password for user db_test: </span><br><span class=\"line\">psql (9.6.5)</span><br><span class=\"line\">SSL connection (protocol: TLSv1.2, cipher: ECDHE-RSA-AES256-GCM-SHA384, bits: 256, compression: off)</span><br><span class=\"line\">Type \"help\" for help.</span><br><span class=\"line\"></span><br><span class=\"line\">testdb=&gt;</span><br></pre></td></tr></table></figure>\n<h4 id=\"psql控制台的一些命令\"><a href=\"#psql控制台的一些命令\" class=\"headerlink\" title=\"psql控制台的一些命令\"></a>psql控制台的一些命令</h4><ul>\n<li>\\h：查看SQL命令的解释，比如\\h select。</li>\n<li>\\?：查看psql命令列表。</li>\n<li>\\l：列出所有数据库。</li>\n<li>\\c [database_name]：连接其他数据库。</li>\n<li>\\d：列出当前数据库的所有表格。</li>\n<li>\\d [table_name]：列出某一张表格的结构。</li>\n<li>\\du：列出所有用户。</li>\n<li>\\e：打开文本编辑器。</li>\n<li>\\conninfo：列出当前数据库和连接的信息。</li>\n</ul>\n<p>参考资料:</p>\n<p><a href=\"http://www.ruanyifeng.com/blog/2013/12/getting_started_with_postgresql.html\" target=\"_blank\" rel=\"noopener\">http://www.ruanyifeng.com/blog/2013/12/getting_started_with_postgresql.html</a></p>\n<p><a href=\"https://www.digitalocean.com/community/tutorials/how-to-install-and-use-postgresql-on-ubuntu-16-04\" target=\"_blank\" rel=\"noopener\">https://www.digitalocean.com/community/tutorials/how-to-install-and-use-postgresql-on-ubuntu-16-04</a></p>"},{"title":"SOCKET编程----Echo Something","date":"2017-09-18T18:19:13.000Z","_content":"\n在网络世界中，socket通信几乎是当前几乎所有上层应用层协议的基础，例如用的较多的http协议，ftp协议，SMTP协议的背后都是socket在担负着通信过程。这篇博文首先用一个简单的TCP socket程序实例来引入Linux环境下的socket编程技术。不管原理懂不懂，先搞个程序跑起来先！\n\n<!--more-->\n\n- 程序目的\n\n  服务端：接收来自客户端的内容，计算客户端发送的消息长度，然后将长度返回给客户端。\n\n  客户端：从标准输入读取输入内容，并发送给服务端，接收来自服务端的响应，将响应内容输出至标准输出。\n\n  服务端代码：\n\n  ```c\n  #include <stdio.h>\n  #include <stdlib.h>\n  #include <strings.h>\n  #include <sys/types.h>\n  #include <sys/socket.h>\n  #include <arpa/inet.h>\n  #include <unistd.h>\n\n  #define PORT 5555\n  #define BACKLOG 2\n  void process_conn_server(int s){\n\n  \tssize_t size = 0;\n  \tchar buffer[1024];\n  \t\n  \tfor(;;){\n  \t\t\n  \t\tsize = read(s,buffer,1024);\n  \t\tprintf(\"read %d\\n\",size);\t\t\n  \t\tif(size ==0){\n  \t\t\treturn;\n  \t\t}\n  \tsprintf(buffer,\"%d bytes altother\\n\",size);\n  \twrite(s,buffer,strlen(buffer)+1);\n  \t}\n  }\n  int main(int argc, char *argv[])\n  {\n  \tint ss,sc;\n  \tstruct sockaddr_in server_addr;\n  \tstruct sockaddr_in client_addr;\n  \tint err;\n  \tpid_t pid;\n\n  \tss = socket(AF_INET,SOCK_STREAM,0);\n  \tif(ss < 0){\n  \t\tprintf(\"socket error.\\n\");\n  \t\treturn -1;\n  \t}\n\n  \tbzero(&server_addr,sizeof(server_addr));\n  \tserver_addr.sin_family = AF_INET;\n  \tserver_addr.sin_addr.s_addr = htonl(INADDR_ANY);\n  \tserver_addr.sin_port = htons(PORT);\n\n  \terr = bind(ss,(struct sockaddr*)&server_addr,sizeof(server_addr));\n  \tif(err < 0){\n  \t\tprintf(\"bind err.\\n\");\n  \t\treturn -1;\n  \t}\n\n  \terr = listen(ss,BACKLOG);\n  \tif(err < 0){\n  \t\tprintf(\"listen err.\\n\");\n  \t\treturn -1;\n  \t}\n\n  \tfor(;;){\n\n  \t\tsocklen_t addrlen = sizeof(struct sockaddr);\n  \t\t\n  \t\tsc = accept(ss,(struct sockaddr*)&client_addr,&addrlen);\n  \t\tif(sc < 0){\n  \t\t\tcontinue;\n  \t\t}else{\n  \t\t\tprintf(\"some one conn~\\n\");\n  \t\t}\n\n  \t\tpid = fork();\n  \t\tif(pid < 0 ){\n  \t\t\tclose(ss);\n  \t\t}else{\n  \t\t\tprocess_conn_server(sc);\n  \t\t\tclose(sc);\n  \t\t}\n  \t}\n  }\n\n  ```\n\n  客户端代码：\n\n  ```c\n  #include <stdio.h>\n  #include <stdlib.h>\n  #include <strings.h>\n  #include <sys/types.h>\n  #include <sys/socket.h>\n  #include <unistd.h>\n  #include <arpa/inet.h>\n\n  #define PORT 5555 \n  void process_conn_client(int s){\n\n  \tssize_t size = 0;\n  \tchar buffer[1024];\n\n  \tfor(;;){\n  \t\tsize = read(0,buffer,1024);\n  \t\tif(size > 0){\n  \t\t\twrite(s,buffer,size);\n  \t\t\tsize = read(s,buffer,1024);\n  \t\t\twrite(1,buffer,size);\n  \t\t}\n  \t}\n\n  }\n  int main(int argc,char *argv[]){\n\n  \tint s;\n  \tstruct sockaddr_in server_addr;\n  \ts = socket(AF_INET,SOCK_STREAM,0);\n  \tif(s < 0){\n  \t\tprintf(\"socket error\\n\");\n  \t\treturn -1;\n  \t}\n\n  \tbzero(&server_addr,sizeof(server_addr));\n  \tserver_addr.sin_family = AF_INET;\n  \tserver_addr.sin_addr.s_addr = htonl(INADDR_ANY);\n  \tserver_addr.sin_port = htons(PORT);\n  \tinet_pton(AF_INET,argv[1],&server_addr.sin_addr);\n  \tconnect(s,(struct sockaddr*)&server_addr,sizeof(struct sockaddr));\n  \tprocess_conn_client(s);\n  \tclose(s);\n  \treturn 0;\n  }\n\n  ```\n\n  ​\n\n运行实例：\n\n```bash\nmodel@PWN-VirtualBox:~/NetworkProgram$ ./server \nsome one conn~\nread 5\n------------------------------------------------------------------\nmodel@PWN-VirtualBox:~/NetworkProgram$ ./client 127.0.0.1\nabcd\n5 bytes altother\n```\n\n这是一个简单的tcp通信的程序示例，在这个程序中，一次只能服务两个客户端，不太具备实用价值。但是这个示例完整的包括了tcp socket通信的各个步骤，可以在此基础上继续丰富，完成更复杂的业务逻辑。在之后的博文中我将继续来解释socket编程的各个知识点。","source":"_posts/TCP-Echo-Demo.md","raw":"---\ntitle: SOCKET编程----Echo Something\ncategories:\n  - Linux\ntags:\n  - tcp program\ndate: 2017-09-19 02:19:13\n---\n\n在网络世界中，socket通信几乎是当前几乎所有上层应用层协议的基础，例如用的较多的http协议，ftp协议，SMTP协议的背后都是socket在担负着通信过程。这篇博文首先用一个简单的TCP socket程序实例来引入Linux环境下的socket编程技术。不管原理懂不懂，先搞个程序跑起来先！\n\n<!--more-->\n\n- 程序目的\n\n  服务端：接收来自客户端的内容，计算客户端发送的消息长度，然后将长度返回给客户端。\n\n  客户端：从标准输入读取输入内容，并发送给服务端，接收来自服务端的响应，将响应内容输出至标准输出。\n\n  服务端代码：\n\n  ```c\n  #include <stdio.h>\n  #include <stdlib.h>\n  #include <strings.h>\n  #include <sys/types.h>\n  #include <sys/socket.h>\n  #include <arpa/inet.h>\n  #include <unistd.h>\n\n  #define PORT 5555\n  #define BACKLOG 2\n  void process_conn_server(int s){\n\n  \tssize_t size = 0;\n  \tchar buffer[1024];\n  \t\n  \tfor(;;){\n  \t\t\n  \t\tsize = read(s,buffer,1024);\n  \t\tprintf(\"read %d\\n\",size);\t\t\n  \t\tif(size ==0){\n  \t\t\treturn;\n  \t\t}\n  \tsprintf(buffer,\"%d bytes altother\\n\",size);\n  \twrite(s,buffer,strlen(buffer)+1);\n  \t}\n  }\n  int main(int argc, char *argv[])\n  {\n  \tint ss,sc;\n  \tstruct sockaddr_in server_addr;\n  \tstruct sockaddr_in client_addr;\n  \tint err;\n  \tpid_t pid;\n\n  \tss = socket(AF_INET,SOCK_STREAM,0);\n  \tif(ss < 0){\n  \t\tprintf(\"socket error.\\n\");\n  \t\treturn -1;\n  \t}\n\n  \tbzero(&server_addr,sizeof(server_addr));\n  \tserver_addr.sin_family = AF_INET;\n  \tserver_addr.sin_addr.s_addr = htonl(INADDR_ANY);\n  \tserver_addr.sin_port = htons(PORT);\n\n  \terr = bind(ss,(struct sockaddr*)&server_addr,sizeof(server_addr));\n  \tif(err < 0){\n  \t\tprintf(\"bind err.\\n\");\n  \t\treturn -1;\n  \t}\n\n  \terr = listen(ss,BACKLOG);\n  \tif(err < 0){\n  \t\tprintf(\"listen err.\\n\");\n  \t\treturn -1;\n  \t}\n\n  \tfor(;;){\n\n  \t\tsocklen_t addrlen = sizeof(struct sockaddr);\n  \t\t\n  \t\tsc = accept(ss,(struct sockaddr*)&client_addr,&addrlen);\n  \t\tif(sc < 0){\n  \t\t\tcontinue;\n  \t\t}else{\n  \t\t\tprintf(\"some one conn~\\n\");\n  \t\t}\n\n  \t\tpid = fork();\n  \t\tif(pid < 0 ){\n  \t\t\tclose(ss);\n  \t\t}else{\n  \t\t\tprocess_conn_server(sc);\n  \t\t\tclose(sc);\n  \t\t}\n  \t}\n  }\n\n  ```\n\n  客户端代码：\n\n  ```c\n  #include <stdio.h>\n  #include <stdlib.h>\n  #include <strings.h>\n  #include <sys/types.h>\n  #include <sys/socket.h>\n  #include <unistd.h>\n  #include <arpa/inet.h>\n\n  #define PORT 5555 \n  void process_conn_client(int s){\n\n  \tssize_t size = 0;\n  \tchar buffer[1024];\n\n  \tfor(;;){\n  \t\tsize = read(0,buffer,1024);\n  \t\tif(size > 0){\n  \t\t\twrite(s,buffer,size);\n  \t\t\tsize = read(s,buffer,1024);\n  \t\t\twrite(1,buffer,size);\n  \t\t}\n  \t}\n\n  }\n  int main(int argc,char *argv[]){\n\n  \tint s;\n  \tstruct sockaddr_in server_addr;\n  \ts = socket(AF_INET,SOCK_STREAM,0);\n  \tif(s < 0){\n  \t\tprintf(\"socket error\\n\");\n  \t\treturn -1;\n  \t}\n\n  \tbzero(&server_addr,sizeof(server_addr));\n  \tserver_addr.sin_family = AF_INET;\n  \tserver_addr.sin_addr.s_addr = htonl(INADDR_ANY);\n  \tserver_addr.sin_port = htons(PORT);\n  \tinet_pton(AF_INET,argv[1],&server_addr.sin_addr);\n  \tconnect(s,(struct sockaddr*)&server_addr,sizeof(struct sockaddr));\n  \tprocess_conn_client(s);\n  \tclose(s);\n  \treturn 0;\n  }\n\n  ```\n\n  ​\n\n运行实例：\n\n```bash\nmodel@PWN-VirtualBox:~/NetworkProgram$ ./server \nsome one conn~\nread 5\n------------------------------------------------------------------\nmodel@PWN-VirtualBox:~/NetworkProgram$ ./client 127.0.0.1\nabcd\n5 bytes altother\n```\n\n这是一个简单的tcp通信的程序示例，在这个程序中，一次只能服务两个客户端，不太具备实用价值。但是这个示例完整的包括了tcp socket通信的各个步骤，可以在此基础上继续丰富，完成更复杂的业务逻辑。在之后的博文中我将继续来解释socket编程的各个知识点。","slug":"TCP-Echo-Demo","published":1,"updated":"2017-12-04T07:27:28.762Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjeqig1of003tlgqa7a8rpw1a","content":"<p>在网络世界中，socket通信几乎是当前几乎所有上层应用层协议的基础，例如用的较多的http协议，ftp协议，SMTP协议的背后都是socket在担负着通信过程。这篇博文首先用一个简单的TCP socket程序实例来引入Linux环境下的socket编程技术。不管原理懂不懂，先搞个程序跑起来先！</p>\n<a id=\"more\"></a>\n<ul>\n<li><p>程序目的</p>\n<p>服务端：接收来自客户端的内容，计算客户端发送的消息长度，然后将长度返回给客户端。</p>\n<p>客户端：从标准输入读取输入内容，并发送给服务端，接收来自服务端的响应，将响应内容输出至标准输出。</p>\n<p>服务端代码：</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;stdio.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;stdlib.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;strings.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;sys/types.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;sys/socket.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;arpa/inet.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;unistd.h&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> PORT 5555</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> BACKLOG 2</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">process_conn_server</span><span class=\"params\">(<span class=\"keyword\">int</span> s)</span></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">ssize_t</span> size = <span class=\"number\">0</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">char</span> buffer[<span class=\"number\">1024</span>];</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"keyword\">for</span>(;;)&#123;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\tsize = read(s,buffer,<span class=\"number\">1024</span>);</span><br><span class=\"line\">\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">\"read %d\\n\"</span>,size);\t\t</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span>(size ==<span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t<span class=\"built_in\">sprintf</span>(buffer,<span class=\"string\">\"%d bytes altother\\n\"</span>,size);</span><br><span class=\"line\">\twrite(s,buffer,<span class=\"built_in\">strlen</span>(buffer)+<span class=\"number\">1</span>);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">(<span class=\"keyword\">int</span> argc, <span class=\"keyword\">char</span> *argv[])</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">int</span> ss,sc;</span><br><span class=\"line\">\t<span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">sockaddr_in</span> <span class=\"title\">server_addr</span>;</span></span><br><span class=\"line\">\t<span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">sockaddr_in</span> <span class=\"title\">client_addr</span>;</span></span><br><span class=\"line\">\t<span class=\"keyword\">int</span> err;</span><br><span class=\"line\">\t<span class=\"keyword\">pid_t</span> pid;</span><br><span class=\"line\"></span><br><span class=\"line\">\tss = socket(AF_INET,SOCK_STREAM,<span class=\"number\">0</span>);</span><br><span class=\"line\">\t<span class=\"keyword\">if</span>(ss &lt; <span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">\"socket error.\\n\"</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tbzero(&amp;server_addr,<span class=\"keyword\">sizeof</span>(server_addr));</span><br><span class=\"line\">\tserver_addr.sin_family = AF_INET;</span><br><span class=\"line\">\tserver_addr.sin_addr.s_addr = htonl(INADDR_ANY);</span><br><span class=\"line\">\tserver_addr.sin_port = htons(PORT);</span><br><span class=\"line\"></span><br><span class=\"line\">\terr = bind(ss,(struct sockaddr*)&amp;server_addr,<span class=\"keyword\">sizeof</span>(server_addr));</span><br><span class=\"line\">\t<span class=\"keyword\">if</span>(err &lt; <span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">\"bind err.\\n\"</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\terr = listen(ss,BACKLOG);</span><br><span class=\"line\">\t<span class=\"keyword\">if</span>(err &lt; <span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">\"listen err.\\n\"</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">for</span>(;;)&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">socklen_t</span> addrlen = <span class=\"keyword\">sizeof</span>(struct sockaddr);</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\tsc = accept(ss,(struct sockaddr*)&amp;client_addr,&amp;addrlen);</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span>(sc &lt; <span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">continue</span>;</span><br><span class=\"line\">\t\t&#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">\"some one conn~\\n\"</span>);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\tpid = fork();</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span>(pid &lt; <span class=\"number\">0</span> )&#123;</span><br><span class=\"line\">\t\t\tclose(ss);</span><br><span class=\"line\">\t\t&#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">\t\t\tprocess_conn_server(sc);</span><br><span class=\"line\">\t\t\tclose(sc);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>客户端代码：</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;stdio.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;stdlib.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;strings.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;sys/types.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;sys/socket.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;unistd.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;arpa/inet.h&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> PORT 5555 </span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">process_conn_client</span><span class=\"params\">(<span class=\"keyword\">int</span> s)</span></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">ssize_t</span> size = <span class=\"number\">0</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">char</span> buffer[<span class=\"number\">1024</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">for</span>(;;)&#123;</span><br><span class=\"line\">\t\tsize = read(<span class=\"number\">0</span>,buffer,<span class=\"number\">1024</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span>(size &gt; <span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">\t\t\twrite(s,buffer,size);</span><br><span class=\"line\">\t\t\tsize = read(s,buffer,<span class=\"number\">1024</span>);</span><br><span class=\"line\">\t\t\twrite(<span class=\"number\">1</span>,buffer,size);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">(<span class=\"keyword\">int</span> argc,<span class=\"keyword\">char</span> *argv[])</span></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">int</span> s;</span><br><span class=\"line\">\t<span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">sockaddr_in</span> <span class=\"title\">server_addr</span>;</span></span><br><span class=\"line\">\ts = socket(AF_INET,SOCK_STREAM,<span class=\"number\">0</span>);</span><br><span class=\"line\">\t<span class=\"keyword\">if</span>(s &lt; <span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">\"socket error\\n\"</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tbzero(&amp;server_addr,<span class=\"keyword\">sizeof</span>(server_addr));</span><br><span class=\"line\">\tserver_addr.sin_family = AF_INET;</span><br><span class=\"line\">\tserver_addr.sin_addr.s_addr = htonl(INADDR_ANY);</span><br><span class=\"line\">\tserver_addr.sin_port = htons(PORT);</span><br><span class=\"line\">\tinet_pton(AF_INET,argv[<span class=\"number\">1</span>],&amp;server_addr.sin_addr);</span><br><span class=\"line\">\tconnect(s,(struct sockaddr*)&amp;server_addr,<span class=\"keyword\">sizeof</span>(struct sockaddr));</span><br><span class=\"line\">\tprocess_conn_client(s);</span><br><span class=\"line\">\tclose(s);</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>​</p>\n</li>\n</ul>\n<p>运行实例：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">model@PWN-VirtualBox:~/NetworkProgram$ ./server </span><br><span class=\"line\">some one conn~</span><br><span class=\"line\"><span class=\"built_in\">read</span> 5</span><br><span class=\"line\">------------------------------------------------------------------</span><br><span class=\"line\">model@PWN-VirtualBox:~/NetworkProgram$ ./client 127.0.0.1</span><br><span class=\"line\">abcd</span><br><span class=\"line\">5 bytes altother</span><br></pre></td></tr></table></figure>\n<p>这是一个简单的tcp通信的程序示例，在这个程序中，一次只能服务两个客户端，不太具备实用价值。但是这个示例完整的包括了tcp socket通信的各个步骤，可以在此基础上继续丰富，完成更复杂的业务逻辑。在之后的博文中我将继续来解释socket编程的各个知识点。</p>\n","site":{"data":{}},"excerpt":"<p>在网络世界中，socket通信几乎是当前几乎所有上层应用层协议的基础，例如用的较多的http协议，ftp协议，SMTP协议的背后都是socket在担负着通信过程。这篇博文首先用一个简单的TCP socket程序实例来引入Linux环境下的socket编程技术。不管原理懂不懂，先搞个程序跑起来先！</p>","more":"<ul>\n<li><p>程序目的</p>\n<p>服务端：接收来自客户端的内容，计算客户端发送的消息长度，然后将长度返回给客户端。</p>\n<p>客户端：从标准输入读取输入内容，并发送给服务端，接收来自服务端的响应，将响应内容输出至标准输出。</p>\n<p>服务端代码：</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;stdio.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;stdlib.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;strings.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;sys/types.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;sys/socket.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;arpa/inet.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;unistd.h&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> PORT 5555</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> BACKLOG 2</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">process_conn_server</span><span class=\"params\">(<span class=\"keyword\">int</span> s)</span></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">ssize_t</span> size = <span class=\"number\">0</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">char</span> buffer[<span class=\"number\">1024</span>];</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"keyword\">for</span>(;;)&#123;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\tsize = read(s,buffer,<span class=\"number\">1024</span>);</span><br><span class=\"line\">\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">\"read %d\\n\"</span>,size);\t\t</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span>(size ==<span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t<span class=\"built_in\">sprintf</span>(buffer,<span class=\"string\">\"%d bytes altother\\n\"</span>,size);</span><br><span class=\"line\">\twrite(s,buffer,<span class=\"built_in\">strlen</span>(buffer)+<span class=\"number\">1</span>);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">(<span class=\"keyword\">int</span> argc, <span class=\"keyword\">char</span> *argv[])</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">int</span> ss,sc;</span><br><span class=\"line\">\t<span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">sockaddr_in</span> <span class=\"title\">server_addr</span>;</span></span><br><span class=\"line\">\t<span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">sockaddr_in</span> <span class=\"title\">client_addr</span>;</span></span><br><span class=\"line\">\t<span class=\"keyword\">int</span> err;</span><br><span class=\"line\">\t<span class=\"keyword\">pid_t</span> pid;</span><br><span class=\"line\"></span><br><span class=\"line\">\tss = socket(AF_INET,SOCK_STREAM,<span class=\"number\">0</span>);</span><br><span class=\"line\">\t<span class=\"keyword\">if</span>(ss &lt; <span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">\"socket error.\\n\"</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tbzero(&amp;server_addr,<span class=\"keyword\">sizeof</span>(server_addr));</span><br><span class=\"line\">\tserver_addr.sin_family = AF_INET;</span><br><span class=\"line\">\tserver_addr.sin_addr.s_addr = htonl(INADDR_ANY);</span><br><span class=\"line\">\tserver_addr.sin_port = htons(PORT);</span><br><span class=\"line\"></span><br><span class=\"line\">\terr = bind(ss,(struct sockaddr*)&amp;server_addr,<span class=\"keyword\">sizeof</span>(server_addr));</span><br><span class=\"line\">\t<span class=\"keyword\">if</span>(err &lt; <span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">\"bind err.\\n\"</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\terr = listen(ss,BACKLOG);</span><br><span class=\"line\">\t<span class=\"keyword\">if</span>(err &lt; <span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">\"listen err.\\n\"</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">for</span>(;;)&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">socklen_t</span> addrlen = <span class=\"keyword\">sizeof</span>(struct sockaddr);</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\tsc = accept(ss,(struct sockaddr*)&amp;client_addr,&amp;addrlen);</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span>(sc &lt; <span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">continue</span>;</span><br><span class=\"line\">\t\t&#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">\"some one conn~\\n\"</span>);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\tpid = fork();</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span>(pid &lt; <span class=\"number\">0</span> )&#123;</span><br><span class=\"line\">\t\t\tclose(ss);</span><br><span class=\"line\">\t\t&#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">\t\t\tprocess_conn_server(sc);</span><br><span class=\"line\">\t\t\tclose(sc);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>客户端代码：</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;stdio.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;stdlib.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;strings.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;sys/types.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;sys/socket.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;unistd.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;arpa/inet.h&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> PORT 5555 </span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">process_conn_client</span><span class=\"params\">(<span class=\"keyword\">int</span> s)</span></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">ssize_t</span> size = <span class=\"number\">0</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">char</span> buffer[<span class=\"number\">1024</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">for</span>(;;)&#123;</span><br><span class=\"line\">\t\tsize = read(<span class=\"number\">0</span>,buffer,<span class=\"number\">1024</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span>(size &gt; <span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">\t\t\twrite(s,buffer,size);</span><br><span class=\"line\">\t\t\tsize = read(s,buffer,<span class=\"number\">1024</span>);</span><br><span class=\"line\">\t\t\twrite(<span class=\"number\">1</span>,buffer,size);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">(<span class=\"keyword\">int</span> argc,<span class=\"keyword\">char</span> *argv[])</span></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">int</span> s;</span><br><span class=\"line\">\t<span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">sockaddr_in</span> <span class=\"title\">server_addr</span>;</span></span><br><span class=\"line\">\ts = socket(AF_INET,SOCK_STREAM,<span class=\"number\">0</span>);</span><br><span class=\"line\">\t<span class=\"keyword\">if</span>(s &lt; <span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">\"socket error\\n\"</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tbzero(&amp;server_addr,<span class=\"keyword\">sizeof</span>(server_addr));</span><br><span class=\"line\">\tserver_addr.sin_family = AF_INET;</span><br><span class=\"line\">\tserver_addr.sin_addr.s_addr = htonl(INADDR_ANY);</span><br><span class=\"line\">\tserver_addr.sin_port = htons(PORT);</span><br><span class=\"line\">\tinet_pton(AF_INET,argv[<span class=\"number\">1</span>],&amp;server_addr.sin_addr);</span><br><span class=\"line\">\tconnect(s,(struct sockaddr*)&amp;server_addr,<span class=\"keyword\">sizeof</span>(struct sockaddr));</span><br><span class=\"line\">\tprocess_conn_client(s);</span><br><span class=\"line\">\tclose(s);</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>​</p>\n</li>\n</ul>\n<p>运行实例：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">model@PWN-VirtualBox:~/NetworkProgram$ ./server </span><br><span class=\"line\">some one conn~</span><br><span class=\"line\"><span class=\"built_in\">read</span> 5</span><br><span class=\"line\">------------------------------------------------------------------</span><br><span class=\"line\">model@PWN-VirtualBox:~/NetworkProgram$ ./client 127.0.0.1</span><br><span class=\"line\">abcd</span><br><span class=\"line\">5 bytes altother</span><br></pre></td></tr></table></figure>\n<p>这是一个简单的tcp通信的程序示例，在这个程序中，一次只能服务两个客户端，不太具备实用价值。但是这个示例完整的包括了tcp socket通信的各个步骤，可以在此基础上继续丰富，完成更复杂的业务逻辑。在之后的博文中我将继续来解释socket编程的各个知识点。</p>"},{"title":"Ubuntu-17.10-使用Systemd-Networkd接管网络配置","date":"2017-11-22T07:03:28.000Z","_content":"\n最近在使用Ubuntu17.10的时候，被设置ip折磨的挺惨。我使用的台式机是戴尔的optiplex 9020，装的是win10和Ubuntu17.10双系统。最开始是从win10重启到Ubuntu后，Ubuntu无法上网。经过一番搜索设置也无果，在一次偶然将win10关机，进到bios设置了一下网卡后，开机到Ubuntu竟然能够正常上网了。\n<!--more-->\n最终解决该问题的办法是：将win10关机，再开机启动到Ubuntu。\n第二个问题是因为公司使用的是静态ip上网的方式，按照往常的经验，编辑/etc/network/interface配置文件，设置静态ip即可。但是ip设置的问题是解决了，但是DNS是被systemd-resolved接管的，每次手动更改了/etc/resolv.conf后重启，该文件总是被覆盖。索性将系统的网络全部由systemd-networkd接管好了。\n### 步骤\n1.在/etc/systemd/network目录新建一个网卡配置文件，我的叫static-eno1.network，注意，一定得是.network结尾的文件名。内容如下：\n```shell\n[Match]\n    Name=eno1\n[Network]\n    Address=10.1.1.10/19\n    Gateway=10.1.1.254\n    DNS=223.5.5.5\n    DNS=223.6.6.6\n```\n这里由两个地方需要注意，Match段，需要指定配置的网卡Name，Name需要注意首字母大写。Address是网卡的ip地址，由ip和掩码长度组成。需要设置多个DNS的话，请写多行。\n2.设置systemd-networkd开机启动\n```shell\n$sudo systemctl enable systemd-networkd\n```\n稳妥起见的话，还可以将/etc/resolv.conf删除，然后建立/run/systemd/resolv/resolv.conf的软连接\n```shell\n$sudo ln -s /run/systemd/resolv/resolv.conf /etc/resolv.conf\n```\n然后重启机器即可。\n","source":"_posts/Ubuntu-17-10-Systemd-Networkd.md","raw":"---\ntitle: Ubuntu-17.10-使用Systemd-Networkd接管网络配置\ncategories:\n  - Linux\ntags:\n  - linux\ndate: 2017-11-22 15:03:28\n---\n\n最近在使用Ubuntu17.10的时候，被设置ip折磨的挺惨。我使用的台式机是戴尔的optiplex 9020，装的是win10和Ubuntu17.10双系统。最开始是从win10重启到Ubuntu后，Ubuntu无法上网。经过一番搜索设置也无果，在一次偶然将win10关机，进到bios设置了一下网卡后，开机到Ubuntu竟然能够正常上网了。\n<!--more-->\n最终解决该问题的办法是：将win10关机，再开机启动到Ubuntu。\n第二个问题是因为公司使用的是静态ip上网的方式，按照往常的经验，编辑/etc/network/interface配置文件，设置静态ip即可。但是ip设置的问题是解决了，但是DNS是被systemd-resolved接管的，每次手动更改了/etc/resolv.conf后重启，该文件总是被覆盖。索性将系统的网络全部由systemd-networkd接管好了。\n### 步骤\n1.在/etc/systemd/network目录新建一个网卡配置文件，我的叫static-eno1.network，注意，一定得是.network结尾的文件名。内容如下：\n```shell\n[Match]\n    Name=eno1\n[Network]\n    Address=10.1.1.10/19\n    Gateway=10.1.1.254\n    DNS=223.5.5.5\n    DNS=223.6.6.6\n```\n这里由两个地方需要注意，Match段，需要指定配置的网卡Name，Name需要注意首字母大写。Address是网卡的ip地址，由ip和掩码长度组成。需要设置多个DNS的话，请写多行。\n2.设置systemd-networkd开机启动\n```shell\n$sudo systemctl enable systemd-networkd\n```\n稳妥起见的话，还可以将/etc/resolv.conf删除，然后建立/run/systemd/resolv/resolv.conf的软连接\n```shell\n$sudo ln -s /run/systemd/resolv/resolv.conf /etc/resolv.conf\n```\n然后重启机器即可。\n","slug":"Ubuntu-17-10-Systemd-Networkd","published":1,"updated":"2017-12-14T04:00:46.497Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjeqig1oi003wlgqa1dmz5iw9","content":"<p>最近在使用Ubuntu17.10的时候，被设置ip折磨的挺惨。我使用的台式机是戴尔的optiplex 9020，装的是win10和Ubuntu17.10双系统。最开始是从win10重启到Ubuntu后，Ubuntu无法上网。经过一番搜索设置也无果，在一次偶然将win10关机，进到bios设置了一下网卡后，开机到Ubuntu竟然能够正常上网了。<br><a id=\"more\"></a><br>最终解决该问题的办法是：将win10关机，再开机启动到Ubuntu。<br>第二个问题是因为公司使用的是静态ip上网的方式，按照往常的经验，编辑/etc/network/interface配置文件，设置静态ip即可。但是ip设置的问题是解决了，但是DNS是被systemd-resolved接管的，每次手动更改了/etc/resolv.conf后重启，该文件总是被覆盖。索性将系统的网络全部由systemd-networkd接管好了。</p>\n<h3 id=\"步骤\"><a href=\"#步骤\" class=\"headerlink\" title=\"步骤\"></a>步骤</h3><p>1.在/etc/systemd/network目录新建一个网卡配置文件，我的叫static-eno1.network，注意，一定得是.network结尾的文件名。内容如下：<br><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[Match]</span><br><span class=\"line\">    Name=eno1</span><br><span class=\"line\">[Network]</span><br><span class=\"line\">    Address=10.1.1.10/19</span><br><span class=\"line\">    Gateway=10.1.1.254</span><br><span class=\"line\">    DNS=223.5.5.5</span><br><span class=\"line\">    DNS=223.6.6.6</span><br></pre></td></tr></table></figure></p>\n<p>这里由两个地方需要注意，Match段，需要指定配置的网卡Name，Name需要注意首字母大写。Address是网卡的ip地址，由ip和掩码长度组成。需要设置多个DNS的话，请写多行。<br>2.设置systemd-networkd开机启动<br><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\">sudo systemctl <span class=\"built_in\">enable</span> systemd-networkd</span></span><br></pre></td></tr></table></figure></p>\n<p>稳妥起见的话，还可以将/etc/resolv.conf删除，然后建立/run/systemd/resolv/resolv.conf的软连接<br><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\">sudo ln -s /run/systemd/resolv/resolv.conf /etc/resolv.conf</span></span><br></pre></td></tr></table></figure></p>\n<p>然后重启机器即可。</p>\n","site":{"data":{}},"excerpt":"<p>最近在使用Ubuntu17.10的时候，被设置ip折磨的挺惨。我使用的台式机是戴尔的optiplex 9020，装的是win10和Ubuntu17.10双系统。最开始是从win10重启到Ubuntu后，Ubuntu无法上网。经过一番搜索设置也无果，在一次偶然将win10关机，进到bios设置了一下网卡后，开机到Ubuntu竟然能够正常上网了。<br>","more":"<br>最终解决该问题的办法是：将win10关机，再开机启动到Ubuntu。<br>第二个问题是因为公司使用的是静态ip上网的方式，按照往常的经验，编辑/etc/network/interface配置文件，设置静态ip即可。但是ip设置的问题是解决了，但是DNS是被systemd-resolved接管的，每次手动更改了/etc/resolv.conf后重启，该文件总是被覆盖。索性将系统的网络全部由systemd-networkd接管好了。</p>\n<h3 id=\"步骤\"><a href=\"#步骤\" class=\"headerlink\" title=\"步骤\"></a>步骤</h3><p>1.在/etc/systemd/network目录新建一个网卡配置文件，我的叫static-eno1.network，注意，一定得是.network结尾的文件名。内容如下：<br><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[Match]</span><br><span class=\"line\">    Name=eno1</span><br><span class=\"line\">[Network]</span><br><span class=\"line\">    Address=10.1.1.10/19</span><br><span class=\"line\">    Gateway=10.1.1.254</span><br><span class=\"line\">    DNS=223.5.5.5</span><br><span class=\"line\">    DNS=223.6.6.6</span><br></pre></td></tr></table></figure></p>\n<p>这里由两个地方需要注意，Match段，需要指定配置的网卡Name，Name需要注意首字母大写。Address是网卡的ip地址，由ip和掩码长度组成。需要设置多个DNS的话，请写多行。<br>2.设置systemd-networkd开机启动<br><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\">sudo systemctl <span class=\"built_in\">enable</span> systemd-networkd</span></span><br></pre></td></tr></table></figure></p>\n<p>稳妥起见的话，还可以将/etc/resolv.conf删除，然后建立/run/systemd/resolv/resolv.conf的软连接<br><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\">sudo ln -s /run/systemd/resolv/resolv.conf /etc/resolv.conf</span></span><br></pre></td></tr></table></figure></p>\n<p>然后重启机器即可。</p>"},{"title":"Windows  tasklist筛选器的使用","date":"2017-10-18T06:02:58.000Z","_content":"\n### Windows  tasklist筛选器的使用\n\n在windows中，除了有图形化的任务管理器，还有个命令行版的tasklist.exe。命令行的功能也是非常丰富的，今天碰巧遇到了需要使用筛选器的需求，记录一下，以防忘记。\n\n先看一下tasklist的帮助信息：\n\n<!--more-->\n\n```shell\nC:\\Users\\STAR_CHEN>tasklist /?\n\nTASKLIST [/S system [/U username [/P [password]]]]\n         [/M [module] | /SVC | /V] [/FI filter] [/FO format] [/NH]\n\n描述:\n    该工具显示在本地或远程机器上当前运行的进程列表。\n\n\n参数列表:\n   /S     system           指定连接到的远程系统。\n\n   /U     [domain\\]user    指定应该在哪个用户上下文执行这个命令。\n\n   /P     [password]       为提供的用户上下文指定密码。如果省略，则\n                           提示输入。\n\n   /M     [module]         列出当前使用所给 exe/dll 名称的所有任务。\n                           如果没有指定模块名称，显示所有加载的模块。\n\n   /SVC                    显示每个进程中主持的服务。\n\n   /APPS 显示应用商店应用及其关联的进程。\n\n   /V                      显示详细任务信息。\n\n   /FI    filter           显示一系列符合筛选器\n                           指定条件的任务。\n\n   /FO    format           指定输出格式。\n                           有效值: \"TABLE\"、\"LIST\"、\"CSV\"。\n\n   /NH                     指定列标题不应该\n                           在输出中显示。\n                           只对 \"TABLE\" 和 \"CSV\" 格式有效。\n\n   /?                      显示此帮助消息。\n\n筛选器:\n    筛选器名称     有效运算符           有效值\n    -----------     ---------------           --------------------------\n    STATUS          eq, ne                    RUNNING | SUSPENDED\n                                              NOT RESPONDING | UNKNOWN\n    IMAGENAME       eq, ne                    映像名称\n    PID             eq, ne, gt, lt, ge, le    PID 值\n    SESSION         eq, ne, gt, lt, ge, le    会话编号\n    SESSIONNAME     eq, ne                    会话名称\n    CPUTIME         eq, ne, gt, lt, ge, le    CPU 时间，格式为\n                                              hh:mm:ss。\n                                              hh - 小时，\n                                              mm - 分钟，ss - 秒\n    MEMUSAGE        eq, ne, gt, lt, ge, le    内存使用(以 KB 为单位)\n    USERNAME        eq, ne                    用户名，格式为\n                                              [域\\]用户\n    SERVICES        eq, ne                    服务名称\n    WINDOWTITLE     eq, ne                    窗口标题\n    模块         eq, ne                    DLL 名称\n\n注意: 当查询远程计算机时，不支持 \"WINDOWTITLE\" 和 \"STATUS\"\n      筛选器。\n\nExamples:\n    TASKLIST\n    TASKLIST /M\n    TASKLIST /V /FO CSV\n    TASKLIST /SVC /FO LIST\n    TASKLIST /APPS /FI \"STATUS eq RUNNING\"\n    TASKLIST /M wbem*\n    TASKLIST /S system /FO LIST\n    TASKLIST /S system /U 域\\用户名 /FO CSV /NH\n    TASKLIST /S system /U username /P password /FO TABLE /NH\n    TASKLIST /FI \"USERNAME ne NT AUTHORITY\\SYSTEM\" /FI \"STATUS eq running\"\n```\n\n给出一个使用筛选器的例子，*/FI 之后接的筛选器为字符串*：\n\n```shell\nC:\\Users\\STAR_CHEN>tasklist /FI \"PID eq 10100\"\n\n映像名称                       PID 会话名              会话#       内存使用\n========================= ======== ================ =========== ============\npython.exe                   10100 Console                    1     11,136 K\n```\n\n","source":"_posts/WindowsTasklistFilter.md","raw":"---\ntitle: Windows  tasklist筛选器的使用\ncategories:\n  - Windows\ntags:\n  - cmd\ndate: 2017-10-18 14:02:58\n---\n\n### Windows  tasklist筛选器的使用\n\n在windows中，除了有图形化的任务管理器，还有个命令行版的tasklist.exe。命令行的功能也是非常丰富的，今天碰巧遇到了需要使用筛选器的需求，记录一下，以防忘记。\n\n先看一下tasklist的帮助信息：\n\n<!--more-->\n\n```shell\nC:\\Users\\STAR_CHEN>tasklist /?\n\nTASKLIST [/S system [/U username [/P [password]]]]\n         [/M [module] | /SVC | /V] [/FI filter] [/FO format] [/NH]\n\n描述:\n    该工具显示在本地或远程机器上当前运行的进程列表。\n\n\n参数列表:\n   /S     system           指定连接到的远程系统。\n\n   /U     [domain\\]user    指定应该在哪个用户上下文执行这个命令。\n\n   /P     [password]       为提供的用户上下文指定密码。如果省略，则\n                           提示输入。\n\n   /M     [module]         列出当前使用所给 exe/dll 名称的所有任务。\n                           如果没有指定模块名称，显示所有加载的模块。\n\n   /SVC                    显示每个进程中主持的服务。\n\n   /APPS 显示应用商店应用及其关联的进程。\n\n   /V                      显示详细任务信息。\n\n   /FI    filter           显示一系列符合筛选器\n                           指定条件的任务。\n\n   /FO    format           指定输出格式。\n                           有效值: \"TABLE\"、\"LIST\"、\"CSV\"。\n\n   /NH                     指定列标题不应该\n                           在输出中显示。\n                           只对 \"TABLE\" 和 \"CSV\" 格式有效。\n\n   /?                      显示此帮助消息。\n\n筛选器:\n    筛选器名称     有效运算符           有效值\n    -----------     ---------------           --------------------------\n    STATUS          eq, ne                    RUNNING | SUSPENDED\n                                              NOT RESPONDING | UNKNOWN\n    IMAGENAME       eq, ne                    映像名称\n    PID             eq, ne, gt, lt, ge, le    PID 值\n    SESSION         eq, ne, gt, lt, ge, le    会话编号\n    SESSIONNAME     eq, ne                    会话名称\n    CPUTIME         eq, ne, gt, lt, ge, le    CPU 时间，格式为\n                                              hh:mm:ss。\n                                              hh - 小时，\n                                              mm - 分钟，ss - 秒\n    MEMUSAGE        eq, ne, gt, lt, ge, le    内存使用(以 KB 为单位)\n    USERNAME        eq, ne                    用户名，格式为\n                                              [域\\]用户\n    SERVICES        eq, ne                    服务名称\n    WINDOWTITLE     eq, ne                    窗口标题\n    模块         eq, ne                    DLL 名称\n\n注意: 当查询远程计算机时，不支持 \"WINDOWTITLE\" 和 \"STATUS\"\n      筛选器。\n\nExamples:\n    TASKLIST\n    TASKLIST /M\n    TASKLIST /V /FO CSV\n    TASKLIST /SVC /FO LIST\n    TASKLIST /APPS /FI \"STATUS eq RUNNING\"\n    TASKLIST /M wbem*\n    TASKLIST /S system /FO LIST\n    TASKLIST /S system /U 域\\用户名 /FO CSV /NH\n    TASKLIST /S system /U username /P password /FO TABLE /NH\n    TASKLIST /FI \"USERNAME ne NT AUTHORITY\\SYSTEM\" /FI \"STATUS eq running\"\n```\n\n给出一个使用筛选器的例子，*/FI 之后接的筛选器为字符串*：\n\n```shell\nC:\\Users\\STAR_CHEN>tasklist /FI \"PID eq 10100\"\n\n映像名称                       PID 会话名              会话#       内存使用\n========================= ======== ================ =========== ============\npython.exe                   10100 Console                    1     11,136 K\n```\n\n","slug":"WindowsTasklistFilter","published":1,"updated":"2017-12-04T07:27:28.763Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjeqig1ol003zlgqau9n6y0va","content":"<h3 id=\"Windows-tasklist筛选器的使用\"><a href=\"#Windows-tasklist筛选器的使用\" class=\"headerlink\" title=\"Windows  tasklist筛选器的使用\"></a>Windows  tasklist筛选器的使用</h3><p>在windows中，除了有图形化的任务管理器，还有个命令行版的tasklist.exe。命令行的功能也是非常丰富的，今天碰巧遇到了需要使用筛选器的需求，记录一下，以防忘记。</p>\n<p>先看一下tasklist的帮助信息：</p>\n<a id=\"more\"></a>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">C:\\Users\\STAR_CHEN&gt;tasklist /?</span><br><span class=\"line\"></span><br><span class=\"line\">TASKLIST [/S system [/U username [/P [password]]]]</span><br><span class=\"line\">         [/M [module] | /SVC | /V] [/FI filter] [/FO format] [/NH]</span><br><span class=\"line\"></span><br><span class=\"line\">描述:</span><br><span class=\"line\">    该工具显示在本地或远程机器上当前运行的进程列表。</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">参数列表:</span><br><span class=\"line\">   /S     system           指定连接到的远程系统。</span><br><span class=\"line\"></span><br><span class=\"line\">   /U     [domain\\]user    指定应该在哪个用户上下文执行这个命令。</span><br><span class=\"line\"></span><br><span class=\"line\">   /P     [password]       为提供的用户上下文指定密码。如果省略，则</span><br><span class=\"line\">                           提示输入。</span><br><span class=\"line\"></span><br><span class=\"line\">   /M     [module]         列出当前使用所给 exe/dll 名称的所有任务。</span><br><span class=\"line\">                           如果没有指定模块名称，显示所有加载的模块。</span><br><span class=\"line\"></span><br><span class=\"line\">   /SVC                    显示每个进程中主持的服务。</span><br><span class=\"line\"></span><br><span class=\"line\">   /APPS 显示应用商店应用及其关联的进程。</span><br><span class=\"line\"></span><br><span class=\"line\">   /V                      显示详细任务信息。</span><br><span class=\"line\"></span><br><span class=\"line\">   /FI    filter           显示一系列符合筛选器</span><br><span class=\"line\">                           指定条件的任务。</span><br><span class=\"line\"></span><br><span class=\"line\">   /FO    format           指定输出格式。</span><br><span class=\"line\">                           有效值: \"TABLE\"、\"LIST\"、\"CSV\"。</span><br><span class=\"line\"></span><br><span class=\"line\">   /NH                     指定列标题不应该</span><br><span class=\"line\">                           在输出中显示。</span><br><span class=\"line\">                           只对 \"TABLE\" 和 \"CSV\" 格式有效。</span><br><span class=\"line\"></span><br><span class=\"line\">   /?                      显示此帮助消息。</span><br><span class=\"line\"></span><br><span class=\"line\">筛选器:</span><br><span class=\"line\">    筛选器名称     有效运算符           有效值</span><br><span class=\"line\">    -----------     ---------------           --------------------------</span><br><span class=\"line\">    STATUS          eq, ne                    RUNNING | SUSPENDED</span><br><span class=\"line\">                                              NOT RESPONDING | UNKNOWN</span><br><span class=\"line\">    IMAGENAME       eq, ne                    映像名称</span><br><span class=\"line\">    PID             eq, ne, gt, lt, ge, le    PID 值</span><br><span class=\"line\">    SESSION         eq, ne, gt, lt, ge, le    会话编号</span><br><span class=\"line\">    SESSIONNAME     eq, ne                    会话名称</span><br><span class=\"line\">    CPUTIME         eq, ne, gt, lt, ge, le    CPU 时间，格式为</span><br><span class=\"line\">                                              hh:mm:ss。</span><br><span class=\"line\">                                              hh - 小时，</span><br><span class=\"line\">                                              mm - 分钟，ss - 秒</span><br><span class=\"line\">    MEMUSAGE        eq, ne, gt, lt, ge, le    内存使用(以 KB 为单位)</span><br><span class=\"line\">    USERNAME        eq, ne                    用户名，格式为</span><br><span class=\"line\">                                              [域\\]用户</span><br><span class=\"line\">    SERVICES        eq, ne                    服务名称</span><br><span class=\"line\">    WINDOWTITLE     eq, ne                    窗口标题</span><br><span class=\"line\">    模块         eq, ne                    DLL 名称</span><br><span class=\"line\"></span><br><span class=\"line\">注意: 当查询远程计算机时，不支持 \"WINDOWTITLE\" 和 \"STATUS\"</span><br><span class=\"line\">      筛选器。</span><br><span class=\"line\"></span><br><span class=\"line\">Examples:</span><br><span class=\"line\">    TASKLIST</span><br><span class=\"line\">    TASKLIST /M</span><br><span class=\"line\">    TASKLIST /V /FO CSV</span><br><span class=\"line\">    TASKLIST /SVC /FO LIST</span><br><span class=\"line\">    TASKLIST /APPS /FI \"STATUS eq RUNNING\"</span><br><span class=\"line\">    TASKLIST /M wbem*</span><br><span class=\"line\">    TASKLIST /S system /FO LIST</span><br><span class=\"line\">    TASKLIST /S system /U 域\\用户名 /FO CSV /NH</span><br><span class=\"line\">    TASKLIST /S system /U username /P password /FO TABLE /NH</span><br><span class=\"line\">    TASKLIST /FI \"USERNAME ne NT AUTHORITY\\SYSTEM\" /FI \"STATUS eq running\"</span><br></pre></td></tr></table></figure>\n<p>给出一个使用筛选器的例子，<em>/FI 之后接的筛选器为字符串</em>：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">C:\\Users\\STAR_CHEN&gt;tasklist /FI \"PID eq 10100\"</span><br><span class=\"line\"></span><br><span class=\"line\">映像名称                       PID 会话名              会话#       内存使用</span><br><span class=\"line\">========================= ======== ================ =========== ============</span><br><span class=\"line\">python.exe                   10100 Console                    1     11,136 K</span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"<h3 id=\"Windows-tasklist筛选器的使用\"><a href=\"#Windows-tasklist筛选器的使用\" class=\"headerlink\" title=\"Windows  tasklist筛选器的使用\"></a>Windows  tasklist筛选器的使用</h3><p>在windows中，除了有图形化的任务管理器，还有个命令行版的tasklist.exe。命令行的功能也是非常丰富的，今天碰巧遇到了需要使用筛选器的需求，记录一下，以防忘记。</p>\n<p>先看一下tasklist的帮助信息：</p>","more":"<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">C:\\Users\\STAR_CHEN&gt;tasklist /?</span><br><span class=\"line\"></span><br><span class=\"line\">TASKLIST [/S system [/U username [/P [password]]]]</span><br><span class=\"line\">         [/M [module] | /SVC | /V] [/FI filter] [/FO format] [/NH]</span><br><span class=\"line\"></span><br><span class=\"line\">描述:</span><br><span class=\"line\">    该工具显示在本地或远程机器上当前运行的进程列表。</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">参数列表:</span><br><span class=\"line\">   /S     system           指定连接到的远程系统。</span><br><span class=\"line\"></span><br><span class=\"line\">   /U     [domain\\]user    指定应该在哪个用户上下文执行这个命令。</span><br><span class=\"line\"></span><br><span class=\"line\">   /P     [password]       为提供的用户上下文指定密码。如果省略，则</span><br><span class=\"line\">                           提示输入。</span><br><span class=\"line\"></span><br><span class=\"line\">   /M     [module]         列出当前使用所给 exe/dll 名称的所有任务。</span><br><span class=\"line\">                           如果没有指定模块名称，显示所有加载的模块。</span><br><span class=\"line\"></span><br><span class=\"line\">   /SVC                    显示每个进程中主持的服务。</span><br><span class=\"line\"></span><br><span class=\"line\">   /APPS 显示应用商店应用及其关联的进程。</span><br><span class=\"line\"></span><br><span class=\"line\">   /V                      显示详细任务信息。</span><br><span class=\"line\"></span><br><span class=\"line\">   /FI    filter           显示一系列符合筛选器</span><br><span class=\"line\">                           指定条件的任务。</span><br><span class=\"line\"></span><br><span class=\"line\">   /FO    format           指定输出格式。</span><br><span class=\"line\">                           有效值: \"TABLE\"、\"LIST\"、\"CSV\"。</span><br><span class=\"line\"></span><br><span class=\"line\">   /NH                     指定列标题不应该</span><br><span class=\"line\">                           在输出中显示。</span><br><span class=\"line\">                           只对 \"TABLE\" 和 \"CSV\" 格式有效。</span><br><span class=\"line\"></span><br><span class=\"line\">   /?                      显示此帮助消息。</span><br><span class=\"line\"></span><br><span class=\"line\">筛选器:</span><br><span class=\"line\">    筛选器名称     有效运算符           有效值</span><br><span class=\"line\">    -----------     ---------------           --------------------------</span><br><span class=\"line\">    STATUS          eq, ne                    RUNNING | SUSPENDED</span><br><span class=\"line\">                                              NOT RESPONDING | UNKNOWN</span><br><span class=\"line\">    IMAGENAME       eq, ne                    映像名称</span><br><span class=\"line\">    PID             eq, ne, gt, lt, ge, le    PID 值</span><br><span class=\"line\">    SESSION         eq, ne, gt, lt, ge, le    会话编号</span><br><span class=\"line\">    SESSIONNAME     eq, ne                    会话名称</span><br><span class=\"line\">    CPUTIME         eq, ne, gt, lt, ge, le    CPU 时间，格式为</span><br><span class=\"line\">                                              hh:mm:ss。</span><br><span class=\"line\">                                              hh - 小时，</span><br><span class=\"line\">                                              mm - 分钟，ss - 秒</span><br><span class=\"line\">    MEMUSAGE        eq, ne, gt, lt, ge, le    内存使用(以 KB 为单位)</span><br><span class=\"line\">    USERNAME        eq, ne                    用户名，格式为</span><br><span class=\"line\">                                              [域\\]用户</span><br><span class=\"line\">    SERVICES        eq, ne                    服务名称</span><br><span class=\"line\">    WINDOWTITLE     eq, ne                    窗口标题</span><br><span class=\"line\">    模块         eq, ne                    DLL 名称</span><br><span class=\"line\"></span><br><span class=\"line\">注意: 当查询远程计算机时，不支持 \"WINDOWTITLE\" 和 \"STATUS\"</span><br><span class=\"line\">      筛选器。</span><br><span class=\"line\"></span><br><span class=\"line\">Examples:</span><br><span class=\"line\">    TASKLIST</span><br><span class=\"line\">    TASKLIST /M</span><br><span class=\"line\">    TASKLIST /V /FO CSV</span><br><span class=\"line\">    TASKLIST /SVC /FO LIST</span><br><span class=\"line\">    TASKLIST /APPS /FI \"STATUS eq RUNNING\"</span><br><span class=\"line\">    TASKLIST /M wbem*</span><br><span class=\"line\">    TASKLIST /S system /FO LIST</span><br><span class=\"line\">    TASKLIST /S system /U 域\\用户名 /FO CSV /NH</span><br><span class=\"line\">    TASKLIST /S system /U username /P password /FO TABLE /NH</span><br><span class=\"line\">    TASKLIST /FI \"USERNAME ne NT AUTHORITY\\SYSTEM\" /FI \"STATUS eq running\"</span><br></pre></td></tr></table></figure>\n<p>给出一个使用筛选器的例子，<em>/FI 之后接的筛选器为字符串</em>：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">C:\\Users\\STAR_CHEN&gt;tasklist /FI \"PID eq 10100\"</span><br><span class=\"line\"></span><br><span class=\"line\">映像名称                       PID 会话名              会话#       内存使用</span><br><span class=\"line\">========================= ======== ================ =========== ============</span><br><span class=\"line\">python.exe                   10100 Console                    1     11,136 K</span><br></pre></td></tr></table></figure>"},{"title":"Cookie各属性的作用","date":"2018-03-08T12:33:31.000Z","_content":"\n#### Cookie是什么\n\n由于HTTP协议是一种无状态协议，服务端是无法根据网络连接来区别不同用户身份的。Cookie在这种情况下充当了一个通行证的作用，服务器就可以根据Cookie来确认用户身份了。\n\nCookie实际上是一小段文本信息，通常情况下是通过HTTP HEADER进行发送和接收。\n\n<!--more-->\n\n![image](/blogimg/setcookie.png)\n\n![image](/blogimg/sendcookie.png)\n\n#### Cookie的几个常用属性\n\ncookie的值是已键值对表示的，除开Cookie带的值，还有一些用于表示过期时间和用于安全目的的属性。\n\n* name   Cookie值的键\n\n\n* value   Cookie值的内容\n\n\n* domain     表示可以访问该Cookie的域名\n\n\n* path     可以访问该Cookie的页面路径。常见的值有/\n\n\n* expires      Cookie的超时时间，到达时间则失效。\n\n\n* size    Cookie的大小，这个不常见\n\n\n* http-only        表明该Cookie只能在http头中传输，js不能访问到\n\n\n* secure     表明Cookie只能在使用https协议的传输，使用http协议时不会传输。这里遇到一个坑点，当把secure属性去掉之后，需要重启浏览器才能生效。\n\n#### Cookie的几个作用\n\nsession管理：      常见的是session_id这个Cookie，在http访问的过程用于用户身份的标识。\n\n个性化 ：       这个可见于购物车\n\nuser tracking：    追踪用户行为，貌似很多广告就是因为这个。\n\n#### 针对Cookie的攻击手段 \n\nCookie窃取，例如通过站点的xss漏洞可能窃取到用户浏览器的Cookie。\n\nCookie欺骗，因为Cookie是用户可控的，如果某些敏感字段写在Cookie里边，很容易被恶意篡改。","source":"_posts/cookie-property.md","raw":"---\ntitle: Cookie各属性的作用\ncategories:\n  - Program\ntags:\n  - web cookie\ndate: 2018-03-08 20:33:31\n---\n\n#### Cookie是什么\n\n由于HTTP协议是一种无状态协议，服务端是无法根据网络连接来区别不同用户身份的。Cookie在这种情况下充当了一个通行证的作用，服务器就可以根据Cookie来确认用户身份了。\n\nCookie实际上是一小段文本信息，通常情况下是通过HTTP HEADER进行发送和接收。\n\n<!--more-->\n\n![image](/blogimg/setcookie.png)\n\n![image](/blogimg/sendcookie.png)\n\n#### Cookie的几个常用属性\n\ncookie的值是已键值对表示的，除开Cookie带的值，还有一些用于表示过期时间和用于安全目的的属性。\n\n* name   Cookie值的键\n\n\n* value   Cookie值的内容\n\n\n* domain     表示可以访问该Cookie的域名\n\n\n* path     可以访问该Cookie的页面路径。常见的值有/\n\n\n* expires      Cookie的超时时间，到达时间则失效。\n\n\n* size    Cookie的大小，这个不常见\n\n\n* http-only        表明该Cookie只能在http头中传输，js不能访问到\n\n\n* secure     表明Cookie只能在使用https协议的传输，使用http协议时不会传输。这里遇到一个坑点，当把secure属性去掉之后，需要重启浏览器才能生效。\n\n#### Cookie的几个作用\n\nsession管理：      常见的是session_id这个Cookie，在http访问的过程用于用户身份的标识。\n\n个性化 ：       这个可见于购物车\n\nuser tracking：    追踪用户行为，貌似很多广告就是因为这个。\n\n#### 针对Cookie的攻击手段 \n\nCookie窃取，例如通过站点的xss漏洞可能窃取到用户浏览器的Cookie。\n\nCookie欺骗，因为Cookie是用户可控的，如果某些敏感字段写在Cookie里边，很容易被恶意篡改。","slug":"cookie-property","published":1,"updated":"2018-03-09T03:26:41.463Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjeqig1or0041lgqamf0xk40f","content":"<h4 id=\"Cookie是什么\"><a href=\"#Cookie是什么\" class=\"headerlink\" title=\"Cookie是什么\"></a>Cookie是什么</h4><p>由于HTTP协议是一种无状态协议，服务端是无法根据网络连接来区别不同用户身份的。Cookie在这种情况下充当了一个通行证的作用，服务器就可以根据Cookie来确认用户身份了。</p>\n<p>Cookie实际上是一小段文本信息，通常情况下是通过HTTP HEADER进行发送和接收。</p>\n<a id=\"more\"></a>\n<p><img src=\"/blogimg/setcookie.png\" alt=\"image\"></p>\n<p><img src=\"/blogimg/sendcookie.png\" alt=\"image\"></p>\n<h4 id=\"Cookie的几个常用属性\"><a href=\"#Cookie的几个常用属性\" class=\"headerlink\" title=\"Cookie的几个常用属性\"></a>Cookie的几个常用属性</h4><p>cookie的值是已键值对表示的，除开Cookie带的值，还有一些用于表示过期时间和用于安全目的的属性。</p>\n<ul>\n<li>name   Cookie值的键</li>\n</ul>\n<ul>\n<li>value   Cookie值的内容</li>\n</ul>\n<ul>\n<li>domain     表示可以访问该Cookie的域名</li>\n</ul>\n<ul>\n<li>path     可以访问该Cookie的页面路径。常见的值有/</li>\n</ul>\n<ul>\n<li>expires      Cookie的超时时间，到达时间则失效。</li>\n</ul>\n<ul>\n<li>size    Cookie的大小，这个不常见</li>\n</ul>\n<ul>\n<li>http-only        表明该Cookie只能在http头中传输，js不能访问到</li>\n</ul>\n<ul>\n<li>secure     表明Cookie只能在使用https协议的传输，使用http协议时不会传输。这里遇到一个坑点，当把secure属性去掉之后，需要重启浏览器才能生效。</li>\n</ul>\n<h4 id=\"Cookie的几个作用\"><a href=\"#Cookie的几个作用\" class=\"headerlink\" title=\"Cookie的几个作用\"></a>Cookie的几个作用</h4><p>session管理：      常见的是session_id这个Cookie，在http访问的过程用于用户身份的标识。</p>\n<p>个性化 ：       这个可见于购物车</p>\n<p>user tracking：    追踪用户行为，貌似很多广告就是因为这个。</p>\n<h4 id=\"针对Cookie的攻击手段\"><a href=\"#针对Cookie的攻击手段\" class=\"headerlink\" title=\"针对Cookie的攻击手段\"></a>针对Cookie的攻击手段</h4><p>Cookie窃取，例如通过站点的xss漏洞可能窃取到用户浏览器的Cookie。</p>\n<p>Cookie欺骗，因为Cookie是用户可控的，如果某些敏感字段写在Cookie里边，很容易被恶意篡改。</p>\n","site":{"data":{}},"excerpt":"<h4 id=\"Cookie是什么\"><a href=\"#Cookie是什么\" class=\"headerlink\" title=\"Cookie是什么\"></a>Cookie是什么</h4><p>由于HTTP协议是一种无状态协议，服务端是无法根据网络连接来区别不同用户身份的。Cookie在这种情况下充当了一个通行证的作用，服务器就可以根据Cookie来确认用户身份了。</p>\n<p>Cookie实际上是一小段文本信息，通常情况下是通过HTTP HEADER进行发送和接收。</p>","more":"<p><img src=\"/blogimg/setcookie.png\" alt=\"image\"></p>\n<p><img src=\"/blogimg/sendcookie.png\" alt=\"image\"></p>\n<h4 id=\"Cookie的几个常用属性\"><a href=\"#Cookie的几个常用属性\" class=\"headerlink\" title=\"Cookie的几个常用属性\"></a>Cookie的几个常用属性</h4><p>cookie的值是已键值对表示的，除开Cookie带的值，还有一些用于表示过期时间和用于安全目的的属性。</p>\n<ul>\n<li>name   Cookie值的键</li>\n</ul>\n<ul>\n<li>value   Cookie值的内容</li>\n</ul>\n<ul>\n<li>domain     表示可以访问该Cookie的域名</li>\n</ul>\n<ul>\n<li>path     可以访问该Cookie的页面路径。常见的值有/</li>\n</ul>\n<ul>\n<li>expires      Cookie的超时时间，到达时间则失效。</li>\n</ul>\n<ul>\n<li>size    Cookie的大小，这个不常见</li>\n</ul>\n<ul>\n<li>http-only        表明该Cookie只能在http头中传输，js不能访问到</li>\n</ul>\n<ul>\n<li>secure     表明Cookie只能在使用https协议的传输，使用http协议时不会传输。这里遇到一个坑点，当把secure属性去掉之后，需要重启浏览器才能生效。</li>\n</ul>\n<h4 id=\"Cookie的几个作用\"><a href=\"#Cookie的几个作用\" class=\"headerlink\" title=\"Cookie的几个作用\"></a>Cookie的几个作用</h4><p>session管理：      常见的是session_id这个Cookie，在http访问的过程用于用户身份的标识。</p>\n<p>个性化 ：       这个可见于购物车</p>\n<p>user tracking：    追踪用户行为，貌似很多广告就是因为这个。</p>\n<h4 id=\"针对Cookie的攻击手段\"><a href=\"#针对Cookie的攻击手段\" class=\"headerlink\" title=\"针对Cookie的攻击手段\"></a>针对Cookie的攻击手段</h4><p>Cookie窃取，例如通过站点的xss漏洞可能窃取到用户浏览器的Cookie。</p>\n<p>Cookie欺骗，因为Cookie是用户可控的，如果某些敏感字段写在Cookie里边，很容易被恶意篡改。</p>"},{"title":"python中使用Unix socket通信","date":"2017-10-19T03:12:15.000Z","_content":"\n对于socket模式的通信来说，除了常见的TCP/IP套接字还有Unix套接字。不过说Unix套接字是系统上的一个文件，而非主机名和端口，而Unix套接字关闭之后，文件系统上仍然会存在套接字文件，需要在服务端程序启动之前进行删除，它的其他操作和TCP/IP套接字是一样的。下面用一个简单的echo server记录一下Unix套接字的基本使用方法。\n\n<!--more-->\n\nserver端代码：\n\n```python\n#!/usr/bin/env python\n# -*- coding:utf-8 -*-\n\n\nimport socket\nimport sys\nimport os\n\nserver_addr = './uds.sock'\n#确保sock不存在\ntry:\n\tos.unlink(server_addr)\nexcept OSError:\n\tif os.path.exists(server_addr):\n\t\traise\n#创建一个unix类型的socket\nsock = socket.socket(socket.AF_UNIX, socket.SOCK_STREAM)\n#将socket绑定到地址上\nprint >>sys.stderr, 'Starting up on %s', server_addr\nsock.bind(server_addr)\n#开始在绑定的地址上监听\nsock.listen(5)\n#死循环，阻塞式的接收数据\nwhile True:\n\tprint >>sys.stderr, 'Waiting for connetion...'\n\tconn, client_addr = sock.accept()\n\ttry:\n\t\tprint >>sys.stderr, 'connection from ', client_addr\n\t\t#使用较小的缓冲区接收数据，并返回它到客户端\n\t\twhile True:\n\t\t\tdata = conn.recv(6)\n\t\t\tprint >>sys.stderr, 'recv data %s' % data\n\t\t\tif data:\n\t\t\t\tprint >>sys.stderr, 'echo %s to client' % data\n\t\t\t\tconn.sendall(data)\n\t\t\telse:\n\t\t\t\tprint >>sys.stderr, 'no data from client'\n\t\t\t\tbreak\n\t#记得关闭连接\n\tfinally:\n\t\tconn.close() \n```\n\n客户端代码：\n\n```python\n#!/usr/bin/env python\n# -*- coding:utf-8 -*-\nimport socket\nimport sys\n\n#创建一个unix socket\nsock = socket.socket(socket.AF_UNIX, socket.SOCK_STREAM)\n#设置服务端socket的地址\nserver_addr = './uds.sock'\nprint >>sys.stderr, 'connecting to %s', server_addr\ntry:\n\tsock.connect(server_addr)\nexcept socket.error, msg:\n\tprint >>sys.stderr, msg\n\tsys.exit(1)\n#向服务器发送数据和接收数据\ntry:\n\t#发送数据\n\tmessage = \"This is the message. It will be repeated.\"\n\tprint >>sys.stderr, 'sending %s' % message\n\tsock.sendall(message)\n\n\tamount_received = 0\n\tamount_expected = len(message)\n\n\twhile amount_received < amount_expected:\n\t\tdata = sock.recv(16)\n\t\tamount_received += len(data)\n\t\tprint >>sys.stderr, 'received %s' % data\nfinally:\n\tprint >>sys.stderr, 'closing socket'\n\tsock.close()\n```\n\n运行结果：\n\n服务端：\n\n```shell\nxing@xing:~/pypractice$ python uds_server.py \nStarting up on %s ./uds.sock\nWaiting for connetion...\nconnection from  \nrecv data This i\necho This i to client\nrecv data s the \necho s the  to client\nrecv data messag\necho messag to client\nrecv data e. It \necho e. It  to client\nrecv data will b\necho will b to client\nrecv data e repe\necho e repe to client\nrecv data ated.\necho ated. to client\nrecv data \nno data from client\n\n```\n\n客户端：\n\n```shell\nxing@xing:~/pypractice$ python uds_client.py \nconnecting to %s ./uds.sock\nsending This is the message. It will be repeated.\nreceived This is the mess\nreceived age. It will be \nreceived repeated.\nclosing socket\n```\n\n使用Unix套接字需要注意程序是否有权限去读写套接字文件。\n\nUnix套接字最主要的一个用途就是用于进程间通信，为此还有本大部头的书籍《Unix网络编程卷2：进程间通信》，看来还得买来学习一下。\n\n这里有个简单的进程间通信的小例子：\n\n```python\n#!/usr/bin/env python\n# -*- coding:utf-8 -*-\nimport socket\nimport os\n\nparent, child = socket.socketpair()\n\npid = os.fork()\n\nif pid:\n    print 'in parent, sending message'\n    child.close()\n    parent.sendall('ping')\n    response = parent.recv(1024)\n    print 'response from child:', response\n    parent.close()\n\nelse:\n    print 'in child, waiting for message'\n    parent.close()\n    message = child.recv(1024)\n    print 'message from parent:', message\n    child.sendall('pong')\n    child.close()\n```\n\n运行结果：\n\n```shell\nxing@xing:~/pypractice$ python pro.py \nin parent, sending message\nin child, waiting for message\nmessage from parent: ping\nresponse from child: pong\n```\n\n参考链接：https://pymotw.com/2/socket/uds.html","source":"_posts/UnixSocket-echodemo.md","raw":"---\ntitle: python中使用Unix socket通信\ncategories:\n  - Program\ntags:\n  - python socket\ndate: 2017-10-19 11:12:15\n---\n\n对于socket模式的通信来说，除了常见的TCP/IP套接字还有Unix套接字。不过说Unix套接字是系统上的一个文件，而非主机名和端口，而Unix套接字关闭之后，文件系统上仍然会存在套接字文件，需要在服务端程序启动之前进行删除，它的其他操作和TCP/IP套接字是一样的。下面用一个简单的echo server记录一下Unix套接字的基本使用方法。\n\n<!--more-->\n\nserver端代码：\n\n```python\n#!/usr/bin/env python\n# -*- coding:utf-8 -*-\n\n\nimport socket\nimport sys\nimport os\n\nserver_addr = './uds.sock'\n#确保sock不存在\ntry:\n\tos.unlink(server_addr)\nexcept OSError:\n\tif os.path.exists(server_addr):\n\t\traise\n#创建一个unix类型的socket\nsock = socket.socket(socket.AF_UNIX, socket.SOCK_STREAM)\n#将socket绑定到地址上\nprint >>sys.stderr, 'Starting up on %s', server_addr\nsock.bind(server_addr)\n#开始在绑定的地址上监听\nsock.listen(5)\n#死循环，阻塞式的接收数据\nwhile True:\n\tprint >>sys.stderr, 'Waiting for connetion...'\n\tconn, client_addr = sock.accept()\n\ttry:\n\t\tprint >>sys.stderr, 'connection from ', client_addr\n\t\t#使用较小的缓冲区接收数据，并返回它到客户端\n\t\twhile True:\n\t\t\tdata = conn.recv(6)\n\t\t\tprint >>sys.stderr, 'recv data %s' % data\n\t\t\tif data:\n\t\t\t\tprint >>sys.stderr, 'echo %s to client' % data\n\t\t\t\tconn.sendall(data)\n\t\t\telse:\n\t\t\t\tprint >>sys.stderr, 'no data from client'\n\t\t\t\tbreak\n\t#记得关闭连接\n\tfinally:\n\t\tconn.close() \n```\n\n客户端代码：\n\n```python\n#!/usr/bin/env python\n# -*- coding:utf-8 -*-\nimport socket\nimport sys\n\n#创建一个unix socket\nsock = socket.socket(socket.AF_UNIX, socket.SOCK_STREAM)\n#设置服务端socket的地址\nserver_addr = './uds.sock'\nprint >>sys.stderr, 'connecting to %s', server_addr\ntry:\n\tsock.connect(server_addr)\nexcept socket.error, msg:\n\tprint >>sys.stderr, msg\n\tsys.exit(1)\n#向服务器发送数据和接收数据\ntry:\n\t#发送数据\n\tmessage = \"This is the message. It will be repeated.\"\n\tprint >>sys.stderr, 'sending %s' % message\n\tsock.sendall(message)\n\n\tamount_received = 0\n\tamount_expected = len(message)\n\n\twhile amount_received < amount_expected:\n\t\tdata = sock.recv(16)\n\t\tamount_received += len(data)\n\t\tprint >>sys.stderr, 'received %s' % data\nfinally:\n\tprint >>sys.stderr, 'closing socket'\n\tsock.close()\n```\n\n运行结果：\n\n服务端：\n\n```shell\nxing@xing:~/pypractice$ python uds_server.py \nStarting up on %s ./uds.sock\nWaiting for connetion...\nconnection from  \nrecv data This i\necho This i to client\nrecv data s the \necho s the  to client\nrecv data messag\necho messag to client\nrecv data e. It \necho e. It  to client\nrecv data will b\necho will b to client\nrecv data e repe\necho e repe to client\nrecv data ated.\necho ated. to client\nrecv data \nno data from client\n\n```\n\n客户端：\n\n```shell\nxing@xing:~/pypractice$ python uds_client.py \nconnecting to %s ./uds.sock\nsending This is the message. It will be repeated.\nreceived This is the mess\nreceived age. It will be \nreceived repeated.\nclosing socket\n```\n\n使用Unix套接字需要注意程序是否有权限去读写套接字文件。\n\nUnix套接字最主要的一个用途就是用于进程间通信，为此还有本大部头的书籍《Unix网络编程卷2：进程间通信》，看来还得买来学习一下。\n\n这里有个简单的进程间通信的小例子：\n\n```python\n#!/usr/bin/env python\n# -*- coding:utf-8 -*-\nimport socket\nimport os\n\nparent, child = socket.socketpair()\n\npid = os.fork()\n\nif pid:\n    print 'in parent, sending message'\n    child.close()\n    parent.sendall('ping')\n    response = parent.recv(1024)\n    print 'response from child:', response\n    parent.close()\n\nelse:\n    print 'in child, waiting for message'\n    parent.close()\n    message = child.recv(1024)\n    print 'message from parent:', message\n    child.sendall('pong')\n    child.close()\n```\n\n运行结果：\n\n```shell\nxing@xing:~/pypractice$ python pro.py \nin parent, sending message\nin child, waiting for message\nmessage from parent: ping\nresponse from child: pong\n```\n\n参考链接：https://pymotw.com/2/socket/uds.html","slug":"UnixSocket-echodemo","published":1,"updated":"2017-12-04T07:27:28.763Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjeqig1ox0046lgqatxheevwz","content":"<p>对于socket模式的通信来说，除了常见的TCP/IP套接字还有Unix套接字。不过说Unix套接字是系统上的一个文件，而非主机名和端口，而Unix套接字关闭之后，文件系统上仍然会存在套接字文件，需要在服务端程序启动之前进行删除，它的其他操作和TCP/IP套接字是一样的。下面用一个简单的echo server记录一下Unix套接字的基本使用方法。</p>\n<a id=\"more\"></a>\n<p>server端代码：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/usr/bin/env python</span></span><br><span class=\"line\"><span class=\"comment\"># -*- coding:utf-8 -*-</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> socket</span><br><span class=\"line\"><span class=\"keyword\">import</span> sys</span><br><span class=\"line\"><span class=\"keyword\">import</span> os</span><br><span class=\"line\"></span><br><span class=\"line\">server_addr = <span class=\"string\">'./uds.sock'</span></span><br><span class=\"line\"><span class=\"comment\">#确保sock不存在</span></span><br><span class=\"line\"><span class=\"keyword\">try</span>:</span><br><span class=\"line\">\tos.unlink(server_addr)</span><br><span class=\"line\"><span class=\"keyword\">except</span> OSError:</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> os.path.exists(server_addr):</span><br><span class=\"line\">\t\t<span class=\"keyword\">raise</span></span><br><span class=\"line\"><span class=\"comment\">#创建一个unix类型的socket</span></span><br><span class=\"line\">sock = socket.socket(socket.AF_UNIX, socket.SOCK_STREAM)</span><br><span class=\"line\"><span class=\"comment\">#将socket绑定到地址上</span></span><br><span class=\"line\"><span class=\"keyword\">print</span> &gt;&gt;sys.stderr, <span class=\"string\">'Starting up on %s'</span>, server_addr</span><br><span class=\"line\">sock.bind(server_addr)</span><br><span class=\"line\"><span class=\"comment\">#开始在绑定的地址上监听</span></span><br><span class=\"line\">sock.listen(<span class=\"number\">5</span>)</span><br><span class=\"line\"><span class=\"comment\">#死循环，阻塞式的接收数据</span></span><br><span class=\"line\"><span class=\"keyword\">while</span> <span class=\"keyword\">True</span>:</span><br><span class=\"line\">\t<span class=\"keyword\">print</span> &gt;&gt;sys.stderr, <span class=\"string\">'Waiting for connetion...'</span></span><br><span class=\"line\">\tconn, client_addr = sock.accept()</span><br><span class=\"line\">\t<span class=\"keyword\">try</span>:</span><br><span class=\"line\">\t\t<span class=\"keyword\">print</span> &gt;&gt;sys.stderr, <span class=\"string\">'connection from '</span>, client_addr</span><br><span class=\"line\">\t\t<span class=\"comment\">#使用较小的缓冲区接收数据，并返回它到客户端</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">while</span> <span class=\"keyword\">True</span>:</span><br><span class=\"line\">\t\t\tdata = conn.recv(<span class=\"number\">6</span>)</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">print</span> &gt;&gt;sys.stderr, <span class=\"string\">'recv data %s'</span> % data</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> data:</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">print</span> &gt;&gt;sys.stderr, <span class=\"string\">'echo %s to client'</span> % data</span><br><span class=\"line\">\t\t\t\tconn.sendall(data)</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">else</span>:</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">print</span> &gt;&gt;sys.stderr, <span class=\"string\">'no data from client'</span></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">break</span></span><br><span class=\"line\">\t<span class=\"comment\">#记得关闭连接</span></span><br><span class=\"line\">\t<span class=\"keyword\">finally</span>:</span><br><span class=\"line\">\t\tconn.close()</span><br></pre></td></tr></table></figure>\n<p>客户端代码：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/usr/bin/env python</span></span><br><span class=\"line\"><span class=\"comment\"># -*- coding:utf-8 -*-</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> socket</span><br><span class=\"line\"><span class=\"keyword\">import</span> sys</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#创建一个unix socket</span></span><br><span class=\"line\">sock = socket.socket(socket.AF_UNIX, socket.SOCK_STREAM)</span><br><span class=\"line\"><span class=\"comment\">#设置服务端socket的地址</span></span><br><span class=\"line\">server_addr = <span class=\"string\">'./uds.sock'</span></span><br><span class=\"line\"><span class=\"keyword\">print</span> &gt;&gt;sys.stderr, <span class=\"string\">'connecting to %s'</span>, server_addr</span><br><span class=\"line\"><span class=\"keyword\">try</span>:</span><br><span class=\"line\">\tsock.connect(server_addr)</span><br><span class=\"line\"><span class=\"keyword\">except</span> socket.error, msg:</span><br><span class=\"line\">\t<span class=\"keyword\">print</span> &gt;&gt;sys.stderr, msg</span><br><span class=\"line\">\tsys.exit(<span class=\"number\">1</span>)</span><br><span class=\"line\"><span class=\"comment\">#向服务器发送数据和接收数据</span></span><br><span class=\"line\"><span class=\"keyword\">try</span>:</span><br><span class=\"line\">\t<span class=\"comment\">#发送数据</span></span><br><span class=\"line\">\tmessage = <span class=\"string\">\"This is the message. It will be repeated.\"</span></span><br><span class=\"line\">\t<span class=\"keyword\">print</span> &gt;&gt;sys.stderr, <span class=\"string\">'sending %s'</span> % message</span><br><span class=\"line\">\tsock.sendall(message)</span><br><span class=\"line\"></span><br><span class=\"line\">\tamount_received = <span class=\"number\">0</span></span><br><span class=\"line\">\tamount_expected = len(message)</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">while</span> amount_received &lt; amount_expected:</span><br><span class=\"line\">\t\tdata = sock.recv(<span class=\"number\">16</span>)</span><br><span class=\"line\">\t\tamount_received += len(data)</span><br><span class=\"line\">\t\t<span class=\"keyword\">print</span> &gt;&gt;sys.stderr, <span class=\"string\">'received %s'</span> % data</span><br><span class=\"line\"><span class=\"keyword\">finally</span>:</span><br><span class=\"line\">\t<span class=\"keyword\">print</span> &gt;&gt;sys.stderr, <span class=\"string\">'closing socket'</span></span><br><span class=\"line\">\tsock.close()</span><br></pre></td></tr></table></figure>\n<p>运行结果：</p>\n<p>服务端：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">xing@xing:~/pypractice$ python uds_server.py </span><br><span class=\"line\">Starting up on %s ./uds.sock</span><br><span class=\"line\">Waiting for connetion...</span><br><span class=\"line\">connection from  </span><br><span class=\"line\">recv data This i</span><br><span class=\"line\">echo This i to client</span><br><span class=\"line\">recv data s the </span><br><span class=\"line\">echo s the  to client</span><br><span class=\"line\">recv data messag</span><br><span class=\"line\">echo messag to client</span><br><span class=\"line\">recv data e. It </span><br><span class=\"line\">echo e. It  to client</span><br><span class=\"line\">recv data will b</span><br><span class=\"line\">echo will b to client</span><br><span class=\"line\">recv data e repe</span><br><span class=\"line\">echo e repe to client</span><br><span class=\"line\">recv data ated.</span><br><span class=\"line\">echo ated. to client</span><br><span class=\"line\">recv data </span><br><span class=\"line\">no data from client</span><br></pre></td></tr></table></figure>\n<p>客户端：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">xing@xing:~/pypractice$ python uds_client.py </span><br><span class=\"line\">connecting to %s ./uds.sock</span><br><span class=\"line\">sending This is the message. It will be repeated.</span><br><span class=\"line\">received This is the mess</span><br><span class=\"line\">received age. It will be </span><br><span class=\"line\">received repeated.</span><br><span class=\"line\">closing socket</span><br></pre></td></tr></table></figure>\n<p>使用Unix套接字需要注意程序是否有权限去读写套接字文件。</p>\n<p>Unix套接字最主要的一个用途就是用于进程间通信，为此还有本大部头的书籍《Unix网络编程卷2：进程间通信》，看来还得买来学习一下。</p>\n<p>这里有个简单的进程间通信的小例子：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/usr/bin/env python</span></span><br><span class=\"line\"><span class=\"comment\"># -*- coding:utf-8 -*-</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> socket</span><br><span class=\"line\"><span class=\"keyword\">import</span> os</span><br><span class=\"line\"></span><br><span class=\"line\">parent, child = socket.socketpair()</span><br><span class=\"line\"></span><br><span class=\"line\">pid = os.fork()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> pid:</span><br><span class=\"line\">    <span class=\"keyword\">print</span> <span class=\"string\">'in parent, sending message'</span></span><br><span class=\"line\">    child.close()</span><br><span class=\"line\">    parent.sendall(<span class=\"string\">'ping'</span>)</span><br><span class=\"line\">    response = parent.recv(<span class=\"number\">1024</span>)</span><br><span class=\"line\">    <span class=\"keyword\">print</span> <span class=\"string\">'response from child:'</span>, response</span><br><span class=\"line\">    parent.close()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">else</span>:</span><br><span class=\"line\">    <span class=\"keyword\">print</span> <span class=\"string\">'in child, waiting for message'</span></span><br><span class=\"line\">    parent.close()</span><br><span class=\"line\">    message = child.recv(<span class=\"number\">1024</span>)</span><br><span class=\"line\">    <span class=\"keyword\">print</span> <span class=\"string\">'message from parent:'</span>, message</span><br><span class=\"line\">    child.sendall(<span class=\"string\">'pong'</span>)</span><br><span class=\"line\">    child.close()</span><br></pre></td></tr></table></figure>\n<p>运行结果：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">xing@xing:~/pypractice$ python pro.py </span><br><span class=\"line\">in parent, sending message</span><br><span class=\"line\">in child, waiting for message</span><br><span class=\"line\">message from parent: ping</span><br><span class=\"line\">response from child: pong</span><br></pre></td></tr></table></figure>\n<p>参考链接：<a href=\"https://pymotw.com/2/socket/uds.html\" target=\"_blank\" rel=\"noopener\">https://pymotw.com/2/socket/uds.html</a></p>\n","site":{"data":{}},"excerpt":"<p>对于socket模式的通信来说，除了常见的TCP/IP套接字还有Unix套接字。不过说Unix套接字是系统上的一个文件，而非主机名和端口，而Unix套接字关闭之后，文件系统上仍然会存在套接字文件，需要在服务端程序启动之前进行删除，它的其他操作和TCP/IP套接字是一样的。下面用一个简单的echo server记录一下Unix套接字的基本使用方法。</p>","more":"<p>server端代码：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/usr/bin/env python</span></span><br><span class=\"line\"><span class=\"comment\"># -*- coding:utf-8 -*-</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> socket</span><br><span class=\"line\"><span class=\"keyword\">import</span> sys</span><br><span class=\"line\"><span class=\"keyword\">import</span> os</span><br><span class=\"line\"></span><br><span class=\"line\">server_addr = <span class=\"string\">'./uds.sock'</span></span><br><span class=\"line\"><span class=\"comment\">#确保sock不存在</span></span><br><span class=\"line\"><span class=\"keyword\">try</span>:</span><br><span class=\"line\">\tos.unlink(server_addr)</span><br><span class=\"line\"><span class=\"keyword\">except</span> OSError:</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> os.path.exists(server_addr):</span><br><span class=\"line\">\t\t<span class=\"keyword\">raise</span></span><br><span class=\"line\"><span class=\"comment\">#创建一个unix类型的socket</span></span><br><span class=\"line\">sock = socket.socket(socket.AF_UNIX, socket.SOCK_STREAM)</span><br><span class=\"line\"><span class=\"comment\">#将socket绑定到地址上</span></span><br><span class=\"line\"><span class=\"keyword\">print</span> &gt;&gt;sys.stderr, <span class=\"string\">'Starting up on %s'</span>, server_addr</span><br><span class=\"line\">sock.bind(server_addr)</span><br><span class=\"line\"><span class=\"comment\">#开始在绑定的地址上监听</span></span><br><span class=\"line\">sock.listen(<span class=\"number\">5</span>)</span><br><span class=\"line\"><span class=\"comment\">#死循环，阻塞式的接收数据</span></span><br><span class=\"line\"><span class=\"keyword\">while</span> <span class=\"keyword\">True</span>:</span><br><span class=\"line\">\t<span class=\"keyword\">print</span> &gt;&gt;sys.stderr, <span class=\"string\">'Waiting for connetion...'</span></span><br><span class=\"line\">\tconn, client_addr = sock.accept()</span><br><span class=\"line\">\t<span class=\"keyword\">try</span>:</span><br><span class=\"line\">\t\t<span class=\"keyword\">print</span> &gt;&gt;sys.stderr, <span class=\"string\">'connection from '</span>, client_addr</span><br><span class=\"line\">\t\t<span class=\"comment\">#使用较小的缓冲区接收数据，并返回它到客户端</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">while</span> <span class=\"keyword\">True</span>:</span><br><span class=\"line\">\t\t\tdata = conn.recv(<span class=\"number\">6</span>)</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">print</span> &gt;&gt;sys.stderr, <span class=\"string\">'recv data %s'</span> % data</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> data:</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">print</span> &gt;&gt;sys.stderr, <span class=\"string\">'echo %s to client'</span> % data</span><br><span class=\"line\">\t\t\t\tconn.sendall(data)</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">else</span>:</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">print</span> &gt;&gt;sys.stderr, <span class=\"string\">'no data from client'</span></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">break</span></span><br><span class=\"line\">\t<span class=\"comment\">#记得关闭连接</span></span><br><span class=\"line\">\t<span class=\"keyword\">finally</span>:</span><br><span class=\"line\">\t\tconn.close()</span><br></pre></td></tr></table></figure>\n<p>客户端代码：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/usr/bin/env python</span></span><br><span class=\"line\"><span class=\"comment\"># -*- coding:utf-8 -*-</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> socket</span><br><span class=\"line\"><span class=\"keyword\">import</span> sys</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#创建一个unix socket</span></span><br><span class=\"line\">sock = socket.socket(socket.AF_UNIX, socket.SOCK_STREAM)</span><br><span class=\"line\"><span class=\"comment\">#设置服务端socket的地址</span></span><br><span class=\"line\">server_addr = <span class=\"string\">'./uds.sock'</span></span><br><span class=\"line\"><span class=\"keyword\">print</span> &gt;&gt;sys.stderr, <span class=\"string\">'connecting to %s'</span>, server_addr</span><br><span class=\"line\"><span class=\"keyword\">try</span>:</span><br><span class=\"line\">\tsock.connect(server_addr)</span><br><span class=\"line\"><span class=\"keyword\">except</span> socket.error, msg:</span><br><span class=\"line\">\t<span class=\"keyword\">print</span> &gt;&gt;sys.stderr, msg</span><br><span class=\"line\">\tsys.exit(<span class=\"number\">1</span>)</span><br><span class=\"line\"><span class=\"comment\">#向服务器发送数据和接收数据</span></span><br><span class=\"line\"><span class=\"keyword\">try</span>:</span><br><span class=\"line\">\t<span class=\"comment\">#发送数据</span></span><br><span class=\"line\">\tmessage = <span class=\"string\">\"This is the message. It will be repeated.\"</span></span><br><span class=\"line\">\t<span class=\"keyword\">print</span> &gt;&gt;sys.stderr, <span class=\"string\">'sending %s'</span> % message</span><br><span class=\"line\">\tsock.sendall(message)</span><br><span class=\"line\"></span><br><span class=\"line\">\tamount_received = <span class=\"number\">0</span></span><br><span class=\"line\">\tamount_expected = len(message)</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">while</span> amount_received &lt; amount_expected:</span><br><span class=\"line\">\t\tdata = sock.recv(<span class=\"number\">16</span>)</span><br><span class=\"line\">\t\tamount_received += len(data)</span><br><span class=\"line\">\t\t<span class=\"keyword\">print</span> &gt;&gt;sys.stderr, <span class=\"string\">'received %s'</span> % data</span><br><span class=\"line\"><span class=\"keyword\">finally</span>:</span><br><span class=\"line\">\t<span class=\"keyword\">print</span> &gt;&gt;sys.stderr, <span class=\"string\">'closing socket'</span></span><br><span class=\"line\">\tsock.close()</span><br></pre></td></tr></table></figure>\n<p>运行结果：</p>\n<p>服务端：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">xing@xing:~/pypractice$ python uds_server.py </span><br><span class=\"line\">Starting up on %s ./uds.sock</span><br><span class=\"line\">Waiting for connetion...</span><br><span class=\"line\">connection from  </span><br><span class=\"line\">recv data This i</span><br><span class=\"line\">echo This i to client</span><br><span class=\"line\">recv data s the </span><br><span class=\"line\">echo s the  to client</span><br><span class=\"line\">recv data messag</span><br><span class=\"line\">echo messag to client</span><br><span class=\"line\">recv data e. It </span><br><span class=\"line\">echo e. It  to client</span><br><span class=\"line\">recv data will b</span><br><span class=\"line\">echo will b to client</span><br><span class=\"line\">recv data e repe</span><br><span class=\"line\">echo e repe to client</span><br><span class=\"line\">recv data ated.</span><br><span class=\"line\">echo ated. to client</span><br><span class=\"line\">recv data </span><br><span class=\"line\">no data from client</span><br></pre></td></tr></table></figure>\n<p>客户端：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">xing@xing:~/pypractice$ python uds_client.py </span><br><span class=\"line\">connecting to %s ./uds.sock</span><br><span class=\"line\">sending This is the message. It will be repeated.</span><br><span class=\"line\">received This is the mess</span><br><span class=\"line\">received age. It will be </span><br><span class=\"line\">received repeated.</span><br><span class=\"line\">closing socket</span><br></pre></td></tr></table></figure>\n<p>使用Unix套接字需要注意程序是否有权限去读写套接字文件。</p>\n<p>Unix套接字最主要的一个用途就是用于进程间通信，为此还有本大部头的书籍《Unix网络编程卷2：进程间通信》，看来还得买来学习一下。</p>\n<p>这里有个简单的进程间通信的小例子：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/usr/bin/env python</span></span><br><span class=\"line\"><span class=\"comment\"># -*- coding:utf-8 -*-</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> socket</span><br><span class=\"line\"><span class=\"keyword\">import</span> os</span><br><span class=\"line\"></span><br><span class=\"line\">parent, child = socket.socketpair()</span><br><span class=\"line\"></span><br><span class=\"line\">pid = os.fork()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> pid:</span><br><span class=\"line\">    <span class=\"keyword\">print</span> <span class=\"string\">'in parent, sending message'</span></span><br><span class=\"line\">    child.close()</span><br><span class=\"line\">    parent.sendall(<span class=\"string\">'ping'</span>)</span><br><span class=\"line\">    response = parent.recv(<span class=\"number\">1024</span>)</span><br><span class=\"line\">    <span class=\"keyword\">print</span> <span class=\"string\">'response from child:'</span>, response</span><br><span class=\"line\">    parent.close()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">else</span>:</span><br><span class=\"line\">    <span class=\"keyword\">print</span> <span class=\"string\">'in child, waiting for message'</span></span><br><span class=\"line\">    parent.close()</span><br><span class=\"line\">    message = child.recv(<span class=\"number\">1024</span>)</span><br><span class=\"line\">    <span class=\"keyword\">print</span> <span class=\"string\">'message from parent:'</span>, message</span><br><span class=\"line\">    child.sendall(<span class=\"string\">'pong'</span>)</span><br><span class=\"line\">    child.close()</span><br></pre></td></tr></table></figure>\n<p>运行结果：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">xing@xing:~/pypractice$ python pro.py </span><br><span class=\"line\">in parent, sending message</span><br><span class=\"line\">in child, waiting for message</span><br><span class=\"line\">message from parent: ping</span><br><span class=\"line\">response from child: pong</span><br></pre></td></tr></table></figure>\n<p>参考链接：<a href=\"https://pymotw.com/2/socket/uds.html\" target=\"_blank\" rel=\"noopener\">https://pymotw.com/2/socket/uds.html</a></p>"},{"title":"Hello World","date":"2016-07-21T14:29:18.000Z","_content":"Welcome to [Hexo](https://hexo.io/)! This is your very first post. Check [documentation](https://hexo.io/docs/) for more info. If you get any problems when using Hexo, you can find the answer in [troubleshooting](https://hexo.io/docs/troubleshooting.html) or you can ask me on [GitHub](https://github.com/hexojs/hexo/issues).\n<!-- more -->\n## Quick Start\n\n### Create a new post\n\n``` bash\n$ hexo new \"My New Post\"\n```\n\nMore info: [Writing](https://hexo.io/docs/writing.html)\n\n### Run server\n\n``` bash\n$ hexo server\n```\nMore info: [Server](https://hexo.io/docs/server.html)\n\n### Generate static files\n\n``` bash\n$ hexo generate\n```\n\nMore info: [Generating](https://hexo.io/docs/generating.html)\n\n### Deploy to remote sites\n\n``` bash\n$ hexo deploy\n```\n\nMore info: [Deployment](https://hexo.io/docs/deployment.html)\n","source":"_posts/hello-world.md","raw":"---\ntitle: Hello World\ndate: 2016-07-21 22:29:18\ntags:\n- hello hexo\n---\nWelcome to [Hexo](https://hexo.io/)! This is your very first post. Check [documentation](https://hexo.io/docs/) for more info. If you get any problems when using Hexo, you can find the answer in [troubleshooting](https://hexo.io/docs/troubleshooting.html) or you can ask me on [GitHub](https://github.com/hexojs/hexo/issues).\n<!-- more -->\n## Quick Start\n\n### Create a new post\n\n``` bash\n$ hexo new \"My New Post\"\n```\n\nMore info: [Writing](https://hexo.io/docs/writing.html)\n\n### Run server\n\n``` bash\n$ hexo server\n```\nMore info: [Server](https://hexo.io/docs/server.html)\n\n### Generate static files\n\n``` bash\n$ hexo generate\n```\n\nMore info: [Generating](https://hexo.io/docs/generating.html)\n\n### Deploy to remote sites\n\n``` bash\n$ hexo deploy\n```\n\nMore info: [Deployment](https://hexo.io/docs/deployment.html)\n","slug":"hello-world","published":1,"updated":"2017-12-04T07:27:28.763Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjeqig1p00048lgqadzqf0q1s","content":"<p>Welcome to <a href=\"https://hexo.io/\" target=\"_blank\" rel=\"noopener\">Hexo</a>! This is your very first post. Check <a href=\"https://hexo.io/docs/\" target=\"_blank\" rel=\"noopener\">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href=\"https://hexo.io/docs/troubleshooting.html\" target=\"_blank\" rel=\"noopener\">troubleshooting</a> or you can ask me on <a href=\"https://github.com/hexojs/hexo/issues\" target=\"_blank\" rel=\"noopener\">GitHub</a>.<br><a id=\"more\"></a></p>\n<h2 id=\"Quick-Start\"><a href=\"#Quick-Start\" class=\"headerlink\" title=\"Quick Start\"></a>Quick Start</h2><h3 id=\"Create-a-new-post\"><a href=\"#Create-a-new-post\" class=\"headerlink\" title=\"Create a new post\"></a>Create a new post</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo new <span class=\"string\">\"My New Post\"</span></span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/writing.html\" target=\"_blank\" rel=\"noopener\">Writing</a></p>\n<h3 id=\"Run-server\"><a href=\"#Run-server\" class=\"headerlink\" title=\"Run server\"></a>Run server</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo server</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/server.html\" target=\"_blank\" rel=\"noopener\">Server</a></p>\n<h3 id=\"Generate-static-files\"><a href=\"#Generate-static-files\" class=\"headerlink\" title=\"Generate static files\"></a>Generate static files</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo generate</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/generating.html\" target=\"_blank\" rel=\"noopener\">Generating</a></p>\n<h3 id=\"Deploy-to-remote-sites\"><a href=\"#Deploy-to-remote-sites\" class=\"headerlink\" title=\"Deploy to remote sites\"></a>Deploy to remote sites</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo deploy</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/deployment.html\" target=\"_blank\" rel=\"noopener\">Deployment</a></p>\n","site":{"data":{}},"excerpt":"<p>Welcome to <a href=\"https://hexo.io/\" target=\"_blank\" rel=\"noopener\">Hexo</a>! This is your very first post. Check <a href=\"https://hexo.io/docs/\" target=\"_blank\" rel=\"noopener\">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href=\"https://hexo.io/docs/troubleshooting.html\" target=\"_blank\" rel=\"noopener\">troubleshooting</a> or you can ask me on <a href=\"https://github.com/hexojs/hexo/issues\" target=\"_blank\" rel=\"noopener\">GitHub</a>.<br>","more":"</p>\n<h2 id=\"Quick-Start\"><a href=\"#Quick-Start\" class=\"headerlink\" title=\"Quick Start\"></a>Quick Start</h2><h3 id=\"Create-a-new-post\"><a href=\"#Create-a-new-post\" class=\"headerlink\" title=\"Create a new post\"></a>Create a new post</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo new <span class=\"string\">\"My New Post\"</span></span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/writing.html\" target=\"_blank\" rel=\"noopener\">Writing</a></p>\n<h3 id=\"Run-server\"><a href=\"#Run-server\" class=\"headerlink\" title=\"Run server\"></a>Run server</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo server</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/server.html\" target=\"_blank\" rel=\"noopener\">Server</a></p>\n<h3 id=\"Generate-static-files\"><a href=\"#Generate-static-files\" class=\"headerlink\" title=\"Generate static files\"></a>Generate static files</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo generate</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/generating.html\" target=\"_blank\" rel=\"noopener\">Generating</a></p>\n<h3 id=\"Deploy-to-remote-sites\"><a href=\"#Deploy-to-remote-sites\" class=\"headerlink\" title=\"Deploy to remote sites\"></a>Deploy to remote sites</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo deploy</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/deployment.html\" target=\"_blank\" rel=\"noopener\">Deployment</a></p>"},{"title":"KVM命令行安装windows7","date":"2018-03-08T14:29:29.000Z","_content":"\n书接上回，上次我们在Ubuntu上安装好了KVM软件，并且使用图形化的virt-manager来创建了一台windows虚拟机，这次我们使用KVM的命令行工具来安装一台windows虚拟机。\n\n<!--more-->\n\n#### 步骤1：准备操作系统镜像\n\n这里我使用的是老毛子精简版windows7镜像，整个镜像大小1.6G左右。\n\n![image](/blogimg/win7_iso.png)\n\n#### 步骤2：在宿主机上创建响应目录\n\n接下来需要在宿主机上创建用来存放虚拟机安装镜像和虚拟机镜像的目录。\n\n```shell\nroot@ubuntu-kvm:/# tree kvm_images/\nkvm_images/\n├── guest_os\n│   └── mini_win7.img\n└── iso\n    └── 23403_GRMCULXFRER_ZH-CN_MICRO_v2.iso\n\n2 directories, 2 files\n\n```\n\n这是我的目录结构。接下来将系统安装镜像传到宿主机中。\n\n#### 步骤3：命令行安装\n\n```shell\nroot@ubuntu-kvm:/kvm_images/iso# virt-install --name mini-win7 -hvm --ram 1024 --vcpus 1 --disk path=/kvm_images/guest_os/mini_win7.img,size=10 --network network:default --accelerate --vnc --vncport=5901 --vnclisten=0.0.0.0 --cdrom /kvm_images/iso/23403_GRMCULXFRER_ZH-CN_MICRO_v2.iso -d\n```\n\n部分参数解释：\n\n--name:创建的虚拟机名称\n\n-hvm：完全虚拟机\n\n--ram:虚拟机内存大小，单位M,这里我给了1G\n\n--vcpus:虚拟机cpu个数，我这里给了一个核\n\n--disk path:虚拟机虚拟硬盘的存放目录，我放在了/kvm_images/guest_os/mini_win7.img，size为硬盘大小，我给了10G\n\n--network:虚拟机的网络连接方式，这里我使用的default，即NAT方式\n\n--vnc:远程连接方式使用VNC\n\n--vnclisten:vnc监听地址，这里使用0.0.0.0，即监听所有接口，默认监听127.0.0.1，所以外部不能直接访问到。\n\n--vncport:VNC的端口，这里我使用了5901端口\n\n--cdrom:虚拟光驱挂载的镜像路径，这里接上安装镜像的路径\n\n回车后，安装过程就开始了，可以使用VNC工具去连接相应的端口进行安装了。如果忘记加--vnclisten=0.0.0.0，可以通过virsh edit mini-win7去编辑配置文件，将graphics中的配置更改如下：\n\n```xml\n<graphics type='vnc' port='5901' autoport='no' listen='0.0.0.0'>       \n  <listen type='address' address='0.0.0.0'/>        \n</graphics>\n```\n\n使用VNC连接上之后就是很普通的安装过程了。","source":"_posts/kvm-win7-install.md","raw":"---\ntitle: KVM命令行安装windows7\ncategories:\n  - Linux\ntags:\n  - kvm\ndate: 2018-03-08 22:29:29\n---\n\n书接上回，上次我们在Ubuntu上安装好了KVM软件，并且使用图形化的virt-manager来创建了一台windows虚拟机，这次我们使用KVM的命令行工具来安装一台windows虚拟机。\n\n<!--more-->\n\n#### 步骤1：准备操作系统镜像\n\n这里我使用的是老毛子精简版windows7镜像，整个镜像大小1.6G左右。\n\n![image](/blogimg/win7_iso.png)\n\n#### 步骤2：在宿主机上创建响应目录\n\n接下来需要在宿主机上创建用来存放虚拟机安装镜像和虚拟机镜像的目录。\n\n```shell\nroot@ubuntu-kvm:/# tree kvm_images/\nkvm_images/\n├── guest_os\n│   └── mini_win7.img\n└── iso\n    └── 23403_GRMCULXFRER_ZH-CN_MICRO_v2.iso\n\n2 directories, 2 files\n\n```\n\n这是我的目录结构。接下来将系统安装镜像传到宿主机中。\n\n#### 步骤3：命令行安装\n\n```shell\nroot@ubuntu-kvm:/kvm_images/iso# virt-install --name mini-win7 -hvm --ram 1024 --vcpus 1 --disk path=/kvm_images/guest_os/mini_win7.img,size=10 --network network:default --accelerate --vnc --vncport=5901 --vnclisten=0.0.0.0 --cdrom /kvm_images/iso/23403_GRMCULXFRER_ZH-CN_MICRO_v2.iso -d\n```\n\n部分参数解释：\n\n--name:创建的虚拟机名称\n\n-hvm：完全虚拟机\n\n--ram:虚拟机内存大小，单位M,这里我给了1G\n\n--vcpus:虚拟机cpu个数，我这里给了一个核\n\n--disk path:虚拟机虚拟硬盘的存放目录，我放在了/kvm_images/guest_os/mini_win7.img，size为硬盘大小，我给了10G\n\n--network:虚拟机的网络连接方式，这里我使用的default，即NAT方式\n\n--vnc:远程连接方式使用VNC\n\n--vnclisten:vnc监听地址，这里使用0.0.0.0，即监听所有接口，默认监听127.0.0.1，所以外部不能直接访问到。\n\n--vncport:VNC的端口，这里我使用了5901端口\n\n--cdrom:虚拟光驱挂载的镜像路径，这里接上安装镜像的路径\n\n回车后，安装过程就开始了，可以使用VNC工具去连接相应的端口进行安装了。如果忘记加--vnclisten=0.0.0.0，可以通过virsh edit mini-win7去编辑配置文件，将graphics中的配置更改如下：\n\n```xml\n<graphics type='vnc' port='5901' autoport='no' listen='0.0.0.0'>       \n  <listen type='address' address='0.0.0.0'/>        \n</graphics>\n```\n\n使用VNC连接上之后就是很普通的安装过程了。","slug":"kvm-win7-install","published":1,"updated":"2018-03-09T03:26:41.463Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjeqig1p8004blgqa5ggozp6r","content":"<p>书接上回，上次我们在Ubuntu上安装好了KVM软件，并且使用图形化的virt-manager来创建了一台windows虚拟机，这次我们使用KVM的命令行工具来安装一台windows虚拟机。</p>\n<a id=\"more\"></a>\n<h4 id=\"步骤1：准备操作系统镜像\"><a href=\"#步骤1：准备操作系统镜像\" class=\"headerlink\" title=\"步骤1：准备操作系统镜像\"></a>步骤1：准备操作系统镜像</h4><p>这里我使用的是老毛子精简版windows7镜像，整个镜像大小1.6G左右。</p>\n<p><img src=\"/blogimg/win7_iso.png\" alt=\"image\"></p>\n<h4 id=\"步骤2：在宿主机上创建响应目录\"><a href=\"#步骤2：在宿主机上创建响应目录\" class=\"headerlink\" title=\"步骤2：在宿主机上创建响应目录\"></a>步骤2：在宿主机上创建响应目录</h4><p>接下来需要在宿主机上创建用来存放虚拟机安装镜像和虚拟机镜像的目录。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">root@ubuntu-kvm:/# tree kvm_images/</span><br><span class=\"line\">kvm_images/</span><br><span class=\"line\">├── guest_os</span><br><span class=\"line\">│   └── mini_win7.img</span><br><span class=\"line\">└── iso</span><br><span class=\"line\">    └── 23403_GRMCULXFRER_ZH-CN_MICRO_v2.iso</span><br><span class=\"line\"></span><br><span class=\"line\">2 directories, 2 files</span><br></pre></td></tr></table></figure>\n<p>这是我的目录结构。接下来将系统安装镜像传到宿主机中。</p>\n<h4 id=\"步骤3：命令行安装\"><a href=\"#步骤3：命令行安装\" class=\"headerlink\" title=\"步骤3：命令行安装\"></a>步骤3：命令行安装</h4><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">root@ubuntu-kvm:/kvm_images/iso# virt-install --name mini-win7 -hvm --ram 1024 --vcpus 1 --disk path=/kvm_images/guest_os/mini_win7.img,size=10 --network network:default --accelerate --vnc --vncport=5901 --vnclisten=0.0.0.0 --cdrom /kvm_images/iso/23403_GRMCULXFRER_ZH-CN_MICRO_v2.iso -d</span><br></pre></td></tr></table></figure>\n<p>部分参数解释：</p>\n<p>–name:创建的虚拟机名称</p>\n<p>-hvm：完全虚拟机</p>\n<p>–ram:虚拟机内存大小，单位M,这里我给了1G</p>\n<p>–vcpus:虚拟机cpu个数，我这里给了一个核</p>\n<p>–disk path:虚拟机虚拟硬盘的存放目录，我放在了/kvm_images/guest_os/mini_win7.img，size为硬盘大小，我给了10G</p>\n<p>–network:虚拟机的网络连接方式，这里我使用的default，即NAT方式</p>\n<p>–vnc:远程连接方式使用VNC</p>\n<p>–vnclisten:vnc监听地址，这里使用0.0.0.0，即监听所有接口，默认监听127.0.0.1，所以外部不能直接访问到。</p>\n<p>–vncport:VNC的端口，这里我使用了5901端口</p>\n<p>–cdrom:虚拟光驱挂载的镜像路径，这里接上安装镜像的路径</p>\n<p>回车后，安装过程就开始了，可以使用VNC工具去连接相应的端口进行安装了。如果忘记加–vnclisten=0.0.0.0，可以通过virsh edit mini-win7去编辑配置文件，将graphics中的配置更改如下：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">graphics</span> <span class=\"attr\">type</span>=<span class=\"string\">'vnc'</span> <span class=\"attr\">port</span>=<span class=\"string\">'5901'</span> <span class=\"attr\">autoport</span>=<span class=\"string\">'no'</span> <span class=\"attr\">listen</span>=<span class=\"string\">'0.0.0.0'</span>&gt;</span>       </span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">listen</span> <span class=\"attr\">type</span>=<span class=\"string\">'address'</span> <span class=\"attr\">address</span>=<span class=\"string\">'0.0.0.0'</span>/&gt;</span>        </span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">graphics</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>使用VNC连接上之后就是很普通的安装过程了。</p>\n","site":{"data":{}},"excerpt":"<p>书接上回，上次我们在Ubuntu上安装好了KVM软件，并且使用图形化的virt-manager来创建了一台windows虚拟机，这次我们使用KVM的命令行工具来安装一台windows虚拟机。</p>","more":"<h4 id=\"步骤1：准备操作系统镜像\"><a href=\"#步骤1：准备操作系统镜像\" class=\"headerlink\" title=\"步骤1：准备操作系统镜像\"></a>步骤1：准备操作系统镜像</h4><p>这里我使用的是老毛子精简版windows7镜像，整个镜像大小1.6G左右。</p>\n<p><img src=\"/blogimg/win7_iso.png\" alt=\"image\"></p>\n<h4 id=\"步骤2：在宿主机上创建响应目录\"><a href=\"#步骤2：在宿主机上创建响应目录\" class=\"headerlink\" title=\"步骤2：在宿主机上创建响应目录\"></a>步骤2：在宿主机上创建响应目录</h4><p>接下来需要在宿主机上创建用来存放虚拟机安装镜像和虚拟机镜像的目录。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">root@ubuntu-kvm:/# tree kvm_images/</span><br><span class=\"line\">kvm_images/</span><br><span class=\"line\">├── guest_os</span><br><span class=\"line\">│   └── mini_win7.img</span><br><span class=\"line\">└── iso</span><br><span class=\"line\">    └── 23403_GRMCULXFRER_ZH-CN_MICRO_v2.iso</span><br><span class=\"line\"></span><br><span class=\"line\">2 directories, 2 files</span><br></pre></td></tr></table></figure>\n<p>这是我的目录结构。接下来将系统安装镜像传到宿主机中。</p>\n<h4 id=\"步骤3：命令行安装\"><a href=\"#步骤3：命令行安装\" class=\"headerlink\" title=\"步骤3：命令行安装\"></a>步骤3：命令行安装</h4><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">root@ubuntu-kvm:/kvm_images/iso# virt-install --name mini-win7 -hvm --ram 1024 --vcpus 1 --disk path=/kvm_images/guest_os/mini_win7.img,size=10 --network network:default --accelerate --vnc --vncport=5901 --vnclisten=0.0.0.0 --cdrom /kvm_images/iso/23403_GRMCULXFRER_ZH-CN_MICRO_v2.iso -d</span><br></pre></td></tr></table></figure>\n<p>部分参数解释：</p>\n<p>–name:创建的虚拟机名称</p>\n<p>-hvm：完全虚拟机</p>\n<p>–ram:虚拟机内存大小，单位M,这里我给了1G</p>\n<p>–vcpus:虚拟机cpu个数，我这里给了一个核</p>\n<p>–disk path:虚拟机虚拟硬盘的存放目录，我放在了/kvm_images/guest_os/mini_win7.img，size为硬盘大小，我给了10G</p>\n<p>–network:虚拟机的网络连接方式，这里我使用的default，即NAT方式</p>\n<p>–vnc:远程连接方式使用VNC</p>\n<p>–vnclisten:vnc监听地址，这里使用0.0.0.0，即监听所有接口，默认监听127.0.0.1，所以外部不能直接访问到。</p>\n<p>–vncport:VNC的端口，这里我使用了5901端口</p>\n<p>–cdrom:虚拟光驱挂载的镜像路径，这里接上安装镜像的路径</p>\n<p>回车后，安装过程就开始了，可以使用VNC工具去连接相应的端口进行安装了。如果忘记加–vnclisten=0.0.0.0，可以通过virsh edit mini-win7去编辑配置文件，将graphics中的配置更改如下：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">graphics</span> <span class=\"attr\">type</span>=<span class=\"string\">'vnc'</span> <span class=\"attr\">port</span>=<span class=\"string\">'5901'</span> <span class=\"attr\">autoport</span>=<span class=\"string\">'no'</span> <span class=\"attr\">listen</span>=<span class=\"string\">'0.0.0.0'</span>&gt;</span>       </span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">listen</span> <span class=\"attr\">type</span>=<span class=\"string\">'address'</span> <span class=\"attr\">address</span>=<span class=\"string\">'0.0.0.0'</span>/&gt;</span>        </span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">graphics</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>使用VNC连接上之后就是很普通的安装过程了。</p>"},{"title":"iPXE启动Windows PE","date":"2018-03-14T02:16:54.000Z","_content":"\n接上回，上次我们已经实现了iPXE服务的搭建和自动安装centos 7。那这次来尝试启动一下Windows PE。iPXE官网上的启动boot.wim的方式可以作为参考，但是默认的纯粹的PE只有个cmd窗口，显然不堪大用，最好是使用一个支持网络的PE,那么从网络启动之后，还可以上上网，多么舒服。\n\n<!--more-->\n\n于是我找到了无忧论坛上一位大佬制作的win10 pe，自带网络功能和网络启动功能，我仔细一看，他用的还是TinyPXE server，正好这个网络启动软件也支持iPXE，于是乎就可以直接拿来用了嘛。\n\nhttp://bbs.wuyou.net/forum.php?mod=viewthread&tid=378234  ，于是乎我花了一晚上从百度网盘将该PE的iso下载回来，然后把该iso内的全部文件都弄到树莓派的/var/www/winpe目录下。\n\n```shell\npi@raspberrypi:/var/www/html/winpe $ ls -la\n总用量 1484\ndrwxr-xr-x 5 root root   4096 3月  14 09:55 .\ndrwxr-xr-x 5 root root   4096 3月  14 09:51 ..\ndr-xr-xr-x 4 root root   4096 3月  14 09:58 boot\n-r--r--r-- 1 root root 397858 10月  7 17:34 bootmgr\n-r--r--r-- 1 root root 648088 10月  7 17:09 bootmgr.exe\n-r--r--r-- 1 root root    490 2月  18  2016 config.ini\ndr-xr-xr-x 4 root root   4096 3月  14 09:32 efi\n-r--r--r-- 1 root root 332583 10月  7 17:28 ipxe.pxe\n-r--r--r-- 1 root root    555 9月  13  2015 pxeautorun.txt\n-r--r--r-- 1 root root  25358 9月  29 21:37 pxeboot.n12\n-r--r--r-- 1 root root  67227 10月  7 17:28 undionly.kpxe\ndr-xr-xr-x 2 root root   4096 3月  14 09:32 wifidriver\n-r--r--r-- 1 root root   1903 3月  22  2017 网启说明.txt\n\n```\n\n接下来照猫画虎，更改一下咱们自己的menu菜单\n\n```config\n#!ipxe\n    set menu-timeout 20000\n    set munu-default winpe\n    set protocal:string http\n    isset ${ip} || dhcp\n:start\n    menu iPXE Boot Menu --${ip}\n    item  winpe         Boot WindowsPE\n    item centos7        Boot CentOS 7.4\n    item ubuntu         Boot Ubuntu 17.10\n    item shell          Boot iPXE Shell\n    choose --timeout ${menu-timeout} --default ${menu-default} selected\n    goto ${selected}\n:centos7\n    #set base http://mirrors.aliyun.com/centos/7.4.1708/os/x86_64\n    set base http://192.168.2.189/centos/7/x86_64\n    kernel ${base}/images/pxeboot/vmlinuz initrd=initrd.img ks=http://192.168.2.189/ks.cfg repo=${base}\n    initrd ${base}/images/pxeboot/initrd.img\n    boot\n:winpe\n    set base http://192.168.2.189/winpe\n    kernel ${base}/boot/wimboot gui || goto retry\n    initrd ${base}/pxeautorun.txt ${next-server}.cmd || goto nextg\n    :nextg\n    initrd ${base}/boot/boot.sdi   boot.sdi  || goto retry\n    iseq ${platform} pcbios || goto winefi\n    initrd ${base}/bootmgr.exe bootmgr.exe || goto retry\n    initrd ${base}/boot/bxe bxd || goto retry\n    initrd ${base}/boot/PE64.WIM  boot.WIM  || goto retry\n    boot || goto retry\n    goto start\n:winefi\n    set base http://192.168.2.189/winpe\n    initrd ${base}/EFI/Boot/bootx64.efi || goto retry\n    initrd ${base}/boot/bcd  || goto retry\n    initrd ${base}/boot/PE64.WIM || goto retry\n    boot || goto retry\n    goto start\n:ubuntu\n    set base http://192.168.2.189/ubuntu/\n    kernel ${base}/install/netboot/ubuntu-installer/amd64/linux ks=http://192.168.2.189/ks_ubuntu.cfg\n    initrd ${base}/install/netboot/ubuntu-installer/amd64/initrd.gz\n    boot\n```\n\n嗯，就这样了，再创建一台虚拟机来启动一下试试看效果。\n\n![image](/blogimg/ipxe_winpe.gif)\n\n由于我的网络环境是百兆，加载500多M的wim需要一段时间，如果是千兆环境就更快了。启动成功，看起来效果不错。难道说我还要去学习一下如果制作PE么，这又要入坑了。\n\n最后还是要感谢制作该PE镜像的大佬，你的PE还是蛮好使的。","source":"_posts/iPXE-WinPE.md","raw":"---\ntitle: iPXE启动Windows PE\ncategories:\n  - Linux\ntags:\n  - iPXE winpe\ndate: 2018-03-14 10:16:54\n---\n\n接上回，上次我们已经实现了iPXE服务的搭建和自动安装centos 7。那这次来尝试启动一下Windows PE。iPXE官网上的启动boot.wim的方式可以作为参考，但是默认的纯粹的PE只有个cmd窗口，显然不堪大用，最好是使用一个支持网络的PE,那么从网络启动之后，还可以上上网，多么舒服。\n\n<!--more-->\n\n于是我找到了无忧论坛上一位大佬制作的win10 pe，自带网络功能和网络启动功能，我仔细一看，他用的还是TinyPXE server，正好这个网络启动软件也支持iPXE，于是乎就可以直接拿来用了嘛。\n\nhttp://bbs.wuyou.net/forum.php?mod=viewthread&tid=378234  ，于是乎我花了一晚上从百度网盘将该PE的iso下载回来，然后把该iso内的全部文件都弄到树莓派的/var/www/winpe目录下。\n\n```shell\npi@raspberrypi:/var/www/html/winpe $ ls -la\n总用量 1484\ndrwxr-xr-x 5 root root   4096 3月  14 09:55 .\ndrwxr-xr-x 5 root root   4096 3月  14 09:51 ..\ndr-xr-xr-x 4 root root   4096 3月  14 09:58 boot\n-r--r--r-- 1 root root 397858 10月  7 17:34 bootmgr\n-r--r--r-- 1 root root 648088 10月  7 17:09 bootmgr.exe\n-r--r--r-- 1 root root    490 2月  18  2016 config.ini\ndr-xr-xr-x 4 root root   4096 3月  14 09:32 efi\n-r--r--r-- 1 root root 332583 10月  7 17:28 ipxe.pxe\n-r--r--r-- 1 root root    555 9月  13  2015 pxeautorun.txt\n-r--r--r-- 1 root root  25358 9月  29 21:37 pxeboot.n12\n-r--r--r-- 1 root root  67227 10月  7 17:28 undionly.kpxe\ndr-xr-xr-x 2 root root   4096 3月  14 09:32 wifidriver\n-r--r--r-- 1 root root   1903 3月  22  2017 网启说明.txt\n\n```\n\n接下来照猫画虎，更改一下咱们自己的menu菜单\n\n```config\n#!ipxe\n    set menu-timeout 20000\n    set munu-default winpe\n    set protocal:string http\n    isset ${ip} || dhcp\n:start\n    menu iPXE Boot Menu --${ip}\n    item  winpe         Boot WindowsPE\n    item centos7        Boot CentOS 7.4\n    item ubuntu         Boot Ubuntu 17.10\n    item shell          Boot iPXE Shell\n    choose --timeout ${menu-timeout} --default ${menu-default} selected\n    goto ${selected}\n:centos7\n    #set base http://mirrors.aliyun.com/centos/7.4.1708/os/x86_64\n    set base http://192.168.2.189/centos/7/x86_64\n    kernel ${base}/images/pxeboot/vmlinuz initrd=initrd.img ks=http://192.168.2.189/ks.cfg repo=${base}\n    initrd ${base}/images/pxeboot/initrd.img\n    boot\n:winpe\n    set base http://192.168.2.189/winpe\n    kernel ${base}/boot/wimboot gui || goto retry\n    initrd ${base}/pxeautorun.txt ${next-server}.cmd || goto nextg\n    :nextg\n    initrd ${base}/boot/boot.sdi   boot.sdi  || goto retry\n    iseq ${platform} pcbios || goto winefi\n    initrd ${base}/bootmgr.exe bootmgr.exe || goto retry\n    initrd ${base}/boot/bxe bxd || goto retry\n    initrd ${base}/boot/PE64.WIM  boot.WIM  || goto retry\n    boot || goto retry\n    goto start\n:winefi\n    set base http://192.168.2.189/winpe\n    initrd ${base}/EFI/Boot/bootx64.efi || goto retry\n    initrd ${base}/boot/bcd  || goto retry\n    initrd ${base}/boot/PE64.WIM || goto retry\n    boot || goto retry\n    goto start\n:ubuntu\n    set base http://192.168.2.189/ubuntu/\n    kernel ${base}/install/netboot/ubuntu-installer/amd64/linux ks=http://192.168.2.189/ks_ubuntu.cfg\n    initrd ${base}/install/netboot/ubuntu-installer/amd64/initrd.gz\n    boot\n```\n\n嗯，就这样了，再创建一台虚拟机来启动一下试试看效果。\n\n![image](/blogimg/ipxe_winpe.gif)\n\n由于我的网络环境是百兆，加载500多M的wim需要一段时间，如果是千兆环境就更快了。启动成功，看起来效果不错。难道说我还要去学习一下如果制作PE么，这又要入坑了。\n\n最后还是要感谢制作该PE镜像的大佬，你的PE还是蛮好使的。","slug":"iPXE-WinPE","published":1,"updated":"2018-03-14T03:28:51.711Z","_id":"cjeqig1pc004elgqawejz9ob1","comments":1,"layout":"post","photos":[],"link":"","content":"<p>接上回，上次我们已经实现了iPXE服务的搭建和自动安装centos 7。那这次来尝试启动一下Windows PE。iPXE官网上的启动boot.wim的方式可以作为参考，但是默认的纯粹的PE只有个cmd窗口，显然不堪大用，最好是使用一个支持网络的PE,那么从网络启动之后，还可以上上网，多么舒服。</p>\n<a id=\"more\"></a>\n<p>于是我找到了无忧论坛上一位大佬制作的win10 pe，自带网络功能和网络启动功能，我仔细一看，他用的还是TinyPXE server，正好这个网络启动软件也支持iPXE，于是乎就可以直接拿来用了嘛。</p>\n<p><a href=\"http://bbs.wuyou.net/forum.php?mod=viewthread&amp;tid=378234\" target=\"_blank\" rel=\"noopener\">http://bbs.wuyou.net/forum.php?mod=viewthread&amp;tid=378234</a>  ，于是乎我花了一晚上从百度网盘将该PE的iso下载回来，然后把该iso内的全部文件都弄到树莓派的/var/www/winpe目录下。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pi@raspberrypi:/var/www/html/winpe $ ls -la</span><br><span class=\"line\">总用量 1484</span><br><span class=\"line\">drwxr-xr-x 5 root root   4096 3月  14 09:55 .</span><br><span class=\"line\">drwxr-xr-x 5 root root   4096 3月  14 09:51 ..</span><br><span class=\"line\">dr-xr-xr-x 4 root root   4096 3月  14 09:58 boot</span><br><span class=\"line\">-r--r--r-- 1 root root 397858 10月  7 17:34 bootmgr</span><br><span class=\"line\">-r--r--r-- 1 root root 648088 10月  7 17:09 bootmgr.exe</span><br><span class=\"line\">-r--r--r-- 1 root root    490 2月  18  2016 config.ini</span><br><span class=\"line\">dr-xr-xr-x 4 root root   4096 3月  14 09:32 efi</span><br><span class=\"line\">-r--r--r-- 1 root root 332583 10月  7 17:28 ipxe.pxe</span><br><span class=\"line\">-r--r--r-- 1 root root    555 9月  13  2015 pxeautorun.txt</span><br><span class=\"line\">-r--r--r-- 1 root root  25358 9月  29 21:37 pxeboot.n12</span><br><span class=\"line\">-r--r--r-- 1 root root  67227 10月  7 17:28 undionly.kpxe</span><br><span class=\"line\">dr-xr-xr-x 2 root root   4096 3月  14 09:32 wifidriver</span><br><span class=\"line\">-r--r--r-- 1 root root   1903 3月  22  2017 网启说明.txt</span><br></pre></td></tr></table></figure>\n<p>接下来照猫画虎，更改一下咱们自己的menu菜单</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#!ipxe</span><br><span class=\"line\">    set menu-timeout 20000</span><br><span class=\"line\">    set munu-default winpe</span><br><span class=\"line\">    set protocal:string http</span><br><span class=\"line\">    isset $&#123;ip&#125; || dhcp</span><br><span class=\"line\">:start</span><br><span class=\"line\">    menu iPXE Boot Menu --$&#123;ip&#125;</span><br><span class=\"line\">    item  winpe         Boot WindowsPE</span><br><span class=\"line\">    item centos7        Boot CentOS 7.4</span><br><span class=\"line\">    item ubuntu         Boot Ubuntu 17.10</span><br><span class=\"line\">    item shell          Boot iPXE Shell</span><br><span class=\"line\">    choose --timeout $&#123;menu-timeout&#125; --default $&#123;menu-default&#125; selected</span><br><span class=\"line\">    goto $&#123;selected&#125;</span><br><span class=\"line\">:centos7</span><br><span class=\"line\">    #set base http://mirrors.aliyun.com/centos/7.4.1708/os/x86_64</span><br><span class=\"line\">    set base http://192.168.2.189/centos/7/x86_64</span><br><span class=\"line\">    kernel $&#123;base&#125;/images/pxeboot/vmlinuz initrd=initrd.img ks=http://192.168.2.189/ks.cfg repo=$&#123;base&#125;</span><br><span class=\"line\">    initrd $&#123;base&#125;/images/pxeboot/initrd.img</span><br><span class=\"line\">    boot</span><br><span class=\"line\">:winpe</span><br><span class=\"line\">    set base http://192.168.2.189/winpe</span><br><span class=\"line\">    kernel $&#123;base&#125;/boot/wimboot gui || goto retry</span><br><span class=\"line\">    initrd $&#123;base&#125;/pxeautorun.txt $&#123;next-server&#125;.cmd || goto nextg</span><br><span class=\"line\">    :nextg</span><br><span class=\"line\">    initrd $&#123;base&#125;/boot/boot.sdi   boot.sdi  || goto retry</span><br><span class=\"line\">    iseq $&#123;platform&#125; pcbios || goto winefi</span><br><span class=\"line\">    initrd $&#123;base&#125;/bootmgr.exe bootmgr.exe || goto retry</span><br><span class=\"line\">    initrd $&#123;base&#125;/boot/bxe bxd || goto retry</span><br><span class=\"line\">    initrd $&#123;base&#125;/boot/PE64.WIM  boot.WIM  || goto retry</span><br><span class=\"line\">    boot || goto retry</span><br><span class=\"line\">    goto start</span><br><span class=\"line\">:winefi</span><br><span class=\"line\">    set base http://192.168.2.189/winpe</span><br><span class=\"line\">    initrd $&#123;base&#125;/EFI/Boot/bootx64.efi || goto retry</span><br><span class=\"line\">    initrd $&#123;base&#125;/boot/bcd  || goto retry</span><br><span class=\"line\">    initrd $&#123;base&#125;/boot/PE64.WIM || goto retry</span><br><span class=\"line\">    boot || goto retry</span><br><span class=\"line\">    goto start</span><br><span class=\"line\">:ubuntu</span><br><span class=\"line\">    set base http://192.168.2.189/ubuntu/</span><br><span class=\"line\">    kernel $&#123;base&#125;/install/netboot/ubuntu-installer/amd64/linux ks=http://192.168.2.189/ks_ubuntu.cfg</span><br><span class=\"line\">    initrd $&#123;base&#125;/install/netboot/ubuntu-installer/amd64/initrd.gz</span><br><span class=\"line\">    boot</span><br></pre></td></tr></table></figure>\n<p>嗯，就这样了，再创建一台虚拟机来启动一下试试看效果。</p>\n<p><img src=\"/blogimg/ipxe_winpe.gif\" alt=\"image\"></p>\n<p>由于我的网络环境是百兆，加载500多M的wim需要一段时间，如果是千兆环境就更快了。启动成功，看起来效果不错。难道说我还要去学习一下如果制作PE么，这又要入坑了。</p>\n<p>最后还是要感谢制作该PE镜像的大佬，你的PE还是蛮好使的。</p>\n","site":{"data":{}},"excerpt":"<p>接上回，上次我们已经实现了iPXE服务的搭建和自动安装centos 7。那这次来尝试启动一下Windows PE。iPXE官网上的启动boot.wim的方式可以作为参考，但是默认的纯粹的PE只有个cmd窗口，显然不堪大用，最好是使用一个支持网络的PE,那么从网络启动之后，还可以上上网，多么舒服。</p>","more":"<p>于是我找到了无忧论坛上一位大佬制作的win10 pe，自带网络功能和网络启动功能，我仔细一看，他用的还是TinyPXE server，正好这个网络启动软件也支持iPXE，于是乎就可以直接拿来用了嘛。</p>\n<p><a href=\"http://bbs.wuyou.net/forum.php?mod=viewthread&amp;tid=378234\" target=\"_blank\" rel=\"noopener\">http://bbs.wuyou.net/forum.php?mod=viewthread&amp;tid=378234</a>  ，于是乎我花了一晚上从百度网盘将该PE的iso下载回来，然后把该iso内的全部文件都弄到树莓派的/var/www/winpe目录下。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pi@raspberrypi:/var/www/html/winpe $ ls -la</span><br><span class=\"line\">总用量 1484</span><br><span class=\"line\">drwxr-xr-x 5 root root   4096 3月  14 09:55 .</span><br><span class=\"line\">drwxr-xr-x 5 root root   4096 3月  14 09:51 ..</span><br><span class=\"line\">dr-xr-xr-x 4 root root   4096 3月  14 09:58 boot</span><br><span class=\"line\">-r--r--r-- 1 root root 397858 10月  7 17:34 bootmgr</span><br><span class=\"line\">-r--r--r-- 1 root root 648088 10月  7 17:09 bootmgr.exe</span><br><span class=\"line\">-r--r--r-- 1 root root    490 2月  18  2016 config.ini</span><br><span class=\"line\">dr-xr-xr-x 4 root root   4096 3月  14 09:32 efi</span><br><span class=\"line\">-r--r--r-- 1 root root 332583 10月  7 17:28 ipxe.pxe</span><br><span class=\"line\">-r--r--r-- 1 root root    555 9月  13  2015 pxeautorun.txt</span><br><span class=\"line\">-r--r--r-- 1 root root  25358 9月  29 21:37 pxeboot.n12</span><br><span class=\"line\">-r--r--r-- 1 root root  67227 10月  7 17:28 undionly.kpxe</span><br><span class=\"line\">dr-xr-xr-x 2 root root   4096 3月  14 09:32 wifidriver</span><br><span class=\"line\">-r--r--r-- 1 root root   1903 3月  22  2017 网启说明.txt</span><br></pre></td></tr></table></figure>\n<p>接下来照猫画虎，更改一下咱们自己的menu菜单</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#!ipxe</span><br><span class=\"line\">    set menu-timeout 20000</span><br><span class=\"line\">    set munu-default winpe</span><br><span class=\"line\">    set protocal:string http</span><br><span class=\"line\">    isset $&#123;ip&#125; || dhcp</span><br><span class=\"line\">:start</span><br><span class=\"line\">    menu iPXE Boot Menu --$&#123;ip&#125;</span><br><span class=\"line\">    item  winpe         Boot WindowsPE</span><br><span class=\"line\">    item centos7        Boot CentOS 7.4</span><br><span class=\"line\">    item ubuntu         Boot Ubuntu 17.10</span><br><span class=\"line\">    item shell          Boot iPXE Shell</span><br><span class=\"line\">    choose --timeout $&#123;menu-timeout&#125; --default $&#123;menu-default&#125; selected</span><br><span class=\"line\">    goto $&#123;selected&#125;</span><br><span class=\"line\">:centos7</span><br><span class=\"line\">    #set base http://mirrors.aliyun.com/centos/7.4.1708/os/x86_64</span><br><span class=\"line\">    set base http://192.168.2.189/centos/7/x86_64</span><br><span class=\"line\">    kernel $&#123;base&#125;/images/pxeboot/vmlinuz initrd=initrd.img ks=http://192.168.2.189/ks.cfg repo=$&#123;base&#125;</span><br><span class=\"line\">    initrd $&#123;base&#125;/images/pxeboot/initrd.img</span><br><span class=\"line\">    boot</span><br><span class=\"line\">:winpe</span><br><span class=\"line\">    set base http://192.168.2.189/winpe</span><br><span class=\"line\">    kernel $&#123;base&#125;/boot/wimboot gui || goto retry</span><br><span class=\"line\">    initrd $&#123;base&#125;/pxeautorun.txt $&#123;next-server&#125;.cmd || goto nextg</span><br><span class=\"line\">    :nextg</span><br><span class=\"line\">    initrd $&#123;base&#125;/boot/boot.sdi   boot.sdi  || goto retry</span><br><span class=\"line\">    iseq $&#123;platform&#125; pcbios || goto winefi</span><br><span class=\"line\">    initrd $&#123;base&#125;/bootmgr.exe bootmgr.exe || goto retry</span><br><span class=\"line\">    initrd $&#123;base&#125;/boot/bxe bxd || goto retry</span><br><span class=\"line\">    initrd $&#123;base&#125;/boot/PE64.WIM  boot.WIM  || goto retry</span><br><span class=\"line\">    boot || goto retry</span><br><span class=\"line\">    goto start</span><br><span class=\"line\">:winefi</span><br><span class=\"line\">    set base http://192.168.2.189/winpe</span><br><span class=\"line\">    initrd $&#123;base&#125;/EFI/Boot/bootx64.efi || goto retry</span><br><span class=\"line\">    initrd $&#123;base&#125;/boot/bcd  || goto retry</span><br><span class=\"line\">    initrd $&#123;base&#125;/boot/PE64.WIM || goto retry</span><br><span class=\"line\">    boot || goto retry</span><br><span class=\"line\">    goto start</span><br><span class=\"line\">:ubuntu</span><br><span class=\"line\">    set base http://192.168.2.189/ubuntu/</span><br><span class=\"line\">    kernel $&#123;base&#125;/install/netboot/ubuntu-installer/amd64/linux ks=http://192.168.2.189/ks_ubuntu.cfg</span><br><span class=\"line\">    initrd $&#123;base&#125;/install/netboot/ubuntu-installer/amd64/initrd.gz</span><br><span class=\"line\">    boot</span><br></pre></td></tr></table></figure>\n<p>嗯，就这样了，再创建一台虚拟机来启动一下试试看效果。</p>\n<p><img src=\"/blogimg/ipxe_winpe.gif\" alt=\"image\"></p>\n<p>由于我的网络环境是百兆，加载500多M的wim需要一段时间，如果是千兆环境就更快了。启动成功，看起来效果不错。难道说我还要去学习一下如果制作PE么，这又要入坑了。</p>\n<p>最后还是要感谢制作该PE镜像的大佬，你的PE还是蛮好使的。</p>"},{"title":"win10+python2.7  安装pcapy","date":"2017-12-04T07:33:21.000Z","_content":"\n1.首先需要安装vcforpython\n\n<!--more-->\n\nhttps://download.microsoft.com/download/7/9/6/796EF2E4-801B-4FC4-AB28-B59FBF6D907B/VCForPython27.msi\n\n2.设置注册表\n\nhttp://blog.csdn.net/donger_soft/article/details/44838109\n\n3.下载winpcap开发包\n\nhttp://www.winpcap.org/install/bin/WpdPack_4_1_2.zip\n\n4.解压winpcap开发包到vc的对应包含目录\n\n父目录：C:\\Users\\用户名\\AppData\\Local\\Programs\\Common\\Microsoft\\Visual C++ for Python\\9.0\\VC\n\n对应的lib，include\n\n5.pip install pcapy或者下载pcapy到本地解压，执行python setup.py install","source":"_posts/install-pcapy.md","raw":"---\ntitle: win10+python2.7  安装pcapy\ncategories:\n  - Program\ntags:\n  - python\ndate: 2017-12-04 15:33:21\n---\n\n1.首先需要安装vcforpython\n\n<!--more-->\n\nhttps://download.microsoft.com/download/7/9/6/796EF2E4-801B-4FC4-AB28-B59FBF6D907B/VCForPython27.msi\n\n2.设置注册表\n\nhttp://blog.csdn.net/donger_soft/article/details/44838109\n\n3.下载winpcap开发包\n\nhttp://www.winpcap.org/install/bin/WpdPack_4_1_2.zip\n\n4.解压winpcap开发包到vc的对应包含目录\n\n父目录：C:\\Users\\用户名\\AppData\\Local\\Programs\\Common\\Microsoft\\Visual C++ for Python\\9.0\\VC\n\n对应的lib，include\n\n5.pip install pcapy或者下载pcapy到本地解压，执行python setup.py install","slug":"install-pcapy","published":1,"updated":"2017-12-04T07:35:56.627Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjeqig1pg004hlgqaknleyz48","content":"<p>1.首先需要安装vcforpython</p>\n<a id=\"more\"></a>\n<p><a href=\"https://download.microsoft.com/download/7/9/6/796EF2E4-801B-4FC4-AB28-B59FBF6D907B/VCForPython27.msi\" target=\"_blank\" rel=\"noopener\">https://download.microsoft.com/download/7/9/6/796EF2E4-801B-4FC4-AB28-B59FBF6D907B/VCForPython27.msi</a></p>\n<p>2.设置注册表</p>\n<p><a href=\"http://blog.csdn.net/donger_soft/article/details/44838109\" target=\"_blank\" rel=\"noopener\">http://blog.csdn.net/donger_soft/article/details/44838109</a></p>\n<p>3.下载winpcap开发包</p>\n<p><a href=\"http://www.winpcap.org/install/bin/WpdPack_4_1_2.zip\" target=\"_blank\" rel=\"noopener\">http://www.winpcap.org/install/bin/WpdPack_4_1_2.zip</a></p>\n<p>4.解压winpcap开发包到vc的对应包含目录</p>\n<p>父目录：C:\\Users\\用户名\\AppData\\Local\\Programs\\Common\\Microsoft\\Visual C++ for Python\\9.0\\VC</p>\n<p>对应的lib，include</p>\n<p>5.pip install pcapy或者下载pcapy到本地解压，执行python setup.py install</p>\n","site":{"data":{}},"excerpt":"<p>1.首先需要安装vcforpython</p>","more":"<p><a href=\"https://download.microsoft.com/download/7/9/6/796EF2E4-801B-4FC4-AB28-B59FBF6D907B/VCForPython27.msi\" target=\"_blank\" rel=\"noopener\">https://download.microsoft.com/download/7/9/6/796EF2E4-801B-4FC4-AB28-B59FBF6D907B/VCForPython27.msi</a></p>\n<p>2.设置注册表</p>\n<p><a href=\"http://blog.csdn.net/donger_soft/article/details/44838109\" target=\"_blank\" rel=\"noopener\">http://blog.csdn.net/donger_soft/article/details/44838109</a></p>\n<p>3.下载winpcap开发包</p>\n<p><a href=\"http://www.winpcap.org/install/bin/WpdPack_4_1_2.zip\" target=\"_blank\" rel=\"noopener\">http://www.winpcap.org/install/bin/WpdPack_4_1_2.zip</a></p>\n<p>4.解压winpcap开发包到vc的对应包含目录</p>\n<p>父目录：C:\\Users\\用户名\\AppData\\Local\\Programs\\Common\\Microsoft\\Visual C++ for Python\\9.0\\VC</p>\n<p>对应的lib，include</p>\n<p>5.pip install pcapy或者下载pcapy到本地解压，执行python setup.py install</p>"},{"title":"配置nginx，防止ip被恶意绑定域名","date":"2016-12-14T20:53:41.000Z","toc":"true 文章目录","author":null,"comments":1,"original":null,"_content":"### 0x1 事情起因  \n偶然在百度上搜索了一下我这个博客的域名，发现百度有个快照是另外一个不相干的域名解析到我现在用的这个ip上了。这样子好像有点不科学嘛，还是把不属于本站域名的访问给禁用掉好了。\n<!-- more -->\n###  0x2 解决方案  \n最简单粗暴的办法就是给域名不匹配的请求返回一个错误代码就可以了，或者委婉的一点，把请求重定向到目前所使用的域名上。我选择了前者。\n### 0x3 配置文件具体内容  \n```\nserver {\n        listen       80;\n        listen       [::]:80 default_server;\n        server_name  blog.star-chen.com;\n        root         /var/blog;\n\n        # Load configuration files for the default server block.\n        include /etc/nginx/default.d/*.conf;\n\tif ($host !~ \".*star-chen.com\"){\n\t\treturn 500;\n\t}\n        location / {\n        }\n\n        error_page 404 /404.html;\n            location = /40x.html {\n        }\n\n        error_page 500 502 503 504 /50x.html;\n            location = /50x.html {\n        }\n    }\n\n```\n简单粗暴，有效果！","source":"_posts/nginx-diable-domain.md","raw":"---\ntitle: 配置nginx，防止ip被恶意绑定域名\ndate: 2016-12-15 04:53:41\ncategories:\n- Linux\ntags:\n- nginx\n- domain\ntoc: true 文章目录\nauthor:\ncomments:\noriginal:\npermalink:\n---\n### 0x1 事情起因  \n偶然在百度上搜索了一下我这个博客的域名，发现百度有个快照是另外一个不相干的域名解析到我现在用的这个ip上了。这样子好像有点不科学嘛，还是把不属于本站域名的访问给禁用掉好了。\n<!-- more -->\n###  0x2 解决方案  \n最简单粗暴的办法就是给域名不匹配的请求返回一个错误代码就可以了，或者委婉的一点，把请求重定向到目前所使用的域名上。我选择了前者。\n### 0x3 配置文件具体内容  \n```\nserver {\n        listen       80;\n        listen       [::]:80 default_server;\n        server_name  blog.star-chen.com;\n        root         /var/blog;\n\n        # Load configuration files for the default server block.\n        include /etc/nginx/default.d/*.conf;\n\tif ($host !~ \".*star-chen.com\"){\n\t\treturn 500;\n\t}\n        location / {\n        }\n\n        error_page 404 /404.html;\n            location = /40x.html {\n        }\n\n        error_page 500 502 503 504 /50x.html;\n            location = /50x.html {\n        }\n    }\n\n```\n简单粗暴，有效果！","slug":"nginx-diable-domain","published":1,"updated":"2017-12-04T07:27:28.764Z","layout":"post","photos":[],"link":"","_id":"cjeqig1pl004klgqa3clo1d3a","content":"<h3 id=\"0x1-事情起因\"><a href=\"#0x1-事情起因\" class=\"headerlink\" title=\"0x1 事情起因\"></a>0x1 事情起因</h3><p>偶然在百度上搜索了一下我这个博客的域名，发现百度有个快照是另外一个不相干的域名解析到我现在用的这个ip上了。这样子好像有点不科学嘛，还是把不属于本站域名的访问给禁用掉好了。<br><a id=\"more\"></a></p>\n<h3 id=\"0x2-解决方案\"><a href=\"#0x2-解决方案\" class=\"headerlink\" title=\"0x2 解决方案\"></a>0x2 解决方案</h3><p>最简单粗暴的办法就是给域名不匹配的请求返回一个错误代码就可以了，或者委婉的一点，把请求重定向到目前所使用的域名上。我选择了前者。</p>\n<h3 id=\"0x3-配置文件具体内容\"><a href=\"#0x3-配置文件具体内容\" class=\"headerlink\" title=\"0x3 配置文件具体内容\"></a>0x3 配置文件具体内容</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server &#123;</span><br><span class=\"line\">        listen       80;</span><br><span class=\"line\">        listen       [::]:80 default_server;</span><br><span class=\"line\">        server_name  blog.star-chen.com;</span><br><span class=\"line\">        root         /var/blog;</span><br><span class=\"line\"></span><br><span class=\"line\">        # Load configuration files for the default server block.</span><br><span class=\"line\">        include /etc/nginx/default.d/*.conf;</span><br><span class=\"line\">\tif ($host !~ &quot;.*star-chen.com&quot;)&#123;</span><br><span class=\"line\">\t\treturn 500;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">        location / &#123;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        error_page 404 /404.html;</span><br><span class=\"line\">            location = /40x.html &#123;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        error_page 500 502 503 504 /50x.html;</span><br><span class=\"line\">            location = /50x.html &#123;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<p>简单粗暴，有效果！</p>\n","site":{"data":{}},"excerpt":"<h3 id=\"0x1-事情起因\"><a href=\"#0x1-事情起因\" class=\"headerlink\" title=\"0x1 事情起因\"></a>0x1 事情起因</h3><p>偶然在百度上搜索了一下我这个博客的域名，发现百度有个快照是另外一个不相干的域名解析到我现在用的这个ip上了。这样子好像有点不科学嘛，还是把不属于本站域名的访问给禁用掉好了。<br>","more":"</p>\n<h3 id=\"0x2-解决方案\"><a href=\"#0x2-解决方案\" class=\"headerlink\" title=\"0x2 解决方案\"></a>0x2 解决方案</h3><p>最简单粗暴的办法就是给域名不匹配的请求返回一个错误代码就可以了，或者委婉的一点，把请求重定向到目前所使用的域名上。我选择了前者。</p>\n<h3 id=\"0x3-配置文件具体内容\"><a href=\"#0x3-配置文件具体内容\" class=\"headerlink\" title=\"0x3 配置文件具体内容\"></a>0x3 配置文件具体内容</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server &#123;</span><br><span class=\"line\">        listen       80;</span><br><span class=\"line\">        listen       [::]:80 default_server;</span><br><span class=\"line\">        server_name  blog.star-chen.com;</span><br><span class=\"line\">        root         /var/blog;</span><br><span class=\"line\"></span><br><span class=\"line\">        # Load configuration files for the default server block.</span><br><span class=\"line\">        include /etc/nginx/default.d/*.conf;</span><br><span class=\"line\">\tif ($host !~ &quot;.*star-chen.com&quot;)&#123;</span><br><span class=\"line\">\t\treturn 500;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">        location / &#123;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        error_page 404 /404.html;</span><br><span class=\"line\">            location = /40x.html &#123;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        error_page 500 502 503 504 /50x.html;</span><br><span class=\"line\">            location = /50x.html &#123;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<p>简单粗暴，有效果！</p>"},{"title":"Nginx location的匹配规则","date":"2017-12-13T08:44:23.000Z","_content":"\n​      今天有个群里的老兄提了个问题，具体就是他配置的nginx不能正常访问静态文件，引起前端未能正确加载js，css等文件。我一看，这问题简单呀，nginx配个location就可以了的。然而自己之前没有实际动手配置过，中途还闹出了笑话，此处是一个悲伤脸。\n\n<!--more-->\n\n   从这个坑里边我有学到点关于nginx配置的知识。\n\n#### location 匹配规则\n\n~      #波浪线表示执行一个正则匹配，区分大小写\n~*    #表示执行一个正则匹配，不区分大小写\n^~    #^~表示普通字符匹配，如果该选项匹配，只匹配该选项，不匹配别的选项，一般用来匹配目录\n=      #进行普通字符精确匹配\n@     #\"@\" 定义一个命名的 location，使用在内部定向时，例如 error_page, try_files\n\n#### location匹配的优先级\n\n= 精确匹配会第一个被处理。如果发现精确匹配，nginx停止搜索其他匹配。\n普通字符匹配，正则表达式规则和长的块规则将被优先和查询匹配，也就是说如果该项匹配还需去看有没有正则表达式匹配和更长的匹配。\n^~ 则只匹配该规则，nginx停止搜索其他匹配，否则nginx会继续处理其他location指令。\n最后匹配理带有\"~\"和\"~*\"的指令，如果找到相应的匹配，则nginx停止搜索其他匹配；当没有正则表达式或者没有正则表达式被匹配的情况下，那么匹配程度最高的逐字匹配指令会被使用。\n\n\n\n再贴个配置的例子：\n\n```conf\nlocation  = / {\n  # 只匹配\"/\".\n  [ configuration A ] \n}\nlocation  / {\n  # 匹配任何请求，因为所有请求都是以\"/\"开始\n  # 但是更长字符匹配或者正则表达式匹配会优先匹配\n  [ configuration B ] \n}\nlocation ^~ /images/ {\n  # 匹配任何以 /images/ 开始的请求，并停止匹配 其它location\n  [ configuration C ] \n}\nlocation ~* .(gif|jpg|jpeg)$ {\n  # 匹配以 gif, jpg, or jpeg结尾的请求. \n  # 但是所有 /images/ 目录的请求将由 [Configuration C]处理.   \n  [ configuration D ] \n}\n```\n\n我踩到的坑是location之后的目录会被添加到root配置的目录之后去查找，如果未找到会返回404。举个例子：\n\n```conf\nlocation /static/ {\n  root /var/www/html/;\n}\n```\n\n访问 `http://xxx.com/static/js/a.js` ,nginx查找的路径是/var/www/html/static/js/a.js。\n\n至于这个location的用处嘛，既可以用来处理静态资源，也可以在里边配置反代，获取其他资源。\n\n参考链接：\n\nhttp://www.nginx.cn/115.html","source":"_posts/nginx-location-rule.md","raw":"---\ntitle: Nginx location的匹配规则\ncategories:\n  - Linux\ntags:\n  - nginx\ndate: 2017-12-13 16:44:23\n---\n\n​      今天有个群里的老兄提了个问题，具体就是他配置的nginx不能正常访问静态文件，引起前端未能正确加载js，css等文件。我一看，这问题简单呀，nginx配个location就可以了的。然而自己之前没有实际动手配置过，中途还闹出了笑话，此处是一个悲伤脸。\n\n<!--more-->\n\n   从这个坑里边我有学到点关于nginx配置的知识。\n\n#### location 匹配规则\n\n~      #波浪线表示执行一个正则匹配，区分大小写\n~*    #表示执行一个正则匹配，不区分大小写\n^~    #^~表示普通字符匹配，如果该选项匹配，只匹配该选项，不匹配别的选项，一般用来匹配目录\n=      #进行普通字符精确匹配\n@     #\"@\" 定义一个命名的 location，使用在内部定向时，例如 error_page, try_files\n\n#### location匹配的优先级\n\n= 精确匹配会第一个被处理。如果发现精确匹配，nginx停止搜索其他匹配。\n普通字符匹配，正则表达式规则和长的块规则将被优先和查询匹配，也就是说如果该项匹配还需去看有没有正则表达式匹配和更长的匹配。\n^~ 则只匹配该规则，nginx停止搜索其他匹配，否则nginx会继续处理其他location指令。\n最后匹配理带有\"~\"和\"~*\"的指令，如果找到相应的匹配，则nginx停止搜索其他匹配；当没有正则表达式或者没有正则表达式被匹配的情况下，那么匹配程度最高的逐字匹配指令会被使用。\n\n\n\n再贴个配置的例子：\n\n```conf\nlocation  = / {\n  # 只匹配\"/\".\n  [ configuration A ] \n}\nlocation  / {\n  # 匹配任何请求，因为所有请求都是以\"/\"开始\n  # 但是更长字符匹配或者正则表达式匹配会优先匹配\n  [ configuration B ] \n}\nlocation ^~ /images/ {\n  # 匹配任何以 /images/ 开始的请求，并停止匹配 其它location\n  [ configuration C ] \n}\nlocation ~* .(gif|jpg|jpeg)$ {\n  # 匹配以 gif, jpg, or jpeg结尾的请求. \n  # 但是所有 /images/ 目录的请求将由 [Configuration C]处理.   \n  [ configuration D ] \n}\n```\n\n我踩到的坑是location之后的目录会被添加到root配置的目录之后去查找，如果未找到会返回404。举个例子：\n\n```conf\nlocation /static/ {\n  root /var/www/html/;\n}\n```\n\n访问 `http://xxx.com/static/js/a.js` ,nginx查找的路径是/var/www/html/static/js/a.js。\n\n至于这个location的用处嘛，既可以用来处理静态资源，也可以在里边配置反代，获取其他资源。\n\n参考链接：\n\nhttp://www.nginx.cn/115.html","slug":"nginx-location-rule","published":1,"updated":"2017-12-13T09:03:15.079Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjeqig1pr004olgqabajpimku","content":"<p>​      今天有个群里的老兄提了个问题，具体就是他配置的nginx不能正常访问静态文件，引起前端未能正确加载js，css等文件。我一看，这问题简单呀，nginx配个location就可以了的。然而自己之前没有实际动手配置过，中途还闹出了笑话，此处是一个悲伤脸。</p>\n<a id=\"more\"></a>\n<p>   从这个坑里边我有学到点关于nginx配置的知识。</p>\n<h4 id=\"location-匹配规则\"><a href=\"#location-匹配规则\" class=\"headerlink\" title=\"location 匹配规则\"></a>location 匹配规则</h4><p>~      #波浪线表示执行一个正则匹配，区分大小写<br>~*    #表示执行一个正则匹配，不区分大小写<br>^~    #^~表示普通字符匹配，如果该选项匹配，只匹配该选项，不匹配别的选项，一般用来匹配目录<br>=      #进行普通字符精确匹配<br>@     #”@” 定义一个命名的 location，使用在内部定向时，例如 error_page, try_files</p>\n<h4 id=\"location匹配的优先级\"><a href=\"#location匹配的优先级\" class=\"headerlink\" title=\"location匹配的优先级\"></a>location匹配的优先级</h4><p>= 精确匹配会第一个被处理。如果发现精确匹配，nginx停止搜索其他匹配。<br>普通字符匹配，正则表达式规则和长的块规则将被优先和查询匹配，也就是说如果该项匹配还需去看有没有正则表达式匹配和更长的匹配。<br>^~ 则只匹配该规则，nginx停止搜索其他匹配，否则nginx会继续处理其他location指令。<br>最后匹配理带有”~”和”~*”的指令，如果找到相应的匹配，则nginx停止搜索其他匹配；当没有正则表达式或者没有正则表达式被匹配的情况下，那么匹配程度最高的逐字匹配指令会被使用。</p>\n<p>再贴个配置的例子：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">location  = / &#123;</span><br><span class=\"line\">  # 只匹配&quot;/&quot;.</span><br><span class=\"line\">  [ configuration A ] </span><br><span class=\"line\">&#125;</span><br><span class=\"line\">location  / &#123;</span><br><span class=\"line\">  # 匹配任何请求，因为所有请求都是以&quot;/&quot;开始</span><br><span class=\"line\">  # 但是更长字符匹配或者正则表达式匹配会优先匹配</span><br><span class=\"line\">  [ configuration B ] </span><br><span class=\"line\">&#125;</span><br><span class=\"line\">location ^~ /images/ &#123;</span><br><span class=\"line\">  # 匹配任何以 /images/ 开始的请求，并停止匹配 其它location</span><br><span class=\"line\">  [ configuration C ] </span><br><span class=\"line\">&#125;</span><br><span class=\"line\">location ~* .(gif|jpg|jpeg)$ &#123;</span><br><span class=\"line\">  # 匹配以 gif, jpg, or jpeg结尾的请求. </span><br><span class=\"line\">  # 但是所有 /images/ 目录的请求将由 [Configuration C]处理.   </span><br><span class=\"line\">  [ configuration D ] </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>我踩到的坑是location之后的目录会被添加到root配置的目录之后去查找，如果未找到会返回404。举个例子：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">location /static/ &#123;</span><br><span class=\"line\">  root /var/www/html/;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>访问 <code>http://xxx.com/static/js/a.js</code> ,nginx查找的路径是/var/www/html/static/js/a.js。</p>\n<p>至于这个location的用处嘛，既可以用来处理静态资源，也可以在里边配置反代，获取其他资源。</p>\n<p>参考链接：</p>\n<p><a href=\"http://www.nginx.cn/115.html\" target=\"_blank\" rel=\"noopener\">http://www.nginx.cn/115.html</a></p>\n","site":{"data":{}},"excerpt":"<p>​      今天有个群里的老兄提了个问题，具体就是他配置的nginx不能正常访问静态文件，引起前端未能正确加载js，css等文件。我一看，这问题简单呀，nginx配个location就可以了的。然而自己之前没有实际动手配置过，中途还闹出了笑话，此处是一个悲伤脸。</p>","more":"<p>   从这个坑里边我有学到点关于nginx配置的知识。</p>\n<h4 id=\"location-匹配规则\"><a href=\"#location-匹配规则\" class=\"headerlink\" title=\"location 匹配规则\"></a>location 匹配规则</h4><p>~      #波浪线表示执行一个正则匹配，区分大小写<br>~*    #表示执行一个正则匹配，不区分大小写<br>^~    #^~表示普通字符匹配，如果该选项匹配，只匹配该选项，不匹配别的选项，一般用来匹配目录<br>=      #进行普通字符精确匹配<br>@     #”@” 定义一个命名的 location，使用在内部定向时，例如 error_page, try_files</p>\n<h4 id=\"location匹配的优先级\"><a href=\"#location匹配的优先级\" class=\"headerlink\" title=\"location匹配的优先级\"></a>location匹配的优先级</h4><p>= 精确匹配会第一个被处理。如果发现精确匹配，nginx停止搜索其他匹配。<br>普通字符匹配，正则表达式规则和长的块规则将被优先和查询匹配，也就是说如果该项匹配还需去看有没有正则表达式匹配和更长的匹配。<br>^~ 则只匹配该规则，nginx停止搜索其他匹配，否则nginx会继续处理其他location指令。<br>最后匹配理带有”~”和”~*”的指令，如果找到相应的匹配，则nginx停止搜索其他匹配；当没有正则表达式或者没有正则表达式被匹配的情况下，那么匹配程度最高的逐字匹配指令会被使用。</p>\n<p>再贴个配置的例子：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">location  = / &#123;</span><br><span class=\"line\">  # 只匹配&quot;/&quot;.</span><br><span class=\"line\">  [ configuration A ] </span><br><span class=\"line\">&#125;</span><br><span class=\"line\">location  / &#123;</span><br><span class=\"line\">  # 匹配任何请求，因为所有请求都是以&quot;/&quot;开始</span><br><span class=\"line\">  # 但是更长字符匹配或者正则表达式匹配会优先匹配</span><br><span class=\"line\">  [ configuration B ] </span><br><span class=\"line\">&#125;</span><br><span class=\"line\">location ^~ /images/ &#123;</span><br><span class=\"line\">  # 匹配任何以 /images/ 开始的请求，并停止匹配 其它location</span><br><span class=\"line\">  [ configuration C ] </span><br><span class=\"line\">&#125;</span><br><span class=\"line\">location ~* .(gif|jpg|jpeg)$ &#123;</span><br><span class=\"line\">  # 匹配以 gif, jpg, or jpeg结尾的请求. </span><br><span class=\"line\">  # 但是所有 /images/ 目录的请求将由 [Configuration C]处理.   </span><br><span class=\"line\">  [ configuration D ] </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>我踩到的坑是location之后的目录会被添加到root配置的目录之后去查找，如果未找到会返回404。举个例子：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">location /static/ &#123;</span><br><span class=\"line\">  root /var/www/html/;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>访问 <code>http://xxx.com/static/js/a.js</code> ,nginx查找的路径是/var/www/html/static/js/a.js。</p>\n<p>至于这个location的用处嘛，既可以用来处理静态资源，也可以在里边配置反代，获取其他资源。</p>\n<p>参考链接：</p>\n<p><a href=\"http://www.nginx.cn/115.html\" target=\"_blank\" rel=\"noopener\">http://www.nginx.cn/115.html</a></p>"},{"title":"python学习笔记之------元类","date":"2017-12-04T08:34:30.000Z","_content":"\n\"元类（Meta Class）\",即用于创建类的类。那我们先来看看python中的类是个啥东西。\n\n<!--more-->\n\n```python\n>>> class this_is_a_class(object):\n...     pass\n...\n>>> a_object = this_is_a_class()\n>>> print a_object\n<__main__.this_is_a_class object at 0x105a11a90>\n>>> type(a_object)\n<class '__main__.this_is_a_class'>\n>>> type(this_is_a_class)\n<type 'type'>\n>>> print this_is_a_class\n<class '__main__.this_is_a_class'>\n>>>\n```\n\n可以看出来，类其实也是个对象。那么这个对象能不能动态的改变呢？我们来试试看\n\n```python\n>>> this_is_a_class.func = func\n>>> this_is_a_class.attr = 'attr'\n>>> object_b = this_is_a_class()\n>>> object_b.attr\n'attr'\n>>> object_b.func()\nfunc\n>>>\n```\n\n哇，是不是很神奇？我们直接给类赋值属性和方法，然后用这个类得到的实例也都具有了这些属性和方法。那么更近一步，我们可不可以自由的生成一个类呢？答案的肯定的，那么该如何创建一个类呢？看代码：\n\n```python\n>>> class_name = \"CreateTest\"\n>>> class_parents = (object,)\n>>> class_body=\"\"\"\n... def __init__(self, x):\n...     self.x = x\n... def say_hello(self):\n...     print \"hello,guys!\"\n... \"\"\"\n>>> class_dict = {}\n>>> exec(class_body, globals(), class_dict)\n>>> CreateTest = type(class_name, class_parents, class_dict)\n>>> object_a = CreateTest(4)\n>>> object_a.x\n4\n>>> object_a.say_hello()\nhello,guys!\n```\n\n是不是感觉很奇怪，我们使用type居然自己创造了一个类，而且还给这个类赋予了属性和方法。那很显然，type就是python中掌管类的创建的类，它也就是个元类。\n\n那么问题来了，我们可不可以创建自己的元类呢？答案也是肯定的，还是来看代码：\n\n```python\nclass MetaClass(type):\n  def __new__(self, name, bases, attr):\n      attrs = ((name, value) for name, value in attr.items() if not name.startswith('__'))\n      uppercase_attr = dict((name.upper(), value) for name, value in attrs)\n      def say_hello(cls):\n        print 'hello guys!'\n      t = type.__new__(self, name, bases, uppercase_attr)\n      t.say_hello = say_hello\n      return t\n  \nclass MetaTest(object):\n  __metaclass__ = MetaClass\n  bar = 'attrs'\n  \nobject_1 = MetaTest()\nobject_1.say_hello()\nprint object_1.BAR\nprint object_1.bar\n```\n\n运行测试结果：\n\n```shell\nhello guys!\nattrs\n\nTraceback (most recent call last):\n  File \"E:\\Study\\PythonPractice\\meta_two.py\", line 18, in <module>\n    print object_1.bar\nAttributeError: 'MetaTest' object has no attribute 'bar'\n```\n\n通过这个例子可以看出，我们可以使用元类对类的创建进行类似hook的操作，为新创建的类添加新的属性或者更改它现有的属性，这使得我们站在了上帝的角度可以管理类的创建行为。\n\n注意事项：\n\n\\__metaclass\\__的查找顺序是首先在当前文件查找全局变量\\__metaclass__，如果没找到会在父类寻找该属性父类都找不到的话，会从模块的层次去查找，还找不到的话就是用默认的type作为元类来创建对象。\n\n\n\n\n\n部分参考资料：\n\n《python参考手册》\n\nhttp://blog.jobbole.com/21351/\n\nhttps://stackoverflow.com/questions/100003/what-is-a-metaclass-in-python","source":"_posts/python-metaclass.md","raw":"---\ntitle: python学习笔记之------元类\ncategories:\n  - Program\ntags:\n  - python\ndate: 2017-12-04 16:34:30\n---\n\n\"元类（Meta Class）\",即用于创建类的类。那我们先来看看python中的类是个啥东西。\n\n<!--more-->\n\n```python\n>>> class this_is_a_class(object):\n...     pass\n...\n>>> a_object = this_is_a_class()\n>>> print a_object\n<__main__.this_is_a_class object at 0x105a11a90>\n>>> type(a_object)\n<class '__main__.this_is_a_class'>\n>>> type(this_is_a_class)\n<type 'type'>\n>>> print this_is_a_class\n<class '__main__.this_is_a_class'>\n>>>\n```\n\n可以看出来，类其实也是个对象。那么这个对象能不能动态的改变呢？我们来试试看\n\n```python\n>>> this_is_a_class.func = func\n>>> this_is_a_class.attr = 'attr'\n>>> object_b = this_is_a_class()\n>>> object_b.attr\n'attr'\n>>> object_b.func()\nfunc\n>>>\n```\n\n哇，是不是很神奇？我们直接给类赋值属性和方法，然后用这个类得到的实例也都具有了这些属性和方法。那么更近一步，我们可不可以自由的生成一个类呢？答案的肯定的，那么该如何创建一个类呢？看代码：\n\n```python\n>>> class_name = \"CreateTest\"\n>>> class_parents = (object,)\n>>> class_body=\"\"\"\n... def __init__(self, x):\n...     self.x = x\n... def say_hello(self):\n...     print \"hello,guys!\"\n... \"\"\"\n>>> class_dict = {}\n>>> exec(class_body, globals(), class_dict)\n>>> CreateTest = type(class_name, class_parents, class_dict)\n>>> object_a = CreateTest(4)\n>>> object_a.x\n4\n>>> object_a.say_hello()\nhello,guys!\n```\n\n是不是感觉很奇怪，我们使用type居然自己创造了一个类，而且还给这个类赋予了属性和方法。那很显然，type就是python中掌管类的创建的类，它也就是个元类。\n\n那么问题来了，我们可不可以创建自己的元类呢？答案也是肯定的，还是来看代码：\n\n```python\nclass MetaClass(type):\n  def __new__(self, name, bases, attr):\n      attrs = ((name, value) for name, value in attr.items() if not name.startswith('__'))\n      uppercase_attr = dict((name.upper(), value) for name, value in attrs)\n      def say_hello(cls):\n        print 'hello guys!'\n      t = type.__new__(self, name, bases, uppercase_attr)\n      t.say_hello = say_hello\n      return t\n  \nclass MetaTest(object):\n  __metaclass__ = MetaClass\n  bar = 'attrs'\n  \nobject_1 = MetaTest()\nobject_1.say_hello()\nprint object_1.BAR\nprint object_1.bar\n```\n\n运行测试结果：\n\n```shell\nhello guys!\nattrs\n\nTraceback (most recent call last):\n  File \"E:\\Study\\PythonPractice\\meta_two.py\", line 18, in <module>\n    print object_1.bar\nAttributeError: 'MetaTest' object has no attribute 'bar'\n```\n\n通过这个例子可以看出，我们可以使用元类对类的创建进行类似hook的操作，为新创建的类添加新的属性或者更改它现有的属性，这使得我们站在了上帝的角度可以管理类的创建行为。\n\n注意事项：\n\n\\__metaclass\\__的查找顺序是首先在当前文件查找全局变量\\__metaclass__，如果没找到会在父类寻找该属性父类都找不到的话，会从模块的层次去查找，还找不到的话就是用默认的type作为元类来创建对象。\n\n\n\n\n\n部分参考资料：\n\n《python参考手册》\n\nhttp://blog.jobbole.com/21351/\n\nhttps://stackoverflow.com/questions/100003/what-is-a-metaclass-in-python","slug":"python-metaclass","published":1,"updated":"2017-12-05T02:11:45.311Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjeqig1pu004rlgqa9q4a96sp","content":"<p>“元类（Meta Class）”,即用于创建类的类。那我们先来看看python中的类是个啥东西。</p>\n<a id=\"more\"></a>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">this_is_a_class</span><span class=\"params\">(object)</span>:</span></span><br><span class=\"line\"><span class=\"meta\">... </span>    <span class=\"keyword\">pass</span></span><br><span class=\"line\">...</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>a_object = this_is_a_class()</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span><span class=\"keyword\">print</span> a_object</span><br><span class=\"line\">&lt;__main__.this_is_a_class object at <span class=\"number\">0x105a11a90</span>&gt;</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>type(a_object)</span><br><span class=\"line\">&lt;<span class=\"class\"><span class=\"keyword\">class</span> '<span class=\"title\">__main__</span>.<span class=\"title\">this_is_a_class</span>'&gt;</span></span><br><span class=\"line\"><span class=\"class\">&gt;&gt;&gt; <span class=\"title\">type</span><span class=\"params\">(this_is_a_class)</span></span></span><br><span class=\"line\"><span class=\"class\">&lt;<span class=\"title\">type</span> '<span class=\"title\">type</span>'&gt;</span></span><br><span class=\"line\"><span class=\"class\">&gt;&gt;&gt; <span class=\"title\">print</span> <span class=\"title\">this_is_a_class</span></span></span><br><span class=\"line\"><span class=\"class\">&lt;<span class=\"title\">class</span> '<span class=\"title\">__main__</span>.<span class=\"title\">this_is_a_class</span>'&gt;</span></span><br><span class=\"line\"><span class=\"class\">&gt;&gt;&gt;</span></span><br></pre></td></tr></table></figure>\n<p>可以看出来，类其实也是个对象。那么这个对象能不能动态的改变呢？我们来试试看</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>this_is_a_class.func = func</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>this_is_a_class.attr = <span class=\"string\">'attr'</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>object_b = this_is_a_class()</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>object_b.attr</span><br><span class=\"line\"><span class=\"string\">'attr'</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>object_b.func()</span><br><span class=\"line\">func</span><br><span class=\"line\">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>\n<p>哇，是不是很神奇？我们直接给类赋值属性和方法，然后用这个类得到的实例也都具有了这些属性和方法。那么更近一步，我们可不可以自由的生成一个类呢？答案的肯定的，那么该如何创建一个类呢？看代码：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>class_name = <span class=\"string\">\"CreateTest\"</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>class_parents = (object,)</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>class_body=<span class=\"string\">\"\"\"</span></span><br><span class=\"line\"><span class=\"string\"><span class=\"meta\">... </span>def __init__(self, x):</span></span><br><span class=\"line\"><span class=\"string\"><span class=\"meta\">... </span>    self.x = x</span></span><br><span class=\"line\"><span class=\"string\"><span class=\"meta\">... </span>def say_hello(self):</span></span><br><span class=\"line\"><span class=\"string\"><span class=\"meta\">... </span>    print \"hello,guys!\"</span></span><br><span class=\"line\"><span class=\"string\"><span class=\"meta\">... </span>\"\"\"</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>class_dict = &#123;&#125;</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>exec(class_body, globals(), class_dict)</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>CreateTest = type(class_name, class_parents, class_dict)</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>object_a = CreateTest(<span class=\"number\">4</span>)</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>object_a.x</span><br><span class=\"line\"><span class=\"number\">4</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>object_a.say_hello()</span><br><span class=\"line\">hello,guys!</span><br></pre></td></tr></table></figure>\n<p>是不是感觉很奇怪，我们使用type居然自己创造了一个类，而且还给这个类赋予了属性和方法。那很显然，type就是python中掌管类的创建的类，它也就是个元类。</p>\n<p>那么问题来了，我们可不可以创建自己的元类呢？答案也是肯定的，还是来看代码：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MetaClass</span><span class=\"params\">(type)</span>:</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__new__</span><span class=\"params\">(self, name, bases, attr)</span>:</span></span><br><span class=\"line\">      attrs = ((name, value) <span class=\"keyword\">for</span> name, value <span class=\"keyword\">in</span> attr.items() <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> name.startswith(<span class=\"string\">'__'</span>))</span><br><span class=\"line\">      uppercase_attr = dict((name.upper(), value) <span class=\"keyword\">for</span> name, value <span class=\"keyword\">in</span> attrs)</span><br><span class=\"line\">      <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">say_hello</span><span class=\"params\">(cls)</span>:</span></span><br><span class=\"line\">        <span class=\"keyword\">print</span> <span class=\"string\">'hello guys!'</span></span><br><span class=\"line\">      t = type.__new__(self, name, bases, uppercase_attr)</span><br><span class=\"line\">      t.say_hello = say_hello</span><br><span class=\"line\">      <span class=\"keyword\">return</span> t</span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MetaTest</span><span class=\"params\">(object)</span>:</span></span><br><span class=\"line\">  __metaclass__ = MetaClass</span><br><span class=\"line\">  bar = <span class=\"string\">'attrs'</span></span><br><span class=\"line\">  </span><br><span class=\"line\">object_1 = MetaTest()</span><br><span class=\"line\">object_1.say_hello()</span><br><span class=\"line\"><span class=\"keyword\">print</span> object_1.BAR</span><br><span class=\"line\"><span class=\"keyword\">print</span> object_1.bar</span><br></pre></td></tr></table></figure>\n<p>运行测试结果：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hello guys!</span><br><span class=\"line\">attrs</span><br><span class=\"line\"></span><br><span class=\"line\">Traceback (most recent call last):</span><br><span class=\"line\">  File \"E:\\Study\\PythonPractice\\meta_two.py\", line 18, in &lt;module&gt;</span><br><span class=\"line\">    print object_1.bar</span><br><span class=\"line\">AttributeError: 'MetaTest' object has no attribute 'bar'</span><br></pre></td></tr></table></figure>\n<p>通过这个例子可以看出，我们可以使用元类对类的创建进行类似hook的操作，为新创建的类添加新的属性或者更改它现有的属性，这使得我们站在了上帝的角度可以管理类的创建行为。</p>\n<p>注意事项：</p>\n<p>__metaclass__的查找顺序是首先在当前文件查找全局变量__metaclass__，如果没找到会在父类寻找该属性父类都找不到的话，会从模块的层次去查找，还找不到的话就是用默认的type作为元类来创建对象。</p>\n<p>部分参考资料：</p>\n<p>《python参考手册》</p>\n<p><a href=\"http://blog.jobbole.com/21351/\" target=\"_blank\" rel=\"noopener\">http://blog.jobbole.com/21351/</a></p>\n<p><a href=\"https://stackoverflow.com/questions/100003/what-is-a-metaclass-in-python\" target=\"_blank\" rel=\"noopener\">https://stackoverflow.com/questions/100003/what-is-a-metaclass-in-python</a></p>\n","site":{"data":{}},"excerpt":"<p>“元类（Meta Class）”,即用于创建类的类。那我们先来看看python中的类是个啥东西。</p>","more":"<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">this_is_a_class</span><span class=\"params\">(object)</span>:</span></span><br><span class=\"line\"><span class=\"meta\">... </span>    <span class=\"keyword\">pass</span></span><br><span class=\"line\">...</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>a_object = this_is_a_class()</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span><span class=\"keyword\">print</span> a_object</span><br><span class=\"line\">&lt;__main__.this_is_a_class object at <span class=\"number\">0x105a11a90</span>&gt;</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>type(a_object)</span><br><span class=\"line\">&lt;<span class=\"class\"><span class=\"keyword\">class</span> '<span class=\"title\">__main__</span>.<span class=\"title\">this_is_a_class</span>'&gt;</span></span><br><span class=\"line\"><span class=\"class\">&gt;&gt;&gt; <span class=\"title\">type</span><span class=\"params\">(this_is_a_class)</span></span></span><br><span class=\"line\"><span class=\"class\">&lt;<span class=\"title\">type</span> '<span class=\"title\">type</span>'&gt;</span></span><br><span class=\"line\"><span class=\"class\">&gt;&gt;&gt; <span class=\"title\">print</span> <span class=\"title\">this_is_a_class</span></span></span><br><span class=\"line\"><span class=\"class\">&lt;<span class=\"title\">class</span> '<span class=\"title\">__main__</span>.<span class=\"title\">this_is_a_class</span>'&gt;</span></span><br><span class=\"line\"><span class=\"class\">&gt;&gt;&gt;</span></span><br></pre></td></tr></table></figure>\n<p>可以看出来，类其实也是个对象。那么这个对象能不能动态的改变呢？我们来试试看</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>this_is_a_class.func = func</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>this_is_a_class.attr = <span class=\"string\">'attr'</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>object_b = this_is_a_class()</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>object_b.attr</span><br><span class=\"line\"><span class=\"string\">'attr'</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>object_b.func()</span><br><span class=\"line\">func</span><br><span class=\"line\">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>\n<p>哇，是不是很神奇？我们直接给类赋值属性和方法，然后用这个类得到的实例也都具有了这些属性和方法。那么更近一步，我们可不可以自由的生成一个类呢？答案的肯定的，那么该如何创建一个类呢？看代码：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>class_name = <span class=\"string\">\"CreateTest\"</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>class_parents = (object,)</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>class_body=<span class=\"string\">\"\"\"</span></span><br><span class=\"line\"><span class=\"string\"><span class=\"meta\">... </span>def __init__(self, x):</span></span><br><span class=\"line\"><span class=\"string\"><span class=\"meta\">... </span>    self.x = x</span></span><br><span class=\"line\"><span class=\"string\"><span class=\"meta\">... </span>def say_hello(self):</span></span><br><span class=\"line\"><span class=\"string\"><span class=\"meta\">... </span>    print \"hello,guys!\"</span></span><br><span class=\"line\"><span class=\"string\"><span class=\"meta\">... </span>\"\"\"</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>class_dict = &#123;&#125;</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>exec(class_body, globals(), class_dict)</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>CreateTest = type(class_name, class_parents, class_dict)</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>object_a = CreateTest(<span class=\"number\">4</span>)</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>object_a.x</span><br><span class=\"line\"><span class=\"number\">4</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>object_a.say_hello()</span><br><span class=\"line\">hello,guys!</span><br></pre></td></tr></table></figure>\n<p>是不是感觉很奇怪，我们使用type居然自己创造了一个类，而且还给这个类赋予了属性和方法。那很显然，type就是python中掌管类的创建的类，它也就是个元类。</p>\n<p>那么问题来了，我们可不可以创建自己的元类呢？答案也是肯定的，还是来看代码：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MetaClass</span><span class=\"params\">(type)</span>:</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__new__</span><span class=\"params\">(self, name, bases, attr)</span>:</span></span><br><span class=\"line\">      attrs = ((name, value) <span class=\"keyword\">for</span> name, value <span class=\"keyword\">in</span> attr.items() <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> name.startswith(<span class=\"string\">'__'</span>))</span><br><span class=\"line\">      uppercase_attr = dict((name.upper(), value) <span class=\"keyword\">for</span> name, value <span class=\"keyword\">in</span> attrs)</span><br><span class=\"line\">      <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">say_hello</span><span class=\"params\">(cls)</span>:</span></span><br><span class=\"line\">        <span class=\"keyword\">print</span> <span class=\"string\">'hello guys!'</span></span><br><span class=\"line\">      t = type.__new__(self, name, bases, uppercase_attr)</span><br><span class=\"line\">      t.say_hello = say_hello</span><br><span class=\"line\">      <span class=\"keyword\">return</span> t</span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MetaTest</span><span class=\"params\">(object)</span>:</span></span><br><span class=\"line\">  __metaclass__ = MetaClass</span><br><span class=\"line\">  bar = <span class=\"string\">'attrs'</span></span><br><span class=\"line\">  </span><br><span class=\"line\">object_1 = MetaTest()</span><br><span class=\"line\">object_1.say_hello()</span><br><span class=\"line\"><span class=\"keyword\">print</span> object_1.BAR</span><br><span class=\"line\"><span class=\"keyword\">print</span> object_1.bar</span><br></pre></td></tr></table></figure>\n<p>运行测试结果：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hello guys!</span><br><span class=\"line\">attrs</span><br><span class=\"line\"></span><br><span class=\"line\">Traceback (most recent call last):</span><br><span class=\"line\">  File \"E:\\Study\\PythonPractice\\meta_two.py\", line 18, in &lt;module&gt;</span><br><span class=\"line\">    print object_1.bar</span><br><span class=\"line\">AttributeError: 'MetaTest' object has no attribute 'bar'</span><br></pre></td></tr></table></figure>\n<p>通过这个例子可以看出，我们可以使用元类对类的创建进行类似hook的操作，为新创建的类添加新的属性或者更改它现有的属性，这使得我们站在了上帝的角度可以管理类的创建行为。</p>\n<p>注意事项：</p>\n<p>__metaclass__的查找顺序是首先在当前文件查找全局变量__metaclass__，如果没找到会在父类寻找该属性父类都找不到的话，会从模块的层次去查找，还找不到的话就是用默认的type作为元类来创建对象。</p>\n<p>部分参考资料：</p>\n<p>《python参考手册》</p>\n<p><a href=\"http://blog.jobbole.com/21351/\" target=\"_blank\" rel=\"noopener\">http://blog.jobbole.com/21351/</a></p>\n<p><a href=\"https://stackoverflow.com/questions/100003/what-is-a-metaclass-in-python\" target=\"_blank\" rel=\"noopener\">https://stackoverflow.com/questions/100003/what-is-a-metaclass-in-python</a></p>"},{"title":"python-**kwargs的用法","date":"2017-10-12T04:55:27.000Z","_content":"\n### Python中的**kwargs的用法\n\n**kwargs 允许你将不定长度的键值对作为参数传递给一个函数。如果你想要在一个函数里处理带名字的参数，使用\\*\\*kwargs是一个好选择。\n\n<!--more-->\n\n来看个例子感受一下：\n\n```python\n# -*- coding:utf-8 -*-\ndef foo(*args, **kwargs):\n    print 'args = ', args\n    print 'kwargs = ', kwargs\n    print '---------------------------------------'\n\nif __name__ == '__main__':\n    foo(1,2,3,4)\n    foo(a=1,b=2,c=3)\n    foo(1,2,3,4, a=1,b=2,c=3)\n    foo('a', 1, None, a=1, b='2', c=3)\n```\n\n运行结果：\n\n```python\n>>> \n====== RESTART: C:\\Users\\STAR_CHEN\\Documents\\工作记录\\2017.10.12\\kw.py ======\nargs =  (1, 2, 3, 4)\nkwargs =  {}\n---------------------------------------\nargs =  ()\nkwargs =  {'a': 1, 'c': 3, 'b': 2}\n---------------------------------------\nargs =  (1, 2, 3, 4)\nkwargs =  {'a': 1, 'c': 3, 'b': 2}\n---------------------------------------\nargs =  ('a', 1, None)\nkwargs =  {'a': 1, 'c': 3, 'b': '2'}\n---------------------------------------\n```\n\n\\*args带入的参数是一个tuple类型，而\\*\\*kwargs带入的参数是一个dict类型。\n\n\n\n再来看个例子：\n\n```python\ndef test_args_kwargs(arg1, arg2, arg3):\n    print(\"arg1:\", arg1)\n    print(\"arg2:\", arg2)\n    print(\"arg3:\", arg3)\n```\n\n测试结果：\n\n```python\n# 首先使用 *args\n>>> args = (\"two\", 3, 5)\n>>> test_args_kwargs(*args)\narg1: two\narg2: 3\narg3: 5\n\n# 现在使用 **kwargs:\n>>> kwargs = {\"arg3\": 3, \"arg2\": \"two\", \"arg1\": 5}\n>>> test_args_kwargs(**kwargs)\narg1: 5\narg2: two\narg3: 3\n```\n\n用kwargs来传递字典类型的参数，还蛮方便的呢。","source":"_posts/python-kwargs.md","raw":"---\ntitle: python-**kwargs的用法\ncategories:\n  - Program\ntags:\n  - python\ndate: 2017-10-12 12:55:27\n---\n\n### Python中的**kwargs的用法\n\n**kwargs 允许你将不定长度的键值对作为参数传递给一个函数。如果你想要在一个函数里处理带名字的参数，使用\\*\\*kwargs是一个好选择。\n\n<!--more-->\n\n来看个例子感受一下：\n\n```python\n# -*- coding:utf-8 -*-\ndef foo(*args, **kwargs):\n    print 'args = ', args\n    print 'kwargs = ', kwargs\n    print '---------------------------------------'\n\nif __name__ == '__main__':\n    foo(1,2,3,4)\n    foo(a=1,b=2,c=3)\n    foo(1,2,3,4, a=1,b=2,c=3)\n    foo('a', 1, None, a=1, b='2', c=3)\n```\n\n运行结果：\n\n```python\n>>> \n====== RESTART: C:\\Users\\STAR_CHEN\\Documents\\工作记录\\2017.10.12\\kw.py ======\nargs =  (1, 2, 3, 4)\nkwargs =  {}\n---------------------------------------\nargs =  ()\nkwargs =  {'a': 1, 'c': 3, 'b': 2}\n---------------------------------------\nargs =  (1, 2, 3, 4)\nkwargs =  {'a': 1, 'c': 3, 'b': 2}\n---------------------------------------\nargs =  ('a', 1, None)\nkwargs =  {'a': 1, 'c': 3, 'b': '2'}\n---------------------------------------\n```\n\n\\*args带入的参数是一个tuple类型，而\\*\\*kwargs带入的参数是一个dict类型。\n\n\n\n再来看个例子：\n\n```python\ndef test_args_kwargs(arg1, arg2, arg3):\n    print(\"arg1:\", arg1)\n    print(\"arg2:\", arg2)\n    print(\"arg3:\", arg3)\n```\n\n测试结果：\n\n```python\n# 首先使用 *args\n>>> args = (\"two\", 3, 5)\n>>> test_args_kwargs(*args)\narg1: two\narg2: 3\narg3: 5\n\n# 现在使用 **kwargs:\n>>> kwargs = {\"arg3\": 3, \"arg2\": \"two\", \"arg1\": 5}\n>>> test_args_kwargs(**kwargs)\narg1: 5\narg2: two\narg3: 3\n```\n\n用kwargs来传递字典类型的参数，还蛮方便的呢。","slug":"python-kwargs","published":1,"updated":"2017-12-04T07:27:28.764Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjeqig1pw004ulgqadc3wz91g","content":"<h3 id=\"Python中的-kwargs的用法\"><a href=\"#Python中的-kwargs的用法\" class=\"headerlink\" title=\"Python中的**kwargs的用法\"></a>Python中的**kwargs的用法</h3><p><em>*kwargs 允许你将不定长度的键值对作为参数传递给一个函数。如果你想要在一个函数里处理带名字的参数，使用\\</em>*kwargs是一个好选择。</p>\n<a id=\"more\"></a>\n<p>来看个例子感受一下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># -*- coding:utf-8 -*-</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">foo</span><span class=\"params\">(*args, **kwargs)</span>:</span></span><br><span class=\"line\">    <span class=\"keyword\">print</span> <span class=\"string\">'args = '</span>, args</span><br><span class=\"line\">    <span class=\"keyword\">print</span> <span class=\"string\">'kwargs = '</span>, kwargs</span><br><span class=\"line\">    <span class=\"keyword\">print</span> <span class=\"string\">'---------------------------------------'</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">'__main__'</span>:</span><br><span class=\"line\">    foo(<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">4</span>)</span><br><span class=\"line\">    foo(a=<span class=\"number\">1</span>,b=<span class=\"number\">2</span>,c=<span class=\"number\">3</span>)</span><br><span class=\"line\">    foo(<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">4</span>, a=<span class=\"number\">1</span>,b=<span class=\"number\">2</span>,c=<span class=\"number\">3</span>)</span><br><span class=\"line\">    foo(<span class=\"string\">'a'</span>, <span class=\"number\">1</span>, <span class=\"keyword\">None</span>, a=<span class=\"number\">1</span>, b=<span class=\"string\">'2'</span>, c=<span class=\"number\">3</span>)</span><br></pre></td></tr></table></figure>\n<p>运行结果：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span></span><br><span class=\"line\">====== RESTART: C:\\Users\\STAR_CHEN\\Documents\\工作记录\\<span class=\"number\">2017.10</span><span class=\"number\">.12</span>\\kw.py ======</span><br><span class=\"line\">args =  (<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>)</span><br><span class=\"line\">kwargs =  &#123;&#125;</span><br><span class=\"line\">---------------------------------------</span><br><span class=\"line\">args =  ()</span><br><span class=\"line\">kwargs =  &#123;<span class=\"string\">'a'</span>: <span class=\"number\">1</span>, <span class=\"string\">'c'</span>: <span class=\"number\">3</span>, <span class=\"string\">'b'</span>: <span class=\"number\">2</span>&#125;</span><br><span class=\"line\">---------------------------------------</span><br><span class=\"line\">args =  (<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>)</span><br><span class=\"line\">kwargs =  &#123;<span class=\"string\">'a'</span>: <span class=\"number\">1</span>, <span class=\"string\">'c'</span>: <span class=\"number\">3</span>, <span class=\"string\">'b'</span>: <span class=\"number\">2</span>&#125;</span><br><span class=\"line\">---------------------------------------</span><br><span class=\"line\">args =  (<span class=\"string\">'a'</span>, <span class=\"number\">1</span>, <span class=\"keyword\">None</span>)</span><br><span class=\"line\">kwargs =  &#123;<span class=\"string\">'a'</span>: <span class=\"number\">1</span>, <span class=\"string\">'c'</span>: <span class=\"number\">3</span>, <span class=\"string\">'b'</span>: <span class=\"string\">'2'</span>&#125;</span><br><span class=\"line\">---------------------------------------</span><br></pre></td></tr></table></figure>\n<p>*args带入的参数是一个tuple类型，而**kwargs带入的参数是一个dict类型。</p>\n<p>再来看个例子：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">test_args_kwargs</span><span class=\"params\">(arg1, arg2, arg3)</span>:</span></span><br><span class=\"line\">    print(<span class=\"string\">\"arg1:\"</span>, arg1)</span><br><span class=\"line\">    print(<span class=\"string\">\"arg2:\"</span>, arg2)</span><br><span class=\"line\">    print(<span class=\"string\">\"arg3:\"</span>, arg3)</span><br></pre></td></tr></table></figure>\n<p>测试结果：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 首先使用 *args</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>args = (<span class=\"string\">\"two\"</span>, <span class=\"number\">3</span>, <span class=\"number\">5</span>)</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>test_args_kwargs(*args)</span><br><span class=\"line\">arg1: two</span><br><span class=\"line\">arg2: <span class=\"number\">3</span></span><br><span class=\"line\">arg3: <span class=\"number\">5</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 现在使用 **kwargs:</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>kwargs = &#123;<span class=\"string\">\"arg3\"</span>: <span class=\"number\">3</span>, <span class=\"string\">\"arg2\"</span>: <span class=\"string\">\"two\"</span>, <span class=\"string\">\"arg1\"</span>: <span class=\"number\">5</span>&#125;</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>test_args_kwargs(**kwargs)</span><br><span class=\"line\">arg1: <span class=\"number\">5</span></span><br><span class=\"line\">arg2: two</span><br><span class=\"line\">arg3: <span class=\"number\">3</span></span><br></pre></td></tr></table></figure>\n<p>用kwargs来传递字典类型的参数，还蛮方便的呢。</p>\n","site":{"data":{}},"excerpt":"<h3 id=\"Python中的-kwargs的用法\"><a href=\"#Python中的-kwargs的用法\" class=\"headerlink\" title=\"Python中的**kwargs的用法\"></a>Python中的**kwargs的用法</h3><p><em>*kwargs 允许你将不定长度的键值对作为参数传递给一个函数。如果你想要在一个函数里处理带名字的参数，使用\\</em>*kwargs是一个好选择。</p>","more":"<p>来看个例子感受一下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># -*- coding:utf-8 -*-</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">foo</span><span class=\"params\">(*args, **kwargs)</span>:</span></span><br><span class=\"line\">    <span class=\"keyword\">print</span> <span class=\"string\">'args = '</span>, args</span><br><span class=\"line\">    <span class=\"keyword\">print</span> <span class=\"string\">'kwargs = '</span>, kwargs</span><br><span class=\"line\">    <span class=\"keyword\">print</span> <span class=\"string\">'---------------------------------------'</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">'__main__'</span>:</span><br><span class=\"line\">    foo(<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">4</span>)</span><br><span class=\"line\">    foo(a=<span class=\"number\">1</span>,b=<span class=\"number\">2</span>,c=<span class=\"number\">3</span>)</span><br><span class=\"line\">    foo(<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">4</span>, a=<span class=\"number\">1</span>,b=<span class=\"number\">2</span>,c=<span class=\"number\">3</span>)</span><br><span class=\"line\">    foo(<span class=\"string\">'a'</span>, <span class=\"number\">1</span>, <span class=\"keyword\">None</span>, a=<span class=\"number\">1</span>, b=<span class=\"string\">'2'</span>, c=<span class=\"number\">3</span>)</span><br></pre></td></tr></table></figure>\n<p>运行结果：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span></span><br><span class=\"line\">====== RESTART: C:\\Users\\STAR_CHEN\\Documents\\工作记录\\<span class=\"number\">2017.10</span><span class=\"number\">.12</span>\\kw.py ======</span><br><span class=\"line\">args =  (<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>)</span><br><span class=\"line\">kwargs =  &#123;&#125;</span><br><span class=\"line\">---------------------------------------</span><br><span class=\"line\">args =  ()</span><br><span class=\"line\">kwargs =  &#123;<span class=\"string\">'a'</span>: <span class=\"number\">1</span>, <span class=\"string\">'c'</span>: <span class=\"number\">3</span>, <span class=\"string\">'b'</span>: <span class=\"number\">2</span>&#125;</span><br><span class=\"line\">---------------------------------------</span><br><span class=\"line\">args =  (<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>)</span><br><span class=\"line\">kwargs =  &#123;<span class=\"string\">'a'</span>: <span class=\"number\">1</span>, <span class=\"string\">'c'</span>: <span class=\"number\">3</span>, <span class=\"string\">'b'</span>: <span class=\"number\">2</span>&#125;</span><br><span class=\"line\">---------------------------------------</span><br><span class=\"line\">args =  (<span class=\"string\">'a'</span>, <span class=\"number\">1</span>, <span class=\"keyword\">None</span>)</span><br><span class=\"line\">kwargs =  &#123;<span class=\"string\">'a'</span>: <span class=\"number\">1</span>, <span class=\"string\">'c'</span>: <span class=\"number\">3</span>, <span class=\"string\">'b'</span>: <span class=\"string\">'2'</span>&#125;</span><br><span class=\"line\">---------------------------------------</span><br></pre></td></tr></table></figure>\n<p>*args带入的参数是一个tuple类型，而**kwargs带入的参数是一个dict类型。</p>\n<p>再来看个例子：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">test_args_kwargs</span><span class=\"params\">(arg1, arg2, arg3)</span>:</span></span><br><span class=\"line\">    print(<span class=\"string\">\"arg1:\"</span>, arg1)</span><br><span class=\"line\">    print(<span class=\"string\">\"arg2:\"</span>, arg2)</span><br><span class=\"line\">    print(<span class=\"string\">\"arg3:\"</span>, arg3)</span><br></pre></td></tr></table></figure>\n<p>测试结果：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 首先使用 *args</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>args = (<span class=\"string\">\"two\"</span>, <span class=\"number\">3</span>, <span class=\"number\">5</span>)</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>test_args_kwargs(*args)</span><br><span class=\"line\">arg1: two</span><br><span class=\"line\">arg2: <span class=\"number\">3</span></span><br><span class=\"line\">arg3: <span class=\"number\">5</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 现在使用 **kwargs:</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>kwargs = &#123;<span class=\"string\">\"arg3\"</span>: <span class=\"number\">3</span>, <span class=\"string\">\"arg2\"</span>: <span class=\"string\">\"two\"</span>, <span class=\"string\">\"arg1\"</span>: <span class=\"number\">5</span>&#125;</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>test_args_kwargs(**kwargs)</span><br><span class=\"line\">arg1: <span class=\"number\">5</span></span><br><span class=\"line\">arg2: two</span><br><span class=\"line\">arg3: <span class=\"number\">3</span></span><br></pre></td></tr></table></figure>\n<p>用kwargs来传递字典类型的参数，还蛮方便的呢。</p>"},{"title":"Python学习笔记之------atexit模块","date":"2017-11-30T06:57:00.000Z","_content":"\natexit模块用于注册python解释器退出时要执行的函数，这个模块只提供一个函数：\nregister（func, [,args [,kwargs]]）\n解释器退出的时候会按照注册的顺序逆序调用这些函数，如果出现了错误，将一条异常信息打印到标准错误，然后继续执行下一个回调，直到所有的回调都执行完毕后，重新抛出最后接收到的异常。register支持装饰器语法。\n<!--more-->\n这里给出一个例子程序：\n```python\n# -*- coding: utf-8 -*-\n\nimport atexit\n\ndef exit0(*args, **kwargs):\n    print 'exit0'\n    for arg in args:\n        print ' ' * 4, arg\n\n    for item in kwargs.items():\n        print ' ' * 4, item\n\ndef exit1():\n    print 'exit1'\n    raise Exception, 'exit1'\n\ndef exit2():\n    print 'exit2'\n\natexit.register(exit0, *[1, 2, 3], **{\"a\":1, \"b\":2})\natexit.register(exit1)\natexit.register(exit2)\n\n@atexit.register\ndef exit3():\n    print 'exit3'\n\nif __name__ == '__main__':\n    pass\n```\n运行结果：\n```shell\n❯ python atexit_example.py \nexit3\nexit2\nexit1\nError in atexit._run_exitfuncs:\nTraceback (most recent call last):\n  File \"/usr/lib/python2.7/atexit.py\", line 24, in _run_exitfuncs\n    func(*targs, **kargs)\n  File \"atexit_example.py\", line 15, in exit1\n    raise Exception, 'exit1'\nException: exit1\nexit0\n     1\n     2\n     3\n     ('a', 1)\n     ('b', 2)\nError in sys.exitfunc:\nTraceback (most recent call last):\n  File \"/usr/lib/python2.7/atexit.py\", line 24, in _run_exitfuncs\n    func(*targs, **kargs)\n  File \"atexit_example.py\", line 15, in exit1\n    raise Exception, 'exit1'\nException: exit1\n\n```\n参考链接：\nhttps://docs.python.org/2/library/atexit.html\nhttp://python.jobbole.com/81473/","source":"_posts/python-module-atexit.md","raw":"---\ntitle: Python学习笔记之------atexit模块\ncategories:\n  - Program\ntags:\n  - python\ndate: 2017-11-30 14:57:00\n---\n\natexit模块用于注册python解释器退出时要执行的函数，这个模块只提供一个函数：\nregister（func, [,args [,kwargs]]）\n解释器退出的时候会按照注册的顺序逆序调用这些函数，如果出现了错误，将一条异常信息打印到标准错误，然后继续执行下一个回调，直到所有的回调都执行完毕后，重新抛出最后接收到的异常。register支持装饰器语法。\n<!--more-->\n这里给出一个例子程序：\n```python\n# -*- coding: utf-8 -*-\n\nimport atexit\n\ndef exit0(*args, **kwargs):\n    print 'exit0'\n    for arg in args:\n        print ' ' * 4, arg\n\n    for item in kwargs.items():\n        print ' ' * 4, item\n\ndef exit1():\n    print 'exit1'\n    raise Exception, 'exit1'\n\ndef exit2():\n    print 'exit2'\n\natexit.register(exit0, *[1, 2, 3], **{\"a\":1, \"b\":2})\natexit.register(exit1)\natexit.register(exit2)\n\n@atexit.register\ndef exit3():\n    print 'exit3'\n\nif __name__ == '__main__':\n    pass\n```\n运行结果：\n```shell\n❯ python atexit_example.py \nexit3\nexit2\nexit1\nError in atexit._run_exitfuncs:\nTraceback (most recent call last):\n  File \"/usr/lib/python2.7/atexit.py\", line 24, in _run_exitfuncs\n    func(*targs, **kargs)\n  File \"atexit_example.py\", line 15, in exit1\n    raise Exception, 'exit1'\nException: exit1\nexit0\n     1\n     2\n     3\n     ('a', 1)\n     ('b', 2)\nError in sys.exitfunc:\nTraceback (most recent call last):\n  File \"/usr/lib/python2.7/atexit.py\", line 24, in _run_exitfuncs\n    func(*targs, **kargs)\n  File \"atexit_example.py\", line 15, in exit1\n    raise Exception, 'exit1'\nException: exit1\n\n```\n参考链接：\nhttps://docs.python.org/2/library/atexit.html\nhttp://python.jobbole.com/81473/","slug":"python-module-atexit","published":1,"updated":"2017-12-04T07:27:28.764Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjeqig1py004xlgqah94mkfos","content":"<p>atexit模块用于注册python解释器退出时要执行的函数，这个模块只提供一个函数：<br>register（func, [,args [,kwargs]]）<br>解释器退出的时候会按照注册的顺序逆序调用这些函数，如果出现了错误，将一条异常信息打印到标准错误，然后继续执行下一个回调，直到所有的回调都执行完毕后，重新抛出最后接收到的异常。register支持装饰器语法。<br><a id=\"more\"></a><br>这里给出一个例子程序：<br><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># -*- coding: utf-8 -*-</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> atexit</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">exit0</span><span class=\"params\">(*args, **kwargs)</span>:</span></span><br><span class=\"line\">    <span class=\"keyword\">print</span> <span class=\"string\">'exit0'</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> arg <span class=\"keyword\">in</span> args:</span><br><span class=\"line\">        <span class=\"keyword\">print</span> <span class=\"string\">' '</span> * <span class=\"number\">4</span>, arg</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> item <span class=\"keyword\">in</span> kwargs.items():</span><br><span class=\"line\">        <span class=\"keyword\">print</span> <span class=\"string\">' '</span> * <span class=\"number\">4</span>, item</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">exit1</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    <span class=\"keyword\">print</span> <span class=\"string\">'exit1'</span></span><br><span class=\"line\">    <span class=\"keyword\">raise</span> Exception, <span class=\"string\">'exit1'</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">exit2</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    <span class=\"keyword\">print</span> <span class=\"string\">'exit2'</span></span><br><span class=\"line\"></span><br><span class=\"line\">atexit.register(exit0, *[<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>], **&#123;<span class=\"string\">\"a\"</span>:<span class=\"number\">1</span>, <span class=\"string\">\"b\"</span>:<span class=\"number\">2</span>&#125;)</span><br><span class=\"line\">atexit.register(exit1)</span><br><span class=\"line\">atexit.register(exit2)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@atexit.register</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">exit3</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    <span class=\"keyword\">print</span> <span class=\"string\">'exit3'</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">'__main__'</span>:</span><br><span class=\"line\">    <span class=\"keyword\">pass</span></span><br></pre></td></tr></table></figure></p>\n<p>运行结果：<br><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">❯ python atexit_example.py </span><br><span class=\"line\">exit3</span><br><span class=\"line\">exit2</span><br><span class=\"line\">exit1</span><br><span class=\"line\">Error in atexit._run_exitfuncs:</span><br><span class=\"line\">Traceback (most recent call last):</span><br><span class=\"line\">  File \"/usr/lib/python2.7/atexit.py\", line 24, in _run_exitfuncs</span><br><span class=\"line\">    func(*targs, **kargs)</span><br><span class=\"line\">  File \"atexit_example.py\", line 15, in exit1</span><br><span class=\"line\">    raise Exception, 'exit1'</span><br><span class=\"line\">Exception: exit1</span><br><span class=\"line\">exit0</span><br><span class=\"line\">     1</span><br><span class=\"line\">     2</span><br><span class=\"line\">     3</span><br><span class=\"line\">     ('a', 1)</span><br><span class=\"line\">     ('b', 2)</span><br><span class=\"line\">Error in sys.exitfunc:</span><br><span class=\"line\">Traceback (most recent call last):</span><br><span class=\"line\">  File \"/usr/lib/python2.7/atexit.py\", line 24, in _run_exitfuncs</span><br><span class=\"line\">    func(*targs, **kargs)</span><br><span class=\"line\">  File \"atexit_example.py\", line 15, in exit1</span><br><span class=\"line\">    raise Exception, 'exit1'</span><br><span class=\"line\">Exception: exit1</span><br></pre></td></tr></table></figure></p>\n<p>参考链接：<br><a href=\"https://docs.python.org/2/library/atexit.html\" target=\"_blank\" rel=\"noopener\">https://docs.python.org/2/library/atexit.html</a><br><a href=\"http://python.jobbole.com/81473/\" target=\"_blank\" rel=\"noopener\">http://python.jobbole.com/81473/</a></p>\n","site":{"data":{}},"excerpt":"<p>atexit模块用于注册python解释器退出时要执行的函数，这个模块只提供一个函数：<br>register（func, [,args [,kwargs]]）<br>解释器退出的时候会按照注册的顺序逆序调用这些函数，如果出现了错误，将一条异常信息打印到标准错误，然后继续执行下一个回调，直到所有的回调都执行完毕后，重新抛出最后接收到的异常。register支持装饰器语法。<br>","more":"<br>这里给出一个例子程序：<br><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># -*- coding: utf-8 -*-</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> atexit</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">exit0</span><span class=\"params\">(*args, **kwargs)</span>:</span></span><br><span class=\"line\">    <span class=\"keyword\">print</span> <span class=\"string\">'exit0'</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> arg <span class=\"keyword\">in</span> args:</span><br><span class=\"line\">        <span class=\"keyword\">print</span> <span class=\"string\">' '</span> * <span class=\"number\">4</span>, arg</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> item <span class=\"keyword\">in</span> kwargs.items():</span><br><span class=\"line\">        <span class=\"keyword\">print</span> <span class=\"string\">' '</span> * <span class=\"number\">4</span>, item</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">exit1</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    <span class=\"keyword\">print</span> <span class=\"string\">'exit1'</span></span><br><span class=\"line\">    <span class=\"keyword\">raise</span> Exception, <span class=\"string\">'exit1'</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">exit2</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    <span class=\"keyword\">print</span> <span class=\"string\">'exit2'</span></span><br><span class=\"line\"></span><br><span class=\"line\">atexit.register(exit0, *[<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>], **&#123;<span class=\"string\">\"a\"</span>:<span class=\"number\">1</span>, <span class=\"string\">\"b\"</span>:<span class=\"number\">2</span>&#125;)</span><br><span class=\"line\">atexit.register(exit1)</span><br><span class=\"line\">atexit.register(exit2)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@atexit.register</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">exit3</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    <span class=\"keyword\">print</span> <span class=\"string\">'exit3'</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">'__main__'</span>:</span><br><span class=\"line\">    <span class=\"keyword\">pass</span></span><br></pre></td></tr></table></figure></p>\n<p>运行结果：<br><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">❯ python atexit_example.py </span><br><span class=\"line\">exit3</span><br><span class=\"line\">exit2</span><br><span class=\"line\">exit1</span><br><span class=\"line\">Error in atexit._run_exitfuncs:</span><br><span class=\"line\">Traceback (most recent call last):</span><br><span class=\"line\">  File \"/usr/lib/python2.7/atexit.py\", line 24, in _run_exitfuncs</span><br><span class=\"line\">    func(*targs, **kargs)</span><br><span class=\"line\">  File \"atexit_example.py\", line 15, in exit1</span><br><span class=\"line\">    raise Exception, 'exit1'</span><br><span class=\"line\">Exception: exit1</span><br><span class=\"line\">exit0</span><br><span class=\"line\">     1</span><br><span class=\"line\">     2</span><br><span class=\"line\">     3</span><br><span class=\"line\">     ('a', 1)</span><br><span class=\"line\">     ('b', 2)</span><br><span class=\"line\">Error in sys.exitfunc:</span><br><span class=\"line\">Traceback (most recent call last):</span><br><span class=\"line\">  File \"/usr/lib/python2.7/atexit.py\", line 24, in _run_exitfuncs</span><br><span class=\"line\">    func(*targs, **kargs)</span><br><span class=\"line\">  File \"atexit_example.py\", line 15, in exit1</span><br><span class=\"line\">    raise Exception, 'exit1'</span><br><span class=\"line\">Exception: exit1</span><br></pre></td></tr></table></figure></p>\n<p>参考链接：<br><a href=\"https://docs.python.org/2/library/atexit.html\" target=\"_blank\" rel=\"noopener\">https://docs.python.org/2/library/atexit.html</a><br><a href=\"http://python.jobbole.com/81473/\" target=\"_blank\" rel=\"noopener\">http://python.jobbole.com/81473/</a></p>"},{"title":"Python学习笔记之----repr()函数","date":"2017-09-28T11:41:10.000Z","_content":"\n在python中，可以通过str()方法和repr()方法将一个对象转换为字符串。但是这两个方法也有少许的不同，python官方手册上对这两个方法的描述分别如下：\n\n<!--more -->\n\n1. repr()\n\n> repr(object) \n>\n> Return a string containing a printable representation of an object. This is the same value yielded by conversions (reverse quotes). It is sometimes useful to be able to access this operation as an ordinary function. For many types, this function makes an attempt to return a string that would yield an object with the same value when passed to [`eval()`](#eval), otherwise the representation is a string enclosed in angle brackets that contains the name of the type of the object together with additional information often including the name and address of the object. A class can control what this function returns for its instances by defining a [`__repr__()`](../reference/datamodel.html#object.__repr__) method.\n\n2.str()\n\n> class  str (object='') \n>\n>   Return a string containing a nicely printable representation of an object. For strings, this returns the string itself. The difference with `repr(object)` is that `str(object)` does not always attempt to return a string that is acceptable to [`eval()`](#eval); its goal is to return a printable string. If no argument is given, returns the empty string, `''`.For more information on strings see [Sequence Types — str, unicode, list, tuple, bytearray, buffer, xrange](stdtypes.html#typesseq) which describes sequence functionality (strings are sequences), and also the string-specific methods described in the [String Methods](stdtypes.html#string-methods) section. To output formatted strings use template strings or the `%` operator described in the [String Formatting Operations](stdtypes.html#string-formatting) section. In addition see the [String Services](strings.html#stringservices) section. See also [`unicode()`](#unicode).\n\n简单来说就是str()得到的字符串对象更方便用于人类识别和打印，repr()方法得到的字符串对象更容易被python解释器识别，而且使用repr()方法，这个等式通常是成立的obj == eval(repr(obj))\n\n```python\n\n>>> obj = \"hello python\"\n>>> obj == eval(repr(obj))\nTrue\n#而str()方法则不具备这个功能\n>>> obj == eval(str(obj))\nTraceback (most recent call last):\n  File \"<stdin>\", line 1, in <module>\n  File \"<string>\", line 1\n    hello python\n               ^\nSyntaxError: unexpected EOF while parsing\n```\n\n","source":"_posts/python-note-repr.md","raw":"---\ntitle: Python学习笔记之----repr()函数\ncategories:\n  - Program\ntags:\n  - python note\ndate: 2017-09-28 19:41:10\n---\n\n在python中，可以通过str()方法和repr()方法将一个对象转换为字符串。但是这两个方法也有少许的不同，python官方手册上对这两个方法的描述分别如下：\n\n<!--more -->\n\n1. repr()\n\n> repr(object) \n>\n> Return a string containing a printable representation of an object. This is the same value yielded by conversions (reverse quotes). It is sometimes useful to be able to access this operation as an ordinary function. For many types, this function makes an attempt to return a string that would yield an object with the same value when passed to [`eval()`](#eval), otherwise the representation is a string enclosed in angle brackets that contains the name of the type of the object together with additional information often including the name and address of the object. A class can control what this function returns for its instances by defining a [`__repr__()`](../reference/datamodel.html#object.__repr__) method.\n\n2.str()\n\n> class  str (object='') \n>\n>   Return a string containing a nicely printable representation of an object. For strings, this returns the string itself. The difference with `repr(object)` is that `str(object)` does not always attempt to return a string that is acceptable to [`eval()`](#eval); its goal is to return a printable string. If no argument is given, returns the empty string, `''`.For more information on strings see [Sequence Types — str, unicode, list, tuple, bytearray, buffer, xrange](stdtypes.html#typesseq) which describes sequence functionality (strings are sequences), and also the string-specific methods described in the [String Methods](stdtypes.html#string-methods) section. To output formatted strings use template strings or the `%` operator described in the [String Formatting Operations](stdtypes.html#string-formatting) section. In addition see the [String Services](strings.html#stringservices) section. See also [`unicode()`](#unicode).\n\n简单来说就是str()得到的字符串对象更方便用于人类识别和打印，repr()方法得到的字符串对象更容易被python解释器识别，而且使用repr()方法，这个等式通常是成立的obj == eval(repr(obj))\n\n```python\n\n>>> obj = \"hello python\"\n>>> obj == eval(repr(obj))\nTrue\n#而str()方法则不具备这个功能\n>>> obj == eval(str(obj))\nTraceback (most recent call last):\n  File \"<stdin>\", line 1, in <module>\n  File \"<string>\", line 1\n    hello python\n               ^\nSyntaxError: unexpected EOF while parsing\n```\n\n","slug":"python-note-repr","published":1,"updated":"2017-12-04T07:27:28.764Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjeqig1q20051lgqahhovqyuq","content":"<p>在python中，可以通过str()方法和repr()方法将一个对象转换为字符串。但是这两个方法也有少许的不同，python官方手册上对这两个方法的描述分别如下：</p>\n<a id=\"more\"></a>\n<ol>\n<li>repr()</li>\n</ol>\n<blockquote>\n<p>repr(object) </p>\n<p>Return a string containing a printable representation of an object. This is the same value yielded by conversions (reverse quotes). It is sometimes useful to be able to access this operation as an ordinary function. For many types, this function makes an attempt to return a string that would yield an object with the same value when passed to <a href=\"#eval\"><code>eval()</code></a>, otherwise the representation is a string enclosed in angle brackets that contains the name of the type of the object together with additional information often including the name and address of the object. A class can control what this function returns for its instances by defining a <a href=\"../reference/datamodel.html#object.__repr__\"><code>__repr__()</code></a> method.</p>\n</blockquote>\n<p>2.str()</p>\n<blockquote>\n<p>class  str (object=’’) </p>\n<p>  Return a string containing a nicely printable representation of an object. For strings, this returns the string itself. The difference with <code>repr(object)</code> is that <code>str(object)</code> does not always attempt to return a string that is acceptable to <a href=\"#eval\"><code>eval()</code></a>; its goal is to return a printable string. If no argument is given, returns the empty string, <code>&#39;&#39;</code>.For more information on strings see <a href=\"stdtypes.html#typesseq\">Sequence Types — str, unicode, list, tuple, bytearray, buffer, xrange</a> which describes sequence functionality (strings are sequences), and also the string-specific methods described in the <a href=\"stdtypes.html#string-methods\">String Methods</a> section. To output formatted strings use template strings or the <code>%</code> operator described in the <a href=\"stdtypes.html#string-formatting\">String Formatting Operations</a> section. In addition see the <a href=\"strings.html#stringservices\">String Services</a> section. See also <a href=\"#unicode\"><code>unicode()</code></a>.</p>\n</blockquote>\n<p>简单来说就是str()得到的字符串对象更方便用于人类识别和打印，repr()方法得到的字符串对象更容易被python解释器识别，而且使用repr()方法，这个等式通常是成立的obj == eval(repr(obj))</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>obj = <span class=\"string\">\"hello python\"</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>obj == eval(repr(obj))</span><br><span class=\"line\"><span class=\"keyword\">True</span></span><br><span class=\"line\"><span class=\"comment\">#而str()方法则不具备这个功能</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>obj == eval(str(obj))</span><br><span class=\"line\">Traceback (most recent call last):</span><br><span class=\"line\">  File <span class=\"string\">\"&lt;stdin&gt;\"</span>, line <span class=\"number\">1</span>, <span class=\"keyword\">in</span> &lt;module&gt;</span><br><span class=\"line\">  File <span class=\"string\">\"&lt;string&gt;\"</span>, line <span class=\"number\">1</span></span><br><span class=\"line\">    hello python</span><br><span class=\"line\">               ^</span><br><span class=\"line\">SyntaxError: unexpected EOF <span class=\"keyword\">while</span> parsing</span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"<p>在python中，可以通过str()方法和repr()方法将一个对象转换为字符串。但是这两个方法也有少许的不同，python官方手册上对这两个方法的描述分别如下：</p>","more":"<ol>\n<li>repr()</li>\n</ol>\n<blockquote>\n<p>repr(object) </p>\n<p>Return a string containing a printable representation of an object. This is the same value yielded by conversions (reverse quotes). It is sometimes useful to be able to access this operation as an ordinary function. For many types, this function makes an attempt to return a string that would yield an object with the same value when passed to <a href=\"#eval\"><code>eval()</code></a>, otherwise the representation is a string enclosed in angle brackets that contains the name of the type of the object together with additional information often including the name and address of the object. A class can control what this function returns for its instances by defining a <a href=\"../reference/datamodel.html#object.__repr__\"><code>__repr__()</code></a> method.</p>\n</blockquote>\n<p>2.str()</p>\n<blockquote>\n<p>class  str (object=’’) </p>\n<p>  Return a string containing a nicely printable representation of an object. For strings, this returns the string itself. The difference with <code>repr(object)</code> is that <code>str(object)</code> does not always attempt to return a string that is acceptable to <a href=\"#eval\"><code>eval()</code></a>; its goal is to return a printable string. If no argument is given, returns the empty string, <code>&#39;&#39;</code>.For more information on strings see <a href=\"stdtypes.html#typesseq\">Sequence Types — str, unicode, list, tuple, bytearray, buffer, xrange</a> which describes sequence functionality (strings are sequences), and also the string-specific methods described in the <a href=\"stdtypes.html#string-methods\">String Methods</a> section. To output formatted strings use template strings or the <code>%</code> operator described in the <a href=\"stdtypes.html#string-formatting\">String Formatting Operations</a> section. In addition see the <a href=\"strings.html#stringservices\">String Services</a> section. See also <a href=\"#unicode\"><code>unicode()</code></a>.</p>\n</blockquote>\n<p>简单来说就是str()得到的字符串对象更方便用于人类识别和打印，repr()方法得到的字符串对象更容易被python解释器识别，而且使用repr()方法，这个等式通常是成立的obj == eval(repr(obj))</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>obj = <span class=\"string\">\"hello python\"</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>obj == eval(repr(obj))</span><br><span class=\"line\"><span class=\"keyword\">True</span></span><br><span class=\"line\"><span class=\"comment\">#而str()方法则不具备这个功能</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>obj == eval(str(obj))</span><br><span class=\"line\">Traceback (most recent call last):</span><br><span class=\"line\">  File <span class=\"string\">\"&lt;stdin&gt;\"</span>, line <span class=\"number\">1</span>, <span class=\"keyword\">in</span> &lt;module&gt;</span><br><span class=\"line\">  File <span class=\"string\">\"&lt;string&gt;\"</span>, line <span class=\"number\">1</span></span><br><span class=\"line\">    hello python</span><br><span class=\"line\">               ^</span><br><span class=\"line\">SyntaxError: unexpected EOF <span class=\"keyword\">while</span> parsing</span><br></pre></td></tr></table></figure>"},{"title":"python编程笔记之-----UTC格式时间字符串与本地时间对象相互转换","date":"2017-11-28T08:35:08.000Z","_content":"\n在程序编写中，经常会与时间打交道。通常涉及到时间的比较，时间戳与时间字符串的转换等等。在python中，与时间操作有关的常用模块有time和datetime。\n\n<!--more-->\n\n这篇文章记录一下UTC格式的字符串与本地时间字符串相互转换的方法。\n\n```python\nimport datetime\nutc_time_str = '2017-10-15T00:00:00.000Z'\nutc_format_str = \"%Y-%m-%dT%H:%M:%S.%fZ\"\ntime_obj = datetime.datetime.strptime(start_time, utc_format_str)\ntime_format_str = \"%Y.%m.%d\"\nlocal_time_str = time_obj.strftime(time_format_str)\n```\n\n```python\n# UTC时间转换为时间戳 2016-07-31T16:00:00Z\ndef utc_to_local(utc_time_str, utc_format='%Y-%m-%dT%H:%M:%SZ'):\n    local_tz = pytz.timezone('Asia/Chongqing')\n    local_format = \"%Y-%m-%d %H:%M\"\n    utc_dt = datetime.datetime.strptime(utc_time_str, utc_format)\n    local_dt = utc_dt.replace(tzinfo=pytz.utc).astimezone(local_tz)\n    time_str = local_dt.strftime(local_format)\n    return int(time.mktime(time.strptime(time_str, local_format)))\n \n# 本地时间转换为UTC\ndef local_to_utc(local_ts, utc_format='%Y-%m-%dT%H:%MZ'):\n    local_tz = pytz.timezone('Asia/Chongqing')\n    local_format = \"%Y-%m-%d %H:%M\"\n    time_str = time.strftime(local_format, time.localtime(local_ts))\n    dt = datetime.datetime.strptime(time_str, local_format)\n    local_dt = local_tz.localize(dt, is_dst=None)\n    utc_dt = local_dt.astimezone(pytz.utc)\n    return utc_dt.strftime(utc_format)\n```\n\n参考链接：\n\nhttps://www.cnblogs.com/shenwenlong/p/6088765.html\n\nhttp://blog.sina.com.cn/s/blog_4da051a60102v221.html","source":"_posts/python-utc-local.md","raw":"---\ntitle: python编程笔记之-----UTC格式时间字符串与本地时间对象相互转换\ncategories:\n  - Program\ntags:\n  - python\ndate: 2017-11-28 16:35:08\n---\n\n在程序编写中，经常会与时间打交道。通常涉及到时间的比较，时间戳与时间字符串的转换等等。在python中，与时间操作有关的常用模块有time和datetime。\n\n<!--more-->\n\n这篇文章记录一下UTC格式的字符串与本地时间字符串相互转换的方法。\n\n```python\nimport datetime\nutc_time_str = '2017-10-15T00:00:00.000Z'\nutc_format_str = \"%Y-%m-%dT%H:%M:%S.%fZ\"\ntime_obj = datetime.datetime.strptime(start_time, utc_format_str)\ntime_format_str = \"%Y.%m.%d\"\nlocal_time_str = time_obj.strftime(time_format_str)\n```\n\n```python\n# UTC时间转换为时间戳 2016-07-31T16:00:00Z\ndef utc_to_local(utc_time_str, utc_format='%Y-%m-%dT%H:%M:%SZ'):\n    local_tz = pytz.timezone('Asia/Chongqing')\n    local_format = \"%Y-%m-%d %H:%M\"\n    utc_dt = datetime.datetime.strptime(utc_time_str, utc_format)\n    local_dt = utc_dt.replace(tzinfo=pytz.utc).astimezone(local_tz)\n    time_str = local_dt.strftime(local_format)\n    return int(time.mktime(time.strptime(time_str, local_format)))\n \n# 本地时间转换为UTC\ndef local_to_utc(local_ts, utc_format='%Y-%m-%dT%H:%MZ'):\n    local_tz = pytz.timezone('Asia/Chongqing')\n    local_format = \"%Y-%m-%d %H:%M\"\n    time_str = time.strftime(local_format, time.localtime(local_ts))\n    dt = datetime.datetime.strptime(time_str, local_format)\n    local_dt = local_tz.localize(dt, is_dst=None)\n    utc_dt = local_dt.astimezone(pytz.utc)\n    return utc_dt.strftime(utc_format)\n```\n\n参考链接：\n\nhttps://www.cnblogs.com/shenwenlong/p/6088765.html\n\nhttp://blog.sina.com.cn/s/blog_4da051a60102v221.html","slug":"python-utc-local","published":1,"updated":"2017-12-04T07:27:28.765Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjeqig1q50054lgqapnom3y8c","content":"<p>在程序编写中，经常会与时间打交道。通常涉及到时间的比较，时间戳与时间字符串的转换等等。在python中，与时间操作有关的常用模块有time和datetime。</p>\n<a id=\"more\"></a>\n<p>这篇文章记录一下UTC格式的字符串与本地时间字符串相互转换的方法。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> datetime</span><br><span class=\"line\">utc_time_str = <span class=\"string\">'2017-10-15T00:00:00.000Z'</span></span><br><span class=\"line\">utc_format_str = <span class=\"string\">\"%Y-%m-%dT%H:%M:%S.%fZ\"</span></span><br><span class=\"line\">time_obj = datetime.datetime.strptime(start_time, utc_format_str)</span><br><span class=\"line\">time_format_str = <span class=\"string\">\"%Y.%m.%d\"</span></span><br><span class=\"line\">local_time_str = time_obj.strftime(time_format_str)</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># UTC时间转换为时间戳 2016-07-31T16:00:00Z</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">utc_to_local</span><span class=\"params\">(utc_time_str, utc_format=<span class=\"string\">'%Y-%m-%dT%H:%M:%SZ'</span>)</span>:</span></span><br><span class=\"line\">    local_tz = pytz.timezone(<span class=\"string\">'Asia/Chongqing'</span>)</span><br><span class=\"line\">    local_format = <span class=\"string\">\"%Y-%m-%d %H:%M\"</span></span><br><span class=\"line\">    utc_dt = datetime.datetime.strptime(utc_time_str, utc_format)</span><br><span class=\"line\">    local_dt = utc_dt.replace(tzinfo=pytz.utc).astimezone(local_tz)</span><br><span class=\"line\">    time_str = local_dt.strftime(local_format)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> int(time.mktime(time.strptime(time_str, local_format)))</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\"># 本地时间转换为UTC</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">local_to_utc</span><span class=\"params\">(local_ts, utc_format=<span class=\"string\">'%Y-%m-%dT%H:%MZ'</span>)</span>:</span></span><br><span class=\"line\">    local_tz = pytz.timezone(<span class=\"string\">'Asia/Chongqing'</span>)</span><br><span class=\"line\">    local_format = <span class=\"string\">\"%Y-%m-%d %H:%M\"</span></span><br><span class=\"line\">    time_str = time.strftime(local_format, time.localtime(local_ts))</span><br><span class=\"line\">    dt = datetime.datetime.strptime(time_str, local_format)</span><br><span class=\"line\">    local_dt = local_tz.localize(dt, is_dst=<span class=\"keyword\">None</span>)</span><br><span class=\"line\">    utc_dt = local_dt.astimezone(pytz.utc)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> utc_dt.strftime(utc_format)</span><br></pre></td></tr></table></figure>\n<p>参考链接：</p>\n<p><a href=\"https://www.cnblogs.com/shenwenlong/p/6088765.html\" target=\"_blank\" rel=\"noopener\">https://www.cnblogs.com/shenwenlong/p/6088765.html</a></p>\n<p><a href=\"http://blog.sina.com.cn/s/blog_4da051a60102v221.html\" target=\"_blank\" rel=\"noopener\">http://blog.sina.com.cn/s/blog_4da051a60102v221.html</a></p>\n","site":{"data":{}},"excerpt":"<p>在程序编写中，经常会与时间打交道。通常涉及到时间的比较，时间戳与时间字符串的转换等等。在python中，与时间操作有关的常用模块有time和datetime。</p>","more":"<p>这篇文章记录一下UTC格式的字符串与本地时间字符串相互转换的方法。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> datetime</span><br><span class=\"line\">utc_time_str = <span class=\"string\">'2017-10-15T00:00:00.000Z'</span></span><br><span class=\"line\">utc_format_str = <span class=\"string\">\"%Y-%m-%dT%H:%M:%S.%fZ\"</span></span><br><span class=\"line\">time_obj = datetime.datetime.strptime(start_time, utc_format_str)</span><br><span class=\"line\">time_format_str = <span class=\"string\">\"%Y.%m.%d\"</span></span><br><span class=\"line\">local_time_str = time_obj.strftime(time_format_str)</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># UTC时间转换为时间戳 2016-07-31T16:00:00Z</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">utc_to_local</span><span class=\"params\">(utc_time_str, utc_format=<span class=\"string\">'%Y-%m-%dT%H:%M:%SZ'</span>)</span>:</span></span><br><span class=\"line\">    local_tz = pytz.timezone(<span class=\"string\">'Asia/Chongqing'</span>)</span><br><span class=\"line\">    local_format = <span class=\"string\">\"%Y-%m-%d %H:%M\"</span></span><br><span class=\"line\">    utc_dt = datetime.datetime.strptime(utc_time_str, utc_format)</span><br><span class=\"line\">    local_dt = utc_dt.replace(tzinfo=pytz.utc).astimezone(local_tz)</span><br><span class=\"line\">    time_str = local_dt.strftime(local_format)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> int(time.mktime(time.strptime(time_str, local_format)))</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\"># 本地时间转换为UTC</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">local_to_utc</span><span class=\"params\">(local_ts, utc_format=<span class=\"string\">'%Y-%m-%dT%H:%MZ'</span>)</span>:</span></span><br><span class=\"line\">    local_tz = pytz.timezone(<span class=\"string\">'Asia/Chongqing'</span>)</span><br><span class=\"line\">    local_format = <span class=\"string\">\"%Y-%m-%d %H:%M\"</span></span><br><span class=\"line\">    time_str = time.strftime(local_format, time.localtime(local_ts))</span><br><span class=\"line\">    dt = datetime.datetime.strptime(time_str, local_format)</span><br><span class=\"line\">    local_dt = local_tz.localize(dt, is_dst=<span class=\"keyword\">None</span>)</span><br><span class=\"line\">    utc_dt = local_dt.astimezone(pytz.utc)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> utc_dt.strftime(utc_format)</span><br></pre></td></tr></table></figure>\n<p>参考链接：</p>\n<p><a href=\"https://www.cnblogs.com/shenwenlong/p/6088765.html\" target=\"_blank\" rel=\"noopener\">https://www.cnblogs.com/shenwenlong/p/6088765.html</a></p>\n<p><a href=\"http://blog.sina.com.cn/s/blog_4da051a60102v221.html\" target=\"_blank\" rel=\"noopener\">http://blog.sina.com.cn/s/blog_4da051a60102v221.html</a></p>"},{"title":"与Tornado的第一次接触","date":"2016-12-15T11:59:25.000Z","_content":"Tornado框架是一款由Facebook团队开源的高效率的轻量级的非阻塞式web框架，由python编写而成。框架内部的具体实现我暂时不去深究，咱们首选学习一下它的简单使用，爽一爽先。\n<!-- more -->\n### 0x1:tornado的安装\n安装Tornado也简直不能再省事儿，一句话就可以搞定：\n```bash\nstar-chen@starchen-vb:~$ pip install tornado\nCollecting tornado\n  Downloading tornado-4.4.2.tar.gz (460kB)\n    100% |████████████████████████████████| 460kB 21kB/s \nCollecting singledispatch (from tornado)\n  Downloading singledispatch-3.4.0.3-py2.py3-none-any.whl\nCollecting certifi (from tornado)\n  Downloading certifi-2016.9.26-py2.py3-none-any.whl (377kB)\n    100% |████████████████████████████████| 378kB 37kB/s \nCollecting backports_abc>=0.4 (from tornado)\n  Downloading backports_abc-0.5-py2.py3-none-any.whl\nCollecting six (from singledispatch->tornado)\n  Downloading six-1.10.0-py2.py3-none-any.whl\nBuilding wheels for collected packages: tornado\n  Running setup.py bdist_wheel for tornado ... done\n  Stored in directory: /home/star-chen/.cache/pip/wheels/b3/db/47/46e05d1ee3ecfba252fcab42f0a156dab0df0cddf99fa0827c\nSuccessfully built tornado\nInstalling collected packages: six, singledispatch, certifi, backports-abc, tornado\nSuccessfully installed backports-abc-0.5 certifi-2016.9.26 singledispatch-3.4.0.\n```\n### 0x2:tornado的helloworld \n话不多讲，直接上代码\n```python\nimport tornado.ioloop\nimport tornado.web\n\nclass MainHandler(tornado.web.RequestHandler):\n\tdef get(self):\n\t\tself.write(\"hello world\");\n\ndef HelloApp():\n\treturn tornado.web.Application([\n\t\t(r\"/\",MainHandler),\n\t])\n\nif __name__ == \"__main__\":\n\tapp = HelloApp()\n\tapp.listen(8888)\n\ttornado.ioloop.IOLoop.current().start()\n```\n看起来还是十分简洁明了的，就这么几句代码，就包含了路由规则的创建、事件处理函数的绑定、服务器的监听开启。\n### 0x3:代码运行\n```bash\n$python hello.py\n```\n```bash\n$curl localhost:8888\nhello world\n```\n用浏览器访问一下，可以看到浏览器上已经输出了“hello world”,说明咱们的tornado已经正常运行了。接下来继续学习怎么在tornado中取得用户提交的参数。\n","source":"_posts/tornado-hello-world.md","raw":"---\ntitle: 与Tornado的第一次接触\ndate: 2016-12-15 19:59:25\ncategories:\n- Program\ntags:\n- python\n- web\n- tornado\n---\nTornado框架是一款由Facebook团队开源的高效率的轻量级的非阻塞式web框架，由python编写而成。框架内部的具体实现我暂时不去深究，咱们首选学习一下它的简单使用，爽一爽先。\n<!-- more -->\n### 0x1:tornado的安装\n安装Tornado也简直不能再省事儿，一句话就可以搞定：\n```bash\nstar-chen@starchen-vb:~$ pip install tornado\nCollecting tornado\n  Downloading tornado-4.4.2.tar.gz (460kB)\n    100% |████████████████████████████████| 460kB 21kB/s \nCollecting singledispatch (from tornado)\n  Downloading singledispatch-3.4.0.3-py2.py3-none-any.whl\nCollecting certifi (from tornado)\n  Downloading certifi-2016.9.26-py2.py3-none-any.whl (377kB)\n    100% |████████████████████████████████| 378kB 37kB/s \nCollecting backports_abc>=0.4 (from tornado)\n  Downloading backports_abc-0.5-py2.py3-none-any.whl\nCollecting six (from singledispatch->tornado)\n  Downloading six-1.10.0-py2.py3-none-any.whl\nBuilding wheels for collected packages: tornado\n  Running setup.py bdist_wheel for tornado ... done\n  Stored in directory: /home/star-chen/.cache/pip/wheels/b3/db/47/46e05d1ee3ecfba252fcab42f0a156dab0df0cddf99fa0827c\nSuccessfully built tornado\nInstalling collected packages: six, singledispatch, certifi, backports-abc, tornado\nSuccessfully installed backports-abc-0.5 certifi-2016.9.26 singledispatch-3.4.0.\n```\n### 0x2:tornado的helloworld \n话不多讲，直接上代码\n```python\nimport tornado.ioloop\nimport tornado.web\n\nclass MainHandler(tornado.web.RequestHandler):\n\tdef get(self):\n\t\tself.write(\"hello world\");\n\ndef HelloApp():\n\treturn tornado.web.Application([\n\t\t(r\"/\",MainHandler),\n\t])\n\nif __name__ == \"__main__\":\n\tapp = HelloApp()\n\tapp.listen(8888)\n\ttornado.ioloop.IOLoop.current().start()\n```\n看起来还是十分简洁明了的，就这么几句代码，就包含了路由规则的创建、事件处理函数的绑定、服务器的监听开启。\n### 0x3:代码运行\n```bash\n$python hello.py\n```\n```bash\n$curl localhost:8888\nhello world\n```\n用浏览器访问一下，可以看到浏览器上已经输出了“hello world”,说明咱们的tornado已经正常运行了。接下来继续学习怎么在tornado中取得用户提交的参数。\n","slug":"tornado-hello-world","published":1,"updated":"2017-12-04T07:27:28.765Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjeqig1qm0058lgqan8p8el20","content":"<p>Tornado框架是一款由Facebook团队开源的高效率的轻量级的非阻塞式web框架，由python编写而成。框架内部的具体实现我暂时不去深究，咱们首选学习一下它的简单使用，爽一爽先。<br><a id=\"more\"></a></p>\n<h3 id=\"0x1-tornado的安装\"><a href=\"#0x1-tornado的安装\" class=\"headerlink\" title=\"0x1:tornado的安装\"></a>0x1:tornado的安装</h3><p>安装Tornado也简直不能再省事儿，一句话就可以搞定：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">star-chen@starchen-vb:~$ pip install tornado</span><br><span class=\"line\">Collecting tornado</span><br><span class=\"line\">  Downloading tornado-4.4.2.tar.gz (460kB)</span><br><span class=\"line\">    100% |████████████████████████████████| 460kB 21kB/s </span><br><span class=\"line\">Collecting singledispatch (from tornado)</span><br><span class=\"line\">  Downloading singledispatch-3.4.0.3-py2.py3-none-any.whl</span><br><span class=\"line\">Collecting certifi (from tornado)</span><br><span class=\"line\">  Downloading certifi-2016.9.26-py2.py3-none-any.whl (377kB)</span><br><span class=\"line\">    100% |████████████████████████████████| 378kB 37kB/s </span><br><span class=\"line\">Collecting backports_abc&gt;=0.4 (from tornado)</span><br><span class=\"line\">  Downloading backports_abc-0.5-py2.py3-none-any.whl</span><br><span class=\"line\">Collecting six (from singledispatch-&gt;tornado)</span><br><span class=\"line\">  Downloading six-1.10.0-py2.py3-none-any.whl</span><br><span class=\"line\">Building wheels <span class=\"keyword\">for</span> collected packages: tornado</span><br><span class=\"line\">  Running setup.py bdist_wheel <span class=\"keyword\">for</span> tornado ... <span class=\"keyword\">done</span></span><br><span class=\"line\">  Stored <span class=\"keyword\">in</span> directory: /home/star-chen/.cache/pip/wheels/b3/db/47/46e05d1ee3ecfba252fcab42f0a156dab0df0cddf99fa0827c</span><br><span class=\"line\">Successfully built tornado</span><br><span class=\"line\">Installing collected packages: six, singledispatch, certifi, backports-abc, tornado</span><br><span class=\"line\">Successfully installed backports-abc-0.5 certifi-2016.9.26 singledispatch-3.4.0.</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"0x2-tornado的helloworld\"><a href=\"#0x2-tornado的helloworld\" class=\"headerlink\" title=\"0x2:tornado的helloworld\"></a>0x2:tornado的helloworld</h3><p>话不多讲，直接上代码<br><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> tornado.ioloop</span><br><span class=\"line\"><span class=\"keyword\">import</span> tornado.web</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MainHandler</span><span class=\"params\">(tornado.web.RequestHandler)</span>:</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get</span><span class=\"params\">(self)</span>:</span></span><br><span class=\"line\">\t\tself.write(<span class=\"string\">\"hello world\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">HelloApp</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> tornado.web.Application([</span><br><span class=\"line\">\t\t(<span class=\"string\">r\"/\"</span>,MainHandler),</span><br><span class=\"line\">\t])</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">\"__main__\"</span>:</span><br><span class=\"line\">\tapp = HelloApp()</span><br><span class=\"line\">\tapp.listen(<span class=\"number\">8888</span>)</span><br><span class=\"line\">\ttornado.ioloop.IOLoop.current().start()</span><br></pre></td></tr></table></figure></p>\n<p>看起来还是十分简洁明了的，就这么几句代码，就包含了路由规则的创建、事件处理函数的绑定、服务器的监听开启。</p>\n<h3 id=\"0x3-代码运行\"><a href=\"#0x3-代码运行\" class=\"headerlink\" title=\"0x3:代码运行\"></a>0x3:代码运行</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$python</span> hello.py</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$curl</span> localhost:8888</span><br><span class=\"line\">hello world</span><br></pre></td></tr></table></figure>\n<p>用浏览器访问一下，可以看到浏览器上已经输出了“hello world”,说明咱们的tornado已经正常运行了。接下来继续学习怎么在tornado中取得用户提交的参数。</p>\n","site":{"data":{}},"excerpt":"<p>Tornado框架是一款由Facebook团队开源的高效率的轻量级的非阻塞式web框架，由python编写而成。框架内部的具体实现我暂时不去深究，咱们首选学习一下它的简单使用，爽一爽先。<br>","more":"</p>\n<h3 id=\"0x1-tornado的安装\"><a href=\"#0x1-tornado的安装\" class=\"headerlink\" title=\"0x1:tornado的安装\"></a>0x1:tornado的安装</h3><p>安装Tornado也简直不能再省事儿，一句话就可以搞定：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">star-chen@starchen-vb:~$ pip install tornado</span><br><span class=\"line\">Collecting tornado</span><br><span class=\"line\">  Downloading tornado-4.4.2.tar.gz (460kB)</span><br><span class=\"line\">    100% |████████████████████████████████| 460kB 21kB/s </span><br><span class=\"line\">Collecting singledispatch (from tornado)</span><br><span class=\"line\">  Downloading singledispatch-3.4.0.3-py2.py3-none-any.whl</span><br><span class=\"line\">Collecting certifi (from tornado)</span><br><span class=\"line\">  Downloading certifi-2016.9.26-py2.py3-none-any.whl (377kB)</span><br><span class=\"line\">    100% |████████████████████████████████| 378kB 37kB/s </span><br><span class=\"line\">Collecting backports_abc&gt;=0.4 (from tornado)</span><br><span class=\"line\">  Downloading backports_abc-0.5-py2.py3-none-any.whl</span><br><span class=\"line\">Collecting six (from singledispatch-&gt;tornado)</span><br><span class=\"line\">  Downloading six-1.10.0-py2.py3-none-any.whl</span><br><span class=\"line\">Building wheels <span class=\"keyword\">for</span> collected packages: tornado</span><br><span class=\"line\">  Running setup.py bdist_wheel <span class=\"keyword\">for</span> tornado ... <span class=\"keyword\">done</span></span><br><span class=\"line\">  Stored <span class=\"keyword\">in</span> directory: /home/star-chen/.cache/pip/wheels/b3/db/47/46e05d1ee3ecfba252fcab42f0a156dab0df0cddf99fa0827c</span><br><span class=\"line\">Successfully built tornado</span><br><span class=\"line\">Installing collected packages: six, singledispatch, certifi, backports-abc, tornado</span><br><span class=\"line\">Successfully installed backports-abc-0.5 certifi-2016.9.26 singledispatch-3.4.0.</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"0x2-tornado的helloworld\"><a href=\"#0x2-tornado的helloworld\" class=\"headerlink\" title=\"0x2:tornado的helloworld\"></a>0x2:tornado的helloworld</h3><p>话不多讲，直接上代码<br><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> tornado.ioloop</span><br><span class=\"line\"><span class=\"keyword\">import</span> tornado.web</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MainHandler</span><span class=\"params\">(tornado.web.RequestHandler)</span>:</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get</span><span class=\"params\">(self)</span>:</span></span><br><span class=\"line\">\t\tself.write(<span class=\"string\">\"hello world\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">HelloApp</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> tornado.web.Application([</span><br><span class=\"line\">\t\t(<span class=\"string\">r\"/\"</span>,MainHandler),</span><br><span class=\"line\">\t])</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">\"__main__\"</span>:</span><br><span class=\"line\">\tapp = HelloApp()</span><br><span class=\"line\">\tapp.listen(<span class=\"number\">8888</span>)</span><br><span class=\"line\">\ttornado.ioloop.IOLoop.current().start()</span><br></pre></td></tr></table></figure></p>\n<p>看起来还是十分简洁明了的，就这么几句代码，就包含了路由规则的创建、事件处理函数的绑定、服务器的监听开启。</p>\n<h3 id=\"0x3-代码运行\"><a href=\"#0x3-代码运行\" class=\"headerlink\" title=\"0x3:代码运行\"></a>0x3:代码运行</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$python</span> hello.py</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$curl</span> localhost:8888</span><br><span class=\"line\">hello world</span><br></pre></td></tr></table></figure>\n<p>用浏览器访问一下，可以看到浏览器上已经输出了“hello world”,说明咱们的tornado已经正常运行了。接下来继续学习怎么在tornado中取得用户提交的参数。</p>"},{"title":"Tornado框架中的Requesthandler","date":"2016-12-15T12:24:10.000Z","_content":"上一篇博文中，我在我的机器上搭建了tornado框架，并运行了helloworld。在这篇文章中，我将尝试利用tornado接收用户提交的参数和数据，完成一个文件上传的小demo，之中会涉及到RequestHandler和tornado的模版机制。Let's go.\n<!-- more -->\n### 0x1:RequestHandler是个什么家伙？\n还记得上一个Helloworld工程的代码吗？我们的MainHandler继承了tornado.web.RequestHandler，那么这个RequestHandler到底是何方神圣？它能够干些什么呢？先看看官方提供的文档怎么说：\n\n> Subclassing RequestHandler\n> Most of the work of a Tornado web application is done in subclasses of RequestHandler. The main entry point for a handler subclass is a method named after the HTTP method being handled: get(), post(), etc. Each handler may define one or more of these methods to handle different HTTP actions. As described above, these methods will be called with arguments corresponding to the capturing groups of the routing rule that matched.\n>\n> Within a handler, call methods such as RequestHandler.render or RequestHandler.write to produce a response. render() loads a Template by name and renders it with the given arguments. write() is used for non-template-based output; it accepts strings, bytes, and dictionaries (dicts will be encoded as JSON).\n>\n> Many methods in RequestHandler are designed to be overridden in subclasses and be used throughout the application. It is common to define a BaseHandler class that overrides methods such as write_error and get_current_user and then subclass your own BaseHandler instead of RequestHandler for all your specific handlers.\n\n可以看看得出来，RequestHandler是一个专门用于处理http请求的类。它能够获得用户访问的各种数据，也能够通过write方法等向用户回复响应。所以，应用的具体逻辑应该在RequestHanler的子类中进行，例如查询数据库、加载模版等等。该类的具体描述可参见官方更详尽的介绍[Tornado RequestHandler类文档](http://www.tornadoweb.org/en/stable/web.html#tornado.web.RequestHandler),这之中详细列出了该类的各成员变量及提供的方法。\n\n仔细阅读文档之后，我们就可以了解到:  \n\n1. 每种类型的http请求方法都有一个对应的方法，例如常见的GET-->get(),POST--->post()。\n\n2. render()方法可以加载模版\n\n3. write()方法可以直接向客户端写入任意内容\n\n4. get_argument()方法可以取得用户提交的某个参数的值\n\n5. 用户上传的文件会被转换成files变量，可以对用户上传的文件进行后续处理\n\n6. ........\n\n   有了以上这些内容，我们已经能够完成想完成的任务了。\n\n### 0x2:Demo的需求\n\n1. 接收用户的文件上传请求\n\n2. 上传文件的后缀名检查，重命名，保存至指定目录\n\n3. 渲染模版，输出用户上传的文件的详细信息\n\n明确了需求，接下来就是编码工作了。\n\n### 0x3:具体编码\n\npython部分代码:\n\n```python\nimport tornado.web\nimport tornado.ioloop\nimport os\nclass FileUPHandler(tornado.web.RequestHandler):\n\tdef post(self):\n\t\torigin_descri=self.get_argument(\"describe\")\n\t\torigin_user=self.get_argument(\"user\")\n\t\tfile=self.request.files['photo'][0]\n\t\tfname=file['filename']\n\t\tftype=file['content_type']\n\t\tfbody=file['body']\n\t\tfsize=len(fbody)\n\t\tf=open(\"upload/\"+fname,'w')\n\t\tf.write(fbody)\n\t\tself.render(\"templates/result.html\",size=fsize/(1024),name=fname,user=origin_user,type=ftype)\n\tdef get(self):\n\t\tself.render(\"templates/upform.html\")\ndef main_app():\n\treturn tornado.web.Application([\n\n\t(r\"/\",FileUPHandler),\n\t(r\"/upload\",FileUPHandler),\n]) \nif __name__ == \"__main__\":\n\tapp = main_app()\n\tapp.listen(8888)\n\ttornado.ioloop.IOLoop.instance().start()\n\n```\n\nhtml模版部分代码：\n\ntemplate/upform.html\n\n```html\n<!DOCTYPE html>\n<html>\n\n<meta charset=\"utf-8\">\n\n<h1>Tornado File Upload Demo</h1>\n\n<form action=\"/upload\" method=\"post\" enctype=\"multipart/form-data\">\n\n文件用户：<input type=\"text\" name=\"user\"/>\n\n文件描述：<input type=\"text\" name=\"describe\"/>\n\n请选择文件：<input type=\"file\" name=\"photo\"/>\n\n<input type=\"submit\" value=\"走你!\">\n</form>\n\n</html>\n```\n\ntemplate/result.html\n\n```html\n<!DOCTYPE html>\n<html>\n\n<h1>The File Information:</h1>\n\n<h3>file name:{{name}}</h3></br>\n<h3>fiel size:{{size}} KB</h3></br>\n<h3>request user:{{user}}</h3></br>\n<h3>file type:{{type}}</h3></br>\n\n</html>\n\n```\n\n### 0x4:实际验证效果\n\n![image](/blogimg/tornado_up_form.png)\n\n![image](/blogimg/tornado_up_success.png)\n\n```bash\nstar-chen@starchen-vb:~/ProDev/tornado$ ls upload/\nico.png\n\n```\n\n最后可以看到，上传的文件已经成功的躺在了目标文件夹之中了。  \n\n### 0x5:思考\n\n这个简单的Demo完成用户请求信息的获取，并成功的上传了文件。但是并未进行文件的验证，用户可以上传任意文件，对于服务器君来说，这可是不能忍滴。\n\n### 0x6 参考链接\n\nhttp://www.tornadoweb.org/en/stable/guide/structure.html\n\nhttp://demo.pythoner.com/itt2zh/ch2.html\n\nhttps://technobeans.wordpress.com/2012/09/17/tornado-file-uploads/\n\nhttps://my.oschina.net/chenlei123/blog/127563","source":"_posts/tornado-requesthandler.md","raw":"---\ntitle: Tornado框架中的Requesthandler\ndate: 2016-12-15 20:24:10\ncategories:\n- Program\ntags:\n- tornado\n- python\n- web\n---\n上一篇博文中，我在我的机器上搭建了tornado框架，并运行了helloworld。在这篇文章中，我将尝试利用tornado接收用户提交的参数和数据，完成一个文件上传的小demo，之中会涉及到RequestHandler和tornado的模版机制。Let's go.\n<!-- more -->\n### 0x1:RequestHandler是个什么家伙？\n还记得上一个Helloworld工程的代码吗？我们的MainHandler继承了tornado.web.RequestHandler，那么这个RequestHandler到底是何方神圣？它能够干些什么呢？先看看官方提供的文档怎么说：\n\n> Subclassing RequestHandler\n> Most of the work of a Tornado web application is done in subclasses of RequestHandler. The main entry point for a handler subclass is a method named after the HTTP method being handled: get(), post(), etc. Each handler may define one or more of these methods to handle different HTTP actions. As described above, these methods will be called with arguments corresponding to the capturing groups of the routing rule that matched.\n>\n> Within a handler, call methods such as RequestHandler.render or RequestHandler.write to produce a response. render() loads a Template by name and renders it with the given arguments. write() is used for non-template-based output; it accepts strings, bytes, and dictionaries (dicts will be encoded as JSON).\n>\n> Many methods in RequestHandler are designed to be overridden in subclasses and be used throughout the application. It is common to define a BaseHandler class that overrides methods such as write_error and get_current_user and then subclass your own BaseHandler instead of RequestHandler for all your specific handlers.\n\n可以看看得出来，RequestHandler是一个专门用于处理http请求的类。它能够获得用户访问的各种数据，也能够通过write方法等向用户回复响应。所以，应用的具体逻辑应该在RequestHanler的子类中进行，例如查询数据库、加载模版等等。该类的具体描述可参见官方更详尽的介绍[Tornado RequestHandler类文档](http://www.tornadoweb.org/en/stable/web.html#tornado.web.RequestHandler),这之中详细列出了该类的各成员变量及提供的方法。\n\n仔细阅读文档之后，我们就可以了解到:  \n\n1. 每种类型的http请求方法都有一个对应的方法，例如常见的GET-->get(),POST--->post()。\n\n2. render()方法可以加载模版\n\n3. write()方法可以直接向客户端写入任意内容\n\n4. get_argument()方法可以取得用户提交的某个参数的值\n\n5. 用户上传的文件会被转换成files变量，可以对用户上传的文件进行后续处理\n\n6. ........\n\n   有了以上这些内容，我们已经能够完成想完成的任务了。\n\n### 0x2:Demo的需求\n\n1. 接收用户的文件上传请求\n\n2. 上传文件的后缀名检查，重命名，保存至指定目录\n\n3. 渲染模版，输出用户上传的文件的详细信息\n\n明确了需求，接下来就是编码工作了。\n\n### 0x3:具体编码\n\npython部分代码:\n\n```python\nimport tornado.web\nimport tornado.ioloop\nimport os\nclass FileUPHandler(tornado.web.RequestHandler):\n\tdef post(self):\n\t\torigin_descri=self.get_argument(\"describe\")\n\t\torigin_user=self.get_argument(\"user\")\n\t\tfile=self.request.files['photo'][0]\n\t\tfname=file['filename']\n\t\tftype=file['content_type']\n\t\tfbody=file['body']\n\t\tfsize=len(fbody)\n\t\tf=open(\"upload/\"+fname,'w')\n\t\tf.write(fbody)\n\t\tself.render(\"templates/result.html\",size=fsize/(1024),name=fname,user=origin_user,type=ftype)\n\tdef get(self):\n\t\tself.render(\"templates/upform.html\")\ndef main_app():\n\treturn tornado.web.Application([\n\n\t(r\"/\",FileUPHandler),\n\t(r\"/upload\",FileUPHandler),\n]) \nif __name__ == \"__main__\":\n\tapp = main_app()\n\tapp.listen(8888)\n\ttornado.ioloop.IOLoop.instance().start()\n\n```\n\nhtml模版部分代码：\n\ntemplate/upform.html\n\n```html\n<!DOCTYPE html>\n<html>\n\n<meta charset=\"utf-8\">\n\n<h1>Tornado File Upload Demo</h1>\n\n<form action=\"/upload\" method=\"post\" enctype=\"multipart/form-data\">\n\n文件用户：<input type=\"text\" name=\"user\"/>\n\n文件描述：<input type=\"text\" name=\"describe\"/>\n\n请选择文件：<input type=\"file\" name=\"photo\"/>\n\n<input type=\"submit\" value=\"走你!\">\n</form>\n\n</html>\n```\n\ntemplate/result.html\n\n```html\n<!DOCTYPE html>\n<html>\n\n<h1>The File Information:</h1>\n\n<h3>file name:{{name}}</h3></br>\n<h3>fiel size:{{size}} KB</h3></br>\n<h3>request user:{{user}}</h3></br>\n<h3>file type:{{type}}</h3></br>\n\n</html>\n\n```\n\n### 0x4:实际验证效果\n\n![image](/blogimg/tornado_up_form.png)\n\n![image](/blogimg/tornado_up_success.png)\n\n```bash\nstar-chen@starchen-vb:~/ProDev/tornado$ ls upload/\nico.png\n\n```\n\n最后可以看到，上传的文件已经成功的躺在了目标文件夹之中了。  \n\n### 0x5:思考\n\n这个简单的Demo完成用户请求信息的获取，并成功的上传了文件。但是并未进行文件的验证，用户可以上传任意文件，对于服务器君来说，这可是不能忍滴。\n\n### 0x6 参考链接\n\nhttp://www.tornadoweb.org/en/stable/guide/structure.html\n\nhttp://demo.pythoner.com/itt2zh/ch2.html\n\nhttps://technobeans.wordpress.com/2012/09/17/tornado-file-uploads/\n\nhttps://my.oschina.net/chenlei123/blog/127563","slug":"tornado-requesthandler","published":1,"updated":"2017-12-04T07:27:28.765Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjeqig1qp005blgqaub319i0u","content":"<p>上一篇博文中，我在我的机器上搭建了tornado框架，并运行了helloworld。在这篇文章中，我将尝试利用tornado接收用户提交的参数和数据，完成一个文件上传的小demo，之中会涉及到RequestHandler和tornado的模版机制。Let’s go.<br><a id=\"more\"></a></p>\n<h3 id=\"0x1-RequestHandler是个什么家伙？\"><a href=\"#0x1-RequestHandler是个什么家伙？\" class=\"headerlink\" title=\"0x1:RequestHandler是个什么家伙？\"></a>0x1:RequestHandler是个什么家伙？</h3><p>还记得上一个Helloworld工程的代码吗？我们的MainHandler继承了tornado.web.RequestHandler，那么这个RequestHandler到底是何方神圣？它能够干些什么呢？先看看官方提供的文档怎么说：</p>\n<blockquote>\n<p>Subclassing RequestHandler<br>Most of the work of a Tornado web application is done in subclasses of RequestHandler. The main entry point for a handler subclass is a method named after the HTTP method being handled: get(), post(), etc. Each handler may define one or more of these methods to handle different HTTP actions. As described above, these methods will be called with arguments corresponding to the capturing groups of the routing rule that matched.</p>\n<p>Within a handler, call methods such as RequestHandler.render or RequestHandler.write to produce a response. render() loads a Template by name and renders it with the given arguments. write() is used for non-template-based output; it accepts strings, bytes, and dictionaries (dicts will be encoded as JSON).</p>\n<p>Many methods in RequestHandler are designed to be overridden in subclasses and be used throughout the application. It is common to define a BaseHandler class that overrides methods such as write_error and get_current_user and then subclass your own BaseHandler instead of RequestHandler for all your specific handlers.</p>\n</blockquote>\n<p>可以看看得出来，RequestHandler是一个专门用于处理http请求的类。它能够获得用户访问的各种数据，也能够通过write方法等向用户回复响应。所以，应用的具体逻辑应该在RequestHanler的子类中进行，例如查询数据库、加载模版等等。该类的具体描述可参见官方更详尽的介绍<a href=\"http://www.tornadoweb.org/en/stable/web.html#tornado.web.RequestHandler\" target=\"_blank\" rel=\"noopener\">Tornado RequestHandler类文档</a>,这之中详细列出了该类的各成员变量及提供的方法。</p>\n<p>仔细阅读文档之后，我们就可以了解到:  </p>\n<ol>\n<li><p>每种类型的http请求方法都有一个对应的方法，例如常见的GET–&gt;get(),POST—&gt;post()。</p>\n</li>\n<li><p>render()方法可以加载模版</p>\n</li>\n<li><p>write()方法可以直接向客户端写入任意内容</p>\n</li>\n<li><p>get_argument()方法可以取得用户提交的某个参数的值</p>\n</li>\n<li><p>用户上传的文件会被转换成files变量，可以对用户上传的文件进行后续处理</p>\n</li>\n<li><p>……..</p>\n<p>有了以上这些内容，我们已经能够完成想完成的任务了。</p>\n</li>\n</ol>\n<h3 id=\"0x2-Demo的需求\"><a href=\"#0x2-Demo的需求\" class=\"headerlink\" title=\"0x2:Demo的需求\"></a>0x2:Demo的需求</h3><ol>\n<li><p>接收用户的文件上传请求</p>\n</li>\n<li><p>上传文件的后缀名检查，重命名，保存至指定目录</p>\n</li>\n<li><p>渲染模版，输出用户上传的文件的详细信息</p>\n</li>\n</ol>\n<p>明确了需求，接下来就是编码工作了。</p>\n<h3 id=\"0x3-具体编码\"><a href=\"#0x3-具体编码\" class=\"headerlink\" title=\"0x3:具体编码\"></a>0x3:具体编码</h3><p>python部分代码:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> tornado.web</span><br><span class=\"line\"><span class=\"keyword\">import</span> tornado.ioloop</span><br><span class=\"line\"><span class=\"keyword\">import</span> os</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">FileUPHandler</span><span class=\"params\">(tornado.web.RequestHandler)</span>:</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">post</span><span class=\"params\">(self)</span>:</span></span><br><span class=\"line\">\t\torigin_descri=self.get_argument(<span class=\"string\">\"describe\"</span>)</span><br><span class=\"line\">\t\torigin_user=self.get_argument(<span class=\"string\">\"user\"</span>)</span><br><span class=\"line\">\t\tfile=self.request.files[<span class=\"string\">'photo'</span>][<span class=\"number\">0</span>]</span><br><span class=\"line\">\t\tfname=file[<span class=\"string\">'filename'</span>]</span><br><span class=\"line\">\t\tftype=file[<span class=\"string\">'content_type'</span>]</span><br><span class=\"line\">\t\tfbody=file[<span class=\"string\">'body'</span>]</span><br><span class=\"line\">\t\tfsize=len(fbody)</span><br><span class=\"line\">\t\tf=open(<span class=\"string\">\"upload/\"</span>+fname,<span class=\"string\">'w'</span>)</span><br><span class=\"line\">\t\tf.write(fbody)</span><br><span class=\"line\">\t\tself.render(<span class=\"string\">\"templates/result.html\"</span>,size=fsize/(<span class=\"number\">1024</span>),name=fname,user=origin_user,type=ftype)</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get</span><span class=\"params\">(self)</span>:</span></span><br><span class=\"line\">\t\tself.render(<span class=\"string\">\"templates/upform.html\"</span>)</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">main_app</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> tornado.web.Application([</span><br><span class=\"line\"></span><br><span class=\"line\">\t(<span class=\"string\">r\"/\"</span>,FileUPHandler),</span><br><span class=\"line\">\t(<span class=\"string\">r\"/upload\"</span>,FileUPHandler),</span><br><span class=\"line\">]) </span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">\"__main__\"</span>:</span><br><span class=\"line\">\tapp = main_app()</span><br><span class=\"line\">\tapp.listen(<span class=\"number\">8888</span>)</span><br><span class=\"line\">\ttornado.ioloop.IOLoop.instance().start()</span><br></pre></td></tr></table></figure>\n<p>html模版部分代码：</p>\n<p>template/upform.html</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE html&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">\"utf-8\"</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>Tornado File Upload Demo<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">form</span> <span class=\"attr\">action</span>=<span class=\"string\">\"/upload\"</span> <span class=\"attr\">method</span>=<span class=\"string\">\"post\"</span> <span class=\"attr\">enctype</span>=<span class=\"string\">\"multipart/form-data\"</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">文件用户：<span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">\"text\"</span> <span class=\"attr\">name</span>=<span class=\"string\">\"user\"</span>/&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">文件描述：<span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">\"text\"</span> <span class=\"attr\">name</span>=<span class=\"string\">\"describe\"</span>/&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">请选择文件：<span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">\"file\"</span> <span class=\"attr\">name</span>=<span class=\"string\">\"photo\"</span>/&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">\"submit\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"走你!\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">form</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>template/result.html</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE html&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>The File Information:<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">h3</span>&gt;</span>file name:&#123;&#123;name&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">h3</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">br</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">h3</span>&gt;</span>fiel size:&#123;&#123;size&#125;&#125; KB<span class=\"tag\">&lt;/<span class=\"name\">h3</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">br</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">h3</span>&gt;</span>request user:&#123;&#123;user&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">h3</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">br</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">h3</span>&gt;</span>file type:&#123;&#123;type&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">h3</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">br</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"0x4-实际验证效果\"><a href=\"#0x4-实际验证效果\" class=\"headerlink\" title=\"0x4:实际验证效果\"></a>0x4:实际验证效果</h3><p><img src=\"/blogimg/tornado_up_form.png\" alt=\"image\"></p>\n<p><img src=\"/blogimg/tornado_up_success.png\" alt=\"image\"></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">star-chen@starchen-vb:~/ProDev/tornado$ ls upload/</span><br><span class=\"line\">ico.png</span><br></pre></td></tr></table></figure>\n<p>最后可以看到，上传的文件已经成功的躺在了目标文件夹之中了。  </p>\n<h3 id=\"0x5-思考\"><a href=\"#0x5-思考\" class=\"headerlink\" title=\"0x5:思考\"></a>0x5:思考</h3><p>这个简单的Demo完成用户请求信息的获取，并成功的上传了文件。但是并未进行文件的验证，用户可以上传任意文件，对于服务器君来说，这可是不能忍滴。</p>\n<h3 id=\"0x6-参考链接\"><a href=\"#0x6-参考链接\" class=\"headerlink\" title=\"0x6 参考链接\"></a>0x6 参考链接</h3><p><a href=\"http://www.tornadoweb.org/en/stable/guide/structure.html\" target=\"_blank\" rel=\"noopener\">http://www.tornadoweb.org/en/stable/guide/structure.html</a></p>\n<p><a href=\"http://demo.pythoner.com/itt2zh/ch2.html\" target=\"_blank\" rel=\"noopener\">http://demo.pythoner.com/itt2zh/ch2.html</a></p>\n<p><a href=\"https://technobeans.wordpress.com/2012/09/17/tornado-file-uploads/\" target=\"_blank\" rel=\"noopener\">https://technobeans.wordpress.com/2012/09/17/tornado-file-uploads/</a></p>\n<p><a href=\"https://my.oschina.net/chenlei123/blog/127563\" target=\"_blank\" rel=\"noopener\">https://my.oschina.net/chenlei123/blog/127563</a></p>\n","site":{"data":{}},"excerpt":"<p>上一篇博文中，我在我的机器上搭建了tornado框架，并运行了helloworld。在这篇文章中，我将尝试利用tornado接收用户提交的参数和数据，完成一个文件上传的小demo，之中会涉及到RequestHandler和tornado的模版机制。Let’s go.<br>","more":"</p>\n<h3 id=\"0x1-RequestHandler是个什么家伙？\"><a href=\"#0x1-RequestHandler是个什么家伙？\" class=\"headerlink\" title=\"0x1:RequestHandler是个什么家伙？\"></a>0x1:RequestHandler是个什么家伙？</h3><p>还记得上一个Helloworld工程的代码吗？我们的MainHandler继承了tornado.web.RequestHandler，那么这个RequestHandler到底是何方神圣？它能够干些什么呢？先看看官方提供的文档怎么说：</p>\n<blockquote>\n<p>Subclassing RequestHandler<br>Most of the work of a Tornado web application is done in subclasses of RequestHandler. The main entry point for a handler subclass is a method named after the HTTP method being handled: get(), post(), etc. Each handler may define one or more of these methods to handle different HTTP actions. As described above, these methods will be called with arguments corresponding to the capturing groups of the routing rule that matched.</p>\n<p>Within a handler, call methods such as RequestHandler.render or RequestHandler.write to produce a response. render() loads a Template by name and renders it with the given arguments. write() is used for non-template-based output; it accepts strings, bytes, and dictionaries (dicts will be encoded as JSON).</p>\n<p>Many methods in RequestHandler are designed to be overridden in subclasses and be used throughout the application. It is common to define a BaseHandler class that overrides methods such as write_error and get_current_user and then subclass your own BaseHandler instead of RequestHandler for all your specific handlers.</p>\n</blockquote>\n<p>可以看看得出来，RequestHandler是一个专门用于处理http请求的类。它能够获得用户访问的各种数据，也能够通过write方法等向用户回复响应。所以，应用的具体逻辑应该在RequestHanler的子类中进行，例如查询数据库、加载模版等等。该类的具体描述可参见官方更详尽的介绍<a href=\"http://www.tornadoweb.org/en/stable/web.html#tornado.web.RequestHandler\" target=\"_blank\" rel=\"noopener\">Tornado RequestHandler类文档</a>,这之中详细列出了该类的各成员变量及提供的方法。</p>\n<p>仔细阅读文档之后，我们就可以了解到:  </p>\n<ol>\n<li><p>每种类型的http请求方法都有一个对应的方法，例如常见的GET–&gt;get(),POST—&gt;post()。</p>\n</li>\n<li><p>render()方法可以加载模版</p>\n</li>\n<li><p>write()方法可以直接向客户端写入任意内容</p>\n</li>\n<li><p>get_argument()方法可以取得用户提交的某个参数的值</p>\n</li>\n<li><p>用户上传的文件会被转换成files变量，可以对用户上传的文件进行后续处理</p>\n</li>\n<li><p>……..</p>\n<p>有了以上这些内容，我们已经能够完成想完成的任务了。</p>\n</li>\n</ol>\n<h3 id=\"0x2-Demo的需求\"><a href=\"#0x2-Demo的需求\" class=\"headerlink\" title=\"0x2:Demo的需求\"></a>0x2:Demo的需求</h3><ol>\n<li><p>接收用户的文件上传请求</p>\n</li>\n<li><p>上传文件的后缀名检查，重命名，保存至指定目录</p>\n</li>\n<li><p>渲染模版，输出用户上传的文件的详细信息</p>\n</li>\n</ol>\n<p>明确了需求，接下来就是编码工作了。</p>\n<h3 id=\"0x3-具体编码\"><a href=\"#0x3-具体编码\" class=\"headerlink\" title=\"0x3:具体编码\"></a>0x3:具体编码</h3><p>python部分代码:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> tornado.web</span><br><span class=\"line\"><span class=\"keyword\">import</span> tornado.ioloop</span><br><span class=\"line\"><span class=\"keyword\">import</span> os</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">FileUPHandler</span><span class=\"params\">(tornado.web.RequestHandler)</span>:</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">post</span><span class=\"params\">(self)</span>:</span></span><br><span class=\"line\">\t\torigin_descri=self.get_argument(<span class=\"string\">\"describe\"</span>)</span><br><span class=\"line\">\t\torigin_user=self.get_argument(<span class=\"string\">\"user\"</span>)</span><br><span class=\"line\">\t\tfile=self.request.files[<span class=\"string\">'photo'</span>][<span class=\"number\">0</span>]</span><br><span class=\"line\">\t\tfname=file[<span class=\"string\">'filename'</span>]</span><br><span class=\"line\">\t\tftype=file[<span class=\"string\">'content_type'</span>]</span><br><span class=\"line\">\t\tfbody=file[<span class=\"string\">'body'</span>]</span><br><span class=\"line\">\t\tfsize=len(fbody)</span><br><span class=\"line\">\t\tf=open(<span class=\"string\">\"upload/\"</span>+fname,<span class=\"string\">'w'</span>)</span><br><span class=\"line\">\t\tf.write(fbody)</span><br><span class=\"line\">\t\tself.render(<span class=\"string\">\"templates/result.html\"</span>,size=fsize/(<span class=\"number\">1024</span>),name=fname,user=origin_user,type=ftype)</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get</span><span class=\"params\">(self)</span>:</span></span><br><span class=\"line\">\t\tself.render(<span class=\"string\">\"templates/upform.html\"</span>)</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">main_app</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> tornado.web.Application([</span><br><span class=\"line\"></span><br><span class=\"line\">\t(<span class=\"string\">r\"/\"</span>,FileUPHandler),</span><br><span class=\"line\">\t(<span class=\"string\">r\"/upload\"</span>,FileUPHandler),</span><br><span class=\"line\">]) </span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">\"__main__\"</span>:</span><br><span class=\"line\">\tapp = main_app()</span><br><span class=\"line\">\tapp.listen(<span class=\"number\">8888</span>)</span><br><span class=\"line\">\ttornado.ioloop.IOLoop.instance().start()</span><br></pre></td></tr></table></figure>\n<p>html模版部分代码：</p>\n<p>template/upform.html</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE html&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">\"utf-8\"</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>Tornado File Upload Demo<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">form</span> <span class=\"attr\">action</span>=<span class=\"string\">\"/upload\"</span> <span class=\"attr\">method</span>=<span class=\"string\">\"post\"</span> <span class=\"attr\">enctype</span>=<span class=\"string\">\"multipart/form-data\"</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">文件用户：<span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">\"text\"</span> <span class=\"attr\">name</span>=<span class=\"string\">\"user\"</span>/&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">文件描述：<span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">\"text\"</span> <span class=\"attr\">name</span>=<span class=\"string\">\"describe\"</span>/&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">请选择文件：<span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">\"file\"</span> <span class=\"attr\">name</span>=<span class=\"string\">\"photo\"</span>/&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">\"submit\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"走你!\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">form</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>template/result.html</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE html&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>The File Information:<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">h3</span>&gt;</span>file name:&#123;&#123;name&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">h3</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">br</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">h3</span>&gt;</span>fiel size:&#123;&#123;size&#125;&#125; KB<span class=\"tag\">&lt;/<span class=\"name\">h3</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">br</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">h3</span>&gt;</span>request user:&#123;&#123;user&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">h3</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">br</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">h3</span>&gt;</span>file type:&#123;&#123;type&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">h3</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">br</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"0x4-实际验证效果\"><a href=\"#0x4-实际验证效果\" class=\"headerlink\" title=\"0x4:实际验证效果\"></a>0x4:实际验证效果</h3><p><img src=\"/blogimg/tornado_up_form.png\" alt=\"image\"></p>\n<p><img src=\"/blogimg/tornado_up_success.png\" alt=\"image\"></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">star-chen@starchen-vb:~/ProDev/tornado$ ls upload/</span><br><span class=\"line\">ico.png</span><br></pre></td></tr></table></figure>\n<p>最后可以看到，上传的文件已经成功的躺在了目标文件夹之中了。  </p>\n<h3 id=\"0x5-思考\"><a href=\"#0x5-思考\" class=\"headerlink\" title=\"0x5:思考\"></a>0x5:思考</h3><p>这个简单的Demo完成用户请求信息的获取，并成功的上传了文件。但是并未进行文件的验证，用户可以上传任意文件，对于服务器君来说，这可是不能忍滴。</p>\n<h3 id=\"0x6-参考链接\"><a href=\"#0x6-参考链接\" class=\"headerlink\" title=\"0x6 参考链接\"></a>0x6 参考链接</h3><p><a href=\"http://www.tornadoweb.org/en/stable/guide/structure.html\" target=\"_blank\" rel=\"noopener\">http://www.tornadoweb.org/en/stable/guide/structure.html</a></p>\n<p><a href=\"http://demo.pythoner.com/itt2zh/ch2.html\" target=\"_blank\" rel=\"noopener\">http://demo.pythoner.com/itt2zh/ch2.html</a></p>\n<p><a href=\"https://technobeans.wordpress.com/2012/09/17/tornado-file-uploads/\" target=\"_blank\" rel=\"noopener\">https://technobeans.wordpress.com/2012/09/17/tornado-file-uploads/</a></p>\n<p><a href=\"https://my.oschina.net/chenlei123/blog/127563\" target=\"_blank\" rel=\"noopener\">https://my.oschina.net/chenlei123/blog/127563</a></p>"},{"title":"在浏览器中通过VNC远程控制虚拟机","date":"2018-03-08T15:07:14.000Z","_content":"\n在平时使用云服务器的时候，会用到在浏览器中控制自己的服务器，一直很好奇是怎么实现的。以往也了解到VNC有浏览器applet可以实现，但是applet已经不流行了，而且使用起来也不是很方便。最近搜索到一款神器---noVNC,它将VNC协议转换成websocket，然后浏览器使用canvas绘图来实现浏览器远程控制。\n\n<!--more-->\n\nnoVNC的官网：http://novnc.com/info.html， 它也是个开源项目，可以在Github上下载到源代码进行学习，这次就暂时不去深入研究它，先用用看先。\n\n应用环境：\n\n   VNC服务端：kvm为kvm中的虚拟机开放的vnc端口（就是上回刚刚安装好的mini-win7）\n\n   noVNC服务端：正好我有块不关机树莓派，就把noVNC给放到树莓派上跑吧\n\n树莓派上执行的操作：\n\n![image](/blogimg/pi_novnc.png)\n\n浏览器打开相应页面：\n\n![image](/blogimg/bw_novnc.png)\n\nExciting!","source":"_posts/web-vnc.md","raw":"---\ntitle: 在浏览器中通过VNC远程控制虚拟机\ncategories:\n  - Linux\ntags:\n  - kvm noVNC\ndate: 2018-03-08 23:07:14\n---\n\n在平时使用云服务器的时候，会用到在浏览器中控制自己的服务器，一直很好奇是怎么实现的。以往也了解到VNC有浏览器applet可以实现，但是applet已经不流行了，而且使用起来也不是很方便。最近搜索到一款神器---noVNC,它将VNC协议转换成websocket，然后浏览器使用canvas绘图来实现浏览器远程控制。\n\n<!--more-->\n\nnoVNC的官网：http://novnc.com/info.html， 它也是个开源项目，可以在Github上下载到源代码进行学习，这次就暂时不去深入研究它，先用用看先。\n\n应用环境：\n\n   VNC服务端：kvm为kvm中的虚拟机开放的vnc端口（就是上回刚刚安装好的mini-win7）\n\n   noVNC服务端：正好我有块不关机树莓派，就把noVNC给放到树莓派上跑吧\n\n树莓派上执行的操作：\n\n![image](/blogimg/pi_novnc.png)\n\n浏览器打开相应页面：\n\n![image](/blogimg/bw_novnc.png)\n\nExciting!","slug":"web-vnc","published":1,"updated":"2018-03-09T03:26:41.463Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjeqig1qs005flgqagcfsdwu0","content":"<p>在平时使用云服务器的时候，会用到在浏览器中控制自己的服务器，一直很好奇是怎么实现的。以往也了解到VNC有浏览器applet可以实现，但是applet已经不流行了，而且使用起来也不是很方便。最近搜索到一款神器—noVNC,它将VNC协议转换成websocket，然后浏览器使用canvas绘图来实现浏览器远程控制。</p>\n<a id=\"more\"></a>\n<p>noVNC的官网：<a href=\"http://novnc.com/info.html，\" target=\"_blank\" rel=\"noopener\">http://novnc.com/info.html，</a> 它也是个开源项目，可以在Github上下载到源代码进行学习，这次就暂时不去深入研究它，先用用看先。</p>\n<p>应用环境：</p>\n<p>   VNC服务端：kvm为kvm中的虚拟机开放的vnc端口（就是上回刚刚安装好的mini-win7）</p>\n<p>   noVNC服务端：正好我有块不关机树莓派，就把noVNC给放到树莓派上跑吧</p>\n<p>树莓派上执行的操作：</p>\n<p><img src=\"/blogimg/pi_novnc.png\" alt=\"image\"></p>\n<p>浏览器打开相应页面：</p>\n<p><img src=\"/blogimg/bw_novnc.png\" alt=\"image\"></p>\n<p>Exciting!</p>\n","site":{"data":{}},"excerpt":"<p>在平时使用云服务器的时候，会用到在浏览器中控制自己的服务器，一直很好奇是怎么实现的。以往也了解到VNC有浏览器applet可以实现，但是applet已经不流行了，而且使用起来也不是很方便。最近搜索到一款神器—noVNC,它将VNC协议转换成websocket，然后浏览器使用canvas绘图来实现浏览器远程控制。</p>","more":"<p>noVNC的官网：<a href=\"http://novnc.com/info.html，\" target=\"_blank\" rel=\"noopener\">http://novnc.com/info.html，</a> 它也是个开源项目，可以在Github上下载到源代码进行学习，这次就暂时不去深入研究它，先用用看先。</p>\n<p>应用环境：</p>\n<p>   VNC服务端：kvm为kvm中的虚拟机开放的vnc端口（就是上回刚刚安装好的mini-win7）</p>\n<p>   noVNC服务端：正好我有块不关机树莓派，就把noVNC给放到树莓派上跑吧</p>\n<p>树莓派上执行的操作：</p>\n<p><img src=\"/blogimg/pi_novnc.png\" alt=\"image\"></p>\n<p>浏览器打开相应页面：</p>\n<p><img src=\"/blogimg/bw_novnc.png\" alt=\"image\"></p>\n<p>Exciting!</p>"},{"title":"Ubuntu上安装使用KVM","date":"2018-03-05T06:18:38.000Z","_content":"KVM(kernel-based virtual machine),它是基于内核的完全虚拟化技术，有着较高的效率和完全的guest系统支持，可以安装各种guest系统。\n<!--more-->\n它具体的原理暂时不去探究，先安装一下软件，跑起来体验一把。\n我的系统环境：Ubuntu 17.10\n1. 安装需要的kvm软件、网络桥接工具、管理工具\n```shell\nsudo apt-get install qemu-kvm libvirt-bin bridge-utils qemu-system virt-manager virt-viewer qemu\n```\n耐心等待软件安装完成之后，先使用图形化的virt-manager来创建一台虚拟机。\n```shell\nsudo virt-manager\n```\n安装步骤依次设置，设置的步骤看起来和vm，vbox差不多，完了给它启动起来，看起来还不错。\n![image](/blogimg/virtmanager.png)\n![image](/blogimg/virtm-1.png)\n![image](/blogimg/virtm-2.png)\n![image](/blogimg/virtm-3.png)\n![image](/blogimg/virtm-4.png)\n![image](/blogimg/virtm-5.png)\n![image](/blogimg/virtm-start.png)\n\n除了使用图形化工具来创建虚拟机，还可以使用命令行工具来创建和管理kvm虚拟机，另外还有libvirt工具包提供了接口，可以使用其它编程语言来编写自定义的管理工具和云平台。","source":"_posts/ubuntu-kvm.md","raw":"---\ntitle: Ubuntu上安装使用KVM\ncategories:\n  - Linux\ntags:\n  - kvm\ndate: 2018-03-05 14:18:38\n---\nKVM(kernel-based virtual machine),它是基于内核的完全虚拟化技术，有着较高的效率和完全的guest系统支持，可以安装各种guest系统。\n<!--more-->\n它具体的原理暂时不去探究，先安装一下软件，跑起来体验一把。\n我的系统环境：Ubuntu 17.10\n1. 安装需要的kvm软件、网络桥接工具、管理工具\n```shell\nsudo apt-get install qemu-kvm libvirt-bin bridge-utils qemu-system virt-manager virt-viewer qemu\n```\n耐心等待软件安装完成之后，先使用图形化的virt-manager来创建一台虚拟机。\n```shell\nsudo virt-manager\n```\n安装步骤依次设置，设置的步骤看起来和vm，vbox差不多，完了给它启动起来，看起来还不错。\n![image](/blogimg/virtmanager.png)\n![image](/blogimg/virtm-1.png)\n![image](/blogimg/virtm-2.png)\n![image](/blogimg/virtm-3.png)\n![image](/blogimg/virtm-4.png)\n![image](/blogimg/virtm-5.png)\n![image](/blogimg/virtm-start.png)\n\n除了使用图形化工具来创建虚拟机，还可以使用命令行工具来创建和管理kvm虚拟机，另外还有libvirt工具包提供了接口，可以使用其它编程语言来编写自定义的管理工具和云平台。","slug":"ubuntu-kvm","published":1,"updated":"2018-03-09T03:26:41.463Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjeqig1qv005ilgqagz13e0vr","content":"<p>KVM(kernel-based virtual machine),它是基于内核的完全虚拟化技术，有着较高的效率和完全的guest系统支持，可以安装各种guest系统。<br><a id=\"more\"></a><br>它具体的原理暂时不去探究，先安装一下软件，跑起来体验一把。<br>我的系统环境：Ubuntu 17.10</p>\n<ol>\n<li>安装需要的kvm软件、网络桥接工具、管理工具<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get install qemu-kvm libvirt-bin bridge-utils qemu-system virt-manager virt-viewer qemu</span><br></pre></td></tr></table></figure>\n</li>\n</ol>\n<p>耐心等待软件安装完成之后，先使用图形化的virt-manager来创建一台虚拟机。<br><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo virt-manager</span><br></pre></td></tr></table></figure></p>\n<p>安装步骤依次设置，设置的步骤看起来和vm，vbox差不多，完了给它启动起来，看起来还不错。<br><img src=\"/blogimg/virtmanager.png\" alt=\"image\"><br><img src=\"/blogimg/virtm-1.png\" alt=\"image\"><br><img src=\"/blogimg/virtm-2.png\" alt=\"image\"><br><img src=\"/blogimg/virtm-3.png\" alt=\"image\"><br><img src=\"/blogimg/virtm-4.png\" alt=\"image\"><br><img src=\"/blogimg/virtm-5.png\" alt=\"image\"><br><img src=\"/blogimg/virtm-start.png\" alt=\"image\"></p>\n<p>除了使用图形化工具来创建虚拟机，还可以使用命令行工具来创建和管理kvm虚拟机，另外还有libvirt工具包提供了接口，可以使用其它编程语言来编写自定义的管理工具和云平台。</p>\n","site":{"data":{}},"excerpt":"<p>KVM(kernel-based virtual machine),它是基于内核的完全虚拟化技术，有着较高的效率和完全的guest系统支持，可以安装各种guest系统。<br>","more":"<br>它具体的原理暂时不去探究，先安装一下软件，跑起来体验一把。<br>我的系统环境：Ubuntu 17.10</p>\n<ol>\n<li>安装需要的kvm软件、网络桥接工具、管理工具<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get install qemu-kvm libvirt-bin bridge-utils qemu-system virt-manager virt-viewer qemu</span><br></pre></td></tr></table></figure>\n</li>\n</ol>\n<p>耐心等待软件安装完成之后，先使用图形化的virt-manager来创建一台虚拟机。<br><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo virt-manager</span><br></pre></td></tr></table></figure></p>\n<p>安装步骤依次设置，设置的步骤看起来和vm，vbox差不多，完了给它启动起来，看起来还不错。<br><img src=\"/blogimg/virtmanager.png\" alt=\"image\"><br><img src=\"/blogimg/virtm-1.png\" alt=\"image\"><br><img src=\"/blogimg/virtm-2.png\" alt=\"image\"><br><img src=\"/blogimg/virtm-3.png\" alt=\"image\"><br><img src=\"/blogimg/virtm-4.png\" alt=\"image\"><br><img src=\"/blogimg/virtm-5.png\" alt=\"image\"><br><img src=\"/blogimg/virtm-start.png\" alt=\"image\"></p>\n<p>除了使用图形化工具来创建虚拟机，还可以使用命令行工具来创建和管理kvm虚拟机，另外还有libvirt工具包提供了接口，可以使用其它编程语言来编写自定义的管理工具和云平台。</p>"},{"title":"树莓派搭建iPXE服务并实现无人职守安装CentOS 7","date":"2018-03-13T03:39:55.000Z","_content":"\n最近我对网络启动产生了浓厚的兴趣，很想亲自搭建一个环境来尝试一下，于是就有了一系列的折腾过程。本篇记录的是使用iPXE来网络启动，自动安装CentOS系统。\n\n<!--more-->\n\n#### 基本技术介绍\n\nPXE:\n\n​    PXE(preboot execute environment，预启动执行环境)是由Intel公司开发的最新技术，工作于Client/Server的网络模式，支持工作站通过网络从远端服务器下载映像，并由此支持通过网络启动操作系统，在启动过程中，终端要求服务器分配IP地址，再用TFTP（trivial file transfer protocol）或MTFTP(multicast trivial file transfer protocol)协议下载一个启动软件包到本机内存中执行，由这个启动软件包完成终端（客户端）基本软件设置，从而引导预先安装在服务器中的终端操作系统。PXE可以引导多种操作系统，如:Windows95/98/2000/windows2003/windows2008/winXP/win7/win8,linux系列系统等。\n\niPXE:\n\n​    iPXE is the leading open source network boot firmware. It provides a full PXE implementation enhanced with additional features such as:\n\nboot from a web server via HTTP\nboot from an iSCSI SAN\nboot from a Fibre Channel SAN via FCoE\nboot from an AoE SAN\nboot from a wireless network\nboot from a wide-area network\nboot from an Infiniband network\ncontrol the boot process with a script\nYou can use iPXE to replace the existing PXE ROM on your network card, or you can chainload into iPXE to obtain the features of iPXE without the hassle of reflashing.\n\niPXE is free, open-source software licensed under the GNU GPL (with some portions under GPL-compatible licences), and is included in products from several network card manufacturers and OEMs.\n\niPXE是一个开源的网络启动固件，它使用了诸如http,ftp等协议来传输，相较于普通的PXE固件使用TFTP来进行文件传输速度更快，而且还支持烧录到网卡芯片，CD-ROM，U盘上，有了它，只要有网络的地方就可以启动机器进行系统维护或者系统安装了。\n\niPXE官网地址：http://ipxe.org   该项目开源，可以自己克隆代码进行编译。\n\n#### 软硬件环境准备\n\n硬件：树莓派3，提供系统支持，用作启动服务器。当然，如果有其它Linux系统的电脑也是可以的。\n\n软件：nginx，作为web服务器，提供系统镜像，本地软件源。dnsmasq，dnsmasq自身带有tftp服务器，支持pxe，支持dhcpPROXY模式，有了它就不用再去安装单独的dhcp服务器和tftp服务器了。\n\n安装软件：\n\n```shell\npi@raspberrypi:~ $ sudo apt-get instal nginx\npi@raspberrypi:~ $ sudo apt-get instal dnsmasq\n```\n\n#### 准备所需的系统镜像和pxe文件\n\n下载CentOS7系统镜像，并复制相应文件到web目录：\n\n```shell\npi@raspberrypi:~ $ wget https://mirrors.aliyun.com/centos/7.4.1708/isos/x86_64/CentOS-7-x86_64-Minimal-1708.iso\npi@raspberrypi:~ $ mount CentOS-7-x86_64-Minimal-1708.iso /mnt\npi@raspberrypi:~ $ sudo mkdir -p /var/www/html/centos/7/x86_64/\npi@raspberrypi:~ $ sudo cp -r /mnt/* /var/www/html/centos/7/x86_64/\n```\n\n下载iPXE相关的启动文件到web目录\n\n```shell\npi@raspberrypi:/var/www/html $ sudo wget http://boot.ipxe.org/undionly.kpxe\n```\n\n现在我的web根目录的文件内容：\n\n```shell\npi@raspberrypi:/var/www/html $ ls -la\n总用量 811112\ndrwxr-xr-x 3 root root      4096 3月  12 21:53 .\ndrwxr-xr-x 3 root root      4096 10月 21 09:31 ..\n-rw-r--r-- 1 root root        43 3月  12 21:52 boot.txt\ndrwxr-xr-x 3 pi   pi        4096 3月  12 15:23 centos\n-rw-r--r-- 1 pi   pi   830472192 9月   5  2017 CentOS-7-x86_64-Minimal-1708.iso\n-rw-r--r-- 1 root root      1191 3月  12 20:13 ks.cfg\n-rw-r--r-- 1 pi   pi         705 3月  12 19:56 menu.conf\n-rw-r--r-- 1 root root     67369 3月  12 21:00 undionly.kpxe\n```\n\n\n\n编写启动菜单menu.conf，内容如下：\n\n```config\n#!ipxe\n    set menu-timeout 20000\n    set munu-default winpe\n    set protocal:string http\n    isset ${ip} || dhcp\n:start\n    menu iPXE Boot Menu --${ip}\n    item  winpe         Boot WindowsPE\n    item centos7        Boot CentOS\n    item shell          Boot iPXE Shell\n    choose --timeout ${menu-timeout} --default ${menu-default} selected\n    goto ${selected}\n:centos7\n    #set base http://mirrors.aliyun.com/centos/7.4.1708/os/x86_64\n    set base http://192.168.2.189/centos/7/x86_64\n    kernel ${base}/images/pxeboot/vmlinuz initrd=initrd.img ks=http://192.168.2.189/ks.cfg repo=${base}\n    initrd ${base}/images/pxeboot/initrd.img\n    boot\n:winpe\n    kernel ${protocal}://${next-server}/boot/wimboot\n```\n\n编辑dnsmasq配置文件，使其支持pxe，让它能够根据网卡不同的请求发送不同的boot file。由于我的电脑和树莓派都接在一台openwrt路由器下边，路由器已经开启了DHCP功能，为了不对路由器本身的DHCP功能造成影响，我的pxe服务器上的dnsmasq配置为proxy模式，只对pxe请求作出响应，普通的DHCP请求分配IP地址不作响应。话说为了这个配置文件我真是搜索了好多资料，也经过了无数次的尝试，总是在iPXE固件的第二次DHCP请求时无法发送菜单内容过去，卡住了很久，最终在谷歌的帮助下，搜索到一篇文章，用他的配置终于成功了。\n\n```shell\nno-daemon  #不作为守护进程，保持在前台，便于调试，正常使用时可去掉\ndhcp-range=192.168.2.0,proxy #自己所在的需要代理的网段，我的是192.168.2.0\ndhcp-boot=tag:!ipxe,undionly.kpxe,192.168.2.189 #如果不是ipxe固件发起的，则发送undionly.kpxe\ndhcp-match=set:ipxe,175 # gPXE/iPXE sends a 175 option.\ndhcp-boot=tag:!ipxe,undionly.kpxe \ndhcp-boot=http://192.168.2.189/menu.conf,192.168.2.189,192.168.2.189 #如果是ipxe发起的请求，则发送菜单链接，后边两个ip为pxe服务器ip\npxe-service=tag:!ipxe,x86PC,\"splash\",undionly.kpxe #对所有的pxe请求做出响应，发送undionly.kcpxe\nenable-tftp #开启tftp\ntftp-root=/var/www/html/  #设置tftp的根目录\nlog-queries  #打印所有dhcp请求，用于调试\nconf-dir=/etc/dnsmasq.d  #包含的其他配置\n```\n\n#### 服务测试\n\n开启dnsmasq服务：\n\n```shell\npi@raspberrypi:~/pxe_start $ sudo dnsmasq -C proxy_dhcp \ndnsmasq: started, version 2.76 cachesize 150\ndnsmasq: compile time options: IPv6 GNU-getopt DBus i18n IDN DHCP DHCPv6 no-Lua TFTP conntrack ipset auth DNSSEC loop-detect inotify\ndnsmasq-dhcp: DHCP, proxy on subnet 192.168.2.0\ndnsmasq-tftp: TFTP root is /var/www/html/ \ndnsmasq: reading /etc/resolv.conf\ndnsmasq: using nameserver 192.168.2.1#53\ndnsmasq: read /etc/hosts - 5 addresses\n\n```\n\n开启nginx服务：\n\n```shell\npi@raspberrypi:~/pxe_start $ sudo nginx\n```\n\n建立虚拟机，设置网络模式为桥接。\n\nvmare的启动效果：\n\n![image](/blogimg/vmware_ipxe.gif)\n\nvbox启动效果图：\n\n![imange](/blogimg/vbox_ipxe.gif)\n\n#### CentOS无人职守自动安装\n\n在一台有图形界面的机器上安装kickstart，然后按照提示生成ks.cfg文件。我的ks.cfg是从一台已经安装好的centos上提取的，内容如下：\n\n```config\n#platform=86, AMD64, or Intel EM64T\n\n#version=DEVEL\n# System authorization information\nauth --useshadow  --passalgo=sha512\n# Install OS instead of upgrade\ninstall\n# Use network installation\nurl --url=\"http://192.168.2.189/centos/7/x86_64/\"\n# Use text mode install\ntext\n# Firewall configuration\nfirewall --disabled\nfirstboot --disable\nignoredisk --only-use=sda\n# Keyboard layouts\n# old format: keyboard us\n# new format:\nkeyboard --vckeymap=us --xlayouts=''\n# System language\nlang en_US.UTF-8\n\n# Network information\nnetwork  --bootproto=dhcp --device=eth0 --activate\nnetwork  --hostname=localhost.localdomain\n# Reboot after installation\nreboot\n# Root password\nrootpw --iscrypted $1$.iNc/OT7$5cYmijQ4G5pBjxC8sgAIJ/\n# SELinux configuration\nselinux --enforcing\n# System services\nservices --enabled=\"chronyd\"\n# Do not configure the X Window System\nskipx\n# System timezone\ntimezone Asia/Shanghai\n# System bootloader configuration\nbootloader --append=\" crashkernel=auto\" --location=mbr --boot-drive=sda\nautopart --type=lvm\n# Partition clearing information\nclearpart --all --initlabel --drives=sda\n\n%packages\n@core\nchrony\nkexec-tools\n\n%end\n\n%addon com_redhat_kdump --enable --reserve-mb='auto'\n\n%end\n\n```\n\n要实现自动安装，在启动菜单中给个内核参数即可\n\n```config\nkernel ${base}/images/pxeboot/vmlinuz initrd=initrd.img ks=http://192.168.2.189/ks.cfg \n```\n\n自此，pxe启动自动安装centos搭建完成，接下来再尝试启动其它系统和winpe。\n\n参考链接：\n\nhttps://dev.to/arachan/ipxe-chainloading-to-use-dnsmasq-and-proxydhcp-4he","source":"_posts/iPXE-NetworkBoot.md","raw":"---\ntitle: 树莓派搭建iPXE服务并实现无人职守安装CentOS 7\ncategories:\n  - Linux\ntags:\n  - iPXE netboot\ndate: 2018-03-13 11:39:55\n---\n\n最近我对网络启动产生了浓厚的兴趣，很想亲自搭建一个环境来尝试一下，于是就有了一系列的折腾过程。本篇记录的是使用iPXE来网络启动，自动安装CentOS系统。\n\n<!--more-->\n\n#### 基本技术介绍\n\nPXE:\n\n​    PXE(preboot execute environment，预启动执行环境)是由Intel公司开发的最新技术，工作于Client/Server的网络模式，支持工作站通过网络从远端服务器下载映像，并由此支持通过网络启动操作系统，在启动过程中，终端要求服务器分配IP地址，再用TFTP（trivial file transfer protocol）或MTFTP(multicast trivial file transfer protocol)协议下载一个启动软件包到本机内存中执行，由这个启动软件包完成终端（客户端）基本软件设置，从而引导预先安装在服务器中的终端操作系统。PXE可以引导多种操作系统，如:Windows95/98/2000/windows2003/windows2008/winXP/win7/win8,linux系列系统等。\n\niPXE:\n\n​    iPXE is the leading open source network boot firmware. It provides a full PXE implementation enhanced with additional features such as:\n\nboot from a web server via HTTP\nboot from an iSCSI SAN\nboot from a Fibre Channel SAN via FCoE\nboot from an AoE SAN\nboot from a wireless network\nboot from a wide-area network\nboot from an Infiniband network\ncontrol the boot process with a script\nYou can use iPXE to replace the existing PXE ROM on your network card, or you can chainload into iPXE to obtain the features of iPXE without the hassle of reflashing.\n\niPXE is free, open-source software licensed under the GNU GPL (with some portions under GPL-compatible licences), and is included in products from several network card manufacturers and OEMs.\n\niPXE是一个开源的网络启动固件，它使用了诸如http,ftp等协议来传输，相较于普通的PXE固件使用TFTP来进行文件传输速度更快，而且还支持烧录到网卡芯片，CD-ROM，U盘上，有了它，只要有网络的地方就可以启动机器进行系统维护或者系统安装了。\n\niPXE官网地址：http://ipxe.org   该项目开源，可以自己克隆代码进行编译。\n\n#### 软硬件环境准备\n\n硬件：树莓派3，提供系统支持，用作启动服务器。当然，如果有其它Linux系统的电脑也是可以的。\n\n软件：nginx，作为web服务器，提供系统镜像，本地软件源。dnsmasq，dnsmasq自身带有tftp服务器，支持pxe，支持dhcpPROXY模式，有了它就不用再去安装单独的dhcp服务器和tftp服务器了。\n\n安装软件：\n\n```shell\npi@raspberrypi:~ $ sudo apt-get instal nginx\npi@raspberrypi:~ $ sudo apt-get instal dnsmasq\n```\n\n#### 准备所需的系统镜像和pxe文件\n\n下载CentOS7系统镜像，并复制相应文件到web目录：\n\n```shell\npi@raspberrypi:~ $ wget https://mirrors.aliyun.com/centos/7.4.1708/isos/x86_64/CentOS-7-x86_64-Minimal-1708.iso\npi@raspberrypi:~ $ mount CentOS-7-x86_64-Minimal-1708.iso /mnt\npi@raspberrypi:~ $ sudo mkdir -p /var/www/html/centos/7/x86_64/\npi@raspberrypi:~ $ sudo cp -r /mnt/* /var/www/html/centos/7/x86_64/\n```\n\n下载iPXE相关的启动文件到web目录\n\n```shell\npi@raspberrypi:/var/www/html $ sudo wget http://boot.ipxe.org/undionly.kpxe\n```\n\n现在我的web根目录的文件内容：\n\n```shell\npi@raspberrypi:/var/www/html $ ls -la\n总用量 811112\ndrwxr-xr-x 3 root root      4096 3月  12 21:53 .\ndrwxr-xr-x 3 root root      4096 10月 21 09:31 ..\n-rw-r--r-- 1 root root        43 3月  12 21:52 boot.txt\ndrwxr-xr-x 3 pi   pi        4096 3月  12 15:23 centos\n-rw-r--r-- 1 pi   pi   830472192 9月   5  2017 CentOS-7-x86_64-Minimal-1708.iso\n-rw-r--r-- 1 root root      1191 3月  12 20:13 ks.cfg\n-rw-r--r-- 1 pi   pi         705 3月  12 19:56 menu.conf\n-rw-r--r-- 1 root root     67369 3月  12 21:00 undionly.kpxe\n```\n\n\n\n编写启动菜单menu.conf，内容如下：\n\n```config\n#!ipxe\n    set menu-timeout 20000\n    set munu-default winpe\n    set protocal:string http\n    isset ${ip} || dhcp\n:start\n    menu iPXE Boot Menu --${ip}\n    item  winpe         Boot WindowsPE\n    item centos7        Boot CentOS\n    item shell          Boot iPXE Shell\n    choose --timeout ${menu-timeout} --default ${menu-default} selected\n    goto ${selected}\n:centos7\n    #set base http://mirrors.aliyun.com/centos/7.4.1708/os/x86_64\n    set base http://192.168.2.189/centos/7/x86_64\n    kernel ${base}/images/pxeboot/vmlinuz initrd=initrd.img ks=http://192.168.2.189/ks.cfg repo=${base}\n    initrd ${base}/images/pxeboot/initrd.img\n    boot\n:winpe\n    kernel ${protocal}://${next-server}/boot/wimboot\n```\n\n编辑dnsmasq配置文件，使其支持pxe，让它能够根据网卡不同的请求发送不同的boot file。由于我的电脑和树莓派都接在一台openwrt路由器下边，路由器已经开启了DHCP功能，为了不对路由器本身的DHCP功能造成影响，我的pxe服务器上的dnsmasq配置为proxy模式，只对pxe请求作出响应，普通的DHCP请求分配IP地址不作响应。话说为了这个配置文件我真是搜索了好多资料，也经过了无数次的尝试，总是在iPXE固件的第二次DHCP请求时无法发送菜单内容过去，卡住了很久，最终在谷歌的帮助下，搜索到一篇文章，用他的配置终于成功了。\n\n```shell\nno-daemon  #不作为守护进程，保持在前台，便于调试，正常使用时可去掉\ndhcp-range=192.168.2.0,proxy #自己所在的需要代理的网段，我的是192.168.2.0\ndhcp-boot=tag:!ipxe,undionly.kpxe,192.168.2.189 #如果不是ipxe固件发起的，则发送undionly.kpxe\ndhcp-match=set:ipxe,175 # gPXE/iPXE sends a 175 option.\ndhcp-boot=tag:!ipxe,undionly.kpxe \ndhcp-boot=http://192.168.2.189/menu.conf,192.168.2.189,192.168.2.189 #如果是ipxe发起的请求，则发送菜单链接，后边两个ip为pxe服务器ip\npxe-service=tag:!ipxe,x86PC,\"splash\",undionly.kpxe #对所有的pxe请求做出响应，发送undionly.kcpxe\nenable-tftp #开启tftp\ntftp-root=/var/www/html/  #设置tftp的根目录\nlog-queries  #打印所有dhcp请求，用于调试\nconf-dir=/etc/dnsmasq.d  #包含的其他配置\n```\n\n#### 服务测试\n\n开启dnsmasq服务：\n\n```shell\npi@raspberrypi:~/pxe_start $ sudo dnsmasq -C proxy_dhcp \ndnsmasq: started, version 2.76 cachesize 150\ndnsmasq: compile time options: IPv6 GNU-getopt DBus i18n IDN DHCP DHCPv6 no-Lua TFTP conntrack ipset auth DNSSEC loop-detect inotify\ndnsmasq-dhcp: DHCP, proxy on subnet 192.168.2.0\ndnsmasq-tftp: TFTP root is /var/www/html/ \ndnsmasq: reading /etc/resolv.conf\ndnsmasq: using nameserver 192.168.2.1#53\ndnsmasq: read /etc/hosts - 5 addresses\n\n```\n\n开启nginx服务：\n\n```shell\npi@raspberrypi:~/pxe_start $ sudo nginx\n```\n\n建立虚拟机，设置网络模式为桥接。\n\nvmare的启动效果：\n\n![image](/blogimg/vmware_ipxe.gif)\n\nvbox启动效果图：\n\n![imange](/blogimg/vbox_ipxe.gif)\n\n#### CentOS无人职守自动安装\n\n在一台有图形界面的机器上安装kickstart，然后按照提示生成ks.cfg文件。我的ks.cfg是从一台已经安装好的centos上提取的，内容如下：\n\n```config\n#platform=86, AMD64, or Intel EM64T\n\n#version=DEVEL\n# System authorization information\nauth --useshadow  --passalgo=sha512\n# Install OS instead of upgrade\ninstall\n# Use network installation\nurl --url=\"http://192.168.2.189/centos/7/x86_64/\"\n# Use text mode install\ntext\n# Firewall configuration\nfirewall --disabled\nfirstboot --disable\nignoredisk --only-use=sda\n# Keyboard layouts\n# old format: keyboard us\n# new format:\nkeyboard --vckeymap=us --xlayouts=''\n# System language\nlang en_US.UTF-8\n\n# Network information\nnetwork  --bootproto=dhcp --device=eth0 --activate\nnetwork  --hostname=localhost.localdomain\n# Reboot after installation\nreboot\n# Root password\nrootpw --iscrypted $1$.iNc/OT7$5cYmijQ4G5pBjxC8sgAIJ/\n# SELinux configuration\nselinux --enforcing\n# System services\nservices --enabled=\"chronyd\"\n# Do not configure the X Window System\nskipx\n# System timezone\ntimezone Asia/Shanghai\n# System bootloader configuration\nbootloader --append=\" crashkernel=auto\" --location=mbr --boot-drive=sda\nautopart --type=lvm\n# Partition clearing information\nclearpart --all --initlabel --drives=sda\n\n%packages\n@core\nchrony\nkexec-tools\n\n%end\n\n%addon com_redhat_kdump --enable --reserve-mb='auto'\n\n%end\n\n```\n\n要实现自动安装，在启动菜单中给个内核参数即可\n\n```config\nkernel ${base}/images/pxeboot/vmlinuz initrd=initrd.img ks=http://192.168.2.189/ks.cfg \n```\n\n自此，pxe启动自动安装centos搭建完成，接下来再尝试启动其它系统和winpe。\n\n参考链接：\n\nhttps://dev.to/arachan/ipxe-chainloading-to-use-dnsmasq-and-proxydhcp-4he","slug":"iPXE-NetworkBoot","published":1,"updated":"2018-03-14T02:15:59.759Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjeqig1qy005mlgqa1i65gxfg","content":"<p>最近我对网络启动产生了浓厚的兴趣，很想亲自搭建一个环境来尝试一下，于是就有了一系列的折腾过程。本篇记录的是使用iPXE来网络启动，自动安装CentOS系统。</p>\n<a id=\"more\"></a>\n<h4 id=\"基本技术介绍\"><a href=\"#基本技术介绍\" class=\"headerlink\" title=\"基本技术介绍\"></a>基本技术介绍</h4><p>PXE:</p>\n<p>​    PXE(preboot execute environment，预启动执行环境)是由Intel公司开发的最新技术，工作于Client/Server的网络模式，支持工作站通过网络从远端服务器下载映像，并由此支持通过网络启动操作系统，在启动过程中，终端要求服务器分配IP地址，再用TFTP（trivial file transfer protocol）或MTFTP(multicast trivial file transfer protocol)协议下载一个启动软件包到本机内存中执行，由这个启动软件包完成终端（客户端）基本软件设置，从而引导预先安装在服务器中的终端操作系统。PXE可以引导多种操作系统，如:Windows95/98/2000/windows2003/windows2008/winXP/win7/win8,linux系列系统等。</p>\n<p>iPXE:</p>\n<p>​    iPXE is the leading open source network boot firmware. It provides a full PXE implementation enhanced with additional features such as:</p>\n<p>boot from a web server via HTTP<br>boot from an iSCSI SAN<br>boot from a Fibre Channel SAN via FCoE<br>boot from an AoE SAN<br>boot from a wireless network<br>boot from a wide-area network<br>boot from an Infiniband network<br>control the boot process with a script<br>You can use iPXE to replace the existing PXE ROM on your network card, or you can chainload into iPXE to obtain the features of iPXE without the hassle of reflashing.</p>\n<p>iPXE is free, open-source software licensed under the GNU GPL (with some portions under GPL-compatible licences), and is included in products from several network card manufacturers and OEMs.</p>\n<p>iPXE是一个开源的网络启动固件，它使用了诸如http,ftp等协议来传输，相较于普通的PXE固件使用TFTP来进行文件传输速度更快，而且还支持烧录到网卡芯片，CD-ROM，U盘上，有了它，只要有网络的地方就可以启动机器进行系统维护或者系统安装了。</p>\n<p>iPXE官网地址：<a href=\"http://ipxe.org\" target=\"_blank\" rel=\"noopener\">http://ipxe.org</a>   该项目开源，可以自己克隆代码进行编译。</p>\n<h4 id=\"软硬件环境准备\"><a href=\"#软硬件环境准备\" class=\"headerlink\" title=\"软硬件环境准备\"></a>软硬件环境准备</h4><p>硬件：树莓派3，提供系统支持，用作启动服务器。当然，如果有其它Linux系统的电脑也是可以的。</p>\n<p>软件：nginx，作为web服务器，提供系统镜像，本地软件源。dnsmasq，dnsmasq自身带有tftp服务器，支持pxe，支持dhcpPROXY模式，有了它就不用再去安装单独的dhcp服务器和tftp服务器了。</p>\n<p>安装软件：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pi@raspberrypi:~ $ sudo apt-get instal nginx</span><br><span class=\"line\">pi@raspberrypi:~ $ sudo apt-get instal dnsmasq</span><br></pre></td></tr></table></figure>\n<h4 id=\"准备所需的系统镜像和pxe文件\"><a href=\"#准备所需的系统镜像和pxe文件\" class=\"headerlink\" title=\"准备所需的系统镜像和pxe文件\"></a>准备所需的系统镜像和pxe文件</h4><p>下载CentOS7系统镜像，并复制相应文件到web目录：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pi@raspberrypi:~ $ wget https://mirrors.aliyun.com/centos/7.4.1708/isos/x86_64/CentOS-7-x86_64-Minimal-1708.iso</span><br><span class=\"line\">pi@raspberrypi:~ $ mount CentOS-7-x86_64-Minimal-1708.iso /mnt</span><br><span class=\"line\">pi@raspberrypi:~ $ sudo mkdir -p /var/www/html/centos/7/x86_64/</span><br><span class=\"line\">pi@raspberrypi:~ $ sudo cp -r /mnt/* /var/www/html/centos/7/x86_64/</span><br></pre></td></tr></table></figure>\n<p>下载iPXE相关的启动文件到web目录</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pi@raspberrypi:/var/www/html $ sudo wget http://boot.ipxe.org/undionly.kpxe</span><br></pre></td></tr></table></figure>\n<p>现在我的web根目录的文件内容：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pi@raspberrypi:/var/www/html $ ls -la</span><br><span class=\"line\">总用量 811112</span><br><span class=\"line\">drwxr-xr-x 3 root root      4096 3月  12 21:53 .</span><br><span class=\"line\">drwxr-xr-x 3 root root      4096 10月 21 09:31 ..</span><br><span class=\"line\">-rw-r--r-- 1 root root        43 3月  12 21:52 boot.txt</span><br><span class=\"line\">drwxr-xr-x 3 pi   pi        4096 3月  12 15:23 centos</span><br><span class=\"line\">-rw-r--r-- 1 pi   pi   830472192 9月   5  2017 CentOS-7-x86_64-Minimal-1708.iso</span><br><span class=\"line\">-rw-r--r-- 1 root root      1191 3月  12 20:13 ks.cfg</span><br><span class=\"line\">-rw-r--r-- 1 pi   pi         705 3月  12 19:56 menu.conf</span><br><span class=\"line\">-rw-r--r-- 1 root root     67369 3月  12 21:00 undionly.kpxe</span><br></pre></td></tr></table></figure>\n<p>编写启动菜单menu.conf，内容如下：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#!ipxe</span><br><span class=\"line\">    set menu-timeout 20000</span><br><span class=\"line\">    set munu-default winpe</span><br><span class=\"line\">    set protocal:string http</span><br><span class=\"line\">    isset $&#123;ip&#125; || dhcp</span><br><span class=\"line\">:start</span><br><span class=\"line\">    menu iPXE Boot Menu --$&#123;ip&#125;</span><br><span class=\"line\">    item  winpe         Boot WindowsPE</span><br><span class=\"line\">    item centos7        Boot CentOS</span><br><span class=\"line\">    item shell          Boot iPXE Shell</span><br><span class=\"line\">    choose --timeout $&#123;menu-timeout&#125; --default $&#123;menu-default&#125; selected</span><br><span class=\"line\">    goto $&#123;selected&#125;</span><br><span class=\"line\">:centos7</span><br><span class=\"line\">    #set base http://mirrors.aliyun.com/centos/7.4.1708/os/x86_64</span><br><span class=\"line\">    set base http://192.168.2.189/centos/7/x86_64</span><br><span class=\"line\">    kernel $&#123;base&#125;/images/pxeboot/vmlinuz initrd=initrd.img ks=http://192.168.2.189/ks.cfg repo=$&#123;base&#125;</span><br><span class=\"line\">    initrd $&#123;base&#125;/images/pxeboot/initrd.img</span><br><span class=\"line\">    boot</span><br><span class=\"line\">:winpe</span><br><span class=\"line\">    kernel $&#123;protocal&#125;://$&#123;next-server&#125;/boot/wimboot</span><br></pre></td></tr></table></figure>\n<p>编辑dnsmasq配置文件，使其支持pxe，让它能够根据网卡不同的请求发送不同的boot file。由于我的电脑和树莓派都接在一台openwrt路由器下边，路由器已经开启了DHCP功能，为了不对路由器本身的DHCP功能造成影响，我的pxe服务器上的dnsmasq配置为proxy模式，只对pxe请求作出响应，普通的DHCP请求分配IP地址不作响应。话说为了这个配置文件我真是搜索了好多资料，也经过了无数次的尝试，总是在iPXE固件的第二次DHCP请求时无法发送菜单内容过去，卡住了很久，最终在谷歌的帮助下，搜索到一篇文章，用他的配置终于成功了。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">no-daemon  #不作为守护进程，保持在前台，便于调试，正常使用时可去掉</span><br><span class=\"line\">dhcp-range=192.168.2.0,proxy #自己所在的需要代理的网段，我的是192.168.2.0</span><br><span class=\"line\">dhcp-boot=tag:!ipxe,undionly.kpxe,192.168.2.189 #如果不是ipxe固件发起的，则发送undionly.kpxe</span><br><span class=\"line\">dhcp-match=set:ipxe,175 # gPXE/iPXE sends a 175 option.</span><br><span class=\"line\">dhcp-boot=tag:!ipxe,undionly.kpxe </span><br><span class=\"line\">dhcp-boot=http://192.168.2.189/menu.conf,192.168.2.189,192.168.2.189 #如果是ipxe发起的请求，则发送菜单链接，后边两个ip为pxe服务器ip</span><br><span class=\"line\">pxe-service=tag:!ipxe,x86PC,\"splash\",undionly.kpxe #对所有的pxe请求做出响应，发送undionly.kcpxe</span><br><span class=\"line\">enable-tftp #开启tftp</span><br><span class=\"line\">tftp-root=/var/www/html/  #设置tftp的根目录</span><br><span class=\"line\">log-queries  #打印所有dhcp请求，用于调试</span><br><span class=\"line\">conf-dir=/etc/dnsmasq.d  #包含的其他配置</span><br></pre></td></tr></table></figure>\n<h4 id=\"服务测试\"><a href=\"#服务测试\" class=\"headerlink\" title=\"服务测试\"></a>服务测试</h4><p>开启dnsmasq服务：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pi@raspberrypi:~/pxe_start $ sudo dnsmasq -C proxy_dhcp </span><br><span class=\"line\">dnsmasq: started, version 2.76 cachesize 150</span><br><span class=\"line\">dnsmasq: compile time options: IPv6 GNU-getopt DBus i18n IDN DHCP DHCPv6 no-Lua TFTP conntrack ipset auth DNSSEC loop-detect inotify</span><br><span class=\"line\">dnsmasq-dhcp: DHCP, proxy on subnet 192.168.2.0</span><br><span class=\"line\">dnsmasq-tftp: TFTP root is /var/www/html/ </span><br><span class=\"line\">dnsmasq: reading /etc/resolv.conf</span><br><span class=\"line\">dnsmasq: using nameserver 192.168.2.1#53</span><br><span class=\"line\">dnsmasq: read /etc/hosts - 5 addresses</span><br></pre></td></tr></table></figure>\n<p>开启nginx服务：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pi@raspberrypi:~/pxe_start $ sudo nginx</span><br></pre></td></tr></table></figure>\n<p>建立虚拟机，设置网络模式为桥接。</p>\n<p>vmare的启动效果：</p>\n<p><img src=\"/blogimg/vmware_ipxe.gif\" alt=\"image\"></p>\n<p>vbox启动效果图：</p>\n<p><img src=\"/blogimg/vbox_ipxe.gif\" alt=\"imange\"></p>\n<h4 id=\"CentOS无人职守自动安装\"><a href=\"#CentOS无人职守自动安装\" class=\"headerlink\" title=\"CentOS无人职守自动安装\"></a>CentOS无人职守自动安装</h4><p>在一台有图形界面的机器上安装kickstart，然后按照提示生成ks.cfg文件。我的ks.cfg是从一台已经安装好的centos上提取的，内容如下：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#platform=86, AMD64, or Intel EM64T</span><br><span class=\"line\"></span><br><span class=\"line\">#version=DEVEL</span><br><span class=\"line\"># System authorization information</span><br><span class=\"line\">auth --useshadow  --passalgo=sha512</span><br><span class=\"line\"># Install OS instead of upgrade</span><br><span class=\"line\">install</span><br><span class=\"line\"># Use network installation</span><br><span class=\"line\">url --url=&quot;http://192.168.2.189/centos/7/x86_64/&quot;</span><br><span class=\"line\"># Use text mode install</span><br><span class=\"line\">text</span><br><span class=\"line\"># Firewall configuration</span><br><span class=\"line\">firewall --disabled</span><br><span class=\"line\">firstboot --disable</span><br><span class=\"line\">ignoredisk --only-use=sda</span><br><span class=\"line\"># Keyboard layouts</span><br><span class=\"line\"># old format: keyboard us</span><br><span class=\"line\"># new format:</span><br><span class=\"line\">keyboard --vckeymap=us --xlayouts=&apos;&apos;</span><br><span class=\"line\"># System language</span><br><span class=\"line\">lang en_US.UTF-8</span><br><span class=\"line\"></span><br><span class=\"line\"># Network information</span><br><span class=\"line\">network  --bootproto=dhcp --device=eth0 --activate</span><br><span class=\"line\">network  --hostname=localhost.localdomain</span><br><span class=\"line\"># Reboot after installation</span><br><span class=\"line\">reboot</span><br><span class=\"line\"># Root password</span><br><span class=\"line\">rootpw --iscrypted $1$.iNc/OT7$5cYmijQ4G5pBjxC8sgAIJ/</span><br><span class=\"line\"># SELinux configuration</span><br><span class=\"line\">selinux --enforcing</span><br><span class=\"line\"># System services</span><br><span class=\"line\">services --enabled=&quot;chronyd&quot;</span><br><span class=\"line\"># Do not configure the X Window System</span><br><span class=\"line\">skipx</span><br><span class=\"line\"># System timezone</span><br><span class=\"line\">timezone Asia/Shanghai</span><br><span class=\"line\"># System bootloader configuration</span><br><span class=\"line\">bootloader --append=&quot; crashkernel=auto&quot; --location=mbr --boot-drive=sda</span><br><span class=\"line\">autopart --type=lvm</span><br><span class=\"line\"># Partition clearing information</span><br><span class=\"line\">clearpart --all --initlabel --drives=sda</span><br><span class=\"line\"></span><br><span class=\"line\">%packages</span><br><span class=\"line\">@core</span><br><span class=\"line\">chrony</span><br><span class=\"line\">kexec-tools</span><br><span class=\"line\"></span><br><span class=\"line\">%end</span><br><span class=\"line\"></span><br><span class=\"line\">%addon com_redhat_kdump --enable --reserve-mb=&apos;auto&apos;</span><br><span class=\"line\"></span><br><span class=\"line\">%end</span><br></pre></td></tr></table></figure>\n<p>要实现自动安装，在启动菜单中给个内核参数即可</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kernel $&#123;base&#125;/images/pxeboot/vmlinuz initrd=initrd.img ks=http://192.168.2.189/ks.cfg</span><br></pre></td></tr></table></figure>\n<p>自此，pxe启动自动安装centos搭建完成，接下来再尝试启动其它系统和winpe。</p>\n<p>参考链接：</p>\n<p><a href=\"https://dev.to/arachan/ipxe-chainloading-to-use-dnsmasq-and-proxydhcp-4he\" target=\"_blank\" rel=\"noopener\">https://dev.to/arachan/ipxe-chainloading-to-use-dnsmasq-and-proxydhcp-4he</a></p>\n","site":{"data":{}},"excerpt":"<p>最近我对网络启动产生了浓厚的兴趣，很想亲自搭建一个环境来尝试一下，于是就有了一系列的折腾过程。本篇记录的是使用iPXE来网络启动，自动安装CentOS系统。</p>","more":"<h4 id=\"基本技术介绍\"><a href=\"#基本技术介绍\" class=\"headerlink\" title=\"基本技术介绍\"></a>基本技术介绍</h4><p>PXE:</p>\n<p>​    PXE(preboot execute environment，预启动执行环境)是由Intel公司开发的最新技术，工作于Client/Server的网络模式，支持工作站通过网络从远端服务器下载映像，并由此支持通过网络启动操作系统，在启动过程中，终端要求服务器分配IP地址，再用TFTP（trivial file transfer protocol）或MTFTP(multicast trivial file transfer protocol)协议下载一个启动软件包到本机内存中执行，由这个启动软件包完成终端（客户端）基本软件设置，从而引导预先安装在服务器中的终端操作系统。PXE可以引导多种操作系统，如:Windows95/98/2000/windows2003/windows2008/winXP/win7/win8,linux系列系统等。</p>\n<p>iPXE:</p>\n<p>​    iPXE is the leading open source network boot firmware. It provides a full PXE implementation enhanced with additional features such as:</p>\n<p>boot from a web server via HTTP<br>boot from an iSCSI SAN<br>boot from a Fibre Channel SAN via FCoE<br>boot from an AoE SAN<br>boot from a wireless network<br>boot from a wide-area network<br>boot from an Infiniband network<br>control the boot process with a script<br>You can use iPXE to replace the existing PXE ROM on your network card, or you can chainload into iPXE to obtain the features of iPXE without the hassle of reflashing.</p>\n<p>iPXE is free, open-source software licensed under the GNU GPL (with some portions under GPL-compatible licences), and is included in products from several network card manufacturers and OEMs.</p>\n<p>iPXE是一个开源的网络启动固件，它使用了诸如http,ftp等协议来传输，相较于普通的PXE固件使用TFTP来进行文件传输速度更快，而且还支持烧录到网卡芯片，CD-ROM，U盘上，有了它，只要有网络的地方就可以启动机器进行系统维护或者系统安装了。</p>\n<p>iPXE官网地址：<a href=\"http://ipxe.org\" target=\"_blank\" rel=\"noopener\">http://ipxe.org</a>   该项目开源，可以自己克隆代码进行编译。</p>\n<h4 id=\"软硬件环境准备\"><a href=\"#软硬件环境准备\" class=\"headerlink\" title=\"软硬件环境准备\"></a>软硬件环境准备</h4><p>硬件：树莓派3，提供系统支持，用作启动服务器。当然，如果有其它Linux系统的电脑也是可以的。</p>\n<p>软件：nginx，作为web服务器，提供系统镜像，本地软件源。dnsmasq，dnsmasq自身带有tftp服务器，支持pxe，支持dhcpPROXY模式，有了它就不用再去安装单独的dhcp服务器和tftp服务器了。</p>\n<p>安装软件：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pi@raspberrypi:~ $ sudo apt-get instal nginx</span><br><span class=\"line\">pi@raspberrypi:~ $ sudo apt-get instal dnsmasq</span><br></pre></td></tr></table></figure>\n<h4 id=\"准备所需的系统镜像和pxe文件\"><a href=\"#准备所需的系统镜像和pxe文件\" class=\"headerlink\" title=\"准备所需的系统镜像和pxe文件\"></a>准备所需的系统镜像和pxe文件</h4><p>下载CentOS7系统镜像，并复制相应文件到web目录：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pi@raspberrypi:~ $ wget https://mirrors.aliyun.com/centos/7.4.1708/isos/x86_64/CentOS-7-x86_64-Minimal-1708.iso</span><br><span class=\"line\">pi@raspberrypi:~ $ mount CentOS-7-x86_64-Minimal-1708.iso /mnt</span><br><span class=\"line\">pi@raspberrypi:~ $ sudo mkdir -p /var/www/html/centos/7/x86_64/</span><br><span class=\"line\">pi@raspberrypi:~ $ sudo cp -r /mnt/* /var/www/html/centos/7/x86_64/</span><br></pre></td></tr></table></figure>\n<p>下载iPXE相关的启动文件到web目录</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pi@raspberrypi:/var/www/html $ sudo wget http://boot.ipxe.org/undionly.kpxe</span><br></pre></td></tr></table></figure>\n<p>现在我的web根目录的文件内容：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pi@raspberrypi:/var/www/html $ ls -la</span><br><span class=\"line\">总用量 811112</span><br><span class=\"line\">drwxr-xr-x 3 root root      4096 3月  12 21:53 .</span><br><span class=\"line\">drwxr-xr-x 3 root root      4096 10月 21 09:31 ..</span><br><span class=\"line\">-rw-r--r-- 1 root root        43 3月  12 21:52 boot.txt</span><br><span class=\"line\">drwxr-xr-x 3 pi   pi        4096 3月  12 15:23 centos</span><br><span class=\"line\">-rw-r--r-- 1 pi   pi   830472192 9月   5  2017 CentOS-7-x86_64-Minimal-1708.iso</span><br><span class=\"line\">-rw-r--r-- 1 root root      1191 3月  12 20:13 ks.cfg</span><br><span class=\"line\">-rw-r--r-- 1 pi   pi         705 3月  12 19:56 menu.conf</span><br><span class=\"line\">-rw-r--r-- 1 root root     67369 3月  12 21:00 undionly.kpxe</span><br></pre></td></tr></table></figure>\n<p>编写启动菜单menu.conf，内容如下：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#!ipxe</span><br><span class=\"line\">    set menu-timeout 20000</span><br><span class=\"line\">    set munu-default winpe</span><br><span class=\"line\">    set protocal:string http</span><br><span class=\"line\">    isset $&#123;ip&#125; || dhcp</span><br><span class=\"line\">:start</span><br><span class=\"line\">    menu iPXE Boot Menu --$&#123;ip&#125;</span><br><span class=\"line\">    item  winpe         Boot WindowsPE</span><br><span class=\"line\">    item centos7        Boot CentOS</span><br><span class=\"line\">    item shell          Boot iPXE Shell</span><br><span class=\"line\">    choose --timeout $&#123;menu-timeout&#125; --default $&#123;menu-default&#125; selected</span><br><span class=\"line\">    goto $&#123;selected&#125;</span><br><span class=\"line\">:centos7</span><br><span class=\"line\">    #set base http://mirrors.aliyun.com/centos/7.4.1708/os/x86_64</span><br><span class=\"line\">    set base http://192.168.2.189/centos/7/x86_64</span><br><span class=\"line\">    kernel $&#123;base&#125;/images/pxeboot/vmlinuz initrd=initrd.img ks=http://192.168.2.189/ks.cfg repo=$&#123;base&#125;</span><br><span class=\"line\">    initrd $&#123;base&#125;/images/pxeboot/initrd.img</span><br><span class=\"line\">    boot</span><br><span class=\"line\">:winpe</span><br><span class=\"line\">    kernel $&#123;protocal&#125;://$&#123;next-server&#125;/boot/wimboot</span><br></pre></td></tr></table></figure>\n<p>编辑dnsmasq配置文件，使其支持pxe，让它能够根据网卡不同的请求发送不同的boot file。由于我的电脑和树莓派都接在一台openwrt路由器下边，路由器已经开启了DHCP功能，为了不对路由器本身的DHCP功能造成影响，我的pxe服务器上的dnsmasq配置为proxy模式，只对pxe请求作出响应，普通的DHCP请求分配IP地址不作响应。话说为了这个配置文件我真是搜索了好多资料，也经过了无数次的尝试，总是在iPXE固件的第二次DHCP请求时无法发送菜单内容过去，卡住了很久，最终在谷歌的帮助下，搜索到一篇文章，用他的配置终于成功了。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">no-daemon  #不作为守护进程，保持在前台，便于调试，正常使用时可去掉</span><br><span class=\"line\">dhcp-range=192.168.2.0,proxy #自己所在的需要代理的网段，我的是192.168.2.0</span><br><span class=\"line\">dhcp-boot=tag:!ipxe,undionly.kpxe,192.168.2.189 #如果不是ipxe固件发起的，则发送undionly.kpxe</span><br><span class=\"line\">dhcp-match=set:ipxe,175 # gPXE/iPXE sends a 175 option.</span><br><span class=\"line\">dhcp-boot=tag:!ipxe,undionly.kpxe </span><br><span class=\"line\">dhcp-boot=http://192.168.2.189/menu.conf,192.168.2.189,192.168.2.189 #如果是ipxe发起的请求，则发送菜单链接，后边两个ip为pxe服务器ip</span><br><span class=\"line\">pxe-service=tag:!ipxe,x86PC,\"splash\",undionly.kpxe #对所有的pxe请求做出响应，发送undionly.kcpxe</span><br><span class=\"line\">enable-tftp #开启tftp</span><br><span class=\"line\">tftp-root=/var/www/html/  #设置tftp的根目录</span><br><span class=\"line\">log-queries  #打印所有dhcp请求，用于调试</span><br><span class=\"line\">conf-dir=/etc/dnsmasq.d  #包含的其他配置</span><br></pre></td></tr></table></figure>\n<h4 id=\"服务测试\"><a href=\"#服务测试\" class=\"headerlink\" title=\"服务测试\"></a>服务测试</h4><p>开启dnsmasq服务：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pi@raspberrypi:~/pxe_start $ sudo dnsmasq -C proxy_dhcp </span><br><span class=\"line\">dnsmasq: started, version 2.76 cachesize 150</span><br><span class=\"line\">dnsmasq: compile time options: IPv6 GNU-getopt DBus i18n IDN DHCP DHCPv6 no-Lua TFTP conntrack ipset auth DNSSEC loop-detect inotify</span><br><span class=\"line\">dnsmasq-dhcp: DHCP, proxy on subnet 192.168.2.0</span><br><span class=\"line\">dnsmasq-tftp: TFTP root is /var/www/html/ </span><br><span class=\"line\">dnsmasq: reading /etc/resolv.conf</span><br><span class=\"line\">dnsmasq: using nameserver 192.168.2.1#53</span><br><span class=\"line\">dnsmasq: read /etc/hosts - 5 addresses</span><br></pre></td></tr></table></figure>\n<p>开启nginx服务：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pi@raspberrypi:~/pxe_start $ sudo nginx</span><br></pre></td></tr></table></figure>\n<p>建立虚拟机，设置网络模式为桥接。</p>\n<p>vmare的启动效果：</p>\n<p><img src=\"/blogimg/vmware_ipxe.gif\" alt=\"image\"></p>\n<p>vbox启动效果图：</p>\n<p><img src=\"/blogimg/vbox_ipxe.gif\" alt=\"imange\"></p>\n<h4 id=\"CentOS无人职守自动安装\"><a href=\"#CentOS无人职守自动安装\" class=\"headerlink\" title=\"CentOS无人职守自动安装\"></a>CentOS无人职守自动安装</h4><p>在一台有图形界面的机器上安装kickstart，然后按照提示生成ks.cfg文件。我的ks.cfg是从一台已经安装好的centos上提取的，内容如下：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#platform=86, AMD64, or Intel EM64T</span><br><span class=\"line\"></span><br><span class=\"line\">#version=DEVEL</span><br><span class=\"line\"># System authorization information</span><br><span class=\"line\">auth --useshadow  --passalgo=sha512</span><br><span class=\"line\"># Install OS instead of upgrade</span><br><span class=\"line\">install</span><br><span class=\"line\"># Use network installation</span><br><span class=\"line\">url --url=&quot;http://192.168.2.189/centos/7/x86_64/&quot;</span><br><span class=\"line\"># Use text mode install</span><br><span class=\"line\">text</span><br><span class=\"line\"># Firewall configuration</span><br><span class=\"line\">firewall --disabled</span><br><span class=\"line\">firstboot --disable</span><br><span class=\"line\">ignoredisk --only-use=sda</span><br><span class=\"line\"># Keyboard layouts</span><br><span class=\"line\"># old format: keyboard us</span><br><span class=\"line\"># new format:</span><br><span class=\"line\">keyboard --vckeymap=us --xlayouts=&apos;&apos;</span><br><span class=\"line\"># System language</span><br><span class=\"line\">lang en_US.UTF-8</span><br><span class=\"line\"></span><br><span class=\"line\"># Network information</span><br><span class=\"line\">network  --bootproto=dhcp --device=eth0 --activate</span><br><span class=\"line\">network  --hostname=localhost.localdomain</span><br><span class=\"line\"># Reboot after installation</span><br><span class=\"line\">reboot</span><br><span class=\"line\"># Root password</span><br><span class=\"line\">rootpw --iscrypted $1$.iNc/OT7$5cYmijQ4G5pBjxC8sgAIJ/</span><br><span class=\"line\"># SELinux configuration</span><br><span class=\"line\">selinux --enforcing</span><br><span class=\"line\"># System services</span><br><span class=\"line\">services --enabled=&quot;chronyd&quot;</span><br><span class=\"line\"># Do not configure the X Window System</span><br><span class=\"line\">skipx</span><br><span class=\"line\"># System timezone</span><br><span class=\"line\">timezone Asia/Shanghai</span><br><span class=\"line\"># System bootloader configuration</span><br><span class=\"line\">bootloader --append=&quot; crashkernel=auto&quot; --location=mbr --boot-drive=sda</span><br><span class=\"line\">autopart --type=lvm</span><br><span class=\"line\"># Partition clearing information</span><br><span class=\"line\">clearpart --all --initlabel --drives=sda</span><br><span class=\"line\"></span><br><span class=\"line\">%packages</span><br><span class=\"line\">@core</span><br><span class=\"line\">chrony</span><br><span class=\"line\">kexec-tools</span><br><span class=\"line\"></span><br><span class=\"line\">%end</span><br><span class=\"line\"></span><br><span class=\"line\">%addon com_redhat_kdump --enable --reserve-mb=&apos;auto&apos;</span><br><span class=\"line\"></span><br><span class=\"line\">%end</span><br></pre></td></tr></table></figure>\n<p>要实现自动安装，在启动菜单中给个内核参数即可</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kernel $&#123;base&#125;/images/pxeboot/vmlinuz initrd=initrd.img ks=http://192.168.2.189/ks.cfg</span><br></pre></td></tr></table></figure>\n<p>自此，pxe启动自动安装centos搭建完成，接下来再尝试启动其它系统和winpe。</p>\n<p>参考链接：</p>\n<p><a href=\"https://dev.to/arachan/ipxe-chainloading-to-use-dnsmasq-and-proxydhcp-4he\" target=\"_blank\" rel=\"noopener\">https://dev.to/arachan/ipxe-chainloading-to-use-dnsmasq-and-proxydhcp-4he</a></p>"}],"PostAsset":[],"PostCategory":[{"post_id":"cjeqig1iq0002lgqadwf5dd23","category_id":"cjeqig1ix0004lgqafmxnp9hr","_id":"cjeqig1jk000dlgqad8lk05z4"},{"post_id":"cjeqig1iz0006lgqal0rjjmzz","category_id":"cjeqig1ja0009lgqa4uppvsvn","_id":"cjeqig1k1000llgqaci8zt9do"},{"post_id":"cjeqig1jp000glgqagdjxdyjl","category_id":"cjeqig1ja0009lgqa4uppvsvn","_id":"cjeqig1k9000qlgqagfmjfrv2"},{"post_id":"cjeqig1j70007lgqa3sx70y5f","category_id":"cjeqig1ja0009lgqa4uppvsvn","_id":"cjeqig1kf000ulgqaqxbtge53"},{"post_id":"cjeqig1jt000ilgqafn6i5tsn","category_id":"cjeqig1ja0009lgqa4uppvsvn","_id":"cjeqig1ki000wlgqaagq2bk1o"},{"post_id":"cjeqig1k2000nlgqaq680xclg","category_id":"cjeqig1ja0009lgqa4uppvsvn","_id":"cjeqig1km000zlgqaajhh7mj3"},{"post_id":"cjeqig1j80008lgqajk6hm6yb","category_id":"cjeqig1k0000klgqaj3k6fi60","_id":"cjeqig1kq0012lgqaakgnb9z0"},{"post_id":"cjeqig1k6000plgqa3gwggslv","category_id":"cjeqig1ja0009lgqa4uppvsvn","_id":"cjeqig1kt0014lgqaoixidxko"},{"post_id":"cjeqig1kd000tlgqa6il2la4i","category_id":"cjeqig1ja0009lgqa4uppvsvn","_id":"cjeqig1kw0017lgqag36s7bb8"},{"post_id":"cjeqig1jc000blgqa04ubzg8j","category_id":"cjeqig1k0000klgqaj3k6fi60","_id":"cjeqig1kz001algqas7izc8xh"},{"post_id":"cjeqig1kg000vlgqa83680iuv","category_id":"cjeqig1ja0009lgqa4uppvsvn","_id":"cjeqig1l8001elgqacd83xk6w"},{"post_id":"cjeqig1kk000ylgqau67h9fov","category_id":"cjeqig1ja0009lgqa4uppvsvn","_id":"cjeqig1lb001hlgqa1qbkzumt"},{"post_id":"cjeqig1jg000clgqajbgr6pzu","category_id":"cjeqig1k0000klgqaj3k6fi60","_id":"cjeqig1le001klgqaieodv22a"},{"post_id":"cjeqig1ko0011lgqahgvvt64f","category_id":"cjeqig1ja0009lgqa4uppvsvn","_id":"cjeqig1li001nlgqa9yhbxxb4"},{"post_id":"cjeqig1kr0013lgqan5fmpkel","category_id":"cjeqig1ja0009lgqa4uppvsvn","_id":"cjeqig1lo001qlgqa6w5qrhhk"},{"post_id":"cjeqig1ku0016lgqakw75olx8","category_id":"cjeqig1ja0009lgqa4uppvsvn","_id":"cjeqig1ls001tlgqas0dype6l"},{"post_id":"cjeqig1ky0019lgqaom3fl4hu","category_id":"cjeqig1ja0009lgqa4uppvsvn","_id":"cjeqig1lx001vlgqak467oxw2"},{"post_id":"cjeqig1l6001dlgqavw7i8wqu","category_id":"cjeqig1ja0009lgqa4uppvsvn","_id":"cjeqig1m2001ylgqa1rtjwgn2"},{"post_id":"cjeqig1la001glgqa9tpifqj3","category_id":"cjeqig1ja0009lgqa4uppvsvn","_id":"cjeqig1m60020lgqac2f7e4wb"},{"post_id":"cjeqig1ld001jlgqauht2h26i","category_id":"cjeqig1ja0009lgqa4uppvsvn","_id":"cjeqig1ma0023lgqarm8wmv4f"},{"post_id":"cjeqig1lg001mlgqajmhdrs7a","category_id":"cjeqig1ja0009lgqa4uppvsvn","_id":"cjeqig1me0025lgqavmqptk9n"},{"post_id":"cjeqig1lk001plgqadckgmezn","category_id":"cjeqig1k0000klgqaj3k6fi60","_id":"cjeqig1mh0028lgqakedyo3io"},{"post_id":"cjeqig1lq001slgqaagd6us92","category_id":"cjeqig1ja0009lgqa4uppvsvn","_id":"cjeqig1mo002algqa9b8c7ebx"},{"post_id":"cjeqig1lu001ulgqa3vsdxcop","category_id":"cjeqig1ja0009lgqa4uppvsvn","_id":"cjeqig1ms002clgqa36cu7ivb"},{"post_id":"cjeqig1m0001xlgqacyz9cwah","category_id":"cjeqig1k0000klgqaj3k6fi60","_id":"cjeqig1mw002glgqa14b5rbqt"},{"post_id":"cjeqig1m3001zlgqah357866r","category_id":"cjeqig1ja0009lgqa4uppvsvn","_id":"cjeqig1my002jlgqahjzx4zgl"},{"post_id":"cjeqig1m70022lgqaipdky0xx","category_id":"cjeqig1ja0009lgqa4uppvsvn","_id":"cjeqig1n1002nlgqabnn4xb01"},{"post_id":"cjeqig1mc0024lgqagk790jyf","category_id":"cjeqig1k0000klgqaj3k6fi60","_id":"cjeqig1n4002qlgqaj2pe7kdu"},{"post_id":"cjeqig1mj0029lgqa8gap6wv3","category_id":"cjeqig1ja0009lgqa4uppvsvn","_id":"cjeqig1n7002ulgqaxgob2qbi"},{"post_id":"cjeqig1mq002blgqa6ffhdrtb","category_id":"cjeqig1k0000klgqaj3k6fi60","_id":"cjeqig1na002xlgqazzjvxoha"},{"post_id":"cjeqig1mu002flgqa6za6i8r0","category_id":"cjeqig1k0000klgqaj3k6fi60","_id":"cjeqig1ne0031lgqa0jmeey4x"},{"post_id":"cjeqig1mx002ilgqa8r0rqthg","category_id":"cjeqig1k0000klgqaj3k6fi60","_id":"cjeqig1nh0033lgqa3tlx8ke1"},{"post_id":"cjeqig1n0002mlgqadba7buz7","category_id":"cjeqig1ja0009lgqa4uppvsvn","_id":"cjeqig1nk0035lgqa22dbhmmo"},{"post_id":"cjeqig1n3002plgqazuwwfzqq","category_id":"cjeqig1ja0009lgqa4uppvsvn","_id":"cjeqig1nn0038lgqa9bkwqfqu"},{"post_id":"cjeqig1n6002tlgqatcx9n3l3","category_id":"cjeqig1k0000klgqaj3k6fi60","_id":"cjeqig1nr003algqacvm4nfxc"},{"post_id":"cjeqig1n8002wlgqai216eyll","category_id":"cjeqig1k0000klgqaj3k6fi60","_id":"cjeqig1nw003dlgqa41ooy6gt"},{"post_id":"cjeqig1nd0030lgqauoc0rxbo","category_id":"cjeqig1ja0009lgqa4uppvsvn","_id":"cjeqig1o0003glgqa0d2jjcwr"},{"post_id":"cjeqig1ng0032lgqaaw61cjps","category_id":"cjeqig1ja0009lgqa4uppvsvn","_id":"cjeqig1o6003klgqa34cfbrxr"},{"post_id":"cjeqig1ni0034lgqacj46dp2x","category_id":"cjeqig1k0000klgqaj3k6fi60","_id":"cjeqig1o9003nlgqa9atymkad"},{"post_id":"cjeqig1nl0037lgqasz7at99s","category_id":"cjeqig1ix0004lgqafmxnp9hr","_id":"cjeqig1od003rlgqaf49x1ztf"},{"post_id":"cjeqig1no0039lgqafgjubjwr","category_id":"cjeqig1ix0004lgqafmxnp9hr","_id":"cjeqig1og003ulgqaom0oz6y0"},{"post_id":"cjeqig1nt003clgqayebaubiy","category_id":"cjeqig1ja0009lgqa4uppvsvn","_id":"cjeqig1oj003xlgqatgtje2r0"},{"post_id":"cjeqig1ny003flgqay2quysz8","category_id":"cjeqig1k0000klgqaj3k6fi60","_id":"cjeqig1oo0040lgqamb6b33m2"},{"post_id":"cjeqig1o4003jlgqaxv3x1hd1","category_id":"cjeqig1ja0009lgqa4uppvsvn","_id":"cjeqig1ou0042lgqa34pd36a1"},{"post_id":"cjeqig1o7003mlgqa6iajcxfi","category_id":"cjeqig1ja0009lgqa4uppvsvn","_id":"cjeqig1oz0047lgqa00gvcix0"},{"post_id":"cjeqig1oc003qlgqawk9wcfon","category_id":"cjeqig1k0000klgqaj3k6fi60","_id":"cjeqig1p20049lgqa8rgchxlt"},{"post_id":"cjeqig1of003tlgqa7a8rpw1a","category_id":"cjeqig1k0000klgqaj3k6fi60","_id":"cjeqig1pa004clgqajau1rfmu"},{"post_id":"cjeqig1oi003wlgqa1dmz5iw9","category_id":"cjeqig1k0000klgqaj3k6fi60","_id":"cjeqig1pe004flgqae8js3gm3"},{"post_id":"cjeqig1or0041lgqamf0xk40f","category_id":"cjeqig1ja0009lgqa4uppvsvn","_id":"cjeqig1pi004ilgqalpo2xyob"},{"post_id":"cjeqig1ox0046lgqatxheevwz","category_id":"cjeqig1ja0009lgqa4uppvsvn","_id":"cjeqig1po004llgqahk37ebcc"},{"post_id":"cjeqig1ol003zlgqau9n6y0va","category_id":"cjeqig1ow0044lgqabki9lz2b","_id":"cjeqig1pt004plgqaqpy70q2a"},{"post_id":"cjeqig1p8004blgqa5ggozp6r","category_id":"cjeqig1k0000klgqaj3k6fi60","_id":"cjeqig1pv004slgqavrv2gtkq"},{"post_id":"cjeqig1pc004elgqawejz9ob1","category_id":"cjeqig1k0000klgqaj3k6fi60","_id":"cjeqig1px004vlgqatuq4wvnw"},{"post_id":"cjeqig1pg004hlgqaknleyz48","category_id":"cjeqig1ja0009lgqa4uppvsvn","_id":"cjeqig1q0004ylgqab19pj146"},{"post_id":"cjeqig1pl004klgqa3clo1d3a","category_id":"cjeqig1k0000klgqaj3k6fi60","_id":"cjeqig1q40052lgqauhfld8e0"},{"post_id":"cjeqig1pr004olgqabajpimku","category_id":"cjeqig1k0000klgqaj3k6fi60","_id":"cjeqig1qj0055lgqabjz0jd4w"},{"post_id":"cjeqig1pu004rlgqa9q4a96sp","category_id":"cjeqig1ja0009lgqa4uppvsvn","_id":"cjeqig1qo0059lgqanlkal51m"},{"post_id":"cjeqig1pw004ulgqadc3wz91g","category_id":"cjeqig1ja0009lgqa4uppvsvn","_id":"cjeqig1qq005clgqa6y2z6dr2"},{"post_id":"cjeqig1py004xlgqah94mkfos","category_id":"cjeqig1ja0009lgqa4uppvsvn","_id":"cjeqig1qt005glgqandg8g83c"},{"post_id":"cjeqig1q20051lgqahhovqyuq","category_id":"cjeqig1ja0009lgqa4uppvsvn","_id":"cjeqig1qw005jlgqa1qxre14p"},{"post_id":"cjeqig1q50054lgqapnom3y8c","category_id":"cjeqig1ja0009lgqa4uppvsvn","_id":"cjeqig1qz005nlgqaydgegmq0"},{"post_id":"cjeqig1qm0058lgqan8p8el20","category_id":"cjeqig1ja0009lgqa4uppvsvn","_id":"cjeqig1r1005plgqaplw4lbqn"},{"post_id":"cjeqig1qp005blgqaub319i0u","category_id":"cjeqig1ja0009lgqa4uppvsvn","_id":"cjeqig1r4005rlgqa6l8smv4h"},{"post_id":"cjeqig1qs005flgqagcfsdwu0","category_id":"cjeqig1k0000klgqaj3k6fi60","_id":"cjeqig1r5005tlgqa7mozju20"},{"post_id":"cjeqig1qv005ilgqagz13e0vr","category_id":"cjeqig1k0000klgqaj3k6fi60","_id":"cjeqig1r5005ulgqauuxqjlam"},{"post_id":"cjeqig1qy005mlgqa1i65gxfg","category_id":"cjeqig1k0000klgqaj3k6fi60","_id":"cjeqig1r7005xlgqaijjbc1aq"}],"PostTag":[{"post_id":"cjeqig1iq0002lgqadwf5dd23","tag_id":"cjeqig1iy0005lgqassl4d9u0","_id":"cjeqig1js000hlgqav3a6155n"},{"post_id":"cjeqig1iq0002lgqadwf5dd23","tag_id":"cjeqig1jb000algqafeagfgto","_id":"cjeqig1jx000jlgqajuyyndux"},{"post_id":"cjeqig1iu0003lgqahnz3rutn","tag_id":"cjeqig1jl000flgqa19j86014","_id":"cjeqig1k5000olgqa4htrna0m"},{"post_id":"cjeqig1iz0006lgqal0rjjmzz","tag_id":"cjeqig1k2000mlgqal06qh8f4","_id":"cjeqig1kw0018lgqa43grahtf"},{"post_id":"cjeqig1iz0006lgqal0rjjmzz","tag_id":"cjeqig1kc000slgqap7mcyo75","_id":"cjeqig1l0001blgqa2ow45iar"},{"post_id":"cjeqig1iz0006lgqal0rjjmzz","tag_id":"cjeqig1km0010lgqaa0n9fl35","_id":"cjeqig1l9001flgqa04k9dwd8"},{"post_id":"cjeqig1j70007lgqa3sx70y5f","tag_id":"cjeqig1kt0015lgqa321m6qpt","_id":"cjeqig1lf001llgqap5tcwo7w"},{"post_id":"cjeqig1j70007lgqa3sx70y5f","tag_id":"cjeqig1l3001clgqavui7bfth","_id":"cjeqig1lj001olgqa1afoqfm0"},{"post_id":"cjeqig1j80008lgqajk6hm6yb","tag_id":"cjeqig1lc001ilgqauuw6p43u","_id":"cjeqig1mu002elgqawficxqk9"},{"post_id":"cjeqig1j80008lgqajk6hm6yb","tag_id":"cjeqig1lp001rlgqazfnx3zg1","_id":"cjeqig1mw002hlgqaumjmlngt"},{"post_id":"cjeqig1j80008lgqajk6hm6yb","tag_id":"cjeqig1ly001wlgqaafci64bq","_id":"cjeqig1n0002llgqazi25u8uz"},{"post_id":"cjeqig1j80008lgqajk6hm6yb","tag_id":"cjeqig1m70021lgqa4vov7g8a","_id":"cjeqig1n2002olgqa02vg81fi"},{"post_id":"cjeqig1j80008lgqajk6hm6yb","tag_id":"cjeqig1me0026lgqa0r9ls32a","_id":"cjeqig1n5002slgqaml5km6ab"},{"post_id":"cjeqig1jc000blgqa04ubzg8j","tag_id":"cjeqig1mt002dlgqaouuqii5c","_id":"cjeqig1n8002vlgqaw9p2igqy"},{"post_id":"cjeqig1jg000clgqajbgr6pzu","tag_id":"cjeqig1mz002klgqau61fb8ee","_id":"cjeqig1nc002zlgqaks81uaef"},{"post_id":"cjeqig1jp000glgqagdjxdyjl","tag_id":"cjeqig1n5002rlgqaslq6d8jg","_id":"cjeqig1nx003elgqa7xa26t8a"},{"post_id":"cjeqig1jp000glgqagdjxdyjl","tag_id":"cjeqig1nb002ylgqaobq5gnwh","_id":"cjeqig1o0003hlgqa3l26xfnk"},{"post_id":"cjeqig1jp000glgqagdjxdyjl","tag_id":"cjeqig1nk0036lgqac8tgrrx9","_id":"cjeqig1o6003llgqaot6bg73i"},{"post_id":"cjeqig1jt000ilgqafn6i5tsn","tag_id":"cjeqig1n5002rlgqaslq6d8jg","_id":"cjeqig1oa003olgqaj57kqp13"},{"post_id":"cjeqig1k2000nlgqaq680xclg","tag_id":"cjeqig1o2003ilgqaoy28sxoj","_id":"cjeqig1oe003slgqars33ptgc"},{"post_id":"cjeqig1k6000plgqa3gwggslv","tag_id":"cjeqig1ob003plgqaslimxm0s","_id":"cjeqig1ok003ylgqact1c6oht"},{"post_id":"cjeqig1kd000tlgqa6il2la4i","tag_id":"cjeqig1oh003vlgqarcgkjywu","_id":"cjeqig1ow0045lgqa2cqa0m7d"},{"post_id":"cjeqig1kg000vlgqa83680iuv","tag_id":"cjeqig1ou0043lgqafsn81hcn","_id":"cjeqig1pb004dlgqavkqyytvb"},{"post_id":"cjeqig1kk000ylgqau67h9fov","tag_id":"cjeqig1o2003ilgqaoy28sxoj","_id":"cjeqig1pk004jlgqa6i09gwwr"},{"post_id":"cjeqig1pg004hlgqaknleyz48","tag_id":"cjeqig1ob003plgqaslimxm0s","_id":"cjeqig1pq004nlgqanqcru62t"},{"post_id":"cjeqig1ko0011lgqahgvvt64f","tag_id":"cjeqig1pf004glgqa8yjx1owu","_id":"cjeqig1pt004qlgqaj9z7adrl"},{"post_id":"cjeqig1kr0013lgqan5fmpkel","tag_id":"cjeqig1pf004glgqa8yjx1owu","_id":"cjeqig1py004wlgqabkqy5zr5"},{"post_id":"cjeqig1pu004rlgqa9q4a96sp","tag_id":"cjeqig1ob003plgqaslimxm0s","_id":"cjeqig1q0004zlgqa2c0vup8l"},{"post_id":"cjeqig1pw004ulgqadc3wz91g","tag_id":"cjeqig1ob003plgqaslimxm0s","_id":"cjeqig1q40053lgqai5hzet0y"},{"post_id":"cjeqig1ku0016lgqakw75olx8","tag_id":"cjeqig1pf004glgqa8yjx1owu","_id":"cjeqig1ql0056lgqa3i73oi12"},{"post_id":"cjeqig1py004xlgqah94mkfos","tag_id":"cjeqig1ob003plgqaslimxm0s","_id":"cjeqig1qo005algqaz734re7d"},{"post_id":"cjeqig1ky0019lgqaom3fl4hu","tag_id":"cjeqig1pf004glgqa8yjx1owu","_id":"cjeqig1qr005dlgqa98hsrn1n"},{"post_id":"cjeqig1q50054lgqapnom3y8c","tag_id":"cjeqig1ob003plgqaslimxm0s","_id":"cjeqig1qu005hlgqazl3ta3rf"},{"post_id":"cjeqig1l6001dlgqavw7i8wqu","tag_id":"cjeqig1pf004glgqa8yjx1owu","_id":"cjeqig1qw005klgqakwdvfgut"},{"post_id":"cjeqig1la001glgqa9tpifqj3","tag_id":"cjeqig1pf004glgqa8yjx1owu","_id":"cjeqig1r0005olgqalspxb5xk"},{"post_id":"cjeqig1ld001jlgqauht2h26i","tag_id":"cjeqig1qx005llgqa0h226tj2","_id":"cjeqig1r5005slgqai0yj4q0z"},{"post_id":"cjeqig1lg001mlgqajmhdrs7a","tag_id":"cjeqig1r4005qlgqafxyf3bwe","_id":"cjeqig1r5005wlgqaqfrjxxq8"},{"post_id":"cjeqig1lk001plgqadckgmezn","tag_id":"cjeqig1r5005vlgqa6acp5z7r","_id":"cjeqig1r8005zlgqann0o9bcz"},{"post_id":"cjeqig1lq001slgqaagd6us92","tag_id":"cjeqig1ou0043lgqafsn81hcn","_id":"cjeqig1r90061lgqahq0kms2g"},{"post_id":"cjeqig1lu001ulgqa3vsdxcop","tag_id":"cjeqig1n5002rlgqaslq6d8jg","_id":"cjeqig1rb0065lgqa9e54l0wg"},{"post_id":"cjeqig1lu001ulgqa3vsdxcop","tag_id":"cjeqig1nb002ylgqaobq5gnwh","_id":"cjeqig1rb0066lgqaczk5spgj"},{"post_id":"cjeqig1lu001ulgqa3vsdxcop","tag_id":"cjeqig1ra0063lgqai6qviahv","_id":"cjeqig1rc0068lgqa1mo0q1t5"},{"post_id":"cjeqig1m0001xlgqacyz9cwah","tag_id":"cjeqig1ra0064lgqauszl8gh0","_id":"cjeqig1re006clgqa1k80a9ys"},{"post_id":"cjeqig1m0001xlgqacyz9cwah","tag_id":"cjeqig1rc0067lgqair9lyqeu","_id":"cjeqig1rf006dlgqatd9lefky"},{"post_id":"cjeqig1m0001xlgqacyz9cwah","tag_id":"cjeqig1rc0069lgqa7n932fuo","_id":"cjeqig1rg006flgqax1yk5m1p"},{"post_id":"cjeqig1m0001xlgqacyz9cwah","tag_id":"cjeqig1rd006algqas2wtsktz","_id":"cjeqig1rh006glgqat6k9sevs"},{"post_id":"cjeqig1m3001zlgqah357866r","tag_id":"cjeqig1re006blgqa1b2vianh","_id":"cjeqig1rk006klgqa9gxyts77"},{"post_id":"cjeqig1m3001zlgqah357866r","tag_id":"cjeqig1rg006elgqagu3owddn","_id":"cjeqig1rk006llgqajmkctqif"},{"post_id":"cjeqig1m3001zlgqah357866r","tag_id":"cjeqig1rh006hlgqa6ckqklyz","_id":"cjeqig1rm006nlgqa88rirjj4"},{"post_id":"cjeqig1m3001zlgqah357866r","tag_id":"cjeqig1ri006ilgqa900ueblm","_id":"cjeqig1rm006olgqaon2vr5tc"},{"post_id":"cjeqig1m70022lgqaipdky0xx","tag_id":"cjeqig1rj006jlgqakzcpjjkp","_id":"cjeqig1rn006qlgqaboa62dv4"},{"post_id":"cjeqig1m70022lgqaipdky0xx","tag_id":"cjeqig1rl006mlgqa9b0oqhig","_id":"cjeqig1ro006rlgqajzoiex9s"},{"post_id":"cjeqig1mc0024lgqagk790jyf","tag_id":"cjeqig1rm006plgqavsradfau","_id":"cjeqig1rq006vlgqaxgpddriy"},{"post_id":"cjeqig1mc0024lgqagk790jyf","tag_id":"cjeqig1rc0067lgqair9lyqeu","_id":"cjeqig1rq006wlgqae1g35v4h"},{"post_id":"cjeqig1mc0024lgqagk790jyf","tag_id":"cjeqig1ro006tlgqa8v4djr5p","_id":"cjeqig1rs006ylgqa92bpzu93"},{"post_id":"cjeqig1mf0027lgqaokxr5edw","tag_id":"cjeqig1rp006ulgqapie2c745","_id":"cjeqig1rt0070lgqa84iq4wf2"},{"post_id":"cjeqig1mf0027lgqaokxr5edw","tag_id":"cjeqig1rq006xlgqacolqplm8","_id":"cjeqig1rt0071lgqannjeq6oz"},{"post_id":"cjeqig1mj0029lgqa8gap6wv3","tag_id":"cjeqig1km0010lgqaa0n9fl35","_id":"cjeqig1rw0073lgqa8nfb8udx"},{"post_id":"cjeqig1mj0029lgqa8gap6wv3","tag_id":"cjeqig1k2000mlgqal06qh8f4","_id":"cjeqig1rw0074lgqalyw0g15q"},{"post_id":"cjeqig1mj0029lgqa8gap6wv3","tag_id":"cjeqig1rs006zlgqa505o0dsu","_id":"cjeqig1rx0076lgqax4pdls62"},{"post_id":"cjeqig1mq002blgqa6ffhdrtb","tag_id":"cjeqig1ru0072lgqaup36b88u","_id":"cjeqig1rz0078lgqarv0ea1u2"},{"post_id":"cjeqig1mq002blgqa6ffhdrtb","tag_id":"cjeqig1rx0075lgqa6or6m6sf","_id":"cjeqig1rz0079lgqag6cx7gzl"},{"post_id":"cjeqig1mu002flgqa6za6i8r0","tag_id":"cjeqig1rc0067lgqair9lyqeu","_id":"cjeqig1s1007clgqaqkauvzps"},{"post_id":"cjeqig1mu002flgqa6za6i8r0","tag_id":"cjeqig1rz007algqa8qex4pcq","_id":"cjeqig1s1007dlgqaakvyg4kn"},{"post_id":"cjeqig1mx002ilgqa8r0rqthg","tag_id":"cjeqig1s0007blgqag3pk6ftg","_id":"cjeqig1s3007glgqaoqqvc394"},{"post_id":"cjeqig1mx002ilgqa8r0rqthg","tag_id":"cjeqig1s1007elgqaztvvygua","_id":"cjeqig1s3007hlgqavrbz8gv9"},{"post_id":"cjeqig1n0002mlgqadba7buz7","tag_id":"cjeqig1s2007flgqaigol1zpx","_id":"cjeqig1s4007jlgqaj1yg7zy3"},{"post_id":"cjeqig1n3002plgqazuwwfzqq","tag_id":"cjeqig1n5002rlgqaslq6d8jg","_id":"cjeqig1s6007nlgqaa60hehs6"},{"post_id":"cjeqig1n3002plgqazuwwfzqq","tag_id":"cjeqig1nb002ylgqaobq5gnwh","_id":"cjeqig1s6007olgqajfni186f"},{"post_id":"cjeqig1n3002plgqazuwwfzqq","tag_id":"cjeqig1s5007llgqalu7d6fxu","_id":"cjeqig1s7007qlgqagrj8yz3r"},{"post_id":"cjeqig1n6002tlgqatcx9n3l3","tag_id":"cjeqig1m70021lgqa4vov7g8a","_id":"cjeqig1s8007slgqalt1x2do7"},{"post_id":"cjeqig1n6002tlgqatcx9n3l3","tag_id":"cjeqig1s5007mlgqagyhi31q2","_id":"cjeqig1s8007tlgqapvypwdaj"},{"post_id":"cjeqig1n6002tlgqatcx9n3l3","tag_id":"cjeqig1s7007plgqaeq642qsc","_id":"cjeqig1s9007vlgqa0qgrl5xy"},{"post_id":"cjeqig1n8002wlgqai216eyll","tag_id":"cjeqig1rc0067lgqair9lyqeu","_id":"cjeqig1sa007ylgqar8dky6us"},{"post_id":"cjeqig1n8002wlgqai216eyll","tag_id":"cjeqig1s9007ulgqa1pq6vdof","_id":"cjeqig1sb007zlgqamobcdeum"},{"post_id":"cjeqig1n8002wlgqai216eyll","tag_id":"cjeqig1s9007wlgqaam4xtiy6","_id":"cjeqig1sc0081lgqaauawbbzi"},{"post_id":"cjeqig1nd0030lgqauoc0rxbo","tag_id":"cjeqig1sa007xlgqaiphh2rlp","_id":"cjeqig1sc0082lgqamxx7svfk"},{"post_id":"cjeqig1ng0032lgqaaw61cjps","tag_id":"cjeqig1ob003plgqaslimxm0s","_id":"cjeqig1se0085lgqahvd9wihi"},{"post_id":"cjeqig1ng0032lgqaaw61cjps","tag_id":"cjeqig1sc0083lgqa2wtnxwis","_id":"cjeqig1se0086lgqaapwim5sd"},{"post_id":"cjeqig1ni0034lgqacj46dp2x","tag_id":"cjeqig1sd0084lgqald4yjjx5","_id":"cjeqig1sf0088lgqa1c7chw5r"},{"post_id":"cjeqig1nl0037lgqasz7at99s","tag_id":"cjeqig1se0087lgqagqxml0m2","_id":"cjeqig1sh008dlgqa2zc4vf5e"},{"post_id":"cjeqig1nl0037lgqasz7at99s","tag_id":"cjeqig1rc0067lgqair9lyqeu","_id":"cjeqig1si008elgqa9669ghfm"},{"post_id":"cjeqig1nl0037lgqasz7at99s","tag_id":"cjeqig1sg008algqai8mck445","_id":"cjeqig1sj008glgqalb4sxgo6"},{"post_id":"cjeqig1nl0037lgqasz7at99s","tag_id":"cjeqig1sg008blgqagk2l11lz","_id":"cjeqig1sk008hlgqazgw27jur"},{"post_id":"cjeqig1no0039lgqafgjubjwr","tag_id":"cjeqig1se0087lgqagqxml0m2","_id":"cjeqig1sm008llgqabqu9gozi"},{"post_id":"cjeqig1no0039lgqafgjubjwr","tag_id":"cjeqig1rc0067lgqair9lyqeu","_id":"cjeqig1sn008mlgqa9f2xw26i"},{"post_id":"cjeqig1no0039lgqafgjubjwr","tag_id":"cjeqig1sg008algqai8mck445","_id":"cjeqig1so008olgqa6e8r79o7"},{"post_id":"cjeqig1no0039lgqafgjubjwr","tag_id":"cjeqig1sg008blgqagk2l11lz","_id":"cjeqig1so008plgqahfeweim2"},{"post_id":"cjeqig1nt003clgqayebaubiy","tag_id":"cjeqig1ob003plgqaslimxm0s","_id":"cjeqig1sq008rlgqaa39gu4s0"},{"post_id":"cjeqig1ny003flgqay2quysz8","tag_id":"cjeqig1sn008nlgqa0xmfnx7b","_id":"cjeqig1t1008ulgqapwssywe2"},{"post_id":"cjeqig1ny003flgqay2quysz8","tag_id":"cjeqig1sp008qlgqatudyocaz","_id":"cjeqig1t2008vlgqaitbslyba"},{"post_id":"cjeqig1ny003flgqay2quysz8","tag_id":"cjeqig1sr008slgqak0gysa17","_id":"cjeqig1t3008xlgqaeavql1xy"},{"post_id":"cjeqig1o4003jlgqaxv3x1hd1","tag_id":"cjeqig1ob003plgqaslimxm0s","_id":"cjeqig1t3008ylgqa98qmyybq"},{"post_id":"cjeqig1o7003mlgqa6iajcxfi","tag_id":"cjeqig1ob003plgqaslimxm0s","_id":"cjeqig1t40090lgqa8moe7e96"},{"post_id":"cjeqig1oc003qlgqawk9wcfon","tag_id":"cjeqig1t3008zlgqav0kl7t3b","_id":"cjeqig1t50092lgqamqifo8ny"},{"post_id":"cjeqig1of003tlgqa7a8rpw1a","tag_id":"cjeqig1t40091lgqaq6t5nmnf","_id":"cjeqig1t60094lgqabtbneh82"},{"post_id":"cjeqig1oi003wlgqa1dmz5iw9","tag_id":"cjeqig1t50093lgqaec46nhhi","_id":"cjeqig1t80096lgqakqriritb"},{"post_id":"cjeqig1ol003zlgqau9n6y0va","tag_id":"cjeqig1t70095lgqalg7rwgll","_id":"cjeqig1t90098lgqa6og8gfo0"},{"post_id":"cjeqig1or0041lgqamf0xk40f","tag_id":"cjeqig1t80097lgqai6oak8ci","_id":"cjeqig1ta009algqahw5zy67v"},{"post_id":"cjeqig1ox0046lgqatxheevwz","tag_id":"cjeqig1t90099lgqab59q4iyh","_id":"cjeqig1tb009clgqaot5lwyj6"},{"post_id":"cjeqig1p00048lgqadzqf0q1s","tag_id":"cjeqig1ta009blgqa1oy0danz","_id":"cjeqig1tc009elgqavjgipk2t"},{"post_id":"cjeqig1p8004blgqa5ggozp6r","tag_id":"cjeqig1tb009dlgqapqmlavl4","_id":"cjeqig1td009glgqapd5ujztm"},{"post_id":"cjeqig1pc004elgqawejz9ob1","tag_id":"cjeqig1tc009flgqa3u0tuz0z","_id":"cjeqig1td009ilgqavwfpeyn5"},{"post_id":"cjeqig1pl004klgqa3clo1d3a","tag_id":"cjeqig1rx0075lgqa6or6m6sf","_id":"cjeqig1tp009llgqa6mjkh79g"},{"post_id":"cjeqig1pl004klgqa3clo1d3a","tag_id":"cjeqig1tn009jlgqael532qo2","_id":"cjeqig1tq009mlgqasqx8j495"},{"post_id":"cjeqig1pr004olgqabajpimku","tag_id":"cjeqig1rx0075lgqa6or6m6sf","_id":"cjeqig1tr009olgqancu4jgn3"},{"post_id":"cjeqig1q20051lgqahhovqyuq","tag_id":"cjeqig1tq009nlgqaljcvljjs","_id":"cjeqig1ts009qlgqa622bzm3w"},{"post_id":"cjeqig1qm0058lgqan8p8el20","tag_id":"cjeqig1ob003plgqaslimxm0s","_id":"cjeqig1tt009tlgqav1ya29x3"},{"post_id":"cjeqig1qm0058lgqan8p8el20","tag_id":"cjeqig1tr009plgqaewwjvyvo","_id":"cjeqig1tu009ulgqayjrqa46l"},{"post_id":"cjeqig1qm0058lgqan8p8el20","tag_id":"cjeqig1ts009rlgqa4kopju0w","_id":"cjeqig1tv009wlgqaxpixw8xp"},{"post_id":"cjeqig1qp005blgqaub319i0u","tag_id":"cjeqig1ts009rlgqa4kopju0w","_id":"cjeqig1tw009ylgqa4kf45up4"},{"post_id":"cjeqig1qp005blgqaub319i0u","tag_id":"cjeqig1ob003plgqaslimxm0s","_id":"cjeqig1tx009zlgqajymbxtd2"},{"post_id":"cjeqig1qp005blgqaub319i0u","tag_id":"cjeqig1tr009plgqaewwjvyvo","_id":"cjeqig1tx00a1lgqadllhoyki"},{"post_id":"cjeqig1qs005flgqagcfsdwu0","tag_id":"cjeqig1tv009xlgqax5b35stn","_id":"cjeqig1tx00a2lgqau0ei7c03"},{"post_id":"cjeqig1qv005ilgqagz13e0vr","tag_id":"cjeqig1tb009dlgqapqmlavl4","_id":"cjeqig1tz00a4lgqafeugutwh"},{"post_id":"cjeqig1qy005mlgqa1i65gxfg","tag_id":"cjeqig1tz00a3lgqa15f6vqju","_id":"cjeqig1u000a5lgqae84c48xn"}],"Tag":[{"name":"HCTF","_id":"cjeqig1iy0005lgqassl4d9u0"},{"name":"萌新第一次","_id":"cjeqig1jb000algqafeagfgto"},{"name":"tools reverse","_id":"cjeqig1jl000flgqa19j86014"},{"name":"排序","_id":"cjeqig1k2000mlgqal06qh8f4"},{"name":"冒泡排序","_id":"cjeqig1kc000slgqap7mcyo75"},{"name":"算法","_id":"cjeqig1km0010lgqaa0n9fl35"},{"name":"C","_id":"cjeqig1kt0015lgqa321m6qpt"},{"name":"Helloworld","_id":"cjeqig1l3001clgqavui7bfth"},{"name":"CentOS","_id":"cjeqig1lc001ilgqauuw6p43u"},{"name":"PHP","_id":"cjeqig1lp001rlgqazfnx3zg1"},{"name":"Nignx","_id":"cjeqig1ly001wlgqaafci64bq"},{"name":"MariaDB","_id":"cjeqig1m70021lgqa4vov7g8a"},{"name":"LNMP","_id":"cjeqig1me0026lgqa0r9ls32a"},{"name":"转发","_id":"cjeqig1mt002dlgqaouuqii5c"},{"name":"liux","_id":"cjeqig1mz002klgqau61fb8ee"},{"name":"java","_id":"cjeqig1n5002rlgqaslq6d8jg"},{"name":"设计模式","_id":"cjeqig1nb002ylgqaobq5gnwh"},{"name":"装饰者模式","_id":"cjeqig1nk0036lgqac8tgrrx9"},{"name":"python web Django","_id":"cjeqig1o2003ilgqaoy28sxoj"},{"name":"python","_id":"cjeqig1ob003plgqaslimxm0s"},{"name":"Django","_id":"cjeqig1oh003vlgqarcgkjywu"},{"name":"django","_id":"cjeqig1ou0043lgqafsn81hcn"},{"name":"djangorestframework","_id":"cjeqig1pf004glgqa8yjx1owu"},{"name":"Django djangorestframework","_id":"cjeqig1qx005llgqa0h226tj2"},{"name":"python djangorestframework","_id":"cjeqig1r4005qlgqafxyf3bwe"},{"name":"docker","_id":"cjeqig1r5005vlgqa6acp5z7r"},{"name":"工厂模式","_id":"cjeqig1ra0063lgqai6qviahv"},{"name":"GDB","_id":"cjeqig1ra0064lgqauszl8gh0"},{"name":"Linux","_id":"cjeqig1rc0067lgqair9lyqeu"},{"name":"Debugger","_id":"cjeqig1rc0069lgqa7n932fuo"},{"name":"peda","_id":"cjeqig1rd006algqas2wtsktz"},{"name":"Github","_id":"cjeqig1re006blgqa1b2vianh"},{"name":"Webhook","_id":"cjeqig1rg006elgqagu3owddn"},{"name":"自动部署","_id":"cjeqig1rh006hlgqa6ckqklyz"},{"name":"code deploy","_id":"cjeqig1ri006ilgqa900ueblm"},{"name":"github","_id":"cjeqig1rj006jlgqakzcpjjkp"},{"name":"ssh key","_id":"cjeqig1rl006mlgqa9b0oqhig"},{"name":"VIM","_id":"cjeqig1rm006plgqavsradfau"},{"name":"Edtor","_id":"cjeqig1ro006tlgqa8v4djr5p"},{"name":"markdown","_id":"cjeqig1rp006ulgqapie2c745"},{"name":"入坑","_id":"cjeqig1rq006xlgqacolqplm8"},{"name":"插入排序","_id":"cjeqig1rs006zlgqa505o0dsu"},{"name":"https","_id":"cjeqig1ru0072lgqaup36b88u"},{"name":"nginx","_id":"cjeqig1rx0075lgqa6or6m6sf"},{"name":"SWAP","_id":"cjeqig1rz007algqa8qex4pcq"},{"name":"文件权限","_id":"cjeqig1s0007blgqag3pk6ftg"},{"name":"学习笔记","_id":"cjeqig1s1007elgqaztvvygua"},{"name":"router","_id":"cjeqig1s2007flgqaigol1zpx"},{"name":"观察者模式","_id":"cjeqig1s5007llgqalu7d6fxu"},{"name":"New DB","_id":"cjeqig1s5007mlgqagyhi31q2"},{"name":"Remote","_id":"cjeqig1s7007plgqaeq642qsc"},{"name":"openwrt","_id":"cjeqig1s9007ulgqa1pq6vdof"},{"name":"enviroment","_id":"cjeqig1s9007wlgqaam4xtiy6"},{"name":"C# pdf","_id":"cjeqig1sa007xlgqaiphh2rlp"},{"name":"PIL","_id":"cjeqig1sc0083lgqa2wtnxwis"},{"name":"OpenWrt","_id":"cjeqig1sd0084lgqald4yjjx5"},{"name":"CTF","_id":"cjeqig1se0087lgqagqxml0m2"},{"name":"PWN","_id":"cjeqig1sg008algqai8mck445"},{"name":"pwnable","_id":"cjeqig1sg008blgqagk2l11lz"},{"name":"ssh","_id":"cjeqig1sn008nlgqa0xmfnx7b"},{"name":"暴力破解","_id":"cjeqig1sp008qlgqatudyocaz"},{"name":"记录","_id":"cjeqig1sr008slgqak0gysa17"},{"name":"postgres","_id":"cjeqig1t3008zlgqav0kl7t3b"},{"name":"tcp program","_id":"cjeqig1t40091lgqaq6t5nmnf"},{"name":"linux","_id":"cjeqig1t50093lgqaec46nhhi"},{"name":"cmd","_id":"cjeqig1t70095lgqalg7rwgll"},{"name":"web cookie","_id":"cjeqig1t80097lgqai6oak8ci"},{"name":"python socket","_id":"cjeqig1t90099lgqab59q4iyh"},{"name":"hello hexo","_id":"cjeqig1ta009blgqa1oy0danz"},{"name":"kvm","_id":"cjeqig1tb009dlgqapqmlavl4"},{"name":"iPXE winpe","_id":"cjeqig1tc009flgqa3u0tuz0z"},{"name":"domain","_id":"cjeqig1tn009jlgqael532qo2"},{"name":"python note","_id":"cjeqig1tq009nlgqaljcvljjs"},{"name":"web","_id":"cjeqig1tr009plgqaewwjvyvo"},{"name":"tornado","_id":"cjeqig1ts009rlgqa4kopju0w"},{"name":"kvm noVNC","_id":"cjeqig1tv009xlgqax5b35stn"},{"name":"iPXE netboot","_id":"cjeqig1tz00a3lgqa15f6vqju"}]}}